<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>Shell ‰ª£Á†ÅÊ†∑‰æãÈÄüÊü• | Yipsen Ye</title>
<meta name="description" content="ÊâìÂç∞Êó•Âøó #!/bin/bash ############################################################### # Program: # This program for upload batch of pictures to nimg. # History: # # Ver Date Author Actvity # --- ---- ------ ------- # 1.0 2018/12/10 Yipsen First release ############################################################### ############################################################### SOURCE_PATH=&amp;#34;/mnt/resource/&amp;#34; TARGET_URL=&amp;#34;http://192.168.1.102:9000/02/upload&amp;#34; #Folder path HOME_PATH=&amp;#34;&amp;#34; WORKING_PATH=&amp;#34;${HOME_PATH}/working/image_`date &#43;%Y%m%d_%H%M%S_$$`&amp;#34; OUTPUT_PATH=&amp;#34;${HOME_PATH}/output&amp;#34; LOG_PATH=&amp;#34;${HOME_PATH}/logs&amp;#34; #Log File LOG_FILE=&amp;#34;${LOG_PATH}/UploadToNimg_`date &#43;%Y-%m-%d`.log&amp;#34; #Json File ACTOR_JSON_FILE=&amp;#34;${OUTPUT_PATH}/actor_`date &#43;%Y-%m-%d`.log&amp;#34; MOVIE_JSON_FILE=&amp;#34;${OUTPUT_PATH}/movie_`date &#43;%Y-%m-%d`.log&amp;#34; ############################################################### function Initialize() { # logInfo &amp;#34;----- Initialize - Initialize log file/archive file is starting.&amp;#34; # if [ -f ${LOG_FILE} ]; # then # chmod 755 ${LOG_FILE} # else # touch ${LOG_FILE} # chmod 755 ${LOG_FILE} # logInfo &amp;#34;----- Initialize - New log file is created.">
<meta name="author" content="yipsen">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="nav-logo">
    <a href="http://yipsen.github.io/">
        
        <span class="nav-title">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link active"
                href="http://yipsen.github.io/posts/">ÊñáÁ´†</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">ÈôÑË°®</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">ÂÖ≥‰∫é</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><article class="post-block">
        <h1 class="post-title">Shell ‰ª£Á†ÅÊ†∑‰æãÈÄüÊü•</h1>
        <div class="post-info">
            <div class="post-date"> 
                <span>2022-02-06 16:31:43</span>
            </div>
        </div>
        <div class="post-content">
            <h3 id="ÊâìÂç∞Êó•Âøó">ÊâìÂç∞Êó•Âøó</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span><span style="color:#75715e">###############################################################</span>
<span style="color:#75715e"># Program:</span>
<span style="color:#75715e">#       This program for upload batch of pictures to nimg.</span>
<span style="color:#75715e"># History:</span>
<span style="color:#75715e">#</span>
<span style="color:#75715e"># Ver Date  Author Actvity</span>
<span style="color:#75715e"># --- ----  ------ -------</span>
<span style="color:#75715e"># 1.0 2018/12/10 Yipsen First release</span>
<span style="color:#75715e">###############################################################</span>

<span style="color:#75715e">###############################################################</span>
SOURCE_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/mnt/resource/&#34;</span>
TARGET_URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://192.168.1.102:9000/02/upload&#34;</span>

<span style="color:#75715e">#Folder path</span>
HOME_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>
WORKING_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>HOME_PATH<span style="color:#e6db74">}</span><span style="color:#e6db74">/working/image_`date +%Y%m%d_%H%M%S_</span>$$<span style="color:#e6db74">`&#34;</span>
OUTPUT_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>HOME_PATH<span style="color:#e6db74">}</span><span style="color:#e6db74">/output&#34;</span>
LOG_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>HOME_PATH<span style="color:#e6db74">}</span><span style="color:#e6db74">/logs&#34;</span>

<span style="color:#75715e">#Log File</span>
LOG_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>LOG_PATH<span style="color:#e6db74">}</span><span style="color:#e6db74">/UploadToNimg_`date +%Y-%m-%d`.log&#34;</span>

<span style="color:#75715e">#Json File</span>
ACTOR_JSON_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>OUTPUT_PATH<span style="color:#e6db74">}</span><span style="color:#e6db74">/actor_`date +%Y-%m-%d`.log&#34;</span>
MOVIE_JSON_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>OUTPUT_PATH<span style="color:#e6db74">}</span><span style="color:#e6db74">/movie_`date +%Y-%m-%d`.log&#34;</span>

<span style="color:#75715e">###############################################################</span>
<span style="color:#66d9ef">function</span> Initialize<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
<span style="color:#75715e"># logInfo &#34;----- Initialize - Initialize log file/archive file is starting.&#34;</span>
<span style="color:#75715e"># if [ -f ${LOG_FILE} ];</span>
<span style="color:#75715e"># then</span>
<span style="color:#75715e">#  chmod 755 ${LOG_FILE}</span>
<span style="color:#75715e"># else</span>
<span style="color:#75715e">#  touch ${LOG_FILE}</span>
<span style="color:#75715e">#  chmod 755 ${LOG_FILE}</span>
<span style="color:#75715e">#  logInfo &#34;----- Initialize - New log file is created.&#34;</span>
<span style="color:#75715e"># fi</span>
<span style="color:#75715e"># logInfo &#34;----- Initialize - Initialize log file/archive file successfully.&#34;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">function</span> Upload_folders<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
 logInfo <span style="color:#e6db74">&#34;----- Upload folders - Start upload folders.&#34;</span>
 
 <span style="color:#75715e">#1. </span>
 <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> ! -d <span style="color:#e6db74">${</span>WORKING_PATH<span style="color:#e6db74">}</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
  mkdir -p <span style="color:#e6db74">${</span>WORKING_PATH<span style="color:#e6db74">}</span>
  logInfo <span style="color:#e6db74">&#34;----- Upload folders - New working folder is created --&gt; </span><span style="color:#e6db74">${</span>WORKING_PATH<span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>
 <span style="color:#66d9ef">fi</span>
 
 <span style="color:#75715e">#2.</span>
 target_folders<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>find <span style="color:#e6db74">${</span>SOURCE_PATH<span style="color:#e6db74">}</span> -iname <span style="color:#e6db74">&#34;*&#34;</span><span style="color:#e6db74">`</span>
 
 <span style="color:#75715e">#3.</span>
 <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>target_folders<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
  <span style="color:#75715e">#3.1</span>
  rm -rf <span style="color:#e6db74">${</span>WORKING_PATH<span style="color:#e6db74">}</span>
  logInfo <span style="color:#e6db74">&#34;----- Upload folders - No folders need to upload. working folder [</span><span style="color:#e6db74">${</span>WORKING_PATH<span style="color:#e6db74">}</span><span style="color:#e6db74">] is deleted.&#34;</span>
  logInfo <span style="color:#e6db74">&#34;===================== End Upload to Nimg =====================&#34;</span>
  exit
 <span style="color:#66d9ef">else</span>
  <span style="color:#75715e">#3.2</span>
  a<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
  <span style="color:#66d9ef">for</span> folder_name in <span style="color:#e6db74">`</span>find <span style="color:#e6db74">${</span>SOURCE_PATH<span style="color:#e6db74">}</span>/* -type d -printf <span style="color:#e6db74">&#39;%f\n&#39;</span><span style="color:#e6db74">`</span>; <span style="color:#66d9ef">do</span>
   folder_list<span style="color:#f92672">[</span>$a<span style="color:#f92672">]=</span><span style="color:#e6db74">${</span>folder_name<span style="color:#e6db74">}</span>
   let <span style="color:#e6db74">&#34;a+=1&#34;</span>
  <span style="color:#66d9ef">done</span>
  
  <span style="color:#75715e">#3.3</span>
  aid<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
  mid<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
  <span style="color:#66d9ef">for</span> folder in <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>folder_list[@]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">do</span>
   source_folder_path<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>SOURCE_PATH<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\/</span><span style="color:#e6db74">&#34;S{folder}&#34;</span>
   logInfo <span style="color:#e6db74">&#34;----- Upload folders - Copy source folder to working path.&#34;</span>
   cp -a <span style="color:#e6db74">${</span>source_folder_path<span style="color:#e6db74">}</span> <span style="color:#e6db74">${</span>WORKING_PATH<span style="color:#e6db74">}</span>
   
   working_folder_path<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>WORKING_PATH<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\/</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>folder<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
   Upload_files <span style="color:#e6db74">${</span>working_folder_path<span style="color:#e6db74">}</span>
   Output_Actor $aid $folder
   
   rmdir <span style="color:#e6db74">${</span>working_folder_path<span style="color:#e6db74">}</span>
   logInfo <span style="color:#e6db74">&#34;----- Upload folders - Upload </span><span style="color:#e6db74">${</span>working_folder_path<span style="color:#e6db74">}</span><span style="color:#e6db74"> done. folder deleted.&#34;</span>
  <span style="color:#66d9ef">done</span>
 <span style="color:#66d9ef">fi</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">function</span> Upload_files<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
 IFS<span style="color:#f92672">=</span><span style="color:#e6db74">$&#39;\n&#39;</span>
 OLDIFS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$IFS<span style="color:#e6db74">&#34;</span>
 <span style="color:#66d9ef">for</span> file in <span style="color:#e6db74">`</span>find $1 -type f -printf <span style="color:#e6db74">&#39;%f\n&#39;</span><span style="color:#e6db74">`</span>; <span style="color:#66d9ef">do</span>
  file_path<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>1<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\/</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>file<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
  
  logInfo <span style="color:#e6db74">&#34;----- Upload files - Start to upload file - </span><span style="color:#e6db74">${</span>file_path<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
  Output_Movie $mid $aid $file <span style="color:#e6db74">`</span>curl -F <span style="color:#e6db74">&#34;userfile=@</span><span style="color:#e6db74">${</span>file_path<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">${</span>TARGET_URL<span style="color:#e6db74">}</span> | grep <span style="color:#e6db74">&#34;url&#34;</span><span style="color:#e6db74">`</span>
  
  rm -f <span style="color:#e6db74">${</span>file_path<span style="color:#e6db74">}</span>
  logInfo <span style="color:#e6db74">&#34;----- Upload files - End to upload file - </span><span style="color:#e6db74">${</span>file_path<span style="color:#e6db74">}</span><span style="color:#e6db74">, file deleted.&#34;</span>
  let <span style="color:#e6db74">&#34;mid+=1&#34;</span>
 <span style="color:#66d9ef">done</span>
 IFS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$OLDIFS<span style="color:#e6db74">&#34;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">function</span> Output_Actor<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
 echo <span style="color:#e6db74">&#34;{\&#34;id\&#34;: \&#34;</span>$1<span style="color:#e6db74">\&#34;, \&#34;name\&#34;: \&#34;</span>$2<span style="color:#e6db74">\&#34;}&#34;</span>&gt;&gt;<span style="color:#e6db74">${</span>ACTOR_JSON_FILE<span style="color:#e6db74">}</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">function</span> Output_Movie<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
 echo <span style="color:#e6db74">&#34;{\&#34;id\&#34;: \&#34;</span>$1<span style="color:#e6db74">\&#34;, \&#34;aid\&#34;: \&#34;</span>$2<span style="color:#e6db74">\&#34;, \&#34;name\&#34;: \&#34;</span>$3<span style="color:#e6db74">\&#34;, </span>$4<span style="color:#e6db74">}&#34;</span>&gt;&gt;<span style="color:#e6db74">${</span>MOVIE_JSON_FILE<span style="color:#e6db74">}</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">###############################################################</span>
logInfo<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
 timestamp<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>date +%Y-%m-%d<span style="color:#ae81ff">\ </span>%H:%M:%S<span style="color:#e6db74">`</span>
 echo <span style="color:#e6db74">&#34;[</span>$timestamp<span style="color:#e6db74"> </span>$$<span style="color:#e6db74">] INFO====== </span>$1<span style="color:#e6db74">&#34;</span>
<span style="color:#f92672">}</span>
logWarn<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
 timestamp<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>date +%Y-%m-%d<span style="color:#ae81ff">\ </span>%H:%M:%S<span style="color:#e6db74">`</span>
 echo <span style="color:#e6db74">&#34;[</span>$timestamp<span style="color:#e6db74"> </span>$$<span style="color:#e6db74">] WARN====== </span>$1<span style="color:#e6db74">&#34;</span>
<span style="color:#f92672">}</span>
logError<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
 timestamp<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>date +%Y-%m-%d<span style="color:#ae81ff">\ </span>%H:%M:%S<span style="color:#e6db74">`</span>
 echo <span style="color:#e6db74">&#34;[</span>$timestamp<span style="color:#e6db74"> </span>$$<span style="color:#e6db74">] ERROR====== </span>$1<span style="color:#e6db74">&#34;</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">###############################################################</span>
main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
 logInfo <span style="color:#e6db74">&#34;===================== Start Upload to Nimg ===================&#34;</span>
 Initialize
 Upload_folders
 logInfo <span style="color:#e6db74">&#34;===================== End Upload to Nimg =====================&#34;</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">###############################################################</span>
main 1&gt;&gt;<span style="color:#e6db74">${</span>LOG_FILE<span style="color:#e6db74">}</span> 2&gt;&gt;<span style="color:#e6db74">${</span>LOG_FILE<span style="color:#e6db74">}</span>
</code></pre></div>
        </div>
    </article>
</div>
<div class="division-line"></div>
<div class="others">
    <div>Ê†áÁ≠æÔºöüè∑Ô∏è<a class="post-tag" href="/tags/%E4%BB%A3%E7%A0%81%E6%A0%B7%E4%BE%8B%E9%80%9F%E6%9F%A5/">‰ª£Á†ÅÊ†∑‰æãÈÄüÊü•</a>&nbsp;</div>
    <div></div>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="http://yipsen.github.io/posts/linux/tar-%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/"><span>tar ÂëΩ‰ª§ËØ¶Ëß£</span></a>
    </div>
    <div class="next">
        
        <a href="http://yipsen.github.io/posts/redis/redis-%E7%9B%B8%E5%85%B3%E5%B8%B8%E8%A7%81%E5%BC%82%E5%B8%B8/"><span>Redis Áõ∏ÂÖ≥Â∏∏ËßÅÂºÇÂ∏∏</span></a>
    </div>
</div>

        </div>
        <div id="float">
            <ul class="float-button-bar">
    <li>
        <button class="float-button top" onclick="scrollToTop(this);">UP</button>
    </li>
    <li>
        <button class="float-button toggler" onclick="changeSkin(this);">DARK</button>
    </li>
</ul>
        </div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 2020 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    const changeSkin = () => {
        document.getElementById('page').classList.toggle('night');
    }
    const scrollToTop = () => {
        window.scrollTo(0, 0);
    }
</script>
</body>

</html>