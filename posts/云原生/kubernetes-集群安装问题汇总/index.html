<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>kubernetes cluster installation trouble shooting | Yipsen Ye</title>
<meta name="description" content="kubernetes é›†ç¾¤å®‰è£…å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ é›¶ã€kubeadm initå¤±è´¥  é”™è¯¯æ—¥å¿—  [root@localhost Downloads]# kubeadm init [init] Using Kubernetes version: v1.24.3 [preflight] Running pre-flight checks [WARNING Firewalld]: firewalld is active, please ensure ports [6443 10250] are open or your cluster may not function correctly [WARNING Swap]: swap is enabled; production deployments should disable swap unless testing the NodeSwap feature gate of the kubelet error execution phase preflight: [preflight] Some fatal errors occurred: [ERROR NumCPU]: the number of available CPUs 1 is less than the required 2 [ERROR Mem]: the system RAM (972 MB) is less than the minimum 1700 MB [ERROR CRI]: container runtime is not running: output: time=&amp;#34;2022-08-13T09:53:22-07:00&amp;#34; level=fatal msg=&amp;#34;unable to determine runtime API version: rpc error: code = Unavailable desc = connection error: desc = \&amp;#34;transport: Error while dialing dial unix /var/run/containerd/containerd.">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link active"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><article class="post-block">
        <h1 class="post-title">kubernetes cluster installation trouble shooting</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2022-08-15 22:00:00</span></div></div>
        <div class="post-content">
            <h3 id="kubernetes-é›†ç¾¤å®‰è£…å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ">kubernetes é›†ç¾¤å®‰è£…å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ</h3>
<h4 id="é›¶kubeadm-initå¤±è´¥">é›¶ã€kubeadm initå¤±è´¥</h4>
<ul>
<li>é”™è¯¯æ—¥å¿—</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@localhost Downloads<span style="color:#f92672">]</span><span style="color:#75715e"># kubeadm init</span>
<span style="color:#f92672">[</span>init<span style="color:#f92672">]</span> Using Kubernetes version: v1.24.3
<span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> Running pre-flight checks
        <span style="color:#f92672">[</span>WARNING Firewalld<span style="color:#f92672">]</span>: firewalld is active, please ensure ports <span style="color:#f92672">[</span><span style="color:#ae81ff">6443</span> 10250<span style="color:#f92672">]</span> are open or your cluster may not <span style="color:#66d9ef">function</span> correctly
        <span style="color:#f92672">[</span>WARNING Swap<span style="color:#f92672">]</span>: swap is enabled; production deployments should disable swap unless testing the NodeSwap feature gate of the kubelet
error execution phase preflight: <span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> Some fatal errors occurred:
        <span style="color:#f92672">[</span>ERROR NumCPU<span style="color:#f92672">]</span>: the number of available CPUs <span style="color:#ae81ff">1</span> is less than the required <span style="color:#ae81ff">2</span>
        <span style="color:#f92672">[</span>ERROR Mem<span style="color:#f92672">]</span>: the system RAM <span style="color:#f92672">(</span><span style="color:#ae81ff">972</span> MB<span style="color:#f92672">)</span> is less than the minimum <span style="color:#ae81ff">1700</span> MB
        <span style="color:#f92672">[</span>ERROR CRI<span style="color:#f92672">]</span>: container runtime is not running: output: time<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2022-08-13T09:53:22-07:00&#34;</span> level<span style="color:#f92672">=</span>fatal msg<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;unable to determine runtime API version: rpc error: code = Unavailable desc = connection error: desc = \&#34;transport: Error while dialing dial unix /var/run/containerd/containerd.sock: connect: no such file or directory\&#34;&#34;</span>
, error: exit status <span style="color:#ae81ff">1</span>
        <span style="color:#f92672">[</span>ERROR FileContent--proc-sys-net-bridge-bridge-nf-call-iptables<span style="color:#f92672">]</span>: /proc/sys/net/bridge/bridge-nf-call-iptables does not exist
        <span style="color:#f92672">[</span>ERROR FileExisting-conntrack<span style="color:#f92672">]</span>: conntrack not found in system path
<span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> If you know what you are doing, you can make a check non-fatal with <span style="color:#e6db74">`</span>--ignore-preflight-errors<span style="color:#f92672">=</span>...<span style="color:#e6db74">`</span>
To see the stack trace of this error execute with --v<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span> or higher
</code></pre></div><ul>
<li>é”™è¯¯åˆ†æ</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># éœ€è¦å…³é—­é˜²ç«å¢™</span>
<span style="color:#f92672">[</span>WARNING Firewalld<span style="color:#f92672">]</span>: firewalld is active, please ensure ports <span style="color:#f92672">[</span><span style="color:#ae81ff">6443</span> 10250<span style="color:#f92672">]</span> are open or your cluster may not <span style="color:#66d9ef">function</span> correctly
<span style="color:#75715e"># éœ€è¦å…³é—­ Swap</span>
<span style="color:#f92672">[</span>WARNING Swap<span style="color:#f92672">]</span>: swap is enabled; production deployments should disable swap unless testing the NodeSwap feature gate of the kubelet
error execution phase preflight: <span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> Some fatal errors occurred:
<span style="color:#75715e"># CPU éœ€è¦ä¸¤æ ¸ä»¥ä¸Š</span>
<span style="color:#f92672">[</span>ERROR NumCPU<span style="color:#f92672">]</span>: the number of available CPUs <span style="color:#ae81ff">1</span> is less than the required <span style="color:#ae81ff">2</span>
<span style="color:#75715e"># å†…å­˜éœ€è¦ 1700 MB ä»¥ä¸Š</span>
<span style="color:#f92672">[</span>ERROR Mem<span style="color:#f92672">]</span>: the system RAM <span style="color:#f92672">(</span><span style="color:#ae81ff">972</span> MB<span style="color:#f92672">)</span> is less than the minimum <span style="color:#ae81ff">1700</span> MB
<span style="color:#75715e"># æ²¡æœ‰å®‰è£… CRI å®¹å™¨è¿è¡Œæ—¶ï¼Œæ¯”å¦‚ docker</span>
<span style="color:#f92672">[</span>ERROR CRI<span style="color:#f92672">]</span>: container runtime is not running: output: time<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2022-08-13T09:53:22-07:00&#34;</span> level<span style="color:#f92672">=</span>fatal msg<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;unable to determine runtime API version: rpc error: code = Unavailable desc = connection error: desc = \&#34;transport: Error while dialing dial unix /var/run/containerd/containerd.sock: connect: no such file or directory\&#34;&#34;</span>
<span style="color:#75715e"># æ²¡æœ‰é…ç½® iptables</span>
<span style="color:#f92672">[</span>ERROR FileContent--proc-sys-net-bridge-bridge-nf-call-iptables<span style="color:#f92672">]</span>: /proc/sys/net/bridge/bridge-nf-call-iptables does not exist
<span style="color:#75715e"># æ²¡æœ‰å®‰è£… conntrack</span>
<span style="color:#f92672">[</span>ERROR FileExisting-conntrack<span style="color:#f92672">]</span>: conntrack not found in system path
</code></pre></div><h4 id="ä¸€-preflight-you-can-also-perform-this-action-in-beforehand-using-kubeadm-config-images-pull">ä¸€ã€ [preflight] You can also perform this action in beforehand using &lsquo;kubeadm config images pull&rsquo;</h4>
<ul>
<li>å‘ç”Ÿåœºæ™¯ï¼šæ‰§è¡Œå‘½ä»¤<code>kubeadm init</code>æ—¶</li>
<li>é—®é¢˜ç°è±¡ï¼šå¡é¡¿åœ¨<code>[preflight] You can also perform this action in beforehand using 'kubeadm config images pull'</code>ç›´åˆ°è¶…æ—¶</li>
<li>é—®é¢˜åŸå› ï¼šæ‹‰å–é•œåƒè¢«å¢™ï¼Œæ‹‰ä¸ä¸‹æ¥</li>
<li>è§£å†³æ–¹æ¡ˆï¼šæ”¹é•œåƒä»“åº“ image-repository ä¸ºé˜¿é‡Œäº‘ <code>registry.aliyuncs.com/google_containers</code></li>
</ul>
<ol>
<li>åŠ ä¸Šå‚æ•°<code>image-repository</code>å¹¶æŒ‡å®šä¸ºé˜¿é‡Œäº‘</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubeadm init --image-repository<span style="color:#f92672">=</span>registry.aliyuncs.com/google_containers
</code></pre></div><ol start="2">
<li>ä¸»åŠ¨æ‹‰å–</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubeadm config images pull --image-repository<span style="color:#f92672">=</span>registry.aliyuncs.com/google_containers
</code></pre></div><ol start="3">
<li>åˆ—å‡ºéœ€è¦çš„é•œåƒï¼Œç„¶åç”¨ docker å» pullï¼Œå†é‡æ–°æ‰“ä¸ºéœ€è¦çš„ tag</li>
</ol>
<ul>
<li>åˆ—å‡ºéœ€è¦çš„é•œåƒï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubeadm config images list
</code></pre></div><ul>
<li>ç»“æœï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">k8s.gcr.io/kube-apiserver:v1.22.12
k8s.gcr.io/kube-controller-manager:v1.22.12
k8s.gcr.io/kube-scheduler:v1.22.12
k8s.gcr.io/kube-proxy:v1.22.12
k8s.gcr.io/pause:3.5
k8s.gcr.io/etcd:3.5.0-0
k8s.gcr.io/coredns/coredns:v1.8.4
</code></pre></div><ul>
<li>æ”¹æ ‡ç­¾ç„¶åç”¨ docker å»æ‹‰å–ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker pull registry.aliyuncs.com/google_containers/kube-apiserver:v1.22.12
docker pull registry.aliyuncs.com/google_containers/kube-controller-manager:v1.22.12
docker pull registry.aliyuncs.com/google_containers/kube-scheduler:v1.22.12
docker pull registry.aliyuncs.com/google_containers/kube-proxy:v1.22.12
docker pull registry.aliyuncs.com/google_containers/pause:3.5
docker pull registry.aliyuncs.com/google_containers/etcd:3.5.0-0
docker pull registry.aliyuncs.com/google_containers/coredns:v1.8.4
</code></pre></div><h4 id="äºŒ-wait-control-plane-waiting-for-the-kubelet-to-boot-up-the-control-plane-as-static-pods-from-directory-etckubernetesmanifests-this-can-take-up-to-4m0s">äºŒã€ [wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory &ldquo;/etc/kubernetes/manifests&rdquo;. This can take up to 4m0s</h4>
<ul>
<li>å‘ç”Ÿåœºæ™¯ï¼šæ‰§è¡Œå‘½ä»¤<code>kubeadm init</code>æ—¶</li>
<li>é—®é¢˜ç°è±¡ï¼šå¡é¡¿åœ¨<code>[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory &quot;/etc/kubernetes/manifests&quot;. This can take up to 4m0s</code>ä¹‹åå¤±è´¥</li>
<li>é—®é¢˜åŸå› ï¼šæœªçŸ¥ï¼Œéœ€è¦é€šè¿‡æç¤ºæŸ¥çœ‹ï¼Œä¸€èˆ¬æ˜¯<code>journalctl -xeu kubelet</code>æŸ¥çœ‹ kubelet è¿è¡Œé—®é¢˜</li>
<li>è§£å†³æ–¹æ¡ˆï¼šè™šæ‹Ÿæœºvmwareé‡‡ç”¨åŒç½‘å¡ï¼Œä¸€ä¸ªNATï¼Œä¸€ä¸ªä¸»æœºå…±äº«ã€‚ç„¶å kubernetes ç‰ˆæœ¬é™åˆ° v1.22.1 åæ²¡æœ‰å†å‡ºç°ã€‚</li>
</ul>
<h4 id="ä¸‰-warning-hostname-hostname-kube-master-01-lookup-kube-master-01-on-192168163253-no-such-host">ä¸‰ã€ [WARNING Hostname]: hostname &ldquo;kube-master-01&rdquo;: lookup kube-master-01 on 192.168.163.2:53: no such host</h4>
<ul>
<li>å‘ç”Ÿåœºæ™¯ï¼šæ‰§è¡Œå‘½ä»¤<code>kubeadm init</code>æ—¶</li>
<li>é—®é¢˜ç°è±¡ï¼šæ—¥å¿—æ˜¾ç¤º<code>[WARNING Hostname]: hostname &quot;kube-master-01&quot;: lookup kube-master-01 on 192.168.163.2:53: no such host</code></li>
<li>é—®é¢˜åŸå› ï¼šä¸»æœº hostname æ²¡æœ‰é…ç½®</li>
<li>è§£å†³æ–¹æ¡ˆï¼šä¿®æ”¹ hostname</li>
</ul>
<ol>
<li>ç›´æ¥ä¿®æ”¹ hostname</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">hostnamectl set-hostname kube-master-01
</code></pre></div><ol start="2">
<li>ä¿®æ”¹æœ¬æœº hosts é…ç½®æ–‡ä»¶</li>
</ol>
<ul>
<li>æ‰§è¡Œå‘½ä»¤</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">vi /etc/hosts
</code></pre></div><ul>
<li>å¹¶åœ¨æœ€å°¾å¤„è¿½åŠ ï¼š</li>
</ul>
<pre tabindex="0"><code class="language-hosts" data-lang="hosts">192.168.163.129 kube-master-01
</code></pre><h4 id="å››-failed-to-run-kubelet-misconfiguration-kubelet-cgroup-driver-cgroupfs-is-different-from-docker-cgroup-driver-systemd">å››ã€ failed to run Kubelet: misconfiguration: kubelet cgroup driver: &ldquo;cgroupfs&rdquo; is different from docker cgroup driver: &ldquo;systemd&rdquo;</h4>
<ul>
<li>å‘ç”Ÿåœºæ™¯ï¼šæ‰§è¡Œ<code>kubeadm init</code>å¤±è´¥ï¼ŒåŒæ—¶æŸ¥çœ‹<code>journalctl -xeu kubelet</code>å‘ç° kubelet æœ‰å¼‚å¸¸</li>
<li>é—®é¢˜ç°è±¡ï¼škubelet æ—¥å¿—æ˜¾ç¤º<code>failed to run Kubelet: misconfiguration: kubelet cgroup driver: &quot;cgroupfs&quot; is different from docker cgroup driver: &quot;systemd&quot;</code></li>
<li>é—®é¢˜åŸå› ï¼šdocker ä¸ kubelet é…ç½®ä¸ä¸€è‡´</li>
<li>è§£å†³æ–¹æ¡ˆï¼šä¿®æ”¹åŒæ–¹é…ç½®</li>
</ul>
<ol>
<li>é‡ç½®æœªåˆå§‹åŒ–æˆåŠŸçš„kubeadmé…ç½®</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">echo y|kubeadm reset
</code></pre></div><ol start="2">
<li>ä¿®æ”¹ docker é…ç½®<code>/etc/docker/daemon.json</code></li>
</ol>
<ul>
<li>æ‰§è¡Œå‘½ä»¤</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">vi /etc/docker/daemon.json
</code></pre></div><ul>
<li>æ·»åŠ é…ç½®</li>
</ul>
<pre tabindex="0"><code class="language-properties" data-lang="properties">&quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]
</code></pre><ol start="3">
<li>ä¿®æ”¹ kubelet é…ç½®<code>/var/lib/kubelet/config.yaml</code></li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">cat &gt; /var/lib/kubelet/config.yaml <span style="color:#e6db74">&lt;&lt;EOF
</span><span style="color:#e6db74">apiVersion: kubelet.config.k8s.io/v1beta1
</span><span style="color:#e6db74">kind: KubeletConfiguration
</span><span style="color:#e6db74">cgroupDriver: systemd
</span><span style="color:#e6db74">EOF</span>
</code></pre></div><ol start="4">
<li>é‡å¯docker ä¸ kubelet</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">systemctl daemon-reload
systemctl restart docker
systemctl restart kubelet
</code></pre></div><ol start="5">
<li>æ£€æŸ¥</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># æ£€æŸ¥æ˜¯å¦è¾“å‡º Cgroup Driver: systemd</span>
docker info|grep <span style="color:#e6db74">&#34;Cgroup Driver&#34;</span>
</code></pre></div><h4 id="äº”-failed-to-run-kubelet-errfailed-to-run-kubelet-unable-to-load-bootstrap-kubeconfig-stat-etckubernetesbootstrap-kubeletconf-no-such-file-or-directory">äº”ã€ &ldquo;Failed to run kubelet&rdquo; err=&ldquo;failed to run Kubelet: unable to load bootstrap kubeconfig: stat /etc/kubernetes/bootstrap-kubelet.conf: no such file or directory&rdquo;</h4>
<ul>
<li>å‘ç”Ÿåœºæ™¯ï¼šé€šè¿‡<code>systemctl status kubelet</code>æŸ¥çœ‹ kubelet çŠ¶æ€æ—¶å‘ç°é”™è¯¯</li>
<li>é—®é¢˜ç°è±¡ï¼š&ldquo;Failed to run kubelet&rdquo; err=&ldquo;failed to run Kubelet: unable to load bootstrap kubeconfig: stat /etc/kubernetes/bootstrap-kubelet.conf: no such file or directory&rdquo;</li>
<li>é—®é¢˜åŸå› ï¼šè¯ä¹¦é—®é¢˜</li>
<li>è§£å†³æ–¹æ¡ˆï¼šé‡æ–°ç”Ÿæˆ</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ cd /etc/kubernetes/pki/
$ mv <span style="color:#f92672">{</span>apiserver.crt,apiserver-etcd-client.key,apiserver-kubelet-client.crt,front-proxy-ca.crt,front-proxy-client.crt,front-proxy-client.key,front-proxy-ca.key,apiserver-kubelet-client.key,apiserver.key,apiserver-etcd-client.crt<span style="color:#f92672">}</span> ~/
$ kubeadm init phase certs all
$ cd /etc/kubernetes/
$ mv <span style="color:#f92672">{</span>admin.conf,controller-manager.conf,kubelet.conf,scheduler.conf<span style="color:#f92672">}</span> ~/
$ kubeadm init phase kubeconfig all
$ reboot
$ cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</code></pre></div><h4 id="å…­-failed-to-run-kubelet-unable-to-load-bootstrap-kubeconfig-stat-etckubernetesbootstrap-kubeletconf-no-such-file">å…­ã€ failed to run Kubelet: unable to load bootstrap kubeconfig: stat /etc/kubernetes/bootstrap-kubelet.conf: no such file</h4>
<ul>
<li>å‘ç”Ÿåœºæ™¯ï¼šé€šè¿‡<code>systemctl status kubelet</code>æŸ¥çœ‹ kubelet çŠ¶æ€æ—¶å‘ç°é”™è¯¯</li>
<li>é—®é¢˜ç°è±¡ï¼š<code>failed to run Kubelet: unable to load bootstrap kubeconfig: stat /etc/kubernetes/bootstrap-kubelet.conf: no such file</code></li>
<li>é—®é¢˜åŸå› ï¼šè¿˜æœªåˆå§‹åŒ–</li>
<li>è§£å†³æ–¹æ¡ˆï¼šåˆå§‹åŒ–æ‰§è¡Œ<code>kubeadm init</code>å°±å¥½äº†</li>
</ul>
<h4 id="ä¸ƒ-the-connection-to-the-server-localhost8080-was-refused---did-you-specify-the-right-host-or-port">ä¸ƒã€ The connection to the server localhost:8080 was refused - did you specify the right host or port?</h4>
<ul>
<li>å‘ç”Ÿåœºæ™¯ï¼šæ‰§è¡Œ<code>kubectl get nodes</code>æŠ¥é”™</li>
<li>é—®é¢˜ç°è±¡ï¼šæç¤ºé”™è¯¯<code>The connection to the server localhost:8080 was refused - did you specify the right host or port?</code></li>
<li>é—®é¢˜åŸå› ï¼šéœ€è¦é…ç½® kubectl</li>
<li>è§£å†³æ–¹æ¡ˆï¼šé…ç½®ä¸€ä¸‹ kubectl</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl --kubeconfig /etc/kubernetes/admin.conf get nodes
<span style="color:#75715e"># å¦‚æœæ˜¯ä»èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦ä» master æŠŠ admin.conf ä¼ é€è¿‡å»</span>
<span style="color:#75715e"># scp /etc/kubernetes/admin.conf root@kube-worker-01:/etc/kubernetes/admin.conf</span>
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown <span style="color:#66d9ef">$(</span>id -u<span style="color:#66d9ef">)</span>:<span style="color:#66d9ef">$(</span>id -g<span style="color:#66d9ef">)</span> $HOME/.kube/config
kubectl get nodes
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># ç»“æœ</span>
NAME             STATUS     ROLES                  AGE   VERSION
kube-master-01   NotReady   control-plane,master   18m   v1.22.1
</code></pre></div><h4 id="å…«-container-runtime-network-not-ready-networkreadyfalse-reasonnetworkpluginnotready-messagedocker-network-plugin-is-not-ready-cni-config-uninitialized">å…«ã€ container runtime network not ready: NetworkReady=false reason:NetworkPluginNotReady; message:docker: network plugin is not ready: cni config uninitialized</h4>
<ul>
<li>å‘ç”Ÿåœºæ™¯ï¼šé€šè¿‡<code>systemctl status kubelet</code>æŸ¥çœ‹ kubelet çŠ¶æ€æ—¶å‘ç°é”™è¯¯</li>
<li>é—®é¢˜ç°è±¡ï¼š<code>container runtime network not ready: NetworkReady=false reason:NetworkPluginNotReady; message:docker: network plugin is not ready: cni config uninitialized</code></li>
<li>é—®é¢˜åŸå› ï¼škubernetes ç½‘ç»œé…ç½®é—®é¢˜</li>
<li>è§£å†³æ–¹æ¡ˆï¼šéœ€è¦é‡ç½®å¹¶<code>kubeadm init</code>éœ€è¦å¸¦å‚æ•°<code>--pod-network-cidr=10.244.0.0/16</code>å¹¶ä¸”ä½¿ç”¨ flannel ä½œä¸ºç½‘ç»œæ•°æ®åŒ…è½¬æ¢</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">echo y | kubeadm reset
kubectl apply -f ~/kube-flannel.yml
</code></pre></div><h4 id="ä¹-no-networks-found-in-etccninetd">ä¹ã€ no networks found in /etc/cni/net.d</h4>
<ul>
<li>å‘ç”Ÿåœºæ™¯ï¼šé€šè¿‡<code>systemctl status kubelet</code>æŸ¥çœ‹ kubelet çŠ¶æ€æ—¶å‘ç°é”™è¯¯</li>
<li>é—®é¢˜ç°è±¡ï¼š<code>no networks found in /etc/cni/net.d</code></li>
<li>é—®é¢˜åŸå› ï¼škubernetes ç½‘ç»œé…ç½®é—®é¢˜</li>
<li>è§£å†³æ–¹æ¡ˆï¼šåˆ é™¤é…ç½®é¡¹</li>
</ul>
<ol>
<li>æ‰§è¡Œå‘½ä»¤</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">vim /var/lib/kubelet/kubeadm-flags.env
</code></pre></div><ol start="2">
<li>
<p>åˆ é™¤å…¶ä¸­çš„<code>--network-plugin=cni</code></p>
</li>
<li>
<p>é‡å¯ kubelet</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">systemctl daemon-reload
systemctl restart kubelet
</code></pre></div><h4 id="å-error-filecontent--proc-sys-net-bridge-bridge-nf-call-iptables-procsysnetbridgebridge-nf-call-iptables-contents-are-not-set-to-1">åã€ [ERROR FileContent&ndash;proc-sys-net-bridge-bridge-nf-call-iptables]: /proc/sys/net/bridge/bridge-nf-call-iptables contents are not set to 1</h4>
<ul>
<li>å‘ç”Ÿåœºæ™¯ï¼šæ‰§è¡Œå‘½ä»¤<code>kubeadm init</code>æ—¶</li>
<li>é—®é¢˜ç°è±¡ï¼šæŠ¥é”™<code>[ERROR FileContent--proc-sys-net-bridge-bridge-nf-call-iptables]: /proc/sys/net/bridge/bridge-nf-call-iptables contents are not set to 1</code></li>
<li>é—®é¢˜åŸå› ï¼šTODO: å¾…è¡¥å……</li>
<li>è§£å†³æ–¹æ¡ˆï¼šTODO: å¾…è¡¥å……</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># å°è¯•ä½¿ç”¨ vi å»ç¼–è¾‘ä½†æ˜¯ä¿å­˜å¤±è´¥ï¼Œé‡‡ç”¨ä¸‹åˆ—çš„ echo å¯ä»¥</span>
echo <span style="color:#e6db74">&#34;1&#34;</span> &gt;/proc/sys/net/bridge/bridge-nf-call-iptables
reboot
</code></pre></div><h4 id="åä¸€-error-unable-to-upgrade-connection-unauthorized">åä¸€ã€ error: unable to upgrade connection: Unauthorized</h4>
<ul>
<li>å‘ç”Ÿåœºæ™¯ï¼šæ‰§è¡Œ<code>kubectl exec -it &lt;PodID&gt; -- bash</code>å¤±è´¥</li>
<li>é—®é¢˜ç°è±¡ï¼šæŠ¥é”™<code>error: unable to upgrade connection: Unauthorized</code></li>
<li>é—®é¢˜åŸå› ï¼šæƒé™é—®é¢˜</li>
<li>è§£å†³æ–¹æ¡ˆï¼šTODO: å¾…è¡¥å……</li>
</ul>
<h4 id="åäºŒ-failed-to-read-pod-ip-from-plugindocker-errcouldnt-find-network-status-for-defaultprivate-theater-service-through-plugin-invalid-network-status-for">åäºŒã€ &ldquo;Failed to read pod IP from plugin/docker&rdquo; err=&ldquo;Couldn&rsquo;t find network status for default/private-theater-service through plugin: invalid network status for&rdquo;</h4>
<ul>
<li>å‘ç”Ÿåœºæ™¯ï¼šTODO: å¾…è¡¥å……</li>
<li>é—®é¢˜ç°è±¡ï¼šTODO: å¾…è¡¥å……</li>
<li>é—®é¢˜åŸå› ï¼šTODO: å¾…è¡¥å……</li>
<li>è§£å†³æ–¹æ¡ˆï¼šTODO: å¾…è¡¥å……</li>
</ul>
<h4 id="åä¸‰-docker0-ä¸-flannel1-ä¸åœ¨ä¸€ä¸ªç½‘æ®µå¯¼è‡´è®¿é—®å¤±è´¥">åä¸‰ã€ docker0 ä¸ flannel.1 ä¸åœ¨ä¸€ä¸ªç½‘æ®µå¯¼è‡´è®¿é—®å¤±è´¥</h4>
<ul>
<li>å‘ç”Ÿåœºæ™¯ï¼šé›†ç¾¤å†…æ— æ³•è®¿é—®åˆ° Podï¼Œç»<code>ifconfig</code>æŸ¥è¯¢å‘ç°docker0 ä¸ flannel.1 ä¸åœ¨ä¸€ä¸ªç½‘æ®µ</li>
<li>é—®é¢˜ç°è±¡ï¼šdocker0 ä¸ flannel.1 ä¸åœ¨ä¸€ä¸ªç½‘æ®µå¯¼è‡´è®¿é—®å¤±è´¥ï¼Œdocker0 ä¸º<code>172.17.0.1</code>ï¼Œflannel.1 ä¸º<code>10.244.3.0</code></li>
<li>é—®é¢˜åŸå› ï¼šæœªçŸ¥</li>
<li>è§£å†³æ–¹æ¡ˆï¼šæœªçŸ¥</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker0: flags<span style="color:#f92672">=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span style="color:#ae81ff">1500</span>
        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255
        inet6 fe80::42:5ff:fe3d:5433  prefixlen <span style="color:#ae81ff">64</span>  scopeid 0x20&lt;link&gt;
        ether 02:42:05:3d:54:33  txqueuelen <span style="color:#ae81ff">0</span>  <span style="color:#f92672">(</span>Ethernet<span style="color:#f92672">)</span>
        RX packets <span style="color:#ae81ff">43</span>  bytes <span style="color:#ae81ff">3991</span> <span style="color:#f92672">(</span>3.8 KiB<span style="color:#f92672">)</span>
        RX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span>  overruns <span style="color:#ae81ff">0</span>  frame <span style="color:#ae81ff">0</span>
        TX packets <span style="color:#ae81ff">75</span>  bytes <span style="color:#ae81ff">6375</span> <span style="color:#f92672">(</span>6.2 KiB<span style="color:#f92672">)</span>
        TX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span> overruns <span style="color:#ae81ff">0</span>  carrier <span style="color:#ae81ff">0</span>  collisions <span style="color:#ae81ff">0</span>

flannel.1: flags<span style="color:#f92672">=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span style="color:#ae81ff">1450</span>
        inet 10.244.3.0  netmask 255.255.255.255  broadcast 0.0.0.0
        inet6 fe80::41a:daff:fea2:45f3  prefixlen <span style="color:#ae81ff">64</span>  scopeid 0x20&lt;link&gt;
        ether 06:1a:da:a2:45:f3  txqueuelen <span style="color:#ae81ff">0</span>  <span style="color:#f92672">(</span>Ethernet<span style="color:#f92672">)</span>
        RX packets <span style="color:#ae81ff">0</span>  bytes <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>0.0 B<span style="color:#f92672">)</span>
        RX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span>  overruns <span style="color:#ae81ff">0</span>  frame <span style="color:#ae81ff">0</span>
        TX packets <span style="color:#ae81ff">0</span>  bytes <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>0.0 B<span style="color:#f92672">)</span>
        TX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">27</span> overruns <span style="color:#ae81ff">0</span>  carrier <span style="color:#ae81ff">0</span>  collisions <span style="color:#ae81ff">0</span>
</code></pre></div>
        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/posts/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes-%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB-copy/"><span>kubernetes cluster running trouble shooting</span></a>
    </div>
    <div class="next">
        
        <a href="/posts/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes-%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4/"><span>kubernetes cluster installation step</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 28280 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>