<!DOCTYPE html>
<html lang="en" class="h-100">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=8080&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>CopyOnWriteArrayList æºç åˆ†æï¼ˆæœªå®Œï¼‰ | Yipsen Ye</title>
<meta name="description" content="ç¤ºä¾‹ public class CopyOnWriteArrayListTest { public List&lt;String&gt; data() { return Stream.generate(() -&gt; &#34;A&#34;).limit(100000).collect(Collectors.toList()); } public void batch() { CopyOnWriteArrayList&lt;String&gt; list = new CopyOnWriteArrayList&lt;&gt;(); List&lt;String&gt; data = data(); long startTime = System.currentTimeMillis(); list.addAll(data()); System.out.println(&#34;cost: &#34; &#43; (System.currentTimeMillis() - startTime) &#43; &#34;ms.&#34;); } public void foreach() { CopyOnWriteArrayList&lt;String&gt; list = new CopyOnWriteArrayList&lt;&gt;(); List&lt;String&gt; data = data(); long startTime = System.currentTimeMillis(); for (String d: data) { list.add(d); } System.out.println(&#34;cost: &#34; &#43; (System.currentTimeMillis() - startTime) &#43; &#34;ms.&#34;); } public static void main(String[] args) { CopyOnWriteArrayListTest test = new CopyOnWriteArrayListTest(); test.batch(); test.foreach(); } } cost: 2ms.cost: 3012ms. æ˜¯ä¸€ä¸ªè¯»å†™åˆ†ç¦»å™¨
">
<meta name="author" content="yipsen">

<link rel="stylesheet" type="text/css" href="/styles/main.css">
<link rel="stylesheet" type="text/css" href="/styles/standard.css">

</head>

<body id="page" class="ff-consolas m-0">
    <header class="d-flex fd-row fw-wrap jc-between ai-center p-x-1 p-y-1 m-auto">
        <div class="nav-logo">
    <a href="http://localhost:8080/">
        
        <span class="nav-title">Yipsen Ye</span>
    </a>
</div>
<nav class="position-relative d-flex fw-wrap jc-end ai-center p-y-05">
    <ul class="d-flex fw-wrap ls-none p-l-0 m-0">
        
        
        <li class="nav-item p-0 m-x-1 m-y-05">
            <a class="nav-link "
                href="http://localhost:8080/series/java/">JAVA</a>
        </li>
        
        <li class="nav-item p-0 m-x-1 m-y-05">
            <a class="nav-link "
                href="http://localhost:8080/design/">è®¾è®¡</a>
        </li>
        
        <li class="nav-item p-0 m-x-1 m-y-05">
            <a class="nav-link "
                href="http://localhost:8080/network/">ç½‘ç»œ</a>
        </li>
        
        <li class="nav-item p-0 m-x-1 m-y-05">
            <a class="nav-link "
                href="http://localhost:8080/framework/">æ¡†æ¶</a>
        </li>
        
        <li class="nav-item p-0 m-x-1 m-y-05">
            <a class="nav-link "
                href="http://localhost:8080/middleware/">ä¸­é—´ä»¶</a>
        </li>
        
        <li class="nav-item p-0 m-x-1 m-y-05">
            <a class="nav-link "
                href="http://localhost:8080/plugin/">æ’ä»¶</a>
        </li>
        
        <li class="nav-item p-0 m-x-1 m-y-05">
            <a class="nav-link "
                href="http://localhost:8080/linux/">LINUX</a>
        </li>
        
        <li class="nav-item p-0 m-x-1 m-y-05">
            <a class="nav-link "
                href="http://localhost:8080/posts/">éšå¿ƒè°ˆ</a>
        </li>
        
        <li class="nav-item p-0 m-x-1 m-y-05">
            <a class="nav-link "
                href="http://localhost:8080/others/">å±±æµ·æ–‡åº“</a>
        </li>
        
        <li class="nav-item p-0 m-x-1 m-y-05">
            <a class="nav-link "
                href="http://localhost:8080/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content" class="m-auto">
        
<aside class="sidebar"><div>
    
    
        
        
        <a href="/categories/java%e5%b9%b6%e5%8f%91/">JAVAå¹¶å‘</a>
        <ul>
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/lock/abstractqueuedsynchronizer-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">AbstractQueuedSynchronizer æºç åˆ†æï¼ˆæœªå®Œï¼‰</a></li>
            
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/lock/reentrantlock-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">ReentrantLock æºç åˆ†æï¼ˆæœªå®Œï¼‰</a></li>
            
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/lock/semaphore-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">Semaphore æºç åˆ†æï¼ˆæœªå®Œï¼‰</a></li>
            
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/lock/reentrantreadwritelock-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">ReentrantReadWriteLock æºç åˆ†æï¼ˆæœªå®Œï¼‰</a></li>
            
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/lock/countdownlatch--%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">CountDownLatch æºç åˆ†æï¼ˆæœªå®Œï¼‰</a></li>
            
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/lock/cyclicbarrier-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">CyclicBarrier æºç åˆ†æï¼ˆæœªå®Œï¼‰</a></li>
            
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/lock/phaser-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">Phaser æºç åˆ†æï¼ˆæœªå®Œï¼‰</a></li>
            
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/lock/exchanger-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">Exchanger æºç åˆ†æï¼ˆæœªå®Œï¼‰</a></li>
            
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/datastructure/blockingqueue-%E5%88%86%E6%9E%90/">BlockingQueue åˆ†æï¼ˆæœªå®Œï¼‰</a></li>
            
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/datastructure/delayqueue-%E4%BD%BF%E7%94%A8%E4%B8%8E%E5%8E%9F%E7%90%86/">DelayQueue ä½¿ç”¨ä¸åŸç†ï¼ˆæœªå®Œï¼‰</a></li>
            
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/datastructure/concurrenthashmap-%E5%88%86%E6%9E%90/">ConcurrentHashMap åˆ†æï¼ˆæœªå®Œï¼‰</a></li>
            
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/datastructure/hashedwheeltimer-%E6%97%B6%E9%97%B4%E8%BD%AE/">HashedWheelTimer æ—¶é—´è½®ï¼ˆæœªå®Œï¼‰</a></li>
            
            
            
            <li>CopyOnWriteArrayList æºç åˆ†æï¼ˆæœªå®Œï¼‰</li>
            
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/future/future-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">Future æºç åˆ†æ</a></li>
            
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/future/scheduledfuture-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">ScheduledFuture æºç åˆ†æ</a></li>
            
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/future/completablefuture-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">CompletableFuture æºç åˆ†æï¼ˆæœªå®Œï¼‰</a></li>
            
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/future/listenablefuture-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">ListenableFuture æºç åˆ†æ</a></li>
            
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/threadpool/threadpoolexecutor-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">ThreadPoolExecutor æºç åˆ†æ</a></li>
            
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/threadpool/scheduledthreadpoolexecutor-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">ScheduledThreadPoolExecutor æºç åˆ†æ</a></li>
            
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/threadpool/forkjoinpool-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">ForkJoinPool æºç åˆ†æï¼ˆæœªå®Œï¼‰</a></li>
            
            
            
            <li><a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/threadpool/completionservice-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">CompletionService æºç åˆ†æï¼ˆæœªå®Œï¼‰</a></li>
            
            
        </ul>
    
</div></aside>
<article>
    <h1 class="m-b-1">CopyOnWriteArrayList æºç åˆ†æï¼ˆæœªå®Œï¼‰</h1>
    <div class="d-flex fd-row jc-center">
        <div class="fc-subtle">
            <span>2022-02-06 16:31:43</span>
        </div>
    </div>
    <div class="post-content">
        <h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CopyOnWriteArrayListTest</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">data</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Stream.<span style="color:#a6e22e">generate</span>(() <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#34;A&#34;</span>).<span style="color:#a6e22e">limit</span>(100000).<span style="color:#a6e22e">collect</span>(Collectors.<span style="color:#a6e22e">toList</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">batch</span>() {
</span></span><span style="display:flex;"><span>        CopyOnWriteArrayList<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> list <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> CopyOnWriteArrayList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>        List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> data <span style="color:#f92672">=</span> data();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">long</span> startTime <span style="color:#f92672">=</span> System.<span style="color:#a6e22e">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>        list.<span style="color:#a6e22e">addAll</span>(data());
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;cost: &#34;</span> <span style="color:#f92672">+</span> (System.<span style="color:#a6e22e">currentTimeMillis</span>() <span style="color:#f92672">-</span> startTime) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;ms.&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">foreach</span>() {
</span></span><span style="display:flex;"><span>        CopyOnWriteArrayList<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> list <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> CopyOnWriteArrayList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>        List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> data <span style="color:#f92672">=</span> data();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">long</span> startTime <span style="color:#f92672">=</span> System.<span style="color:#a6e22e">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (String d: data) {
</span></span><span style="display:flex;"><span>            list.<span style="color:#a6e22e">add</span>(d);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;cost: &#34;</span> <span style="color:#f92672">+</span> (System.<span style="color:#a6e22e">currentTimeMillis</span>() <span style="color:#f92672">-</span> startTime) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;ms.&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        CopyOnWriteArrayListTest test <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> CopyOnWriteArrayListTest();
</span></span><span style="display:flex;"><span>        test.<span style="color:#a6e22e">batch</span>();
</span></span><span style="display:flex;"><span>        test.<span style="color:#a6e22e">foreach</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><pre tabindex="0"><code class="language-log" data-lang="log">cost: 2ms.
cost: 3012ms.
</code></pre><p>æ˜¯ä¸€ä¸ªè¯»å†™åˆ†ç¦»å™¨</p>
<p>æœ‰ä¸¤ä¸ªå…³é”®çš„ç‚¹ï¼š</p>
<ol>
<li>æœ¬ç±»çš„æ‰€æœ‰æ•°æ®å˜æ›´æ“ä½œéƒ½æ˜¯ä½¿ç”¨çš„åŒä¸€æŠŠé”ï¼Œå› æ­¤å¯ä»¥ä¿è¯å¯¹èµ„æºçš„æ”¹åŠ¨æ—¶ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ï¼Œå› æ­¤å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ç›¸å¯¹åº”çš„ vector åˆ™ä¸è¡Œï¼Œå› ä¸º vector è™½ç„¶åœ¨æ¯ä¸ªæ–¹æ³•éƒ½åŠ äº† synchronized å…³é”®å­—æ¥ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ¥è°ƒç”¨<code>åŒä¸€ä¸ªæ–¹æ³•</code>ï¼Œä½†å´æ— æ³•æœç»å¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨ä¸åŒæ–¹æ³•ï¼Œå› æ­¤æ˜¯ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´çš„ï¼Œæ‰€ä»¥ä¸¥æ ¼ä¸Šæ¥è¯´ï¼Œå¯ä»¥è¯´ vector å¹¶ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚æ‰€ä»¥ vector çš„é”æ˜¯æ–¹æ³•ç²’åº¦çš„ï¼Œè€Œæœ¬ç±»çš„é”æ˜¯å¯¹è±¡ç²’åº¦çš„ã€‚å½“ç„¶æˆ‘ä»¬å¯ä»¥æ”¹å†™ vector çš„å®ç°ï¼Œä»å¯¹æ–¹æ³•åŠ  synchronized æ”¹ä¸ºè¿›å…¥æ–¹æ³•åé”ä½æŒ‡å®šçš„ä¸€ä¸ªé”ï¼ˆObjectï¼‰ã€‚</li>
<li>æœ¬ç±»ä»…å¯¹ä¿®æ”¹æ–¹æ³•åšäº†é”çš„æ“ä½œï¼Œå¯¹è¯»å–å´æ˜¯æ”¾å¼€çš„ï¼Œå…¶æ˜¯é€šè¿‡æ¯æ¬¡ä¿®æ”¹æ—¶æ‹·è´ä¸€ä¸ªå‰¯æœ¬ï¼Œå¯¹å‰¯æœ¬è¿›è¡Œä¿®æ”¹ã€‚è€Œè¯»å–æ—¶åˆ™æ˜¯è¯»å–çš„æºæ•°æ®ã€‚å› æ­¤è¯»å–æ²¡æœ‰é”çš„æ§åˆ¶ï¼Œå°†éå¸¸çš„é«˜æ•ˆï¼Œè¿™ä¸ªé«˜æ•ˆå¸¦æ¥çš„ç‰ºç‰²æ˜¯å†™å…¥å˜å¾—éå¸¸æ…¢ï¼Œæ—¢è¦é”æ§åˆ¶ï¼Œä¹Ÿè¦è¿›è¡Œå‰¯æœ¬æ‹·è´æ“ä½œã€‚ç›¸æ¯”ä¹‹ä¸‹ vector è¯»å–ä¹Ÿè¦è¿›è¡Œé”æ“ä½œï¼Œå¯æƒ³è€ŒçŸ¥å¤šçº¿ç¨‹å¹¶å‘è¯»æ—¶ï¼Œå°†é¢‘ç¹è¿›è¡ŒåŠ é”è§£é”æ“ä½œï¼Œéå¸¸è€—æ—¶ã€‚</li>
</ol>

    </div>
</article>
<aside class="catalog">
    <div class="catalog-title">ç›®å½•</div>
    <div class="catalog-list">
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#ç¤ºä¾‹">ç¤ºä¾‹</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</aside>
<div class="division-line"></div>
<div class="misc">
    <div> 
        <a class="post-category" href="/%20categories/java%E5%B9%B6%E5%8F%91/">ğŸ“’JAVAå¹¶å‘</a>
        </div>
    <div></div>
</div>

    </main>
    <footer class="p-x-0 p-b-2 m-auto">
        <div id="pagination">
            
<div class="division-line"></div>
<div class="paginator">
    <div class="prev">
        
        <a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/lock/countdownlatch--%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"><span>CountDownLatch æºç åˆ†æï¼ˆæœªå®Œï¼‰</span></a>
    </div>
    <div class="next">
        
        <a href="http://localhost:8080/java/java-%E5%B9%B6%E5%8F%91/datastructure/concurrenthashmap-%E5%88%86%E6%9E%90/"><span>ConcurrentHashMap åˆ†æï¼ˆæœªå®Œï¼‰</span></a>
    </div>
</div>

        </div>
        <div class="position-fixed b-4 r-4">
            <ul class="float-button-bar">
    <li>
        <button class="float-button top" onclick="scrollToTop(this);">UP</button>
    </li>
    <li>
        <button class="float-button toggler" onclick="changeSkin(this);">DARK</button>
    </li>
</ul>
        </div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 27270 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    

<script src="https://cdn.staticfile.net/gumshoe/5.1.1/gumshoe.min.js"></script>
<script>
    var spy = new Gumshoe('#TableOfContents a', {
        nested: true,
        nestedClass: 'active'
    });
</script>

<script>
    const changeSkin = () => {
        document.getElementById('page').classList.toggle('night');
    }
    const scrollToTop = () => {
        window.scrollTo(0, 0);
    }
</script>
</body>

</html>