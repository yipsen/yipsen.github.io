<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title> | Yipsen Ye</title>
<meta name="description" content="äº’è”ç½‘å¹¶å‘é™æµå®æˆ˜ æœ¬æ–‡ä¸»è¦ä»‹ç»äº’è”ç½‘é™æµç›¸å…³çš„æ¦‚å¿µä¸ç®—æ³•ï¼Œå¹¶ä¸”é™„ä»¥ Java ä»£ç å®ç°ã€‚åŒ…æ‹¬è®¡æ•°å™¨æ³•ã€æ»‘åŠ¨çª—å£è®¡æ•°æ³•ã€æ¼æ–—æ¡¶ç®—æ³•ã€ä»¤ç‰Œæ¡¶ç®—æ³•ã€‚æ–‡æœ«å®ç°ä¸€ä¸ªè‡ªå®šä¹‰é™æµæ³¨è§£ä»¥åŠ AOP é™æµæ‹¦æˆªæ¡†æ¶ã€‚
é™æµç›¸å…³çš„åŸºæœ¬æ¦‚å¿µ åœ¨ä»‹ç»é™æµä¹‹å‰å…ˆä»‹ç»å‡ ä¸ªå®¹æ˜“æ··æ·†çš„æ¦‚å¿µã€‚åŒ…æ‹¬æœåŠ¡ç†”æ–­ã€æœåŠ¡é™çº§ã€æœåŠ¡éš”ç¦»ã€‚
æœåŠ¡ç†”æ–­ ç†è§£ç†”æ–­ä¹‹å‰å…ˆäº†è§£å¦ä¸€ä¸ªæ¦‚å¿µï¼šå¾®æœåŠ¡çš„é›ªå´©æ•ˆåº”ã€‚å› ä¸ºç†”æ–­æœºåˆ¶é€šå¸¸æ˜¯ä½œä¸ºåº”å¯¹é›ªå´©æ•ˆåº”çš„ä¸€ç§å¾®æœåŠ¡é“¾è·¯ä¿æŠ¤æœºåˆ¶ã€‚
åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä¸€ä¸ªå¾®æœåŠ¡é€šå¸¸æ˜¯å®Œæˆä¸€ä¸ªå•ä¸€ä¸šåŠ¡åŠŸèƒ½çš„ç‹¬ç«‹åº”ç”¨ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å„ä¸ªä¸šåŠ¡åŠŸèƒ½ä¹‹é—´æœ€å¤§å¯èƒ½åœ°è§£è€¦ï¼Œæ¯ä¸ªå¾®æœåŠ¡å¯ä»¥ç‹¬ç«‹æ¼”è¿›ã€‚é€šå¸¸ä¸€ä¸ªåº”ç”¨å¯èƒ½ä¼šæœ‰å¾ˆå¤šä¸ªå¾®æœåŠ¡ç»„æˆï¼ŒæœåŠ¡é—´é€šè¿‡ RPC ç›¸äº’è°ƒç”¨ã€‚å‡è®¾æœ‰å¦‚ä¸‹æœåŠ¡è°ƒç”¨é“¾è·¯ï¼š
Aã€B ä¾èµ– C å»è°ƒç”¨ Eã€Fã€‚å¦‚æœ E æœåŠ¡ä¸èƒ½æ­£å¸¸æä¾›æœåŠ¡äº†ï¼ŒC çš„è¶…æ—¶é‡è¯•æœºåˆ¶å°†ä¼šæ‰§è¡Œã€‚åŒæ—¶æ–°çš„è°ƒç”¨ä¸æ–­äº§ç”Ÿï¼Œä¼šå¯¼è‡´ C å¯¹ E æœåŠ¡çš„è°ƒç”¨å¤§é‡çš„ç§¯å‹ï¼Œäº§ç”Ÿå¤§é‡çš„è°ƒç”¨ç­‰å¾…å’Œé‡è¯•è°ƒç”¨ï¼Œæ…¢æ…¢ä¼šè€—å°½ C çš„èµ„æºï¼Œæ¯”å¦‚å†…å­˜æˆ– CPUï¼ŒåŒæ—¶å½±å“ C è°ƒ Fï¼Œæœ€ç»ˆæ•´ä¸ªåº”ç”¨ä¸å¯ç”¨ã€‚æœ¬ä¾‹ä¸­ç”±äºé“¾è·¯ä¸Š E çš„æ•…éšœï¼Œå¯¹å¾®æœåŠ¡ Aã€B çš„è°ƒç”¨å°±ä¼šå ç”¨è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿèµ„æºï¼Œè¿›è€Œå¼•èµ·ç³»ç»Ÿå´©æºƒï¼Œå³æ‰€è°“çš„â€œé›ªå´©æ•ˆåº”â€ã€‚
ç†”æ–­æœºåˆ¶æ˜¯åº”å¯¹é›ªå´©æ•ˆåº”çš„ä¸€ç§å¾®æœåŠ¡é“¾è·¯ä¿æŠ¤æœºåˆ¶ã€‚ç”Ÿæ´»ä¸­æœ‰å¾ˆå¤šç†”æ–­çš„ä¾‹å­ï¼Œæ¯”å¦‚ç”µè·¯ä¸­æŸä¸ªåœ°æ–¹çš„ç”µå‹è¿‡é«˜ï¼Œç†”æ–­å™¨å°±ä¼šç†”æ–­ï¼Œå¯¹ç”µè·¯è¿›è¡Œè¿‡è½½ä¿æŠ¤ã€‚è‚¡å¸‚é‡Œé¢ï¼Œå¦‚æœè‚¡ç¥¨æŒ‡æ•°æ¶¨è·Œå¹…è¿‡é«˜ï¼Œè§¦åŠè®¾ç½®çš„ç†”æ–­ç‚¹æ—¶ï¼Œéšåçš„ä¸€æ®µæ—¶é—´å†…å°†æš‚åœäº¤æ˜“ã€‚å¾®æœåŠ¡æ¶æ„ä¸­çš„ç†”æ–­æœºåˆ¶ä½œç”¨ç±»ä¼¼ã€‚å½“è°ƒç”¨é“¾è·¯çš„æŸä¸ªå¾®æœåŠ¡ä¸å¯ç”¨ã€æˆ–è€…å“åº”æ—¶é—´å¤ªé•¿ã€æˆ–è€…é”™è¯¯æ¬¡æ•°è¾¾åˆ°æŸä¸ªé˜ˆå€¼ï¼Œä¼šè¿›è¡ŒæœåŠ¡ç†”æ–­ï¼Œå³å¿«é€Ÿè¿”å›å“åº”ä¿¡æ¯ã€‚å½“æ£€æµ‹åˆ°è¯¥èŠ‚ç‚¹å¾®æœåŠ¡è°ƒç”¨å“åº”æ­£å¸¸åï¼Œé€æ­¥æ¢å¤æ­£å¸¸çš„è°ƒç”¨é“¾è·¯ã€‚
æœåŠ¡é™çº§ æœåŠ¡é™çº§ä¸»è¦æ˜¯æŒ‡åœ¨æœåŠ¡å™¨å‹åŠ›é™¡å¢çš„æƒ…å†µä¸‹ï¼Œæ ¹æ®æŸç§ç­–ç•¥å¯¹ä¸€äº›éæ ¸å¿ƒæœåŠ¡æˆ–è€…é¡µé¢ä¸åšè¯·æ±‚å¤„ç†æˆ–ç®€å•å¤„ç†ï¼Œä»è€Œé‡Šæ”¾æœåŠ¡å™¨èµ„æºä»¥ä¿è¯æ ¸å¿ƒä¸šåŠ¡æ­£å¸¸è¿ä½œæˆ–é«˜æ•ˆè¿ä½œã€‚æ¯”å¦‚æ¯å¹´çš„åŒåä¸€æ´»åŠ¨æ—¶ï¼Œç”µå•†ç½‘ç«™æŠŠæ— å…³äº¤æ˜“çš„æœåŠ¡é™çº§ï¼Œæ¯”å¦‚æŸ¥çœ‹å†å²è®¢å•ã€å•†å“å†å²è¯„è®ºç­‰ä¸šåŠ¡ï¼Œåªæ˜¾ç¤ºæœ€è¿‘ 100 æ¡ç­‰ç­‰ã€‚
æœåŠ¡éš”ç¦» éš”ç¦»æ˜¯æŒ‡å°†æœåŠ¡æˆ–è€…èµ„æºéš”ç¦»å¼€ã€‚æœåŠ¡éš”ç¦»èƒ½å¤Ÿåœ¨æœåŠ¡å‘ç”Ÿæ•…éšœæ—¶é™å®šå…¶å½±å“èŒƒå›´ï¼Œä¿è¯å…¶å®ƒæœåŠ¡è¿˜æ˜¯å¯ç”¨çš„ã€‚èµ„æºéš”ç¦»ä¸€èˆ¬æ˜¯æŒ‡é€šè¿‡éš”ç¦»æ¥å‡å°‘æœåŠ¡é—´èµ„æºç«äº‰ã€‚èµ„æºéš”ç¦»çš„ç²’åº¦æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚çº¿ç¨‹éš”ç¦»ã€è¿›ç¨‹éš”ç¦»ã€æœºæˆ¿éš”ç¦»ç­‰ã€‚çº¿ç¨‹éš”ç¦»å³éš”ç¦»çº¿ç¨‹æ± èµ„æºï¼Œä¸åŒæœåŠ¡çš„æ‰§è¡Œä½¿ç”¨ä¸åŒçš„çº¿ç¨‹æ± ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å³ä½¿å…¶ä¸­ä¸€ä¸ªæœåŠ¡çº¿ç¨‹æ± æ»¡äº†ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°å…¶ä»–çš„æœåŠ¡ã€‚æ¯”å¦‚ä¸‹å›¾ä¸­ Tomcat å¤„ç†è¯·æ±‚ï¼Œå¯¹æ¯ä¸ªå¾®æœåŠ¡ï¼Œéƒ½åˆ†é…ä¸€ä¸ªçº¿ç¨‹æ± ã€‚
æœåŠ¡é™æµ è¿›å…¥æ­£é¢˜ï¼Œæœ¬ç¯‡ä¸»è¦é˜è¿°çš„æ˜¯æœåŠ¡é™æµã€‚æœåŠ¡é™æµæ˜¯é™åˆ¶è¯·æ±‚çš„æ•°é‡ï¼Œå³æŸä¸ªæ—¶é—´çª—å£å†…çš„è¯·æ±‚é€Ÿç‡ã€‚ä¸€æ—¦è¾¾åˆ°é™åˆ¶é€Ÿç‡åˆ™å¯ä»¥æ‹’ç»æœåŠ¡ï¼ˆå®šå‘åˆ°é”™è¯¯é¡µæˆ–å‘ŠçŸ¥ç³»ç»Ÿå¿™ï¼‰ã€æ’é˜Ÿç­‰å¾…ï¼ˆæ¯”å¦‚ç§’æ€ã€ç”¨æˆ·è¯„è®ºã€ä¸‹å•ï¼‰ã€é™çº§ï¼ˆè¿”å›å…œåº•æ•°æ®æˆ–é»˜è®¤æ•°æ®ï¼‰ã€‚
å„ä¸ªæ¦‚å¿µæ¯”è¾ƒ æœåŠ¡ç†”æ–­ã€æœåŠ¡é™çº§éƒ½æ˜¯ä»ç³»ç»Ÿçš„å¯ç”¨æ€§è§’åº¦è€ƒè™‘ï¼Œé˜²æ­¢ç³»ç»Ÿå“åº”å»¶è¿Ÿç”šè‡³å´©æºƒè€Œé‡‡ç”¨çš„æŠ€æœ¯æ€§çš„ç³»ç»Ÿä¿æŠ¤æ‰‹æ®µã€‚æœåŠ¡ç†”æ–­ä¸€èˆ¬æ˜¯ç”±æŸä¸ªä¸‹æ¸¸æœåŠ¡æ•…éšœå¼•èµ·ï¼Œè€ŒæœåŠ¡é™çº§ä¸€èˆ¬æ˜¯ä»æ•´ä½“ä¸šåŠ¡çš„è´Ÿè½½æƒ…å†µè€ƒè™‘ã€‚é™æµåˆ™æ˜¯å¯¹å•ä½æ—¶é—´å†…è¯·æ±‚æ¬¡æ•°çš„é™åˆ¶ã€‚ä¸‰è€…éƒ½æ˜¯é€šè¿‡æŸç§æ‰‹æ®µä¿è¯æµé‡è¿‡è½½æ—¶ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚æœåŠ¡éš”ç¦»åˆ™æ˜¯è®©ä¸åŒçš„ä¸šåŠ¡ä½¿ç”¨å„è‡ªç‹¬ç«‹çš„çº¿èµ„æºæ± ï¼Œé¿å…æœåŠ¡ä¹‹é—´èµ„æºç«äº‰çš„å½±å“ã€‚
å¸¸è§çš„é™æµæ‰‹æ®µ å¸¸è§çš„é™æµæ‰‹æ®µæœ‰å¦‚ä¸‹è¿™äº›ã€‚é™åˆ¶æ€»çš„è¯·æ±‚å¹¶å‘æ•°ï¼ˆæ¯”å¦‚æ•°æ®åº“è¿æ¥æ± ã€çº¿ç¨‹æ± ï¼‰ã€é™åˆ¶ç¬æ—¶å¹¶å‘æ•°ï¼ˆå¦‚ nginx çš„ limit_conn æ¨¡å—ï¼Œç”¨æ¥é™åˆ¶ç¬æ—¶å¹¶å‘è¿æ¥æ•°ï¼‰ã€é™åˆ¶æŸä¸ªæ—¶é—´çª—å£å†…çš„å¹³å‡é€Ÿç‡ï¼ˆRateLimiterã€nginx çš„ limit_req æ¨¡å—ï¼‰ï¼›æ­¤å¤–è¿˜æœ‰å¦‚é™åˆ¶ RPC è°ƒç”¨é¢‘ç‡ã€é™åˆ¶ MQ çš„æ¶ˆè´¹é€Ÿç‡ç­‰ã€‚
å¸¸ç”¨çš„é™æµç®—æ³• ç®€å•è®¡æ•° è®¡æ•°å™¨ç®—æ³•æ˜¯ä½¿ç”¨è®¡æ•°å™¨åœ¨å‘¨æœŸå†…ç´¯åŠ è®¿é—®æ¬¡æ•°ï¼Œå½“è¾¾åˆ°è®¾å®šçš„é˜ˆå€¼æ—¶ï¼Œè§¦å‘é™æµç­–ç•¥ã€‚ä¸‹ä¸€ä¸ªå‘¨æœŸå¼€å§‹æ—¶ï¼Œè¿›è¡Œæ¸…é›¶ï¼Œé‡æ–°è®¡æ•°ã€‚æ¯”å¦‚ 1 åˆ†é’Ÿå†…é™åˆ¶è¯·æ±‚æ€»æ•°ä¸º 100ã€‚å¦‚æœè¶…è¿‡ 100 åˆ™è¿”å›å¤±è´¥ã€‚
æ»‘åŠ¨çª—å£è®¡æ•° ç®€å•è®¡æ•°ç„¶ç®€å•ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜ï¼Œå³ä¸´ç•Œé—®é¢˜ã€‚æ¯”å¦‚ 1 åˆ†é’Ÿå†…é™åˆ¶è¯·æ±‚æ€»æ•°ä¸º 100 çš„åœºæ™¯ä¸‹ï¼Œå‰ä¸€ä¸ªä¸€åˆ†é’Ÿå†…ç›´åˆ°è¿™ä¸€åˆ†é’Ÿå¿«ç»“æŸçš„æ—¶å€™æ‰æ¥äº† 100 ä¸ªè¯·æ±‚ï¼Œè€Œåä¸€ä¸ªä¸€åˆ†é’Ÿåˆšå¼€å§‹å°±ç«‹å³æ¥äº† 100 ä¸ªè¯·æ±‚ã€‚è™½ç„¶æ˜¯åœ¨ä¸¤ä¸ªä¸åŒçš„ä¸€åˆ†é’ŸåŒºé—´ï¼Œä½†æ˜¯äº‹å®ä¸Šä¸åˆ°ä¸€åˆ†é’Ÿçš„æ—¶é—´å†…ï¼Œæ¥äº† 200 ä¸ªè¯·æ±‚ï¼Œå› æ­¤è®¡æ•°å™¨é™æµå¤±æ•ˆã€‚">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><article class="post-block">
        <h1 class="post-title"></h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;0001-01-01 00:00:00</span></div></div>
        <div class="post-content">
            <h2 id="äº’è”ç½‘å¹¶å‘é™æµå®æˆ˜">äº’è”ç½‘å¹¶å‘é™æµå®æˆ˜</h2>
<p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº’è”ç½‘é™æµç›¸å…³çš„æ¦‚å¿µä¸ç®—æ³•ï¼Œå¹¶ä¸”é™„ä»¥ Java ä»£ç å®ç°ã€‚åŒ…æ‹¬è®¡æ•°å™¨æ³•ã€æ»‘åŠ¨çª—å£è®¡æ•°æ³•ã€æ¼æ–—æ¡¶ç®—æ³•ã€ä»¤ç‰Œæ¡¶ç®—æ³•ã€‚æ–‡æœ«å®ç°ä¸€ä¸ªè‡ªå®šä¹‰é™æµæ³¨è§£ä»¥åŠ AOP é™æµæ‹¦æˆªæ¡†æ¶ã€‚</p>
<h3 id="é™æµç›¸å…³çš„åŸºæœ¬æ¦‚å¿µ">é™æµç›¸å…³çš„åŸºæœ¬æ¦‚å¿µ</h3>
<p>åœ¨ä»‹ç»é™æµä¹‹å‰å…ˆä»‹ç»å‡ ä¸ªå®¹æ˜“æ··æ·†çš„æ¦‚å¿µã€‚åŒ…æ‹¬æœåŠ¡ç†”æ–­ã€æœåŠ¡é™çº§ã€æœåŠ¡éš”ç¦»ã€‚</p>
<h4 id="æœåŠ¡ç†”æ–­">æœåŠ¡ç†”æ–­</h4>
<p>ç†è§£ç†”æ–­ä¹‹å‰å…ˆäº†è§£å¦ä¸€ä¸ªæ¦‚å¿µï¼šå¾®æœåŠ¡çš„é›ªå´©æ•ˆåº”ã€‚å› ä¸ºç†”æ–­æœºåˆ¶é€šå¸¸æ˜¯ä½œä¸ºåº”å¯¹é›ªå´©æ•ˆåº”çš„ä¸€ç§å¾®æœåŠ¡é“¾è·¯ä¿æŠ¤æœºåˆ¶ã€‚</p>
<p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä¸€ä¸ªå¾®æœåŠ¡é€šå¸¸æ˜¯å®Œæˆä¸€ä¸ªå•ä¸€ä¸šåŠ¡åŠŸèƒ½çš„ç‹¬ç«‹åº”ç”¨ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å„ä¸ªä¸šåŠ¡åŠŸèƒ½ä¹‹é—´æœ€å¤§å¯èƒ½åœ°è§£è€¦ï¼Œæ¯ä¸ªå¾®æœåŠ¡å¯ä»¥ç‹¬ç«‹æ¼”è¿›ã€‚é€šå¸¸ä¸€ä¸ªåº”ç”¨å¯èƒ½ä¼šæœ‰å¾ˆå¤šä¸ªå¾®æœåŠ¡ç»„æˆï¼ŒæœåŠ¡é—´é€šè¿‡ RPC ç›¸äº’è°ƒç”¨ã€‚å‡è®¾æœ‰å¦‚ä¸‹æœåŠ¡è°ƒç”¨é“¾è·¯ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/assets/54c95090-d32d-11ea-880c-9db893e02967" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>Aã€B ä¾èµ– C å»è°ƒç”¨ Eã€Fã€‚å¦‚æœ E æœåŠ¡ä¸èƒ½æ­£å¸¸æä¾›æœåŠ¡äº†ï¼ŒC çš„è¶…æ—¶é‡è¯•æœºåˆ¶å°†ä¼šæ‰§è¡Œã€‚åŒæ—¶æ–°çš„è°ƒç”¨ä¸æ–­äº§ç”Ÿï¼Œä¼šå¯¼è‡´ C å¯¹ E æœåŠ¡çš„è°ƒç”¨å¤§é‡çš„ç§¯å‹ï¼Œäº§ç”Ÿå¤§é‡çš„è°ƒç”¨ç­‰å¾…å’Œé‡è¯•è°ƒç”¨ï¼Œæ…¢æ…¢ä¼šè€—å°½ C çš„èµ„æºï¼Œæ¯”å¦‚å†…å­˜æˆ– CPUï¼ŒåŒæ—¶å½±å“ C è°ƒ Fï¼Œæœ€ç»ˆæ•´ä¸ªåº”ç”¨ä¸å¯ç”¨ã€‚æœ¬ä¾‹ä¸­ç”±äºé“¾è·¯ä¸Š E çš„æ•…éšœï¼Œå¯¹å¾®æœåŠ¡ Aã€B çš„è°ƒç”¨å°±ä¼šå ç”¨è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿèµ„æºï¼Œè¿›è€Œå¼•èµ·ç³»ç»Ÿå´©æºƒï¼Œå³æ‰€è°“çš„â€œé›ªå´©æ•ˆåº”â€ã€‚</p>
<p>ç†”æ–­æœºåˆ¶æ˜¯åº”å¯¹é›ªå´©æ•ˆåº”çš„ä¸€ç§å¾®æœåŠ¡é“¾è·¯ä¿æŠ¤æœºåˆ¶ã€‚ç”Ÿæ´»ä¸­æœ‰å¾ˆå¤šç†”æ–­çš„ä¾‹å­ï¼Œæ¯”å¦‚ç”µè·¯ä¸­æŸä¸ªåœ°æ–¹çš„ç”µå‹è¿‡é«˜ï¼Œç†”æ–­å™¨å°±ä¼šç†”æ–­ï¼Œå¯¹ç”µè·¯è¿›è¡Œè¿‡è½½ä¿æŠ¤ã€‚è‚¡å¸‚é‡Œé¢ï¼Œå¦‚æœè‚¡ç¥¨æŒ‡æ•°æ¶¨è·Œå¹…è¿‡é«˜ï¼Œè§¦åŠè®¾ç½®çš„ç†”æ–­ç‚¹æ—¶ï¼Œéšåçš„ä¸€æ®µæ—¶é—´å†…å°†æš‚åœäº¤æ˜“ã€‚å¾®æœåŠ¡æ¶æ„ä¸­çš„ç†”æ–­æœºåˆ¶ä½œç”¨ç±»ä¼¼ã€‚å½“è°ƒç”¨é“¾è·¯çš„æŸä¸ªå¾®æœåŠ¡ä¸å¯ç”¨ã€æˆ–è€…å“åº”æ—¶é—´å¤ªé•¿ã€æˆ–è€…é”™è¯¯æ¬¡æ•°è¾¾åˆ°æŸä¸ªé˜ˆå€¼ï¼Œä¼šè¿›è¡ŒæœåŠ¡ç†”æ–­ï¼Œå³å¿«é€Ÿè¿”å›å“åº”ä¿¡æ¯ã€‚å½“æ£€æµ‹åˆ°è¯¥èŠ‚ç‚¹å¾®æœåŠ¡è°ƒç”¨å“åº”æ­£å¸¸åï¼Œé€æ­¥æ¢å¤æ­£å¸¸çš„è°ƒç”¨é“¾è·¯ã€‚</p>
<h4 id="æœåŠ¡é™çº§">æœåŠ¡é™çº§</h4>
<p>æœåŠ¡é™çº§ä¸»è¦æ˜¯æŒ‡åœ¨æœåŠ¡å™¨å‹åŠ›é™¡å¢çš„æƒ…å†µä¸‹ï¼Œæ ¹æ®æŸç§ç­–ç•¥å¯¹ä¸€äº›éæ ¸å¿ƒæœåŠ¡æˆ–è€…é¡µé¢ä¸åšè¯·æ±‚å¤„ç†æˆ–ç®€å•å¤„ç†ï¼Œä»è€Œé‡Šæ”¾æœåŠ¡å™¨èµ„æºä»¥ä¿è¯æ ¸å¿ƒä¸šåŠ¡æ­£å¸¸è¿ä½œæˆ–é«˜æ•ˆè¿ä½œã€‚æ¯”å¦‚æ¯å¹´çš„åŒåä¸€æ´»åŠ¨æ—¶ï¼Œç”µå•†ç½‘ç«™æŠŠæ— å…³äº¤æ˜“çš„æœåŠ¡é™çº§ï¼Œæ¯”å¦‚æŸ¥çœ‹å†å²è®¢å•ã€å•†å“å†å²è¯„è®ºç­‰ä¸šåŠ¡ï¼Œåªæ˜¾ç¤ºæœ€è¿‘ 100 æ¡ç­‰ç­‰ã€‚</p>
<h4 id="æœåŠ¡éš”ç¦»">æœåŠ¡éš”ç¦»</h4>
<p>éš”ç¦»æ˜¯æŒ‡å°†æœåŠ¡æˆ–è€…èµ„æºéš”ç¦»å¼€ã€‚æœåŠ¡éš”ç¦»èƒ½å¤Ÿåœ¨æœåŠ¡å‘ç”Ÿæ•…éšœæ—¶é™å®šå…¶å½±å“èŒƒå›´ï¼Œä¿è¯å…¶å®ƒæœåŠ¡è¿˜æ˜¯å¯ç”¨çš„ã€‚èµ„æºéš”ç¦»ä¸€èˆ¬æ˜¯æŒ‡é€šè¿‡éš”ç¦»æ¥å‡å°‘æœåŠ¡é—´èµ„æºç«äº‰ã€‚èµ„æºéš”ç¦»çš„ç²’åº¦æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚çº¿ç¨‹éš”ç¦»ã€è¿›ç¨‹éš”ç¦»ã€æœºæˆ¿éš”ç¦»ç­‰ã€‚çº¿ç¨‹éš”ç¦»å³éš”ç¦»çº¿ç¨‹æ± èµ„æºï¼Œä¸åŒæœåŠ¡çš„æ‰§è¡Œä½¿ç”¨ä¸åŒçš„çº¿ç¨‹æ± ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å³ä½¿å…¶ä¸­ä¸€ä¸ªæœåŠ¡çº¿ç¨‹æ± æ»¡äº†ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°å…¶ä»–çš„æœåŠ¡ã€‚æ¯”å¦‚ä¸‹å›¾ä¸­ Tomcat å¤„ç†è¯·æ±‚ï¼Œå¯¹æ¯ä¸ªå¾®æœåŠ¡ï¼Œéƒ½åˆ†é…ä¸€ä¸ªçº¿ç¨‹æ± ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/assets/f105f530-d32d-11ea-a0a4-91ded31f57b1" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h4 id="æœåŠ¡é™æµ">æœåŠ¡é™æµ</h4>
<p>è¿›å…¥æ­£é¢˜ï¼Œæœ¬ç¯‡ä¸»è¦é˜è¿°çš„æ˜¯æœåŠ¡é™æµã€‚æœåŠ¡é™æµæ˜¯é™åˆ¶è¯·æ±‚çš„æ•°é‡ï¼Œå³æŸä¸ªæ—¶é—´çª—å£å†…çš„è¯·æ±‚é€Ÿç‡ã€‚ä¸€æ—¦è¾¾åˆ°é™åˆ¶é€Ÿç‡åˆ™å¯ä»¥æ‹’ç»æœåŠ¡ï¼ˆå®šå‘åˆ°é”™è¯¯é¡µæˆ–å‘ŠçŸ¥ç³»ç»Ÿå¿™ï¼‰ã€æ’é˜Ÿç­‰å¾…ï¼ˆæ¯”å¦‚ç§’æ€ã€ç”¨æˆ·è¯„è®ºã€ä¸‹å•ï¼‰ã€é™çº§ï¼ˆè¿”å›å…œåº•æ•°æ®æˆ–é»˜è®¤æ•°æ®ï¼‰ã€‚</p>
<h4 id="å„ä¸ªæ¦‚å¿µæ¯”è¾ƒ">å„ä¸ªæ¦‚å¿µæ¯”è¾ƒ</h4>
<p>æœåŠ¡ç†”æ–­ã€æœåŠ¡é™çº§éƒ½æ˜¯ä»ç³»ç»Ÿçš„å¯ç”¨æ€§è§’åº¦è€ƒè™‘ï¼Œé˜²æ­¢ç³»ç»Ÿå“åº”å»¶è¿Ÿç”šè‡³å´©æºƒè€Œé‡‡ç”¨çš„æŠ€æœ¯æ€§çš„ç³»ç»Ÿä¿æŠ¤æ‰‹æ®µã€‚æœåŠ¡ç†”æ–­ä¸€èˆ¬æ˜¯ç”±æŸä¸ªä¸‹æ¸¸æœåŠ¡æ•…éšœå¼•èµ·ï¼Œè€ŒæœåŠ¡é™çº§ä¸€èˆ¬æ˜¯ä»æ•´ä½“ä¸šåŠ¡çš„è´Ÿè½½æƒ…å†µè€ƒè™‘ã€‚é™æµåˆ™æ˜¯å¯¹å•ä½æ—¶é—´å†…è¯·æ±‚æ¬¡æ•°çš„é™åˆ¶ã€‚ä¸‰è€…éƒ½æ˜¯é€šè¿‡æŸç§æ‰‹æ®µä¿è¯æµé‡è¿‡è½½æ—¶ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚æœåŠ¡éš”ç¦»åˆ™æ˜¯è®©ä¸åŒçš„ä¸šåŠ¡ä½¿ç”¨å„è‡ªç‹¬ç«‹çš„çº¿èµ„æºæ± ï¼Œé¿å…æœåŠ¡ä¹‹é—´èµ„æºç«äº‰çš„å½±å“ã€‚</p>
<h3 id="å¸¸è§çš„é™æµæ‰‹æ®µ">å¸¸è§çš„é™æµæ‰‹æ®µ</h3>
<p>å¸¸è§çš„é™æµæ‰‹æ®µæœ‰å¦‚ä¸‹è¿™äº›ã€‚é™åˆ¶æ€»çš„è¯·æ±‚å¹¶å‘æ•°ï¼ˆæ¯”å¦‚æ•°æ®åº“è¿æ¥æ± ã€çº¿ç¨‹æ± ï¼‰ã€é™åˆ¶ç¬æ—¶å¹¶å‘æ•°ï¼ˆå¦‚ nginx çš„ limit_conn æ¨¡å—ï¼Œç”¨æ¥é™åˆ¶ç¬æ—¶å¹¶å‘è¿æ¥æ•°ï¼‰ã€é™åˆ¶æŸä¸ªæ—¶é—´çª—å£å†…çš„å¹³å‡é€Ÿç‡ï¼ˆRateLimiterã€nginx çš„ limit_req æ¨¡å—ï¼‰ï¼›æ­¤å¤–è¿˜æœ‰å¦‚é™åˆ¶ RPC è°ƒç”¨é¢‘ç‡ã€é™åˆ¶ MQ çš„æ¶ˆè´¹é€Ÿç‡ç­‰ã€‚</p>
<h3 id="å¸¸ç”¨çš„é™æµç®—æ³•">å¸¸ç”¨çš„é™æµç®—æ³•</h3>
<h4 id="ç®€å•è®¡æ•°">ç®€å•è®¡æ•°</h4>
<p>è®¡æ•°å™¨ç®—æ³•æ˜¯ä½¿ç”¨è®¡æ•°å™¨åœ¨å‘¨æœŸå†…ç´¯åŠ è®¿é—®æ¬¡æ•°ï¼Œå½“è¾¾åˆ°è®¾å®šçš„é˜ˆå€¼æ—¶ï¼Œè§¦å‘é™æµç­–ç•¥ã€‚ä¸‹ä¸€ä¸ªå‘¨æœŸå¼€å§‹æ—¶ï¼Œè¿›è¡Œæ¸…é›¶ï¼Œé‡æ–°è®¡æ•°ã€‚æ¯”å¦‚ 1 åˆ†é’Ÿå†…é™åˆ¶è¯·æ±‚æ€»æ•°ä¸º 100ã€‚å¦‚æœè¶…è¿‡ 100 åˆ™è¿”å›å¤±è´¥ã€‚</p>
<h4 id="æ»‘åŠ¨çª—å£è®¡æ•°">æ»‘åŠ¨çª—å£è®¡æ•°</h4>
<p>ç®€å•è®¡æ•°ç„¶ç®€å•ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜ï¼Œå³ä¸´ç•Œé—®é¢˜ã€‚æ¯”å¦‚ 1 åˆ†é’Ÿå†…é™åˆ¶è¯·æ±‚æ€»æ•°ä¸º 100 çš„åœºæ™¯ä¸‹ï¼Œå‰ä¸€ä¸ªä¸€åˆ†é’Ÿå†…ç›´åˆ°è¿™ä¸€åˆ†é’Ÿå¿«ç»“æŸçš„æ—¶å€™æ‰æ¥äº† 100 ä¸ªè¯·æ±‚ï¼Œè€Œåä¸€ä¸ªä¸€åˆ†é’Ÿåˆšå¼€å§‹å°±ç«‹å³æ¥äº† 100 ä¸ªè¯·æ±‚ã€‚è™½ç„¶æ˜¯åœ¨ä¸¤ä¸ªä¸åŒçš„ä¸€åˆ†é’ŸåŒºé—´ï¼Œä½†æ˜¯äº‹å®ä¸Šä¸åˆ°ä¸€åˆ†é’Ÿçš„æ—¶é—´å†…ï¼Œæ¥äº† 200 ä¸ªè¯·æ±‚ï¼Œå› æ­¤è®¡æ•°å™¨é™æµå¤±æ•ˆã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/assets/c424bdc0-d32e-11ea-8a86-ed86f9ad27de" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>æ»‘åŠ¨çª—å£ç®—æ³•æ˜¯å°†æ—¶é—´å‘¨æœŸè¿›ä¸€æ­¥åˆ’åˆ†ä¸º N ä¸ªå°å‘¨æœŸï¼Œåˆ†åˆ«è®°å½•æ¯ä¸ªå°å‘¨æœŸå†…è®¿é—®æ¬¡æ•°ï¼Œå¹¶ä¸”æ ¹æ®æ—¶é—´æ»‘åŠ¨åˆ é™¤è¿‡æœŸçš„å°å‘¨æœŸã€‚ å¦‚ä¸‹å›¾ï¼Œå‡è®¾æ—¶é—´å‘¨æœŸä¸º 1minï¼Œå°† 1min å†åˆ†ä¸º 6 ä¸ªå°å‘¨æœŸï¼Œç»Ÿè®¡æ¯ä¸ªå°å‘¨æœŸçš„è®¿é—®æ•°é‡ã€‚å¦‚æœç¬¬ 6 ä¸ªå°å‘¨æœŸå†…ï¼Œè®¿é—®æ•°é‡ä¸º 100ï¼Œåˆ°äº†ç¬¬ 7 ä¸ªå°å‘¨æœŸå†…ï¼Œè®¿é—®æ•°é‡ä¹Ÿä¸º 100ï¼Œé‚£ä¹ˆ å³è§¦å‘æ»‘åŠ¨çª—å£(çº¢è‰²è™šçº¿æ¡†å‡º)å†…çš„è®¿é—®æ¬¡æ•°é™åˆ¶ã€‚ç”±æ­¤å¯è§ï¼Œæ»‘åŠ¨çª—å£çš„å•ä½åŒºé—´åˆ’åˆ†è¶Šå¤šï¼Œæ»‘åŠ¨çª—å£çš„æ»šåŠ¨å°±è¶Šå¹³æ»‘ï¼Œé™æµç»Ÿè®¡å°±ä¼šè¶Šç²¾ç¡®ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/assets/e1bb3440-d32e-11ea-a0a4-91ded31f57b1" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h4 id="æ¼æ–—æ¡¶">æ¼æ–—æ¡¶</h4>
<p>æ¼æ–—æ¡¶ç®—æ³•é¡¾åæ€ä¹‰ï¼Œç®—æ³•å†…éƒ¨æœ‰ä¸€ä¸ªå®¹å™¨ï¼Œç±»ä¼¼ç”Ÿæ´»ä¸­çš„æ¼æ–—ã€‚å½“è¯·æ±‚è¿›æ¥æ—¶ï¼Œç›¸å½“äºæ°´å€’å…¥æ¼æ–—ï¼Œç„¶åä»ä¸‹æ–¹å‡ºæ°´å£åŒ€é€Ÿæµå‡ºã€‚ä¸ç®¡è¿›æ°´é€Ÿç‡å¦‚ä½•å¢å‡ï¼Œå‡ºæ°´é€Ÿç‡å§‹ç»ˆä¿æŒä¸€è‡´ï¼Œç›´åˆ°æ¼æ¡¶ä¸ºç©ºã€‚ç”±äºè¿›æ°´é€Ÿåº¦æœªçŸ¥ï¼Œçªå‘æµé‡æ¥ä¸åŠå¤„ç†å°±ä¼šåœ¨æ¡¶ä¸­ç´¯ç§¯ã€‚å¦‚æœçªç ´äº†æ¡¶å®¹é‡å°±ä¼šæº¢å‡ºï¼Œå³ä¸¢å¼ƒè¯·æ±‚ã€‚æ¼æ–—æ¡¶çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/assets/078b8850-d32f-11ea-a750-5174bd44fffd" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h4 id="ä»¤ç‰Œæ¡¶">ä»¤ç‰Œæ¡¶</h4>
<p>ä»¤ç‰Œæ¡¶ç®—æ³•æŸç§ç¨‹åº¦ä¸Šæ˜¯å¯¹æ¼æ–—æ¡¶ç®—æ³•çš„æ”¹è¿›ã€‚ä»¤ç‰Œæ¡¶èƒ½å¤Ÿåœ¨é™åˆ¶è¯·æ±‚å¹³å‡é€Ÿç‡çš„åŒæ—¶è¿˜å…è®¸ä¸€å®šç¨‹åº¦çš„çªå‘è°ƒç”¨ã€‚åœ¨ä»¤ç‰Œæ¡¶ç®—æ³•ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªæ¡¶ï¼Œç”¨æ¥å­˜æ”¾å›ºå®šæ•°é‡çš„ä»¤ç‰Œã€‚è¯¥ç®—æ³•ä»¥ä¸€å®šçš„é€Ÿç‡å¾€æ¡¶ä¸­æ”¾å…¥ä»¤ç‰Œã€‚æ¯æ¬¡è¯·æ±‚éœ€è¦å…ˆè·å–åˆ°æ¡¶ä¸­çš„ä»¤ç‰Œæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™ç­‰å¾…å¯ç”¨çš„ä»¤ç‰Œï¼Œæˆ–è€…ç›´æ¥æ‹’ç»ã€‚</p>
<p>æ”¾ä»¤ç‰Œçš„åŠ¨ä½œæ˜¯æŒç»­ä¸æ–­è¿›è¡Œçš„ï¼Œå¦‚æœæ¡¶ä¸­ä»¤ç‰Œæ•°è¾¾åˆ°ä¸Šé™ï¼Œåˆ™ä¸¢å¼ƒä»¤ç‰Œï¼Œå› æ­¤æ¡¶ä¸­å¯èƒ½ä¸€ç›´æŒæœ‰å¤§é‡çš„å¯ç”¨ä»¤ç‰Œã€‚æ­¤æ—¶è¯·æ±‚è¿›æ¥å¯ä»¥ç›´æ¥æ‹¿åˆ°ä»¤ç‰Œæ‰§è¡Œã€‚æ¯”å¦‚è®¾ç½® qps ä¸º 100ï¼Œé‚£ä¹ˆé™æµå™¨åˆå§‹åŒ–å®Œæˆ 1 ç§’åï¼Œæ¡¶ä¸­å°±å·²ç»æœ‰ 100 ä¸ªä»¤ç‰Œäº†ï¼Œå¦‚æœæ­¤å‰è¿˜æ²¡æœ‰è¯·æ±‚è¿‡æ¥ï¼Œè¿™æ—¶çªç„¶æ¥äº† 100 ä¸ªè¯·æ±‚ï¼Œè¯¥é™æµå™¨å¯ä»¥æŠµæŒ¡ç¬æ—¶çš„ 100 ä¸ªè¯·æ±‚ã€‚ç”±æ­¤å¯è§ï¼Œåªæœ‰æ¡¶ä¸­æ²¡æœ‰ä»¤ç‰Œæ—¶ï¼Œè¯·æ±‚æ‰ä¼šè¿›è¡Œç­‰å¾…ï¼Œæœ€ç»ˆè¡¨ç°çš„æ•ˆæœå³ä¸ºä»¥ä¸€å®šçš„é€Ÿç‡æ‰§è¡Œã€‚ä»¤ç‰Œæ¡¶çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/assets/40703300-d32f-11ea-938e-f5ee97dc461f" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>é™¤äº†åœ¨åº”ç”¨å±‚é™æµå¤–ä¹Ÿå¯ä»¥åœ¨ç½‘ç»œå±‚é™æµï¼Œæ¯”å¦‚é€šè¿‡ nginx çš„é™æµæ¨¡å—è®¾ç½®å•ä¸ªå®¢æˆ·ç«¯ IP çš„è®¿é—®é™åˆ¶ç­‰ï¼Œä¸åœ¨æœ¬æ–‡è®¨è®ºèŒƒå›´å†…ã€‚</p>
<h3 id="å¸¸ç”¨çš„é™æµç®—æ³•-java-å®ç°">å¸¸ç”¨çš„é™æµç®—æ³• Java å®ç°</h3>
<h4 id="å·¥ç¨‹æ¦‚è§ˆ">å·¥ç¨‹æ¦‚è§ˆ</h4>
<p><img src="http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/assets/d5a4ea60-d32f-11ea-ad5f-9fce25eeda58" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h4 id="åŸºäº-redis-çš„ç®€å•è®¡æ•°æ³•">åŸºäº Redis çš„ç®€å•è®¡æ•°æ³•</h4>
<h5 id="æ–°å»º-spring-boot-å·¥ç¨‹å¹¶å¼•å…¥ä¾èµ–"><strong>æ–°å»º Spring Boot å·¥ç¨‹å¹¶å¼•å…¥ä¾èµ–</strong></h5>
<pre tabindex="0"><code>&lt;properties&gt;
    &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;spring.version&gt;2.3.1.RELEASE&lt;/spring.version&gt;
&lt;/properties&gt;

&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;
        &lt;artifactId&gt;spring-data-redis&lt;/artifactId&gt;
        &lt;version&gt;${spring.version}&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;
        &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;
        &lt;version&gt;2.8.0&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;io.lettuce&lt;/groupId&gt;
        &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt;
        &lt;version&gt;5.3.2.RELEASE&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre><h5 id="é…ç½®-applicationproperties"><strong>é…ç½® application.properties</strong></h5>
<pre tabindex="0"><code>server.port=8888
# Redis æ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º 0ï¼‰
spring.redis.database=0
# Redis æœåŠ¡å™¨åœ°å€
spring.redis.host=127.0.0.1
# Redis æœåŠ¡å™¨è¿æ¥ç«¯å£
spring.redis.port=6379
# Redis æœåŠ¡å™¨è¿æ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰
spring.redis.password=
# è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰
spring.redis.jedis.pool.max-active=20
# è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰
spring.redis.jedis.pool.max-wait=1000
# è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥
spring.redis.jedis.pool.max-idle=10
# è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥
spring.redis.jedis.pool.min-idle=0
# è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
spring.redis.timeout=2000
</code></pre><h5 id="ç¼–å†™-rediscountlimit"><strong>ç¼–å†™ RedisCountLimit</strong></h5>
<p>åŸºäº redis çš„ incr æœºåˆ¶</p>
<pre tabindex="0"><code>import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.stereotype.Component;
import java.time.LocalTime;
import java.util.concurrent.TimeUnit;

/
 * è®¡æ•°æ³•é™æµ
 */
@Component
public class RedisCountLimit {
    public static final String KEY = &quot;ratelimit_&quot;;
    public static final int LIMIT = 10;

    @Autowired
    StringRedisTemplate redisTemplate;

    public boolean triggerLimit(String reqPath) {
        String redisKey = KEY + reqPath;
        Long count = redisTemplate.opsForValue().increment(redisKey, 1);
        System.out.println(LocalTime.now() + &quot; &quot; + reqPath + &quot; &quot; + count);
        if (count != null &amp;&amp; count == 1) {
            redisTemplate.expire(redisKey, 60, TimeUnit.SECONDS);
        }
        //é˜²æ­¢å‡ºç°å¹¶å‘æ“ä½œæœªè®¾ç½®è¶…æ—¶æ—¶é—´çš„åœºæ™¯,è¿™æ · key å°±æ˜¯æ°¸ä¸è¿‡æœŸ,å­˜åœ¨é£é™©
        if (redisTemplate.getExpire(redisKey, TimeUnit.SECONDS) == -1) {
            redisTemplate.expire(redisKey, 60, TimeUnit.SECONDS);
        }

        if (count &gt; LIMIT) {
            System.out.println(LocalTime.now() + &quot; &quot; + reqPath + &quot; count is:&quot; + count + &quot;,è§¦å‘é™æµ&quot;);
            return true;
        }

        return false;
    }
}
</code></pre><h5 id="controller-å±‚é›†æˆ"><strong>Controller å±‚é›†æˆ</strong></h5>
<pre tabindex="0"><code>import com.bigbird.ratelimit.rediscount.RedisCountLimit;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.servlet.http.HttpServletRequest;
import java.time.LocalDateTime;

/
 * åŸºäº redis çš„è®¡æ•°å™¨é™æµ demo
 */
@RestController
public class RedisCountLimitController {
    @Autowired
    RedisCountLimit redisCountLimit;

    @RequestMapping(&quot;/rediscount&quot;)
    public String redisCount(HttpServletRequest request) {
        String servletPath = request.getServletPath();
        boolean triggerLimit = redisCountLimit.triggerLimit(servletPath);
        if (triggerLimit) {
            return LocalDateTime.now() + &quot; &quot; + servletPath + &quot; ç³»ç»Ÿå¿™ï¼Œç¨åå†è¯•&quot;;
        } else {
            return LocalDateTime.now() + &quot; &quot; + servletPath + &quot;è¯·æ±‚æˆåŠŸ&quot;;
        }
    }

    @RequestMapping(&quot;/rediscount2&quot;)
    public String redisCount2(HttpServletRequest request) {
        String servletPath = request.getServletPath();
        boolean triggerLimit = redisCountLimit.triggerLimit(servletPath);
        if (triggerLimit) {
            return LocalDateTime.now() + &quot; &quot; + servletPath + &quot; ç³»ç»Ÿå¿™ï¼Œç¨åå†è¯•&quot;;
        } else {
            return LocalDateTime.now() + &quot; &quot; + servletPath + &quot;è¯·æ±‚æˆåŠŸ&quot;;
        }
    }
}
</code></pre><h5 id="è¿è¡Œæµ‹è¯•"><strong>è¿è¡Œæµ‹è¯•</strong></h5>
<p>å¯åŠ¨ Spring Boot å·¥ç¨‹ï¼Œç¡®ä¿ Redis å·²è¿è¡Œï¼Œæµè§ˆå™¨è®¿é—®ï¼Œf5 å¤šåˆ·æ–°å‡ æ¬¡ï¼š</p>
<ul>
<li>http://localhost:8888/rediscount</li>
<li>http://localhost:8888/rediscount2</li>
</ul>
<h4 id="åŸºäº-redis-çš„æ»‘åŠ¨çª—å£è®¡æ•°æ³•">åŸºäº Redis çš„æ»‘åŠ¨çª—å£è®¡æ•°æ³•</h4>
<h5 id="ç¼–å†™-redisslidingcountlimit"><strong>ç¼–å†™ RedisSlidingCountLimit</strong></h5>
<p>é€šè¿‡ Redis çš„ zset æ•°æ®ç»“æ„ï¼š</p>
<pre tabindex="0"><code>import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.stereotype.Component;

import java.time.LocalTime;
import java.util.UUID;

/
 * æ»‘åŠ¨çª—å£è®¡æ•°æ³•é™æµ
 */
@Component
public class RedisSlidingCountLimit {
    public static final String KEY = &quot;slidelimit_&quot;;
    public static final int LIMIT = 10;
    //é™æµæ—¶é—´é—´éš”(ç§’)
    public static final int PERIOD = 60;

    @Autowired
    StringRedisTemplate redisTemplate;

    public boolean triggerLimit(String reqPath) {
        String redisKey = KEY + reqPath;

        if (redisTemplate.hasKey(redisKey)) {
            Integer count = redisTemplate.opsForZSet().rangeByScore(redisKey, System.currentTimeMillis() - PERIOD * 1000, System.currentTimeMillis()).size();
            System.out.println(count);
            if (count != null &amp;&amp; count &gt; LIMIT) {
                System.out.println(LocalTime.now() + &quot; &quot; + reqPath + &quot; count is:&quot; + count + &quot;,è§¦å‘é™æµ&quot;);
                return true;
            }
        }

        long currentTime = System.currentTimeMillis();
        redisTemplate.opsForZSet().add(redisKey, UUID.randomUUID().toString(), currentTime);
        // æ¸…é™¤æ—§çš„è®¿é—®æ•°æ®,æ¯”å¦‚ period=60s æ—¶,æ ‡è¯†æ¸…é™¤ 60s ä»¥å‰çš„è®°å½•
        redisTemplate.opsForZSet().removeRangeByScore(redisKey, 0, System.currentTimeMillis() - PERIOD * 1000);
        return false;
    }
}
</code></pre><h5 id="controller-å±‚é›†æˆ-1"><strong>Controller å±‚é›†æˆ</strong></h5>
<pre tabindex="0"><code>import com.bigbird.ratelimit.rediscount.RedisSlidingCountLimit;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.servlet.http.HttpServletRequest;
import java.time.LocalDateTime;

/
 * åŸºäº Redis çš„æ»‘åŠ¨çª—å£è®¡æ•°å™¨é™æµ demo
 */
@RestController
public class RedisSlidingCountLimitController {
    @Autowired
    RedisSlidingCountLimit redisSlidingCountLimit;

    @RequestMapping(&quot;/slidecount&quot;)
    public String redisCount(HttpServletRequest request) {
        String servletPath = request.getServletPath();
        boolean triggerLimit = redisSlidingCountLimit.triggerLimit(servletPath);
        if (triggerLimit) {
            return LocalDateTime.now() + &quot; &quot; + servletPath + &quot; ç³»ç»Ÿå¿™ï¼Œç¨åå†è¯•&quot;;
        } else {
            return LocalDateTime.now() + &quot; &quot; + servletPath + &quot;è¯·æ±‚æˆåŠŸ&quot;;
        }
    }

    @RequestMapping(&quot;/slidecount2&quot;)
    public String redisCount2(HttpServletRequest request) {
        String servletPath = request.getServletPath();
        boolean triggerLimit = redisSlidingCountLimit.triggerLimit(servletPath);
        if (triggerLimit) {
            return LocalDateTime.now() + &quot; &quot; + servletPath + &quot; ç³»ç»Ÿå¿™ï¼Œç¨åå†è¯•&quot;;
        } else {
            return LocalDateTime.now() + &quot; &quot; + servletPath + &quot;è¯·æ±‚æˆåŠŸ&quot;;
        }
    }
}
</code></pre><h5 id="è¿è¡Œæµ‹è¯•-1"><strong>è¿è¡Œæµ‹è¯•</strong></h5>
<p>å¯åŠ¨ Spring Boot å·¥ç¨‹ï¼Œç¡®ä¿ Redis å·²è¿è¡Œï¼Œè®¿é—®ï¼š</p>
<ul>
<li>http://localhost:8888/slidecount</li>
<li>http://localhost:8888/slidecount2</li>
</ul>
<h4 id="æ¼æ–—æ¡¶ç®—æ³•å®ç°">æ¼æ–—æ¡¶ç®—æ³•å®ç°</h4>
<h5 id="ç¼–å†™-leakybucket"><strong>ç¼–å†™ LeakyBucket</strong></h5>
<pre tabindex="0"><code>import java.time.LocalTime;

/
 * æ¼æ–—æ¡¶ç®—æ³•é™æµ
 */
public class LeakyBucket {
    /
     * æ¯ç§’å¤„ç†æ•°é‡(å‡ºæ°´é€Ÿç‡)
     */
    private int rate;

    /
     * æ¡¶å®¹é‡
     */
    private int capacity;

    /
     * å½“å‰æ°´é‡
     */
    private int water;

    /
     * æœ€ååˆ·æ–°æ—¶é—´
     */
    private long refreshTime;

    public LeakyBucket(int rate, int capacity) {
        this.capacity = capacity;
        this.rate = rate;
    }

    private void refreshWater() {
        long now = System.currentTimeMillis();
        water = (int) Math.max(0, water - (now - refreshTime) / 1000 * rate);
        refreshTime = now;
    }

    public synchronized boolean triggerLimit(String reqPath) {
        refreshWater();
        if (water &lt; capacity) {
            water++;
            System.out.println(LocalTime.now() + &quot; &quot; + reqPath + &quot; current capacity is:&quot; + (capacity - water) + &quot;,water is:&quot; + water + &quot;,è¯·æ±‚æˆåŠŸ&quot;);
            return false;
        } else {
            System.out.println(LocalTime.now() + &quot; &quot; + reqPath + &quot; current capacity is:&quot; + (capacity - water) + &quot;,water is:&quot; + water + &quot;,è§¦å‘é™æµ&quot;);
            return true;
        }
    }
}
</code></pre><h5 id="controller-å±‚é›†æˆ-2"><strong>Controller å±‚é›†æˆ</strong></h5>
<pre tabindex="0"><code>import com.bigbird.ratelimit.leakybucket.LeakyBucket;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.servlet.http.HttpServletRequest;
import java.time.LocalDateTime;

/
 * æ¼æ–—æ¡¶ç®—æ³•é™æµ demo
 */
@RestController
public class LeakyBucketLimitController {
    LeakyBucket bucket1 = new LeakyBucket(2, 10);
    LeakyBucket bucket2 = new LeakyBucket(2, 20);

    @RequestMapping(&quot;/leakyBucket1&quot;)
    public String leakyBucket1(HttpServletRequest request) {
        String servletPath = request.getServletPath();
        boolean triggerLimit = bucket1.triggerLimit(servletPath);
        if (triggerLimit) {
            return LocalDateTime.now() + &quot; &quot; + servletPath + &quot; ç³»ç»Ÿå¿™ï¼Œç¨åå†è¯•&quot;;
        } else {
            return LocalDateTime.now() + &quot; &quot; + servletPath + &quot;è¯·æ±‚æˆåŠŸ&quot;;
        }
    }

    @RequestMapping(&quot;/leakyBucket2&quot;)
    public String leakyBucket2(HttpServletRequest request) {
        String servletPath = request.getServletPath();
        boolean triggerLimit = bucket2.triggerLimit(servletPath);
        if (triggerLimit) {
            return LocalDateTime.now() + &quot; &quot; + servletPath + &quot; ç³»ç»Ÿå¿™ï¼Œç¨åå†è¯•&quot;;
        } else {
            return LocalDateTime.now() + &quot; &quot; + servletPath + &quot;è¯·æ±‚æˆåŠŸ&quot;;
        }
    }
}
</code></pre><h5 id="è¿è¡Œæµ‹è¯•-2"><strong>è¿è¡Œæµ‹è¯•</strong></h5>
<p>å¯åŠ¨ Spring Boot å·¥ç¨‹ï¼Œæµè§ˆå™¨è®¿é—®ä¸‹åˆ—åœ°å€ï¼Œè¿ç»­ f5 å¤šåˆ·æ–°æµ‹è¯•</p>
<ul>
<li>http://localhost:8888/leakyBucket1</li>
<li>http://localhost:8888/leakyBucket2</li>
</ul>
<h4 id="ä»¤ç‰Œæ¡¶ç®—æ³•å®ç°">ä»¤ç‰Œæ¡¶ç®—æ³•å®ç°</h4>
<p>åŸºäº Guava RateLimiter å®ç°ã€‚</p>
<h5 id="å¼•å…¥ä¾èµ–"><strong>å¼•å…¥ä¾èµ–</strong></h5>
<pre tabindex="0"><code>&lt;dependency&gt;
    &lt;groupId&gt;com.google.guava&lt;/groupId&gt;
    &lt;artifactId&gt;guava&lt;/artifactId&gt;
    &lt;version&gt;29.0-jre&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><h5 id="ç¼–å†™-tokenbucket"><strong>ç¼–å†™ TokenBucket</strong></h5>
<pre tabindex="0"><code>import com.google.common.util.concurrent.RateLimiter;
import java.time.LocalTime;
import java.util.concurrent.TimeUnit;

/
 * ä»¤ç‰Œæ¡¶ç®—æ³•é™æµ
 */
public class TokenBucket {
    /
     * qps,å³æ¯ç§’å¤„ç†æ•°é‡
     */
    private int rate;
    private RateLimiter rateLimiter;

    public TokenBucket(int rate) {
        this.rate = rate;
        this.rateLimiter = RateLimiter.create(rate);
    }

    public boolean triggerLimit(String reqPath) {
        boolean acquireRes = rateLimiter.tryAcquire(500, TimeUnit.MILLISECONDS);
        if (acquireRes) {
            System.out.println(LocalTime.now() + &quot; &quot; + reqPath + &quot;,è¯·æ±‚æˆåŠŸ&quot;);
            return false;
        } else {
            System.out.println(LocalTime.now() + &quot; &quot; + reqPath + &quot;,è§¦å‘é™æµ&quot;);
            return true;
        }
    }
}
</code></pre><h5 id="controller-å±‚é›†æˆ-3"><strong>Controller å±‚é›†æˆ</strong></h5>
<pre tabindex="0"><code>import com.bigbird.ratelimit.tokenbucket.TokenBucket;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.servlet.http.HttpServletRequest;
import java.time.LocalDateTime;

/
 * ä»¤ç‰Œæ¡¶é™æµç®—æ³• demo
 */
@RestController
public class TokenBucketLimitController {
    /
     * æ¯ç§’é’Ÿé™é€Ÿ 1
     */
    TokenBucket bucket1 = new TokenBucket(1);
    /
     * æ¯ç§’é’Ÿé™é€Ÿ 2
     */
    TokenBucket bucket2 = new TokenBucket(2);

    @RequestMapping(&quot;/tokenBucket1&quot;)
    public String leakyBucket1(HttpServletRequest request) {
        String servletPath = request.getServletPath();
        boolean triggerLimit = bucket1.triggerLimit(servletPath);
        if (triggerLimit) {
            return LocalDateTime.now() + &quot; &quot; + servletPath + &quot; ç³»ç»Ÿå¿™ï¼Œç¨åå†è¯•&quot;;
        } else {
            return LocalDateTime.now() + &quot; &quot; + servletPath + &quot;è¯·æ±‚æˆåŠŸ&quot;;
        }
    }

    @RequestMapping(&quot;/tokenBucket2&quot;)
    public String leakyBucket2(HttpServletRequest request) {
        String servletPath = request.getServletPath();
        boolean triggerLimit = bucket2.triggerLimit(servletPath);
        if (triggerLimit) {
            return LocalDateTime.now() + &quot; &quot; + servletPath + &quot; ç³»ç»Ÿå¿™ï¼Œç¨åå†è¯•&quot;;
        } else {
            return LocalDateTime.now() + &quot; &quot; + servletPath + &quot;è¯·æ±‚æˆåŠŸ&quot;;
        }
    }
}
</code></pre><h5 id="è¿è¡Œæµ‹è¯•-3"><strong>è¿è¡Œæµ‹è¯•</strong></h5>
<p>å¯åŠ¨ Spring Boot å·¥ç¨‹ï¼Œæµè§ˆå™¨è®¿é—®ä¸‹åˆ—åœ°å€ï¼Œè¿ç»­ f5 å¤šåˆ·æ–°æµ‹è¯•ï¼š</p>
<ul>
<li>http://localhost:8888/tokenBucket1</li>
<li>http://localhost:8888/tokenBucket2</li>
</ul>
<h4 id="è‡ªå®šä¹‰æ³¨è§£aop-å°è£…é™æµ">è‡ªå®šä¹‰æ³¨è§£ã€AOP å°è£…é™æµ</h4>
<p>ä¸Šè¿°å®ç°æ–¹å¼ç®€å•ç²—æš´ï¼Œå®é™…åº”ç”¨ä¸­å¯ä»¥å°è£…è‡ªå®šä¹‰æ³¨è§£ï¼Œå¹¶é€šè¿‡ AOP å®ç° controller å±‚æ¥å£è‡ªåŠ¨é™æµæ‹¦æˆªã€‚åºŸè¯ä¸å¤šè¯´ï¼Œä¸Šä»£ç ã€‚ä¸‹é¢çš„æ¡ˆä¾‹åŸºäº RateLimiter ä»¤ç‰Œæ¡¶ã€‚å…¶å®ƒç®—æ³•è¯»è€…å¯ä»¥å‚è€ƒæ­¤ä¾‹è‡ªè¡Œå°è£…ã€‚</p>
<h5 id="å¼•å…¥ä¾èµ–-1"><strong>å¼•å…¥ä¾èµ–</strong></h5>
<pre tabindex="0"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><h5 id="ç¼–å†™è‡ªå®šä¹‰æ³¨è§£"><strong>ç¼–å†™è‡ªå®šä¹‰æ³¨è§£</strong></h5>
<pre tabindex="0"><code>import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

@Target(value = ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface ExtRateLimiter {
    double permitsPerSecond();

    long timeout();
}
</code></pre><h5 id="ç¼–å†™-aop-åˆ‡é¢"><strong>ç¼–å†™ AOP åˆ‡é¢</strong></h5>
<pre tabindex="0"><code>import com.bigbird.ratelimit.annotation.ExtRateLimiter;
import com.google.common.util.concurrent.RateLimiter;
import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Pointcut;
import org.aspectj.lang.reflect.MethodSignature;
import org.springframework.stereotype.Component;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.io.PrintWriter;
import java.lang.reflect.Method;
import java.time.LocalTime;
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.TimeUnit;

/
 * å°è£…åŸºäº RateLimiter çš„é™æµæ³¨è§£
 */
@Component
@Aspect
public class RateLimiterAop {

    /
     * ä¿å­˜æ¥å£è·¯å¾„å’Œé™æµå™¨çš„å¯¹åº”å…³ç³»
     */
    private ConcurrentHashMap&lt;String, RateLimiter&gt; rateLimiters = new ConcurrentHashMap();

    @Pointcut(&quot;execution(public * com.bigbird.ratelimit.controller.*.*(..))&quot;)
    public void rateLimiterAop() {
    }

    /
     * ä½¿ç”¨ç¯ç»•é€šçŸ¥æ‹¦æˆªæ‰€æœ‰ Controller è¯·æ±‚
     *
     * @param proceedingJoinPoint
     * @return
     */
    @Around(&quot;rateLimiterAop()&quot;)
    public Object doBefore(ProceedingJoinPoint proceedingJoinPoint) throws Throwable {
        MethodSignature signature = (MethodSignature) proceedingJoinPoint.getSignature();
        Method method = signature.getMethod();
        if (method == null) {
            return null;
        }

        ExtRateLimiter extRateLimiter = method.getDeclaredAnnotation(ExtRateLimiter.class);
        if (extRateLimiter == null) {
            return proceedingJoinPoint.proceed();
        }

        double permitsPerSecond = extRateLimiter.permitsPerSecond();
        long timeout = extRateLimiter.timeout();

        ServletRequestAttributes requestAttributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
        String requestURI = requestAttributes.getRequest().getRequestURI();
        RateLimiter rateLimiter = rateLimiters.get(requestURI);
        if (rateLimiter == null) {
            rateLimiter = RateLimiter.create(permitsPerSecond);
            RateLimiter rateLimiterPrevious = rateLimiters.putIfAbsent(requestURI, rateLimiter);
            if (rateLimiterPrevious != null) {
                rateLimiter = rateLimiterPrevious;
            }
        }

        boolean tryAcquire = rateLimiter.tryAcquire(timeout, TimeUnit.MILLISECONDS);
        if (!tryAcquire) {
            System.out.println(LocalTime.now() + &quot; &quot; + requestURI + &quot; è§¦å‘é™æµ&quot;);
            doFallback();
            return null;
        }

        System.out.println(LocalTime.now() + &quot; &quot; + requestURI + &quot; è¯·æ±‚æˆåŠŸ&quot;);
        return proceedingJoinPoint.proceed();
    }

    private void doFallback() {
        ServletRequestAttributes requestAttributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
        HttpServletResponse response = requestAttributes.getResponse();
        response.setContentType(&quot;text/html;charset=UTF-8&quot;);
        PrintWriter writer = null;
        try {
            writer = response.getWriter();
            writer.println(&quot;ç³»ç»Ÿå¿™ï¼Œè¯·ç¨åå†è¯•ï¼&quot;);
        } catch (IOException e) {
            e.printStackTrace();
        } finally {
            writer.close();
        }
    }
}
</code></pre><h5 id="controller-å±‚é›†æˆ-4"><strong>Controller å±‚é›†æˆ</strong></h5>
<p>å¯¹è¦é™æµçš„æ¥å£åŠ  ExtRateLimiter æ³¨è§£è®¾ç½®ï¼š</p>
<pre tabindex="0"><code>import com.bigbird.ratelimit.annotation.ExtRateLimiter;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.servlet.http.HttpServletRequest;
import java.time.LocalTime;

/
 * è‡ªå®šä¹‰æ³¨è§£æ ‡è¯†æ¥å£è¿›è¡Œé™æµ
 */
@RestController
public class ExtRateLimiterController {
    @RequestMapping(&quot;/extRate1&quot;)
    @ExtRateLimiter(permitsPerSecond = 0.5, timeout = 500)
    public String extRate1(HttpServletRequest request) {
        return LocalTime.now() + &quot; &quot; + request.getRequestURI() + &quot;è¯·æ±‚æˆåŠŸ&quot;;
    }

    @RequestMapping(&quot;/extRate2&quot;)
    @ExtRateLimiter(permitsPerSecond = 2, timeout = 500)
    public String extRate2(HttpServletRequest request) {
        return LocalTime.now() + &quot; &quot; + request.getRequestURI() + &quot;è¯·æ±‚æˆåŠŸ&quot;;
    }
}
</code></pre><h5 id="è¿è¡Œæµ‹è¯•-4"><strong>è¿è¡Œæµ‹è¯•</strong></h5>
<p>å¯åŠ¨ Spring Boot å·¥ç¨‹ï¼Œæµè§ˆå™¨è®¿é—®ä¸‹åˆ—åœ°å€ï¼Œè¿ç»­ f5 å¤šåˆ·æ–°æµ‹è¯•ï¼š</p>
<ul>
<li>http://localhost:8888/extRate1</li>
<li>http://localhost:8888/extRate2</li>
</ul>
<h3 id="å°ç»“">å°ç»“</h3>
<p>æœ¬æ–‡é€šä¿—æ˜“æ‡‚åœ°ä»‹ç»äº†äº’è”ç½‘é™æµç›¸å…³çš„æ¦‚å¿µä¸ç®—æ³•ï¼Œå¹¶ä¸”é™„ä»¥ Java ä»£ç å®ç°ã€‚åŒ…æ‹¬è®¡æ•°å™¨æ³•ã€æ»‘åŠ¨çª—å£è®¡æ•°æ³•ã€æ¼æ–—æ¡¶ç®—æ³•ã€ä»¤ç‰Œæ¡¶ç®—æ³•ã€‚æœ€åå°è£…äº†ä¸€ä¸ªè‡ªå®šä¹‰é™æµæ³¨è§£ä»¥åŠ AOP æ‹¦æˆªæ¥å£é™æµã€‚è¯»è€…é€šè¿‡å¯¹æœ¬æ–‡çš„å­¦ä¹ å¯ä»¥å¿«é€Ÿä¸Šæ‰‹é™æµç®—æ³•å®ç°ï¼Œåº”ç”¨åˆ°å®é™…å·¥ä½œä¸­ã€‚</p>
<p>ä»£ç ä¸‹è½½åœ°å€ï¼š</p>
<blockquote>
<p><a href="https://github.com/bigbirditedu/learn-ratelimit">https://github.com/bigbirditedu/learn-ratelimit</a></p>
</blockquote>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/articles/%E4%BB%8Ereentrantlock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8Baqs%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8.md/"><span></span></a>
    </div>
    <div class="next">
        
        <a href="/documents/articles/snowflake-%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95%E7%94%9F%E6%88%90%E5%88%86%E5%B8%83%E5%BC%8F-id.md/"><span></span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 27270 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>