<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title> | Yipsen Ye</title>
<meta name="description" content="å®˜æ–¹æ‰‹å†Œ:https://dev.mysql.com/doc/refman/5.7/en/server-logs.html
ä¸ç®¡æ˜¯å“ªä¸ªæ•°æ®åº“äº§å“ï¼Œä¸€å®šä¼šæœ‰æ—¥å¿—æ–‡ä»¶ã€‚åœ¨MariaDB/MySQLä¸­ï¼Œä¸»è¦æœ‰5ç§æ—¥å¿—æ–‡ä»¶ï¼š 1.é”™è¯¯æ—¥å¿—(error log)ï¼šè®°å½•mysqlæœåŠ¡çš„å¯åœæ—¶æ­£ç¡®å’Œé”™è¯¯çš„ä¿¡æ¯ï¼Œè¿˜è®°å½•å¯åŠ¨ã€åœæ­¢ã€è¿è¡Œè¿‡ç¨‹ä¸­çš„é”™è¯¯ä¿¡æ¯ã€‚ 2.æŸ¥è¯¢æ—¥å¿—(general log)ï¼šè®°å½•å»ºç«‹çš„å®¢æˆ·ç«¯è¿æ¥å’Œæ‰§è¡Œçš„è¯­å¥ã€‚ 3.äºŒè¿›åˆ¶æ—¥å¿—(bin log)ï¼šè®°å½•æ‰€æœ‰æ›´æ”¹æ•°æ®çš„è¯­å¥ï¼Œå¯ç”¨äºæ•°æ®å¤åˆ¶ã€‚ 4.æ…¢æŸ¥è¯¢æ—¥å¿—(slow log)ï¼šè®°å½•æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡long_query_timeçš„æ‰€æœ‰æŸ¥è¯¢æˆ–ä¸ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢ã€‚ 5.ä¸­ç»§æ—¥å¿—(relay log)ï¼šä¸»ä»å¤åˆ¶æ—¶ä½¿ç”¨çš„æ—¥å¿—ã€‚
é™¤äº†è¿™5ç§æ—¥å¿—ï¼Œåœ¨éœ€è¦çš„æ—¶å€™è¿˜ä¼šåˆ›å»ºDDLæ—¥å¿—ã€‚æœ¬æ–‡æš‚å…ˆè®¨è®ºé”™è¯¯æ—¥å¿—ã€ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—ã€æ…¢æŸ¥è¯¢æ—¥å¿—å’ŒäºŒè¿›åˆ¶æ—¥å¿—ï¼Œä¸­ç»§æ—¥å¿—å’Œä¸»ä»å¤åˆ¶æœ‰å…³ï¼Œå°†åœ¨å¤åˆ¶çš„ç« èŠ‚ä¸­ä»‹ç»ã€‚ä¸‹ä¸€ç¯‡æ–‡ç« å°†ä»‹ç»innodbäº‹åŠ¡æ—¥å¿—ï¼Œè§ï¼šMySQLçš„äº‹åŠ¡æ—¥å¿—ã€‚
1.æ—¥å¿—åˆ·æ–°æ“ä½œ ä»¥ä¸‹æ“ä½œä¼šåˆ·æ–°æ—¥å¿—æ–‡ä»¶ï¼Œåˆ·æ–°æ—¥å¿—æ–‡ä»¶æ—¶ä¼šå…³é—­æ—§çš„æ—¥å¿—æ–‡ä»¶å¹¶é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ã€‚å¯¹äºæœ‰äº›æ—¥å¿—ç±»å‹ï¼Œå¦‚äºŒè¿›åˆ¶æ—¥å¿—ï¼Œåˆ·æ–°æ—¥å¿—ä¼šæ»šåŠ¨æ—¥å¿—æ–‡ä»¶ï¼Œè€Œä¸ä»…ä»…æ˜¯å…³é—­å¹¶é‡æ–°æ‰“å¼€ã€‚
mysql&amp;gt; FLUSH LOGS; shell&amp;gt; mysqladmin flush-logs shell&amp;gt; mysqladmin refresh 2.é”™è¯¯æ—¥å¿— é”™è¯¯æ—¥å¿—æ˜¯æœ€é‡è¦çš„æ—¥å¿—ä¹‹ä¸€ï¼Œå®ƒè®°å½•äº†MariaDB/MySQLæœåŠ¡å¯åŠ¨å’Œåœæ­¢æ­£ç¡®å’Œé”™è¯¯çš„ä¿¡æ¯ï¼Œè¿˜è®°å½•äº†mysqldå®ä¾‹è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿçš„é”™è¯¯äº‹ä»¶ä¿¡æ¯ã€‚
å¯ä»¥ä½¿ç”¨&amp;quot; &amp;ndash;log-error=[file_name] &amp;ldquo;æ¥æŒ‡å®šmysqldè®°å½•çš„é”™è¯¯æ—¥å¿—æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šfile_nameï¼Œåˆ™é»˜è®¤çš„é”™è¯¯æ—¥å¿—æ–‡ä»¶ä¸ºdatadirç›®å½•ä¸‹çš„ hostname.err ï¼Œhostnameè¡¨ç¤ºå½“å‰çš„ä¸»æœºåã€‚
ä¹Ÿå¯ä»¥åœ¨MariaDB/MySQLé…ç½®æ–‡ä»¶ä¸­çš„mysqldé…ç½®éƒ¨åˆ†ï¼Œä½¿ç”¨log-erroræŒ‡å®šé”™è¯¯æ—¥å¿—çš„è·¯å¾„ã€‚
å¦‚æœä¸çŸ¥é“é”™è¯¯æ—¥å¿—çš„ä½ç½®ï¼Œå¯ä»¥æŸ¥çœ‹å˜é‡log_erroræ¥æŸ¥çœ‹ã€‚
mysql&amp;gt; show variables like &#39;log_error&#39;; &#43;---------------&#43;----------------------------------------&#43; | Variable_name | Value | &#43;---------------&#43;----------------------------------------&#43; | log_error | /var/lib/mysql/node1.longshuai.com.err | &#43;---------------&#43;----------------------------------------&#43; åœ¨MySQL 5.5.7ä¹‹å‰ï¼Œåˆ·æ–°æ—¥å¿—æ“ä½œ(å¦‚flush logs)ä¼šå¤‡ä»½æ—§çš„é”™è¯¯æ—¥å¿—(ä»¥_oldç»“å°¾)ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„é”™è¯¯æ—¥å¿—æ–‡ä»¶å¹¶æ‰“å¼€ï¼Œåœ¨MySQL 5.5.7ä¹‹åï¼Œæ‰§è¡Œåˆ·æ–°æ—¥å¿—çš„æ“ä½œæ—¶ï¼Œé”™è¯¯æ—¥å¿—ä¼šå…³é—­å¹¶é‡æ–°æ‰“å¼€ï¼Œå¦‚æœé”™è¯¯æ—¥å¿—ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå…ˆåˆ›å»ºã€‚
åœ¨MariaDB/MySQLæ­£åœ¨è¿è¡ŒçŠ¶æ€ä¸‹åˆ é™¤é”™è¯¯æ—¥å¿—åï¼Œä¸ä¼šè‡ªåŠ¨åˆ›å»ºé”™è¯¯æ—¥å¿—ï¼Œåªæœ‰åœ¨åˆ·æ–°æ—¥å¿—çš„æ—¶å€™æ‰ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é”™è¯¯æ—¥å¿—æ–‡ä»¶ã€‚
ä»¥ä¸‹æ˜¯MySQL 5.6.35å¯åŠ¨çš„æ—¥å¿—ä¿¡æ¯ã€‚
2017-03-29 01:15:14 2362 [Note] Plugin &#39;FEDERATED&#39; is disabled. 2017-03-29 01:15:14 2362 [Note] InnoDB: Using atomics to ref count buffer pool pages 2017-03-29 01:15:14 2362 [Note] InnoDB: The InnoDB memory heap is disabled 2017-03-29 01:15:14 2362 [Note] InnoDB: Mutexes and rw_locks use GCC atomic builtins 2017-03-29 01:15:14 2362 [Note] InnoDB: Memory barrier is not used 2017-03-29 01:15:14 2362 [Note] InnoDB: Compressed tables use zlib 1.">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><article class="post-block">
        <h1 class="post-title"></h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;0001-01-01 00:00:00</span></div></div>
        <div class="post-content">
            <p>å®˜æ–¹æ‰‹å†Œ:<a href="https://dev.mysql.com/doc/refman/5.7/en/server-logs.html">https://dev.mysql.com/doc/refman/5.7/en/server-logs.html</a></p>
<p>ä¸ç®¡æ˜¯å“ªä¸ªæ•°æ®åº“äº§å“ï¼Œä¸€å®šä¼šæœ‰æ—¥å¿—æ–‡ä»¶ã€‚åœ¨MariaDB/MySQLä¸­ï¼Œä¸»è¦æœ‰5ç§æ—¥å¿—æ–‡ä»¶ï¼š 1.é”™è¯¯æ—¥å¿—(error log)ï¼šè®°å½•mysqlæœåŠ¡çš„å¯åœæ—¶æ­£ç¡®å’Œé”™è¯¯çš„ä¿¡æ¯ï¼Œè¿˜è®°å½•å¯åŠ¨ã€åœæ­¢ã€è¿è¡Œè¿‡ç¨‹ä¸­çš„é”™è¯¯ä¿¡æ¯ã€‚ 2.æŸ¥è¯¢æ—¥å¿—(general log)ï¼šè®°å½•å»ºç«‹çš„å®¢æˆ·ç«¯è¿æ¥å’Œæ‰§è¡Œçš„è¯­å¥ã€‚ 3.äºŒè¿›åˆ¶æ—¥å¿—(bin log)ï¼šè®°å½•æ‰€æœ‰æ›´æ”¹æ•°æ®çš„è¯­å¥ï¼Œå¯ç”¨äºæ•°æ®å¤åˆ¶ã€‚ 4.æ…¢æŸ¥è¯¢æ—¥å¿—(slow log)ï¼šè®°å½•æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡long_query_timeçš„æ‰€æœ‰æŸ¥è¯¢æˆ–ä¸ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢ã€‚ 5.ä¸­ç»§æ—¥å¿—(relay log)ï¼šä¸»ä»å¤åˆ¶æ—¶ä½¿ç”¨çš„æ—¥å¿—ã€‚</p>
<p>é™¤äº†è¿™5ç§æ—¥å¿—ï¼Œåœ¨éœ€è¦çš„æ—¶å€™è¿˜ä¼šåˆ›å»ºDDLæ—¥å¿—ã€‚æœ¬æ–‡æš‚å…ˆè®¨è®ºé”™è¯¯æ—¥å¿—ã€ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—ã€æ…¢æŸ¥è¯¢æ—¥å¿—å’ŒäºŒè¿›åˆ¶æ—¥å¿—ï¼Œä¸­ç»§æ—¥å¿—å’Œä¸»ä»å¤åˆ¶æœ‰å…³ï¼Œå°†åœ¨å¤åˆ¶çš„ç« èŠ‚ä¸­ä»‹ç»ã€‚ä¸‹ä¸€ç¯‡æ–‡ç« å°†ä»‹ç»innodbäº‹åŠ¡æ—¥å¿—ï¼Œè§ï¼š<a href="https://www.cnblogs.com/f-ck-need-u/p/9010872.html">MySQLçš„äº‹åŠ¡æ—¥å¿—</a>ã€‚</p>
<h2 id="1æ—¥å¿—åˆ·æ–°æ“ä½œ">1.æ—¥å¿—åˆ·æ–°æ“ä½œ</h2>
<p>ä»¥ä¸‹æ“ä½œä¼šåˆ·æ–°æ—¥å¿—æ–‡ä»¶ï¼Œåˆ·æ–°æ—¥å¿—æ–‡ä»¶æ—¶ä¼šå…³é—­æ—§çš„æ—¥å¿—æ–‡ä»¶å¹¶é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ã€‚å¯¹äºæœ‰äº›æ—¥å¿—ç±»å‹ï¼Œå¦‚äºŒè¿›åˆ¶æ—¥å¿—ï¼Œåˆ·æ–°æ—¥å¿—ä¼šæ»šåŠ¨æ—¥å¿—æ–‡ä»¶ï¼Œè€Œä¸ä»…ä»…æ˜¯å…³é—­å¹¶é‡æ–°æ‰“å¼€ã€‚</p>
<pre tabindex="0"><code>mysql&gt; FLUSH LOGS;
shell&gt; mysqladmin flush-logs
shell&gt; mysqladmin refresh
</code></pre><h2 id="2é”™è¯¯æ—¥å¿—">2.é”™è¯¯æ—¥å¿—</h2>
<p>é”™è¯¯æ—¥å¿—æ˜¯æœ€é‡è¦çš„æ—¥å¿—ä¹‹ä¸€ï¼Œå®ƒè®°å½•äº†MariaDB/MySQLæœåŠ¡å¯åŠ¨å’Œåœæ­¢æ­£ç¡®å’Œé”™è¯¯çš„ä¿¡æ¯ï¼Œè¿˜è®°å½•äº†mysqldå®ä¾‹è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿçš„é”™è¯¯äº‹ä»¶ä¿¡æ¯ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨&quot; &ndash;log-error=[file_name] &ldquo;æ¥æŒ‡å®šmysqldè®°å½•çš„é”™è¯¯æ—¥å¿—æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šfile_nameï¼Œåˆ™é»˜è®¤çš„é”™è¯¯æ—¥å¿—æ–‡ä»¶ä¸ºdatadirç›®å½•ä¸‹çš„ <code>hostname</code>.err ï¼Œhostnameè¡¨ç¤ºå½“å‰çš„ä¸»æœºåã€‚</p>
<p>ä¹Ÿå¯ä»¥åœ¨MariaDB/MySQLé…ç½®æ–‡ä»¶ä¸­çš„mysqldé…ç½®éƒ¨åˆ†ï¼Œä½¿ç”¨log-erroræŒ‡å®šé”™è¯¯æ—¥å¿—çš„è·¯å¾„ã€‚</p>
<p>å¦‚æœä¸çŸ¥é“é”™è¯¯æ—¥å¿—çš„ä½ç½®ï¼Œå¯ä»¥æŸ¥çœ‹å˜é‡log_erroræ¥æŸ¥çœ‹ã€‚</p>
<pre tabindex="0"><code>mysql&gt; show variables like 'log_error';
+---------------+----------------------------------------+
| Variable_name | Value                                  |
+---------------+----------------------------------------+
| log_error     | /var/lib/mysql/node1.longshuai.com.err |
+---------------+----------------------------------------+
</code></pre><p>åœ¨MySQL 5.5.7ä¹‹å‰ï¼Œåˆ·æ–°æ—¥å¿—æ“ä½œ(å¦‚flush logs)ä¼šå¤‡ä»½æ—§çš„é”™è¯¯æ—¥å¿—(ä»¥_oldç»“å°¾)ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„é”™è¯¯æ—¥å¿—æ–‡ä»¶å¹¶æ‰“å¼€ï¼Œåœ¨MySQL 5.5.7ä¹‹åï¼Œæ‰§è¡Œåˆ·æ–°æ—¥å¿—çš„æ“ä½œæ—¶ï¼Œé”™è¯¯æ—¥å¿—ä¼šå…³é—­å¹¶é‡æ–°æ‰“å¼€ï¼Œå¦‚æœé”™è¯¯æ—¥å¿—ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå…ˆåˆ›å»ºã€‚</p>
<p>åœ¨MariaDB/MySQLæ­£åœ¨è¿è¡ŒçŠ¶æ€ä¸‹åˆ é™¤é”™è¯¯æ—¥å¿—åï¼Œä¸ä¼šè‡ªåŠ¨åˆ›å»ºé”™è¯¯æ—¥å¿—ï¼Œåªæœ‰åœ¨åˆ·æ–°æ—¥å¿—çš„æ—¶å€™æ‰ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é”™è¯¯æ—¥å¿—æ–‡ä»¶ã€‚</p>
<p>ä»¥ä¸‹æ˜¯MySQL 5.6.35å¯åŠ¨çš„æ—¥å¿—ä¿¡æ¯ã€‚</p>
<pre tabindex="0"><code>2017-03-29 01:15:14 2362 [Note] Plugin 'FEDERATED' is disabled.
2017-03-29 01:15:14 2362 [Note] InnoDB: Using atomics to ref count buffer pool pages
2017-03-29 01:15:14 2362 [Note] InnoDB: The InnoDB memory heap is disabled
2017-03-29 01:15:14 2362 [Note] InnoDB: Mutexes and rw_locks use GCC atomic builtins
2017-03-29 01:15:14 2362 [Note] InnoDB: Memory barrier is not used
2017-03-29 01:15:14 2362 [Note] InnoDB: Compressed tables use zlib 1.2.3
2017-03-29 01:15:14 2362 [Note] InnoDB: Using Linux native AIO
2017-03-29 01:15:14 2362 [Note] InnoDB: Using CPU crc32 instructions
2017-03-29 01:15:14 2362 [Note] InnoDB: Initializing buffer pool, size = 128.0M
2017-03-29 01:15:14 2362 [Note] InnoDB: Completed initialization of buffer pool
2017-03-29 01:15:14 2362 [Note] InnoDB: Highest supported file format is Barracuda.
2017-03-29 01:15:14 2362 [Note] InnoDB: 128 rollback segment(s) are active.
2017-03-29 01:15:14 2362 [Note] InnoDB: Waiting for purge to start
2017-03-29 01:15:14 2362 [Note] InnoDB: 5.6.35 started; log sequence number 3911610
2017-03-29 01:15:14 2362 [Note] Server hostname (bind-address): '*'; port: 3306
2017-03-29 01:15:14 2362 [Note] IPv6 is available.
2017-03-29 01:15:14 2362 [Note]   - '::' resolves to '::';
2017-03-29 01:15:14 2362 [Note] Server socket created on IP: '::'.
2017-03-29 01:15:14 2362 [Warning] 'proxies_priv' entry '@ root@xuexi.longshuai.com' ignored in --skip-name-resolve mode.
2017-03-29 01:15:14 2362 [Note] Event Scheduler: Loaded 0 events
2017-03-29 01:15:14 2362 [Note] /usr/local/mysql/bin/mysqld: ready for connections.
Version: '5.6.35'  socket: '/mydata/data/mysql.sock'  port: 3306  MySQL Community Server (GPL)
</code></pre><h2 id="3ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—">3.ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—</h2>
<p>æŸ¥è¯¢æ—¥å¿—åˆ†ä¸ºä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—å’Œæ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œå®ƒä»¬æ˜¯é€šè¿‡æŸ¥è¯¢æ˜¯å¦è¶…å‡ºå˜é‡ long_query_time æŒ‡å®šæ—¶é—´çš„å€¼æ¥åˆ¤å®šçš„ã€‚åœ¨è¶…æ—¶æ—¶é—´å†…å®Œæˆçš„æŸ¥è¯¢æ˜¯ä¸€èˆ¬æŸ¥è¯¢ï¼Œå¯ä»¥å°†å…¶è®°å½•åˆ°ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—ä¸­ï¼Œ<strong>ä½†æ˜¯å»ºè®®å…³é—­è¿™ç§æ—¥å¿—ï¼ˆé»˜è®¤æ˜¯å…³é—­çš„ï¼‰</strong>ï¼Œè¶…å‡ºæ—¶é—´çš„æŸ¥è¯¢æ˜¯æ…¢æŸ¥è¯¢ï¼Œå¯ä»¥å°†å…¶è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚</p>
<p>ä½¿ç”¨&rdquo; &ndash;general_log={0|1} &ldquo;æ¥å†³å®šæ˜¯å¦å¯ç”¨ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—ï¼Œä½¿ç”¨&rdquo; &ndash;general_log_file=file_name &ldquo;æ¥æŒ‡å®šæŸ¥è¯¢æ—¥å¿—çš„è·¯å¾„ã€‚ä¸ç»™å®šè·¯å¾„æ—¶é»˜è®¤çš„æ–‡ä»¶åä»¥ <code>hostname</code>.log å‘½åã€‚</p>
<p>å’ŒæŸ¥è¯¢æ—¥å¿—æœ‰å…³çš„å˜é‡æœ‰ï¼š</p>
<pre tabindex="0"><code>`long_query_time = 10 ``# æŒ‡å®šæ…¢æŸ¥è¯¢è¶…æ—¶æ—¶é•¿ï¼Œè¶…å‡ºæ­¤æ—¶é•¿çš„å±äºæ…¢æŸ¥è¯¢ï¼Œä¼šè®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­``log_output={TABLE|FILE|NONE}  ``# å®šä¹‰ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—å’Œæ…¢æŸ¥è¯¢æ—¥å¿—çš„è¾“å‡ºæ ¼å¼ï¼Œä¸æŒ‡å®šæ—¶é»˜è®¤ä¸ºfile`
</code></pre><p>TABLEè¡¨ç¤ºè®°å½•æ—¥å¿—åˆ°è¡¨ä¸­ï¼ŒFILEè¡¨ç¤ºè®°å½•æ—¥å¿—åˆ°æ–‡ä»¶ä¸­ï¼ŒNONEè¡¨ç¤ºä¸è®°å½•æ—¥å¿—ã€‚åªè¦è¿™é‡ŒæŒ‡å®šä¸ºNONEï¼Œå³ä½¿å¼€å¯äº†ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—å’Œæ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œä¹Ÿéƒ½ä¸ä¼šæœ‰ä»»ä½•è®°å½•ã€‚</p>
<p>å’Œä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—ç›¸å…³çš„å˜é‡æœ‰ï¼š</p>
<pre tabindex="0"><code>`general_log=off ``# æ˜¯å¦å¯ç”¨ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—ï¼Œä¸ºå…¨å±€å˜é‡ï¼Œå¿…é¡»åœ¨globalä¸Šä¿®æ”¹ã€‚``sql_log_off=off ``# åœ¨sessionçº§åˆ«æ§åˆ¶æ˜¯å¦å¯ç”¨ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—ï¼Œé»˜è®¤ä¸ºoffï¼Œå³å¯ç”¨``general_log_file=``/mydata/data/hostname``.log  ``# é»˜è®¤æ˜¯åº“æ–‡ä»¶è·¯å¾„ä¸‹ä¸»æœºååŠ ä¸Š.log`
</code></pre><p>åœ¨MySQL 5.6ä»¥å‰çš„ç‰ˆæœ¬è¿˜æœ‰ä¸€ä¸ª&quot;log&quot;å˜é‡ä¹Ÿæ˜¯å†³å®šæ˜¯å¦å¼€å¯ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—çš„ã€‚åœ¨5.6ç‰ˆæœ¬å¼€å§‹å·²ç»åºŸå¼ƒäº†è¯¥é€‰é¡¹ã€‚</p>
<p>é»˜è®¤æ²¡æœ‰å¼€å¯ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—ï¼Œä¹Ÿä¸å»ºè®®å¼€å¯ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—ã€‚æ­¤å¤„æ‰“å¼€è¯¥ç±»å‹çš„æ—¥å¿—ï¼Œçœ‹çœ‹æ˜¯å¦‚ä½•è®°å½•ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—çš„ã€‚</p>
<p>é¦–å…ˆå¼€å¯ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—ã€‚</p>
<pre tabindex="0"><code>mysql&gt; set @@global.general_log=1;

[root@xuexi data]# ll *.log
-rw-rw---- 1 mysql mysql 5423 Mar 20 16:29 mysqld.log
-rw-rw---- 1 mysql mysql  262 Mar 29 09:31 xuexi.log
</code></pre><p>æ‰§è¡Œå‡ ä¸ªè¯­å¥ã€‚</p>
<pre tabindex="0"><code>mysql&gt; select host,user from mysql.user;
mysql&gt; show variables like &quot;%error%&quot;;
mysql&gt; insert into ttt values(233);
mysql&gt; create table tt(id int);
mysql&gt; set @a:=3;
</code></pre><p>æŸ¥çœ‹ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—çš„å†…å®¹ã€‚</p>
<pre tabindex="0"><code>[root@xuexi data]# cat xuexi.log 
/usr/local/mysql/bin/mysqld, Version: 5.6.35-log (MySQL Community Server (GPL)). started with:
Tcp port: 3306  Unix socket: /mydata/data/mysql.sock
Time                Id Command    Argument
180421 20:04:41     13 Query      select user,host from mysql.user
180421 20:06:06     13 Query      show variables like &quot;%error%&quot;
180421 20:07:28     13 Query      insert into ttt values(233)
180421 20:11:47     13 Query      create table tt(id int)
180421 20:12:29     13 Query      set @a:=3
</code></pre><p>ç”±æ­¤å¯çŸ¥ï¼Œä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—æŸ¥è¯¢çš„ä¸æ­¢æ˜¯selectè¯­å¥ï¼Œå‡ ä¹æ‰€æœ‰çš„è¯­å¥éƒ½ä¼šè®°å½•ã€‚</p>
<h2 id="4æ…¢æŸ¥è¯¢æ—¥å¿—">4.æ…¢æŸ¥è¯¢æ—¥å¿—</h2>
<p>æŸ¥è¯¢è¶…å‡ºå˜é‡ long_query_time æŒ‡å®šæ—¶é—´å€¼çš„ä¸ºæ…¢æŸ¥è¯¢ã€‚ä½†æ˜¯æŸ¥è¯¢è·å–é”(åŒ…æ‹¬é”ç­‰å¾…)çš„æ—¶é—´ä¸è®¡å…¥æŸ¥è¯¢æ—¶é—´å†…ã€‚</p>
<p>mysqlè®°å½•æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯åœ¨æŸ¥è¯¢æ‰§è¡Œå®Œæ¯•ä¸”å·²ç»å®Œå…¨é‡Šæ”¾é”ä¹‹åæ‰è®°å½•çš„ï¼Œå› æ­¤æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•çš„é¡ºåºå’Œæ‰§è¡Œçš„SQLæŸ¥è¯¢è¯­å¥é¡ºåºå¯èƒ½ä¼šä¸ä¸€è‡´(ä¾‹å¦‚è¯­å¥1å…ˆæ‰§è¡Œï¼ŒæŸ¥è¯¢é€Ÿåº¦æ…¢ï¼Œè¯­å¥2åæ‰§è¡Œï¼Œä½†æŸ¥è¯¢é€Ÿåº¦å¿«ï¼Œåˆ™è¯­å¥2å…ˆè®°å½•)ã€‚</p>
<p>æ³¨æ„ï¼ŒMySQL 5.1ä¹‹åå°±æ”¯æŒå¾®ç§’çº§çš„æ…¢æŸ¥è¯¢è¶…æ—¶æ—¶é•¿ï¼Œå¯¹äºDBAæ¥è¯´ï¼Œä¸€ä¸ªæŸ¥è¯¢è¿è¡Œ0.5ç§’å’Œè¿è¡Œ0.05ç§’æ˜¯éå¸¸ä¸åŒçš„ï¼Œå‰è€…å¯èƒ½ç´¢å¼•ä½¿ç”¨é”™è¯¯æˆ–è€…èµ°äº†è¡¨æ‰«æï¼Œåè€…å¯èƒ½ç´¢å¼•ä½¿ç”¨æ­£ç¡®ã€‚</p>
<p>å¦å¤–ï¼ŒæŒ‡å®šçš„æ…¢æŸ¥è¯¢è¶…æ—¶æ—¶é•¿è¡¨ç¤ºçš„æ˜¯è¶…å‡ºè¿™ä¸ªæ—¶é—´çš„æ‰ç®—æ˜¯æ…¢æŸ¥è¯¢ï¼Œç­‰äºè¿™ä¸ªæ—¶é—´çš„ä¸ä¼šè®°å½•ã€‚</p>
<p>å’Œæ…¢æŸ¥è¯¢æœ‰å…³çš„å˜é‡ï¼š</p>
<pre tabindex="0"><code>`long_query_time=10 ``# æŒ‡å®šæ…¢æŸ¥è¯¢è¶…æ—¶æ—¶é•¿(é»˜è®¤10ç§’)ï¼Œè¶…å‡ºæ­¤æ—¶é•¿çš„å±äºæ…¢æŸ¥è¯¢``log_output={TABLE|FILE|NONE} ``# å®šä¹‰ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—å’Œæ…¢æŸ¥è¯¢æ—¥å¿—çš„è¾“å‡ºæ ¼å¼ï¼Œé»˜è®¤ä¸ºfile``log_slow_queries={``yes``|no}    ``# æ˜¯å¦å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œé»˜è®¤ä¸å¯ç”¨``slow_query_log={1|ON|0|OFF}  ``# ä¹Ÿæ˜¯æ˜¯å¦å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæ­¤å˜é‡å’Œlog_slow_queriesä¿®æ”¹ä¸€ä¸ªå¦ä¸€ä¸ªåŒæ—¶å˜åŒ–``slow_query_log_file=``/mydata/data/hostname-slow``.log  ``#é»˜è®¤è·¯å¾„ä¸ºåº“æ–‡ä»¶ç›®å½•ä¸‹ä¸»æœºååŠ ä¸Š-slow.log``log_queries_not_using_indexes=OFF ``# æŸ¥è¯¢æ²¡æœ‰ä½¿ç”¨ç´¢å¼•çš„æ—¶å€™æ˜¯å¦ä¹Ÿè®°å…¥æ…¢æŸ¥è¯¢æ—¥å¿—`
</code></pre><p>ç°åœ¨å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—ã€‚</p>
<pre tabindex="0"><code>mysql&gt; set @@global.slow_query_log=on;
</code></pre><p>å› ä¸ºé»˜è®¤è¶…æ—¶æ—¶é•¿ä¸º10ç§’ï¼Œæ‰€ä»¥è¿›è¡Œä¸€ä¸ª10ç§’çš„æŸ¥è¯¢ã€‚</p>
<pre tabindex="0"><code>mysql&gt; select sleep(10);
</code></pre><p>æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ã€‚è¿™é‡Œçœ‹åˆ°è™½ç„¶sleepäº†10ç§’ï¼Œä½†æ˜¯æœ€åæŸ¥è¯¢æ—¶é—´è¶…å‡ºäº†847å¾®ç§’ï¼Œå› æ­¤è¿™é‡Œä¹Ÿè®°å½•äº†è¯¥æŸ¥è¯¢ã€‚</p>
<pre tabindex="0"><code>[root@xuexi data]# cat xuexi-slow.log 
/usr/local/mysql/bin/mysqld, Version: 5.6.35-log (MySQL Community Server (GPL)). started with:
Tcp port: 3306  Unix socket: /mydata/data/mysql.sock
Time                 Id Command    Argument
# Time: 170329  9:55:58
# User@Host: root[root] @ localhost []  Id:     1
# Query_time: 10.000847  Lock_time: 0.000000 Rows_sent: 1  Rows_examined: 0
use test;
SET timestamp=1490752558;
select sleep(10);
</code></pre><p>éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ä¸­çš„è®°å½•å¯èƒ½ä¼šå˜å¾—éå¸¸å¤šï¼Œè¿™å¯¹äºåˆ†ææŸ¥è¯¢æ¥è¯´æ˜¯éå¸¸å›°éš¾çš„ã€‚å¥½åœ¨æä¾›äº†ä¸€ä¸ªä¸“é—¨å½’ç±»æ…¢æŸ¥è¯¢æ—¥å¿—çš„å·¥å…·mysqldumpslowã€‚</p>
<pre tabindex="0"><code>`[root@xuexi data]``# mysqldumpslow --help``  ``-d           debug ``  ``-``v`           `verboseï¼šæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯``  ``-t NUM       just show the ``top` `n queriesï¼šä»…æ˜¾ç¤ºå‰næ¡æŸ¥è¯¢``  ``-a           don``'t abstract all numbers to N and strings to '``S'ï¼šå½’ç±»æ—¶ä¸è¦ä½¿ç”¨Næ›¿æ¢æ•°å­—ï¼ŒSæ›¿æ¢å­—ç¬¦ä¸²``  ``-g PATTERN   ``grep``: only consider stmts that include this stringï¼šé€šè¿‡``grep``æ¥ç­›é€‰``select``è¯­å¥ã€‚`
</code></pre><p>è¯¥å·¥å…·å½’ç±»çš„æ—¶å€™ï¼Œé»˜è®¤ä¼šå°†<strong>åŒæ–‡æœ¬ä½†å˜é‡å€¼ä¸åŒçš„æŸ¥è¯¢è¯­å¥è§†ä¸ºåŒä¸€ç±»ï¼Œå¹¶ä½¿ç”¨Nä»£æ›¿å…¶ä¸­çš„æ•°å€¼å˜é‡ï¼Œä½¿ç”¨Sä»£æ›¿å…¶ä¸­çš„å­—ç¬¦ä¸²å˜é‡</strong>ã€‚å¯ä»¥ä½¿ç”¨-aæ¥ç¦ç”¨è¿™ç§æ›¿æ¢ã€‚å¦‚ï¼š</p>
<pre tabindex="0"><code>[root@xuexi data]# mysqldumpslow xuexi-slow.log 
Reading mysql slow query log from xuexi-slow.log
Count: 1  Time=10.00s (10s)  Lock=0.00s (0s)  Rows=1.0 (1), root[root]@localhost
  select sleep(N)

[root@xuexi data]#  mysqldumpslow -a xuexi-slow.log   
Reading mysql slow query log from xuexi-slow.log
Count: 1  Time=10.00s (10s)  Lock=0.00s (0s)  Rows=1.0 (1), root[root]@localhost
  select sleep(10)
</code></pre><p>æ˜¾ç„¶ï¼Œè¿™é‡Œå½’ç±»åçš„ç»“æœåªæ˜¯ç²¾ç¡®åˆ°0.01ç§’çš„ï¼Œå¦‚æœæƒ³è¦æ˜¾ç¤ºåŠå…¶ç²¾ç¡®çš„ç§’æ•°ï¼Œåˆ™ä½¿ç”¨-dé€‰é¡¹å¯ç”¨è°ƒè¯•åŠŸèƒ½ã€‚</p>
<pre tabindex="0"><code>[root@xuexi data]#  mysqldumpslow -d xuexi-slow.log   
Reading mysql slow query log from xuexi-slow.log
[[/usr/local/mysql/bin/mysqld, Version: 5.6.35-log (MySQL Community Server (GPL)). started with:
Tcp port: 3306  Unix socket: /mydata/data/mysql.sock
Time                 Id Command    Argument
# Time: 170329  9:55:58
# User@Host: root[root] @ localhost []  Id:     1
# Query_time: 10.000847  Lock_time: 0.000000 Rows_sent: 1  Rows_examined: 0
use test;
SET timestamp=1490752558;
select sleep(10);
]]
&lt;&lt;&gt;&gt;
&lt;&lt;# Time: 170329  9:55:58
# User@Host: root[root] @ localhost []  Id:     1
# Query_time: 10.000847  Lock_time: 0.000000 Rows_sent: 1  Rows_examined: 0
use test;
SET timestamp=1490752558;
select sleep(10);
&gt;&gt; at /usr/local/mysql/bin/mysqldumpslow line 97, &lt;&gt; chunk 1.
[[# Time: 170329  9:55:58
# User@Host: root[root] @ localhost []  Id:     1
# Query_time: 10.000847  Lock_time: 0.000000 Rows_sent: 1  Rows_examined: 0
use test;
SET timestamp=1490752558;
select sleep(10);
]]
{{  select sleep(N)}}

Count: 1  Time=10.00s (10s)  Lock=0.00s (0s)  Rows=1.0 (1), root[root]@localhost
  select sleep(N)
</code></pre><p>æ…¢æŸ¥è¯¢åœ¨SQLè¯­å¥è°ƒä¼˜çš„æ—¶å€™éå¸¸æœ‰ç”¨ï¼Œåº”è¯¥å°†å®ƒå¯ç”¨èµ·æ¥ï¼Œä¸”åº”è¯¥è®©æ…¢æŸ¥è¯¢é˜ˆå€¼å°½é‡å°ï¼Œä¾‹å¦‚1ç§’ç”šè‡³ä½äº1ç§’ã€‚å°±åƒä¸€å¤©æ‰§è¡Œä¸Šåƒæ¬¡çš„1ç§’è¯­å¥ï¼Œå’Œä¸€å¤©æ‰§è¡Œå‡ æ¬¡çš„20ç§’è¯­å¥ï¼Œæ˜¾ç„¶æ›´å€¼å¾—å»ä¼˜åŒ–è¿™ä¸ª1ç§’çš„è¯­å¥ã€‚</p>
<h2 id="5äºŒè¿›åˆ¶æ—¥å¿—">5.äºŒè¿›åˆ¶æ—¥å¿—</h2>
<h2 id="51-äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶">5.1 äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶</h2>
<p>äºŒè¿›åˆ¶æ—¥å¿—åŒ…å«äº†<strong>å¼•èµ·æˆ–å¯èƒ½å¼•èµ·æ•°æ®åº“æ”¹å˜</strong>(å¦‚deleteè¯­å¥ä½†æ²¡æœ‰åŒ¹é…è¡Œ)çš„äº‹ä»¶ä¿¡æ¯ï¼Œä½†ç»ä¸ä¼šåŒ…æ‹¬selectå’Œshowè¿™æ ·çš„æŸ¥è¯¢è¯­å¥ã€‚è¯­å¥ä»¥&quot;äº‹ä»¶&quot;çš„å½¢å¼ä¿å­˜ï¼Œæ‰€ä»¥åŒ…å«äº†æ—¶é—´ã€äº‹ä»¶å¼€å§‹å’Œç»“æŸä½ç½®ç­‰ä¿¡æ¯ã€‚</p>
<p>äºŒè¿›åˆ¶æ—¥å¿—æ˜¯<strong>ä»¥äº‹ä»¶å½¢å¼è®°å½•çš„ï¼Œä¸æ˜¯äº‹åŠ¡æ—¥å¿—****(****ä½†å¯èƒ½æ˜¯åŸºäºäº‹åŠ¡æ¥è®°å½•äºŒè¿›åˆ¶æ—¥å¿—)</strong>ï¼Œä¸ä»£è¡¨å®ƒåªè®°å½•innodbæ—¥å¿—ï¼Œmyisamè¡¨ä¹Ÿä¸€æ ·æœ‰äºŒè¿›åˆ¶æ—¥å¿—ã€‚</p>
<p>å¯¹äºäº‹åŠ¡è¡¨çš„æ“ä½œï¼ŒäºŒè¿›åˆ¶æ—¥å¿—<strong>åªåœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™ä¸€æ¬¡æ€§å†™å…¥****(<strong><strong>åŸºäºäº‹åŠ¡çš„innodb</strong></strong>äºŒè¿›åˆ¶æ—¥å¿—)ï¼Œæäº¤å‰çš„æ¯ä¸ªäºŒè¿›åˆ¶æ—¥å¿—è®°å½•éƒ½å…ˆcacheï¼Œæäº¤æ—¶å†™å…¥</strong>ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¯¹äºäº‹åŠ¡è¡¨æ¥è¯´ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­å¯èƒ½åŒ…å«å¤šæ¡äºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶ï¼Œå®ƒä»¬ä¼šåœ¨æäº¤æ—¶ä¸€æ¬¡æ€§å†™å…¥ã€‚è€Œå¯¹äºéäº‹åŠ¡è¡¨çš„æ“ä½œï¼Œæ¯æ¬¡æ‰§è¡Œå®Œè¯­å¥å°±ç›´æ¥å†™å…¥ã€‚</p>
<p>MariaDB/MySQLé»˜è®¤æ²¡æœ‰å¯åŠ¨äºŒè¿›åˆ¶æ—¥å¿—ï¼Œè¦å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—ä½¿ç”¨ &ndash;log-bin=[on|off|file_name] é€‰é¡¹æŒ‡å®šï¼Œå¦‚æœæ²¡æœ‰ç»™å®šfile_nameï¼Œåˆ™é»˜è®¤ä¸ºdatadirä¸‹çš„ä¸»æœºååŠ &rdquo;-bin&quot;ï¼Œå¹¶åœ¨åé¢è·Ÿä¸Šä¸€ä¸²æ•°å­—è¡¨ç¤ºæ—¥å¿—åºåˆ—å·ï¼Œå¦‚æœç»™å®šçš„æ—¥å¿—æ–‡ä»¶ä¸­åŒ…å«äº†åç¼€(logname.suffix)å°†å¿½ç•¥åç¼€éƒ¨åˆ†ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/assets/733013-20180507084125816-1681048114.png" alt="img"></p>
<p>æˆ–è€…åœ¨é…ç½®æ–‡ä»¶ä¸­çš„[mysqld]éƒ¨åˆ†è®¾ç½®log-binä¹Ÿå¯ä»¥ã€‚æ³¨æ„ï¼šå¯¹äºmysql 5.7ï¼Œç›´æ¥å¯åŠ¨binlogå¯èƒ½ä¼šå¯¼è‡´mysqlæœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œè¿™æ—¶éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­çš„mysqldä¸ºmysqlå®ä¾‹åˆ†é…server_idã€‚</p>
<pre tabindex="0"><code>`[mysqld]``# server_id=1234``log-bin=[on|filename]`
</code></pre><p>mysqldè¿˜<strong>åˆ›å»ºä¸€ä¸ªäºŒè¿›åˆ¶æ—¥å¿—ç´¢å¼•æ–‡ä»¶</strong>ï¼Œå½“äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶æ»šåŠ¨çš„æ—¶å€™ä¼šå‘è¯¥æ–‡ä»¶ä¸­å†™å…¥å¯¹åº”çš„ä¿¡æ¯ã€‚æ‰€ä»¥è¯¥æ–‡ä»¶åŒ…å«æ‰€æœ‰ä½¿ç”¨çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„æ–‡ä»¶åã€‚é»˜è®¤æƒ…å†µä¸‹è¯¥æ–‡ä»¶ä¸äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„æ–‡ä»¶åç›¸åŒï¼Œæ‰©å±•åä¸º'.index'ã€‚è¦æŒ‡å®šè¯¥æ–‡ä»¶çš„æ–‡ä»¶åä½¿ç”¨ &ndash;log-bin-index[=file_name] é€‰é¡¹ã€‚å½“mysqldåœ¨è¿è¡Œæ—¶ä¸åº”æ‰‹åŠ¨ç¼–è¾‘è¯¥æ–‡ä»¶ï¼Œå…å¾—mysqldå˜å¾—æ··ä¹±ã€‚</p>
<p>å½“é‡å¯mysqlæœåŠ¡æˆ–åˆ·æ–°æ—¥å¿—æˆ–è€…è¾¾åˆ°æ—¥å¿—æœ€å¤§å€¼æ—¶ï¼Œå°†æ»šåŠ¨äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼Œæ»šåŠ¨æ—¥å¿—æ—¶åªä¿®æ”¹æ—¥å¿—æ–‡ä»¶åçš„æ•°å­—åºåˆ—éƒ¨åˆ†ã€‚</p>
<p>äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å€¼é€šè¿‡å˜é‡ max_binlog_size è®¾ç½®(é»˜è®¤å€¼ä¸º1G)ã€‚ä½†ç”±äºäºŒè¿›åˆ¶æ—¥å¿—å¯èƒ½æ˜¯åŸºäºäº‹åŠ¡æ¥è®°å½•çš„(å¦‚innodbè¡¨ç±»å‹)ï¼Œè€Œäº‹åŠ¡æ˜¯ç»å¯¹ä¸å¯èƒ½ä¹Ÿä¸åº”è¯¥è·¨æ–‡ä»¶è®°å½•çš„ï¼Œå¦‚æœæ­£å¥½äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶è¾¾åˆ°äº†æœ€å¤§å€¼ä½†äº‹åŠ¡è¿˜æ²¡æœ‰æäº¤åˆ™ä¸ä¼šæ»šåŠ¨æ—¥å¿—ï¼Œè€Œæ˜¯ç»§ç»­å¢å¤§æ—¥å¿—ï¼Œæ‰€ä»¥ max_binlog_size æŒ‡å®šçš„å€¼å’Œå®é™…çš„äºŒè¿›åˆ¶æ—¥å¿—å¤§å°ä¸ä¸€å®šç›¸ç­‰ã€‚</p>
<p>å› ä¸ºäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶å¢é•¿è¿…é€Ÿï¼Œä½†å®˜æ–¹è¯´æ˜å› æ­¤è€ŒæŸè€—çš„æ€§èƒ½å°äº1%ï¼Œä¸”äºŒè¿›åˆ¶ç›®çš„æ˜¯ä¸ºäº†æ¢å¤å®šç‚¹æ•°æ®åº“å’Œä¸»ä»å¤åˆ¶ï¼Œæ‰€ä»¥å‡ºäºå®‰å…¨å’ŒåŠŸèƒ½è€ƒè™‘ï¼Œ<strong>æä¸å»ºè®®å°†äºŒè¿›åˆ¶æ—¥å¿—å’Œ<strong><strong>datadir</strong></strong>æ”¾åœ¨åŒä¸€ç£ç›˜ä¸Š</strong>ã€‚</p>
<h2 id="52-æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—">5.2 æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—</h2>
<p>MySQLä¸­æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—çš„æ–¹æ³•ä¸»è¦æœ‰å‡ ç§ã€‚</p>
<p>1.ä½¿ç”¨mysqlbinlogå·¥å…·ã€‚</p>
<p>2.ä½¿ç”¨showæ˜¾ç¤ºå¯¹åº”çš„ä¿¡æ¯ã€‚</p>
<pre tabindex="0"><code>`SHOW {BINARY | MASTER} LOGS      ``# æŸ¥çœ‹ä½¿ç”¨äº†å“ªäº›æ—¥å¿—æ–‡ä»¶``SHOW BINLOG EVENTS [IN ``'log_name'``] [FROM pos]   ``# æŸ¥çœ‹æ—¥å¿—ä¸­è¿›è¡Œäº†å“ªäº›æ“ä½œ``SHOW MASTER STATUS         ``# æ˜¾å¼ä¸»æœåŠ¡å™¨ä¸­çš„äºŒè¿›åˆ¶æ—¥å¿—ä¿¡æ¯`
</code></pre><h3 id="521-mysqlbinlog">5.2.1 mysqlbinlog</h3>
<p>äºŒè¿›åˆ¶æ—¥å¿—å¯ä»¥ä½¿ç”¨mysqlbinlogå‘½ä»¤æŸ¥çœ‹ã€‚</p>
<pre tabindex="0"><code>`mysqlbinlog [option] log-file1 log-file2...`
</code></pre><p>ä»¥ä¸‹æ˜¯å¸¸ç”¨çš„å‡ ä¸ªé€‰é¡¹ï¼š</p>
<pre tabindex="0"><code>`-d,--database=nameï¼šåªæŸ¥çœ‹æŒ‡å®šæ•°æ®åº“çš„æ—¥å¿—æ“ä½œ``-o,--offset=``#ï¼šå¿½ç•¥æ‰æ—¥å¿—ä¸­çš„å‰nä¸ªæ“ä½œå‘½ä»¤``-r,--result-``file``=nameï¼šå°†è¾“å‡ºçš„æ—¥å¿—ä¿¡æ¯è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨é‡å®šå‘ä¹Ÿä¸€æ ·å¯ä»¥ã€‚``-s,--short-formï¼šæ˜¾ç¤ºç®€å•æ ¼å¼çš„æ—¥å¿—ï¼Œåªè®°å½•ä¸€äº›æ™®é€šçš„è¯­å¥ï¼Œä¼šçœç•¥æ‰ä¸€äº›é¢å¤–çš„ä¿¡æ¯å¦‚ä½ç½®ä¿¡æ¯å’Œæ—¶é—´ä¿¡æ¯ä»¥åŠåŸºäºè¡Œçš„æ—¥å¿—ã€‚å¯ä»¥ç”¨æ¥è°ƒè¯•ï¼Œç”Ÿäº§ç¯å¢ƒåƒä¸‡ä¸å¯ä½¿ç”¨``--``set``-charset=char_nameï¼šåœ¨è¾“å‡ºæ—¥å¿—ä¿¡æ¯åˆ°æ–‡ä»¶ä¸­æ—¶ï¼Œåœ¨æ–‡ä»¶ç¬¬ä¸€è¡ŒåŠ ä¸Š``set` `names char_name``--start-datetime,--stop-datetimeï¼šæŒ‡å®šè¾“å‡ºå¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´å†…çš„æ‰€æœ‰æ—¥å¿—ä¿¡æ¯``--start-position=``#,--stop-position=#ï¼šæŒ‡å®šè¾“å‡ºå¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®å†…çš„æ‰€æœ‰æ—¥å¿—ä¿¡æ¯``-``v``,-vvï¼šæ˜¾ç¤ºæ›´è¯¦ç»†ä¿¡æ¯ï¼ŒåŸºäºrowçš„æ—¥å¿—é»˜è®¤ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œæ­¤æ—¶ä½¿ç”¨-``v``æˆ–-vvå¯ä»¥æŸ¥çœ‹`
</code></pre><p>åœ¨è¿›è¡Œæµ‹è¯•ä¹‹å‰ï¼Œå…ˆå¯¹æ—¥å¿—è¿›è¡Œä¸€æ¬¡åˆ·æ–°ï¼Œä»¥æ–¹ä¾¿è§£é‡ŠäºŒè¿›åˆ¶æ—¥å¿—çš„ä¿¡æ¯ã€‚</p>
<pre tabindex="0"><code>shell&gt; mysqladmin -uroot -p refresh
</code></pre><p>å‡è®¾ç°åœ¨çš„æ—¥å¿—æ–‡ä»¶æ˜¯mysql-bin.000001ï¼Œé‡Œé¢æš‚æ—¶åªæœ‰ä¸€äº›åˆå§‹ä¿¡æ¯ï¼Œæ²¡æœ‰è®°å½•ä»»ä½•æ“ä½œè¿‡çš„è®°å½•ã€‚</p>
<p>ä¸‹é¢æ˜¯æ¯ä¸ªäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„åˆå§‹ä¿¡æ¯ã€‚å¯ä»¥çœ‹åˆ°è®°å½•äº†æ—¶é—´å’Œä½ç½®ä¿¡æ¯(at 4)ã€‚</p>
<pre tabindex="0"><code>[root@xuexi data]# mysqlbinlog mysql-bin.000001 
/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/;
/*!40019 SET @@session.max_insert_delayed_threads=0*/;
/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;
DELIMITER /*!*/;
# at 4
#170329  2:18:10 server id 1  end_log_pos 120 CRC32 0x40f62523  Start: binlog v 4, server v 5.6.35-log created 170329  2:18:10 at startup
# Warning: this binlog is either in use or was not closed properly.
ROLLBACK/*!*/;
BINLOG '
4qjaWA8BAAAAdAAAAHgAAAABAAQANS42LjM1LWxvZwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAADiqNpYEzgNAAgAEgAEBAQEEgAAXAAEGggAAAAICAgCAAAACgoKGRkAASMl
9kA=
'/*!*/;
DELIMITER ;
# End of log file
ROLLBACK /* added by mysqlbinlog */;
/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;
/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/;
</code></pre><p>ç°åœ¨åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œä¸‹é¢çš„æ“ä½œï¼š</p>
<pre tabindex="0"><code>use test;
create table student(studentid int not null primary key,name varchar(30) not null,gender enum('female','mail'));
alter table student change gender gender enum('female','male');
insert into student values(1,'malongshuai','male'),(2,'gaoxiaofang','female');
</code></pre><p>å†æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—ä¿¡æ¯ã€‚</p>
<pre tabindex="0"><code>[root@xuexi data]# mysqlbinlog mysql-bin.000001 
/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/;
/*!40019 SET @@session.max_insert_delayed_threads=0*/;
/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;
DELIMITER /*!*/;
# at 4
#170329  2:18:10 server id 1  end_log_pos 120 CRC32 0x40f62523  Start: binlog v 4, server v 5.6.35-log created 170329  2:18:10 at startup
# Warning: this binlog is either in use or was not closed properly.
ROLLBACK/*!*/;
BINLOG '
4qjaWA8BAAAAdAAAAHgAAAABAAQANS42LjM1LWxvZwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAADiqNpYEzgNAAgAEgAEBAQEEgAAXAAEGggAAAAICAgCAAAACgoKGRkAASMl
9kA=
'/*!*/;
# at 120
#170329  5:20:00 server id 1  end_log_pos 305 CRC32 0xbac43912  Query   thread_id=1     exec_time=0     error_code=0
use `test`/*!*/;
SET TIMESTAMP=1490736000/*!*/;
SET @@session.pseudo_thread_id=1/*!*/;
SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/*!*/;
SET @@session.sql_mode=1075838976/*!*/;
SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/*!*/;
/*!\C utf8 *//*!*/;
SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=8/*!*/;
SET @@session.lc_time_names=0/*!*/;
SET @@session.collation_database=DEFAULT/*!*/;
create table student(studentid int not null primary key,name varchar(30) not null,gender enum('female','mail'))
/*!*/;
# at 305
#170329  5:21:21 server id 1  end_log_pos 441 CRC32 0xde67f702  Query   thread_id=1     exec_time=0     error_code=0
SET TIMESTAMP=1490736081/*!*/;
alter table student change gender gender enum('female','male')
/*!*/;
# at 441
#170329  5:21:33 server id 1  end_log_pos 520 CRC32 0x05a9c5a1  Query   thread_id=1     exec_time=0     error_code=0
SET TIMESTAMP=1490736093/*!*/;
BEGIN
/*!*/;
# at 520
#170329  5:21:33 server id 1  end_log_pos 671 CRC32 0xad9e7dc8  Query   thread_id=1     exec_time=0     error_code=0
SET TIMESTAMP=1490736093/*!*/;
insert into student values(1,'malongshuai','male'),(2,'gaoxiaofang','female')
/*!*/;
# at 671
#170329  5:21:33 server id 1  end_log_pos 702 CRC32 0xb69b0f7d  Xid = 32
COMMIT/*!*/;
DELIMITER ;
# End of log file
ROLLBACK /* added by mysqlbinlog */;
/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;
/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/; 
</code></pre><p>å°†ä¸Šè¿°ä¿¡æ¯æ•´ç†ä¸ºä¸‹å›¾ï¼šå…¶ä¸­timestampè®°å½•çš„æ˜¯ä»1970-01-01åˆ°ç°åœ¨çš„æ€»ç§’æ•°æ—¶é—´æˆ³ï¼Œå¯ä»¥ä½¿ç”¨ date -d &lsquo;@1490736093&rsquo; è½¬æ¢ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/assets/733013-20180507085958196.png" alt="img"></p>
<ul>
<li>ä½ç½®0-120è®°å½•çš„æ˜¯äºŒè¿›åˆ¶æ—¥å¿—çš„ä¸€äº›å›ºå®šä¿¡æ¯ã€‚</li>
<li>ä½ç½®120-305è®°å½•çš„æ˜¯useå’Œcreate tableè¯­å¥ï¼Œè¯­å¥çš„è®°å½•æ—¶é—´ä¸º5:20:00ã€‚ä½†æ³¨æ„ï¼Œè¿™é‡Œçš„useä¸æ˜¯æ‰§è¡Œçš„useè¯­å¥ï¼Œè€Œæ˜¯MySQLå‘ç°è¦æ“ä½œçš„æ•°æ®åº“ä¸ºtestï¼Œè€Œè‡ªåŠ¨è¿›è¡Œçš„æ“ä½œå¹¶è®°å½•ä¸‹æ¥ã€‚äººä¸ºçš„useè¯­å¥æ˜¯ä¸ä¼šè®°å½•çš„ã€‚</li>
<li>ä½ç½®305-441è®°å½•çš„æ˜¯alter tableè¯­å¥ï¼Œè¯­å¥çš„è®°å½•æ—¶é—´ä¸º5:20:21ã€‚</li>
<li>ä½ç½®441-702è®°å½•çš„æ˜¯insertæ“ä½œï¼Œå› ä¸ºè¯¥æ“ä½œæ˜¯DMLè¯­å¥ï¼Œå› æ­¤è®°å½•äº†äº‹åŠ¡çš„å¼€å§‹BEGINå’Œæäº¤COMMITã€‚
<ul>
<li>beginçš„èµ·æ­¢ä½ç½®ä¸º441-520ï¼›</li>
<li>insert intoè¯­å¥çš„èµ·æ­¢ä½ç½®ä¸º520-671ï¼Œè®°å½•çš„æ—¶é—´å’Œè‡ªåŠ¨å¼€å¯äº‹åŠ¡çš„beginæ—¶é—´æ˜¯ä¸€æ ·çš„ï¼›</li>
<li>commitçš„èµ·æ­¢ä½ç½®ä¸º671-702ã€‚</li>
</ul>
</li>
</ul>
<p>ä½¿ç”¨-rå‘½ä»¤å°†æ—¥å¿—æ–‡ä»¶å¯¼å…¥åˆ°æŒ‡å®šæ–‡ä»¶ä¸­ï¼Œä½¿ç”¨é‡å®šå‘ä¹Ÿå¯ä»¥å®ç°åŒæ ·çš„ç»“æœã€‚å¹¶ä½¿ç”¨-sæŸ¥çœ‹ç®€åŒ–çš„æ—¥å¿—æ–‡ä»¶ã€‚</p>
<pre tabindex="0"><code>[root@xuexi data]# mysqlbinlog mysql-bin.000001 -r /tmp/binlog.000001
[root@xuexi data]# mysqlbinlog mysql-bin.000001 -s&gt;/tmp/binlog.sample
</code></pre><p>æ¯”è¾ƒè¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œçœ‹çœ‹ç®€åŒ–çš„æ—¥å¿—æ–‡ä»¶ç®€åŒ–äº†å“ªäº›ä¸œè¥¿ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/assets/733013-20180507090446176-118990478.png" alt="img"></p>
<p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨-såï¼Œå°‘äº†åŸºäºè¡Œçš„æ—¥å¿—ä¿¡æ¯ï¼Œä¹Ÿå°‘äº†è®°å½•çš„ä½ç½®å’Œæ—¶é—´ä¿¡æ¯ã€‚</p>
<p>ä½¿ç”¨-oå¯ä»¥å¿½ç•¥å‰Nä¸ªæ¡ç›®ï¼Œä¾‹å¦‚ä¸Šé¢çš„æ“ä½œæ¶‰åŠäº†6ä¸ªæ“ä½œã€‚å¿½ç•¥æ‰å‰3ä¸ªåçš„æ—¥å¿—æ˜¾ç¤ºå¦‚ä¸‹ï¼šå¯ä»¥çœ‹åˆ°ç›´æ¥ä»ä½ç½®441å¼€å§‹æ˜¾ç¤ºäº†ã€‚</p>
<pre tabindex="0"><code>[root@xuexi data]# mysqlbinlog mysql-bin.000001 -o 3
...å‰é¢å›ºå®šéƒ¨åˆ†çœç•¥...

'/*!*/;
# at 441
#170329  5:21:33 server id 1  end_log_pos 520 CRC32 0x05a9c5a1  Query   thread_id=1     exec_time=0     error_code=0
SET TIMESTAMP=1490736093/*!*/;
SET @@session.pseudo_thread_id=1/*!*/;
SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/*!*/;
SET @@session.sql_mode=1075838976/*!*/;
SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/*!*/;
/*!\C utf8 *//*!*/;
SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=8/*!*/;
SET @@session.lc_time_names=0/*!*/;
SET @@session.collation_database=DEFAULT/*!*/;
BEGIN
/*!*/;
# at 520
#170329  5:21:33 server id 1  end_log_pos 671 CRC32 0xad9e7dc8  Query   thread_id=1     exec_time=0     error_code=0
use `test`/*!*/;
SET TIMESTAMP=1490736093/*!*/;
insert into student values(1,'malongshuai','male'),(2,'gaoxiaofang','female')
/*!*/;
# at 671
#170329  5:21:33 server id 1  end_log_pos 702 CRC32 0xb69b0f7d  Xid = 32
COMMIT/*!*/;
DELIMITER ;

...åé¢å›ºå®šéƒ¨åˆ†çœç•¥... 
</code></pre><p>ä½¿ç”¨-då¯ä»¥åªæ˜¾ç¤ºæŒ‡å®šæ•°æ®åº“ç›¸å…³çš„æ“ä½œã€‚ä¾‹å¦‚å…ˆåˆ‡æ¢åˆ°å…¶ä»–æ•°æ®åº“è¿›è¡Œä¸€ç•ªæ“ä½œï¼Œç„¶åå†ä½¿ç”¨-dæŸ¥çœ‹æ—¥å¿—ã€‚</p>
<pre tabindex="0"><code>mysql&gt; use mysql;
mysql&gt; create table mytest(id int);

[root@xuexi data]# mysqlbinlog mysql-bin.000001 -d mysql
...å‰å›ºå®šéƒ¨åˆ†çœç•¥...'/*!*/;
# at 120
# at 305
# at 441
#170329  5:21:33 server id 1  end_log_pos 520 CRC32 0x05a9c5a1  Query   thread_id=1     exec_time=0     error_code=0
SET TIMESTAMP=1490736093/*!*/;
SET @@session.pseudo_thread_id=1/*!*/;
SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/*!*/;
SET @@session.sql_mode=1075838976/*!*/;
SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/*!*/;
/*!\C utf8 *//*!*/;
SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=8/*!*/;
SET @@session.lc_time_names=0/*!*/;
SET @@session.collation_database=DEFAULT/*!*/;
BEGIN
/*!*/;
# at 520
# at 671
#170329  5:21:33 server id 1  end_log_pos 702 CRC32 0xb69b0f7d  Xid = 32
COMMIT/*!*/;
# at 702
#170329  6:27:12 server id 1  end_log_pos 805 CRC32 0x491529ff  Query   thread_id=1     exec_time=0     error_code=0
use `mysql`/*!*/;
SET TIMESTAMP=1490740032/*!*/;
create table mytest(id int)
/*!*/;
DELIMITER ;
...åé¢å›ºå®šéƒ¨åˆ†çœç•¥... 
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†æŒ‡å®šçš„mysqlæ•°æ®åº“çš„ä¿¡æ¯è¾“å‡ºäº†ï¼Œè¿˜éå¸¸ç®€åŒ–çš„è¾“å‡ºäº†å…¶ä»–æ•°æ®åº“çš„ä¿¡æ¯ã€‚</p>
<p>mysqlbinlogæœ€æœ‰ç”¨çš„ä¸¤ä¸ªé€‰é¡¹å°±æ˜¯æŒ‡å®šæ—¶é—´å’Œä½ç½®æ¥è¾“å‡ºæ—¥å¿—ã€‚</p>
<p>æŒ‡å®šæ—¶é—´æ—¶ï¼Œå°†è¾“å‡ºæŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æ—¥å¿—ã€‚æŒ‡å®šçš„æ—¶é—´å¯ä»¥ä¸å’Œæ—¥å¿—ä¸­è®°å½•çš„æ—¥å¿—ç›¸åŒã€‚</p>
<pre tabindex="0"><code>[root@xuexi data]# mysqlbinlog mysql-bin.000001 --start-datetime='2017-03-28 00:00:01' --stop-datetime='2017-03-29 05:21:23'
...å‰é¢å›ºå®šéƒ¨åˆ†çœç•¥...
'/*!*/;
# at 120
#170329  5:20:00 server id 1  end_log_pos 305 CRC32 0xbac43912  Query   thread_id=1     exec_time=0     error_code=0
use `test`/*!*/;
SET TIMESTAMP=1490736000/*!*/;
SET @@session.pseudo_thread_id=1/*!*/;
SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/*!*/;
SET @@session.sql_mode=1075838976/*!*/;
SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/*!*/;
/*!\C utf8 *//*!*/;
SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=8/*!*/;
SET @@session.lc_time_names=0/*!*/;
SET @@session.collation_database=DEFAULT/*!*/;
create table student(studentid int not null primary key,name varchar(30) not null,gender enum('female','mail'))
/*!*/;
# at 305
#170329  5:21:21 server id 1  end_log_pos 441 CRC32 0xde67f702  Query   thread_id=1     exec_time=0     error_code=0
SET TIMESTAMP=1490736081/*!*/;
alter table student change gender gender enum('female','male')
/*!*/;
DELIMITER ;
...åé¢å›ºå®šéƒ¨åˆ†çœç•¥...
</code></pre><p>åŒç†æŒ‡å®šä½ç½®ä¹Ÿä¸€æ ·ï¼Œä½†æ˜¯æŒ‡å®šä½ç½®æ—¶æœ‰ä¸ªè¦æ±‚æ˜¯å¦‚æœæŒ‡å®šèµ·å§‹ä½ç½®ï¼Œåˆ™å¿…é¡»æŒ‡å®šæ—¥å¿—æ–‡ä»¶ä¸­æ˜ç¡®çš„èµ·å§‹ä½ç½®ã€‚ä¾‹å¦‚ï¼Œæ—¥å¿—æ–‡ä»¶ä¸­æœ‰ä½ç½®120ã€305ã€441ï¼Œå¯ä»¥æŒ‡å®šèµ·å§‹å’Œç»“æŸä½ç½®ä¸º120ã€500ï¼Œä½†æ˜¯ä¸å¯ä»¥æŒ‡å®šèµ·æ­¢ä½ç½®ä¸º150ã€500ï¼Œå› ä¸ºæ—¥å¿—æ–‡ä»¶ä¸­ä¸å­˜åœ¨150è¿™ä¸ªä½ç½®ã€‚</p>
<pre tabindex="0"><code>[root@xuexi data]# mysqlbinlog mysql-bin.000001 --start-position=150 --stop-position=441
...å‰é¢å›ºå®šéƒ¨åˆ†çœç•¥...
'/*!*/;
ERROR: Error in Log_event::read_log_event(): 'read error', data_len: 4202496, event_type: 0
...åé¢å›ºå®šéƒ¨åˆ†çœç•¥... 

[root@xuexi data]# mysqlbinlog mysql-bin.000001 --start-position=305 --stop-position=500
...å‰é¢å›ºå®šéƒ¨åˆ†çœç•¥... 
'/*!*/;
# at 305
#170329  5:21:21 server id 1  end_log_pos 441 CRC32 0xde67f702  Query   thread_id=1     exec_time=0     error_code=0
use `test`/*!*/;
SET TIMESTAMP=1490736081/*!*/;
SET @@session.pseudo_thread_id=1/*!*/;
SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/*!*/;
SET @@session.sql_mode=1075838976/*!*/;
SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/*!*/;
/*!\C utf8 *//*!*/;
SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=8/*!*/;
SET @@session.lc_time_names=0/*!*/;
SET @@session.collation_database=DEFAULT/*!*/;
alter table student change gender gender enum('female','male')
/*!*/;
# at 441
#170329  5:21:33 server id 1  end_log_pos 520 CRC32 0x05a9c5a1  Query   thread_id=1     exec_time=0     error_code=0
SET TIMESTAMP=1490736093/*!*/;
BEGIN
/*!*/;
DELIMITER ;
...åé¢å›ºå®šéƒ¨åˆ†çœç•¥...
</code></pre><h3 id="522-show-binary-logs">5.2.2 show binary logs</h3>
<p>è¯¥è¯­å¥ç”¨äºæŸ¥çœ‹å½“å‰ä½¿ç”¨äº†å“ªäº›äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ã€‚</p>
<p>å¯ä»¥é€šè¿‡æŸ¥çœ‹äºŒè¿›åˆ¶çš„indexæ–‡ä»¶æ¥æŸ¥çœ‹å½“å‰æ­£åœ¨ä½¿ç”¨å“ªäº›äºŒè¿›åˆ¶æ—¥å¿—ã€‚</p>
<pre tabindex="0"><code>[root@xuexi data]# cat mysql-bin.index 
./mysql-bin.000003
./mysql-bin.000004
./mysql-bin.000005
./mysql-bin.000006
</code></pre><p>ä¹Ÿå¯ä»¥åœ¨mysqlç¯å¢ƒä¸­ä½¿ç”¨ show {binary | master} logs æ¥æŸ¥çœ‹ã€‚binaryå’Œmasteræ˜¯åŒä¹‰è¯ã€‚</p>
<pre tabindex="0"><code>mysql&gt; show binary logs;
+------------------+-----------+
| Log_name         | File_size |
+------------------+-----------+
| mysql-bin.000003 |       167 |
| mysql-bin.000004 |       785 |
| mysql-bin.000005 |      1153 |
| mysql-bin.000006 |       602 |
+------------------+-----------
</code></pre><h3 id="523-show-binlog-events">5.2.3 show binlog events</h3>
<p><strong>è¯¥è¯­å¥ç”¨äºæŸ¥çœ‹æ—¥å¿—ä¸­è¿›è¡Œäº†å“ªäº›æ“ä½œã€‚</strong></p>
<pre tabindex="0"><code>mysql&gt; show binlog events in 'mysql-bin.000005';
</code></pre><p><img src="http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/assets/733013-20180507091129596-1182363918.png" alt="img"></p>
<p>å¯ä»¥æŒ‡å®šèµ·å§‹ä½ç½®ã€‚åŒæ ·ï¼Œèµ·å§‹ä½ç½®å¿…é¡»æŒ‡å®šæ­£ç¡®ï¼Œä¸èƒ½æŒ‡å®šä¸å­˜åœ¨çš„ä½ç½®ã€‚</p>
<pre tabindex="0"><code>mysql&gt; show binlog events in 'mysql-bin.000005' from 961;
+------------------+------+------------+-----------+-------------+--------------------------------+
| Log_name         | Pos  | Event_type | Server_id | End_log_pos | Info                           |
+------------------+------+------------+-----------+-------------+--------------------------------+
| mysql-bin.000005 |  961 | Table_map  |         1 |        1019 | table_id: 98 (test.student)    |
| mysql-bin.000005 | 1019 | Write_rows |         1 |        1075 | table_id: 98 flags: STMT_END_F |
| mysql-bin.000005 | 1075 | Xid        |         1 |        1106 | COMMIT /* xid=129 */           |
| mysql-bin.000005 | 1106 | Rotate     |         1 |        1153 | mysql-bin.000006;pos=4         |
+------------------+------+------------+-----------+-------------+--------------------------------+ 
</code></pre><h3 id="524-show-master-status">5.2.4 show master status</h3>
<p>è¯¥è¯­å¥ç”¨äºæ˜¾ç¤ºä¸»æœåŠ¡å™¨ä¸­çš„äºŒè¿›åˆ¶æ—¥å¿—ä¿¡æ¯ã€‚å¦‚æœæ˜¯ä¸»ä»ç»“æ„ï¼Œå®ƒåªä¼šæ˜¾ç¤ºä¸»ä»ç»“æ„ä¸­ä¸»æœåŠ¡å™¨çš„äºŒè¿›åˆ¶æ—¥å¿—ä¿¡æ¯ã€‚</p>
<pre tabindex="0"><code>mysql&gt; show master status;    
+------------------+----------+--------------+------------------+-------------------+
| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
+------------------+----------+--------------+------------------+-------------------+
| mysql-bin.000006 |      602 |              |                  |                   |
+------------------+----------+--------------+------------------+-------------------+
</code></pre><p>å¯ä»¥æŸ¥çœ‹åˆ°å½“å‰æ­£åœ¨ä½¿ç”¨çš„æ—¥å¿—åŠä¸‹ä¸€äº‹ä»¶è®°å½•çš„å¼€å§‹ä½ç½®ï¼Œè¿˜èƒ½æŸ¥çœ‹åˆ°å“ªäº›æ•°æ®åº“éœ€è¦è®°å½•äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå“ªäº›æ•°æ®åº“ä¸è®°å½•äºŒè¿›åˆ¶æ—¥å¿—ã€‚</p>
<h2 id="53-åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—">5.3 åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—</h2>
<p>åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—æœ‰å‡ ç§æ–¹æ³•ã€‚ä¸ç®¡å“ªç§æ–¹æ³•ï¼Œéƒ½ä¼šå°†åˆ é™¤åçš„ä¿¡æ¯åŒæ­¥åˆ°äºŒè¿›åˆ¶indexæ–‡ä»¶ä¸­ã€‚</p>
<p><strong>1.reset master<strong><strong>å°†ä¼šåˆ é™¤æ‰€æœ‰æ—¥å¿—ï¼Œå¹¶è®©æ—¥å¿—æ–‡ä»¶é‡æ–°ä»000001</strong></strong>å¼€å§‹ã€‚</strong></p>
<pre tabindex="0"><code>mysql&gt; reset master;
</code></pre><p><strong>2.PURGE { BINARY | MASTER } LOGS { TO &lsquo;log_name&rsquo; | BEFORE datetime_expr }</strong></p>
<p>purge master logs to &ldquo;binlog_name.00000X&rdquo; å°†ä¼šæ¸…ç©º00000Xä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—æ–‡ä»¶ã€‚ä¾‹å¦‚åˆ é™¤000006ä¹‹å‰çš„æ—¥å¿—æ–‡ä»¶ã€‚</p>
<pre tabindex="0"><code>mysql&gt; purge master logs to &quot;mysql-bin.000006&quot;;
mysql&gt; purge binary logs to &quot;mysql-bin.000006&quot;;
</code></pre><p>masterå’Œbinaryæ˜¯åŒä¹‰è¯</p>
<p>purge master logs before &lsquo;yyyy-mm-dd hh:mi:ss&rsquo; å°†ä¼šåˆ é™¤æŒ‡å®šæ—¥æœŸä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—ã€‚ä½†æ˜¯è‹¥æŒ‡å®šçš„æ—¶é—´å¤„åœ¨æ­£åœ¨ä½¿ç”¨ä¸­çš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå°†æ— æ³•è¿›è¡Œpurgeã€‚</p>
<pre tabindex="0"><code>mysql&gt; purge master logs before '2017-03-29 07:36:40';

mysql&gt; show warnings;
+---------+------+---------------------------------------------------------------------------+
| Level   | Code | Message                                                                   |
+---------+------+---------------------------------------------------------------------------+
| Warning | 1868 | file ./mysql-bin.000003 was not purged because it is the active log file. |
+---------+------+---------------------------------------------------------------------------+
</code></pre><p><strong>3.<strong><strong>ä½¿ç”¨&ndash;expire_logs_days=N</strong></strong>é€‰é¡¹æŒ‡å®šè¿‡äº†å¤šå°‘å¤©æ—¥å¿—è‡ªåŠ¨è¿‡æœŸæ¸…ç©ºã€‚</strong></p>
<h2 id="54-äºŒè¿›åˆ¶æ—¥å¿—çš„è®°å½•æ ¼å¼">5.4 äºŒè¿›åˆ¶æ—¥å¿—çš„è®°å½•æ ¼å¼</h2>
<p>åœ¨MySQL 5.1ä¹‹å‰ï¼ŒMySQLåªæœ‰ä¸€ç§åŸºäºè¯­å¥statementå½¢å¼çš„æ—¥å¿—è®°å½•æ ¼å¼ã€‚å³å°†æ‰€æœ‰çš„ç›¸å…³æ“ä½œè®°å½•ä¸ºSQLè¯­å¥å½¢å¼ã€‚ä½†æ˜¯è¿™æ ·çš„è®°å½•æ–¹å¼å¯¹æŸäº›ç‰¹æ®Šä¿¡æ¯æ— æ³•åŒæ­¥è®°å½•ï¼Œä¾‹å¦‚uuidï¼Œnow()ç­‰è¿™æ ·åŠ¨æ€å˜åŒ–çš„å€¼ã€‚</p>
<p>ä»MySQL 5.1å¼€å§‹ï¼ŒMySQLæ”¯æŒstatementã€rowã€mixedä¸‰ç§å½¢å¼çš„è®°å½•æ–¹å¼ã€‚rowå½¢å¼æ˜¯åŸºäºè¡Œæ¥è®°å½•ï¼Œä¹Ÿå°±æ˜¯å°†ç›¸å…³è¡Œçš„æ¯ä¸€åˆ—çš„å€¼éƒ½åœ¨æ—¥å¿—ä¸­ä¿å­˜ä¸‹æ¥ï¼Œè¿™æ ·çš„ç»“æœä¼šå¯¼è‡´æ—¥å¿—æ–‡ä»¶å˜å¾—éå¸¸å¤§ï¼Œä½†æ˜¯ä¿è¯äº†åŠ¨æ€å€¼çš„ç¡®å®šæ€§ã€‚è¿˜æœ‰ä¸€ç§mixedå½¢å¼ï¼Œè¡¨ç¤ºå¦‚ä½•è®°å½•æ—¥å¿—ç”±MySQLè‡ªå·±æ¥å†³å®šã€‚</p>
<p>æ—¥å¿—çš„è®°å½•æ ¼å¼ç”±å˜é‡ binlog_format æ¥æŒ‡å®šã€‚å…¶å€¼æœ‰ï¼šrow,statement,mixedã€‚innodbå¼•æ“çš„åˆ›å§‹äººä¹‹ä¸€åœ¨åšå®¢ä¸Šæ¨èä½¿ç”¨rowæ ¼å¼ã€‚</p>
<p>ä¸‹é¢å°†è®°å½•æ ¼å¼æ”¹ä¸ºrowã€‚</p>
<pre tabindex="0"><code>mysql&gt; alter table student add birthday datetime default  now();
mysql&gt; flush logs;
mysql&gt; set binlog_format='row';
mysql&gt; insert into student values(7,'xiaowoniu','female',now());  
</code></pre><p>æŸ¥çœ‹äº§ç”Ÿçš„æ—¥å¿—ã€‚</p>
<pre tabindex="0"><code>[root@xuexi data]# mysqlbinlog mysql-bin.000005
...å‰é¢å›ºå®šéƒ¨åˆ†çœç•¥...
'/*!*/;
# at 120
#170329  8:06:24 server id 1  end_log_pos 200 CRC32 0x0ac02649  Query   thread_id=1     exec_time=0     error_code=0
SET TIMESTAMP=1490745984/*!*/;
SET @@session.pseudo_thread_id=1/*!*/;
SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/*!*/;
SET @@session.sql_mode=1075838976/*!*/;
SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/*!*/;
/*!\C utf8 *//*!*/;
SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=8/*!*/;
SET @@session.time_zone='SYSTEM'/*!*/;
SET @@session.lc_time_names=0/*!*/;
SET @@session.collation_database=DEFAULT/*!*/;
BEGIN
/*!*/;
# at 200
#170329  8:06:24 server id 1  end_log_pos 258 CRC32 0xb8cdfd09  Table_map: `test`.`student` mapped to number 94
# at 258
#170329  8:06:24 server id 1  end_log_pos 314 CRC32 0x8ce6f72c  Write_rows: table id 94 flags: STMT_END_F

BINLOG '
gPraWBMBAAAAOgAAAAIBAAAAAF4AAAAAAAEABHRlc3QAB3N0dWRlbnQABAMP/hIFHgD3AQAMCf3N
uA==
gPraWB4BAAAAOAAAADoBAAAAAF4AAAAAAAEAAgAE//AHAAAACXhpYW93b25pdQGZnDqBmCz35ow=
'/*!*/;
# at 314
#170329  8:06:24 server id 1  end_log_pos 345 CRC32 0x7a48c057  Xid = 114
COMMIT/*!*/;
DELIMITER ;
...åé¢å›ºå®šéƒ¨åˆ†çœç•¥...
</code></pre><p>å‘ç°æ˜¯ä¸€å †çœ‹ä¸æ‡‚çš„ä¸œè¥¿ï¼Œä½¿ç”¨-vvå¯å°†è¿™äº›æ˜¾ç¤ºå‡ºæ¥ã€‚å¯ä»¥çœ‹å‡ºï¼Œç»“æœä¸­è®°å½•çš„éå¸¸è¯¦ç»†ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåŸºäºrowè®°å½•æ—¥å¿—ä¼šå¯¼è‡´æ—¥å¿—æ–‡ä»¶æé€Ÿå˜å¤§ã€‚</p>
<pre tabindex="0"><code>[root@xuexi data]# mysqlbinlog mysql-bin.000005 -vv
...å‰é¢çœç•¥...
BINLOG '
gPraWBMBAAAAOgAAAAIBAAAAAF4AAAAAAAEABHRlc3QAB3N0dWRlbnQABAMP/hIFHgD3AQAMCf3N
uA==
gPraWB4BAAAAOAAAADoBAAAAAF4AAAAAAAEAAgAE//AHAAAACXhpYW93b25pdQGZnDqBmCz35ow=
'/*!*/;
### INSERT INTO `test`.`student`
### SET
###   @1=7 /* INT meta=0 nullable=0 is_null=0 */
###   @2='xiaowoniu' /* VARSTRING(30) meta=30 nullable=0 is_null=0 */
###   @3=1 /* ENUM(1 byte) meta=63233 nullable=1 is_null=0 */
###   @4='2017-03-29 08:06:24' /* DATETIME(0) meta=0 nullable=1 is_null=0 */
# at 314
...åé¢çœç•¥...
</code></pre><p>è¿˜æœ‰ä¸€ç§mixedæ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ä¸‹é»˜è®¤ä¼šé‡‡ç”¨statementçš„æ–¹å¼è®°å½•ï¼Œåªæœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µä¼šé‡‡ç”¨rowçš„å½¢å¼æ¥è®°å½•æ—¥å¿—ã€‚ 1.è¡¨çš„å­˜å‚¨å¼•æ“ä¸ºNDBï¼Œè¿™æ—¶å¯¹è¡¨çš„DMLæ“ä½œéƒ½ä¼šä»¥rowçš„æ ¼å¼è®°å½•ã€‚ 2.ä½¿ç”¨äº†uuid()ã€user()ã€current_user()ã€found_rows()ã€row_count()ç­‰ä¸ç¡®å®šå‡½æ•°ã€‚ä½†æµ‹è¯•å‘ç°å¯¹now()å‡½æ•°ä»ä¼šä»¥statementæ ¼å¼è®°å½•ï¼Œè€Œsysdate()å‡½æ•°ä¼šä»¥rowæ ¼å¼è®°å½•ã€‚ 3.ä½¿ç”¨äº†insert delayè¯­å¥ã€‚ 4.ä½¿ç”¨äº†ä¸´æ—¶è¡¨ã€‚</p>
<h2 id="55-äºŒè¿›åˆ¶æ—¥å¿—ç›¸å…³çš„å˜é‡">5.5 äºŒè¿›åˆ¶æ—¥å¿—ç›¸å…³çš„å˜é‡</h2>
<p>æ³¨æ„ï¼šåœ¨é…ç½®binlogç›¸å…³å˜é‡çš„æ—¶å€™ï¼Œç›¸å…³å˜é‡åæ€»æ˜¯ææ··ï¼Œå› ä¸ºæœ‰çš„æ˜¯binlogï¼Œæœ‰çš„æ˜¯log_binï¼Œå½“ä»–ä»¬åˆ†å¼€çš„æ—¶å€™ï¼Œlogåœ¨å‰ï¼Œå½“å®ƒä»¬ä¸€èµ·çš„æ—¶å€™ï¼Œbinåœ¨å‰ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­ä¹ŸåŒæ ·å¦‚æ­¤ã€‚</p>
<ul>
<li>log_bin = {on | off | base_name} #æŒ‡å®šæ˜¯å¦å¯ç”¨è®°å½•äºŒè¿›åˆ¶æ—¥å¿—æˆ–è€…æŒ‡å®šä¸€ä¸ªæ—¥å¿—è·¯å¾„(è·¯å¾„ä¸èƒ½åŠ .å¦åˆ™.åçš„è¢«å¿½ç•¥)</li>
<li>sql_log_bin ={ on | off } #æŒ‡å®šæ˜¯å¦å¯ç”¨è®°å½•äºŒè¿›åˆ¶æ—¥å¿—ï¼Œåªæœ‰åœ¨log_binå¼€å¯çš„æ—¶å€™æ‰æœ‰æ•ˆ</li>
<li>expire_logs_days = #æŒ‡å®šè‡ªåŠ¨åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—çš„æ—¶é—´ï¼Œå³æ—¥å¿—è¿‡æœŸæ—¶é—´</li>
<li>binlog_do_db = #æ˜ç¡®æŒ‡å®šè¦è®°å½•æ—¥å¿—çš„æ•°æ®åº“</li>
<li>binlog_ignore_db = #æŒ‡å®šä¸è®°å½•äºŒè¿›åˆ¶æ—¥å¿—çš„æ•°æ®åº“</li>
<li>log_bin_index = #æŒ‡å®šmysql-bin.indexæ–‡ä»¶çš„è·¯å¾„</li>
<li>binlog_format = { mixed | row | statement } #æŒ‡å®šäºŒè¿›åˆ¶æ—¥å¿—åŸºäºä»€ä¹ˆæ¨¡å¼è®°å½•</li>
<li>binlog_rows_query_log_events = { 1|0 } # MySQL5.6.2æ·»åŠ äº†è¯¥å˜é‡ï¼Œå½“binlog formatä¸ºrowæ—¶ï¼Œé»˜è®¤ä¸ä¼šè®°å½•rowå¯¹åº”çš„SQLè¯­å¥ï¼Œè®¾ç½®ä¸º1æˆ–å…¶ä»–trueå¸ƒå°”å€¼æ—¶ä¼šè®°å½•ï¼Œä½†éœ€è¦ä½¿ç”¨mysqlbinlog -væŸ¥çœ‹ï¼Œè¿™äº›è¯­å¥æ˜¯è¢«æ³¨é‡Šçš„ï¼Œæ¢å¤æ—¶ä¸ä¼šè¢«æ‰§è¡Œã€‚</li>
<li>max_binlog_size = #æŒ‡å®šäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶æœ€å¤§å€¼ï¼Œè¶…å‡ºæŒ‡å®šå€¼å°†è‡ªåŠ¨æ»šåŠ¨ã€‚ä½†ç”±äºäº‹åŠ¡ä¸ä¼šè·¨æ–‡ä»¶ï¼Œæ‰€ä»¥å¹¶ä¸ä¸€å®šæ€»æ˜¯ç²¾ç¡®ã€‚</li>
<li>binlog_cache_size = 32768 #<strong>åŸºäºäº‹åŠ¡ç±»å‹çš„æ—¥å¿—ä¼šå…ˆè®°å½•åœ¨ç¼“å†²åŒº</strong>ï¼Œå½“è¾¾åˆ°è¯¥ç¼“å†²å¤§å°æ—¶è¿™äº›æ—¥å¿—ä¼šå†™å…¥ç£ç›˜</li>
<li>max_binlog_cache_size = #æŒ‡å®šäºŒè¿›åˆ¶æ—¥å¿—ç¼“å­˜æœ€å¤§å¤§å°ï¼Œç¡¬é™åˆ¶ã€‚é»˜è®¤4Gï¼Œå¤Ÿå¤§äº†ï¼Œå»ºè®®ä¸è¦æ”¹</li>
<li>binlog_cache_useï¼šä½¿ç”¨ç¼“å­˜å†™äºŒè¿›åˆ¶æ—¥å¿—çš„æ¬¡æ•°(è¿™æ˜¯ä¸€ä¸ªå®æ—¶å˜åŒ–çš„ç»Ÿè®¡å€¼)</li>
<li>binlog_cache_disk_use:ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶å†™äºŒè¿›åˆ¶æ—¥å¿—çš„æ¬¡æ•°ï¼Œå½“æ—¥å¿—è¶…è¿‡äº†binlog_cache_sizeçš„æ—¶å€™ä¼šä½¿ç”¨ä¸´æ—¶æ–‡ä»¶å†™æ—¥å¿—ï¼Œå¦‚æœè¯¥å˜é‡å€¼ä¸ä¸º0ï¼Œåˆ™è€ƒè™‘å¢å¤§binlog_cache_sizeçš„å€¼</li>
<li>binlog_stmt_cache_size = 32768 #ä¸€èˆ¬ç­‰åŒäºä¸”å†³å®šbinlog_cache_sizeå¤§å°ï¼Œæ‰€ä»¥ä¿®æ”¹ç¼“å­˜å¤§å°æ—¶åªéœ€ä¿®æ”¹è¿™ä¸ªè€Œä¸ç”¨ä¿®æ”¹binlog_cache_size</li>
<li>binlog_stmt_cache_useï¼šä½¿ç”¨ç¼“å­˜å†™äºŒè¿›åˆ¶æ—¥å¿—çš„æ¬¡æ•°</li>
<li>binlog_stmt_cache_disk_use: ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶å†™äºŒè¿›åˆ¶æ—¥å¿—çš„æ¬¡æ•°ï¼Œå½“æ—¥å¿—è¶…è¿‡äº†binlog_cache_sizeçš„æ—¶å€™ä¼šä½¿ç”¨ä¸´æ—¶æ–‡ä»¶å†™æ—¥å¿—ï¼Œå¦‚æœè¯¥å˜é‡å€¼ä¸ä¸º0ï¼Œåˆ™è€ƒè™‘å¢å¤§binlog_cache_sizeçš„å€¼</li>
<li>sync_binlog = { 0 | n } #è¿™ä¸ªå‚æ•°ç›´æ¥å½±å“mysqlçš„æ€§èƒ½å’Œå®Œæ•´æ€§
<ul>
<li>sync_binlog=0:ä¸åŒæ­¥ï¼Œæ—¥å¿—ä½•æ—¶åˆ·åˆ°ç£ç›˜ç”±FileSystemå†³å®šï¼Œè¿™ä¸ªæ€§èƒ½æœ€å¥½ã€‚</li>
<li>sync_binlog=n:æ¯å†™næ¬¡äº‹åŠ¡(æ³¨æ„ï¼Œå¯¹äºéäº‹åŠ¡è¡¨æ¥è¯´ï¼Œæ˜¯næ¬¡äº‹ä»¶ï¼Œå¯¹äºäº‹åŠ¡è¡¨æ¥è¯´ï¼Œæ˜¯næ¬¡äº‹åŠ¡ï¼Œè€Œä¸€ä¸ªäº‹åŠ¡é‡Œå¯èƒ½åŒ…å«å¤šä¸ªäºŒè¿›åˆ¶äº‹ä»¶)ï¼ŒMySQLå°†æ‰§è¡Œä¸€æ¬¡ç£ç›˜åŒæ­¥æŒ‡ä»¤fdatasync()å°†ç¼“å­˜æ—¥å¿—åˆ·æ–°åˆ°ç£ç›˜æ—¥å¿—æ–‡ä»¶ä¸­ã€‚Mysqlä¸­é»˜è®¤çš„è®¾ç½®æ˜¯sync_binlog=0ï¼Œå³ä¸åŒæ­¥ï¼Œè¿™æ—¶æ€§èƒ½æœ€å¥½ï¼Œä½†é£é™©æœ€å¤§ã€‚ä¸€æ—¦ç³»ç»Ÿå¥”æºƒï¼Œç¼“å­˜ä¸­çš„æ—¥å¿—éƒ½ä¼šä¸¢å¤±ã€‚</li>
</ul>
</li>
</ul>
<p><strong>åœ¨innodbçš„ä¸»ä»å¤åˆ¶ç»“æ„ä¸­ï¼Œå¦‚æœå¯ç”¨äº†äºŒè¿›åˆ¶æ—¥å¿—(å‡ ä¹éƒ½ä¼šå¯ç”¨)ï¼Œè¦ä¿è¯äº‹åŠ¡çš„ä¸€è‡´æ€§å’ŒæŒä¹…æ€§çš„æ—¶å€™ï¼Œå¿…é¡»å°†sync_binlogçš„å€¼è®¾ç½®ä¸º1ï¼Œå› ä¸ºæ¯æ¬¡äº‹åŠ¡æäº¤éƒ½ä¼šå†™å…¥äºŒè¿›åˆ¶æ—¥å¿—ï¼Œè®¾ç½®ä¸º1å°±ä¿è¯äº†æ¯æ¬¡äº‹åŠ¡æäº¤æ—¶äºŒè¿›åˆ¶æ—¥å¿—éƒ½ä¼šå†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œä»è€Œç«‹å³è¢«ä»æœåŠ¡å™¨å¤åˆ¶è¿‡å»ã€‚</strong></p>
<h2 id="56-äºŒè¿›åˆ¶æ—¥å¿—å®šç‚¹è¿˜åŸæ•°æ®åº“">5.6 äºŒè¿›åˆ¶æ—¥å¿—å®šç‚¹è¿˜åŸæ•°æ®åº“</h2>
<p>åªéœ€æŒ‡å®šäºŒè¿›åˆ¶æ—¥å¿—çš„èµ·å§‹ä½ç½®ï¼ˆå¯æŒ‡å®šç»ˆæ­¢ä½ç½®ï¼‰å¹¶å°†å…¶ä¿å­˜åˆ°sqlæ–‡ä»¶ä¸­ï¼Œç”±mysqlå‘½ä»¤æ¥è½½å…¥æ¢å¤å³å¯ã€‚å½“ç„¶ç›´æ¥é€šè¿‡ç®¡é“é€ç»™mysqlå‘½ä»¤ä¹Ÿå¯ã€‚</p>
<p>è‡³äºæ˜¯åŸºäºä½ç½®æ¥æ¢å¤è¿˜æ˜¯åŸºäºæ—¶é—´ç‚¹æ¥æ¢å¤ï¼Œè¿™ä¸¤ç§è¡Œä¸ºéƒ½å¯ä»¥ã€‚é€‰æ‹©æ—¶é—´ç‚¹æ¥æ¢å¤æ¯”è¾ƒç›´è§‚äº›ï¼Œå¹¶ä¸”è·¨æ—¥å¿—æ–‡ä»¶æ¢å¤æ—¶æ›´æ–¹ä¾¿ã€‚</p>
<pre tabindex="0"><code>mysqlbinlog --stop-datetime=&quot;2014-7-2 15:27:48&quot; /tmp/mysql-bin.000008 | mysql -u user -p password
</code></pre><p>æ¢å¤å¤šä¸ªäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶æ—¶ï¼š</p>
<pre tabindex="0"><code>mysqlbinlog mysql-bin.[*] | mysql -uroot -p password
</code></pre><p>æˆ–è€…å°†å®ƒä»¬å¯¼å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­åæ¢å¤ã€‚</p>
<pre tabindex="0"><code>mysqlbinlog mysql-bin.000001 &gt; /tmp/a.sql
mysqlbinlog mysql-bin.000002 &gt;&gt;/tmp/a.sql
mysql -u root -p password -e &quot;source /tmp/a.sql&quot;
</code></pre>
        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/articles/mysql%E7%9A%84mvcc%E5%A4%9A%E7%89%88%E6%9C%AC%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6.md/"><span></span></a>
    </div>
    <div class="next">
        
        <a href="/documents/articles/jvm-cpu-profiler%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E5%8F%8A%E6%BA%90%E7%A0%81%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90.md/"><span></span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 27270 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>