<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title> | Yipsen Ye</title>
<meta name="description" content="å‰è¨€ æœ€è¿‘åœ¨é¢è¯•çš„æ—¶å€™è¢«é—®åˆ°SPIäº†ï¼Œæ²¡å›ç­”ä¸Šæ¥ï¼Œä¸»è¦ä¹Ÿæ˜¯è‡ªå·±çš„åŸå› ï¼ŒæŠŠè‡ªå·±ç»™å¸¦æ²Ÿé‡Œå»äº†ï¼Œå› ä¸ºè®²åˆ°äº†ç±»åŠ è½½å™¨çš„åŒäº²å§”æ´¾æ¨¡å‹ï¼Œåé¢å°±è¢«é—®åˆ°äº†æœ‰å“ªäº›æ˜¯ç ´åäº†åŒäº²å§”æ´¾æ¨¡å‹çš„åœºæ™¯ï¼Œç„¶åæˆ‘å°±è¯´åˆ°äº†SPIï¼ŒJNDIï¼Œä»¥åŠJDK9çš„æ¨¡å—åŒ–éƒ½ç ´åäº†åŒäº²å§”æ´¾ã€‚ ç„¶åå°±è¢«é—®ï¼Œé‚£ä½ è¯´è¯´å¯¹Javaä¸­çš„SPIçš„ç†è§£å§ã€‚ç„¶åæˆ‘å°±ä¸€è„¸æ‡µé€¼äº†ï¼Œä¹‹å‰åªæ˜¯çŸ¥é“å®ƒä¼šç ´ååŒäº²å§”æ´¾ï¼Œä¹ŸçŸ¥é“æ˜¯ä¸ªæ€ä¹ˆå›äº‹ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ·±å…¥äº†è§£ï¼Œé‚£ä¹ˆè¿™æ¬¡æˆ‘å°±å¥½å¥½çš„æ¥æ€»ç»“ä¸€ä¸‹è¿™ä¸ªçŸ¥è¯†å§ã€‚
ä»€ä¹ˆæ˜¯SPI SPIå…¨ç§°Service Provider Interfaceï¼Œå­—é¢æ„æ€æ˜¯æä¾›æœåŠ¡çš„æ¥å£ï¼Œå†è§£é‡Šè¯¦ç»†ä¸€ä¸‹å°±æ˜¯Javaæä¾›çš„ä¸€å¥—ç”¨æ¥è¢«ç¬¬ä¸‰æ–¹å®ç°æˆ–æ‰©å±•çš„æ¥å£ï¼Œå®ç°äº†æ¥å£çš„åŠ¨æ€æ‰©å±•ï¼Œè®©ç¬¬ä¸‰æ–¹çš„å®ç°ç±»èƒ½åƒæ’ä»¶ä¸€æ ·åµŒå…¥åˆ°ç³»ç»Ÿä¸­ã€‚
å’¦ã€‚ã€‚ã€‚ è¿™ä¸ªè§£é‡Šæ„Ÿè§‰è¿˜æ˜¯æœ‰ç‚¹ç»•å£ã€‚ é‚£å°±è¯´ä¸€ä¸‹å®ƒçš„æœ¬è´¨ã€‚
 å°†æ¥å£çš„å®ç°ç±»çš„å…¨é™å®šåé…ç½®åœ¨æ–‡ä»¶ä¸­ï¼ˆæ–‡ä»¶åæ˜¯æ¥å£çš„å…¨é™å®šåï¼‰ï¼Œç”±æœåŠ¡åŠ è½½å™¨è¯»å–é…ç½®æ–‡ä»¶ï¼ŒåŠ è½½å®ç°ç±»ã€‚å®ç°äº†è¿è¡Œæ—¶åŠ¨æ€ä¸ºæ¥å£æ›¿æ¢å®ç°ç±»ã€‚
 SPIç¤ºä¾‹ è¿˜æ˜¯ä¸¾ä¾‹è¯´æ˜å§ã€‚ æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªmoduleå«spi-interfaceã€‚ åœ¨è¿™ä¸ªmoduleä¸­æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ¥å£ï¼š
/** * @author jimoer **/ public interface SpiInterfaceService { /** * æ‰“å°å‚æ•° * @param parameter å‚æ•° */ void printParameter(String parameter); } å†å®šä¹‰ä¸€ä¸ªmoduleï¼Œåå­—å«spi-service-oneï¼Œpom.xmlä¸­ä¾èµ–spi-interfaceã€‚ åœ¨spi-service-oneä¸­å®šä¹‰ä¸€ä¸ªå®ç°ç±»ï¼Œå®ç°SpiInterfaceService æ¥å£ã€‚
package com.jimoer.spi.service.one; import com.jimoer.spi.app.SpiInterfaceService; /** * @author jimoer **/ public class SpiOneService implements SpiInterfaceService { /** * æ‰“å°å‚æ•° * * @param parameter å‚æ•° */ @Override public void printParameter(String parameter) { System.">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><article class="post-block">
        <h1 class="post-title"></h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;0001-01-01 00:00:00</span></div></div>
        <div class="post-content">
            <h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ€è¿‘åœ¨é¢è¯•çš„æ—¶å€™è¢«é—®åˆ°SPIäº†ï¼Œæ²¡å›ç­”ä¸Šæ¥ï¼Œä¸»è¦ä¹Ÿæ˜¯è‡ªå·±çš„åŸå› ï¼ŒæŠŠè‡ªå·±ç»™å¸¦æ²Ÿé‡Œå»äº†ï¼Œå› ä¸ºè®²åˆ°äº†ç±»åŠ è½½å™¨çš„åŒäº²å§”æ´¾æ¨¡å‹ï¼Œåé¢å°±è¢«é—®åˆ°äº†æœ‰å“ªäº›æ˜¯ç ´åäº†åŒäº²å§”æ´¾æ¨¡å‹çš„åœºæ™¯ï¼Œç„¶åæˆ‘å°±è¯´åˆ°äº†SPIï¼ŒJNDIï¼Œä»¥åŠJDK9çš„æ¨¡å—åŒ–éƒ½ç ´åäº†åŒäº²å§”æ´¾ã€‚ ç„¶åå°±è¢«é—®ï¼Œé‚£ä½ è¯´è¯´å¯¹Javaä¸­çš„SPIçš„ç†è§£å§ã€‚ç„¶åæˆ‘å°±ä¸€è„¸æ‡µé€¼äº†ï¼Œä¹‹å‰åªæ˜¯çŸ¥é“å®ƒä¼šç ´ååŒäº²å§”æ´¾ï¼Œä¹ŸçŸ¥é“æ˜¯ä¸ªæ€ä¹ˆå›äº‹ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ·±å…¥äº†è§£ï¼Œé‚£ä¹ˆè¿™æ¬¡æˆ‘å°±å¥½å¥½çš„æ¥æ€»ç»“ä¸€ä¸‹è¿™ä¸ªçŸ¥è¯†å§ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯spi">ä»€ä¹ˆæ˜¯SPI</h2>
<p>SPIå…¨ç§°Service Provider Interfaceï¼Œå­—é¢æ„æ€æ˜¯æä¾›æœåŠ¡çš„æ¥å£ï¼Œå†è§£é‡Šè¯¦ç»†ä¸€ä¸‹å°±æ˜¯<strong>Javaæä¾›çš„ä¸€å¥—ç”¨æ¥è¢«ç¬¬ä¸‰æ–¹å®ç°æˆ–æ‰©å±•çš„æ¥å£ï¼Œå®ç°äº†æ¥å£çš„åŠ¨æ€æ‰©å±•ï¼Œè®©ç¬¬ä¸‰æ–¹çš„å®ç°ç±»èƒ½åƒæ’ä»¶ä¸€æ ·åµŒå…¥åˆ°ç³»ç»Ÿä¸­ã€‚</strong></p>
<p>å’¦ã€‚ã€‚ã€‚ è¿™ä¸ªè§£é‡Šæ„Ÿè§‰è¿˜æ˜¯æœ‰ç‚¹ç»•å£ã€‚ é‚£å°±è¯´ä¸€ä¸‹å®ƒçš„æœ¬è´¨ã€‚</p>
<blockquote>
<p>å°†æ¥å£çš„å®ç°ç±»çš„å…¨é™å®šåé…ç½®åœ¨æ–‡ä»¶ä¸­ï¼ˆæ–‡ä»¶åæ˜¯æ¥å£çš„å…¨é™å®šåï¼‰ï¼Œç”±æœåŠ¡åŠ è½½å™¨è¯»å–é…ç½®æ–‡ä»¶ï¼ŒåŠ è½½å®ç°ç±»ã€‚å®ç°äº†è¿è¡Œæ—¶åŠ¨æ€ä¸ºæ¥å£æ›¿æ¢å®ç°ç±»ã€‚</p>
</blockquote>
<h2 id="spiç¤ºä¾‹">SPIç¤ºä¾‹</h2>
<p>è¿˜æ˜¯ä¸¾ä¾‹è¯´æ˜å§ã€‚ æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªmoduleå«spi-interfaceã€‚ <img src="http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/assets/20201206231416917.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"> åœ¨è¿™ä¸ªmoduleä¸­æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ¥å£ï¼š</p>
<pre tabindex="0"><code>/**
 * @author jimoer
 **/
public interface SpiInterfaceService {

    /**
     * æ‰“å°å‚æ•°
     * @param parameter å‚æ•°
     */
    void printParameter(String parameter);
}
</code></pre><p>å†å®šä¹‰ä¸€ä¸ªmoduleï¼Œåå­—å«spi-service-oneï¼Œpom.xmlä¸­ä¾èµ–spi-interfaceã€‚ åœ¨spi-service-oneä¸­å®šä¹‰ä¸€ä¸ªå®ç°ç±»ï¼Œå®ç°SpiInterfaceService æ¥å£ã€‚</p>
<pre tabindex="0"><code>package com.jimoer.spi.service.one;
import com.jimoer.spi.app.SpiInterfaceService;

/**
 * @author jimoer
 **/
public class SpiOneService implements SpiInterfaceService {
    /**
     * æ‰“å°å‚æ•°
     *
     * @param parameter å‚æ•°
     */
    @Override
    public void printParameter(String parameter) {
        System.out.println(&quot;æˆ‘æ˜¯SpiOneService:&quot;+parameter);
    }
}
</code></pre><p>ç„¶åå†spi-service-oneçš„resourcesç›®å½•ä¸‹åˆ›å»ºç›®å½•META-INF/servicesï¼Œåœ¨æ­¤ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶åç§°ä¸ºSpiInterfaceServiceæ¥å£çš„å…¨é™å®šåç§°ï¼Œæ–‡ä»¶å†…å®¹å†™å…¥SpiOneServiceè¿™ä¸ªå®ç°ç±»çš„å…¨é™å®šåç§°ã€‚ æ•ˆæœå¦‚ä¸‹ï¼š <img src="http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/assets/20201206230909117.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"> å†åˆ›å»ºä¸€ä¸ªmoduleï¼Œåç§°ä¸ºï¼šspi-service-oneï¼Œä¹Ÿæ˜¯ä¾èµ–spi-interfaceï¼Œå¹¶ä¸”å®šä¹‰ä¸€ä¸ªå®ç°ç±»SpiTwoService æ¥å®ç°SpiInterfaceService æ¥å£ã€‚</p>
<pre tabindex="0"><code>package com.jimoer.spi.service.two;
import com.jimoer.spi.app.SpiInterfaceService;
/**
 * @author jimoer
 **/
public class SpiTwoService implements SpiInterfaceService {
    /**
     * æ‰“å°å‚æ•°
     *
     * @param parameter å‚æ•°
     */
    @Override
    public void printParameter(String parameter) {
        System.out.println(&quot;æˆ‘æ˜¯SpiTwoService:&quot;+parameter);
    }
}
</code></pre><p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š <img src="http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/assets/20201206231315234.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"> ä¸‹é¢å†åˆ›å»ºä¸€ä¸ªç”¨æ¥æµ‹è¯•çš„moduleï¼Œåä¸ºï¼šspi-appã€‚<img src="http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/assets/20201206231517172.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"> pom.xmlä¸­ä¾èµ–<code>spi-service-one</code>å’Œ<code>spi-service-two</code></p>
<pre tabindex="0"><code>&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.jimoer.spi&lt;/groupId&gt;
        &lt;artifactId&gt;spi-service-one&lt;/artifactId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.jimoer.spi&lt;/groupId&gt;
        &lt;artifactId&gt;spi-service-two&lt;/artifactId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre><p>åˆ›å»ºæµ‹è¯•ç±»</p>
<pre tabindex="0"><code>/**
 * @author jimoer
 **/
public class SpiService {

    public static void main(String[] args) {

        ServiceLoader&lt;SpiInterfaceService&gt; spiInterfaceServices = ServiceLoader.load(SpiInterfaceService.class);
        Iterator&lt;SpiInterfaceService&gt; iterator = spiInterfaceServices.iterator();
        while (iterator.hasNext()){
            SpiInterfaceService sip = iterator.next();
            sip.printParameter(&quot;å‚æ•°&quot;);
        }
    }
}
</code></pre><p>æ‰§è¡Œç»“æœï¼š</p>
<pre tabindex="0"><code>æˆ‘æ˜¯SpiTwoService:å‚æ•°
æˆ‘æ˜¯SpiOneService:å‚æ•°
</code></pre><p>é€šè¿‡è¿è¡Œç»“æœæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå·²ç»å°†SpiInterfaceServiceæ¥å£çš„æ‰€æœ‰å®ç°éƒ½åŠ è½½åˆ°äº†å½“å‰é¡¹ç›®ä¸­ï¼Œå¹¶ä¸”æ‰§è¡Œäº†è°ƒç”¨ã€‚ <img src="http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/assets/2020120700453760.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"> è¿™æ•´ä¸ªä»£ç ç»“æ„æˆ‘ä»¬å¯ä»¥çœ‹å‡ºSPIæœºåˆ¶å°†æ¨¡å—çš„è£…é…æ”¾åˆ°äº†ç¨‹åºå¤–é¢ï¼Œå°±æ˜¯è¯´ï¼Œæ¥å£çš„å®ç°å¯ä»¥åœ¨ç¨‹åºå¤–é¢ï¼Œåªéœ€è¦åœ¨ä½¿ç”¨çš„æ—¶å€™æŒ‡å®šå…·ä½“çš„å®ç°ã€‚å¹¶ä¸”åŠ¨æ€çš„åŠ è½½åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ã€‚ SPIæœºåˆ¶çš„ä¸»è¦ç›®çš„ï¼š <strong>ä¸€æ˜¯ä¸ºäº†è§£è€¦ï¼Œå°†æ¥å£å’Œå…·ä½“å®ç°åˆ†ç¦»å¼€æ¥ï¼›</strong> <strong>äºŒæ˜¯æé«˜æ¡†æ¶çš„æ‰©å±•æ€§</strong>ã€‚ä»¥å‰å†™ç¨‹åºçš„æ—¶å€™ï¼Œæ¥å£å’Œå®ç°éƒ½å†™åœ¨ä¸€èµ·ï¼Œè°ƒç”¨æ–¹åœ¨ä½¿ç”¨çš„æ—¶å€™ä¾èµ–æ¥å£æ¥è¿›è¡Œè°ƒç”¨ï¼Œæ— æƒé€‰æ‹©ä½¿ç”¨å…·ä½“çš„å®ç°ç±»ã€‚</p>
<h2 id="spiçš„å®ç°">SPIçš„å®ç°</h2>
<p>é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹SPIå…·ä½“æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒSPIæœºåˆ¶çš„æ ¸å¿ƒä»£ç æ˜¯ä¸‹é¢è¿™æ®µï¼š</p>
<pre tabindex="0"><code>ServiceLoader&lt;SpiInterfaceService&gt; spiInterfaceServices = ServiceLoader.load(SpiInterfaceService.class);
</code></pre><p>é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹<code>ServiceLoader.load()</code>æ–¹æ³•çš„æºç ï¼š</p>
<pre tabindex="0"><code>public static &lt;S&gt; ServiceLoader&lt;S&gt; load(Class&lt;S&gt; service) {
    ClassLoader cl = Thread.currentThread().getContextClassLoader();
    return ServiceLoader.load(service, cl);
}
</code></pre><p>çœ‹åˆ°<code>Thread.currentThread().getContextClassLoader()</code>ï¼›æˆ‘å°±æ˜ç™½æ˜¯æ€ä¹ˆå›äº‹äº†ï¼Œè¿™ä¸ªå°±æ˜¯<strong>çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨</strong>ï¼Œå› ä¸º<strong>çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨</strong>å°±æ˜¯ä¸ºäº†åšç±»åŠ è½½åŒäº²å§”æ´¾æ¨¡å‹çš„é€†åºè€Œåˆ›å»ºçš„ã€‚</p>
<blockquote>
<p>ä½¿ç”¨è¿™ä¸ªçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨å»åŠ è½½æ‰€éœ€çš„SPIæœåŠ¡ä»£ç ï¼Œè¿™æ˜¯ä¸€ç§çˆ¶ç±»åŠ è½½å™¨å»è¯·æ±‚å­ç±»åŠ è½½å™¨å®Œæˆç±»åŠ è½½çš„è¡Œä¸ºï¼Œè¿™ç§è¡Œä¸ºå®é™…ä¸Šæ˜¯æ‰“é€šäº†ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹çš„å±‚æ¬¡ç»“æ„æ¥é€†å‘ä½¿ç”¨ç±»åŠ è½½å™¨ï¼Œå·²ç»è¿èƒŒäº†åŒäº²å§”æ´¾æ¨¡å‹çš„ä¸€èˆ¬æ€§åŸåˆ™ï¼Œä½†ä¹Ÿæ˜¯æ— å¯å¥ˆä½•çš„äº‹æƒ…ã€‚ <strong>ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆç¬¬ä¸‰ç‰ˆï¼‰ã€‹</strong></p>
</blockquote>
<p>è™½ç„¶çŸ¥é“äº†å®ƒæ˜¯ç ´ååŒäº²å§”æ´¾çš„äº†ï¼Œä½†æ˜¯å…·ä½“å®ç°ï¼Œè¿˜æ˜¯éœ€è¦å…·ä½“å¾€ä¸‹çœ‹çš„ã€‚</p>
<p>åœ¨ServiceLoaderé‡Œæ‰¾åˆ°å…·ä½“å®ç°hasNext()çš„æ–¹æ³•äº†ï¼Œé‚£ä¹ˆç»§ç»­æ¥çœ‹è¿™ä¸ªæ–¹æ³•çš„å®ç°ã€‚ <img src="http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/assets/20201207000120134.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"> hasNext()æ–¹æ³•åˆä¸»è¦è°ƒç”¨äº†hasNextService()æ–¹æ³•ã€‚</p>
<pre tabindex="0"><code>// å›ºå®šè·¯å¾„
private static final String PREFIX = &quot;META-INF/services/&quot;;

private boolean hasNextService() {
     if (nextName != null) {
         return true;
     }
     if (configs == null) {
         try {
         // å›ºå®šè·¯å¾„+æ¥å£å…¨é™å®šåç§°
             String fullName = PREFIX + service.getName();
             // å¦‚æœå½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ä¸ºç©ºï¼Œä¼šç”¨çˆ¶ç±»åŠ è½½å™¨ï¼ˆé»˜è®¤æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼‰
             if (loader == null)
                 configs = ClassLoader.getSystemResources(fullName);
             else
                 configs = loader.getResources(fullName);
         } catch (IOException x) {
             fail(service, &quot;Error locating configuration files&quot;, x);
         }
     }
     while ((pending == null) || !pending.hasNext()) {
         if (!configs.hasMoreElements()) {
             return false;
         }
         pending = parse(service, configs.nextElement());
     }
     // åé¢next()æ–¹æ³•ä¸­åˆ¤æ–­å½“å‰ç±»æ˜¯å¦å·²ç»å‡ºç°åŒ–çš„æ—¶å€™è¦ç”¨
     nextName = pending.next();
     return true;
 }
</code></pre><p>ä¸»è¦å°±æ˜¯å»åŠ è½½META-INF/services/è·¯å¾„ä¸‹çš„æ¥å£å…¨é™å®šåç§°çš„æ–‡ä»¶ç„¶åå»é‡Œé¢æ‰¾åˆ°å®ç°ç±»çš„ç±»è·¯å¾„å°†å®ç°ç±»è¿›è¡Œç±»åŠ è½½ã€‚</p>
<p>ç»§ç»­çœ‹è¿­ä»£å™¨æ˜¯å¦‚ä½•å–å‡ºæ¯ä¸€ä¸ªå®ç°å¯¹è±¡çš„ã€‚é‚£å°±è¦çœ‹ServiceLoaderä¸­å®ç°äº†è¿­ä»£å™¨çš„next()æ–¹æ³•äº†ã€‚ <img src="http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/assets/20201207001419765.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"> next()æ–¹æ³•ä¸»è¦æ˜¯nextService()å®ç°çš„ï¼Œé‚£ä¹ˆç»§ç»­çœ‹nextService()æ–¹æ³•ã€‚</p>
<pre tabindex="0"><code>private S nextService() {
     if (!hasNextService())
         throw new NoSuchElementException();
     String cn = nextName;
     nextName = null;
     Class&lt;?&gt; c = null;
     try {
     // ç›´æ¥åŠ è½½ç±»ï¼Œæ— éœ€åˆå§‹åŒ–ï¼ˆå› ä¸ºä¸Šé¢hasNext()å·²ç»åˆå§‹åŒ–äº†ï¼‰ã€‚
         c = Class.forName(cn, false, loader);
     } catch (ClassNotFoundException x) {
         fail(service,
              &quot;Provider &quot; + cn + &quot; not found&quot;);
     }
     if (!service.isAssignableFrom(c)) {
         fail(service,
              &quot;Provider &quot; + cn  + &quot; not a subtype&quot;);
     }
     try {
     // å°†åŠ è½½å¥½çš„ç±»å®ä¾‹åŒ–å‡ºå¯¹è±¡ã€‚
         S p = service.cast(c.newInstance());
         providers.put(cn, p);
         return p;
     } catch (Throwable x) {
         fail(service,
              &quot;Provider &quot; + cn + &quot; could not be instantiated&quot;,
              x);
     }
     throw new Error();          // This cannot happen
 }
</code></pre><p>çœ‹åˆ°è¿™é‡Œå°±å¯ä»¥æ˜ç™½äº†ï¼Œæ˜¯å¦‚ä½•åˆ›å»ºå‡ºå¯¹è±¡çš„äº†ã€‚å…ˆåœ¨hasNext()å°†æ¥å£çš„å®ç°ç±»è¿›è¡ŒåŠ è½½å¹¶åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¥å£çš„å®ç°ç±»ï¼Œç„¶ååœ¨next()æ–¹æ³•ä¸­å°†å®ç°ç±»è¿›å®ä¾‹åŒ–ã€‚</p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>Javaä¸­ä½¿ç”¨SPIæœºåˆ¶çš„åŠŸèƒ½å…¶å®æœ‰å¾ˆå¤šï¼ŒåƒJDBCã€JNDIã€ä»¥åŠSpringä¸­ä¹Ÿæœ‰ä½¿ç”¨ï¼Œç”šè‡³RPCæ¡†æ¶ï¼ˆDubboï¼‰ä¸­ä¹Ÿæœ‰ä½¿ç”¨SPIæœºåˆ¶æ¥å®ç°åŠŸèƒ½ã€‚ è¿™æ¬¡å°±æ€»ç»“åˆ°è¿™é‡Œäº†ï¼Œä»¥åèµ·ç ä¹Ÿèƒ½åœ¨é¢è¯•çš„æ—¶å€™è¯´å‡ºç‚¹å†…å®¹äº†ã€‚</p>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/articles/jvm-cpu-profiler%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E5%8F%8A%E6%BA%90%E7%A0%81%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90.md/"><span></span></a>
    </div>
    <div class="next">
        
        <a href="/documents/articles/aqs-%E4%B8%87%E5%AD%97%E5%9B%BE%E6%96%87%E5%85%A8%E9%9D%A2%E8%A7%A3%E6%9E%90.md/"><span></span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 28280 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>