<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>22 深入解读过滤器模式：制作一杯鲜纯细腻的豆浆 | Yipsen Ye</title>
<meta name="description" content="故事剧情】
 腊八已过，粥已喝，马上就要过年了！别人家的公司现在都是开年会、发现金红包、发 iPone、发平衡车什么的，而 Tony 什么也没有，只能默默地躲在朋友圈的角落里，好在最后一周还算发了一个慰问品——九阳豆浆机。
豆浆机已经有了，怎么制作一杯鲜纯细腻的豆浆呢？Tony 在网上找了一些资料，摸索了半天总算学会了，准备周末买一些大豆，自制早餐！
把浸泡过的大豆放进机器，再加入半壶水，然后选择模式并按下“启动”键，15 分钟后就可以了，但这并没有完，因为还有最关键的一步，那就是往杯子倒豆浆的时候要用过滤网把豆渣过虑掉。这样，一杯美味的阳光早餐就出来了。
 用程序来模拟生活 世间万物，唯有爱与美食不可辜负，吃的健康才能活的出彩。在上面制作豆浆的过程中，豆浆机很重要，但过滤网更关键，因为它直接影响了豆桨的质量。下面我们用程序来模拟一下这关键的步骤。
源码示例：
class FilterScreen:&amp;quot;&amp;quot;&amp;quot;过滤网&amp;quot;&amp;quot;&amp;quot;def doFilter(self, rawMaterials):for material in rawMaterials:if (material == &amp;quot;豆渣&amp;quot;):rawMaterials.remove(material)return rawMaterials测试代码：
def testFilterScreen():rawMaterials = [&amp;quot;豆浆&amp;quot;, &amp;quot;豆渣&amp;quot;]print(&amp;quot;过滤前：&amp;quot;, rawMaterials)filter = FilterScreen()filteredMaterials = filter.doFilter(rawMaterials)print(&amp;quot;过滤后：&amp;quot;, filteredMaterials)输出结果：
过滤前： [&#39;豆浆&#39;, &#39;豆渣&#39;]过滤后： [&#39;豆浆&#39;]从剧情中思考过滤器模式 在上面的示例中，豆浆机中有豆浆和豆渣，往杯子里倒的过程中，用过滤网把豆渣过滤掉才能获得更加鲜嫩细腻的豆浆。过滤网起着一个过滤的作用，在程序中也有一种类似的机制，叫过滤器模式。
过滤器模式  过滤器模式就是将一组对象，根据某种规则，过滤掉一些不符合要求的对象的过程。
 如在互联网上发布信息时敏感词汇的过滤，在 Web 接口的请求与响应时，对请求和响应信息的过滤。过滤器模式的核心思想非常简单：就是把不需要的信息过滤掉，怎么判定哪些是不需要的信息呢？这就需要制定规则。过滤的过程如下图：
举一更加形象的例子，在基建行业中，沙子是最重要的原材料之一，这些沙子很多是从江河中打捞上来的，而打捞上来的不只有沙子，还有小石头和水。若要得到这些颗粒均匀的沙子，就必须把水和石头过滤掉。
与职责模式的联系 在《[生活中的职责模式——我的假条去哪了]》一文中，我们讲了职责模式（也就是责任链模式）。过滤器与责任链的相似之处是处理过程都是一环一环地进行，不同之处在于责任链中责任的传递一般会有一定的顺序，而过滤器通常没有这种顺序，所以过滤器会比责任链还简单。
过滤器模式的模型抽象 一些熟悉 Python 的读者可能会觉得上面示例中的这种写法太麻烦了，Python 本身就自带了 filter() 函数。用下面这段代码就能轻松搞定，结果是一样的，但代码少了好几行：">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">札记</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">附表</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">关于</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/%e7%99%bd%e8%af%9d%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f28%e8%ae%b2/">白话设计模式28讲</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/00-%E7%94%9F%E6%B4%BB%E4%B8%AD%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%90%AF%E7%A8%8B%E4%B9%8B%E5%89%8D%E8%AF%B7%E4%B8%8D%E8%A6%81%E9%94%99%E8%BF%87%E6%88%91/">00 生活中的设计模式：启程之前，请不要错过我</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/01-%E7%9B%91%E5%90%AC%E6%A8%A1%E5%BC%8F%E5%9D%91%E7%88%B9%E7%9A%84%E7%83%AD%E6%B0%B4%E5%99%A8/">01 监听模式：坑爹的热水器</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/02-%E9%80%82%E9%85%8D%E6%A8%A1%E5%BC%8F%E8%BA%AB%E9%AB%98%E4%B8%8D%E5%A4%9F%E9%9E%8B%E6%9D%A5%E5%87%91/">02 适配模式：身高不够鞋来凑</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/03-%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F%E4%BA%BA%E4%B8%8E%E6%B0%B4%E7%9A%84%E4%B8%89%E6%80%81/">03 状态模式：人与水的三态</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/04-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E4%BD%A0%E6%98%AF%E6%88%91%E7%94%9F%E5%91%BD%E7%9A%84%E5%94%AF%E4%B8%80/">04 单例模式：你是我生命的唯一</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/05-%E8%81%8C%E8%B4%A3%E6%A8%A1%E5%BC%8F%E6%88%91%E7%9A%84%E5%81%87%E6%9D%A1%E5%8E%BB%E5%93%AA%E4%BA%86/">05 职责模式：我的假条去哪了</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/06-%E4%B8%AD%E4%BB%8B%E6%A8%A1%E5%BC%8F%E6%89%BE%E6%88%BF%E5%AD%90%E9%97%AE%E4%B8%AD%E4%BB%8B/">06 中介模式：找房子问中介</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/07-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%E5%B8%AE%E6%88%91%E6%8B%BF%E4%B8%80%E4%B8%8B%E5%BF%AB%E9%80%92/">07 代理模式：帮我拿一下快递</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/08-%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F%E4%BD%A0%E6%83%B3%E6%80%8E%E4%B9%88%E7%A9%BF%E5%B0%B1%E6%80%8E%E4%B9%88%E7%A9%BF/">08 装饰模式：你想怎么穿就怎么穿</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/09-%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E4%BD%A0%E8%A6%81%E6%8B%BF%E9%93%81%E8%BF%98%E6%98%AF%E6%91%A9%E5%8D%A1/">09 工厂模式：你要拿铁还是摩卡</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/10-%E8%BF%AD%E4%BB%A3%E6%A8%A1%E5%BC%8F%E4%B8%8B%E4%B8%80%E4%B8%AA%E5%B0%B1%E6%98%AF%E4%BD%A0%E4%BA%86/">10 迭代模式：下一个就是你了</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/11-%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F%E8%87%AA%E5%B7%B1%E7%BB%84%E8%A3%85%E7%94%B5%E8%84%91/">11 组合模式：自己组装电脑</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/12-%E6%9E%84%E5%BB%BA%E6%A8%A1%E5%BC%8F%E6%83%B3%E8%A6%81%E8%BD%A6%E8%BF%98%E6%98%AF%E5%BA%84%E5%9B%AD/">12 构建模式：想要车还是庄园</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/13-%E5%85%8B%E9%9A%86%E6%A8%A1%E5%BC%8F%E7%BB%99%E4%BD%A0%E4%B8%80%E4%B8%AA%E5%88%86%E8%BA%AB%E6%9C%AF/">13 克隆模式：给你一个分身术</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/14-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E6%80%8E%E4%B9%88%E6%9D%A5%E4%B8%8D%E9%87%8D%E8%A6%81%E4%BA%BA%E5%88%B0%E5%B0%B1%E8%A1%8C/">14 策略模式：怎么来不重要，人到就行</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/15-%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%E5%A4%A7%E9%97%B8%E8%9F%B9%E8%B5%B0%E8%B5%B7/">15 命令模式：大闸蟹，走起！</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/16-%E5%A4%87%E5%BF%98%E6%A8%A1%E5%BC%8F%E5%A5%BD%E8%AE%B0%E6%80%A7%E4%B8%8D%E5%A6%82%E7%83%82%E7%AC%94%E5%A4%B4/">16 备忘模式：好记性不如烂笔头</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/17-%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F%E9%A2%9C%E6%96%99%E5%BE%88%E8%B4%B5%E5%BF%85%E9%A1%BB%E5%85%85%E5%88%86%E5%88%A9%E7%94%A8/">17 享元模式：颜料很贵必须充分利用</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/18-%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F%E5%AD%A6%E5%A6%B9%E5%88%AB%E6%85%8C%E5%AD%A6%E9%95%BF%E5%B8%AE%E4%BD%A0/">18 外观模式：学妹别慌，学长帮你</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/19-%E8%AE%BF%E9%97%AE%E6%A8%A1%E5%BC%8F%E4%B8%80%E5%8D%83%E4%B8%AA%E8%AF%BB%E8%80%85%E4%B8%80%E5%8D%83%E4%B8%AA%E5%93%88%E5%A7%86%E9%9B%B7%E7%89%B9/">19 访问模式：一千个读者一千个哈姆雷特</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/20-%E7%94%9F%E6%B4%BB%E4%B8%AD%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B8%8E%E7%BB%8F%E5%85%B8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E4%B8%8D%E8%A7%A3%E6%B8%8A%E6%BA%90/">20 生活中的设计模式：与经典设计模式的不解渊源</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/21-%E7%94%9F%E6%B4%BB%E4%B8%AD%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E9%82%A3%E4%BA%9B%E6%9C%AA%E5%AE%8C%E5%BE%85%E7%BB%AD%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">21 生活中的设计模式：那些未完待续的设计模式</a></li>
                
                
                
                    <li>22 深入解读过滤器模式：制作一杯鲜纯细腻的豆浆</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/23-%E6%B7%B1%E5%85%A5%E8%A7%A3%E8%AF%BB%E5%AF%B9%E8%B1%A1%E6%B1%A0%E6%8A%80%E6%9C%AF%E5%85%B1%E4%BA%AB%E8%AE%A9%E7%94%9F%E6%B4%BB%E6%9B%B4%E4%BE%BF%E6%8D%B7/">23 深入解读对象池技术：共享让生活更便捷</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/24-%E6%B7%B1%E5%85%A5%E8%A7%A3%E8%AF%BB%E5%9B%9E%E8%B0%83%E6%9C%BA%E5%88%B6%E6%8A%8A%E4%BD%A0%E6%8A%80%E8%83%BD%E4%BA%AE%E5%87%BA%E6%9D%A5/">24 深入解读回调机制：把你技能亮出来</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/25-%E8%B0%88%E8%B0%88%E6%88%91%E5%AF%B9%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%90%86%E8%A7%A3/">25 谈谈我对设计模式的理解</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/26-%E8%B0%88%E8%B0%88%E6%88%91%E5%AF%B9%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99%E7%9A%84%E6%80%9D%E8%80%83/">26 谈谈我对设计原则的思考</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/27-%E8%B0%88%E8%B0%88%E6%88%91%E5%AF%B9%E9%A1%B9%E7%9B%AE%E9%87%8D%E6%9E%84%E7%9A%84%E7%9C%8B%E6%B3%95/">27 谈谈我对项目重构的看法</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">22 深入解读过滤器模式：制作一杯鲜纯细腻的豆浆</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">📅&nbsp;2021-12-22 01:37:12</span>🏷️&nbsp;<a class="post-tag" href="/tags/design/">design</a></div><div class="post-category">
                
                📚&nbsp;<a href="/categories/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/">白话设计模式28讲</a>
                
            </div></div>
        <div class="post-content">
            <p>故事剧情】</p>
<blockquote>
<p>腊八已过，粥已喝，马上就要过年了！别人家的公司现在都是开年会、发现金红包、发 iPone、发平衡车什么的，而 Tony 什么也没有，只能默默地躲在朋友圈的角落里，好在最后一周还算发了一个慰问品——九阳豆浆机。</p>
<p>豆浆机已经有了，怎么制作一杯鲜纯细腻的豆浆呢？Tony 在网上找了一些资料，摸索了半天总算学会了，准备周末买一些大豆，自制早餐！</p>
<p>把浸泡过的大豆放进机器，再加入半壶水，然后选择模式并按下“启动”键，15 分钟后就可以了，但这并没有完，因为还有最关键的一步，那就是往杯子倒豆浆的时候要用过滤网把豆渣过虑掉。这样，一杯美味的阳光早餐就出来了。</p>
</blockquote>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%2028%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/1b943e50-8e53-11e8-80d1-2d51ff7e1c55.jpg" alt="img"></p>
<h3 id="用程序来模拟生活">用程序来模拟生活</h3>
<p>世间万物，唯有爱与美食不可辜负，吃的健康才能活的出彩。在上面制作豆浆的过程中，豆浆机很重要，但过滤网更关键，因为它直接影响了豆桨的质量。下面我们用程序来模拟一下这关键的步骤。</p>
<p>源码示例：</p>
<pre tabindex="0"><code>class FilterScreen:
    &quot;&quot;&quot;过滤网&quot;&quot;&quot;

    def doFilter(self, rawMaterials):
        for material in rawMaterials:
            if (material == &quot;豆渣&quot;):
                rawMaterials.remove(material)
        return rawMaterials

</code></pre><p>测试代码：</p>
<pre tabindex="0"><code>def testFilterScreen():
    rawMaterials = [&quot;豆浆&quot;, &quot;豆渣&quot;]
    print(&quot;过滤前：&quot;, rawMaterials)
    filter = FilterScreen()
    filteredMaterials = filter.doFilter(rawMaterials)
    print(&quot;过滤后：&quot;, filteredMaterials)

</code></pre><p>输出结果：</p>
<pre tabindex="0"><code>过滤前： ['豆浆', '豆渣']
过滤后： ['豆浆']

</code></pre><h3 id="从剧情中思考过滤器模式">从剧情中思考过滤器模式</h3>
<p>在上面的示例中，豆浆机中有豆浆和豆渣，往杯子里倒的过程中，用过滤网把豆渣过滤掉才能获得更加鲜嫩细腻的豆浆。过滤网起着一个过滤的作用，在程序中也有一种类似的机制，叫<strong>过滤器模式</strong>。</p>
<h4 id="过滤器模式">过滤器模式</h4>
<blockquote>
<p>过滤器模式就是将一组对象，根据某种规则，过滤掉一些不符合要求的对象的过程。</p>
</blockquote>
<p>如在互联网上发布信息时敏感词汇的过滤，在 Web 接口的请求与响应时，对请求和响应信息的过滤。过滤器模式的核心思想非常简单：就是把不需要的信息过滤掉，怎么判定哪些是不需要的信息呢？这就需要制定规则。过滤的过程如下图：</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%2028%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/3e919c40-8e53-11e8-80d1-2d51ff7e1c55.jpg" alt="enter image description here"></p>
<p>举一更加形象的例子，在基建行业中，沙子是最重要的原材料之一，这些沙子很多是从江河中打捞上来的，而打捞上来的不只有沙子，还有小石头和水。若要得到这些颗粒均匀的沙子，就必须把水和石头过滤掉。</p>
<h4 id="与职责模式的联系">与职责模式的联系</h4>
<p>在《[生活中的职责模式——我的假条去哪了]》一文中，我们讲了职责模式（也就是责任链模式）。过滤器与责任链的相似之处是处理过程都是一环一环地进行，不同之处在于责任链中责任的传递一般会有一定的顺序，而过滤器通常没有这种顺序，所以过滤器会比责任链还简单。</p>
<h3 id="过滤器模式的模型抽象">过滤器模式的模型抽象</h3>
<p>一些熟悉 Python 的读者可能会觉得上面示例中的这种写法太麻烦了，Python 本身就自带了 filter() 函数。用下面这段代码就能轻松搞定，结果是一样的，但代码少了好几行：</p>
<pre tabindex="0"><code>def testFilter():
    rawMaterials = [&quot;豆浆&quot;, &quot;豆渣&quot;]
    print(&quot;过滤前：&quot;, rawMaterials)
    filteredMaterials = list(filter(isSoybeanMilk, rawMaterials))
    print(&quot;过滤后：&quot;, filteredMaterials)

def isSoybeanMilk(material):
    return material == &quot;豆浆&quot;

</code></pre><p>能提出这个问题，说明你是带思考阅读本文的。之所以要这么写，有以下两个原因：</p>
<ul>
<li>Python 自带的 filter() 是函数式编程（即面向过程式的编程），而设计模式讲述的是一种面向对象的设计思想。</li>
<li>filter() 函数只是进行简单的数组中对象的过滤，对于一些更复杂的需求（如对不符合要求的对象，不是过滤掉而是进行替换），filter() 函数是难以应付的。</li>
</ul>
<h4 id="代码框架">代码框架</h4>
<p>基于上面这些问题的思考，我们可以对过滤器模式进行进一步的重构和优化，抽象出过滤器模式的框架模型。</p>
<pre tabindex="0"><code>from abc import ABCMeta, abstractmethod
# 引入ABCMeta和abstractmethod来定义抽象类和抽象方法

class Filter(metaclass=ABCMeta):
    &quot;&quot;&quot;过滤器&quot;&quot;&quot;

    @abstractmethod
    def doFilter(self, elements):
        &quot;&quot;&quot;过滤方法&quot;&quot;&quot;
        pass

class FilterChain(Filter):
    &quot;过滤器链&quot;

    def __init__(self):
        self._filters = []

    def addFilter(self, filter):
        self._filters.append(filter)

    def removeFilter(self, filter):
        self._filters.remove(filter)

    def doFilter(self, elements):
        for filter in self._filters:
            filter.doFilter(elements)

</code></pre><h4 id="类图">类图</h4>
<p>上面的代码框架可用类图表示如下：</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%2028%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/4cd24ac0-8e53-11e8-9cd7-51dfc6c66063.jpg" alt="enter image description here"></p>
<p>Filter 是所有过滤器的抽象类，定义了统一的过滤接口 doFilter()。FilterA 和 FilterB 是具体的过滤器类，一个类定义一个过滤规则。FilterChain 是一个过滤器链，它可以包含多个过滤器，并管理这些过滤器，在过滤对象元素时，包含的每一个过滤器都会进行一次过滤。</p>
<h4 id="基于框架的实现">基于框架的实现</h4>
<p>有了上面的代码框架之后，我们要实现示例代码的功能就会更简单明确了。最开始的示例代码假设它为 version 1.0，那么再看看基于框架的 version 2.0 吧。</p>
<pre tabindex="0"><code>class FilterScreen(Filter):
    &quot;&quot;&quot;过滤网&quot;&quot;&quot;

    def doFilter(self, elements):
        for material in elements:
            if (material == &quot;豆渣&quot;):
                elements.remove(material)
        return elements

</code></pre><p>测试代码不用变。自己跑一下，会发现输出结果和之前的是一样的。</p>
<h4 id="模型说明">模型说明</h4>
<h5 id="设计要点">设计要点</h5>
<p>过滤器模式中主要有三个角色，在设计过滤器模式时要找到并区分这些角色：</p>
<ul>
<li><strong>过滤的目标（Target）：</strong> 即要被过滤的对象，通常是一个对象数组（对象列表）。</li>
<li><strong>过滤器（Filter）：</strong> 负责过滤不需要的对象，一般一个规则对应一个类。</li>
<li><strong>过滤器链（FilterChain）：</strong> 即过滤器的集合，负责管理和维护过滤器，用这个对象进行过滤时，它包含的每一个子过滤器都会进行一次过滤。这个类并不总是需要的，但如果有多个过滤器，有这个类将会带来极大的方便。</li>
</ul>
<h4 id="优缺点">优缺点</h4>
<p>优点：</p>
<ul>
<li>将对象的过滤、校验逻辑抽离出来，降低系统的复杂度。</li>
<li>过滤规则可实现重复利用。</li>
</ul>
<p>缺点：性能较低，每个过滤器都会对每一个元素进行遍历。如果有 n 个元素、m 个过滤器，则复杂度为 O(mn)。</p>
<h3 id="实战应用">实战应用</h3>
<p>我们在互联网上发布信息时，经常被进行敏感词的过滤；在表单提交的信息要以 HTML 的形式进行显示，会对一些特殊字符的进行转换。这时，我们就需要用过滤器模式对提交的信息进行过滤和处理。</p>
<p><strong>源码示例：</strong></p>
<pre tabindex="0"><code>import re
# 引入正则表达式库

class SensitiveFilter(Filter):
    &quot;&quot;&quot;敏感词过滤&quot;&quot;&quot;

    def __init__(self):
        self.__sensitives = [&quot;黄色&quot;, &quot;台独&quot;, &quot;贪污&quot;]

    def doFilter(self, elements):
        # 敏感词列表转换成正则表达式
        regex = &quot;&quot;
        for word in self.__sensitives:
            regex += word + &quot;|&quot;
        regex = regex[0: len(regex) - 1]

        # 对每个元素进行过滤
        newElements = []
        for element in elements:
            item, num = re.subn(regex, &quot;&quot;, element)
            newElements.append(item)

        return newElements

class HtmlFilter(Filter):
    &quot;HTML特殊字符转换&quot;

    def __init__(self):
        self.__wordMap = {
            &quot;&amp;&quot;: &quot;&amp;amp;&quot;,
            &quot;'&quot;: &quot; &amp;apos;&quot;,
            &quot;&gt;&quot;: &quot;&amp;gt;&quot;,
            &quot;&lt;&quot;: &quot;&amp;lt;&quot;,
            &quot;\&quot;&quot;: &quot; &amp;quot;&quot;,
        }

    def doFilter(self, elements):
        newElements = []
        for element in elements:
            for key, value in self.__wordMap.items():
                element = element.replace(key, value)
            newElements.append(element)
        return newElements

</code></pre><p><strong>测试代码：</strong></p>
<pre tabindex="0"><code>def testFiltercontent():
    contents = [
        '有人出售黄色书：&lt;黄情味道&gt;',
        '有人企图搞台独活动, ——&quot;造谣咨询&quot;',
    ]
    print(&quot;过滤前的内容：&quot;, contents)
    filterChain = FilterChain()
    filterChain.addFilter(SensitiveFilter())
    filterChain.addFilter(HtmlFilter())
    newContents = filterChain.doFilter(contents)
    print(&quot;过滤后的内容：&quot;, newContents)

</code></pre><p><strong>输出结果：</strong></p>
<pre tabindex="0"><code>过滤前的内容： ['有人出售黄色书：&lt;黄情味道&gt;', '有人企图搞台独活动, ——&quot;造谣咨询&quot;']
过滤后的内容： ['有人出售书：&amp;lt;黄情味道&amp;gt;', '有人企图搞活动, —— &amp;quot;造谣咨询 &amp;quot;']

</code></pre><h3 id="应用场景">应用场景</h3>
<ul>
<li>敏感词过滤、舆情监测。</li>
<li>需要对对象列表（或数据列表）进行检验、审查或预处理的场景。</li>
<li>对网络接口的请求和响应进行拦截，如对每一个请求和响应记录日志，以便日后分析。</li>
</ul>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/21-%E7%94%9F%E6%B4%BB%E4%B8%AD%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E9%82%A3%E4%BA%9B%E6%9C%AA%E5%AE%8C%E5%BE%85%E7%BB%AD%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><span>21 生活中的设计模式：那些未完待续的设计模式</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/design/%E7%99%BD%E8%AF%9D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F28%E8%AE%B2/23-%E6%B7%B1%E5%85%A5%E8%A7%A3%E8%AF%BB%E5%AF%B9%E8%B1%A1%E6%B1%A0%E6%8A%80%E6%9C%AF%E5%85%B1%E4%BA%AB%E8%AE%A9%E7%94%9F%E6%B4%BB%E6%9B%B4%E4%BE%BF%E6%8D%B7/"><span>23 深入解读对象池技术：共享让生活更便捷</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">💡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 28280 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>