<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>16 StatementHandlerï¼šå‚æ•°ç»‘å®šã€SQL æ‰§è¡Œå’Œç»“æœæ˜ å°„çš„å¥ åŸºè€… | Yipsen Ye</title>
<meta name="description" content="StatementHandler æ¥å£æ˜¯ MyBatis ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªæ¥å£ï¼Œå…¶å®ç°ç±»å®Œæˆ SQL è¯­å¥æ‰§è¡Œä¸­æœ€æ ¸å¿ƒçš„ä¸€ç³»åˆ—æ“ä½œï¼Œè¿™ä¹Ÿæ˜¯åé¢æˆ‘ä»¬è¦ä»‹ç»çš„ Executor æ¥å£å®ç°çš„åŸºç¡€ã€‚
StatementHandler æ¥å£çš„å®šä¹‰å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
StatementHandler æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•
å¯ä»¥çœ‹åˆ°ï¼Œå…¶ä¸­æä¾›äº†åˆ›å»º Statement å¯¹è±¡ï¼ˆprepare() æ–¹æ³•ï¼‰ã€ä¸º SQL è¯­å¥ç»‘å®šå®å‚ï¼ˆparameterize() æ–¹æ³•ï¼‰ã€æ‰§è¡Œå•æ¡ SQL è¯­å¥ï¼ˆquery() æ–¹æ³•å’Œ update() æ–¹æ³•ï¼‰ã€æ‰¹é‡æ‰§è¡Œ SQL è¯­å¥ï¼ˆbatch() æ–¹æ³•ï¼‰ç­‰å¤šç§åŠŸèƒ½ã€‚
ä¸‹å›¾å±•ç¤ºäº† MyBatis ä¸­æä¾›çš„æ‰€æœ‰ StatementHandler æ¥å£å®ç°ç±»ï¼Œä»¥åŠå®ƒä»¬çš„ç»§æ‰¿å…³ç³»ï¼š
StatementHandler æ¥å£ç»§æ‰¿å…³ç³»å›¾
ä»Šå¤©è¿™ä¸€è®²æˆ‘ä»¬å°±æ¥è¯¦ç»†åˆ†æè¯¥ç»§æ‰¿å…³ç³»å›¾ä¸­æ¯ä¸ª StatementHandler å®ç°çš„æ ¸å¿ƒé€»è¾‘ã€‚
RoutingStatementHandler RoutingStatementHandler è¿™ä¸ª StatementHandler å®ç°ï¼Œæœ‰ç‚¹ç­–ç•¥æ¨¡å¼çš„æ„å‘³ã€‚åœ¨ RoutingStatementHandler çš„æ„é€ æ–¹æ³•ä¸­ï¼Œä¼šæ ¹æ® MappedStatement ä¸­çš„ statementType å­—æ®µå€¼ï¼Œé€‰æ‹©ç›¸åº”çš„ StatementHandler å®ç°è¿›è¡Œåˆ›å»ºï¼Œè¿™ä¸ªæ–°å»ºçš„ StatementHandler å¯¹è±¡ç”± RoutingStatementHandler ä¸­çš„ delegate å­—æ®µç»´æŠ¤ã€‚
RoutingStatementHandler çš„æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š
public RoutingStatementHandler(Executor executor, MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql) {// ä¸‹é¢å°±æ˜¯æ ¹æ®MappedStatementçš„é…ç½®ï¼Œç”Ÿæˆä¸€ä¸ªç›¸åº”çš„StatementHandlerå¯¹// è±¡ï¼Œå¹¶è®¾ç½®åˆ°delegateå­—æ®µä¸­ç»´æŠ¤switch (ms.">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/%e6%b7%b1%e5%85%a5%e5%89%96%e6%9e%90mybatis%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86/">æ·±å…¥å‰–æMyBatisæ ¸å¿ƒåŸç†</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/00-%E5%BC%80%E7%AF%87%E8%AF%8D-%E9%A2%86%E7%95%A5-mybatis-%E8%AE%BE%E8%AE%A1%E6%80%9D%E7%BB%B4%E7%AA%81%E7%A0%B4%E6%8C%81%E4%B9%85%E5%8C%96%E6%8A%80%E6%9C%AF%E7%93%B6%E9%A2%88/">00 å¼€ç¯‡è¯ é¢†ç•¥ MyBatis è®¾è®¡æ€ç»´ï¼Œçªç ´æŒä¹…åŒ–æŠ€æœ¯ç“¶é¢ˆ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/01-%E5%B8%B8%E8%A7%81%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6%E8%B5%8F%E6%9E%90%E5%88%B0%E5%BA%95%E6%98%AF%E4%BB%80%E4%B9%88%E8%AE%A9%E4%BD%A0%E9%80%89%E6%8B%A9-mybatis/">01 å¸¸è§æŒä¹…å±‚æ¡†æ¶èµæï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆè®©ä½ é€‰æ‹© MyBatisï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/02-%E8%AE%A2%E5%8D%95%E7%B3%BB%E7%BB%9F%E6%8C%81%E4%B9%85%E5%B1%82%E7%A4%BA%E4%BE%8B%E5%88%86%E6%9E%9020-%E5%88%86%E9%92%9F%E5%B8%A6%E4%BD%A0%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B-mybatis/">02 è®¢å•ç³»ç»ŸæŒä¹…å±‚ç¤ºä¾‹åˆ†æï¼Œ20 åˆ†é’Ÿå¸¦ä½ å¿«é€Ÿä¸Šæ‰‹ MyBatis</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/03-mybatis-%E6%BA%90%E7%A0%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%8F%8A%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90/">03 MyBatis æºç ç¯å¢ƒæ­å»ºåŠæ•´ä½“æ¶æ„è§£æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/04-mybatis-%E5%8F%8D%E5%B0%84%E5%B7%A5%E5%85%B7%E7%AE%B1%E5%B8%A6%E4%BD%A0%E9%A2%86%E7%95%A5%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84%E5%8F%8D%E5%B0%84%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF/">04 MyBatis åå°„å·¥å…·ç®±ï¼šå¸¦ä½ é¢†ç•¥ä¸ä¸€æ ·çš„åå°„è®¾è®¡æ€è·¯</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/05-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E5%9E%8B%E4%BD%93%E7%B3%BB%E4%B8%8E-java-%E7%B1%BB%E5%9E%8B%E4%BD%93%E7%B3%BB%E4%B9%8B%E9%97%B4%E7%9A%84%E7%88%B1%E6%81%A8%E6%83%85%E4%BB%87/">05 æ•°æ®åº“ç±»å‹ä½“ç³»ä¸ Java ç±»å‹ä½“ç³»ä¹‹é—´çš„â€œçˆ±æ¨æƒ…ä»‡â€</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/06-%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6%E5%8D%83%E5%8D%83%E4%B8%87mybatis-%E9%83%BD%E8%83%BD%E5%85%BC%E5%AE%B9%E7%9A%84%E7%A7%98%E5%AF%86%E6%98%AF%E4%BB%80%E4%B9%88/">06 æ—¥å¿—æ¡†æ¶åƒåƒä¸‡ï¼ŒMyBatis éƒ½èƒ½å…¼å®¹çš„ç§˜å¯†æ˜¯ä»€ä¹ˆï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/07-%E6%B7%B1%E5%85%A5%E6%95%B0%E6%8D%AE%E6%BA%90%E5%92%8C%E4%BA%8B%E5%8A%A1%E6%8A%8A%E6%8F%A1%E6%8C%81%E4%B9%85%E5%8C%96%E6%A1%86%E6%9E%B6%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%85%B3%E9%94%AE%E5%91%BD%E8%84%89/">07 æ·±å…¥æ•°æ®æºå’Œäº‹åŠ¡ï¼ŒæŠŠæ¡æŒä¹…åŒ–æ¡†æ¶çš„ä¸¤ä¸ªå…³é”®å‘½è„‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/08-mapper-%E6%96%87%E4%BB%B6%E4%B8%8E-java-%E6%8E%A5%E5%8F%A3%E7%9A%84%E4%BC%98%E9%9B%85%E6%98%A0%E5%B0%84%E4%B9%8B%E9%81%93/">08 Mapper æ–‡ä»¶ä¸ Java æ¥å£çš„ä¼˜é›…æ˜ å°„ä¹‹é“</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/09-%E5%9F%BA%E4%BA%8E-mybatis-%E7%BC%93%E5%AD%98%E5%88%86%E6%9E%90%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">09 åŸºäº MyBatis ç¼“å­˜åˆ†æè£…é¥°å™¨æ¨¡å¼çš„æœ€ä½³å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/10-%E9%B8%9F%E7%9E%B0-mybatis-%E5%88%9D%E5%A7%8B%E5%8C%96%E6%8A%8A%E6%8F%A1-mybatis-%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E8%84%89%E7%BB%9C%E4%B8%8A/">10 é¸Ÿç° MyBatis åˆå§‹åŒ–ï¼ŒæŠŠæ¡ MyBatis å¯åŠ¨æµç¨‹è„‰ç»œï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/11-%E9%B8%9F%E7%9E%B0-mybatis-%E5%88%9D%E5%A7%8B%E5%8C%96%E6%8A%8A%E6%8F%A1-mybatis-%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E8%84%89%E7%BB%9C%E4%B8%8B/">11 é¸Ÿç° MyBatis åˆå§‹åŒ–ï¼ŒæŠŠæ¡ MyBatis å¯åŠ¨æµç¨‹è„‰ç»œï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/12-%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E5%8A%A8%E6%80%81-sql-%E8%AF%AD%E5%8F%A5%E8%A7%A3%E6%9E%90%E5%85%A8%E6%B5%81%E7%A8%8B%E4%B8%8A/">12 æ·±å…¥åˆ†æåŠ¨æ€ SQL è¯­å¥è§£æå…¨æµç¨‹ï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/13-%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E5%8A%A8%E6%80%81-sql-%E8%AF%AD%E5%8F%A5%E8%A7%A3%E6%9E%90%E5%85%A8%E6%B5%81%E7%A8%8B%E4%B8%8B/">13 æ·±å…¥åˆ†æåŠ¨æ€ SQL è¯­å¥è§£æå…¨æµç¨‹ï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/14-%E6%8E%A2%E7%A9%B6-mybatis-%E7%BB%93%E6%9E%9C%E9%9B%86%E6%98%A0%E5%B0%84%E6%9C%BA%E5%88%B6%E8%83%8C%E5%90%8E%E7%9A%84%E7%A7%98%E5%AF%86%E4%B8%8A/">14 æ¢ç©¶ MyBatis ç»“æœé›†æ˜ å°„æœºåˆ¶èƒŒåçš„ç§˜å¯†ï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/15-%E6%8E%A2%E7%A9%B6-mybatis-%E7%BB%93%E6%9E%9C%E9%9B%86%E6%98%A0%E5%B0%84%E6%9C%BA%E5%88%B6%E8%83%8C%E5%90%8E%E7%9A%84%E7%A7%98%E5%AF%86%E4%B8%8B/">15 æ¢ç©¶ MyBatis ç»“æœé›†æ˜ å°„æœºåˆ¶èƒŒåçš„ç§˜å¯†ï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li>16 StatementHandlerï¼šå‚æ•°ç»‘å®šã€SQL æ‰§è¡Œå’Œç»“æœæ˜ å°„çš„å¥ åŸºè€…</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/17-executor-%E6%89%8D%E6%98%AF%E6%89%A7%E8%A1%8C-sql-%E8%AF%AD%E5%8F%A5%E7%9A%84%E5%B9%95%E5%90%8E%E6%8E%A8%E6%89%8B%E4%B8%8A/">17 Executor æ‰æ˜¯æ‰§è¡Œ SQL è¯­å¥çš„å¹•åæ¨æ‰‹ï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/18-executor-%E6%89%8D%E6%98%AF%E6%89%A7%E8%A1%8C-sql-%E8%AF%AD%E5%8F%A5%E7%9A%84%E5%B9%95%E5%90%8E%E6%8E%A8%E6%89%8B%E4%B8%8B/">18 Executor æ‰æ˜¯æ‰§è¡Œ SQL è¯­å¥çš„å¹•åæ¨æ‰‹ï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/19-%E6%B7%B1%E5%85%A5-mybatis-%E5%86%85%E6%A0%B8%E4%B8%8E%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E7%9A%84%E6%A1%A5%E6%A2%81%E6%8E%A5%E5%8F%A3%E5%B1%82/">19 æ·±å…¥ MyBatis å†…æ ¸ä¸ä¸šåŠ¡é€»è¾‘çš„æ¡¥æ¢â€”â€”æ¥å£å±‚</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/20-%E6%8F%92%E4%BB%B6%E4%BD%93%E7%B3%BB%E8%AE%A9-mybatis-%E4%B8%96%E7%95%8C%E6%9B%B4%E5%8A%A0%E7%B2%BE%E5%BD%A9/">20 æ’ä»¶ä½“ç³»è®© MyBatis ä¸–ç•Œæ›´åŠ ç²¾å½©</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/21-%E6%B7%B1%E6%8C%96-mybatis-%E4%B8%8E-spring-%E9%9B%86%E6%88%90%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/">21 æ·±æŒ– MyBatis ä¸ Spring é›†æˆåº•å±‚åŸç†</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/22-%E5%9F%BA%E4%BA%8E-mybatis-%E7%9A%84%E8%A1%8D%E7%94%9F%E6%A1%86%E6%9E%B6%E4%B8%80%E8%A7%88/">22 åŸºäº MyBatis çš„è¡ç”Ÿæ¡†æ¶ä¸€è§ˆ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/23-%E7%BB%93%E6%9D%9F%E8%AF%AD-%E4%BC%9A%E4%BD%BF%E7%94%A8%E5%8F%AA%E8%83%BD%E9%BB%98%E9%BB%98%E6%90%AC%E7%A0%96%E6%87%82%E5%8E%9F%E7%90%86%E6%89%8D%E8%83%BD%E5%BF%AB%E9%80%9F%E6%99%8B%E5%8D%87/">23 ç»“æŸè¯­ ä¼šä½¿ç”¨åªèƒ½é»˜é»˜â€œæ¬ç –â€ï¼Œæ‡‚åŸç†æ‰èƒ½å¿«é€Ÿæ™‹å‡</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">16 StatementHandlerï¼šå‚æ•°ç»‘å®šã€SQL æ‰§è¡Œå’Œç»“æœæ˜ å°„çš„å¥ åŸºè€…</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2021-12-22 01:51:18</span>ğŸ·ï¸&nbsp;<a class="post-tag" href="/tags/mybatis/">mybatis</a></div><div class="post-category">
                
                ğŸ“š&nbsp;<a href="/categories/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/">æ·±å…¥å‰–æMyBatisæ ¸å¿ƒåŸç†</a>
                
            </div></div>
        <div class="post-content">
            <p><strong>StatementHandler æ¥å£æ˜¯ MyBatis ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªæ¥å£</strong>ï¼Œå…¶å®ç°ç±»å®Œæˆ SQL è¯­å¥æ‰§è¡Œä¸­æœ€æ ¸å¿ƒçš„ä¸€ç³»åˆ—æ“ä½œï¼Œè¿™ä¹Ÿæ˜¯åé¢æˆ‘ä»¬è¦ä»‹ç»çš„ Executor æ¥å£å®ç°çš„åŸºç¡€ã€‚</p>
<p>StatementHandler æ¥å£çš„å®šä¹‰å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%20MyBatis%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86-%E5%AE%8C/assets/Cgp9HWBRyPSAPnqwAADa0tXnYqQ008.png" alt="Drawing 0.png"></p>
<p>StatementHandler æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶ä¸­æä¾›äº†åˆ›å»º Statement å¯¹è±¡ï¼ˆprepare() æ–¹æ³•ï¼‰ã€ä¸º SQL è¯­å¥ç»‘å®šå®å‚ï¼ˆparameterize() æ–¹æ³•ï¼‰ã€æ‰§è¡Œå•æ¡ SQL è¯­å¥ï¼ˆquery() æ–¹æ³•å’Œ update() æ–¹æ³•ï¼‰ã€æ‰¹é‡æ‰§è¡Œ SQL è¯­å¥ï¼ˆbatch() æ–¹æ³•ï¼‰ç­‰å¤šç§åŠŸèƒ½ã€‚</p>
<p>ä¸‹å›¾å±•ç¤ºäº† MyBatis ä¸­æä¾›çš„æ‰€æœ‰ StatementHandler æ¥å£å®ç°ç±»ï¼Œä»¥åŠå®ƒä»¬çš„ç»§æ‰¿å…³ç³»ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%20MyBatis%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86-%E5%AE%8C/assets/Cgp9HWBR0IaAXG4BAAGLvM_7w1Y255.png" alt="å›¾ç‰‡3.png"></p>
<p>StatementHandler æ¥å£ç»§æ‰¿å…³ç³»å›¾</p>
<p>ä»Šå¤©è¿™ä¸€è®²æˆ‘ä»¬å°±æ¥è¯¦ç»†åˆ†æè¯¥ç»§æ‰¿å…³ç³»å›¾ä¸­æ¯ä¸ª StatementHandler å®ç°çš„æ ¸å¿ƒé€»è¾‘ã€‚</p>
<h3 id="routingstatementhandler">RoutingStatementHandler</h3>
<p>RoutingStatementHandler è¿™ä¸ª StatementHandler å®ç°ï¼Œæœ‰ç‚¹<strong>ç­–ç•¥æ¨¡å¼</strong>çš„æ„å‘³ã€‚åœ¨ RoutingStatementHandler çš„æ„é€ æ–¹æ³•ä¸­ï¼Œä¼šæ ¹æ® MappedStatement ä¸­çš„ statementType å­—æ®µå€¼ï¼Œé€‰æ‹©ç›¸åº”çš„ StatementHandler å®ç°è¿›è¡Œåˆ›å»ºï¼Œè¿™ä¸ªæ–°å»ºçš„ StatementHandler å¯¹è±¡ç”± RoutingStatementHandler ä¸­çš„ delegate å­—æ®µç»´æŠ¤ã€‚</p>
<p>RoutingStatementHandler çš„æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>public RoutingStatementHandler(Executor executor, MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql) {

    // ä¸‹é¢å°±æ˜¯æ ¹æ®MappedStatementçš„é…ç½®ï¼Œç”Ÿæˆä¸€ä¸ªç›¸åº”çš„StatementHandlerå¯¹

    // è±¡ï¼Œå¹¶è®¾ç½®åˆ°delegateå­—æ®µä¸­ç»´æŠ¤

    switch (ms.getStatementType()) {

        case STATEMENT:

            // åˆ›å»ºSimpleStatementHandlerå¯¹è±¡

            delegate = new SimpleStatementHandler(executor, ms, parameter, rowBounds, resultHandler, boundSql);

            break;

        case PREPARED:

            // åˆ›å»ºPreparedStatementHandlerå¯¹è±¡

            delegate = new PreparedStatementHandler(executor, ms, parameter, rowBounds, resultHandler, boundSql);

            break;

        case CALLABLE:

            // åˆ›å»ºCallableStatementHandlerå¯¹è±¡

            delegate = new CallableStatementHandler(executor, ms, parameter, rowBounds, resultHandler, boundSql);

            break;

        default: // æŠ›å‡ºå¼‚å¸¸

            throw new ExecutorException(&quot;...&quot;);

    }

}
</code></pre><p>åœ¨ RoutingStatementHandler çš„å…¶ä»–æ–¹æ³•ä¸­ï¼Œ<strong>éƒ½ä¼šå§”æ‰˜ç»™åº•å±‚çš„ delegate å¯¹è±¡æ¥å®Œæˆå…·ä½“çš„é€»è¾‘</strong>ã€‚</p>
<h3 id="basestatementhandler">BaseStatementHandler</h3>
<p>ä½œä¸ºä¸€ä¸ªæŠ½è±¡ç±»ï¼ŒBaseStatementHandler åªå®ç°äº† StatementHandler æ¥å£çš„ prepare() æ–¹æ³•ï¼Œå…¶ prepare() æ–¹æ³•å®ç°ä¸ºæ–°å»ºçš„ Statement å¯¹è±¡è®¾ç½®äº†ä¸€äº›å‚æ•°ï¼Œä¾‹å¦‚ï¼Œtimeoutã€fetchSize ç­‰ã€‚BaseStatementHandler è¿˜æ–°å¢äº†ä¸€ä¸ª instantiateStatement() æŠ½è±¡æ–¹æ³•ç»™å­ç±»å®ç°ï¼Œæ¥å®Œæˆ Statement å¯¹è±¡çš„å…¶ä»–åˆå§‹åŒ–æ“ä½œã€‚ä¸è¿‡ï¼ŒBaseStatementHandler ä¸­å¹¶æ²¡æœ‰å®ç° StatementHandler æ¥å£ä¸­çš„æ•°æ®åº“æ“ä½œç­‰æ ¸å¿ƒæ–¹æ³•ã€‚</p>
<p>äº†è§£äº† BaseStatementHandler å¯¹ StatementHandler æ¥å£çš„å®ç°æƒ…å†µä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ BaseStatementHandler çš„æ„é€ æ–¹æ³•ï¼Œå…¶ä¸­ä¼š<strong>åˆå§‹åŒ–æ‰§è¡Œ SQL éœ€è¦çš„ Executor å¯¹è±¡</strong>ã€<strong>ä¸º SQL ç»‘å®šå®å‚çš„ ParameterHandler å¯¹è±¡</strong>ä»¥åŠ<strong>ç”Ÿæˆç»“æœå¯¹è±¡çš„ ResultSetHandler å¯¹è±¡</strong>ã€‚è¿™ä¸‰ä¸ªæ ¸å¿ƒå¯¹è±¡ä¸­ï¼ŒResultSetHandler å¯¹è±¡æˆ‘ä»¬å·²ç»åœ¨[ã€Š14 | æ¢ç©¶ MyBatis ç»“æœé›†æ˜ å°„æœºåˆ¶èƒŒåçš„ç§˜å¯†ï¼ˆä¸Šï¼‰ã€‹]ä¸­ä»‹ç»è¿‡äº†ï¼ŒParameterHandler å’Œ Executor åœ¨åé¢ä¼šå±•å¼€ä»‹ç»ã€‚</p>
<h4 id="1-keygenerator">1. KeyGenerator</h4>
<p>è¿™é‡Œéœ€è¦å…³æ³¨çš„æ˜¯ generateKeys() æ–¹æ³•ï¼Œå…¶ä¸­ä¼š<strong>é€šè¿‡ KeyGenerator æ¥å£ç”Ÿæˆä¸»é”®</strong>ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹ KeyGenerator æ¥å£çš„ç›¸å…³å†…å®¹ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ä¸åŒæ•°æ®åº“çš„è‡ªå¢ id ç”Ÿæˆç­–ç•¥å¹¶ä¸å®Œå…¨ä¸€æ ·ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¸¸è§çš„ Oracle DB æ˜¯é€šè¿‡sequence å®ç°è‡ªå¢ id çš„ï¼Œå¦‚æœä½¿ç”¨è‡ªå¢ id ä½œä¸ºä¸»é”®ï¼Œå°±éœ€è¦æˆ‘ä»¬å…ˆè·å–åˆ°è¿™ä¸ªè‡ªå¢çš„ id å€¼ï¼Œç„¶åå†ä½¿ç”¨ï¼›MySQL åœ¨ä½¿ç”¨è‡ªå¢ id ä½œä¸ºä¸»é”®çš„æ—¶å€™ï¼Œinsert è¯­å¥ä¸­å¯ä»¥ä¸æŒ‡å®šä¸»é”®ï¼Œåœ¨æ’å…¥è¿‡ç¨‹ä¸­ç”± MySQL è‡ªåŠ¨ç”Ÿæˆ idã€‚KeyGenerator æ¥å£æ”¯æŒ insert è¯­å¥æ‰§è¡Œå‰åè·å–è‡ªå¢çš„ idï¼Œåˆ†åˆ«å¯¹åº” processBefore() æ–¹æ³•å’Œ processAfter() æ–¹æ³•ï¼Œä¸‹å›¾å±•ç¤ºäº† MyBatis æä¾›çš„ä¸¤ä¸ª KeyGenerator æ¥å£å®ç°ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%20MyBatis%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86-%E5%AE%8C/assets/Cgp9HWBR0HmAAYIQAAE2FEB8sfU102.png" alt="å›¾ç‰‡4.png"></p>
<p>KeyGenerator æ¥å£ç»§æ‰¿å…³ç³»å›¾</p>
<p><strong>Jdbc3KeyGenerator ç”¨äºè·å–æ•°æ®åº“ç”Ÿæˆçš„è‡ªå¢ idï¼ˆä¾‹å¦‚ MySQL é‚£ç§ç”Ÿæˆæ¨¡å¼ï¼‰</strong>ï¼Œå…¶ processBefore() æ–¹æ³•æ˜¯ç©ºå®ç°ï¼ŒprocessAfter() æ–¹æ³•ä¼šå°† insert è¯­å¥æ‰§è¡Œåç”Ÿæˆçš„ä¸»é”®ä¿å­˜åˆ°ç”¨æˆ·ä¼ é€’çš„å®å‚ä¸­ã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨ MyBatis æ‰§è¡Œå•è¡Œ insert è¯­å¥æ—¶ï¼Œä¸€èˆ¬ä¼ å…¥çš„å®å‚æ˜¯ä¸€ä¸ª POJO å¯¹è±¡æˆ–æ˜¯ Map å¯¹è±¡ï¼Œç”Ÿæˆçš„ä¸»é”®ä¼šè®¾ç½®åˆ°å¯¹åº”çš„å±æ€§ä¸­ï¼›æ‰§è¡Œå¤šæ¡ insert è¯­å¥æ—¶ï¼Œä¸€èˆ¬ä¼ å…¥å®å‚æ˜¯ POJO å¯¹è±¡é›†åˆæˆ– Map å¯¹è±¡çš„æ•°ç»„æˆ–é›†åˆï¼Œé›†åˆä¸­æ¯ä¸€ä¸ªå…ƒç´ éƒ½å¯¹åº”ä¸€æ¬¡æ’å…¥æ“ä½œï¼Œç”Ÿæˆçš„å¤šä¸ªè‡ªå¢ id ä¹Ÿä¼šè®¾ç½®åˆ°æ¯ä¸ªå…ƒç´ çš„ç›¸åº”å±æ€§ä¸­ã€‚</p>
<p>Jdbc3KeyGenerator ä¸­è·å–æ•°æ®åº“è‡ªå¢ id çš„æ ¸å¿ƒä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>// å°†æ•°æ®åº“ç”Ÿæˆçš„è‡ªå¢idä½œä¸ºç»“æœé›†è¿”å›

try (ResultSet rs = stmt.getGeneratedKeys()) { 

    final ResultSetMetaData rsmd = rs.getMetaData();

    final Configuration configuration = ms.getConfiguration();

    if (rsmd.getColumnCount() &lt; keyProperties.length) {

    } else {

        // å¤„ç†rsè¿™ä¸ªç»“æœé›†ï¼Œå°†ç”Ÿæˆçš„idè®¾ç½®åˆ°å¯¹åº”çš„å±æ€§ä¸­

        assignKeys(configuration, rs, rsmd, keyProperties, parameter);

    }

} catch (Exception e) {

    throw new ExecutorException(&quot;...&quot;);

}
</code></pre><p><strong>å¦‚æœä½¿ç”¨åƒ Oracle è¿™ç§ä¸æ”¯æŒè‡ªåŠ¨ç”Ÿæˆä¸»é”®è‡ªå¢ id çš„æ•°æ®åº“æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SelectkeyGenerator æ¥ç”Ÿæˆä¸»é”® id</strong>ã€‚Mapper æ˜ å°„æ–‡ä»¶ä¸­çš„<code>&lt;selectKey&gt;</code>æ ‡ç­¾ä¼šè¢«è§£ææˆ SelectkeyGenerator å¯¹è±¡ï¼Œå…¶ä¸­çš„ executeBefore å±æ€§ï¼ˆboolean ç±»å‹ï¼‰å†³å®šäº†æ˜¯åœ¨ insert è¯­å¥æ‰§è¡Œä¹‹å‰è·å–ä¸»é”®ï¼Œè¿˜æ˜¯åœ¨ insert è¯­å¥æ‰§è¡Œä¹‹åè·å–ä¸»é”® idã€‚</p>
<p>SelectkeyGenerator ä¸­çš„ processBefore() æ–¹æ³•å’Œ processAfter() æ–¹æ³•éƒ½æ˜¯é€šè¿‡ processGeneratedKeys() è¿™ä¸ªç§æœ‰æ–¹æ³•è·å–ä¸»é”® id çš„ï¼ŒprocessGeneratedKeys() æ–¹æ³•ä¼šæ‰§è¡Œ<code>&lt;selectKey&gt;</code>æ ‡ç­¾ä¸­æŒ‡å®šçš„ select è¯­å¥ï¼ŒæŸ¥è¯¢ä¸»é”®ä¿¡æ¯ï¼Œå¹¶è®°å½•åˆ°ç”¨æˆ·ä¼ å…¥çš„å®å‚å¯¹è±¡çš„å¯¹åº”å±æ€§ä¸­ï¼Œæ ¸å¿ƒä»£ç ç‰‡æ®µå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>// åˆ›å»ºä¸€ä¸ªæ–°çš„Executorå¯¹è±¡æ¥æ‰§è¡ŒæŒ‡å®šçš„selectè¯­å¥

Executor keyExecutor = configuration.newExecutor(executor.getTransaction(), ExecutorType.SIMPLE);

// æ‹¿åˆ°ä¸»é”®ä¿¡æ¯

List&lt;Object&gt; values = keyExecutor.query(keyStatement, parameter, RowBounds.DEFAULT, Executor.NO_RESULT_HANDLER);

if (values.size() == 0) {

    throw new ExecutorException(&quot;SelectKey returned no data.&quot;);

} else if (values.size() &gt; 1) {

    throw new ExecutorException(&quot;SelectKey returned more than one value.&quot;);

} else {

    // åˆ›å»ºå®å‚å¯¹è±¡çš„MetaObjectå¯¹è±¡

    final MetaObject metaParam = configuration.newMetaObject(parameter);

    MetaObject metaResult = configuration.newMetaObject(values.get(0));

    if (keyProperties.length == 1) {

        // å°†ä¸»é”®ä¿¡æ¯è®°å½•åˆ°ç”¨æˆ·ä¼ å…¥çš„å®å‚å¯¹è±¡ä¸­

        if (metaResult.hasGetter(keyProperties[0])) {

            setValue(metaParam, keyProperties[0], metaResult.getValue(keyProperties[0]));

        } else {

            setValue(metaParam, keyProperties[0], values.get(0));

        }

    } else {

        ... // å¤šç»“æœé›†çš„å¤„ç†

    }

}
</code></pre><h4 id="2-parameterhandler">2. ParameterHandler</h4>
<p>ä»‹ç»å®Œ KeyGenerator æ¥å£ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ BaseStatementHandler ä¸­ä¾èµ–çš„å¦ä¸€ä¸ªè¾…åŠ©ç±»â€”â€” ParameterHandlerã€‚</p>
<p>ç»è¿‡å‰é¢[ã€Š13 | æ·±å…¥åˆ†æåŠ¨æ€ SQL è¯­å¥è§£æå…¨æµç¨‹ï¼ˆä¸‹ï¼‰ã€‹]ä»‹ç»çš„ä¸€ç³»åˆ— SqlNode çš„å¤„ç†ä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°çš„ SQL è¯­å¥ï¼ˆç»´æŠ¤åœ¨ BoundSql å¯¹è±¡ä¸­ï¼‰å¯èƒ½åŒ…å«å¤šä¸ªâ€œ?â€å ä½ç¬¦ï¼Œä¸æ­¤åŒæ—¶ï¼Œç”¨äºæ›¿æ¢æ¯ä¸ªâ€œ?â€å ä½ç¬¦çš„å®å‚éƒ½è®°å½•åœ¨ BoundSql.parameterMappings é›†åˆä¸­ã€‚</p>
<p>ParameterHandler æ¥å£ä¸­å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼šä¸€ä¸ªæ˜¯ getParameterObject() æ–¹æ³•ï¼Œç”¨æ¥è·å–ä¼ å…¥çš„å®å‚å¯¹è±¡ï¼›å¦ä¸€ä¸ªæ˜¯ setParameters() æ–¹æ³•ï¼Œç”¨æ¥æ›¿æ¢â€œ?â€å ä½ç¬¦ï¼Œè¿™æ˜¯ ParameterHandler çš„<strong>æ ¸å¿ƒæ–¹æ³•</strong>ã€‚</p>
<p><strong>DefaultParameterHandler æ˜¯ ParameterHandler æ¥å£çš„å”¯ä¸€å®ç°ï¼Œå…¶ setParameters() æ–¹æ³•ä¼šéå† BoundSql.parameterMappings é›†åˆ</strong>ï¼Œæ ¹æ®å‚æ•°åç§°æŸ¥æ‰¾ç›¸åº”å®å‚ï¼Œæœ€åä¼šé€šè¿‡ PreparedStatement.set*() æ–¹æ³•ä¸ SQL è¯­å¥è¿›è¡Œç»‘å®šã€‚setParameters() æ–¹æ³•çš„å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>for (int i = 0; i &lt; parameterMappings.size(); i++) {

    ParameterMapping parameterMapping = parameterMappings.get(i);

    Object value;

    String propertyName = parameterMapping.getProperty();

    // è·å–å®å‚å€¼

    if (boundSql.hasAdditionalParameter(propertyName)) {

        value = boundSql.getAdditionalParameter(propertyName);

    } else if (parameterObject == null) {

        value = null;

    } else if (typeHandlerRegistry.hasTypeHandler(parameterObject.getClass())) {

        value = parameterObject;

    } else {

        MetaObject metaObject = configuration.newMetaObject(parameterObject);

        value = metaObject.getValue(propertyName);

    }

    // è·å–TypeHandler

    TypeHandler typeHandler = parameterMapping.getTypeHandler();

    JdbcType jdbcType = parameterMapping.getJdbcType();

    // åº•å±‚ä¼šè°ƒç”¨PreparedStatement.set*()æ–¹æ³•å®Œæˆç»‘å®š

    typeHandler.setParameter(ps, i + 1, value, jdbcType);

}
</code></pre><h3 id="simplestatementhandler">SimpleStatementHandler</h3>
<p>SimpleStatementHandler æ˜¯ StatementHandler çš„å…·ä½“å®ç°ä¹‹ä¸€ï¼Œç»§æ‰¿äº† BaseStatementHandler æŠ½è±¡ç±»ã€‚SimpleStatementHandler å„ä¸ªæ–¹æ³•æ¥æ”¶çš„æ˜¯ java.sql.Statement å¯¹è±¡ï¼Œå¹¶é€šè¿‡è¯¥å¯¹è±¡æ¥å®Œæˆ CRUD æ“ä½œï¼Œæ‰€ä»¥åœ¨ SimpleStatementHandler ä¸­<strong>ç»´æŠ¤çš„ SQL è¯­å¥ä¸èƒ½å­˜åœ¨â€œ?â€å ä½ç¬¦</strong>ï¼Œå¡«å……å ä½ç¬¦çš„ parameterize() æ–¹æ³•ä¹Ÿæ˜¯ç©ºå®ç°ã€‚</p>
<p>åœ¨ instantiateStatement() è¿™ä¸ªåˆå§‹åŒ–æ–¹æ³•ä¸­ï¼ŒSimpleStatementHandler ä¼šç›´æ¥é€šè¿‡ JDBC Connection åˆ›å»º Statement å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¹Ÿæ˜¯åç»­ SimpleStatementHandler å…¶ä»–æ–¹æ³•çš„å…¥å‚ã€‚</p>
<p>åœ¨ query() æ–¹æ³•å®ç°ä¸­ï¼ŒSimpleStatementHandler ä¼šç›´æ¥é€šè¿‡ä¸Šé¢åˆ›å»ºçš„ Statement å¯¹è±¡ï¼Œæ‰§è¡Œ SQL è¯­å¥ï¼Œè¿”å›çš„ç»“æœé›†ç”± ResultSetHandler å®Œæˆæ˜ å°„ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>public &lt;E&gt; List&lt;E&gt; query(Statement statement, ResultHandler resultHandler) throws SQLException {ã€

    // è·å–SQLè¯­å¥

    String sql = boundSql.getSql();

    // æ‰§è¡ŒSQLè¯­å¥

    statement.execute(sql);

    // å¤„ç†ResultSetæ˜ å°„ï¼Œå¾—åˆ°ç»“æœå¯¹è±¡

    return resultSetHandler.handleResultSets(statement);

}
</code></pre><p>queryCursor() æ–¹æ³•ä¸ query() æ–¹æ³•å®ç°ç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚</p>
<p>batch() æ–¹æ³•è°ƒç”¨çš„æ˜¯ Statement.addBatch() æ–¹æ³•æ·»åŠ æ‰¹é‡æ‰§è¡Œçš„ SQL è¯­å¥ï¼Œä½†å¹¶ä¸æ˜¯ç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯ç­‰å¾… Statement.executeBatch() æ–¹æ³•æ‰§è¡Œæ—¶æ‰ä¼šæ‰¹é‡æ‰§è¡Œï¼Œè¿™ç‚¹ä½ ç¨å¾®æ³¨æ„ä¸€ä¸‹å³å¯ã€‚</p>
<p>è‡³äº update() æ–¹æ³•ï¼Œé¦–å…ˆä¼šé€šè¿‡ Statement.execute() æ–¹æ³•æ‰§è¡Œ insertã€update æˆ– delete ç±»å‹çš„ SQL è¯­å¥ï¼Œç„¶åæ‰§è¡Œ KeyGenerator.processAfter() æ–¹æ³•æŸ¥è¯¢ä¸»é”®å¹¶å¡«å……ç›¸åº”å±æ€§ï¼ˆprocessBefore() æ–¹æ³•å·²ç»åœ¨ prepare() æ–¹æ³•ä¸­æ‰§è¡Œè¿‡äº†ï¼‰ï¼Œæœ€åé€šè¿‡ Statement.getUpdateCount() æ–¹æ³•è·å– SQL è¯­å¥å½±å“çš„è¡Œæ•°å¹¶è¿”å›ã€‚</p>
<h3 id="preparedstatementhandler">PreparedStatementHandler</h3>
<p>PreparedStatementHandler æ˜¯ StatementHandler çš„å…·ä½“å®ç°ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ StatementHandler å®ç°ï¼Œå®ƒåŒæ ·ç»§æ‰¿äº† BaseStatementHandler æŠ½è±¡ç±»ã€‚PreparedStatementHandler å„ä¸ªæ–¹æ³•æ¥æ”¶çš„æ˜¯ java.sql.PreparedStatement å¯¹è±¡ï¼Œå¹¶é€šè¿‡è¯¥å¯¹è±¡æ¥å®Œæˆ CRUD æ“ä½œï¼Œåœ¨å…¶ parameterize() æ–¹æ³•ä¸­ä¼šé€šè¿‡å‰é¢ä»‹ç»çš„ ParameterHandlerè°ƒç”¨ PreparedStatement.set*() æ–¹æ³•ä¸º SQL è¯­å¥ç»‘å®šå‚æ•°ï¼Œæ‰€ä»¥åœ¨ PreparedStatementHandler ä¸­<strong>ç»´æŠ¤çš„ SQL è¯­å¥æ˜¯å¯ä»¥åŒ…å«â€œ?â€å ä½ç¬¦çš„</strong>ã€‚</p>
<p>åœ¨ instantiateStatement() æ–¹æ³•ä¸­ï¼ŒPreparedStatementHandler ä¼šç›´æ¥é€šè¿‡ JDBC Connection çš„ prepareStatement() æ–¹æ³•åˆ›å»º PreparedStatement å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°±æ˜¯ PreparedStatementHandler å…¶ä»–æ–¹æ³•çš„å…¥å‚ã€‚</p>
<p>PreparedStatementHandler çš„ query() æ–¹æ³•ã€batch() æ–¹æ³•ä»¥åŠ update() æ–¹æ³•ä¸ SimpleStatementHandler çš„å®ç°åŸºæœ¬ç›¸åŒï¼Œåªä¸è¿‡æ˜¯æŠŠ Statement API æ¢æˆäº† PrepareStatement API è€Œå·²ã€‚ä¸‹é¢æˆ‘ä»¬ä»¥ update() æ–¹æ³•ä¸ºä¾‹è¿›è¡Œç®€å•ä»‹ç»ï¼š</p>
<pre tabindex="0"><code>public int update(Statement statement) throws SQLException {

    PreparedStatement ps = (PreparedStatement) statement;

    ps.execute(); // æ‰§è¡ŒSQLè¯­å¥ï¼Œä¿®æ”¹æ•°æ®

    int rows = ps.getUpdateCount(); // è·å–å½±å“è¡Œæ•°

    // è·å–å®å‚å¯¹è±¡

    Object parameterObject = boundSql.getParameterObject();

    // æ‰§è¡ŒKeyGenerator

    KeyGenerator keyGenerator = mappedStatement.getKeyGenerator();

    keyGenerator.processAfter(executor, mappedStatement, ps, parameterObject);

    return rows; // è¿”å›å½±å“è¡Œæ•°

}
</code></pre><h3 id="callablestatementhandler">CallableStatementHandler</h3>
<p><strong>CallableStatementHandler æ˜¯å¤„ç†å­˜å‚¨è¿‡ç¨‹çš„ StatementHandler å®ç°</strong>ï¼Œå…¶ instantiateStatement() æ–¹æ³•ä¼šé€šè¿‡ JDBC Connection çš„ prepareCall() æ–¹æ³•ä¸ºæŒ‡å®šå­˜å‚¨è¿‡ç¨‹åˆ›å»ºå¯¹åº”çš„ java.sql.CallableStatement å¯¹è±¡ã€‚åœ¨ parameterize() æ–¹æ³•ä¸­ï¼ŒCallableStatementHandler é™¤äº†ä¼šé€šè¿‡ ParameterHandler å®Œæˆå®å‚çš„ç»‘å®šä¹‹å¤–ï¼Œè¿˜ä¼šæŒ‡å®šè¾“å‡ºå‚æ•°çš„ä½ç½®å’Œç±»å‹ã€‚</p>
<p>åœ¨ CallableStatementHandler çš„ query()ã€queryCursor()ã€update() æ–¹æ³•ä¸­ï¼Œé™¤äº†å¤„ç† SQL è¯­å¥æœ¬èº«çš„ç»“æœé›†ï¼ˆResultSet ç»“æœé›†æˆ–æ˜¯å½±å“è¡Œæ•°ï¼‰ï¼Œè¿˜ä¼šé€šè¿‡ ResultSetHandler çš„ handleOutputParameters() æ–¹æ³•å¤„ç†è¾“å‡ºå‚æ•°ï¼Œè¿™æ˜¯ä¸ PreparedStatementHandler æœ€å¤§çš„ä¸åŒã€‚ä¸‹é¢æˆ‘ä»¬ä»¥ query() æ–¹æ³•ä¸ºä¾‹è¿›è¡Œç®€å•åˆ†æï¼š</p>
<pre tabindex="0"><code>public &lt;E&gt; List&lt;E&gt; query(Statement statement, ResultHandler resultHandler) throws SQLException {

    CallableStatement cs = (CallableStatement) statement;

    cs.execute(); // æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹

    // å¤„ç†å­˜å‚¨è¿‡ç¨‹è¿”å›çš„ç»“æœé›†

    List&lt;E&gt; resultList = resultSetHandler.handleResultSets(cs);

    // å¤„ç†è¾“å‡ºå‚æ•°ï¼Œå¯èƒ½ä¿®æ”¹resultListé›†åˆ

    resultSetHandler.handleOutputParameters(cs);

    // è¿”å›æœ€åçš„ç»“æœå¯¹è±¡

    return resultList;

}
</code></pre><h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>è¿™ä¸€è®²æˆ‘ä»¬é‡ç‚¹è®²è§£äº† MyBatis ä¸­çš„ StatementHandler æ¥å£åŠå…¶æ ¸å¿ƒå®ç°ï¼ŒStatementHandler æ¥å£ä¸­å®šä¹‰äº†æ‰§è¡Œä¸€æ¡ SQL è¯­å¥çš„æ ¸å¿ƒæ–¹æ³•ã€‚</p>
<ul>
<li>é¦–å…ˆï¼Œåˆ†æäº† RoutingStatementHandler å®ç°ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬é€‰æ‹©çœŸæ­£çš„ StatementHandler å®ç°ç±»ã€‚</li>
<li>æ¥ä¸‹æ¥ï¼Œä»‹ç»äº† BaseStatementHandler è¿™ä¸ªæŠ½è±¡ç±»çš„å®ç°ï¼ŒåŒæ—¶è¿˜è¯¦ç»†é˜è¿°äº†å…¶ä¸­ä½¿ç”¨åˆ°çš„ KeyGenerator å’Œ ParameterHandlerã€‚</li>
<li>æœ€åï¼Œåˆä»‹ç»äº† SimpleStatementHandlerã€PreparedStatementHandler ç­‰å®ç°ï¼Œå®ƒä»¬åŸºäº JDBC API æ¥å£ï¼Œå®ç°äº†å®Œæ•´çš„ StatementHandler åŠŸèƒ½ã€‚</li>
</ul>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/15-%E6%8E%A2%E7%A9%B6-mybatis-%E7%BB%93%E6%9E%9C%E9%9B%86%E6%98%A0%E5%B0%84%E6%9C%BA%E5%88%B6%E8%83%8C%E5%90%8E%E7%9A%84%E7%A7%98%E5%AF%86%E4%B8%8B/"><span>15 æ¢ç©¶ MyBatis ç»“æœé›†æ˜ å°„æœºåˆ¶èƒŒåçš„ç§˜å¯†ï¼ˆä¸‹ï¼‰</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/17-executor-%E6%89%8D%E6%98%AF%E6%89%A7%E8%A1%8C-sql-%E8%AF%AD%E5%8F%A5%E7%9A%84%E5%B9%95%E5%90%8E%E6%8E%A8%E6%89%8B%E4%B8%8A/"><span>17 Executor æ‰æ˜¯æ‰§è¡Œ SQL è¯­å¥çš„å¹•åæ¨æ‰‹ï¼ˆä¸Šï¼‰</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 27270 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>