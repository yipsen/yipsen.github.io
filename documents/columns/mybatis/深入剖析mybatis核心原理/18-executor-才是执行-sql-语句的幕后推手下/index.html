<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>18 Executor æ‰æ˜¯æ‰§è¡Œ SQL è¯­å¥çš„å¹•åæ¨æ‰‹ï¼ˆä¸‹ï¼‰ | Yipsen Ye</title>
<meta name="description" content="åœ¨ä¸Šä¸€è®²ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä»‹ç»äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ç›¸å…³çŸ¥è¯†ï¼Œç„¶åä»‹ç»äº† Executor æ¥å£çš„æ ¸å¿ƒæ–¹æ³•ï¼Œæœ€ååˆ†æäº† BaseExecutor æŠ½è±¡ç±»æ˜¯å¦‚ä½•åˆ©ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸ºå…¶ä»– Executor æŠ½è±¡äº†ä¸€çº§ç¼“å­˜å’Œäº‹åŠ¡ç®¡ç†çš„èƒ½åŠ›ã€‚è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å†æ¥ä»‹ç»å‰©ä½™çš„å››ä¸ªé‡ç‚¹ Executor å®ç°ã€‚
Executor æ¥å£ç»§æ‰¿å…³ç³»å›¾
SimpleExecutor æˆ‘ä»¬æ¥çœ‹ BaseExecutor çš„ç¬¬ä¸€ä¸ªå­ç±»â€”â€” SimpleExecutorï¼ŒåŒæ—¶å®ƒä¹Ÿæ˜¯ Executor æ¥å£æœ€ç®€å•çš„å®ç°ã€‚
æ­£å¦‚ä¸Šä¸€è®²ä¸­åˆ†æçš„é‚£æ ·ï¼ŒBaseExecutor é€šè¿‡æ¨¡æ¿æ–¹æ³•æ¨¡å¼å®ç°äº†è¯»å†™ä¸€çº§ç¼“å­˜ã€äº‹åŠ¡ç®¡ç†ç­‰ä¸éšåœºæ™¯å˜åŒ–çš„åŸºç¡€æ–¹æ³•ï¼Œåœ¨ SimpleExecutorã€ReuseExecutorã€BatchExecutor ç­‰å®ç°ç±»ä¸­ï¼Œä¸å†å¤„ç†è¿™äº›ä¸å˜çš„é€»è¾‘ï¼Œè€Œåªè¦å…³æ³¨ 4 ä¸ª do*() æ–¹æ³•çš„å®ç°å³å¯ã€‚
è¿™é‡Œæˆ‘ä»¬é‡ç‚¹æ¥çœ‹ SimpleExecutor ä¸­ doQuery() æ–¹æ³•çš„å®ç°é€»è¾‘ã€‚
 é€šè¿‡ newStatementHandler() æ–¹æ³•åˆ›å»º StatementHandler å¯¹è±¡ï¼Œå…¶ä¸­ä¼šæ ¹æ® MappedStatement.statementType é…ç½®åˆ›å»ºç›¸åº”çš„ StatementHandler å®ç°å¯¹è±¡ï¼Œå¹¶æ·»åŠ  RoutingStatementHandler è£…é¥°å™¨ã€‚ é€šè¿‡ prepareStatement() æ–¹æ³•åˆå§‹åŒ– Statement å¯¹è±¡ï¼Œå…¶ä¸­è¿˜ä¾èµ– ParameterHandler å¡«å…… SQL è¯­å¥ä¸­çš„å ä½ç¬¦ã€‚ é€šè¿‡ StatementHandler.query() æ–¹æ³•æ‰§è¡Œ SQL è¯­å¥ï¼Œå¹¶é€šè¿‡æˆ‘ä»¬å‰é¢[14]å’Œ[15]è®²ä»‹ç»çš„ DefaultResultSetHandler å°† ResultSet æ˜ å°„æˆç»“æœå¯¹è±¡å¹¶è¿”å›ã€‚  doQuery() æ–¹æ³•çš„æ ¸å¿ƒä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š
public &amp;lt;E&amp;gt; List&amp;lt;E&amp;gt; doQuery(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql) throws SQLException {Statement stmt = null;try {Configuration configuration = ms.">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="nav-logo">
    <a href="http://yipsen.github.io/">
        
        <span class="nav-title">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æ–‡ç« </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/%e6%b7%b1%e5%85%a5%e5%89%96%e6%9e%90mybatis%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86/">æ·±å…¥å‰–æMyBatisæ ¸å¿ƒåŸç†</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/00-%E5%BC%80%E7%AF%87%E8%AF%8D-%E9%A2%86%E7%95%A5-mybatis-%E8%AE%BE%E8%AE%A1%E6%80%9D%E7%BB%B4%E7%AA%81%E7%A0%B4%E6%8C%81%E4%B9%85%E5%8C%96%E6%8A%80%E6%9C%AF%E7%93%B6%E9%A2%88/">00 å¼€ç¯‡è¯ é¢†ç•¥ MyBatis è®¾è®¡æ€ç»´ï¼Œçªç ´æŒä¹…åŒ–æŠ€æœ¯ç“¶é¢ˆ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/01-%E5%B8%B8%E8%A7%81%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6%E8%B5%8F%E6%9E%90%E5%88%B0%E5%BA%95%E6%98%AF%E4%BB%80%E4%B9%88%E8%AE%A9%E4%BD%A0%E9%80%89%E6%8B%A9-mybatis/">01 å¸¸è§æŒä¹…å±‚æ¡†æ¶èµæï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆè®©ä½ é€‰æ‹© MyBatisï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/02-%E8%AE%A2%E5%8D%95%E7%B3%BB%E7%BB%9F%E6%8C%81%E4%B9%85%E5%B1%82%E7%A4%BA%E4%BE%8B%E5%88%86%E6%9E%9020-%E5%88%86%E9%92%9F%E5%B8%A6%E4%BD%A0%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B-mybatis/">02 è®¢å•ç³»ç»ŸæŒä¹…å±‚ç¤ºä¾‹åˆ†æï¼Œ20 åˆ†é’Ÿå¸¦ä½ å¿«é€Ÿä¸Šæ‰‹ MyBatis</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/03-mybatis-%E6%BA%90%E7%A0%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%8F%8A%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90/">03 MyBatis æºç ç¯å¢ƒæ­å»ºåŠæ•´ä½“æ¶æ„è§£æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/04-mybatis-%E5%8F%8D%E5%B0%84%E5%B7%A5%E5%85%B7%E7%AE%B1%E5%B8%A6%E4%BD%A0%E9%A2%86%E7%95%A5%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84%E5%8F%8D%E5%B0%84%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF/">04 MyBatis åå°„å·¥å…·ç®±ï¼šå¸¦ä½ é¢†ç•¥ä¸ä¸€æ ·çš„åå°„è®¾è®¡æ€è·¯</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/05-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E5%9E%8B%E4%BD%93%E7%B3%BB%E4%B8%8E-java-%E7%B1%BB%E5%9E%8B%E4%BD%93%E7%B3%BB%E4%B9%8B%E9%97%B4%E7%9A%84%E7%88%B1%E6%81%A8%E6%83%85%E4%BB%87/">05 æ•°æ®åº“ç±»å‹ä½“ç³»ä¸ Java ç±»å‹ä½“ç³»ä¹‹é—´çš„â€œçˆ±æ¨æƒ…ä»‡â€</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/06-%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6%E5%8D%83%E5%8D%83%E4%B8%87mybatis-%E9%83%BD%E8%83%BD%E5%85%BC%E5%AE%B9%E7%9A%84%E7%A7%98%E5%AF%86%E6%98%AF%E4%BB%80%E4%B9%88/">06 æ—¥å¿—æ¡†æ¶åƒåƒä¸‡ï¼ŒMyBatis éƒ½èƒ½å…¼å®¹çš„ç§˜å¯†æ˜¯ä»€ä¹ˆï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/07-%E6%B7%B1%E5%85%A5%E6%95%B0%E6%8D%AE%E6%BA%90%E5%92%8C%E4%BA%8B%E5%8A%A1%E6%8A%8A%E6%8F%A1%E6%8C%81%E4%B9%85%E5%8C%96%E6%A1%86%E6%9E%B6%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%85%B3%E9%94%AE%E5%91%BD%E8%84%89/">07 æ·±å…¥æ•°æ®æºå’Œäº‹åŠ¡ï¼ŒæŠŠæ¡æŒä¹…åŒ–æ¡†æ¶çš„ä¸¤ä¸ªå…³é”®å‘½è„‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/08-mapper-%E6%96%87%E4%BB%B6%E4%B8%8E-java-%E6%8E%A5%E5%8F%A3%E7%9A%84%E4%BC%98%E9%9B%85%E6%98%A0%E5%B0%84%E4%B9%8B%E9%81%93/">08 Mapper æ–‡ä»¶ä¸ Java æ¥å£çš„ä¼˜é›…æ˜ å°„ä¹‹é“</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/09-%E5%9F%BA%E4%BA%8E-mybatis-%E7%BC%93%E5%AD%98%E5%88%86%E6%9E%90%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">09 åŸºäº MyBatis ç¼“å­˜åˆ†æè£…é¥°å™¨æ¨¡å¼çš„æœ€ä½³å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/10-%E9%B8%9F%E7%9E%B0-mybatis-%E5%88%9D%E5%A7%8B%E5%8C%96%E6%8A%8A%E6%8F%A1-mybatis-%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E8%84%89%E7%BB%9C%E4%B8%8A/">10 é¸Ÿç° MyBatis åˆå§‹åŒ–ï¼ŒæŠŠæ¡ MyBatis å¯åŠ¨æµç¨‹è„‰ç»œï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/11-%E9%B8%9F%E7%9E%B0-mybatis-%E5%88%9D%E5%A7%8B%E5%8C%96%E6%8A%8A%E6%8F%A1-mybatis-%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E8%84%89%E7%BB%9C%E4%B8%8B/">11 é¸Ÿç° MyBatis åˆå§‹åŒ–ï¼ŒæŠŠæ¡ MyBatis å¯åŠ¨æµç¨‹è„‰ç»œï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/12-%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E5%8A%A8%E6%80%81-sql-%E8%AF%AD%E5%8F%A5%E8%A7%A3%E6%9E%90%E5%85%A8%E6%B5%81%E7%A8%8B%E4%B8%8A/">12 æ·±å…¥åˆ†æåŠ¨æ€ SQL è¯­å¥è§£æå…¨æµç¨‹ï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/13-%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E5%8A%A8%E6%80%81-sql-%E8%AF%AD%E5%8F%A5%E8%A7%A3%E6%9E%90%E5%85%A8%E6%B5%81%E7%A8%8B%E4%B8%8B/">13 æ·±å…¥åˆ†æåŠ¨æ€ SQL è¯­å¥è§£æå…¨æµç¨‹ï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/14-%E6%8E%A2%E7%A9%B6-mybatis-%E7%BB%93%E6%9E%9C%E9%9B%86%E6%98%A0%E5%B0%84%E6%9C%BA%E5%88%B6%E8%83%8C%E5%90%8E%E7%9A%84%E7%A7%98%E5%AF%86%E4%B8%8A/">14 æ¢ç©¶ MyBatis ç»“æœé›†æ˜ å°„æœºåˆ¶èƒŒåçš„ç§˜å¯†ï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/15-%E6%8E%A2%E7%A9%B6-mybatis-%E7%BB%93%E6%9E%9C%E9%9B%86%E6%98%A0%E5%B0%84%E6%9C%BA%E5%88%B6%E8%83%8C%E5%90%8E%E7%9A%84%E7%A7%98%E5%AF%86%E4%B8%8B/">15 æ¢ç©¶ MyBatis ç»“æœé›†æ˜ å°„æœºåˆ¶èƒŒåçš„ç§˜å¯†ï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/16-statementhandler%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9Asql-%E6%89%A7%E8%A1%8C%E5%92%8C%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84%E7%9A%84%E5%A5%A0%E5%9F%BA%E8%80%85/">16 StatementHandlerï¼šå‚æ•°ç»‘å®šã€SQL æ‰§è¡Œå’Œç»“æœæ˜ å°„çš„å¥ åŸºè€…</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/17-executor-%E6%89%8D%E6%98%AF%E6%89%A7%E8%A1%8C-sql-%E8%AF%AD%E5%8F%A5%E7%9A%84%E5%B9%95%E5%90%8E%E6%8E%A8%E6%89%8B%E4%B8%8A/">17 Executor æ‰æ˜¯æ‰§è¡Œ SQL è¯­å¥çš„å¹•åæ¨æ‰‹ï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li>18 Executor æ‰æ˜¯æ‰§è¡Œ SQL è¯­å¥çš„å¹•åæ¨æ‰‹ï¼ˆä¸‹ï¼‰</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/19-%E6%B7%B1%E5%85%A5-mybatis-%E5%86%85%E6%A0%B8%E4%B8%8E%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E7%9A%84%E6%A1%A5%E6%A2%81%E6%8E%A5%E5%8F%A3%E5%B1%82/">19 æ·±å…¥ MyBatis å†…æ ¸ä¸ä¸šåŠ¡é€»è¾‘çš„æ¡¥æ¢â€”â€”æ¥å£å±‚</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/20-%E6%8F%92%E4%BB%B6%E4%BD%93%E7%B3%BB%E8%AE%A9-mybatis-%E4%B8%96%E7%95%8C%E6%9B%B4%E5%8A%A0%E7%B2%BE%E5%BD%A9/">20 æ’ä»¶ä½“ç³»è®© MyBatis ä¸–ç•Œæ›´åŠ ç²¾å½©</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/21-%E6%B7%B1%E6%8C%96-mybatis-%E4%B8%8E-spring-%E9%9B%86%E6%88%90%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/">21 æ·±æŒ– MyBatis ä¸ Spring é›†æˆåº•å±‚åŸç†</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/22-%E5%9F%BA%E4%BA%8E-mybatis-%E7%9A%84%E8%A1%8D%E7%94%9F%E6%A1%86%E6%9E%B6%E4%B8%80%E8%A7%88/">22 åŸºäº MyBatis çš„è¡ç”Ÿæ¡†æ¶ä¸€è§ˆ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/23-%E7%BB%93%E6%9D%9F%E8%AF%AD-%E4%BC%9A%E4%BD%BF%E7%94%A8%E5%8F%AA%E8%83%BD%E9%BB%98%E9%BB%98%E6%90%AC%E7%A0%96%E6%87%82%E5%8E%9F%E7%90%86%E6%89%8D%E8%83%BD%E5%BF%AB%E9%80%9F%E6%99%8B%E5%8D%87/">23 ç»“æŸè¯­ ä¼šä½¿ç”¨åªèƒ½é»˜é»˜â€œæ¬ç –â€ï¼Œæ‡‚åŸç†æ‰èƒ½å¿«é€Ÿæ™‹å‡</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">18 Executor æ‰æ˜¯æ‰§è¡Œ SQL è¯­å¥çš„å¹•åæ¨æ‰‹ï¼ˆä¸‹ï¼‰</h1>
        <div class="post-info">
            <div class="post-date"> 
                <span>2021-12-22 01:51:20</span>
            </div>
        </div>
        <div class="post-content">
            <p>åœ¨ä¸Šä¸€è®²ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä»‹ç»äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ç›¸å…³çŸ¥è¯†ï¼Œç„¶åä»‹ç»äº† Executor æ¥å£çš„æ ¸å¿ƒæ–¹æ³•ï¼Œæœ€ååˆ†æäº† BaseExecutor æŠ½è±¡ç±»æ˜¯å¦‚ä½•åˆ©ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸ºå…¶ä»– Executor æŠ½è±¡äº†ä¸€çº§ç¼“å­˜å’Œäº‹åŠ¡ç®¡ç†çš„èƒ½åŠ›ã€‚è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å†æ¥ä»‹ç»å‰©ä½™çš„å››ä¸ªé‡ç‚¹ Executor å®ç°ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%20MyBatis%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86-%E5%AE%8C/assets/CioPOWBa7q-Aa_fiAAF6eDPI3C0273.png" alt="å›¾ç‰‡13.png"></p>
<p>Executor æ¥å£ç»§æ‰¿å…³ç³»å›¾</p>
<h3 id="simpleexecutor">SimpleExecutor</h3>
<p>æˆ‘ä»¬æ¥çœ‹ BaseExecutor çš„ç¬¬ä¸€ä¸ªå­ç±»â€”â€” SimpleExecutorï¼ŒåŒæ—¶<strong>å®ƒä¹Ÿæ˜¯ Executor æ¥å£æœ€ç®€å•çš„å®ç°</strong>ã€‚</p>
<p>æ­£å¦‚ä¸Šä¸€è®²ä¸­åˆ†æçš„é‚£æ ·ï¼ŒBaseExecutor é€šè¿‡æ¨¡æ¿æ–¹æ³•æ¨¡å¼å®ç°äº†è¯»å†™ä¸€çº§ç¼“å­˜ã€äº‹åŠ¡ç®¡ç†ç­‰ä¸éšåœºæ™¯å˜åŒ–çš„åŸºç¡€æ–¹æ³•ï¼Œåœ¨ SimpleExecutorã€ReuseExecutorã€BatchExecutor ç­‰å®ç°ç±»ä¸­ï¼Œä¸å†å¤„ç†è¿™äº›ä¸å˜çš„é€»è¾‘ï¼Œè€Œåªè¦å…³æ³¨ 4 ä¸ª do*() æ–¹æ³•çš„å®ç°å³å¯ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬é‡ç‚¹æ¥çœ‹ SimpleExecutor ä¸­ doQuery() æ–¹æ³•çš„å®ç°é€»è¾‘ã€‚</p>
<ol>
<li>é€šè¿‡ newStatementHandler() æ–¹æ³•åˆ›å»º StatementHandler å¯¹è±¡ï¼Œå…¶ä¸­ä¼šæ ¹æ® MappedStatement.statementType é…ç½®åˆ›å»ºç›¸åº”çš„ StatementHandler å®ç°å¯¹è±¡ï¼Œå¹¶æ·»åŠ  RoutingStatementHandler è£…é¥°å™¨ã€‚</li>
<li>é€šè¿‡ prepareStatement() æ–¹æ³•åˆå§‹åŒ– Statement å¯¹è±¡ï¼Œå…¶ä¸­è¿˜ä¾èµ– ParameterHandler å¡«å…… SQL è¯­å¥ä¸­çš„å ä½ç¬¦ã€‚</li>
<li>é€šè¿‡ StatementHandler.query() æ–¹æ³•æ‰§è¡Œ SQL è¯­å¥ï¼Œå¹¶é€šè¿‡æˆ‘ä»¬å‰é¢[14]å’Œ[15]è®²ä»‹ç»çš„ DefaultResultSetHandler å°† ResultSet æ˜ å°„æˆç»“æœå¯¹è±¡å¹¶è¿”å›ã€‚</li>
</ol>
<p>doQuery() æ–¹æ³•çš„æ ¸å¿ƒä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public &lt;E&gt; List&lt;E&gt; doQuery(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql) throws SQLException {

    Statement stmt = null;

    try {

        Configuration configuration = ms.getConfiguration();

        // åˆ›å»ºStatementHandlerå¯¹è±¡ï¼Œå®é™…è¿”å›çš„æ˜¯RoutingStatementHandlerå¯¹è±¡ï¼ˆæˆ‘ä»¬åœ¨ç¬¬16è®²ä»‹ç»è¿‡ï¼‰

        // å…¶ä¸­æ ¹æ®MappedStatement.statementTypeé€‰æ‹©å…·ä½“çš„StatementHandlerå®ç°

        StatementHandler handler = configuration.newStatementHandler(wrapper, ms, parameter, rowBounds, resultHandler, boundSql);

        // å®ŒæˆStatementHandlerçš„åˆ›å»ºå’Œåˆå§‹åŒ–ï¼Œè¯¥æ–¹æ³•ä¼šè°ƒç”¨StatementHandler.prepare()æ–¹æ³•åˆ›å»º

        // Statementå¯¹è±¡ï¼Œç„¶åè°ƒç”¨StatementHandler.parameterize()æ–¹æ³•å¤„ç†å ä½ç¬¦

        stmt = prepareStatement(handler, ms.getStatementLog());

        // è°ƒç”¨StatementHandler.query()æ–¹æ³•ï¼Œæ‰§è¡ŒSQLè¯­å¥ï¼Œå¹¶é€šè¿‡ResultSetHandlerå®Œæˆç»“æœé›†çš„æ˜ å°„

        return handler.query(stmt, resultHandler);

    } finally {

        closeStatement(stmt);

    }

}
</code></pre><p>SimpleExecutor ä¸­çš„ doQueryCursor()ã€update() ç­‰æ–¹æ³•å®ç°ä¸ doQuery() æ–¹æ³•çš„å®ç°åŸºæœ¬ç±»ä¼¼ï¼Œè¿™é‡Œä¸å†å±•å¼€ä»‹ç»ï¼Œä½ è‹¥æ„Ÿå…´è¶£çš„è¯å¯ä»¥å‚è€ƒ<a href="https://github.com/xxxlxy2008/mybatis?fileGuid=xxQTRXtVcqtHK6j8">æºç </a>è¿›è¡Œåˆ†æã€‚</p>
<h3 id="reuseexecutor">ReuseExecutor</h3>
<p>ä½ å¦‚æœæœ‰è¿‡ JDBC ä¼˜åŒ–ç»éªŒçš„è¯ï¼Œå¯èƒ½ä¼šçŸ¥é“é‡ç”¨ Statement å¯¹è±¡æ˜¯ä¸€ç§å¸¸è§çš„ä¼˜åŒ–æ‰‹æ®µï¼Œä¸»è¦ç›®çš„æ˜¯å‡å°‘ SQL é¢„ç¼–è¯‘å¼€é”€ï¼ŒåŒæ—¶è¿˜ä¼šé™ä½ Statement å¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯é¢‘ç‡ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥æå‡ç³»ç»Ÿæ€§èƒ½ã€‚</p>
<p>ReuseExecutor è¿™ä¸ª BaseExecutor å®ç°å°±<strong>å®ç°äº†é‡ç”¨ Statement çš„ä¼˜åŒ–</strong>ï¼ŒReuseExecutor ç»´æŠ¤äº†ä¸€ä¸ª statementMap å­—æ®µï¼ˆHashMap&lt;String, Statement&gt;ç±»å‹ï¼‰æ¥ç¼“å­˜å·²æœ‰çš„ Statement å¯¹è±¡ï¼Œè¯¥ç¼“å­˜çš„ Key æ˜¯ SQL æ¨¡æ¿ï¼ŒValue æ˜¯ SQL æ¨¡æ¿å¯¹åº”çš„ Statement å¯¹è±¡ã€‚è¿™æ ·åœ¨æ‰§è¡Œç›¸åŒ SQL æ¨¡æ¿æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¤ç”¨ Statement å¯¹è±¡äº†ã€‚</p>
<p>ReuseExecutor ä¸­çš„ do*() æ–¹æ³•å®ç°ä¸å‰é¢ä»‹ç»çš„ SimpleExecutor å®ç°å®Œå…¨ä¸€æ ·ï¼Œä¸¤è€…å”¯ä¸€çš„<strong>åŒºåˆ«åœ¨äºå…¶ä¸­ä¾èµ–çš„ prepareStatement() æ–¹æ³•</strong>ï¼šSimpleExecutor æ¯æ¬¡éƒ½ä¼šåˆ›å»ºå…¨æ–°çš„ Statement å¯¹è±¡ï¼ŒReuseExecutor åˆ™æ˜¯å…ˆå°è¯•æŸ¥è¯¢ statementMap ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜å‘½ä¸­ï¼Œåˆ™ä¼šé‡ç”¨å…¶ä¸­çš„ Statement å¯¹è±¡ã€‚</p>
<p>å¦å¤–ï¼Œåœ¨äº‹åŠ¡æäº¤/å›æ»šä»¥åŠ Executor å…³é—­çš„æ—¶å€™ï¼Œéœ€è¦åŒæ—¶å…³é—­ statementMap é›†åˆä¸­ç¼“å­˜çš„å…¨éƒ¨ Statement å¯¹è±¡ï¼Œè¿™éƒ¨åˆ†é€»è¾‘æ˜¯åœ¨ doFlushStatements() æ–¹æ³•ä¸­å®ç°çš„ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>public List&lt;BatchResult&gt; doFlushStatements(boolean isRollback) {

        // å…³é—­statementMapé›†åˆä¸­ç¼“å­˜çš„å…¨éƒ¨Statementå¯¹è±¡

        for (Statement stmt : statementMap.values()) {

            closeStatement(stmt);

        }

        // æ¸…ç©ºstatementMapé›†åˆ

        statementMap.clear();

        return Collections.emptyList();

    }
</code></pre><h3 id="batchexecutor">BatchExecutor</h3>
<p>æ‰¹å¤„ç†æ˜¯ JDBC ç¼–ç¨‹ä¸­çš„å¦ä¸€ç§ä¼˜åŒ–æ‰‹æ®µã€‚</p>
<p>JDBC åœ¨æ‰§è¡Œ SQL è¯­å¥æ—¶ï¼Œä¼šå°† SQL è¯­å¥ä»¥åŠå®å‚é€šè¿‡ç½‘ç»œè¯·æ±‚çš„æ–¹å¼å‘é€åˆ°æ•°æ®åº“ï¼Œä¸€æ¬¡æ‰§è¡Œä¸€æ¡ SQL è¯­å¥ï¼Œä¸€æ–¹é¢ä¼šå‡å°è¯·æ±‚åŒ…çš„æœ‰æ•ˆè´Ÿè½½ï¼Œå¦ä¸€ä¸ªæ–¹é¢ä¼šå¢åŠ è€—è´¹åœ¨ç½‘ç»œé€šä¿¡ä¸Šçš„æ—¶é—´ã€‚é€šè¿‡æ‰¹å¤„ç†çš„æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ JDBC å®¢æˆ·ç«¯ç¼“å­˜å¤šæ¡ SQL è¯­å¥ï¼Œç„¶ååœ¨ flush æˆ–ç¼“å­˜æ»¡çš„æ—¶å€™ï¼Œå°†å¤šæ¡ SQL è¯­å¥æ‰“åŒ…å‘é€åˆ°æ•°æ®åº“æ‰§è¡Œï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆåœ°é™ä½ä¸Šè¿°ä¸¤æ–¹é¢çš„æŸè€—ï¼Œä»è€Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚</p>
<p>ä¸è¿‡ï¼Œæœ‰ä¸€ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼šæ¯æ¬¡å‘æ•°æ®åº“å‘é€çš„ SQL è¯­å¥çš„æ¡æ•°æ˜¯æœ‰ä¸Šé™çš„ï¼Œå¦‚æœæ‰¹é‡æ‰§è¡Œçš„æ—¶å€™è¶…è¿‡è¿™ä¸ªä¸Šé™å€¼ï¼Œæ•°æ®åº“å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ‹’ç»æ‰§è¡Œè¿™ä¸€æ‰¹ SQL è¯­å¥ï¼Œæ‰€ä»¥æˆ‘ä»¬<strong>éœ€è¦æ§åˆ¶æ‰¹é‡å‘é€ SQL è¯­å¥çš„æ¡æ•°å’Œé¢‘ç‡</strong>ã€‚</p>
<p><strong>BatchExecutor æ˜¯ç”¨äºå®ç°æ‰¹å¤„ç†çš„ Executor å®ç°</strong>ï¼Œå…¶ä¸­ç»´æŠ¤äº†ä¸€ä¸ª List<code>&lt;Statement&gt;</code> é›†åˆï¼ˆstatementList å­—æ®µï¼‰ç”¨æ¥ç¼“å­˜ä¸€æ‰¹ SQLï¼Œæ¯ä¸ª Statement å¯ä»¥å†™å…¥å¤šæ¡ SQLã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ JDBC çš„æ‰¹å¤„ç†æ“ä½œåªæ”¯æŒ insertã€updateã€delete ç­‰ä¿®æ”¹æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ BatchExecutor å¯¹æ‰¹å¤„ç†çš„å®ç°é›†ä¸­åœ¨ doUpdate() æ–¹æ³•ä¸­ã€‚åœ¨ doUpdate() æ–¹æ³•ä¸­è¿½åŠ ä¸€æ¡å¾…æ‰§è¡Œçš„ SQL è¯­å¥æ—¶ï¼ŒBatchExecutor ä¼šå…ˆå°†è¯¥æ¡ SQL è¯­å¥ä¸æœ€è¿‘ä¸€æ¬¡è¿½åŠ çš„ SQL è¯­å¥è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒï¼Œåˆ™è¿½åŠ åˆ°æœ€è¿‘ä¸€æ¬¡ä½¿ç”¨çš„ Statement å¯¹è±¡ä¸­ï¼›å¦‚æœä¸åŒï¼Œåˆ™è¿½åŠ åˆ°ä¸€ä¸ªå…¨æ–°çš„ Statement å¯¹è±¡ï¼ŒåŒæ—¶ä¼šå°†æ–°å»ºçš„ Statement å¯¹è±¡æ”¾å…¥ statementList ç¼“å­˜ä¸­ã€‚</p>
<p>ä¸‹é¢æ˜¯ BatchExecutor.doUpdate() æ–¹æ³•çš„æ ¸å¿ƒé€»è¾‘ï¼š</p>
<pre tabindex="0"><code>public int doUpdate(MappedStatement ms, Object parameterObject) throws SQLException {

  final Configuration configuration = ms.getConfiguration();

  // åˆ›å»ºStatementHandlerå¯¹è±¡

  final StatementHandler handler = configuration.newStatementHandler(this, ms, parameterObject, RowBounds.DEFAULT, null, null);

  final BoundSql boundSql = handler.getBoundSql();

    // è·å–æ­¤æ¬¡è¿½åŠ çš„SQLæ¨¡æ¿

    final String sql = boundSql.getSql();

    final Statement stmt;

    // æ¯”è¾ƒæ­¤æ¬¡è¿½åŠ çš„SQLæ¨¡æ¿ä¸æœ€è¿‘ä¸€æ¬¡è¿½åŠ çš„SQLæ¨¡æ¿ï¼Œä»¥åŠä¸¤ä¸ªMappedStatementå¯¹è±¡

    if (sql.equals(currentSql) &amp;&amp; ms.equals(currentStatement)) {

        // ä¸¤è€…ç›¸åŒï¼Œåˆ™è·å–statementListé›†åˆä¸­æœ€åä¸€ä¸ªStatementå¯¹è±¡

        int last = statementList.size() - 1;

        stmt = statementList.get(last);

        applyTransactionTimeout(stmt);

        handler.parameterize(stmt); // è®¾ç½®å®å‚

        // æŸ¥æ‰¾è¯¥Statementå¯¹è±¡å¯¹åº”çš„BatchResultå¯¹è±¡ï¼Œå¹¶è®°å½•ç”¨æˆ·ä¼ å…¥çš„å®å‚

        BatchResult batchResult = batchResultList.get(last);

        batchResult.addParameterObject(parameterObject);

    } else {

        Connection connection = getConnection(ms.getStatementLog());

        // åˆ›å»ºæ–°çš„Statementå¯¹è±¡

        stmt = handler.prepare(connection, transaction.getTimeout());

        handler.parameterize(stmt);// è®¾ç½®å®å‚

        // æ›´æ–°currentSqlå’ŒcurrentStatement

        currentSql = sql;

        currentStatement = ms;

        // å°†æ–°åˆ›å»ºçš„Statementå¯¹è±¡æ·»åŠ åˆ°statementListé›†åˆä¸­

        statementList.add(stmt);

        // ä¸ºæ–°Statementå¯¹è±¡æ·»åŠ æ–°çš„BatchResultå¯¹è±¡

        batchResultList.add(new BatchResult(ms, sql, parameterObject));

    }

    handler.batch(stmt);

    return BATCH_UPDATE_RETURN_VALUE;

}
</code></pre><p>è¿™é‡Œä½¿ç”¨åˆ°çš„ BatchResult ç”¨äºè®°å½•æ‰¹å¤„ç†çš„ç»“æœï¼Œä¸€ä¸ª BatchResult å¯¹è±¡ä¸ä¸€ä¸ª Statement å¯¹è±¡å¯¹åº”ï¼ŒBatchResult ä¸­ç»´æŠ¤äº†ä¸€ä¸ª updateCounts å­—æ®µï¼ˆint[] æ•°ç»„ç±»å‹ï¼‰æ¥è®°å½•å…³è” Statement å¯¹è±¡æ‰§è¡Œæ‰¹å¤„ç†çš„ç»“æœã€‚</p>
<p>æ·»åŠ å®Œå¾…æ‰§è¡Œçš„ SQL è¯­å¥ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ doFlushStatements() æ–¹æ³•ï¼Œå…¶ä¸­ä¼šé€šè¿‡ Statement.executeBatch() æ–¹æ³•æ‰¹é‡æ‰§è¡Œ SQLï¼Œç„¶å SQL è¯­å¥å½±å“è¡Œæ•°ä»¥åŠæ•°æ®åº“ç”Ÿæˆçš„ä¸»é”®å¡«å……åˆ°ç›¸åº”çš„ BatchResult å¯¹è±¡ä¸­è¿”å›ã€‚ä¸‹é¢æ˜¯å…¶æ ¸å¿ƒå®ç°ï¼š</p>
<pre tabindex="0"><code>public List&lt;BatchResult&gt; doFlushStatements(boolean isRollback) throws SQLException {

    try {

        // ç”¨äºå‚¨å­˜æ‰¹å¤„ç†çš„ç»“æœ

        List&lt;BatchResult&gt; results = new ArrayList&lt;&gt;();

        // å¦‚æœæ˜ç¡®æŒ‡å®šäº†è¦å›æ»šäº‹åŠ¡ï¼Œåˆ™ç›´æ¥è¿”å›ç©ºé›†åˆï¼Œå¿½ç•¥statementListé›†åˆä¸­è®°å½•çš„SQLè¯­å¥

        if (isRollback) {

            return Collections.emptyList();

        }

        for (int i = 0, n = statementList.size(); i &lt; n; i++) { // éå†statementListé›†åˆ

            Statement stmt = statementList.get(i);// è·å–Statementå¯¹è±¡

            applyTransactionTimeout(stmt);

            BatchResult batchResult = batchResultList.get(i); // è·å–å¯¹åº”BatchResultå¯¹è±¡

            try {

                // è°ƒç”¨Statement.executeBatch()æ–¹æ³•æ‰¹é‡æ‰§è¡Œå…¶ä¸­è®°å½•çš„SQLè¯­å¥ï¼Œå¹¶ä½¿ç”¨è¿”å›çš„intæ•°ç»„

                // æ›´æ–°BatchResult.updateCountså­—æ®µï¼Œå…¶ä¸­æ¯ä¸€ä¸ªå…ƒç´ éƒ½è¡¨ç¤ºä¸€æ¡SQLè¯­å¥å½±å“çš„è®°å½•æ¡æ•°

                batchResult.setUpdateCounts(stmt.executeBatch());

                MappedStatement ms = batchResult.getMappedStatement();

                List&lt;Object&gt; parameterObjects = batchResult.getParameterObjects();

                // è·å–é…ç½®çš„KeyGeneratorå¯¹è±¡

                KeyGenerator keyGenerator = ms.getKeyGenerator();

                if (Jdbc3KeyGenerator.class.equals(keyGenerator.getClass())) {

                    // è·å–æ•°æ®åº“ç”Ÿæˆçš„ä¸»é”®ï¼Œå¹¶è®°å½•åˆ°å®å‚ä¸­å¯¹åº”çš„å­—æ®µ

                    Jdbc3KeyGenerator jdbc3KeyGenerator = (Jdbc3KeyGenerator) keyGenerator;

                    jdbc3KeyGenerator.processBatch(ms, stmt, parameterObjects);

                } else if (!NoKeyGenerator.class.equals(keyGenerator.getClass())) {

                    // å…¶ä»–ç±»å‹çš„KeyGeneratorï¼Œä¼šè°ƒç”¨å…¶processAfter()æ–¹æ³•

                    for (Object parameter : parameterObjects) {

                        keyGenerator.processAfter(this, ms, stmt, parameter);

                    }

                }

                closeStatement(stmt);

            } catch (BatchUpdateException e) {

                // å¼‚å¸¸å¤„ç†é€»è¾‘

            }

            // æ·»åŠ BatchResultåˆ°resultsé›†åˆ

            results.add(batchResult);

        }

        return results;

    } finally {

        // é‡Šæ”¾èµ„æº

    }

}
</code></pre><h3 id="cachingexecutor">CachingExecutor</h3>
<p>CachingExecutor æ˜¯æˆ‘ä»¬æœ€åä¸€ä¸ªè¦ä»‹ç»çš„ Executor æ¥å£å®ç°ç±»ï¼Œå®ƒæ˜¯<strong>ä¸€ä¸ª Executor è£…é¥°å™¨å®ç°ï¼Œä¼šåœ¨å…¶ä»– Executor çš„åŸºç¡€ä¹‹ä¸Šæ·»åŠ äºŒçº§ç¼“å­˜çš„ç›¸å…³åŠŸèƒ½</strong>ã€‚åœ¨ä¸Šä¸€è®²ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä»‹ç»è¿‡äº†ä¸€çº§ç¼“å­˜ï¼Œä¸‹é¢å°±æ¥ç€è®²è§£äºŒçº§ç¼“å­˜ç›¸å…³çš„å†…å®¹ã€‚</p>
<h4 id="1-äºŒçº§ç¼“å­˜">1. äºŒçº§ç¼“å­˜</h4>
<p>æˆ‘ä»¬çŸ¥é“ä¸€çº§ç¼“å­˜çš„ç”Ÿå‘½å‘¨æœŸé»˜è®¤ä¸ SqlSession ç›¸åŒï¼Œè€Œè¿™é‡Œä»‹ç»çš„ MyBatis ä¸­çš„äºŒçº§ç¼“å­˜åˆ™ä¸åº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸç›¸åŒã€‚ä¸äºŒçº§ç¼“å­˜ç›¸å…³çš„é…ç½®ä¸»è¦æœ‰ä¸‹é¢ä¸‰é¡¹ã€‚</p>
<p><strong>ç¬¬ä¸€é¡¹ï¼ŒäºŒçº§ç¼“å­˜å…¨å±€å¼€å…³</strong>ã€‚è¿™ä¸ªå…¨å±€å¼€å…³æ˜¯ mybatis-config.xml é…ç½®æ–‡ä»¶ä¸­çš„ cacheEnabled é…ç½®é¡¹ã€‚å½“ cacheEnabled è¢«è®¾ç½®ä¸º true æ—¶ï¼Œæ‰ä¼šå¼€å¯äºŒçº§ç¼“å­˜åŠŸèƒ½ï¼Œå¼€å¯äºŒçº§ç¼“å­˜åŠŸèƒ½ä¹‹åï¼Œä¸‹é¢ä¸¤é¡¹çš„é…ç½®æ‰ä¼šæ§åˆ¶äºŒçº§ç¼“å­˜çš„è¡Œä¸ºã€‚</p>
<p><strong>ç¬¬äºŒé¡¹ï¼Œå‘½åç©ºé—´çº§åˆ«å¼€å…³</strong>ã€‚åœ¨ Mapper é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡é…ç½® <code>&lt;cache&gt;</code> æ ‡ç­¾æˆ– <code>&lt;cache-ref&gt;</code> æ ‡ç­¾å¼€å¯äºŒçº§ç¼“å­˜åŠŸèƒ½ã€‚</p>
<ul>
<li>åœ¨è§£æåˆ° <code>&lt;cache&gt;</code> æ ‡ç­¾æ—¶ï¼ŒMyBatis ä¼šä¸ºå½“å‰ Mapper.xml æ–‡ä»¶å¯¹åº”çš„å‘½åç©ºé—´åˆ›å»ºä¸€ä¸ªå…³è”çš„ Cache å¯¹è±¡ï¼ˆé»˜è®¤ä¸º PerpetualCache ç±»å‹çš„å¯¹è±¡ï¼‰ï¼Œä½œä¸ºå…¶äºŒçº§ç¼“å­˜çš„å®ç°ã€‚æ­¤å¤–ï¼Œ<code>&lt;cache&gt;</code> æ ‡ç­¾ä¸­è¿˜æä¾›äº†ä¸€ä¸ª type å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥å±æ€§ä½¿ç”¨è‡ªå®šä¹‰çš„ Cache ç±»å‹ã€‚</li>
<li>åœ¨è§£æåˆ° <code>&lt;cache-ref&gt;</code> æ ‡ç­¾æ—¶ï¼ŒMyBatis å¹¶ä¸ä¼šåˆ›å»ºæ–°çš„ Cache å¯¹è±¡ï¼Œè€Œæ˜¯æ ¹æ® <code>&lt;cache-ref&gt;</code> æ ‡ç­¾çš„ namespace å±æ€§æŸ¥æ‰¾æŒ‡å®šå‘½åç©ºé—´å¯¹åº”çš„ Cache å¯¹è±¡ï¼Œç„¶åè®©å½“å‰å‘½åç©ºé—´ä¸æŒ‡å®šå‘½åç©ºé—´å…±äº«åŒä¸€ä¸ª Cache å¯¹è±¡ã€‚</li>
</ul>
<p><strong>ç¬¬ä¸‰é¡¹ï¼Œè¯­å¥çº§åˆ«å¼€å…³</strong>ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>&lt;select&gt;</code> æ ‡ç­¾ä¸­çš„ useCache å±æ€§ï¼Œæ§åˆ¶è¯¥ select è¯­å¥æŸ¥è¯¢åˆ°çš„ç»“æœå¯¹è±¡æ˜¯å¦ä¿å­˜åˆ°äºŒçº§ç¼“å­˜ä¸­ï¼ŒuseCache å±æ€§é»˜è®¤å€¼ä¸º trueã€‚</p>
<h4 id="2-transactionalcache">2. TransactionalCache</h4>
<p>äº†è§£äº†äºŒçº§ç¼“å­˜çš„ç”Ÿå‘½å‘¨æœŸã€åŸºæœ¬æ¦‚å¿µä»¥åŠç›¸å…³é…ç½®ä¹‹åï¼Œæˆ‘ä»¬å¼€å§‹ä»‹ç» CachingExecutor ä¾èµ–çš„åº•å±‚ç»„ä»¶ã€‚</p>
<p>CachingExecutor åº•å±‚é™¤äº†ä¾èµ– PerpetualCache å®ç°æ¥ç¼“å­˜æ•°æ®ä¹‹å¤–ï¼Œè¿˜ä¼š<strong>ä¾èµ– TransactionalCache å’Œ TransactionalCacheManager ä¸¤ä¸ªç»„ä»¶</strong>ï¼Œä¸‹é¢æˆ‘ä»¬å°±ä¸€ä¸€è¯¦ç»†ä»‹ç»ä¸‹ã€‚</p>
<p>TransactionalCache æ˜¯ Cache æ¥å£ä¼—å¤šå®ç°ä¹‹ä¸€ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œç”¨æ¥è®°å½•ä¸€ä¸ªäº‹åŠ¡ä¸­æ·»åŠ åˆ°äºŒçº§ç¼“å­˜ä¸­çš„ç¼“å­˜ã€‚</p>
<p>TransactionalCache ä¸­çš„ entriesToAddOnCommit å­—æ®µï¼ˆMap<code>&lt;Object, Object&gt;</code> ç±»å‹ï¼‰ç”¨æ¥æš‚å­˜å½“å‰äº‹åŠ¡ä¸­æ·»åŠ åˆ°äºŒçº§ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®åœ¨äº‹åŠ¡æäº¤æ—¶æ‰ä¼šçœŸæ­£æ·»åŠ åˆ°åº•å±‚çš„ Cache å¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯äºŒçº§ç¼“å­˜ï¼‰ä¸­ã€‚è¿™ä¸€ç‚¹æˆ‘ä»¬å¯ä»¥ä» TransactionalCache çš„ putObject() æ–¹æ³•ä»¥åŠ flushPendingEntries() æ–¹æ³•ï¼ˆcommit() æ–¹æ³•ä¼šè°ƒç”¨è¯¥æ–¹æ³•ï¼‰ä¸­çœ‹åˆ°ç›¸å…³ä»£ç å®ç°ï¼š</p>
<pre tabindex="0"><code>public void putObject(Object key, Object object) {

    // å°†æ•°æ®æš‚å­˜åˆ°entriesToAddOnCommité›†åˆ

    entriesToAddOnCommit.put(key, object);

}

private void flushPendingEntries() {

    for (Map.Entry&lt;Object, Object&gt; entry : entriesToAddOnCommit.entrySet()) {

        // å°†entriesToAddOnCommité›†åˆä¸­çš„æ•°æ®æ·»åŠ åˆ°äºŒçº§ç¼“å­˜

        delegate.putObject(entry.getKey(), entry.getValue());

    }

    ... // å…¶ä»–é€»è¾‘

}
</code></pre><p>é‚£ä¸ºä»€ä¹ˆè¦åœ¨äº‹åŠ¡æäº¤æ—¶æ‰å°† entriesToAddOnCommit é›†åˆä¸­çš„ç¼“å­˜æ•°æ®å†™å…¥åº•å±‚çœŸæ­£çš„äºŒçº§ç¼“å­˜ä¸­ï¼Œè€Œä¸æ˜¯åƒæ“ä½œä¸€çº§ç¼“å­˜é‚£æ ·ï¼Œæ¯æ¬¡æŸ¥è¯¢éƒ½ç›´æ¥å†™å…¥ç¼“å­˜å‘¢ï¼Ÿå…¶å®è¿™æ˜¯<strong>ä¸ºäº†é˜²æ­¢å‡ºç°â€œè„è¯»â€</strong>ã€‚</p>
<p>æˆ‘ä»¬å‡è®¾å½“å‰æ•°æ®åº“çš„éš”ç¦»çº§åˆ«æ˜¯â€œä¸å¯é‡å¤è¯»â€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸¤ä¸ªä¸šåŠ¡çº¿ç¨‹åˆ†åˆ«å¼€å¯äº† T1ã€T2 ä¸¤ä¸ªäº‹åŠ¡ï¼š</p>
<ul>
<li>åœ¨äº‹åŠ¡ T1 ä¸­æ·»åŠ äº†è®°å½• Aï¼Œä¹‹åæŸ¥è¯¢è®°å½• Aï¼›</li>
<li>äº‹åŠ¡ T2 ä¼šæŸ¥è¯¢è®°å½• Aã€‚</li>
</ul>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%20MyBatis%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86-%E5%AE%8C/assets/CioPOWBa7oCAaZuSAAF5PEDTpm8320.png" alt="å›¾ç‰‡12.png"></p>
<p>ä¸¤äº‹åŠ¡å¹¶å‘æ“ä½œçš„ç¤ºæ„å›¾</p>
<p>å¦‚æœäº‹åŠ¡ T1 æŸ¥è¯¢è®°å½• A æ—¶ï¼Œå°±å°† A å¯¹åº”çš„ç»“æœå¯¹è±¡å†™å…¥äºŒçº§ç¼“å­˜ï¼Œé‚£åœ¨äº‹åŠ¡ T2 æŸ¥è¯¢è®°å½• A æ—¶ï¼Œä¼šä»äºŒçº§ç¼“å­˜ä¸­ç›´æ¥æ‹¿åˆ°ç»“æœå¯¹è±¡ã€‚æ­¤æ—¶çš„äº‹åŠ¡ T1 ä»ç„¶æœªæäº¤ï¼Œä¹Ÿå°±å‡ºç°äº†â€œè„è¯»â€ã€‚</p>
<p>æˆ‘ä»¬æŒ‰ç…§ TransactionalCache çš„å®ç°å†æ¥åˆ†æä¸‹ï¼Œäº‹åŠ¡ T1 æŸ¥è¯¢ A æ•°æ®çš„æ—¶å€™ï¼Œæœªå‘½ä¸­äºŒçº§ç¼“å­˜ï¼Œå°±ä¼šå‡»ç©¿åˆ°æ•°æ®åº“ï¼Œå› ä¸ºå†™å…¥å’Œè¯»å– A éƒ½æ˜¯åœ¨äº‹åŠ¡ T1 ä¸­ï¼Œæ‰€ä»¥èƒ½å¤ŸæŸ¥è¯¢æˆåŠŸï¼ŒåŒæ—¶æ›´æ–° entriesToAddOnCommit é›†åˆã€‚äº‹åŠ¡ T2 æŸ¥è¯¢è®°å½• A æ—¶ï¼ŒåŒæ ·ä¹Ÿä¼šå‡»ç©¿äºŒçº§ç¼“å­˜ï¼Œè®¿é—®æ•°æ®åº“ï¼Œå› ä¸ºæ­¤æ—¶å†™å…¥å’Œè¯»å– A æ˜¯ä¸åŒçš„äº‹åŠ¡ï¼Œä¸”æ•°æ®åº“çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºâ€œä¸å¯é‡å¤è¯»â€ï¼Œè¿™å°±å¯¼è‡´äº‹åŠ¡ T2 æ— æ³•æŸ¥è¯¢åˆ°è®°å½• Aï¼Œä¹Ÿå°±é¿å…äº†â€œè„è¯»â€ã€‚</p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œäº‹åŠ¡ T1 åœ¨æäº¤æ—¶ï¼Œä¼šå°† entriesToAddOnCommit ä¸­çš„æ•°æ®æ·»åŠ åˆ°äºŒçº§ç¼“å­˜ä¸­ï¼Œæ‰€ä»¥äº‹åŠ¡ T2 ç¬¬äºŒæ¬¡æŸ¥è¯¢è®°å½• A æ—¶ï¼Œä¼šå‘½ä¸­äºŒçº§ç¼“å­˜ï¼Œä¹Ÿå°±å‡ºç°äº†åŒä¸€äº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–çš„ç»“æœä¸åŒçš„ç°è±¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„â€œä¸å¯é‡å¤è¯»â€ã€‚</p>
<p>TransactionalCache ä¸­çš„å¦ä¸€ä¸ªæ ¸å¿ƒå­—æ®µæ˜¯ entriesMissedInCacheï¼Œå®ƒç”¨æ¥è®°å½•æœªå‘½ä¸­çš„ CacheKey å¯¹è±¡ã€‚åœ¨ getObject() æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å†™å…¥ entriesMissedInCache é›†åˆçš„ç›¸å…³ä»£ç ç‰‡æ®µï¼š</p>
<pre tabindex="0"><code>public Object getObject(Object key) {

    Object object = delegate.getObject(key);

    if (object == null) {

        entriesMissedInCache.add(key);

    }

    ... // å…¶ä»–é€»è¾‘

}
</code></pre><p>åœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œä¼šå°† entriesMissedInCache é›†åˆä¸­çš„ CacheKey å†™å…¥åº•å±‚çš„äºŒçº§ç¼“å­˜ï¼ˆå†™å…¥æ—¶çš„ Value ä¸º nullï¼‰ã€‚åœ¨äº‹åŠ¡å›æ»šæ—¶ï¼Œä¼šè°ƒç”¨åº•å±‚äºŒçº§ç¼“å­˜çš„ removeObject() æ–¹æ³•ï¼Œåˆ é™¤ entriesMissedInCache é›†åˆä¸­ CacheKeyã€‚</p>
<p>ä½ å¯èƒ½ä¼šé—®ï¼Œä¸ºä»€ä¹ˆè¦ç”¨ entriesMissedInCache é›†åˆè®°å½•æœªå‘½ä¸­ç¼“å­˜çš„ CacheKey å‘¢ï¼Ÿä¸ºä»€ä¹ˆè¿˜è¦åœ¨ç¼“å­˜ç»“æŸæ—¶å¤„ç†è¿™äº› CacheKey å‘¢ï¼Ÿè¿™ä¸»è¦æ˜¯ä¸[ç¬¬ 9 è®²]ä»‹ç»çš„ BlockingCache è£…é¥°å™¨ç›¸å…³ã€‚åœ¨å‰é¢ä»‹ç» Cache æ—¶æˆ‘ä»¬æåˆ°è¿‡ï¼ŒCacheBuilder é»˜è®¤ä¼šæ·»åŠ  BlockingCache è¿™ä¸ªè£…é¥°å™¨ï¼Œè€Œ BlockingCache çš„ getObject() æ–¹æ³•ä¼šæœ‰ç»™ CacheKey åŠ é”çš„é€»è¾‘ï¼Œéœ€è¦åœ¨ putObject() æ–¹æ³•æˆ– removeObject() æ–¹æ³•ä¸­è§£é”ï¼Œ<strong>å¦åˆ™è¿™ä¸ª CacheKey ä¼šè¢«ä¸€ç›´é”ä½ï¼Œæ— æ³•ä½¿ç”¨</strong>ã€‚</p>
<p>çœ‹å®Œ TransactionalCache çš„æ ¸å¿ƒå®ç°ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹ TransactionalCache çš„ç®¡ç†è€…â€”â€” TransactionalCacheManagerï¼Œå…¶ä¸­å®šä¹‰äº†ä¸€ä¸ª transactionalCaches å­—æ®µï¼ˆHashMap&lt;Cache, TransactionalCache&gt;ç±»å‹ï¼‰ç»´æŠ¤å½“å‰ CachingExecutor ä½¿ç”¨åˆ°çš„äºŒçº§ç¼“å­˜ï¼Œè¯¥é›†åˆçš„ Key æ˜¯äºŒçº§ç¼“å­˜å¯¹è±¡ï¼ŒValue æ˜¯è£…é¥°äºŒçº§ç¼“å­˜çš„ TransactionalCache å¯¹è±¡ã€‚</p>
<p>TransactionalCacheManager ä¸­çš„æ–¹æ³•å®ç°éƒ½æ¯”è¾ƒç®€å•ï¼Œéƒ½æ˜¯åŸºäº transactionalCaches é›†åˆä»¥åŠ TransactionalCache çš„åŒåæ–¹æ³•å®ç°çš„ï¼Œè¿™é‡Œä¸å†å±•å¼€ä»‹ç»ï¼Œä½ è‹¥æ„Ÿå…´è¶£çš„è¯å¯ä»¥å‚è€ƒ<a href="https://github.com/xxxlxy2008/mybatis?fileGuid=xxQTRXtVcqtHK6j8">æºç </a>è¿›è¡Œåˆ†æã€‚</p>
<h4 id="3-æ ¸å¿ƒå®ç°">3. æ ¸å¿ƒå®ç°</h4>
<p>äº†è§£äº†äºŒçº§ç¼“å­˜åŸºæœ¬æ¦‚å¿µä»¥åŠ TransactionalCache æ ¸å¿ƒå®ç°ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹ CachingExecutor çš„æ ¸å¿ƒå®ç°ã€‚</p>
<p>CachingExecutor ä½œä¸ºä¸€ä¸ªè£…é¥°å™¨ï¼Œå…¶ä¸­è‡ªç„¶ä¼šç»´æŠ¤ä¸€ä¸ª Executor ç±»å‹å­—æ®µæŒ‡å‘è¢«è£…é¥°çš„ Executor å¯¹è±¡ï¼ŒåŒæ—¶å®ƒè¿˜åˆ›å»ºäº†ä¸€ä¸ª TransactionalCacheManager å¯¹è±¡æ¥ç®¡ç†ä½¿ç”¨åˆ°çš„äºŒçº§ç¼“å­˜ã€‚</p>
<p><strong>CachingExecutor çš„æ ¸å¿ƒåœ¨äº query() æ–¹æ³•</strong>ï¼Œå…¶æ ¸å¿ƒæ“ä½œå¤§è‡´å¯æ€»ç»“ä¸ºå¦‚ä¸‹ã€‚</p>
<ul>
<li>è·å– BoundSql å¯¹è±¡ï¼Œåˆ›å»ºæŸ¥è¯¢è¯­å¥å¯¹åº”çš„ CacheKey å¯¹è±¡ã€‚</li>
<li>å°è¯•è·å–å½“å‰å‘½åç©ºé—´ä½¿ç”¨çš„äºŒçº§ç¼“å­˜ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šäºŒçº§ç¼“å­˜ï¼Œåˆ™è¡¨ç¤ºæœªå¼€å¯äºŒçº§ç¼“å­˜åŠŸèƒ½ã€‚å¦‚æœæœªå¼€å¯äºŒçº§ç¼“å­˜åŠŸèƒ½ï¼Œåˆ™ç›´æ¥ä½¿ç”¨è¢«è£…é¥°çš„ Executor å¯¹è±¡è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢æ“ä½œã€‚å¦‚æœå¼€å¯äº†äºŒçº§ç¼“å­˜åŠŸèƒ½ï¼Œåˆ™ç»§ç»­åé¢çš„æ­¥éª¤ã€‚</li>
<li>æŸ¥è¯¢äºŒçº§ç¼“å­˜ï¼Œè¿™é‡Œä½¿ç”¨åˆ° TransactionalCacheManager.getObject() æ–¹æ³•ï¼Œå¦‚æœäºŒçº§ç¼“å­˜å‘½ä¸­ï¼Œåˆ™ç›´æ¥å°†è¯¥ç»“æœå¯¹è±¡è¿”å›ã€‚</li>
<li>å¦‚æœäºŒçº§ç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™é€šè¿‡è¢«è£…é¥°çš„ Executor å¯¹è±¡è¿›è¡ŒæŸ¥è¯¢ã€‚æ­£å¦‚å‰é¢ä»‹ç»çš„é‚£æ ·ï¼ŒBaseExecutor ä¼šå…ˆæŸ¥è¯¢ä¸€çº§ç¼“å­˜ï¼Œå¦‚æœä¸€çº§ç¼“å­˜æœªå‘½ä¸­æ—¶ï¼Œæ‰ä¼šçœŸæ­£æŸ¥è¯¢æ•°æ®åº“ã€‚æœ€åï¼Œä¼šå°†æŸ¥è¯¢åˆ°çš„ç»“æœå¯¹è±¡æ”¾å…¥ TransactionalCache.entriesToAddOnCommit é›†åˆä¸­æš‚å­˜ï¼Œç­‰å¾…äº‹åŠ¡æäº¤æ—¶å†å†™å…¥äºŒçº§ç¼“å­˜ã€‚</li>
</ul>
<p>ä¸‹é¢æ˜¯ CachingExecutor.query() æ–¹æ³•çš„æ ¸å¿ƒä»£ç ç‰‡æ®µï¼š</p>
<pre tabindex="0"><code>public &lt;E&gt; List&lt;E&gt; query(MappedStatement ms, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler) throws SQLException {

    // è·å–BoundSqlå¯¹è±¡

    BoundSql boundSql = ms.getBoundSql(parameterObject);

    // åˆ›å»ºç›¸åº”çš„CacheKey

    CacheKey key = createCacheKey(ms, parameterObject, rowBounds, boundSql);

    // è°ƒç”¨ä¸‹é¢çš„query()æ–¹æ³•é‡è½½

    return query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);

}

public &lt;E&gt; List&lt;E&gt; query(MappedStatement ms, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql)

        throws SQLException {

    Cache cache = ms.getCache(); // è·å–è¯¥å‘½åç©ºé—´ä½¿ç”¨çš„äºŒçº§ç¼“å­˜

    if (cache != null) { // æ˜¯å¦å¼€å¯äº†äºŒçº§ç¼“å­˜åŠŸèƒ½

        flushCacheIfRequired(ms); // æ ¹æ®&lt;select&gt;æ ‡ç­¾é…ç½®å†³å®šæ˜¯å¦éœ€è¦æ¸…ç©ºäºŒçº§ç¼“å­˜

        // æ£€æµ‹useCacheé…ç½®ä»¥åŠæ˜¯å¦ä½¿ç”¨äº†resultHandleré…ç½®

        if (ms.isUseCache() &amp;&amp; resultHandler == null) {

            ensureNoOutParams(ms, boundSql); // æ˜¯å¦åŒ…å«è¾“å‡ºå‚æ•°

            // æŸ¥è¯¢äºŒçº§ç¼“å­˜

            List&lt;E&gt; list = (List&lt;E&gt;) tcm.getObject(cache, key);

            if (list == null) {

                // äºŒçº§ç¼“å­˜æœªå‘½ä¸­ï¼Œé€šè¿‡è¢«è£…é¥°çš„Executorå¯¹è±¡æŸ¥è¯¢ç»“æœå¯¹è±¡

                list = delegate.query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);

                // å°†æŸ¥è¯¢ç»“æœæ”¾å…¥TransactionalCache.entriesToAddOnCommité›†åˆä¸­æš‚å­˜

                tcm.putObject(cache, key, list);

            }

            return list;

        }

    }

    // å¦‚æœæœªå¼€å¯äºŒçº§ç¼“å­˜ï¼Œç›´æ¥é€šè¿‡è¢«è£…é¥°çš„Executorå¯¹è±¡æŸ¥è¯¢ç»“æœå¯¹è±¡

    return delegate.query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);

}
</code></pre><h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>ç´§æ¥ä¸Šä¸€è®²çš„å†…å®¹ï¼Œæˆ‘ä»¬è¯¦ç»†åˆ†æäº† Executor æ¥å£çš„æ ¸å¿ƒå®ç°ç±»ã€‚</p>
<ul>
<li>é¦–å…ˆä»‹ç»äº†æœ€å¸¸ç”¨ã€ä¹Ÿæ˜¯æœ€ç®€å•çš„ Executor å®ç°ç±»â€”â€” SimpleExecutor å®ç°ï¼Œå®ƒåº•å±‚å®Œå…¨ä¾èµ– StatementHandlerã€DefaultResultSetHandler å’Œ JDBC API å®Œæˆæ•°æ®åº“æŸ¥è¯¢å’Œç»“æœé›†æ˜ å°„ã€‚</li>
<li>æ¥ä¸‹æ¥è®²è§£äº† ReuseExecutor å’Œ BatchExecutor å®ç°ï¼Œå…¶ä¸­ ReuseExecutor å®ç°äº† Statement å¯¹è±¡çš„é‡ç”¨ï¼Œè€Œ BatchExecutor å®ç°äº†æ‰¹å¤„ç†çš„ç›¸å…³é€»è¾‘ã€‚</li>
<li>æœ€åè®²è§£äº† CachingExecutor å®ç°ï¼Œå…¶ä¸­é‡ç‚¹ä»‹ç»äº†äºŒçº§ç¼“å­˜çš„å†…å®¹ä»¥åŠ CachingExecutor åº•å±‚çš„ TransactionalCacheã€TransactionalCacheManager ç­‰æ ¸å¿ƒç»„ä»¶ã€‚</li>
</ul>

        </div>
    </article>
</div>
<div class="division-line"></div>
<div class="others">
    <div>æ ‡ç­¾ï¼šğŸ·ï¸<a class="post-tag" href="/tags/mybatis/">mybatis</a>&nbsp;</div>
    <div>åˆ†ç±»ï¼š ğŸ“’<a class="post-category" href="/categories/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/">æ·±å…¥å‰–æMyBatisæ ¸å¿ƒåŸç†</a>&nbsp; </div>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/17-executor-%E6%89%8D%E6%98%AF%E6%89%A7%E8%A1%8C-sql-%E8%AF%AD%E5%8F%A5%E7%9A%84%E5%B9%95%E5%90%8E%E6%8E%A8%E6%89%8B%E4%B8%8A/"><span>17 Executor æ‰æ˜¯æ‰§è¡Œ SQL è¯­å¥çš„å¹•åæ¨æ‰‹ï¼ˆä¸Šï¼‰</span></a>
    </div>
    <div class="next">
        
        <a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/19-%E6%B7%B1%E5%85%A5-mybatis-%E5%86%85%E6%A0%B8%E4%B8%8E%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E7%9A%84%E6%A1%A5%E6%A2%81%E6%8E%A5%E5%8F%A3%E5%B1%82/"><span>19 æ·±å…¥ MyBatis å†…æ ¸ä¸ä¸šåŠ¡é€»è¾‘çš„æ¡¥æ¢â€”â€”æ¥å£å±‚</span></a>
    </div>
</div>

        </div>
        <div id="float">
            <ul class="float-button-bar">
    <li>
        <button class="float-button top" onclick="scrollToTop(this);">UP</button>
    </li>
    <li>
        <button class="float-button toggler" onclick="changeSkin(this);">DARK</button>
    </li>
</ul>
        </div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 2020 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    const changeSkin = () => {
        document.getElementById('page').classList.toggle('night');
    }
    const scrollToTop = () => {
        window.scrollTo(0, 0);
    }
</script>
</body>

</html>