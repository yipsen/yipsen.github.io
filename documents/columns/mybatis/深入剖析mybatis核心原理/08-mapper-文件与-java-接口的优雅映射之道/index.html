<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>08 Mapper æ–‡ä»¶ä¸ Java æ¥å£çš„ä¼˜é›…æ˜ å°„ä¹‹é“ | Yipsen Ye</title>
<meta name="description" content="åœ¨&amp;lt;ä½¿ç”¨ MyBatis å®ç°è®¢å•ç³»ç»Ÿç¤ºä¾‹çš„æ—¶å€™&amp;gt;ï¼Œæˆ‘ä»¬ä¼šä¸ºæ¯ä¸ª Mapper.xml é…ç½®æ–‡ä»¶åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ Mapper æ¥å£ï¼Œä¾‹å¦‚ï¼Œè®¢å•ç³»ç»Ÿç¤ºä¾‹ä¸­çš„ CustomerMapper.xml é…ç½®æ–‡ä»¶ä¸ CustomerMapper æ¥å£ï¼Œå®šä¹‰å®Œ CustomerMapper æ¥å£ä¹‹åï¼Œæˆ‘ä»¬æ— é¡»æä¾› CustomerMapper æ¥å£å®ç°ï¼Œå°±å¯ä»¥ç›´æ¥è°ƒç”¨ CustomerMapper å¯¹è±¡çš„æ–¹æ³•æ‰§è¡Œ CustomerMapper.xml é…ç½®æ–‡ä»¶ä¸­çš„ SQL è¯­å¥ã€‚
è¿™é‡Œä½ å¯èƒ½ä¼šæœ‰å‡ ä¸ªç–‘æƒ‘ï¼š
 ä¸ºä»€ä¹ˆéœ€è¦ CustomerMapper æ¥å£æ¥æ‰§è¡Œå¯¹åº”çš„ SQL è¯­å¥å‘¢ï¼Ÿ ä¸ºä»€ä¹ˆæ— é¡»æä¾› CustomerMapper æ¥å£çš„å®ç°ç±»å‘¢ï¼Ÿ å®é™…ä½¿ç”¨çš„ CustomerMapper å¯¹è±¡æ˜¯ä»€ä¹ˆå‘¢ï¼ŸCustomerMapper å¯¹è±¡æ˜¯æ€ä¹ˆåˆ›å»ºçš„å‘¢ï¼Ÿåº•å±‚åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ  å­¦ä¹ å®Œè¿™ä¸€è®²ï¼Œä½ å°±ä¼šæ‰¾åˆ°è¿™äº›é—®é¢˜çš„ç­”æ¡ˆã€‚
MyBatis çš„å‰èº«æ˜¯ iBatisï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ iBatis çš„æ—¶å€™ï¼Œå¦‚æœæƒ³æŸ¥è¯¢ä¸€ä¸ª Customer å¯¹è±¡çš„è¯ï¼Œå¯ä»¥è°ƒç”¨ SqlSession.queryForObject (&amp;ldquo;find&amp;rdquo;, customerId) æ–¹æ³•ï¼ŒqueryForObject() æ–¹æ³•çš„è¿™ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯è¦æ‰§è¡Œçš„ SQL è¯­å¥å”¯ä¸€æ ‡è¯†ï¼ˆç¤ºä¾‹ä¸­å°±æ˜¯å®šä¹‰åœ¨ CustomerMapper.xml ä¸­çš„ id ä¸º find çš„ SQL è¯­å¥ï¼‰ï¼Œä»¥åŠ SQL è¯­å¥æ‰§è¡Œæ—¶éœ€è¦çš„å®å‚ï¼ˆç¤ºä¾‹ä¸­å°±æ˜¯é¡¾å®¢ IDï¼‰ã€‚
è¿™é‡Œ SQL è¯­å¥çš„å”¯ä¸€æ ‡è¯†æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œä¸å°å¿ƒå†™é”™äº†è¿™ä¸ªå”¯ä¸€æ ‡è¯†ï¼Œä¾‹å¦‚å°†â€œfindâ€å†™æˆäº†â€œfinbâ€ï¼Œåœ¨ä»£ç ç¼–è¯‘ä»¥åŠ iBatis åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæ ¹æœ¬å‘ç°ä¸äº†è¿™ä¸ªé—®é¢˜ï¼Œè€Œæ˜¯åœ¨çœŸæ­£æ‰§è¡Œåˆ°è¿™è¡Œä»£ç çš„æ—¶å€™æ‰ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè¿™æ ·å…¶å®å¯¹æµé‡æ˜¯æœ‰æŸçš„ã€‚
MyBatis ä¸­çš„ Mapper æ¥å£å°±å¯ä»¥å¾ˆå¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="nav-logo">
    <a href="http://yipsen.github.io/">
        
        <span class="nav-title">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æ–‡ç« </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/%e6%b7%b1%e5%85%a5%e5%89%96%e6%9e%90mybatis%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86/">æ·±å…¥å‰–æMyBatisæ ¸å¿ƒåŸç†</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/00-%E5%BC%80%E7%AF%87%E8%AF%8D-%E9%A2%86%E7%95%A5-mybatis-%E8%AE%BE%E8%AE%A1%E6%80%9D%E7%BB%B4%E7%AA%81%E7%A0%B4%E6%8C%81%E4%B9%85%E5%8C%96%E6%8A%80%E6%9C%AF%E7%93%B6%E9%A2%88/">00 å¼€ç¯‡è¯ é¢†ç•¥ MyBatis è®¾è®¡æ€ç»´ï¼Œçªç ´æŒä¹…åŒ–æŠ€æœ¯ç“¶é¢ˆ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/01-%E5%B8%B8%E8%A7%81%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6%E8%B5%8F%E6%9E%90%E5%88%B0%E5%BA%95%E6%98%AF%E4%BB%80%E4%B9%88%E8%AE%A9%E4%BD%A0%E9%80%89%E6%8B%A9-mybatis/">01 å¸¸è§æŒä¹…å±‚æ¡†æ¶èµæï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆè®©ä½ é€‰æ‹© MyBatisï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/02-%E8%AE%A2%E5%8D%95%E7%B3%BB%E7%BB%9F%E6%8C%81%E4%B9%85%E5%B1%82%E7%A4%BA%E4%BE%8B%E5%88%86%E6%9E%9020-%E5%88%86%E9%92%9F%E5%B8%A6%E4%BD%A0%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B-mybatis/">02 è®¢å•ç³»ç»ŸæŒä¹…å±‚ç¤ºä¾‹åˆ†æï¼Œ20 åˆ†é’Ÿå¸¦ä½ å¿«é€Ÿä¸Šæ‰‹ MyBatis</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/03-mybatis-%E6%BA%90%E7%A0%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%8F%8A%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90/">03 MyBatis æºç ç¯å¢ƒæ­å»ºåŠæ•´ä½“æ¶æ„è§£æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/04-mybatis-%E5%8F%8D%E5%B0%84%E5%B7%A5%E5%85%B7%E7%AE%B1%E5%B8%A6%E4%BD%A0%E9%A2%86%E7%95%A5%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84%E5%8F%8D%E5%B0%84%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF/">04 MyBatis åå°„å·¥å…·ç®±ï¼šå¸¦ä½ é¢†ç•¥ä¸ä¸€æ ·çš„åå°„è®¾è®¡æ€è·¯</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/05-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E5%9E%8B%E4%BD%93%E7%B3%BB%E4%B8%8E-java-%E7%B1%BB%E5%9E%8B%E4%BD%93%E7%B3%BB%E4%B9%8B%E9%97%B4%E7%9A%84%E7%88%B1%E6%81%A8%E6%83%85%E4%BB%87/">05 æ•°æ®åº“ç±»å‹ä½“ç³»ä¸ Java ç±»å‹ä½“ç³»ä¹‹é—´çš„â€œçˆ±æ¨æƒ…ä»‡â€</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/06-%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6%E5%8D%83%E5%8D%83%E4%B8%87mybatis-%E9%83%BD%E8%83%BD%E5%85%BC%E5%AE%B9%E7%9A%84%E7%A7%98%E5%AF%86%E6%98%AF%E4%BB%80%E4%B9%88/">06 æ—¥å¿—æ¡†æ¶åƒåƒä¸‡ï¼ŒMyBatis éƒ½èƒ½å…¼å®¹çš„ç§˜å¯†æ˜¯ä»€ä¹ˆï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/07-%E6%B7%B1%E5%85%A5%E6%95%B0%E6%8D%AE%E6%BA%90%E5%92%8C%E4%BA%8B%E5%8A%A1%E6%8A%8A%E6%8F%A1%E6%8C%81%E4%B9%85%E5%8C%96%E6%A1%86%E6%9E%B6%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%85%B3%E9%94%AE%E5%91%BD%E8%84%89/">07 æ·±å…¥æ•°æ®æºå’Œäº‹åŠ¡ï¼ŒæŠŠæ¡æŒä¹…åŒ–æ¡†æ¶çš„ä¸¤ä¸ªå…³é”®å‘½è„‰</a></li>
                
                
                
                    <li>08 Mapper æ–‡ä»¶ä¸ Java æ¥å£çš„ä¼˜é›…æ˜ å°„ä¹‹é“</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/09-%E5%9F%BA%E4%BA%8E-mybatis-%E7%BC%93%E5%AD%98%E5%88%86%E6%9E%90%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">09 åŸºäº MyBatis ç¼“å­˜åˆ†æè£…é¥°å™¨æ¨¡å¼çš„æœ€ä½³å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/10-%E9%B8%9F%E7%9E%B0-mybatis-%E5%88%9D%E5%A7%8B%E5%8C%96%E6%8A%8A%E6%8F%A1-mybatis-%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E8%84%89%E7%BB%9C%E4%B8%8A/">10 é¸Ÿç° MyBatis åˆå§‹åŒ–ï¼ŒæŠŠæ¡ MyBatis å¯åŠ¨æµç¨‹è„‰ç»œï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/11-%E9%B8%9F%E7%9E%B0-mybatis-%E5%88%9D%E5%A7%8B%E5%8C%96%E6%8A%8A%E6%8F%A1-mybatis-%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E8%84%89%E7%BB%9C%E4%B8%8B/">11 é¸Ÿç° MyBatis åˆå§‹åŒ–ï¼ŒæŠŠæ¡ MyBatis å¯åŠ¨æµç¨‹è„‰ç»œï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/12-%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E5%8A%A8%E6%80%81-sql-%E8%AF%AD%E5%8F%A5%E8%A7%A3%E6%9E%90%E5%85%A8%E6%B5%81%E7%A8%8B%E4%B8%8A/">12 æ·±å…¥åˆ†æåŠ¨æ€ SQL è¯­å¥è§£æå…¨æµç¨‹ï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/13-%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E5%8A%A8%E6%80%81-sql-%E8%AF%AD%E5%8F%A5%E8%A7%A3%E6%9E%90%E5%85%A8%E6%B5%81%E7%A8%8B%E4%B8%8B/">13 æ·±å…¥åˆ†æåŠ¨æ€ SQL è¯­å¥è§£æå…¨æµç¨‹ï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/14-%E6%8E%A2%E7%A9%B6-mybatis-%E7%BB%93%E6%9E%9C%E9%9B%86%E6%98%A0%E5%B0%84%E6%9C%BA%E5%88%B6%E8%83%8C%E5%90%8E%E7%9A%84%E7%A7%98%E5%AF%86%E4%B8%8A/">14 æ¢ç©¶ MyBatis ç»“æœé›†æ˜ å°„æœºåˆ¶èƒŒåçš„ç§˜å¯†ï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/15-%E6%8E%A2%E7%A9%B6-mybatis-%E7%BB%93%E6%9E%9C%E9%9B%86%E6%98%A0%E5%B0%84%E6%9C%BA%E5%88%B6%E8%83%8C%E5%90%8E%E7%9A%84%E7%A7%98%E5%AF%86%E4%B8%8B/">15 æ¢ç©¶ MyBatis ç»“æœé›†æ˜ å°„æœºåˆ¶èƒŒåçš„ç§˜å¯†ï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/16-statementhandler%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9Asql-%E6%89%A7%E8%A1%8C%E5%92%8C%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84%E7%9A%84%E5%A5%A0%E5%9F%BA%E8%80%85/">16 StatementHandlerï¼šå‚æ•°ç»‘å®šã€SQL æ‰§è¡Œå’Œç»“æœæ˜ å°„çš„å¥ åŸºè€…</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/17-executor-%E6%89%8D%E6%98%AF%E6%89%A7%E8%A1%8C-sql-%E8%AF%AD%E5%8F%A5%E7%9A%84%E5%B9%95%E5%90%8E%E6%8E%A8%E6%89%8B%E4%B8%8A/">17 Executor æ‰æ˜¯æ‰§è¡Œ SQL è¯­å¥çš„å¹•åæ¨æ‰‹ï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/18-executor-%E6%89%8D%E6%98%AF%E6%89%A7%E8%A1%8C-sql-%E8%AF%AD%E5%8F%A5%E7%9A%84%E5%B9%95%E5%90%8E%E6%8E%A8%E6%89%8B%E4%B8%8B/">18 Executor æ‰æ˜¯æ‰§è¡Œ SQL è¯­å¥çš„å¹•åæ¨æ‰‹ï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/19-%E6%B7%B1%E5%85%A5-mybatis-%E5%86%85%E6%A0%B8%E4%B8%8E%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E7%9A%84%E6%A1%A5%E6%A2%81%E6%8E%A5%E5%8F%A3%E5%B1%82/">19 æ·±å…¥ MyBatis å†…æ ¸ä¸ä¸šåŠ¡é€»è¾‘çš„æ¡¥æ¢â€”â€”æ¥å£å±‚</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/20-%E6%8F%92%E4%BB%B6%E4%BD%93%E7%B3%BB%E8%AE%A9-mybatis-%E4%B8%96%E7%95%8C%E6%9B%B4%E5%8A%A0%E7%B2%BE%E5%BD%A9/">20 æ’ä»¶ä½“ç³»è®© MyBatis ä¸–ç•Œæ›´åŠ ç²¾å½©</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/21-%E6%B7%B1%E6%8C%96-mybatis-%E4%B8%8E-spring-%E9%9B%86%E6%88%90%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/">21 æ·±æŒ– MyBatis ä¸ Spring é›†æˆåº•å±‚åŸç†</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/22-%E5%9F%BA%E4%BA%8E-mybatis-%E7%9A%84%E8%A1%8D%E7%94%9F%E6%A1%86%E6%9E%B6%E4%B8%80%E8%A7%88/">22 åŸºäº MyBatis çš„è¡ç”Ÿæ¡†æ¶ä¸€è§ˆ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/23-%E7%BB%93%E6%9D%9F%E8%AF%AD-%E4%BC%9A%E4%BD%BF%E7%94%A8%E5%8F%AA%E8%83%BD%E9%BB%98%E9%BB%98%E6%90%AC%E7%A0%96%E6%87%82%E5%8E%9F%E7%90%86%E6%89%8D%E8%83%BD%E5%BF%AB%E9%80%9F%E6%99%8B%E5%8D%87/">23 ç»“æŸè¯­ ä¼šä½¿ç”¨åªèƒ½é»˜é»˜â€œæ¬ç –â€ï¼Œæ‡‚åŸç†æ‰èƒ½å¿«é€Ÿæ™‹å‡</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">08 Mapper æ–‡ä»¶ä¸ Java æ¥å£çš„ä¼˜é›…æ˜ å°„ä¹‹é“</h1>
        <div class="post-info">
            <div class="post-date"> 
                <span>2021-12-22 01:51:10</span>
            </div>
        </div>
        <div class="post-content">
            <p>åœ¨&lt;ä½¿ç”¨ MyBatis å®ç°è®¢å•ç³»ç»Ÿç¤ºä¾‹çš„æ—¶å€™&gt;ï¼Œæˆ‘ä»¬ä¼šä¸ºæ¯ä¸ª Mapper.xml é…ç½®æ–‡ä»¶åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ Mapper æ¥å£ï¼Œä¾‹å¦‚ï¼Œè®¢å•ç³»ç»Ÿç¤ºä¾‹ä¸­çš„ CustomerMapper.xml é…ç½®æ–‡ä»¶ä¸ CustomerMapper æ¥å£ï¼Œå®šä¹‰å®Œ CustomerMapper æ¥å£ä¹‹åï¼Œæˆ‘ä»¬æ— é¡»æä¾› CustomerMapper æ¥å£å®ç°ï¼Œå°±å¯ä»¥ç›´æ¥è°ƒç”¨ CustomerMapper å¯¹è±¡çš„æ–¹æ³•æ‰§è¡Œ CustomerMapper.xml é…ç½®æ–‡ä»¶ä¸­çš„ SQL è¯­å¥ã€‚</p>
<p>è¿™é‡Œä½ å¯èƒ½ä¼šæœ‰å‡ ä¸ªç–‘æƒ‘ï¼š</p>
<ul>
<li>ä¸ºä»€ä¹ˆéœ€è¦ CustomerMapper æ¥å£æ¥æ‰§è¡Œå¯¹åº”çš„ SQL è¯­å¥å‘¢ï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆæ— é¡»æä¾› CustomerMapper æ¥å£çš„å®ç°ç±»å‘¢ï¼Ÿ</li>
<li>å®é™…ä½¿ç”¨çš„ CustomerMapper å¯¹è±¡æ˜¯ä»€ä¹ˆå‘¢ï¼ŸCustomerMapper å¯¹è±¡æ˜¯æ€ä¹ˆåˆ›å»ºçš„å‘¢ï¼Ÿåº•å±‚åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</li>
</ul>
<p>å­¦ä¹ å®Œè¿™ä¸€è®²ï¼Œä½ å°±ä¼šæ‰¾åˆ°è¿™äº›é—®é¢˜çš„ç­”æ¡ˆã€‚</p>
<p>MyBatis çš„å‰èº«æ˜¯ iBatisï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ iBatis çš„æ—¶å€™ï¼Œå¦‚æœæƒ³æŸ¥è¯¢ä¸€ä¸ª Customer å¯¹è±¡çš„è¯ï¼Œå¯ä»¥è°ƒç”¨ SqlSession.queryForObject (&ldquo;find&rdquo;, customerId) æ–¹æ³•ï¼ŒqueryForObject() æ–¹æ³•çš„è¿™ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯è¦æ‰§è¡Œçš„ SQL è¯­å¥å”¯ä¸€æ ‡è¯†ï¼ˆç¤ºä¾‹ä¸­å°±æ˜¯å®šä¹‰åœ¨ CustomerMapper.xml ä¸­çš„ id ä¸º find çš„ SQL è¯­å¥ï¼‰ï¼Œä»¥åŠ SQL è¯­å¥æ‰§è¡Œæ—¶éœ€è¦çš„å®å‚ï¼ˆç¤ºä¾‹ä¸­å°±æ˜¯é¡¾å®¢ IDï¼‰ã€‚</p>
<p>è¿™é‡Œ SQL è¯­å¥çš„å”¯ä¸€æ ‡è¯†æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œä¸å°å¿ƒå†™é”™äº†è¿™ä¸ªå”¯ä¸€æ ‡è¯†ï¼Œä¾‹å¦‚å°†â€œfindâ€å†™æˆäº†â€œfinbâ€ï¼Œåœ¨ä»£ç ç¼–è¯‘ä»¥åŠ iBatis åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæ ¹æœ¬å‘ç°ä¸äº†è¿™ä¸ªé—®é¢˜ï¼Œè€Œæ˜¯åœ¨çœŸæ­£æ‰§è¡Œåˆ°è¿™è¡Œä»£ç çš„æ—¶å€™æ‰ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè¿™æ ·å…¶å®å¯¹æµé‡æ˜¯æœ‰æŸçš„ã€‚</p>
<p>MyBatis ä¸­çš„ Mapper æ¥å£å°±å¯ä»¥å¾ˆå¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>ç¤ºä¾‹ä¸­çš„ CustomerMapper æ¥å£ä¸­å®šä¹‰äº† SQL è¯­å¥å”¯ä¸€æ ‡è¯†åŒåçš„ find() æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯ CustomerMapper.find() æ–¹æ³•ï¼Œå¦‚æœæ‹¼å†™æˆ CustomerMapper.finb()ï¼Œç¼–è¯‘ä¼šå¤±è´¥ã€‚è¿™æ˜¯å› ä¸º MyBatis åˆå§‹åŒ–çš„æ—¶å€™ä¼šå°è¯•<strong>å°† CustomerMapper æ¥å£ä¸­çš„ find() æ–¹æ³•åä¸ CustomerMapper.xml é…ç½®æ–‡ä»¶ä¸­çš„ SQL å”¯ä¸€æ ‡è¯†è¿›è¡Œæ˜ å°„</strong>ï¼Œå¦‚æœ SQL è¯­å¥å”¯ä¸€æ ‡è¯†å†™é”™æˆâ€œfinbâ€ï¼ŒMyBatis ä¼šå‘ç°è¿™ä¸ªé”™è¯¯ï¼Œå¹¶åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­å°±æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™æ ·ç¼–è¯‘å™¨ä»¥åŠ MyBatis å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´æ—©å‘ç°å¼‚å¸¸ï¼Œé¿å…çº¿ä¸Šæµé‡çš„æŸå¤±ã€‚</p>
<p><strong>åœ¨ MyBatis ä¸­ï¼Œå®ç° CustomerMapper æ¥å£ä¸ CustomerMapper.xml é…ç½®æ–‡ä»¶æ˜ å°„åŠŸèƒ½çš„æ˜¯ binding æ¨¡å—</strong>ï¼Œå…¶ä¸­æ¶‰åŠçš„æ ¸å¿ƒç±»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%20MyBatis%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86-%E5%AE%8C/assets/CioPOWAs1vuAT8xsAAEXCFQuFx4772.png" alt="å›¾ç‰‡5.png"></p>
<p>binding æ¨¡å—æ ¸å¿ƒç»„ä»¶å…³ç³»å›¾</p>
<p>ä¸‹é¢æˆ‘ä»¬å°±å¼€å§‹è¯¦ç»†åˆ†æ binding æ¨¡å—ä¸­æ¶‰åŠçš„è¿™äº›æ ¸å¿ƒç»„ä»¶ã€‚</p>
<h3 id="mapperregistry">MapperRegistry</h3>
<p><strong>MapperRegistry æ˜¯ MyBatis åˆå§‹åŒ–è¿‡ç¨‹ä¸­æ„é€ çš„ä¸€ä¸ªå¯¹è±¡ï¼Œä¸»è¦ä½œç”¨å°±æ˜¯ç»Ÿä¸€ç»´æŠ¤ Mapper æ¥å£ä»¥åŠè¿™äº› Mapper çš„ä»£ç†å¯¹è±¡å·¥å‚</strong>ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬å…ˆæ¥çœ‹ MapperRegistry ä¸­çš„æ ¸å¿ƒå­—æ®µã€‚</p>
<ul>
<li>configï¼ˆConfiguration ç±»å‹ï¼‰ï¼šæŒ‡å‘ MyBatis å…¨å±€å”¯ä¸€çš„ Configuration å¯¹è±¡ï¼Œå…¶ä¸­ç»´æŠ¤äº†è§£æä¹‹åçš„å…¨éƒ¨ MyBatis é…ç½®ä¿¡æ¯ã€‚</li>
<li>knownMappersï¼ˆMap&lt;Class<code>&lt;?&gt;</code>, MapperProxyFactory&lt;?&raquo; ç±»å‹ï¼‰ï¼šç»´æŠ¤äº†æ‰€æœ‰è§£æåˆ°çš„ Mapper æ¥å£ä»¥åŠ MapperProxyFactory å·¥å‚å¯¹è±¡ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚</li>
</ul>
<p>åœ¨ MyBatis åˆå§‹åŒ–æ—¶ï¼Œä¼šè¯»å–å…¨éƒ¨ Mapper.xml é…ç½®æ–‡ä»¶ï¼Œè¿˜ä¼šæ‰«æå…¨éƒ¨ Mapper æ¥å£ä¸­çš„æ³¨è§£ä¿¡æ¯ï¼Œä¹‹åä¼šè°ƒç”¨ MapperRegistry.addMapper() æ–¹æ³•å¡«å…… knownMappers é›†åˆã€‚åœ¨ addMapper() æ–¹æ³•å¡«å…… knownMappers é›†åˆä¹‹å‰ï¼ŒMapperRegistry ä¼šå…ˆä¿è¯ä¼ å…¥çš„ type å‚æ•°æ˜¯ä¸€ä¸ªæ¥å£ä¸” knownMappers é›†åˆæ²¡æœ‰åŠ è½½è¿‡ type ç±»å‹ï¼Œç„¶åæ‰ä¼šåˆ›å»ºç›¸åº”çš„ MapperProxyFactory å·¥å‚å¹¶è®°å½•åˆ° knownMappers é›†åˆä¸­ã€‚</p>
<p>åœ¨æˆ‘ä»¬ä½¿ç”¨ CustomerMapper.find() æ–¹æ³•æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢çš„æ—¶å€™ï¼ŒMyBatis ä¼šå…ˆä»MapperRegistry ä¸­è·å– CustomerMapper æ¥å£çš„ä»£ç†å¯¹è±¡ï¼Œè¿™é‡Œå°±ä½¿ç”¨åˆ° MapperRegistry.getMapper()æ–¹æ³•ï¼Œå®ƒä¼šæ‹¿åˆ°å‰é¢åˆ›å»ºçš„ MapperProxyFactory å·¥å‚å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶ newInstance() æ–¹æ³•åˆ›å»º Mapper æ¥å£çš„ä»£ç†å¯¹è±¡ã€‚</p>
<h3 id="mapperproxyfactory">MapperProxyFactory</h3>
<p>æ­£å¦‚åˆ†æ MapperRegistry æ—¶ä»‹ç»çš„é‚£æ ·ï¼Œ<strong>MapperProxyFactory çš„æ ¸å¿ƒåŠŸèƒ½å°±æ˜¯åˆ›å»º Mapper æ¥å£çš„ä»£ç†å¯¹è±¡</strong>ï¼Œå…¶åº•å±‚æ ¸å¿ƒåŸç†å°±æ˜¯å‰é¢ã€Š06 | æ—¥å¿—æ¡†æ¶åƒåƒä¸‡ï¼ŒMyBatis éƒ½èƒ½å…¼å®¹çš„ç§˜å¯†æ˜¯ä»€ä¹ˆï¼Ÿã€‹ä»‹ç»çš„ JDK åŠ¨æ€ä»£ç†ã€‚</p>
<p>åœ¨ MapperRegistry ä¸­ä¼šä¾èµ– MapperProxyFactory çš„ newInstance() æ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œåº•å±‚åˆ™æ˜¯é€šè¿‡ JDK åŠ¨æ€ä»£ç†çš„æ–¹å¼ç”Ÿæˆä»£ç†å¯¹è±¡çš„ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼Œè¿™é‡Œä½¿ç”¨çš„ InvocationHandler å®ç°æ˜¯ MapperProxyã€‚</p>
<pre tabindex="0"><code>protected T newInstance(MapperProxy&lt;T&gt; mapperProxy) {

    // åˆ›å»ºå®ç°äº†mapperInterfaceæ¥å£çš„åŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œè¿™é‡Œä½¿ç”¨çš„InvocationHandler å®ç°æ˜¯MapperProxy

    return (T) Proxy.newProxyInstance(mapperInterface.getClassLoader(),

            new Class[]{mapperInterface}, mapperProxy);

}
</code></pre><h3 id="mapperproxy">MapperProxy</h3>
<p>é€šè¿‡åˆ†æ MapperProxyFactory è¿™ä¸ªå·¥å‚ç±»ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°<strong>MapperProxy æ˜¯ç”Ÿæˆ Mapper æ¥å£ä»£ç†å¯¹è±¡çš„å…³é”®ï¼Œå®ƒå®ç°äº† InvocationHandler æ¥å£</strong>ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬å…ˆæ¥ä»‹ç»ä¸€ä¸‹ MapperProxy ä¸­çš„æ ¸å¿ƒå­—æ®µã€‚</p>
<ul>
<li>sqlSessionï¼ˆSqlSession ç±»å‹ï¼‰ï¼šè®°å½•äº†å½“å‰ MapperProxy å…³è”çš„ SqlSession å¯¹è±¡ã€‚åœ¨ä¸å½“å‰ MapperProxy å…³è”çš„ä»£ç†å¯¹è±¡ä¸­ï¼Œä¼šç”¨è¯¥ SqlSession è®¿é—®æ•°æ®åº“ã€‚</li>
<li>mapperInterfaceï¼ˆClass<code>&lt;T&gt;</code> ç±»å‹ï¼‰ï¼šMapper æ¥å£ç±»å‹ï¼Œä¹Ÿæ˜¯å½“å‰ MapperProxy å…³è”çš„ä»£ç†å¯¹è±¡å®ç°çš„æ¥å£ç±»å‹ã€‚</li>
<li>methodCacheï¼ˆMap&lt;Method, MapperMethodInvoker&gt; ç±»å‹ï¼‰ï¼šç”¨äºç¼“å­˜ MapperMethodInvoker å¯¹è±¡çš„é›†åˆã€‚methodCache ä¸­çš„ key æ˜¯ Mapper æ¥å£ä¸­çš„æ–¹æ³•ï¼Œvalue æ˜¯è¯¥æ–¹æ³•å¯¹åº”çš„ MapperMethodInvoker å¯¹è±¡ã€‚</li>
<li>lookupConstructorï¼ˆConstructor ç±»å‹ï¼‰ï¼šé’ˆå¯¹ JDK 8 ä¸­çš„ç‰¹æ®Šå¤„ç†ï¼Œè¯¥å­—æ®µæŒ‡å‘äº† MethodHandles.Lookup çš„æ„é€ æ–¹æ³•ã€‚</li>
<li>privateLookupInMethodï¼ˆMethod ç±»å‹ï¼‰ï¼šé™¤äº† JDK 8 ä¹‹å¤–çš„å…¶ä»– JDK ç‰ˆæœ¬ä¼šä½¿ç”¨è¯¥å­—æ®µï¼Œè¯¥å­—æ®µæŒ‡å‘ MethodHandles.privateLookupIn() æ–¹æ³•ã€‚</li>
</ul>
<p>è¿™é‡Œæ¶‰åŠ MethodHandle çš„å†…å®¹ï¼Œæ‰€ä»¥ä¸‹é¢æˆ‘ä»¬å°±æ¥ç®€å•ä»‹ç»ä¸€ä¸‹ MethodHandle çš„åŸºç¡€çŸ¥è¯†ç‚¹ã€‚</p>
<h4 id="1-methodhandle-ç®€ä»‹">1. MethodHandle ç®€ä»‹</h4>
<p>ä» Java 7 å¼€å§‹ï¼Œé™¤äº†åå°„ä¹‹å¤–ï¼Œåœ¨ java.lang.invoke åŒ…ä¸­æ–°å¢äº† MethodHandle è¿™ä¸ªç±»ï¼Œå®ƒçš„åŸºæœ¬åŠŸèƒ½ä¸åå°„ä¸­çš„ Method ç±»ä¼¼ï¼Œä½†å®ƒæ¯”åå°„æ›´åŠ çµæ´»ã€‚<strong>åå°„æ˜¯ Java API å±‚é¢æ”¯æŒçš„ä¸€ç§æœºåˆ¶ï¼ŒMethodHandle åˆ™æ˜¯ JVM å±‚æ”¯æŒçš„æœºåˆ¶ï¼Œç›¸è¾ƒè€Œè¨€ï¼Œåå°„æ›´åŠ é‡é‡çº§ï¼ŒMethodHandle åˆ™æ›´è½»é‡çº§ï¼Œæ€§èƒ½ä¹Ÿæ¯”åå°„æ›´å¥½äº›</strong>ã€‚</p>
<p>ä½¿ç”¨ MethodHandle è¿›è¡Œæ–¹æ³•è°ƒç”¨çš„æ—¶å€™ï¼Œå¾€å¾€ä¼šæ¶‰åŠä¸‹é¢å‡ ä¸ªæ ¸å¿ƒæ­¥éª¤ï¼š</p>
<ol>
<li>åˆ›å»º MethodType å¯¹è±¡ï¼Œç¡®å®šæ–¹æ³•çš„ç­¾åï¼Œè¿™ä¸ªç­¾åä¼šæ¶‰åŠæ–¹æ³•å‚æ•°åŠè¿”å›å€¼çš„ç±»å‹ï¼›</li>
<li>åœ¨ MethodHandles.Lookup è¿™ä¸ªå·¥å‚å¯¹è±¡ä¸­ï¼Œæ ¹æ®æ–¹æ³•åç§°ä»¥åŠä¸Šé¢åˆ›å»ºçš„ MethodType æŸ¥æ‰¾å¯¹åº” MethodHandle å¯¹è±¡ï¼›</li>
<li>å°† MethodHandle ç»‘å®šåˆ°ä¸€ä¸ªå…·ä½“çš„å®ä¾‹å¯¹è±¡ï¼›</li>
<li>è°ƒç”¨ MethodHandle.invoke()/invokeWithArguments()/invokeExact() æ–¹æ³•ï¼Œå®Œæˆæ–¹æ³•è°ƒç”¨ã€‚</li>
</ol>
<p>ä¸‹é¢æ˜¯ MethodHandle çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼š</p>
<pre tabindex="0"><code>public class MethodHandleDemo {

    // å®šä¹‰ä¸€ä¸ªsayHello()æ–¹æ³•

    public String sayHello(String s) {

        return &quot;Hello, &quot; + s;

    }

    public static void main(String[] args) throws Throwable {

        // åˆå§‹åŒ–MethodHandleDemoå®ä¾‹

        MethodHandleDemo subMethodHandleDemo = new SubMethodHandleDemo();

        // å®šä¹‰sayHello()æ–¹æ³•çš„ç­¾åï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–¹æ³•çš„è¿”å›å€¼ç±»å‹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–¹æ³•çš„å‚æ•°åˆ—è¡¨

        MethodType methodType = MethodType.methodType(String.class, String.class);

        // æ ¹æ®æ–¹æ³•åå’ŒMethodTypeåœ¨MethodHandleDemoä¸­æŸ¥æ‰¾å¯¹åº”çš„MethodHandle

        MethodHandle methodHandle = MethodHandles.lookup()

                .findVirtual(MethodHandleDemo.class, &quot;sayHello&quot;, methodType);

        // å°†MethodHandleç»‘å®šåˆ°ä¸€ä¸ªå¯¹è±¡ä¸Šï¼Œç„¶åé€šè¿‡invokeWithArguments()æ–¹æ³•ä¼ å…¥å®å‚å¹¶æ‰§è¡Œ

        System.out.println(methodHandle.bindTo(subMethodHandleDemo)

                .invokeWithArguments(&quot;MethodHandleDemo&quot;));

        // ä¸‹é¢æ˜¯è°ƒç”¨MethodHandleDemoå¯¹è±¡(å³çˆ¶ç±»)çš„æ–¹æ³•

        MethodHandleDemo methodHandleDemo = new MethodHandleDemo();

        System.out.println(methodHandle.bindTo(methodHandleDemo)

                .invokeWithArguments(&quot;MethodHandleDemo&quot;));

    }

    public static class SubMethodHandleDemo extends MethodHandleDemo{

        // å®šä¹‰ä¸€ä¸ªsayHello()æ–¹æ³•

        public String sayHello(String s) {

            return &quot;Sub Hello, &quot; + s;

        }

    }

}
</code></pre><p>åœ¨ MethodHandle è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯æ”¯æŒå¤šæ€çš„ï¼Œåœ¨é€šè¿‡ bindTo() æ–¹æ³•ç»‘å®šåˆ°æŸä¸ªå®ä¾‹å¯¹è±¡çš„æ—¶å€™ï¼Œåœ¨ bind è¿‡ç¨‹ä¸­ä¼šè¿›è¡Œç±»å‹æ£€æŸ¥ç­‰ä¸€ç³»åˆ—æ£€æŸ¥æ“ä½œã€‚</p>
<p>é€šè¿‡ä¸Šé¢è¿™ä¸ªç¤ºä¾‹æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨ MethodHandle å®ç°åå°„çš„æ•ˆæœï¼Œæ›´åƒæˆ‘ä»¬å¹³æ—¶é€šè¿‡ Java ä»£ç ç”Ÿæˆçš„å­—èŠ‚ç ï¼Œä¾‹å¦‚ï¼Œåœ¨å­—èŠ‚ç ä¸­å¯ä»¥çœ‹åˆ°åˆ›å»ºçš„æ–¹æ³•ç­¾åï¼ˆMethodTypeï¼‰ã€æ–¹æ³•çš„å…·ä½“è°ƒç”¨æ–¹å¼ï¼ˆfindStatic()ã€findSpecial()ã€findVirtual() ç­‰æ–¹æ³•ï¼‰ä»¥åŠç±»å‹çš„éšå¼è½¬æ¢ã€‚</p>
<h4 id="2-methodproxy-ä¸­çš„ä»£ç†é€»è¾‘">2. MethodProxy ä¸­çš„ä»£ç†é€»è¾‘</h4>
<p>ä»‹ç»å®Œ MethodHandle çš„åŸºç¡€ä¹‹åï¼Œæˆ‘ä»¬å›åˆ° MethodProxy ç»§ç»­åˆ†æã€‚</p>
<p><strong>MapperProxy.invoke() æ–¹æ³•æ˜¯ä»£ç†å¯¹è±¡æ‰§è¡Œçš„å…¥å£</strong>ï¼Œå…¶ä¸­ä¼šæ‹¦æˆªæ‰€æœ‰é Object æ–¹æ³•ï¼Œé’ˆå¯¹æ¯ä¸ªè¢«æ‹¦æˆªçš„æ–¹æ³•ï¼Œéƒ½ä¼šè°ƒç”¨ cachedInvoker() æ–¹æ³•è·å–å¯¹åº”çš„ MapperMethod å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶ invoke() æ–¹æ³•æ‰§è¡Œä»£ç†é€»è¾‘ä»¥åŠç›®æ ‡æ–¹æ³•ã€‚</p>
<p>åœ¨ cachedInvoker() æ–¹æ³•ä¸­ï¼Œé¦–å…ˆä¼šæŸ¥è¯¢ methodCache ç¼“å­˜ï¼Œå¦‚æœæŸ¥è¯¢çš„æ–¹æ³•ä¸º default æ–¹æ³•ï¼Œåˆ™ä¼šæ ¹æ®å½“å‰ä½¿ç”¨çš„ JDK ç‰ˆæœ¬ï¼Œè·å–å¯¹åº”çš„ MethodHandle å¹¶å°è£…æˆ DefaultMethodInvoker å¯¹è±¡å†™å…¥ç¼“å­˜ï¼›å¦‚æœæŸ¥è¯¢çš„æ–¹æ³•æ˜¯é default æ–¹æ³•ï¼Œåˆ™åˆ›å»º PlainMethodInvoker å¯¹è±¡å†™å…¥ç¼“å­˜ã€‚</p>
<p>cachedInvoker() æ–¹æ³•çš„å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>private MapperMethodInvoker cachedInvoker(Method method) throws Throwable {

    // å°è¯•ä»methodCacheç¼“å­˜ä¸­æŸ¥è¯¢æ–¹æ³•å¯¹åº”çš„MapperMethodInvoker

    MapperMethodInvoker invoker = methodCache.get(method);

    if (invoker != null) {

        return invoker;

    }

    // å¦‚æœæ–¹æ³•åœ¨ç¼“å­˜ä¸­æ²¡æœ‰å¯¹åº”çš„MapperMethodInvokerï¼Œåˆ™è¿›è¡Œåˆ›å»º

    return methodCache.computeIfAbsent(method, m -&gt; {

        if (m.isDefault()) { // é’ˆå¯¹defaultæ–¹æ³•çš„å¤„ç†

            // è¿™é‡Œæ ¹æ®JDKç‰ˆæœ¬çš„ä¸åŒï¼Œè·å–æ–¹æ³•å¯¹åº”çš„MethodHandleçš„æ–¹å¼ä¹Ÿæœ‰æ‰€ä¸åŒ

            // åœ¨JDK 8ä¸­ä½¿ç”¨çš„æ˜¯lookupConstructorå­—æ®µï¼Œè€Œåœ¨JDK 9ä¸­ä½¿ç”¨çš„æ˜¯

            // privateLookupInMethodå­—æ®µã€‚è·å–åˆ°MethodHandleä¹‹åï¼Œä¼šä½¿ç”¨

            // DefaultMethodInvokerè¿›è¡Œå°è£…

            if (privateLookupInMethod == null) {

                return new DefaultMethodInvoker(getMethodHandleJava8(method));

            } else {

                return new DefaultMethodInvoker(getMethodHandleJava9(method));

            }

        } else {

            // å¯¹äºå…¶ä»–æ–¹æ³•ï¼Œä¼šåˆ›å»ºMapperMethodå¹¶ä½¿ç”¨PlainMethodInvokerå°è£…

            return new PlainMethodInvoker(

                    new MapperMethod(mapperInterface, method, sqlSession.getConfiguration()));

        }

    });

}
</code></pre><p>å…¶ä¸­ä½¿ç”¨åˆ°çš„ DefaultMethodInvoker å’Œ PlainMethodInvoker éƒ½æ˜¯ MapperMethodInvoker æ¥å£çš„å®ç°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%20MyBatis%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86-%E5%AE%8C/assets/Cgp9HWAs1wuAE1PMAAFC-IQ3qjE268.png" alt="å›¾ç‰‡6.png"></p>
<p>MapperMethodInvoker æ¥å£ç»§æ‰¿å…³ç³»å›¾</p>
<p>åœ¨ DefaultMethodInvoker.invoke() æ–¹æ³•ä¸­ï¼Œä¼šé€šè¿‡åº•å±‚ç»´æŠ¤çš„ MethodHandle å®Œæˆæ–¹æ³•è°ƒç”¨ï¼Œæ ¸å¿ƒå®ç°å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>public Object invoke(Object proxy, Method method, Object[] args, SqlSession sqlSession) throws Throwable {

    // é¦–å…ˆå°†MethodHandleç»‘å®šåˆ°ä¸€ä¸ªå®ä¾‹å¯¹è±¡ä¸Šï¼Œç„¶åè°ƒç”¨invokeWithArguments()æ–¹æ³•æ‰§è¡Œç›®æ ‡æ–¹æ³•

    return methodHandle.bindTo(proxy).invokeWithArguments(args);

}
</code></pre><p>åœ¨ PlainMethodInvoker.invoke() æ–¹æ³•ä¸­ï¼Œä¼šé€šè¿‡åº•å±‚ç»´æŠ¤çš„ MapperMethod å®Œæˆæ–¹æ³•è°ƒç”¨ï¼Œå…¶æ ¸å¿ƒå®ç°å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>public Object invoke(Object proxy, Method method, Object[] args, SqlSession sqlSession) throws Throwable {

    // ç›´æ¥æ‰§è¡ŒMapperMethod.execute()æ–¹æ³•å®Œæˆæ–¹æ³•è°ƒç”¨

    return mapperMethod.execute(sqlSession, args);

}
</code></pre><h3 id="mappermethod">MapperMethod</h3>
<p>é€šè¿‡å¯¹ MapperProxy çš„åˆ†ææˆ‘ä»¬çŸ¥é“ï¼Œ<strong>MapperMethod æ˜¯æœ€ç»ˆæ‰§è¡Œ SQL è¯­å¥çš„åœ°æ–¹ï¼ŒåŒæ—¶ä¹Ÿè®°å½•äº† Mapper æ¥å£ä¸­çš„å¯¹åº”æ–¹æ³•</strong>ï¼Œå…¶æ ¸å¿ƒå­—æ®µä¹Ÿå›´ç»•è¿™ä¸¤æ–¹é¢çš„å†…å®¹å±•å¼€ã€‚</p>
<h4 id="1-sqlcommand">1. SqlCommand</h4>
<p><strong>MapperMethod çš„ç¬¬ä¸€ä¸ªæ ¸å¿ƒå­—æ®µæ˜¯ commandï¼ˆSqlCommand ç±»å‹ï¼‰ï¼Œå…¶ä¸­ç»´æŠ¤äº†å…³è” SQL è¯­å¥çš„ç›¸å…³ä¿¡æ¯</strong>ã€‚åœ¨ MapperMethod$SqlCommand è¿™ä¸ªå†…éƒ¨ç±»ä¸­ï¼Œé€šè¿‡ name å­—æ®µè®°å½•äº†å…³è” SQL è¯­å¥çš„å”¯ä¸€æ ‡è¯†ï¼Œé€šè¿‡ type å­—æ®µï¼ˆSqlCommandType ç±»å‹ï¼‰ç»´æŠ¤äº† SQL è¯­å¥çš„æ“ä½œç±»å‹ï¼Œè¿™é‡Œ SQL è¯­å¥çš„æ“ä½œç±»å‹åˆ†ä¸º INSERTã€UPDATEã€DELETEã€SELECT å’Œ FLUSH äº”ç§ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹ SqlCommand å¦‚ä½•æŸ¥æ‰¾ Mapper æ¥å£ä¸­ä¸€ä¸ªæ–¹æ³•å¯¹åº”çš„ SQL è¯­å¥çš„ä¿¡æ¯ï¼Œè¯¥é€»è¾‘åœ¨ SqlCommand çš„æ„é€ æ–¹æ³•ä¸­å®ç°ï¼Œå¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>public SqlCommand(Configuration configuration, Class&lt;?&gt; mapperInterface, Method method) {

    // è·å–Mapperæ¥å£ä¸­å¯¹åº”çš„æ–¹æ³•åç§°

    final String methodName = method.getName();

    // è·å–Mapperæ¥å£çš„ç±»å‹

    final Class&lt;?&gt; declaringClass = method.getDeclaringClass();

    // å°†Mapperæ¥å£åç§°å’Œæ–¹æ³•åç§°æ‹¼æ¥èµ·æ¥ä½œä¸ºSQLè¯­å¥å”¯ä¸€æ ‡è¯†ï¼Œ

    // åˆ°Configurationè¿™ä¸ªå…¨å±€é…ç½®å¯¹è±¡ä¸­æŸ¥æ‰¾SQLè¯­å¥

    // MappedStatementå¯¹è±¡å°±æ˜¯Mapper.xmlé…ç½®æ–‡ä»¶ä¸­ä¸€æ¡SQLè¯­å¥è§£æä¹‹åå¾—åˆ°çš„å¯¹è±¡

    MappedStatement ms = resolveMappedStatement(mapperInterface, 

            methodName, declaringClass, configuration);

    if (ms == null) { 

        // é’ˆå¯¹@Flushæ³¨è§£çš„å¤„ç†

        if (method.getAnnotation(Flush.class) != null) {

            name = null;

            type = SqlCommandType.FLUSH;

        } else { // æ²¡æœ‰@Flushæ³¨è§£ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸

            throw new BindingException(&quot;...&quot;);

        }

    } else {

        // è®°å½•SQLè¯­å¥å”¯ä¸€æ ‡è¯†

        name = ms.getId();

        // è®°å½•SQLè¯­å¥çš„æ“ä½œç±»å‹

        type = ms.getSqlCommandType();

    }

}
</code></pre><p>è¿™é‡Œè°ƒç”¨çš„ resolveMappedStatement() æ–¹æ³•ä¸ä»…ä¼šå°è¯•æ ¹æ® SQL è¯­å¥çš„å”¯ä¸€æ ‡è¯†ä» Configuration å…¨å±€é…ç½®å¯¹è±¡ä¸­æŸ¥æ‰¾å…³è”çš„ MappedStatement å¯¹è±¡ï¼Œè¿˜ä¼šå°è¯•é¡ºç€ Mapper æ¥å£çš„ç»§æ‰¿æ ‘è¿›è¡ŒæŸ¥æ‰¾ï¼Œç›´è‡³æŸ¥æ‰¾æˆåŠŸä¸ºæ­¢ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>private MappedStatement resolveMappedStatement(Class&lt;?&gt; mapperInterface, String methodName,

                                                   Class&lt;?&gt; declaringClass, Configuration configuration) {

        // å°†Mapperæ¥å£åç§°å’Œæ–¹æ³•åç§°æ‹¼æ¥èµ·æ¥ä½œä¸ºSQLè¯­å¥å”¯ä¸€æ ‡è¯†

        String statementId = mapperInterface.getName() + &quot;.&quot; + methodName;

        // æ£€æµ‹Configurationä¸­æ˜¯å¦åŒ…å«ç›¸åº”çš„MappedStatementå¯¹è±¡

        if (configuration.hasStatement(statementId)) {

            return configuration.getMappedStatement(statementId);

        } else if (mapperInterface.equals(declaringClass)) {

            // å¦‚æœæ–¹æ³•å°±å®šä¹‰åœ¨å½“å‰æ¥å£ä¸­ï¼Œåˆ™è¯æ˜æ²¡æœ‰å¯¹åº”çš„SQLè¯­å¥ï¼Œè¿”å›null

            return null;

        }

        // å¦‚æœå½“å‰æ£€æŸ¥çš„Mapperæ¥å£(mapperInterface)ä¸­ä¸æ˜¯å®šä¹‰è¯¥æ–¹æ³•çš„æ¥å£(declaringClass)ï¼Œ

        // åˆ™ä¼šä»mapperInterfaceå¼€å§‹ï¼Œæ²¿ç€ç»§æ‰¿å…³ç³»å‘ä¸ŠæŸ¥æ‰¾é€’å½’æ¯ä¸ªæ¥å£ï¼Œ

        // æŸ¥æ‰¾è¯¥æ–¹æ³•å¯¹åº”çš„MappedStatementå¯¹è±¡

        for (Class&lt;?&gt; superInterface : mapperInterface.getInterfaces()) {

            if (declaringClass.isAssignableFrom(superInterface)) {

                MappedStatement ms = resolveMappedStatement(superInterface, methodName,

                        declaringClass, configuration);

                if (ms != null) {

                    return ms;

                }

            }

        }

        return null;

    }

}
</code></pre><h4 id="2-methodsignature">2. MethodSignature</h4>
<p><strong>MapperMethod çš„ç¬¬äºŒä¸ªæ ¸å¿ƒå­—æ®µæ˜¯ method å­—æ®µï¼ˆMethodSignature ç±»å‹ï¼‰ï¼Œå…¶ä¸­ç»´æŠ¤äº† Mapper æ¥å£ä¸­æ–¹æ³•çš„ç›¸å…³ä¿¡æ¯ã€‚</strong></p>
<p>é¦–å…ˆæ˜¯ Mapper æ¥å£æ–¹æ³•è¿”å›å€¼çš„ç›¸å…³ä¿¡æ¯ï¼Œæ¶‰åŠä¸‹é¢ä¸ƒä¸ªå­—æ®µã€‚</p>
<ul>
<li>returnsManyã€returnsMapã€returnsVoidã€returnsCursorã€returnsOptionalï¼ˆboolean ç±»å‹ï¼‰ï¼šç”¨äºè¡¨ç¤ºæ–¹æ³•è¿”å›å€¼æ˜¯å¦ä¸º Collection é›†åˆæˆ–æ•°ç»„ã€Map é›†åˆã€voidã€Cursorã€Optional ç±»å‹ã€‚</li>
<li>returnTypeï¼ˆClass&lt;?&gt; ç±»å‹ï¼‰ï¼šæ–¹æ³•è¿”å›å€¼çš„å…·ä½“ç±»å‹ã€‚</li>
<li>mapKeyï¼ˆString ç±»å‹ï¼‰ï¼šå¦‚æœæ–¹æ³•çš„è¿”å›å€¼ä¸º Map é›†åˆï¼Œåˆ™é€šè¿‡ mapKey å­—æ®µè®°å½•äº†ä½œä¸º key çš„åˆ—åã€‚mapKey å­—æ®µçš„å€¼æ˜¯é€šè¿‡è§£ææ–¹æ³•ä¸Šçš„ @MapKey æ³¨è§£å¾—åˆ°çš„ã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥æ˜¯ä¸ Mapper æ¥å£æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ç›¸å…³çš„ä¸‰ä¸ªå­—æ®µã€‚</p>
<ul>
<li>resultHandlerIndexï¼ˆInteger ç±»å‹ï¼‰ï¼šè®°å½•äº† Mapper æ¥å£æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸­ ResultHandler ç±»å‹å‚æ•°çš„ä½ç½®ã€‚</li>
<li>rowBoundsIndexï¼ˆInteger ç±»å‹ï¼‰ï¼šè®°å½•äº† Mapper æ¥å£æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸­ RowBounds ç±»å‹å‚æ•°çš„ä½ç½®ã€‚</li>
<li>paramNameResolverï¼ˆParamNameResolver ç±»å‹ï¼‰ï¼šç”¨æ¥è§£ææ–¹æ³•å‚æ•°åˆ—è¡¨çš„å·¥å…·ç±»ã€‚</li>
</ul>
<p>åœ¨ä¸Šè¿°å­—æ®µä¸­ï¼Œéœ€è¦ç€é‡è®²è§£çš„æ˜¯ ParamNameResolver è¿™ä¸ªè§£ææ–¹æ³•å‚æ•°åˆ—è¡¨çš„å·¥å…·ç±»ã€‚</p>
<p>åœ¨ ParamNameResolver ä¸­æœ‰ä¸€ä¸ª names å­—æ®µï¼ˆSortedMap&lt;Integer, String&gt;ç±»å‹ï¼‰è®°å½•äº†å„ä¸ªå‚æ•°åœ¨å‚æ•°åˆ—è¡¨ä¸­çš„ä½ç½®ä»¥åŠå‚æ•°åç§°ï¼Œå…¶ä¸­ key æ˜¯å‚æ•°åœ¨å‚æ•°åˆ—è¡¨ä¸­çš„ä½ç½®ç´¢å¼•ï¼Œvalue ä¸ºå‚æ•°çš„åç§°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ @Param æ³¨è§£æŒ‡å®šä¸€ä¸ªå‚æ•°åç§°ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«æŒ‡å®šï¼Œåˆ™é»˜è®¤ä½¿ç”¨å‚æ•°åˆ—è¡¨ä¸­çš„å˜é‡åç§°ä½œä¸ºå…¶åç§°ï¼Œè¿™ä¸ ParamNameResolver çš„ useActualParamName å­—æ®µç›¸å…³ã€‚useActualParamName æ˜¯ä¸€ä¸ªå…¨å±€é…ç½®ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å°† useActualParamName é…ç½®ä¸º falseï¼ŒParamNameResolver ä¼šä½¿ç”¨å‚æ•°çš„ä¸‹æ ‡ç´¢å¼•ä½œä¸ºå…¶åç§°ã€‚å¦å¤–ï¼Œnames é›†åˆä¼šè·³è¿‡ RowBounds ç±»å‹ä»¥åŠ ResultHandler ç±»å‹çš„å‚æ•°ï¼Œå¦‚æœä½¿ç”¨ä¸‹æ ‡ç´¢å¼•ä½œä¸ºå‚æ•°åç§°ï¼Œåœ¨ names é›†åˆä¸­å°±ä¼šå‡ºç° KV ä¸ä¸€è‡´çš„åœºæ™¯ã€‚ä¾‹å¦‚ä¸‹å›¾å°±å¾ˆå¥½åœ°è¯´æ˜äº†è¿™ç§ä¸ä¸€è‡´çš„åœºæ™¯ï¼Œå…¶ä¸­ saveCustomer(long id, String name, RowBounds bounds, String address) æ–¹æ³•å¯¹åº”çš„ names é›†åˆä¸º {{0, &ldquo;0&rdquo;}, {1, &ldquo;1&rdquo;}, {2, &ldquo;3&rdquo;}}ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%20MyBatis%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86-%E5%AE%8C/assets/CioPOWAs1x-ARSPuAAEfe6Ixv48515.png" alt="å›¾ç‰‡7.png"></p>
<p>names é›†åˆä¸­ KV ä¸ä¸€è‡´ç¤ºæ„å›¾</p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç”±äº RowBounds å‚æ•°çš„å­˜åœ¨ï¼Œç¬¬å››ä¸ªå‚æ•°åœ¨ names é›†åˆä¸­çš„ KV å‡ºç°äº†ä¸ä¸€è‡´ï¼ˆå³ key = 2 ä¸ value = &ldquo;3&rdquo; ä¸ä¸€è‡´ï¼‰ã€‚</p>
<p>å®Œæˆ names é›†åˆçš„åˆå§‹åŒ–ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹å¦‚ä½•ä» names é›†åˆä¸­æŸ¥è¯¢å‚æ•°åç§°ï¼Œè¯¥éƒ¨åˆ†é€»è¾‘åœ¨ ParamNameResolver.getNamedParams() æ–¹æ³•ï¼Œå…¶ä¸­ä¼šå°† Mapper æ¥å£æ–¹æ³•çš„å®å‚ä¸ names é›†åˆä¸­è®°å½•çš„å‚æ•°åç§°ç›¸å…³è”ï¼Œå…¶æ ¸å¿ƒé€»è¾‘å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>public Object getNamedParams(Object[] args) {

    // è·å–æ–¹æ³•ä¸­éç‰¹æ®Šç±»å‹(RowBoundsç±»å‹å’ŒResultHandlerç±»å‹)çš„å‚æ•°ä¸ªæ•°

    final int paramCount = names.size();

    if (args == null || paramCount == 0) {

        return null; // æ–¹æ³•æ²¡æœ‰éç‰¹æ®Šç±»å‹å‚æ•°ï¼Œè¿”å›nullå³å¯

    } else if (!hasParamAnnotation &amp;&amp; paramCount == 1) {

        // æ–¹æ³•å‚æ•°åˆ—è¡¨ä¸­æ²¡æœ‰ä½¿ç”¨@Paramæ³¨è§£ï¼Œä¸”åªæœ‰ä¸€ä¸ªéç‰¹æ®Šç±»å‹å‚æ•°

        Object value = args[names.firstKey()];

        return wrapToMapIfCollection(value, useActualParamName ? names.get(0) : null);

    } else {

        // å¤„ç†å­˜åœ¨@Paramæ³¨è§£æˆ–æ˜¯å­˜åœ¨å¤šä¸ªéç‰¹æ®Šç±»å‹å‚æ•°çš„åœºæ™¯

        // paramé›†åˆç”¨äºè®°å½•äº†å‚æ•°åç§°ä¸å®å‚ä¹‹é—´çš„æ˜ å°„å…³ç³»

        // è¿™é‡Œçš„ParamMapç»§æ‰¿äº†HashMapï¼Œä¸HashMapçš„å”¯ä¸€ä¸åŒæ˜¯ï¼š

        // å‘ParamMapä¸­æ·»åŠ å·²ç»å­˜åœ¨çš„keyæ—¶ï¼Œä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¸æ˜¯è¦†ç›–åŸæœ‰çš„Key

        final Map&lt;String, Object&gt; param = new ParamMap&lt;&gt;();

        int i = 0;

        for (Map.Entry&lt;Integer, String&gt; entry : names.entrySet()) {

            // å°†å‚æ•°åç§°ä¸å®å‚çš„æ˜ å°„ä¿å­˜åˆ°paramé›†åˆä¸­

            param.put(entry.getValue(), args[entry.getKey()]);

            // åŒæ—¶ï¼Œä¸ºå‚æ•°åˆ›å»º&quot;param+ç´¢å¼•&quot;æ ¼å¼çš„é»˜è®¤å‚æ•°åç§°ï¼Œå…·ä½“æ ¼å¼ä¸ºï¼šparam1, param2ç­‰ï¼Œ

            // å°†&quot;param+ç´¢å¼•&quot;çš„é»˜è®¤å‚æ•°åç§°ä¸å®å‚çš„æ˜ å°„å…³ç³»ä¹Ÿä¿å­˜åˆ°paramé›†åˆä¸­

            final String genericParamName = GENERIC_NAME_PREFIX + (i + 1);

            if (!names.containsValue(genericParamName)) {

                param.put(genericParamName, args[entry.getKey()]);

            }

            i++;

        }

        return param;

    }

}
</code></pre><p>äº†è§£äº† ParamNameResolver çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹åï¼Œæˆ‘ä»¬å›åˆ° MethodSignature ç»§ç»­åˆ†æï¼Œåœ¨å…¶æ„é€ å‡½æ•°ä¸­ä¼šè§£ææ–¹æ³•ä¸­çš„è¿”å›å€¼ã€å‚æ•°åˆ—è¡¨ç­‰ä¿¡æ¯ï¼Œå¹¶åˆå§‹åŒ–å‰é¢ä»‹ç»çš„æ ¸å¿ƒå­—æ®µï¼Œè¿™é‡Œä¹Ÿä¼šä½¿ç”¨åˆ°å‰é¢ä»‹ç»çš„ ParamNameResolver å·¥å…·ç±»ã€‚ä¸‹é¢æ˜¯ MethodSignature æ„é€ æ–¹æ³•çš„æ ¸å¿ƒå®ç°ï¼š</p>
<pre tabindex="0"><code>public MethodSignature(Configuration configuration, Class&lt;?&gt; mapperInterface, Method method) {

    ... // é€šè¿‡TypeParameterResolverå·¥å…·ç±»è§£ææ–¹æ³•çš„è¿”å›å€¼ç±»å‹ï¼Œåˆå§‹åŒ–returnTypeå­—æ®µå€¼ï¼Œçœç•¥è¯¥è§£æéƒ¨åˆ†ä»£ç 

    // æ ¹æ®è¿”å›å€¼ç±»å‹ï¼Œåˆå§‹åŒ–returnsVoidã€returnsManyã€returnsCursorã€

    // returnsMapã€returnsOptionalè¿™äº”ä¸ªä¸æ–¹æ³•è¿”å›å€¼ç±»å‹ç›¸å…³çš„å­—æ®µ

    this.returnsVoid = void.class.equals(this.returnType);

    ... 

    // å¦‚æœè¿”å›å€¼ä¸ºMapç±»å‹ï¼Œåˆ™ä»æ–¹æ³•çš„@MapKeyæ³¨è§£ä¸­è·å–Mapä¸­ä¸ºkeyçš„å­—æ®µåç§°

    this.mapKey = getMapKey(method);

    this.returnsMap = this.mapKey != null;

    // è§£ææ–¹æ³•ä¸­RowBoundsç±»å‹å‚æ•°ä»¥åŠResultHandlerç±»å‹å‚æ•°çš„ä¸‹æ ‡ç´¢å¼•ä½ç½®ï¼Œ

    // åˆå§‹åŒ–rowBoundsIndexå’ŒresultHandlerIndexå­—æ®µ

    this.rowBoundsIndex = getUniqueParamIndex(method, RowBounds.class);

    this.resultHandlerIndex = getUniqueParamIndex(method, ResultHandler.class);

    // åˆ›å»ºParamNameResolverå·¥å…·å¯¹è±¡ï¼Œåœ¨åˆ›å»ºParamNameResolverå¯¹è±¡çš„æ—¶å€™ï¼Œ

    // ä¼šè§£ææ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¿¡æ¯

    this.paramNameResolver = new ParamNameResolver(configuration, method);

}
</code></pre><p>åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ä¼šè°ƒç”¨ getUniqueParamIndex() æ–¹æ³•æŸ¥æ‰¾ç›®æ ‡ç±»å‹å‚æ•°çš„ä¸‹æ ‡ç´¢å¼•ä½ç½®ï¼Œå…¶æ ¸å¿ƒåŸç†å°±æ˜¯éå†æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ï¼Œé€ä¸ªåŒ¹é…å‚æ•°çš„ç±»å‹æ˜¯å¦ä¸ºç›®æ ‡ç±»å‹ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ™ä¼šè¿”å›å½“å‰å‚æ•°çš„ä¸‹æ ‡ç´¢å¼•ã€‚getUniqueParamIndex() æ–¹æ³•çš„å…·ä½“å®ç°æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œå°±ä¸å†å±•ç¤ºï¼Œä½ è‹¥æ„Ÿå…´è¶£çš„è¯å¯ä»¥å‚è€ƒ<a href="https://github.com/xxxlxy2008/mybatis">æºç </a>è¿›è¡Œå­¦ä¹ ã€‚</p>
<h4 id="3-æ·±å…¥-execute-æ–¹æ³•">3. æ·±å…¥ execute() æ–¹æ³•</h4>
<p>åˆ†æå®Œ MapperMethod ä¸­çš„å‡ ä¸ªæ ¸å¿ƒå†…éƒ¨ç±»ï¼Œæˆ‘ä»¬å›åˆ° MapperMethod ç»§ç»­ä»‹ç»ã€‚</p>
<p>execute() æ–¹æ³•æ˜¯ MapperMethod ä¸­æœ€æ ¸å¿ƒçš„æ–¹æ³•ä¹‹ä¸€ã€‚<strong>execute() æ–¹æ³•ä¼šæ ¹æ®è¦æ‰§è¡Œçš„ SQL è¯­å¥çš„å…·ä½“ç±»å‹æ‰§è¡Œ SqlSession çš„ç›¸åº”æ–¹æ³•å®Œæˆæ•°æ®åº“æ“ä½œ</strong>ï¼Œå…¶æ ¸å¿ƒå®ç°å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>public Object execute(SqlSession sqlSession, Object[] args) {

    Object result;

    switch (command.getType()) { // åˆ¤æ–­SQLè¯­å¥çš„ç±»å‹

        case INSERT: {

            // é€šè¿‡ParamNameResolver.getNamedParams()æ–¹æ³•å°†æ–¹æ³•çš„å®å‚ä¸

            // å‚æ•°çš„åç§°å…³è”èµ·æ¥

            Object param = method.convertArgsToSqlCommandParam(args);

            // é€šè¿‡SqlSession.insert()æ–¹æ³•æ‰§è¡ŒINSERTè¯­å¥ï¼Œ

            // åœ¨rowCountResult()æ–¹æ³•ä¸­ï¼Œä¼šæ ¹æ®æ–¹æ³•çš„è¿”å›å€¼ç±»å‹å¯¹ç»“æœè¿›è¡Œè½¬æ¢

            result = rowCountResult(sqlSession.insert(command.getName(), param));

            break;

        }

        case UPDATE: {

            Object param = method.convertArgsToSqlCommandParam(args);

            // é€šè¿‡SqlSession.update()æ–¹æ³•æ‰§è¡ŒUPDATEè¯­å¥

            result = rowCountResult(sqlSession.update(command.getName(), param));

            break;

        }

        // DELETEåˆ†æ”¯ä¸UPDATEç±»ä¼¼ï¼Œçœç•¥

        case SELECT:

            if (method.returnsVoid() &amp;&amp; method.hasResultHandler()) {

                // å¦‚æœæ–¹æ³•è¿”å›å€¼ä¸ºvoidï¼Œä¸”å‚æ•°ä¸­åŒ…å«äº†ResultHandlerç±»å‹çš„å®å‚ï¼Œ

                // åˆ™æŸ¥è¯¢çš„ç»“æœé›†å°†ä¼šç”±ResultHandlerå¯¹è±¡è¿›è¡Œå¤„ç†

                executeWithResultHandler(sqlSession, args);

                result = null;

            } else if (method.returnsMany()) {

                // executeForMany()æ–¹æ³•å¤„ç†è¿”å›å€¼ä¸ºé›†åˆæˆ–æ•°ç»„çš„åœºæ™¯

                result = executeForMany(sqlSession, args);

            } else ...// çœç•¥é’ˆå¯¹Mapã€Cursorä»¥åŠOptionalè¿”å›å€¼çš„å¤„ç†

            }

            break;

            // çœç•¥FLUSHå’Œdefaultåˆ†æ”¯

    }

    return result;

}
</code></pre><p><strong>åœ¨ execute() æ–¹æ³•ä¸­ï¼Œå¯¹äº INSERTã€UPDATEã€DELETE ä¸‰ç±» SQL è¯­å¥çš„è¿”å›ç»“æœï¼Œéƒ½ä¼šé€šè¿‡ rowCountResult() æ–¹æ³•å¤„ç†</strong>ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œä¸Šè¿°ä¸‰ç§ç±»å‹çš„ SQL è¯­å¥çš„æ‰§è¡Œç»“æœæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå¤šæ•°åœºæ™¯ä¸­ä»£è¡¨äº† SQL è¯­å¥å½±å“çš„æ•°æ®è¡Œæ•°ï¼ˆæ³¨æ„ï¼Œè¿™ä¸ªè¿”å›å€¼çš„å…·ä½“å«ä¹‰æ ¹æ® MySQL çš„é…ç½®æœ‰æ‰€å˜åŒ–ï¼‰ï¼ŒrowCountResult() æ–¹æ³•ä¼šå°†è¿™ä¸ª int å€¼è½¬æ¢æˆ Mapper æ¥å£æ–¹æ³•çš„è¿”å›å€¼ï¼Œå…·ä½“è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>Mapper æ–¹æ³•è¿”å›å€¼ä¸º voidï¼Œåˆ™å¿½ç•¥ SQL è¯­å¥çš„ int è¿”å›å€¼ï¼Œç›´æ¥è¿”å› nullï¼›</li>
<li>Mapper æ–¹æ³•è¿”å›å€¼ä¸º int æˆ– Integer ç±»å‹ï¼Œåˆ™å°† SQL è¯­å¥è¿”å›çš„ int å€¼ç›´æ¥è¿”å›ï¼›</li>
<li>Mapper æ–¹æ³•è¿”å›å€¼ä¸º long æˆ– Long ç±»å‹ï¼Œåˆ™å°† SQL è¯­å¥è¿”å›çš„ int å€¼è½¬æ¢æˆ long ç±»å‹ä¹‹åè¿”å›ï¼›</li>
<li>Mapper æ–¹æ³•è¿”å›å€¼ä¸º boolean æˆ– Boolean ç±»å‹ï¼Œåˆ™å°† SQL è¯­å¥è¿”å›çš„ int å€¼ä¸ 0 æ¯”è¾ƒå¤§å°ï¼Œå¹¶å°†æ¯”è¾ƒç»“æœè¿”å›ã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥çœ‹ execute() æ–¹æ³•<strong>é’ˆå¯¹ SELECT è¯­å¥æŸ¥è¯¢åˆ°çš„ç»“æœé›†çš„å¤„ç†</strong>ã€‚</p>
<ul>
<li>å¦‚æœåœ¨æ–¹æ³•å‚æ•°åˆ—è¡¨ä¸­æœ‰ ResultHandler ç±»å‹çš„å‚æ•°å­˜åœ¨ï¼Œåˆ™ä¼šä½¿ç”¨ executeWithResultHandler() æ–¹æ³•å®ŒæˆæŸ¥è¯¢ï¼Œåº•å±‚ä¾èµ–çš„æ˜¯ SqlSession.select() æ–¹æ³•ï¼Œç»“æœé›†å°†ä¼šäº¤ç”±ä¼ å…¥çš„ ResultHandler å¯¹è±¡è¿›è¡Œå¤„ç†ã€‚</li>
<li>å¦‚æœæ–¹æ³•è¿”å›å€¼ä¸ºé›†åˆç±»å‹æˆ–æ˜¯æ•°ç»„ç±»å‹ï¼Œåˆ™ä¼šè°ƒç”¨ executeForMany() æ–¹æ³•ï¼Œåº•å±‚ä¾èµ– SqlSession.selectList() æ–¹æ³•è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶å°†å¾—åˆ°çš„ List è½¬æ¢æˆç›®æ ‡é›†åˆç±»å‹ã€‚</li>
<li>å¦‚æœæ–¹æ³•è¿”å›å€¼ä¸º Map ç±»å‹ï¼Œåˆ™ä¼šè°ƒç”¨ executeForMap() æ–¹æ³•ï¼Œåº•å±‚ä¾èµ– SqlSession.selectMap() æ–¹æ³•å®ŒæˆæŸ¥è¯¢ï¼Œå¹¶å°†ç»“æœé›†æ˜ å°„æˆ Map é›†åˆã€‚</li>
<li>é’ˆå¯¹ Cursor ä»¥åŠ Optionalè¿”å›å€¼çš„å¤„ç†ï¼Œä¹Ÿæ˜¯ä¾èµ–çš„ SqlSession çš„ç›¸å…³æ–¹æ³•å®ŒæˆæŸ¥è¯¢çš„ï¼Œè¿™é‡Œä¸å†å±•å¼€ã€‚</li>
</ul>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>åœ¨è¿™ä¸€è®²ï¼Œæˆ‘ä»¬é‡ç‚¹ä»‹ç»äº† MyBatis ä¸­çš„ binding æ¨¡å—ï¼Œæ­£æ˜¯è¯¥æ¨¡å—å®ç°äº† Mapper æ¥å£ä¸ Mapper.xml é…ç½®æ–‡ä»¶çš„æ˜ å°„åŠŸèƒ½ã€‚</p>
<ul>
<li>é¦–å…ˆï¼Œä»‹ç»äº† MapperRegistry è¿™ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œå…¶ä¸­ç»´æŠ¤äº† Mapper æ¥å£ä¸ä»£ç†å·¥å‚å¯¹è±¡ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚</li>
<li>ç„¶åï¼Œåˆ†æäº† MapperProxy å’Œ MapperProxyFactoryï¼Œå…¶ä¸­ MapperProxyFactory ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†æ–¹å¼ä¸ºç›¸åº”çš„ Mapper æ¥å£åˆ›å»ºäº†ä»£ç†å¯¹è±¡ï¼ŒMapperProxy åˆ™å°è£…äº†æ ¸å¿ƒçš„ä»£ç†é€»è¾‘ï¼Œå°†æ‹¦æˆªåˆ°çš„ç›®æ ‡æ–¹æ³•å§”æ‰˜ç»™å¯¹åº”çš„ MapperMethod å¤„ç†ã€‚</li>
<li>æœ€åï¼Œè¯¦ç»†è®²è§£äº† MapperMethodï¼Œåˆ†æäº†å®ƒæ˜¯å¦‚ä½•æ ¹æ®æ–¹æ³•ç­¾åæ‰§è¡Œç›¸åº”çš„ SQL è¯­å¥ã€‚</li>
</ul>
<p>åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥å°±èƒ½å›ç­”å¼€ç¯‡çš„é‚£å‡ ä¸ªç–‘æƒ‘äº†å§ï¼Ÿæˆ‘è¿™é‡Œä¹Ÿæ€»ç»“ä¸€ä¸‹ã€‚</p>
<ul>
<li>ä½¿ç”¨ CustomerMapper æ¥å£æ¥æ‰§è¡Œ SQL è¯­å¥ï¼Œæ˜¯å› ä¸ºå¯ä»¥åœ¨ç¼–è¯‘æœŸæå‰æš´éœ²é”™è¯¯ã€‚</li>
<li>ä¹‹æ‰€ä»¥ä¸ç”¨ä¸º CustomerMapper æ¥å£æä¾›å…·ä½“å®ç°ï¼Œæ˜¯å› ä¸ºè°ƒç”¨çš„æ˜¯ CustomerMapper çš„ä»£ç†å¯¹è±¡ã€‚</li>
<li>CustomerMapper å¯¹è±¡æ˜¯é€šè¿‡ JDK åŠ¨æ€ä»£ç†ç”Ÿæˆçš„ï¼Œåœ¨è°ƒç”¨è¿™äº›ä»£ç†å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œå°±ä¼šæŒ‰ç…§æˆ‘ä»¬ä»Šå¤©è¿™ä¸€è®²æ•´ä½“è®²è§£çš„é€»è¾‘å’Œé¡ºåºï¼ˆæ‰€ä»¥è¿™ä¸€è®²ä½ è¦ç³»ç»Ÿåœ°å»å­¦ä¹ ï¼Œå„ä¸ªçŸ¥è¯†ç‚¹å’Œæ­¥éª¤æ˜¯ä¸²è”åœ¨ä¸€èµ·çš„ï¼‰ï¼Œæ‰¾åˆ°ç›¸åº”çš„ CustomerMapper.xml ä¸­å®šä¹‰çš„ SQL è¯­å¥å¹¶æ‰§è¡Œè¿™äº› SQL è¯­å¥ï¼Œå®Œæˆæ•°æ®åº“æ“ä½œã€‚</li>
</ul>

        </div>
    </article>
</div>
<div class="division-line"></div>
<div class="others">
    <div>æ ‡ç­¾ï¼šğŸ·ï¸<a class="post-tag" href="/tags/mybatis/">mybatis</a>&nbsp;</div>
    <div>åˆ†ç±»ï¼š ğŸ“’<a class="post-category" href="/categories/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/">æ·±å…¥å‰–æMyBatisæ ¸å¿ƒåŸç†</a>&nbsp; </div>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/07-%E6%B7%B1%E5%85%A5%E6%95%B0%E6%8D%AE%E6%BA%90%E5%92%8C%E4%BA%8B%E5%8A%A1%E6%8A%8A%E6%8F%A1%E6%8C%81%E4%B9%85%E5%8C%96%E6%A1%86%E6%9E%B6%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%85%B3%E9%94%AE%E5%91%BD%E8%84%89/"><span>07 æ·±å…¥æ•°æ®æºå’Œäº‹åŠ¡ï¼ŒæŠŠæ¡æŒä¹…åŒ–æ¡†æ¶çš„ä¸¤ä¸ªå…³é”®å‘½è„‰</span></a>
    </div>
    <div class="next">
        
        <a href="http://yipsen.github.io/documents/columns/mybatis/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90mybatis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/09-%E5%9F%BA%E4%BA%8E-mybatis-%E7%BC%93%E5%AD%98%E5%88%86%E6%9E%90%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/"><span>09 åŸºäº MyBatis ç¼“å­˜åˆ†æè£…é¥°å™¨æ¨¡å¼çš„æœ€ä½³å®è·µ</span></a>
    </div>
</div>

        </div>
        <div id="float">
            <ul class="float-button-bar">
    <li>
        <button class="float-button top" onclick="scrollToTop(this);">UP</button>
    </li>
    <li>
        <button class="float-button toggler" onclick="changeSkin(this);">DARK</button>
    </li>
</ul>
        </div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 2020 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    const changeSkin = () => {
        document.getElementById('page').classList.toggle('night');
    }
    const scrollToTop = () => {
        window.scrollTo(0, 0);
    }
</script>
</body>

</html>