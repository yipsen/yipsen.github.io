<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>07 JVMæ˜¯å¦‚ä½•å®ç°åå°„çš„ï¼Ÿ | Yipsen Ye</title>
<meta name="description" content="ä»Šå¤©æˆ‘ä»¬æ¥èŠèŠ Java é‡Œçš„åå°„æœºåˆ¶ã€‚
åå°„æ˜¯ Java è¯­è¨€ä¸­ä¸€ä¸ªç›¸å½“é‡è¦çš„ç‰¹æ€§ï¼Œå®ƒå…è®¸æ­£åœ¨è¿è¡Œçš„ Java ç¨‹åºè§‚æµ‹ï¼Œç”šè‡³æ˜¯ä¿®æ”¹ç¨‹åºçš„åŠ¨æ€è¡Œä¸ºã€‚
ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Class å¯¹è±¡æšä¸¾è¯¥ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ Method.setAccessibleï¼ˆä½äº java.lang.reflect åŒ…ï¼Œè¯¥æ–¹æ³•ç»§æ‰¿è‡ª AccessibleObjectï¼‰ç»•è¿‡ Java è¯­è¨€çš„è®¿é—®æƒé™ï¼Œåœ¨ç§æœ‰æ–¹æ³•æ‰€åœ¨ç±»ä¹‹å¤–çš„åœ°æ–¹è°ƒç”¨è¯¥æ–¹æ³•ã€‚
åå°„åœ¨ Java ä¸­çš„åº”ç”¨ååˆ†å¹¿æ³›ã€‚å¼€å‘äººå‘˜æ—¥å¸¸æ¥è§¦åˆ°çš„ Java é›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰ä¾¿è¿ç”¨äº†è¿™ä¸€åŠŸèƒ½ï¼šæ¯å½“æˆ‘ä»¬æ•²å…¥ç‚¹å·æ—¶ï¼ŒIDE ä¾¿ä¼šæ ¹æ®ç‚¹å·å‰çš„å†…å®¹ï¼ŒåŠ¨æ€å±•ç¤ºå¯ä»¥è®¿é—®çš„å­—æ®µæˆ–è€…æ–¹æ³•ã€‚
å¦ä¸€ä¸ªæ—¥å¸¸åº”ç”¨åˆ™æ˜¯ Java è°ƒè¯•å™¨ï¼Œå®ƒèƒ½å¤Ÿåœ¨è°ƒè¯•è¿‡ç¨‹ä¸­æšä¸¾æŸä¸€å¯¹è±¡æ‰€æœ‰å­—æ®µçš„å€¼ã€‚
ï¼ˆå›¾ä¸­ eclipse çš„è‡ªåŠ¨æç¤ºä½¿ç”¨äº†åå°„ï¼‰
åœ¨ Web å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸èƒ½å¤Ÿæ¥è§¦åˆ°å„ç§å¯é…ç½®çš„é€šç”¨æ¡†æ¶ã€‚ä¸ºäº†ä¿è¯æ¡†æ¶çš„å¯æ‰©å±•æ€§ï¼Œå®ƒä»¬å¾€å¾€å€ŸåŠ© Java çš„åå°„æœºåˆ¶ï¼Œæ ¹æ®é…ç½®æ–‡ä»¶æ¥åŠ è½½ä¸åŒçš„ç±»ã€‚ä¸¾ä¾‹æ¥è¯´ï¼ŒSpring æ¡†æ¶çš„ä¾èµ–åè½¬ï¼ˆIoCï¼‰ï¼Œä¾¿æ˜¯ä¾èµ–äºåå°„æœºåˆ¶ã€‚
ç„¶è€Œï¼Œæˆ‘ç›¸ä¿¡ä¸å°‘å¼€å‘äººå‘˜éƒ½å«Œå¼ƒåå°„æœºåˆ¶æ¯”è¾ƒæ…¢ã€‚ç”šè‡³æ˜¯ç”²éª¨æ–‡å…³äºåå°„çš„æ•™å­¦ç½‘é¡µ [1]ï¼Œä¹Ÿå¼ºè°ƒäº†åå°„æ€§èƒ½å¼€é”€å¤§çš„ç¼ºç‚¹ã€‚
ä»Šå¤©æˆ‘ä»¬ä¾¿æ¥äº†è§£ä¸€ä¸‹åå°„çš„å®ç°æœºåˆ¶ï¼Œä»¥åŠå®ƒæ€§èƒ½ç³Ÿç³•çš„åŸå› ã€‚å¦‚æœä½ å¯¹åå°„ API ä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰çš„è¯ï¼Œä½ å¯ä»¥æŸ¥é˜…æˆ‘æ”¾åœ¨æ–‡ç¨¿æœ«å°¾çš„é™„å½•ã€‚
åå°„è°ƒç”¨çš„å®ç° é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ–¹æ³•çš„åå°„è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯ Method.invokeï¼Œæ˜¯æ€ä¹ˆå®ç°çš„ã€‚
public final class Method extends Executable {...public Object invoke(Object obj, Object... args) throws ... {... // æƒé™æ£€æŸ¥MethodAccessor ma = methodAccessor;if (ma == null) {ma = acquireMethodAccessor();}return ma.">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="nav-logo">
    <a href="http://yipsen.github.io/">
        
        <span class="nav-title">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æ–‡ç« </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/%e6%b7%b1%e5%85%a5%e6%8b%86%e8%a7%a3java%e8%99%9a%e6%8b%9f%e6%9c%ba/">æ·±å…¥æ‹†è§£Javaè™šæ‹Ÿæœº</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/00-%E5%BC%80%E7%AF%87%E8%AF%8D-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E4%BB%AC%E8%A6%81%E5%AD%A6%E4%B9%A0java%E8%99%9A%E6%8B%9F%E6%9C%BA/">00 å¼€ç¯‡è¯ ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å­¦ä¹ Javaè™šæ‹Ÿæœºï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/01-java%E4%BB%A3%E7%A0%81%E6%98%AF%E6%80%8E%E4%B9%88%E8%BF%90%E8%A1%8C%E7%9A%84/">01 Javaä»£ç æ˜¯æ€ä¹ˆè¿è¡Œçš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/02-java%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/">02 Javaçš„åŸºæœ¬ç±»å‹</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/03-java%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%98%AF%E5%A6%82%E4%BD%95%E5%8A%A0%E8%BD%BDjava%E7%B1%BB%E7%9A%84/">03 Javaè™šæ‹Ÿæœºæ˜¯å¦‚ä½•åŠ è½½Javaç±»çš„</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/04-jvm%E6%98%AF%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E7%9A%84%E4%B8%8A/">04 JVMæ˜¯å¦‚ä½•æ‰§è¡Œæ–¹æ³•è°ƒç”¨çš„ï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/05-jvm%E6%98%AF%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E7%9A%84%E4%B8%8B/">05 JVMæ˜¯å¦‚ä½•æ‰§è¡Œæ–¹æ³•è°ƒç”¨çš„ï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/06-jvm%E6%98%AF%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8%E7%9A%84/">06 JVMæ˜¯å¦‚ä½•å¤„ç†å¼‚å¸¸çš„ï¼Ÿ</a></li>
                
                
                
                    <li>07 JVMæ˜¯å¦‚ä½•å®ç°åå°„çš„ï¼Ÿ</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/08-jvm%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0invokedynamic%E7%9A%84%E4%B8%8A/">08 JVMæ˜¯æ€ä¹ˆå®ç°invokedynamicçš„ï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/09-jvm%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0invokedynamic%E7%9A%84%E4%B8%8B/">09 JVMæ˜¯æ€ä¹ˆå®ç°invokedynamicçš„ï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/10-java%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80/">10 Javaå¯¹è±¡çš„å†…å­˜å¸ƒå±€</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/11-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E4%B8%8A/">11 åƒåœ¾å›æ”¶ï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/12-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E4%B8%8B/">12 åƒåœ¾å›æ”¶ï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/13-java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/">13 Javaå†…å­˜æ¨¡å‹</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/14-java%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0synchronized%E7%9A%84/">14 Javaè™šæ‹Ÿæœºæ˜¯æ€ä¹ˆå®ç°synchronizedçš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/15-java%E8%AF%AD%E6%B3%95%E7%B3%96%E4%B8%8Ejava%E7%BC%96%E8%AF%91%E5%99%A8/">15 Javaè¯­æ³•ç³–ä¸Javaç¼–è¯‘å™¨</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/16-%E5%8D%B3%E6%97%B6%E7%BC%96%E8%AF%91%E4%B8%8A/">16 å³æ—¶ç¼–è¯‘ï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/17-%E5%8D%B3%E6%97%B6%E7%BC%96%E8%AF%91%E4%B8%8B/">17 å³æ—¶ç¼–è¯‘ï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/18-%E5%8D%B3%E6%97%B6%E7%BC%96%E8%AF%91%E5%99%A8%E7%9A%84%E4%B8%AD%E9%97%B4%E8%A1%A8%E8%BE%BE%E5%BD%A2%E5%BC%8F/">18 å³æ—¶ç¼–è¯‘å™¨çš„ä¸­é—´è¡¨è¾¾å½¢å¼</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/19-java%E5%AD%97%E8%8A%82%E7%A0%81%E5%9F%BA%E7%A1%80%E7%AF%87/">19 Javaå­—èŠ‚ç ï¼ˆåŸºç¡€ç¯‡ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/20-%E6%96%B9%E6%B3%95%E5%86%85%E8%81%94%E4%B8%8A/">20 æ–¹æ³•å†…è”ï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/21-%E6%96%B9%E6%B3%95%E5%86%85%E8%81%94%E4%B8%8B/">21 æ–¹æ³•å†…è”ï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/22-hotspot%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84intrinsic/">22 HotSpotè™šæ‹Ÿæœºçš„intrinsic</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/23-%E9%80%83%E9%80%B8%E5%88%86%E6%9E%90/">23 é€ƒé€¸åˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/24-%E5%AD%97%E6%AE%B5%E8%AE%BF%E9%97%AE%E7%9B%B8%E5%85%B3%E4%BC%98%E5%8C%96/">24 å­—æ®µè®¿é—®ç›¸å…³ä¼˜åŒ–</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/25-%E5%BE%AA%E7%8E%AF%E4%BC%98%E5%8C%96/">25 å¾ªç¯ä¼˜åŒ–</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/26-%E5%90%91%E9%87%8F%E5%8C%96/">26 å‘é‡åŒ–</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/27-%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8/">27 æ³¨è§£å¤„ç†å™¨</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/28-%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6jmh%E4%B8%8A/">28 åŸºå‡†æµ‹è¯•æ¡†æ¶JMHï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/29-%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6jmh%E4%B8%8B/">29 åŸºå‡†æµ‹è¯•æ¡†æ¶JMHï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/30-java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E7%9B%91%E6%8E%A7%E5%8F%8A%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%AF%87/">30 Javaè™šæ‹Ÿæœºçš„ç›‘æ§åŠè¯Šæ–­å·¥å…·ï¼ˆå‘½ä»¤è¡Œç¯‡ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/31-java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E7%9B%91%E6%8E%A7%E5%8F%8A%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7gui%E7%AF%87/">31 Javaè™šæ‹Ÿæœºçš„ç›‘æ§åŠè¯Šæ–­å·¥å…·ï¼ˆGUIç¯‡ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/32-jni%E7%9A%84%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6/">32 JNIçš„è¿è¡Œæœºåˆ¶</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/33-java-agent%E4%B8%8E%E5%AD%97%E8%8A%82%E7%A0%81%E6%B3%A8%E5%85%A5/">33 Java Agentä¸å­—èŠ‚ç æ³¨å…¥</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/34-graal%E7%94%A8java%E7%BC%96%E8%AF%91java/">34 Graalï¼šç”¨Javaç¼–è¯‘Java</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/35-truffle%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E6%A1%86%E6%9E%B6/">35 Truffleï¼šè¯­è¨€å®ç°æ¡†æ¶</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/36-substratevmaot%E7%BC%96%E8%AF%91%E6%A1%86%E6%9E%B6/">36 SubstrateVMï¼šAOTç¼–è¯‘æ¡†æ¶</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/%E5%B0%BE%E5%A3%B0%E4%B8%A8%E9%81%93%E9%98%BB%E4%B8%94%E9%95%BF%E5%8A%AA%E5%8A%9B%E5%8A%A0%E9%A4%90.html/">å°¾å£°ä¸¨é“é˜»ä¸”é•¿ï¼ŒåŠªåŠ›åŠ é¤.html</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/%E5%B7%A5%E5%85%B7%E7%AF%87-%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D/">å·¥å…·ç¯‡ å¸¸ç”¨å·¥å…·ä»‹ç»</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">07 JVMæ˜¯å¦‚ä½•å®ç°åå°„çš„ï¼Ÿ</h1>
        <div class="post-info">
            <div class="post-date"> 
                <span>2022-01-09 11:10:56</span>
            </div>
        </div>
        <div class="post-content">
            <p>ä»Šå¤©æˆ‘ä»¬æ¥èŠèŠ Java é‡Œçš„åå°„æœºåˆ¶ã€‚</p>
<p>åå°„æ˜¯ Java è¯­è¨€ä¸­ä¸€ä¸ªç›¸å½“é‡è¦çš„ç‰¹æ€§ï¼Œå®ƒå…è®¸æ­£åœ¨è¿è¡Œçš„ Java ç¨‹åºè§‚æµ‹ï¼Œç”šè‡³æ˜¯ä¿®æ”¹ç¨‹åºçš„åŠ¨æ€è¡Œä¸ºã€‚</p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Class å¯¹è±¡æšä¸¾è¯¥ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ Method.setAccessibleï¼ˆä½äº java.lang.reflect åŒ…ï¼Œè¯¥æ–¹æ³•ç»§æ‰¿è‡ª AccessibleObjectï¼‰ç»•è¿‡ Java è¯­è¨€çš„è®¿é—®æƒé™ï¼Œåœ¨ç§æœ‰æ–¹æ³•æ‰€åœ¨ç±»ä¹‹å¤–çš„åœ°æ–¹è°ƒç”¨è¯¥æ–¹æ³•ã€‚</p>
<p>åå°„åœ¨ Java ä¸­çš„åº”ç”¨ååˆ†å¹¿æ³›ã€‚å¼€å‘äººå‘˜æ—¥å¸¸æ¥è§¦åˆ°çš„ Java é›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰ä¾¿è¿ç”¨äº†è¿™ä¸€åŠŸèƒ½ï¼šæ¯å½“æˆ‘ä»¬æ•²å…¥ç‚¹å·æ—¶ï¼ŒIDE ä¾¿ä¼šæ ¹æ®ç‚¹å·å‰çš„å†…å®¹ï¼ŒåŠ¨æ€å±•ç¤ºå¯ä»¥è®¿é—®çš„å­—æ®µæˆ–è€…æ–¹æ³•ã€‚</p>
<p>å¦ä¸€ä¸ªæ—¥å¸¸åº”ç”¨åˆ™æ˜¯ Java è°ƒè¯•å™¨ï¼Œå®ƒèƒ½å¤Ÿåœ¨è°ƒè¯•è¿‡ç¨‹ä¸­æšä¸¾æŸä¸€å¯¹è±¡æ‰€æœ‰å­—æ®µçš„å€¼ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA/assets/ceeabb2dbdd80577feaecd0879e42675.png" alt="img"></p>
<p>ï¼ˆå›¾ä¸­ eclipse çš„è‡ªåŠ¨æç¤ºä½¿ç”¨äº†åå°„ï¼‰</p>
<p>åœ¨ Web å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸èƒ½å¤Ÿæ¥è§¦åˆ°å„ç§å¯é…ç½®çš„é€šç”¨æ¡†æ¶ã€‚ä¸ºäº†ä¿è¯æ¡†æ¶çš„å¯æ‰©å±•æ€§ï¼Œå®ƒä»¬å¾€å¾€å€ŸåŠ© Java çš„åå°„æœºåˆ¶ï¼Œæ ¹æ®é…ç½®æ–‡ä»¶æ¥åŠ è½½ä¸åŒçš„ç±»ã€‚ä¸¾ä¾‹æ¥è¯´ï¼ŒSpring æ¡†æ¶çš„ä¾èµ–åè½¬ï¼ˆIoCï¼‰ï¼Œä¾¿æ˜¯ä¾èµ–äºåå°„æœºåˆ¶ã€‚</p>
<p>ç„¶è€Œï¼Œæˆ‘ç›¸ä¿¡ä¸å°‘å¼€å‘äººå‘˜éƒ½å«Œå¼ƒåå°„æœºåˆ¶æ¯”è¾ƒæ…¢ã€‚ç”šè‡³æ˜¯ç”²éª¨æ–‡å…³äºåå°„çš„æ•™å­¦ç½‘é¡µ [1]ï¼Œä¹Ÿå¼ºè°ƒäº†åå°„æ€§èƒ½å¼€é”€å¤§çš„ç¼ºç‚¹ã€‚</p>
<p>ä»Šå¤©æˆ‘ä»¬ä¾¿æ¥äº†è§£ä¸€ä¸‹åå°„çš„å®ç°æœºåˆ¶ï¼Œä»¥åŠå®ƒæ€§èƒ½ç³Ÿç³•çš„åŸå› ã€‚å¦‚æœä½ å¯¹åå°„ API ä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰çš„è¯ï¼Œä½ å¯ä»¥æŸ¥é˜…æˆ‘æ”¾åœ¨æ–‡ç¨¿æœ«å°¾çš„é™„å½•ã€‚</p>
<h2 id="åå°„è°ƒç”¨çš„å®ç°">åå°„è°ƒç”¨çš„å®ç°</h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ–¹æ³•çš„åå°„è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯ Method.invokeï¼Œæ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p>
<pre tabindex="0"><code>public final class Method extends Executable {
  ...
  public Object invoke(Object obj, Object... args) throws ... {
    ... // æƒé™æ£€æŸ¥
    MethodAccessor ma = methodAccessor;
    if (ma == null) {
      ma = acquireMethodAccessor();
    }
    return ma.invoke(obj, args);
  }
}
 
</code></pre><p>å¦‚æœä½ æŸ¥é˜… Method.invoke çš„æºä»£ç ï¼Œé‚£ä¹ˆä½ ä¼šå‘ç°ï¼Œå®ƒå®é™…ä¸Šå§”æ´¾ç»™ MethodAccessor æ¥å¤„ç†ã€‚MethodAccessor æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒæœ‰ä¸¤ä¸ªå·²æœ‰çš„å…·ä½“å®ç°ï¼šä¸€ä¸ªé€šè¿‡æœ¬åœ°æ–¹æ³•æ¥å®ç°åå°„è°ƒç”¨ï¼Œå¦ä¸€ä¸ªåˆ™ä½¿ç”¨äº†å§”æ´¾æ¨¡å¼ã€‚ä¸ºäº†æ–¹ä¾¿è®°å¿†ï¼Œæˆ‘ä¾¿ç”¨â€œæœ¬åœ°å®ç°â€å’Œâ€œå§”æ´¾å®ç°â€æ¥æŒ‡ä»£è¿™ä¸¤è€…ã€‚</p>
<p>æ¯ä¸ª Method å®ä¾‹çš„ç¬¬ä¸€æ¬¡åå°„è°ƒç”¨éƒ½ä¼šç”Ÿæˆä¸€ä¸ªå§”æ´¾å®ç°ï¼Œå®ƒæ‰€å§”æ´¾çš„å…·ä½“å®ç°ä¾¿æ˜¯ä¸€ä¸ªæœ¬åœ°å®ç°ã€‚æœ¬åœ°å®ç°éå¸¸å®¹æ˜“ç†è§£ã€‚å½“è¿›å…¥äº† Java è™šæ‹Ÿæœºå†…éƒ¨ä¹‹åï¼Œæˆ‘ä»¬ä¾¿æ‹¥æœ‰äº† Method å®ä¾‹æ‰€æŒ‡å‘æ–¹æ³•çš„å…·ä½“åœ°å€ã€‚è¿™æ—¶å€™ï¼Œåå°„è°ƒç”¨æ— éå°±æ˜¯å°†ä¼ å…¥çš„å‚æ•°å‡†å¤‡å¥½ï¼Œç„¶åè°ƒç”¨è¿›å…¥ç›®æ ‡æ–¹æ³•ã€‚</p>
<pre tabindex="0"><code>// v0 ç‰ˆæœ¬
import java.lang.reflect.Method;
 
public class Test {
  public static void target(int i) {
    new Exception(&quot;#&quot; + i).printStackTrace();
  }
 
  public static void main(String[] args) throws Exception {
    Class&lt;?&gt; klass = Class.forName(&quot;Test&quot;);
    Method method = klass.getMethod(&quot;target&quot;, int.class);
    method.invoke(null, 0);
  }
}
 
# ä¸åŒç‰ˆæœ¬çš„è¾“å‡ºç•¥æœ‰ä¸åŒï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨äº† Java 10ã€‚
$ java Test
java.lang.Exception: #0
        at Test.target(Test.java:5)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl .invoke0(Native Method)
 a      t java.base/jdk.internal.reflect.NativeMethodAccessorImpl. .invoke(NativeMethodAccessorImpl.java:62)
 t       java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.i .invoke(DelegatingMethodAccessorImpl.java:43)
        java.base/java.lang.reflect.Method.invoke(Method.java:564)
  t        Test.main(Test.java:131
</code></pre><p>ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å°ä¸€ä¸‹åå°„è°ƒç”¨åˆ°ç›®æ ‡æ–¹æ³•æ—¶çš„æ ˆè½¨è¿¹ã€‚åœ¨ä¸Šé¢çš„ v0 ç‰ˆæœ¬ä»£ç ä¸­ï¼Œæˆ‘ä»¬è·å–äº†ä¸€ä¸ªæŒ‡å‘ Test.target æ–¹æ³•çš„ Method å¯¹è±¡ï¼Œå¹¶ä¸”ç”¨å®ƒæ¥è¿›è¡Œåå°„è°ƒç”¨ã€‚åœ¨ Test.target ä¸­ï¼Œæˆ‘ä¼šæ‰“å°å‡ºæ ˆè½¨è¿¹ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåå°„è°ƒç”¨å…ˆæ˜¯è°ƒç”¨äº† Method.invokeï¼Œç„¶åè¿›å…¥å§”æ´¾å®ç°ï¼ˆDelegatingMethodAccessorImplï¼‰ï¼Œå†ç„¶åè¿›å…¥æœ¬åœ°å®ç°ï¼ˆNativeMethodAccessorImplï¼‰ï¼Œæœ€ååˆ°è¾¾ç›®æ ‡æ–¹æ³•ã€‚</p>
<p>è¿™é‡Œä½ å¯èƒ½ä¼šç–‘é—®ï¼Œä¸ºä»€ä¹ˆåå°„è°ƒç”¨è¿˜è¦é‡‡å–å§”æ´¾å®ç°ä½œä¸ºä¸­é—´å±‚ï¼Ÿç›´æ¥äº¤ç»™æœ¬åœ°å®ç°ä¸å¯ä»¥ä¹ˆï¼Ÿ</p>
<p>å…¶å®ï¼ŒJava çš„åå°„è°ƒç”¨æœºåˆ¶è¿˜è®¾ç«‹äº†å¦ä¸€ç§åŠ¨æ€ç”Ÿæˆå­—èŠ‚ç çš„å®ç°ï¼ˆä¸‹ç§°åŠ¨æ€å®ç°ï¼‰ï¼Œç›´æ¥ä½¿ç”¨ invoke æŒ‡ä»¤æ¥è°ƒç”¨ç›®æ ‡æ–¹æ³•ã€‚ä¹‹æ‰€ä»¥é‡‡ç”¨å§”æ´¾å®ç°ï¼Œä¾¿æ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨æœ¬åœ°å®ç°ä»¥åŠåŠ¨æ€å®ç°ä¸­åˆ‡æ¢ã€‚</p>
<pre tabindex="0"><code>// åŠ¨æ€å®ç°çš„ä¼ªä»£ç ï¼Œè¿™é‡Œåªåˆ—ä¸¾äº†å…³é”®çš„è°ƒç”¨é€»è¾‘ï¼Œå…¶å®å®ƒè¿˜åŒ…æ‹¬è°ƒç”¨è€…æ£€æµ‹ã€å‚æ•°æ£€æµ‹çš„å­—èŠ‚ç ã€‚
package jdk.internal.reflect;
 
public class GeneratedMethodAccessor1 extends ... {
  @Overrides    
  public Object invoke(Object obj, Object[] args) throws ... {
    Test.target((int) args[0]);
    return null;
  }
}
</code></pre><p>åŠ¨æ€å®ç°å’Œæœ¬åœ°å®ç°ç›¸æ¯”ï¼Œå…¶è¿è¡Œæ•ˆç‡è¦å¿«ä¸Š 20 å€ [2] ã€‚è¿™æ˜¯å› ä¸ºåŠ¨æ€å®ç°æ— éœ€ç»è¿‡ Java åˆ° C++ å†åˆ° Java çš„åˆ‡æ¢ï¼Œä½†ç”±äºç”Ÿæˆå­—èŠ‚ç ååˆ†è€—æ—¶ï¼Œä»…è°ƒç”¨ä¸€æ¬¡çš„è¯ï¼Œåè€Œæ˜¯æœ¬åœ°å®ç°è¦å¿«ä¸Š 3 åˆ° 4 å€ [3]ã€‚</p>
<p>è€ƒè™‘åˆ°è®¸å¤šåå°„è°ƒç”¨ä»…ä¼šæ‰§è¡Œä¸€æ¬¡ï¼ŒJava è™šæ‹Ÿæœºè®¾ç½®äº†ä¸€ä¸ªé˜ˆå€¼ 15ï¼ˆå¯ä»¥é€šè¿‡ -Dsun.reflect.inflationThreshold= æ¥è°ƒæ•´ï¼‰ï¼Œå½“æŸä¸ªåå°„è°ƒç”¨çš„è°ƒç”¨æ¬¡æ•°åœ¨ 15 ä¹‹ä¸‹æ—¶ï¼Œé‡‡ç”¨æœ¬åœ°å®ç°ï¼›å½“è¾¾åˆ° 15 æ—¶ï¼Œä¾¿å¼€å§‹åŠ¨æ€ç”Ÿæˆå­—èŠ‚ç ï¼Œå¹¶å°†å§”æ´¾å®ç°çš„å§”æ´¾å¯¹è±¡åˆ‡æ¢è‡³åŠ¨æ€å®ç°ï¼Œè¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬ç§°ä¹‹ä¸º Inflationã€‚</p>
<p>ä¸ºäº†è§‚å¯Ÿè¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘å°†åˆšæ‰çš„ä¾‹å­æ›´æ”¹ä¸ºä¸‹é¢çš„ v1 ç‰ˆæœ¬ã€‚å®ƒä¼šå°†åå°„è°ƒç”¨å¾ªç¯ 20 æ¬¡ã€‚</p>
<pre tabindex="0"><code>// v1 ç‰ˆæœ¬
import java.lang.reflect.Method;
 
public class Test {
  public static void target(int i) {
    new Exception(&quot;#&quot; + i).printStackTrace();
  }
 
  public static void main(String[] args) throws Exception {
    Class&lt;?&gt; klass = Class.forName(&quot;Test&quot;);
    Method method = klass.getMethod(&quot;target&quot;, int.class);
    for (int i = 0; i &lt; 20; i++) {
      method.invoke(null, i);
    }
  }
}
 
# ä½¿ç”¨ -verbose:class æ‰“å°åŠ è½½çš„ç±»
$ java -verbose:class Test
...
java.lang.Exception: #14
        at Test.target(Test.java:5)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl .invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl .invoke(NativeMethodAccessorImpl.java:62)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl .invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:564)
        at Test.main(Test.java:12)
[0.158s][info][class,load] ...
...
[0.160s][info][class,load] jdk.internal.reflect.GeneratedMethodAccessor1 source: __JVM_DefineClass__
java.lang.Exception: #15
       at Test.target(Test.java:5)
       at java.base/jdk.internal.reflect.NativeMethodAccessorImpl .invoke0(Native Method)
       at java.base/jdk.internal.reflect.NativeMethodAccessorImpl .invoke(NativeMethodAccessorImpl.java:62)
       at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl .invoke(DelegatingMethodAccessorImpl.java:43)
       at java.base/java.lang.reflect.Method.invoke(Method.java:564)
       at Test.main(Test.java:12)
java.lang.Exception: #16
       at Test.target(Test.java:5)
       at jdk.internal.reflect.GeneratedMethodAccessor1 .invoke(Unknown Source)
       at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl .invoke(DelegatingMethodAccessorImpl.java:43)
       at java.base/java.lang.reflect.Method.invoke(Method.java:564)
       at Test.main(Test.java:12)
...
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç¬¬ 15 æ¬¡ï¼ˆä» 0 å¼€å§‹æ•°ï¼‰åå°„è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬ä¾¿è§¦å‘äº†åŠ¨æ€å®ç°çš„ç”Ÿæˆã€‚è¿™æ—¶å€™ï¼ŒJava è™šæ‹Ÿæœºé¢å¤–åŠ è½½äº†ä¸å°‘ç±»ã€‚å…¶ä¸­ï¼Œæœ€é‡è¦çš„å½“å± GeneratedMethodAccessor1ï¼ˆç¬¬ 30 è¡Œï¼‰ã€‚å¹¶ä¸”ï¼Œä»ç¬¬ 16 æ¬¡åå°„è°ƒç”¨å¼€å§‹ï¼Œæˆ‘ä»¬ä¾¿åˆ‡æ¢è‡³è¿™ä¸ªåˆšåˆšç”Ÿæˆçš„åŠ¨æ€å®ç°ï¼ˆç¬¬ 40 è¡Œï¼‰ã€‚</p>
<p>åå°„è°ƒç”¨çš„ Inflation æœºåˆ¶æ˜¯å¯ä»¥é€šè¿‡å‚æ•°ï¼ˆ-Dsun.reflect.noInflation=trueï¼‰æ¥å…³é—­çš„ã€‚è¿™æ ·ä¸€æ¥ï¼Œåœ¨åå°„è°ƒç”¨ä¸€å¼€å§‹ä¾¿ä¼šç›´æ¥ç”ŸæˆåŠ¨æ€å®ç°ï¼Œè€Œä¸ä¼šä½¿ç”¨å§”æ´¾å®ç°æˆ–è€…æœ¬åœ°å®ç°ã€‚</p>
<h2 id="åå°„è°ƒç”¨çš„å¼€é”€">åå°„è°ƒç”¨çš„å¼€é”€</h2>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä¾¿æ¥æ‹†è§£åå°„è°ƒç”¨çš„æ€§èƒ½å¼€é”€ã€‚</p>
<p>åœ¨åˆšæ‰çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å…ˆåè¿›è¡Œäº† Class.forNameï¼ŒClass.getMethod ä»¥åŠ Method.invoke ä¸‰ä¸ªæ“ä½œã€‚å…¶ä¸­ï¼ŒClass.forName ä¼šè°ƒç”¨æœ¬åœ°æ–¹æ³•ï¼ŒClass.getMethod åˆ™ä¼šéå†è¯¥ç±»çš„å…¬æœ‰æ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ï¼Œå®ƒè¿˜å°†éå†çˆ¶ç±»çš„å…¬æœ‰æ–¹æ³•ã€‚å¯æƒ³è€ŒçŸ¥ï¼Œè¿™ä¸¤ä¸ªæ“ä½œéƒ½éå¸¸è´¹æ—¶ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä»¥ getMethod ä¸ºä»£è¡¨çš„æŸ¥æ‰¾æ–¹æ³•æ“ä½œï¼Œä¼šè¿”å›æŸ¥æ‰¾å¾—åˆ°ç»“æœçš„ä¸€ä»½æ‹·è´ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”å½“é¿å…åœ¨çƒ­ç‚¹ä»£ç ä¸­ä½¿ç”¨è¿”å› Method æ•°ç»„çš„ getMethods æˆ–è€… getDeclaredMethods æ–¹æ³•ï¼Œä»¥å‡å°‘ä¸å¿…è¦çš„å †ç©ºé—´æ¶ˆè€—ã€‚</p>
<p>åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šåœ¨åº”ç”¨ç¨‹åºä¸­ç¼“å­˜ Class.forName å’Œ Class.getMethod çš„ç»“æœã€‚å› æ­¤ï¼Œä¸‹é¢æˆ‘å°±åªå…³æ³¨åå°„è°ƒç”¨æœ¬èº«çš„æ€§èƒ½å¼€é”€ã€‚</p>
<p>ä¸ºäº†æ¯”è¾ƒç›´æ¥è°ƒç”¨å’Œåå°„è°ƒç”¨çš„æ€§èƒ½å·®è·ï¼Œæˆ‘å°†å‰é¢çš„ä¾‹å­æ”¹ä¸ºä¸‹é¢çš„ v2 ç‰ˆæœ¬ã€‚å®ƒä¼šå°†åå°„è°ƒç”¨å¾ªç¯äºŒåäº¿æ¬¡ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å°†è®°å½•ä¸‹æ¯è·‘ä¸€äº¿æ¬¡çš„æ—¶é—´ã€‚</p>
<p>æˆ‘å°†å–æœ€åäº”ä¸ªè®°å½•çš„å¹³å‡å€¼ï¼Œä½œä¸ºé¢„çƒ­åçš„å³°å€¼æ€§èƒ½ã€‚ï¼ˆæ³¨ï¼šè¿™ç§æ€§èƒ½è¯„ä¼°æ–¹å¼å¹¶ä¸ä¸¥è°¨ï¼Œæˆ‘ä¼šåœ¨ä¸“æ çš„ç¬¬ä¸‰éƒ¨åˆ†ä»‹ç»å¦‚ä½•ç”¨ JMH æ¥æµ‹æ€§èƒ½ã€‚ï¼‰</p>
<p>åœ¨æˆ‘è¿™ä¸ªè€ç¬”è®°æœ¬ä¸Šï¼Œä¸€äº¿æ¬¡ç›´æ¥è°ƒç”¨è€—è´¹çš„æ—¶é—´å¤§çº¦åœ¨ 120msã€‚è¿™å’Œä¸è°ƒç”¨çš„æ—¶é—´æ˜¯ä¸€è‡´çš„ã€‚å…¶åŸå› åœ¨äºè¿™æ®µä»£ç å±äºçƒ­å¾ªç¯ï¼ŒåŒæ ·ä¼šè§¦å‘å³æ—¶ç¼–è¯‘ã€‚å¹¶ä¸”ï¼Œå³æ—¶ç¼–è¯‘ä¼šå°†å¯¹ Test.target çš„è°ƒç”¨å†…è”è¿›æ¥ï¼Œä»è€Œæ¶ˆé™¤äº†è°ƒç”¨çš„å¼€é”€ã€‚</p>
<pre tabindex="0"><code>// v2 ç‰ˆæœ¬
mport java.lang.reflect.Method;
 
public class Test {
  public static void target(int i) {
    // ç©ºæ–¹æ³•
  }
 
  public static void main(String[] args) throws Exception {
    Class&lt;?&gt; klass = Class.forName(&quot;Test&quot;);
    Method method = klass.getMethod(&quot;target&quot;, int.class);
 
    long current = System.currentTimeMillis();
    for (int i = 1; i &lt;= 2_000_000_000; i++) {
      if (i % 100_000_000 == 0) {
        long temp = System.currentTimeMillis();
        System.out.println(temp - current);
        current = temp;
      }
 
      method.invoke(null, 128);
    }
  }
}
 
</code></pre><p>ä¸‹é¢æˆ‘å°†ä»¥ 120ms ä½œä¸ºåŸºå‡†ï¼Œæ¥æ¯”è¾ƒåå°„è°ƒç”¨çš„æ€§èƒ½å¼€é”€ã€‚</p>
<p>ç”±äºç›®æ ‡æ–¹æ³• Test.target æ¥æ”¶ä¸€ä¸ª int ç±»å‹çš„å‚æ•°ï¼Œå› æ­¤æˆ‘ä¼ å…¥ 128 ä½œä¸ºåå°„è°ƒç”¨çš„å‚æ•°ï¼Œæµ‹å¾—çš„ç»“æœçº¦ä¸ºåŸºå‡†çš„ 2.7 å€ã€‚æˆ‘ä»¬æš‚ä¸”ä¸ç®¡è¿™ä¸ªæ•°å­—æ˜¯é«˜æ˜¯ä½ï¼Œå…ˆæ¥çœ‹çœ‹åœ¨åå°„è°ƒç”¨ä¹‹å‰å­—èŠ‚ç éƒ½åšäº†ä»€ä¹ˆã€‚</p>
<pre tabindex="0"><code>   59: aload_2                         // åŠ è½½ Method å¯¹è±¡
   60: aconst_null                     // åå°„è°ƒç”¨çš„ç¬¬ä¸€ä¸ªå‚æ•° null
   61: iconst_1
   62: anewarray Object                // ç”Ÿæˆä¸€ä¸ªé•¿åº¦ä¸º 1 çš„ Object æ•°ç»„
   65: dup
   66: iconst_0
   67: sipush 128
   70: invokestatic Integer.valueOf    // å°† 128 è‡ªåŠ¨è£…ç®±æˆ Integer
   73: aastore                         // å­˜å…¥ Object æ•°ç»„ä¸­
   74: invokevirtual Method.invoke     // åå°„è°ƒç”¨
</code></pre><p>è¿™é‡Œæˆ‘æˆªå–äº†å¾ªç¯ä¸­åå°„è°ƒç”¨ç¼–è¯‘è€Œæˆçš„å­—èŠ‚ç ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ®µå­—èŠ‚ç é™¤äº†åå°„è°ƒç”¨å¤–ï¼Œè¿˜é¢å¤–åšäº†ä¸¤ä¸ªæ“ä½œã€‚</p>
<p>ç¬¬ä¸€ï¼Œç”±äº Method.invoke æ˜¯ä¸€ä¸ªå˜é•¿å‚æ•°æ–¹æ³•ï¼Œåœ¨å­—èŠ‚ç å±‚é¢å®ƒçš„æœ€åä¸€ä¸ªå‚æ•°ä¼šæ˜¯ Object æ•°ç»„ï¼ˆæ„Ÿå…´è¶£çš„åŒå­¦ç§ä¸‹å¯ä»¥ç”¨ javap æŸ¥çœ‹ï¼‰ã€‚Java ç¼–è¯‘å™¨ä¼šåœ¨æ–¹æ³•è°ƒç”¨å¤„ç”Ÿæˆä¸€ä¸ªé•¿åº¦ä¸ºä¼ å…¥å‚æ•°æ•°é‡çš„ Object æ•°ç»„ï¼Œå¹¶å°†ä¼ å…¥å‚æ•°ä¸€ä¸€å­˜å‚¨è¿›è¯¥æ•°ç»„ä¸­ã€‚</p>
<p>ç¬¬äºŒï¼Œç”±äº Object æ•°ç»„ä¸èƒ½å­˜å‚¨åŸºæœ¬ç±»å‹ï¼ŒJava ç¼–è¯‘å™¨ä¼šå¯¹ä¼ å…¥çš„åŸºæœ¬ç±»å‹å‚æ•°è¿›è¡Œè‡ªåŠ¨è£…ç®±ã€‚</p>
<p>è¿™ä¸¤ä¸ªæ“ä½œé™¤äº†å¸¦æ¥æ€§èƒ½å¼€é”€å¤–ï¼Œè¿˜å¯èƒ½å ç”¨å †å†…å­˜ï¼Œä½¿å¾— GC æ›´åŠ é¢‘ç¹ã€‚ï¼ˆå¦‚æœä½ æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥ç”¨è™šæ‹Ÿæœºå‚æ•° -XX:+PrintGC è¯•è¯•ã€‚ï¼‰é‚£ä¹ˆï¼Œå¦‚ä½•æ¶ˆé™¤è¿™éƒ¨åˆ†å¼€é”€å‘¢ï¼Ÿ</p>
<p>å…³äºç¬¬äºŒä¸ªè‡ªåŠ¨è£…ç®±ï¼ŒJava ç¼“å­˜äº† [-128, 127] ä¸­æ‰€æœ‰æ•´æ•°æ‰€å¯¹åº”çš„ Integer å¯¹è±¡ã€‚å½“éœ€è¦è‡ªåŠ¨è£…ç®±çš„æ•´æ•°åœ¨è¿™ä¸ªèŒƒå›´ä¹‹å†…æ—¶ï¼Œä¾¿è¿”å›ç¼“å­˜çš„ Integerï¼Œå¦åˆ™éœ€è¦æ–°å»ºä¸€ä¸ª Integer å¯¹è±¡ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªç¼“å­˜çš„èŒƒå›´æ‰©å¤§è‡³è¦†ç›– 128ï¼ˆå¯¹åº”å‚æ•° -Djava.lang.Integer.IntegerCache.high=128ï¼‰ï¼Œä¾¿å¯ä»¥é¿å…éœ€è¦æ–°å»º Integer å¯¹è±¡çš„åœºæ™¯ã€‚</p>
<p>æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¾ªç¯å¤–ç¼“å­˜ 128 è‡ªåŠ¨è£…ç®±å¾—åˆ°çš„ Integer å¯¹è±¡ï¼Œå¹¶ä¸”ç›´æ¥ä¼ å…¥åå°„è°ƒç”¨ä¸­ã€‚è¿™ä¸¤ç§æ–¹æ³•æµ‹å¾—çš„ç»“æœå·®ä¸å¤šï¼Œçº¦ä¸ºåŸºå‡†çš„ 1.8 å€ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å†å›æ¥çœ‹çœ‹ç¬¬ä¸€ä¸ªå› å˜é•¿å‚æ•°è€Œè‡ªåŠ¨ç”Ÿæˆçš„ Object æ•°ç»„ã€‚æ—¢ç„¶æ¯ä¸ªåå°„è°ƒç”¨å¯¹åº”çš„å‚æ•°ä¸ªæ•°æ˜¯å›ºå®šçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€‰æ‹©åœ¨å¾ªç¯å¤–æ–°å»ºä¸€ä¸ª Object æ•°ç»„ï¼Œè®¾ç½®å¥½å‚æ•°ï¼Œå¹¶ç›´æ¥äº¤ç»™åå°„è°ƒç”¨ã€‚æ”¹å¥½çš„ä»£ç å¯ä»¥å‚ç…§æ–‡ç¨¿ä¸­çš„ v3 ç‰ˆæœ¬ã€‚</p>
<pre tabindex="0"><code>// v3 ç‰ˆæœ¬
import java.lang.reflect.Method;
 
public class Test {
  public static void target(int i) {
    // ç©ºæ–¹æ³•
  }
 
  public static void main(String[] args) throws Exception {
    Class&lt;?&gt; klass = Class.forName(&quot;Test&quot;);
    Method method = klass.getMethod(&quot;target&quot;, int.class);
 
    Object[] arg = new Object[1]; // åœ¨å¾ªç¯å¤–æ„é€ å‚æ•°æ•°ç»„
    arg[0] = 128;
 
    long current = System.currentTimeMillis();
    for (int i = 1; i &lt;= 2_000_000_000; i++) {
      if (i % 100_000_000 == 0) {
        long temp = System.currentTimeMillis();
        System.out.println(temp - current);
        current = temp;
      }
 
      method.invoke(null, arg);
    }
  }
}
</code></pre><p>æµ‹å¾—çš„ç»“æœåè€Œæ›´ç³Ÿç³•äº†ï¼Œä¸ºåŸºå‡†çš„ 2.9 å€ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>å¦‚æœä½ åœ¨ä¸Šä¸€æ­¥è§£å†³äº†è‡ªåŠ¨è£…ç®±ä¹‹åæŸ¥çœ‹è¿è¡Œæ—¶çš„ GC çŠ¶å†µï¼Œä½ ä¼šå‘ç°è¿™æ®µç¨‹åºå¹¶ä¸ä¼šè§¦å‘ GCã€‚å…¶åŸå› åœ¨äºï¼ŒåŸæœ¬çš„åå°„è°ƒç”¨è¢«å†…è”äº†ï¼Œä»è€Œä½¿å¾—å³æ—¶ç¼–è¯‘å™¨ä¸­çš„é€ƒé€¸åˆ†æå°†åŸæœ¬æ–°å»ºçš„ Object æ•°ç»„åˆ¤å®šä¸ºä¸é€ƒé€¸çš„å¯¹è±¡ã€‚</p>
<p>å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸é€ƒé€¸ï¼Œé‚£ä¹ˆå³æ—¶ç¼–è¯‘å™¨å¯ä»¥é€‰æ‹©æ ˆåˆ†é…ç”šè‡³æ˜¯è™šæ‹Ÿåˆ†é…ï¼Œä¹Ÿå°±æ˜¯ä¸å ç”¨å †ç©ºé—´ã€‚å…·ä½“æˆ‘ä¼šåœ¨æœ¬ä¸“æ çš„ç¬¬äºŒéƒ¨åˆ†è¯¦ç»†è§£é‡Šã€‚</p>
<p>å¦‚æœåœ¨å¾ªç¯å¤–æ–°å»ºæ•°ç»„ï¼Œå³æ—¶ç¼–è¯‘å™¨æ— æ³•ç¡®å®šè¿™ä¸ªæ•°ç»„ä¼šä¸ä¼šä¸­é€”è¢«æ›´æ”¹ï¼Œå› æ­¤æ— æ³•ä¼˜åŒ–æ‰è®¿é—®æ•°ç»„çš„æ“ä½œï¼Œå¯è°“æ˜¯å¾—ä¸å¿å¤±ã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„æœ€å¥½è®°å½•æ˜¯ 1.8 å€ã€‚é‚£èƒ½ä¸èƒ½å†è¿›ä¸€æ­¥æå‡å‘¢ï¼Ÿ</p>
<p>åˆšæ‰æˆ‘æ›¾æåˆ°ï¼Œå¯ä»¥å…³é—­åå°„è°ƒç”¨çš„ Inflation æœºåˆ¶ï¼Œä»è€Œå–æ¶ˆå§”æ´¾å®ç°ï¼Œå¹¶ä¸”ç›´æ¥ä½¿ç”¨åŠ¨æ€å®ç°ã€‚æ­¤å¤–ï¼Œæ¯æ¬¡åå°„è°ƒç”¨éƒ½ä¼šæ£€æŸ¥ç›®æ ‡æ–¹æ³•çš„æƒé™ï¼Œè€Œè¿™ä¸ªæ£€æŸ¥åŒæ ·å¯ä»¥åœ¨ Java ä»£ç é‡Œå…³é—­ï¼Œåœ¨å…³é—­äº†è¿™ä¸¤é¡¹æœºåˆ¶ä¹‹åï¼Œä¹Ÿå°±å¾—åˆ°äº†æˆ‘ä»¬çš„ v4 ç‰ˆæœ¬ï¼Œå®ƒæµ‹å¾—çš„ç»“æœçº¦ä¸ºåŸºå‡†çš„ 1.3 å€ã€‚</p>
<pre tabindex="0"><code> 
// v4 ç‰ˆæœ¬
import java.lang.reflect.Method;
 
// åœ¨è¿è¡ŒæŒ‡ä»¤ä¸­æ·»åŠ å¦‚ä¸‹ä¸¤ä¸ªè™šæ‹Ÿæœºå‚æ•°ï¼š
// -Djava.lang.Integer.IntegerCache.high=128
// -Dsun.reflect.noInflation=true
public class Test {
  public static void target(int i) {
    // ç©ºæ–¹æ³•
  }
 
  public static void main(String[] args) throws Exception {
    Class&lt;?&gt; klass = Class.forName(&quot;Test&quot;);
    Method method = klass.getMethod(&quot;target&quot;, int.class);
    method.setAccessible(true);  // å…³é—­æƒé™æ£€æŸ¥
 
    long current = System.currentTimeMillis();
    for (int i = 1; i &lt;= 2_000_000_000; i++) {
      if (i % 100_000_000 == 0) {
        long temp = System.currentTimeMillis();
        System.out.println(temp - current);
        current = temp;
      }
 
      method.invoke(null, 128);
    }
  }
}
 
</code></pre><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬åŸºæœ¬ä¸ŠæŠŠåå°„è°ƒç”¨çš„æ°´åˆ†éƒ½æ¦¨å¹²äº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘æ¥æŠŠåå°„è°ƒç”¨çš„æ€§èƒ½å¼€é”€ç»™æå›å»ã€‚</p>
<p>é¦–å…ˆï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¹‹æ‰€ä»¥åå°„è°ƒç”¨èƒ½å¤Ÿå˜å¾—è¿™ä¹ˆå¿«ï¼Œä¸»è¦æ˜¯å› ä¸ºå³æ—¶ç¼–è¯‘å™¨ä¸­çš„æ–¹æ³•å†…è”ã€‚åœ¨å…³é—­äº† Inflation çš„æƒ…å†µä¸‹ï¼Œå†…è”çš„ç“¶é¢ˆåœ¨äº Method.invoke æ–¹æ³•ä¸­å¯¹ MethodAccessor.invoke æ–¹æ³•çš„è°ƒç”¨ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA/assets/93dec45b7af7951a2b6daeb01941b9b5.png" alt="img"></p>
<p>æˆ‘ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­ä»‹ç»æ–¹æ³•å†…è”çš„å…·ä½“å®ç°ï¼Œè¿™é‡Œå…ˆè¯´ä¸ªç»“è®ºï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¾€å¾€æ‹¥æœ‰å¤šä¸ªä¸åŒçš„åå°„è°ƒç”¨ï¼Œå¯¹åº”å¤šä¸ª GeneratedMethodAccessorï¼Œä¹Ÿå°±æ˜¯åŠ¨æ€å®ç°ã€‚</p>
<p>ç”±äº Java è™šæ‹Ÿæœºçš„å…³äºä¸Šè¿°è°ƒç”¨ç‚¹çš„ç±»å‹ profileï¼ˆæ³¨ï¼šå¯¹äº invokevirtual æˆ–è€… invokeinterfaceï¼ŒJava è™šæ‹Ÿæœºä¼šè®°å½•ä¸‹è°ƒç”¨è€…çš„å…·ä½“ç±»å‹ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºç±»å‹ profileï¼‰æ— æ³•åŒæ—¶è®°å½•è¿™ä¹ˆå¤šä¸ªç±»ï¼Œå› æ­¤å¯èƒ½é€ æˆæ‰€æµ‹è¯•çš„åå°„è°ƒç”¨æ²¡æœ‰è¢«å†…è”çš„æƒ…å†µã€‚</p>
<pre tabindex="0"><code>// v5 ç‰ˆæœ¬
import java.lang.reflect.Method;
 
public class Test {
  public static void target(int i) {
    // ç©ºæ–¹æ³•
  }
 
  public static void main(String[] args) throws Exception {
    Class&lt;?&gt; klass = Class.forName(&quot;Test&quot;);
    Method method = klass.getMethod(&quot;target&quot;, int.class);
    method.setAccessible(true);  // å…³é—­æƒé™æ£€æŸ¥
    polluteProfile();
 
    long current = System.currentTimeMillis();
    for (int i = 1; i &lt;= 2_000_000_000; i++) {
      if (i % 100_000_000 == 0) {
        long temp = System.currentTimeMillis();
        System.out.println(temp - current);
        current = temp;
      }
 
      method.invoke(null, 128);
    }
  }
 
  public static void polluteProfile() throws Exception {
    Method method1 = Test.class.getMethod(&quot;target1&quot;, int.class);
    Method method2 = Test.class.getMethod(&quot;target2&quot;, int.class);
    for (int i = 0; i &lt; 2000; i++) {
      method1.invoke(null, 0);
      method2.invoke(null, 0);
    }
  }
  public static void target1(int i) { }
  public static void target2(int i) { }
}
 
</code></pre><p>åœ¨ä¸Šé¢çš„ v5 ç‰ˆæœ¬ä¸­ï¼Œæˆ‘åœ¨æµ‹è¯•å¾ªç¯ä¹‹å‰è°ƒç”¨äº† polluteProfile çš„æ–¹æ³•ã€‚è¯¥æ–¹æ³•å°†åå°„è°ƒç”¨å¦å¤–ä¸¤ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”å¾ªç¯ä¸Š 2000 éã€‚</p>
<p>è€Œæµ‹è¯•å¾ªç¯åˆ™ä¿æŒä¸å˜ã€‚æµ‹å¾—çš„ç»“æœçº¦ä¸ºåŸºå‡†çš„ 6.7 å€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦è¯¯æ‰°äº† Method.invoke æ–¹æ³•çš„ç±»å‹ profileï¼Œæ€§èƒ½å¼€é”€ä¾¿ä¼šä» 1.3 å€ä¸Šå‡è‡³ 6.7 å€ã€‚</p>
<p>ä¹‹æ‰€ä»¥è¿™ä¹ˆæ…¢ï¼Œé™¤äº†æ²¡æœ‰å†…è”ä¹‹å¤–ï¼Œå¦å¤–ä¸€ä¸ªåŸå› æ˜¯é€ƒé€¸åˆ†æä¸å†èµ·æ•ˆã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥é‡‡ç”¨åˆšæ‰ v3 ç‰ˆæœ¬ä¸­çš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨å¾ªç¯å¤–æ„é€ å‚æ•°æ•°ç»„ï¼Œå¹¶ç›´æ¥ä¼ é€’ç»™åå°„è°ƒç”¨ã€‚è¿™æ ·å­æµ‹å¾—çš„ç»“æœçº¦ä¸ºåŸºå‡†çš„ 5.2 å€ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æé«˜ Java è™šæ‹Ÿæœºå…³äºæ¯ä¸ªè°ƒç”¨èƒ½å¤Ÿè®°å½•çš„ç±»å‹æ•°ç›®ï¼ˆå¯¹åº”è™šæ‹Ÿæœºå‚æ•° -XX:TypeProfileWidthï¼Œé»˜è®¤å€¼ä¸º 2ï¼Œè¿™é‡Œè®¾ç½®ä¸º 3ï¼‰ã€‚æœ€ç»ˆæµ‹å¾—çš„ç»“æœçº¦ä¸ºåŸºå‡†çš„ 2.8 å€ï¼Œå°½ç®¡å®ƒå’ŒåŸæœ¬çš„ 1.3 å€è¿˜æœ‰ä¸€å®šçš„å·®è·ï¼Œä½†æ€»ç®—æ˜¯æ¯” 6.7 å€å¥½å¤šäº†ã€‚</p>
<h2 id="æ€»ç»“ä¸å®è·µ">æ€»ç»“ä¸å®è·µ</h2>
<p>ä»Šå¤©æˆ‘ä»‹ç»äº† Java é‡Œçš„åå°„æœºåˆ¶ã€‚</p>
<p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–¹æ³•çš„åå°„è°ƒç”¨ä¸ºå§”æ´¾å®ç°ï¼Œå§”æ´¾ç»™æœ¬åœ°å®ç°æ¥è¿›è¡Œæ–¹æ³•è°ƒç”¨ã€‚åœ¨è°ƒç”¨è¶…è¿‡ 15 æ¬¡ä¹‹åï¼Œå§”æ´¾å®ç°ä¾¿ä¼šå°†å§”æ´¾å¯¹è±¡åˆ‡æ¢è‡³åŠ¨æ€å®ç°ã€‚è¿™ä¸ªåŠ¨æ€å®ç°çš„å­—èŠ‚ç æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œå®ƒå°†ç›´æ¥ä½¿ç”¨ invoke æŒ‡ä»¤æ¥è°ƒç”¨ç›®æ ‡æ–¹æ³•ã€‚</p>
<p>æ–¹æ³•çš„åå°„è°ƒç”¨ä¼šå¸¦æ¥ä¸å°‘æ€§èƒ½å¼€é”€ï¼ŒåŸå› ä¸»è¦æœ‰ä¸‰ä¸ªï¼šå˜é•¿å‚æ•°æ–¹æ³•å¯¼è‡´çš„ Object æ•°ç»„ï¼ŒåŸºæœ¬ç±»å‹çš„è‡ªåŠ¨è£…ç®±ã€æ‹†ç®±ï¼Œè¿˜æœ‰æœ€é‡è¦çš„æ–¹æ³•å†…è”ã€‚</p>
<p>ä»Šå¤©çš„å®è·µç¯èŠ‚ï¼Œä½ å¯ä»¥å°†æœ€åä¸€æ®µä»£ç ä¸­ polluteProfile æ–¹æ³•çš„ä¸¤ä¸ª Method å¯¹è±¡ï¼Œéƒ½æ”¹æˆè·å–åå­—ä¸ºâ€œtargetâ€çš„æ–¹æ³•ã€‚è¯·é—®è¿™ä¸¤ä¸ªè·å¾—çš„ Method å¯¹è±¡æ˜¯åŒä¸€ä¸ªå—ï¼ˆ==ï¼‰ï¼Ÿä»–ä»¬ equal å—ï¼ˆ.equals(â€¦)ï¼‰ï¼Ÿå¯¹æˆ‘ä»¬çš„è¿è¡Œç»“æœæœ‰ä»€ä¹ˆå½±å“ï¼Ÿ</p>
<pre tabindex="0"><code>import java.lang.reflect.Method;
 
public class Test {
  public static void target(int i) {
    // ç©ºæ–¹æ³•
  }
 
  public static void main(String[] args) throws Exception {
    Class&lt;?&gt; klass = Class.forName(&quot;Test&quot;);
    Method method = klass.getMethod(&quot;target&quot;, int.class);
    method.setAccessible(true);  // å…³é—­æƒé™æ£€æŸ¥
    polluteProfile();
 
    long current = System.currentTimeMillis();
    for (int i = 1; i &lt;= 2_000_000_000; i++) {
      if (i % 100_000_000 == 0) {
        long temp = System.currentTimeMillis();
        System.out.println(temp - current);
        current = temp;
      }
 
      method.invoke(null, 128);
    }
  }
 
  public static void polluteProfile() throws Exception {
    Method method1 = Test.class.getMethod(&quot;target&quot;, int.class);
    Method method2 = Test.class.getMethod(&quot;target&quot;, int.class);
    for (int i = 0; i &lt; 2000; i++) {
      method1.invoke(null, 0);
      method2.invoke(null, 0);
    }
  }
  public static void target1(int i) { }
  public static void target2(int i) { }
}
</code></pre><h2 id="é™„å½•åå°„-api-ç®€ä»‹">é™„å½•ï¼šåå°„ API ç®€ä»‹</h2>
<p>é€šå¸¸æ¥è¯´ï¼Œä½¿ç”¨åå°„ API çš„ç¬¬ä¸€æ­¥ä¾¿æ˜¯è·å– Class å¯¹è±¡ã€‚åœ¨ Java ä¸­å¸¸è§çš„æœ‰è¿™ä¹ˆä¸‰ç§ã€‚</p>
<ol>
<li>ä½¿ç”¨é™æ€æ–¹æ³• Class.forName æ¥è·å–ã€‚</li>
<li>è°ƒç”¨å¯¹è±¡çš„ getClass() æ–¹æ³•ã€‚</li>
<li>ç›´æ¥ç”¨ç±»å +â€œ.classâ€è®¿é—®ã€‚å¯¹äºåŸºæœ¬ç±»å‹æ¥è¯´ï¼Œå®ƒä»¬çš„åŒ…è£…ç±»å‹ï¼ˆwrapper classesï¼‰æ‹¥æœ‰ä¸€ä¸ªåä¸ºâ€œTYPEâ€çš„ final é™æ€å­—æ®µï¼ŒæŒ‡å‘è¯¥åŸºæœ¬ç±»å‹å¯¹åº”çš„ Class å¯¹è±¡ã€‚</li>
</ol>
<p>ä¾‹å¦‚ï¼ŒInteger.TYPE æŒ‡å‘ int.classã€‚å¯¹äºæ•°ç»„ç±»å‹æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨ç±»å +â€œ[ ].classâ€æ¥è®¿é—®ï¼Œå¦‚ int[ ].classã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼ŒClass ç±»å’Œ java.lang.reflect åŒ…ä¸­è¿˜æä¾›äº†è®¸å¤šè¿”å› Class å¯¹è±¡çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæ•°ç»„ç±»çš„ Class å¯¹è±¡ï¼Œè°ƒç”¨ Class.getComponentType() æ–¹æ³•å¯ä»¥è·å¾—æ•°ç»„å…ƒç´ çš„ç±»å‹ã€‚</p>
<p>ä¸€æ—¦å¾—åˆ°äº† Class å¯¹è±¡ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥æ­£å¼åœ°ä½¿ç”¨åå°„åŠŸèƒ½äº†ã€‚ä¸‹é¢æˆ‘åˆ—ä¸¾äº†è¾ƒä¸ºå¸¸ç”¨çš„å‡ é¡¹ã€‚</p>
<ol>
<li>ä½¿ç”¨ newInstance() æ¥ç”Ÿæˆä¸€ä¸ªè¯¥ç±»çš„å®ä¾‹ã€‚å®ƒè¦æ±‚è¯¥ç±»ä¸­æ‹¥æœ‰ä¸€ä¸ªæ— å‚æ•°çš„æ„é€ å™¨ã€‚</li>
<li>ä½¿ç”¨ isInstance(Object) æ¥åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦è¯¥ç±»çš„å®ä¾‹ï¼Œè¯­æ³•ä¸Šç­‰åŒäº instanceof å…³é”®å­—ï¼ˆJIT ä¼˜åŒ–æ—¶ä¼šæœ‰å·®åˆ«ï¼Œæˆ‘ä¼šåœ¨æœ¬ä¸“æ çš„ç¬¬äºŒéƒ¨åˆ†è¯¦ç»†ä»‹ç»ï¼‰ã€‚</li>
<li>ä½¿ç”¨ Array.newInstance(Class,int) æ¥æ„é€ è¯¥ç±»å‹çš„æ•°ç»„ã€‚</li>
<li>ä½¿ç”¨ getFields()/getConstructors()/getMethods() æ¥è®¿é—®è¯¥ç±»çš„æˆå‘˜ã€‚é™¤äº†è¿™ä¸‰ä¸ªä¹‹å¤–ï¼ŒClass ç±»è¿˜æä¾›äº†è®¸å¤šå…¶ä»–æ–¹æ³•ï¼Œè¯¦è§ [4]ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ–¹æ³•åä¸­å¸¦ Declared çš„ä¸ä¼šè¿”å›çˆ¶ç±»çš„æˆå‘˜ï¼Œä½†æ˜¯ä¼šè¿”å›ç§æœ‰æˆå‘˜ï¼›è€Œä¸å¸¦ Declared çš„åˆ™ç›¸åã€‚</li>
</ol>
<p>å½“è·å¾—äº†ç±»æˆå‘˜ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥åšå¦‚ä¸‹æ“ä½œã€‚</p>
<ul>
<li>ä½¿ç”¨ Constructor/Field/Method.setAccessible(true) æ¥ç»•å¼€ Java è¯­è¨€çš„è®¿é—®é™åˆ¶ã€‚</li>
<li>ä½¿ç”¨ Constructor.newInstance(Object[]) æ¥ç”Ÿæˆè¯¥ç±»çš„å®ä¾‹ã€‚</li>
<li>ä½¿ç”¨ Field.get/set(Object) æ¥è®¿é—®å­—æ®µçš„å€¼ã€‚</li>
<li>ä½¿ç”¨ Method.invoke(Object, Object[]) æ¥è°ƒç”¨æ–¹æ³•ã€‚</li>
</ul>
<p>æœ‰å…³åå°„ API çš„å…¶ä»–ç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒ reflect åŒ…çš„ javadoc [5] ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†å±•å¼€äº†ã€‚</p>
<p><a href="https://docs.oracle.com/javase/tutorial/reflect/">https://docs.oracle.com/javase/tutorial/reflect/</a></p>
<p><a href="http://hg.openjdk.java.net/jdk10/jdk10/jdk/file/777356696811/src/java.base/share/classes/jdk/internal/reflect/ReflectionFactory.java#l80">http://hg.openjdk.java.net/jdk10/jdk10/jdk/file/777356696811/src/java.base/share/classes/jdk/internal/reflect/ReflectionFactory.java#l80</a></p>
<p><a href="http://hg.openjdk.java.net/jdk10/jdk10/jdk/file/777356696811/src/java.base/share/classes/jdk/internal/reflect/ReflectionFactory.java#l78">http://hg.openjdk.java.net/jdk10/jdk10/jdk/file/777356696811/src/java.base/share/classes/jdk/internal/reflect/ReflectionFactory.java#l78</a></p>
<p><a href="https://docs.oracle.com/javase/tutorial/reflect/class/classMembers.html">https://docs.oracle.com/javase/tutorial/reflect/class/classMembers.html</a></p>
<p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/reflect/package-summary.html">https://docs.oracle.com/javase/10/docs/api/java/lang/reflect/package-summary.html</a></p>

        </div>
    </article>
</div>
<div class="division-line"></div>
<div class="others">
    <div>æ ‡ç­¾ï¼šğŸ·ï¸<a class="post-tag" href="/tags/java/">java</a>&nbsp;</div>
    <div>åˆ†ç±»ï¼š ğŸ“’<a class="post-category" href="/categories/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/">æ·±å…¥æ‹†è§£Javaè™šæ‹Ÿæœº</a>&nbsp; </div>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/06-jvm%E6%98%AF%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8%E7%9A%84/"><span>06 JVMæ˜¯å¦‚ä½•å¤„ç†å¼‚å¸¸çš„ï¼Ÿ</span></a>
    </div>
    <div class="next">
        
        <a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/08-jvm%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0invokedynamic%E7%9A%84%E4%B8%8A/"><span>08 JVMæ˜¯æ€ä¹ˆå®ç°invokedynamicçš„ï¼Ÿï¼ˆä¸Šï¼‰</span></a>
    </div>
</div>

        </div>
        <div id="float">
            <ul class="float-button-bar">
    <li>
        <button class="float-button top" onclick="scrollToTop(this);">UP</button>
    </li>
    <li>
        <button class="float-button toggler" onclick="changeSkin(this);">DARK</button>
    </li>
</ul>
        </div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 2020 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    const changeSkin = () => {
        document.getElementById('page').classList.toggle('night');
    }
    const scrollToTop = () => {
        window.scrollTo(0, 0);
    }
</script>
</body>

</html>