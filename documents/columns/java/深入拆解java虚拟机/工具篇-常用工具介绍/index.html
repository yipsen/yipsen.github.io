<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>å·¥å…·ç¯‡ å¸¸ç”¨å·¥å…·ä»‹ç» | Yipsen Ye</title>
<meta name="description" content="åœ¨å‰é¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘æ›¾ä½¿ç”¨äº†ä¸å°‘å·¥å…·æ¥è¾…åŠ©è®²è§£ï¼Œä¹Ÿæ”¶åˆ°äº†ä¸å°‘åŒå­¦ç•™è¨€ï¼Œè¯´ä¸äº†è§£è¿™äº›å·¥å…·ï¼Œä¸çŸ¥é“éƒ½æœ‰ä»€ä¹ˆç”¨ï¼Œåº”è¯¥æ€ä¹ˆç”¨ã€‚é‚£ä¹ˆä»Šå¤©æˆ‘ä¾¿ç»Ÿä¸€åšä¸€æ¬¡å…·ä½“çš„ä»‹ç»ã€‚æœ¬ç¯‡ä»£ç è¾ƒå¤šï¼Œä½ å¯ä»¥ç‚¹å‡»æ–‡ç¨¿æŸ¥çœ‹ã€‚
javapï¼šæŸ¥é˜… Java å­—èŠ‚ç  javap æ˜¯ä¸€ä¸ªèƒ½å¤Ÿå°† class æ–‡ä»¶åæ±‡ç¼–æˆäººç±»å¯è¯»æ ¼å¼çš„å·¥å…·ã€‚åœ¨æœ¬ä¸“æ ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸å€ŸåŠ©è¿™ä¸ªå·¥å…·æ¥æŸ¥é˜… Java å­—èŠ‚ç ã€‚
ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨è®²è§£å¼‚å¸¸å¤„ç†é‚£ä¸€ç¯‡ä¸­ï¼Œæˆ‘æ›¾ç»å±•ç¤ºè¿‡è¿™ä¹ˆä¸€æ®µä»£ç ã€‚
public class Foo {private int tryBlock;private int catchBlock;private int finallyBlock;private int methodExit;public void test() {try {tryBlock = 0;} catch (Exception e) {catchBlock = 1;} finally {finallyBlock = 2;}methodExit = 3;}}ç¼–è¯‘è¿‡åï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨ javap æ¥æŸ¥é˜… Foo.test æ–¹æ³•çš„å­—èŠ‚ç ã€‚
$ javac Foo.java$ javap -p -v FooClassfile .">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/%e6%b7%b1%e5%85%a5%e6%8b%86%e8%a7%a3java%e8%99%9a%e6%8b%9f%e6%9c%ba/">æ·±å…¥æ‹†è§£Javaè™šæ‹Ÿæœº</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/00-%E5%BC%80%E7%AF%87%E8%AF%8D-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E4%BB%AC%E8%A6%81%E5%AD%A6%E4%B9%A0java%E8%99%9A%E6%8B%9F%E6%9C%BA/">00 å¼€ç¯‡è¯ ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å­¦ä¹ Javaè™šæ‹Ÿæœºï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/01-java%E4%BB%A3%E7%A0%81%E6%98%AF%E6%80%8E%E4%B9%88%E8%BF%90%E8%A1%8C%E7%9A%84/">01 Javaä»£ç æ˜¯æ€ä¹ˆè¿è¡Œçš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/02-java%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/">02 Javaçš„åŸºæœ¬ç±»å‹</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/03-java%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%98%AF%E5%A6%82%E4%BD%95%E5%8A%A0%E8%BD%BDjava%E7%B1%BB%E7%9A%84/">03 Javaè™šæ‹Ÿæœºæ˜¯å¦‚ä½•åŠ è½½Javaç±»çš„</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/04-jvm%E6%98%AF%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E7%9A%84%E4%B8%8A/">04 JVMæ˜¯å¦‚ä½•æ‰§è¡Œæ–¹æ³•è°ƒç”¨çš„ï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/05-jvm%E6%98%AF%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E7%9A%84%E4%B8%8B/">05 JVMæ˜¯å¦‚ä½•æ‰§è¡Œæ–¹æ³•è°ƒç”¨çš„ï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/06-jvm%E6%98%AF%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8%E7%9A%84/">06 JVMæ˜¯å¦‚ä½•å¤„ç†å¼‚å¸¸çš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/07-jvm%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%8F%8D%E5%B0%84%E7%9A%84/">07 JVMæ˜¯å¦‚ä½•å®ç°åå°„çš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/08-jvm%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0invokedynamic%E7%9A%84%E4%B8%8A/">08 JVMæ˜¯æ€ä¹ˆå®ç°invokedynamicçš„ï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/09-jvm%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0invokedynamic%E7%9A%84%E4%B8%8B/">09 JVMæ˜¯æ€ä¹ˆå®ç°invokedynamicçš„ï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/10-java%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80/">10 Javaå¯¹è±¡çš„å†…å­˜å¸ƒå±€</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/11-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E4%B8%8A/">11 åƒåœ¾å›æ”¶ï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/12-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E4%B8%8B/">12 åƒåœ¾å›æ”¶ï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/13-java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/">13 Javaå†…å­˜æ¨¡å‹</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/14-java%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0synchronized%E7%9A%84/">14 Javaè™šæ‹Ÿæœºæ˜¯æ€ä¹ˆå®ç°synchronizedçš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/15-java%E8%AF%AD%E6%B3%95%E7%B3%96%E4%B8%8Ejava%E7%BC%96%E8%AF%91%E5%99%A8/">15 Javaè¯­æ³•ç³–ä¸Javaç¼–è¯‘å™¨</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/16-%E5%8D%B3%E6%97%B6%E7%BC%96%E8%AF%91%E4%B8%8A/">16 å³æ—¶ç¼–è¯‘ï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/17-%E5%8D%B3%E6%97%B6%E7%BC%96%E8%AF%91%E4%B8%8B/">17 å³æ—¶ç¼–è¯‘ï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/18-%E5%8D%B3%E6%97%B6%E7%BC%96%E8%AF%91%E5%99%A8%E7%9A%84%E4%B8%AD%E9%97%B4%E8%A1%A8%E8%BE%BE%E5%BD%A2%E5%BC%8F/">18 å³æ—¶ç¼–è¯‘å™¨çš„ä¸­é—´è¡¨è¾¾å½¢å¼</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/19-java%E5%AD%97%E8%8A%82%E7%A0%81%E5%9F%BA%E7%A1%80%E7%AF%87/">19 Javaå­—èŠ‚ç ï¼ˆåŸºç¡€ç¯‡ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/20-%E6%96%B9%E6%B3%95%E5%86%85%E8%81%94%E4%B8%8A/">20 æ–¹æ³•å†…è”ï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/21-%E6%96%B9%E6%B3%95%E5%86%85%E8%81%94%E4%B8%8B/">21 æ–¹æ³•å†…è”ï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/22-hotspot%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84intrinsic/">22 HotSpotè™šæ‹Ÿæœºçš„intrinsic</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/23-%E9%80%83%E9%80%B8%E5%88%86%E6%9E%90/">23 é€ƒé€¸åˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/24-%E5%AD%97%E6%AE%B5%E8%AE%BF%E9%97%AE%E7%9B%B8%E5%85%B3%E4%BC%98%E5%8C%96/">24 å­—æ®µè®¿é—®ç›¸å…³ä¼˜åŒ–</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/25-%E5%BE%AA%E7%8E%AF%E4%BC%98%E5%8C%96/">25 å¾ªç¯ä¼˜åŒ–</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/26-%E5%90%91%E9%87%8F%E5%8C%96/">26 å‘é‡åŒ–</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/27-%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8/">27 æ³¨è§£å¤„ç†å™¨</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/28-%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6jmh%E4%B8%8A/">28 åŸºå‡†æµ‹è¯•æ¡†æ¶JMHï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/29-%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6jmh%E4%B8%8B/">29 åŸºå‡†æµ‹è¯•æ¡†æ¶JMHï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/30-java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E7%9B%91%E6%8E%A7%E5%8F%8A%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%AF%87/">30 Javaè™šæ‹Ÿæœºçš„ç›‘æ§åŠè¯Šæ–­å·¥å…·ï¼ˆå‘½ä»¤è¡Œç¯‡ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/31-java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E7%9B%91%E6%8E%A7%E5%8F%8A%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7gui%E7%AF%87/">31 Javaè™šæ‹Ÿæœºçš„ç›‘æ§åŠè¯Šæ–­å·¥å…·ï¼ˆGUIç¯‡ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/32-jni%E7%9A%84%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6/">32 JNIçš„è¿è¡Œæœºåˆ¶</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/33-java-agent%E4%B8%8E%E5%AD%97%E8%8A%82%E7%A0%81%E6%B3%A8%E5%85%A5/">33 Java Agentä¸å­—èŠ‚ç æ³¨å…¥</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/34-graal%E7%94%A8java%E7%BC%96%E8%AF%91java/">34 Graalï¼šç”¨Javaç¼–è¯‘Java</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/35-truffle%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E6%A1%86%E6%9E%B6/">35 Truffleï¼šè¯­è¨€å®ç°æ¡†æ¶</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/36-substratevmaot%E7%BC%96%E8%AF%91%E6%A1%86%E6%9E%B6/">36 SubstrateVMï¼šAOTç¼–è¯‘æ¡†æ¶</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/%E5%B0%BE%E5%A3%B0%E4%B8%A8%E9%81%93%E9%98%BB%E4%B8%94%E9%95%BF%E5%8A%AA%E5%8A%9B%E5%8A%A0%E9%A4%90.html/">å°¾å£°ä¸¨é“é˜»ä¸”é•¿ï¼ŒåŠªåŠ›åŠ é¤.html</a></li>
                
                
                
                    <li>å·¥å…·ç¯‡ å¸¸ç”¨å·¥å…·ä»‹ç»</li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">å·¥å…·ç¯‡ å¸¸ç”¨å·¥å…·ä»‹ç»</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2022-01-09 11:11:28</span>ğŸ·ï¸&nbsp;<a class="post-tag" href="/tags/java/">java</a></div><div class="post-category">
                
                ğŸ“š&nbsp;<a href="/categories/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/">æ·±å…¥æ‹†è§£Javaè™šæ‹Ÿæœº</a>
                
            </div></div>
        <div class="post-content">
            <p>åœ¨å‰é¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘æ›¾ä½¿ç”¨äº†ä¸å°‘å·¥å…·æ¥è¾…åŠ©è®²è§£ï¼Œä¹Ÿæ”¶åˆ°äº†ä¸å°‘åŒå­¦ç•™è¨€ï¼Œè¯´ä¸äº†è§£è¿™äº›å·¥å…·ï¼Œä¸çŸ¥é“éƒ½æœ‰ä»€ä¹ˆç”¨ï¼Œåº”è¯¥æ€ä¹ˆç”¨ã€‚é‚£ä¹ˆä»Šå¤©æˆ‘ä¾¿ç»Ÿä¸€åšä¸€æ¬¡å…·ä½“çš„ä»‹ç»ã€‚æœ¬ç¯‡ä»£ç è¾ƒå¤šï¼Œä½ å¯ä»¥ç‚¹å‡»æ–‡ç¨¿æŸ¥çœ‹ã€‚</p>
<h2 id="javapæŸ¥é˜…-java-å­—èŠ‚ç ">javapï¼šæŸ¥é˜… Java å­—èŠ‚ç </h2>
<p>javap æ˜¯ä¸€ä¸ªèƒ½å¤Ÿå°† class æ–‡ä»¶åæ±‡ç¼–æˆäººç±»å¯è¯»æ ¼å¼çš„å·¥å…·ã€‚åœ¨æœ¬ä¸“æ ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸å€ŸåŠ©è¿™ä¸ªå·¥å…·æ¥æŸ¥é˜… Java å­—èŠ‚ç ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨è®²è§£å¼‚å¸¸å¤„ç†é‚£ä¸€ç¯‡ä¸­ï¼Œæˆ‘æ›¾ç»å±•ç¤ºè¿‡è¿™ä¹ˆä¸€æ®µä»£ç ã€‚</p>
<pre tabindex="0"><code>public class Foo {
  private int tryBlock;
  private int catchBlock;
  private int finallyBlock;
  private int methodExit;
 
  public void test() {
    try {
      tryBlock = 0;
    } catch (Exception e) {
      catchBlock = 1;
    } finally {
      finallyBlock = 2;
    }
    methodExit = 3;
  }
}
</code></pre><p>ç¼–è¯‘è¿‡åï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨ javap æ¥æŸ¥é˜… Foo.test æ–¹æ³•çš„å­—èŠ‚ç ã€‚</p>
<pre tabindex="0"><code>$ javac Foo.java
$ javap -p -v Foo
Classfile ../Foo.class
  Last modified ..; size 541 bytes
  MD5 checksum 3828cdfbba56fea1da6c8d94fd13b20d
  Compiled from &quot;Foo.java&quot;
public class Foo
  minor version: 0
  major version: 54
  flags: (0x0021) ACC_PUBLIC, ACC_SUPER
  this_class: #7                          // Foo
  super_class: #8                         // java/lang/Object
  interfaces: 0, fields: 4, methods: 2, attributes: 1
Constant pool:
   #1 = Methodref          #8.#23         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V
   #2 = Fieldref           #7.#24         // Foo.tryBlock:I
   #3 = Fieldref           #7.#25         // Foo.finallyBlock:I
   #4 = Class              #26            // java/lang/Exception
   #5 = Fieldref           #7.#27         // Foo.catchBlock:I
   #6 = Fieldref           #7.#28         // Foo.methodExit:I
   #7 = Class              #29            // Foo
   #8 = Class              #30            // java/lang/Object
   #9 = Utf8               tryBlock
  #10 = Utf8               I
  #11 = Utf8               catchBlock
  #12 = Utf8               finallyBlock
  #13 = Utf8               methodExit
  #14 = Utf8               &lt;init&gt;
  #15 = Utf8               ()V
  #16 = Utf8               Code
  #17 = Utf8               LineNumberTable
  #18 = Utf8               test
  #19 = Utf8               StackMapTable
  #20 = Class              #31            // java/lang/Throwable
  #21 = Utf8               SourceFile
  #22 = Utf8               Foo.java
  #23 = NameAndType        #14:#15        // &quot;&lt;init&gt;&quot;:()V
  #24 = NameAndType        #9:#10         // tryBlock:I
  #25 = NameAndType        #12:#10        // finallyBlock:I
  #26 = Utf8               java/lang/Exception
  #27 = NameAndType        #11:#10        // catchBlock:I
  #28 = NameAndType        #13:#10        // methodExit:I
  #29 = Utf8               Foo
  #30 = Utf8               java/lang/Object
  #31 = Utf8               java/lang/Throwable
{
  private int tryBlock;
    descriptor: I
    flags: (0x0002) ACC_PRIVATE
 
  private int catchBlock;
    descriptor: I
    flags: (0x0002) ACC_PRIVATE
 
  private int finallyBlock;
    descriptor: I
    flags: (0x0002) ACC_PRIVATE
 
  private int methodExit;
    descriptor: I
    flags: (0x0002) ACC_PRIVATE
 
  public Foo();
    descriptor: ()V
    flags: (0x0001) ACC_PUBLIC
    Code:
      stack=1, locals=1, args_size=1
         0: aload_0
         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V
         4: return
      LineNumberTable:
        line 1: 0
 
  public void test();
    descriptor: ()V
    flags: (0x0001) ACC_PUBLIC
    Code:
      stack=2, locals=3, args_size=1
         0: aload_0
         1: iconst_0
         2: putfield      #2                  // Field tryBlock:I
         5: aload_0
         6: iconst_2
         7: putfield      #3                  // Field finallyBlock:I
        10: goto          35
        13: astore_1
        14: aload_0
        15: iconst_1
        16: putfield      #5                  // Field catchBlock:I
        19: aload_0
        20: iconst_2
        21: putfield      #3                  // Field finallyBlock:I
        24: goto          35
        27: astore_2
        28: aload_0
        29: iconst_2
        30: putfield      #3                  // Field finallyBlock:I
        33: aload_2
        34: athrow
        35: aload_0
        36: iconst_3
        37: putfield      #6                  // Field methodExit:I
        40: return
      Exception table:
         from    to  target type
             0     5    13   Class java/lang/Exception
             0     5    27   any
            13    19    27   any
      LineNumberTable:
        line 9: 0
        line 13: 5
        line 14: 10
        line 10: 13
        line 11: 14
        line 13: 19
        line 14: 24
        line 13: 27
        line 14: 33
        line 15: 35
        line 16: 40
      StackMapTable: number_of_entries = 3
        frame_type = 77 /* same_locals_1_stack_item */
          stack = [ class java/lang/Exception ]
        frame_type = 77 /* same_locals_1_stack_item */
          stack = [ class java/lang/Throwable ]
        frame_type = 7 /* same */
}
SourceFile: &quot;Foo.java&quot;
</code></pre><p>è¿™é‡Œé¢æˆ‘ç”¨åˆ°äº†ä¸¤ä¸ªé€‰é¡¹ã€‚ç¬¬ä¸€ä¸ªé€‰é¡¹æ˜¯ -pã€‚é»˜è®¤æƒ…å†µä¸‹ javap ä¼šæ‰“å°æ‰€æœ‰éç§æœ‰çš„å­—æ®µå’Œæ–¹æ³•ï¼Œå½“åŠ äº† -p é€‰é¡¹åï¼Œå®ƒè¿˜å°†æ‰“å°ç§æœ‰çš„å­—æ®µå’Œæ–¹æ³•ã€‚ç¬¬äºŒä¸ªé€‰é¡¹æ˜¯ -vã€‚å®ƒå°½å¯èƒ½åœ°æ‰“å°æ‰€æœ‰ä¿¡æ¯ã€‚å¦‚æœä½ åªéœ€è¦æŸ¥é˜…æ–¹æ³•å¯¹åº”çš„å­—èŠ‚ç ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ -c é€‰é¡¹æ¥æ›¿æ¢ -vã€‚</p>
<p>javap çš„ -v é€‰é¡¹çš„è¾“å‡ºåˆ†ä¸ºå‡ å¤§å—ã€‚</p>
<p>\1. åŸºæœ¬ä¿¡æ¯ï¼Œæ¶µç›–äº†åŸ class æ–‡ä»¶çš„ç›¸å…³ä¿¡æ¯ã€‚</p>
<p>class æ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼ˆminor version: 0ï¼Œmajor version: 54ï¼‰ï¼Œè¯¥ç±»çš„è®¿é—®æƒé™ï¼ˆflags: (0x0021) ACC_PUBLIC, ACC_SUPERï¼‰ï¼Œè¯¥ç±»ï¼ˆthis_class: #7ï¼‰ä»¥åŠçˆ¶ç±»ï¼ˆsuper_class: #8ï¼‰çš„åå­—ï¼Œæ‰€å®ç°æ¥å£ï¼ˆinterfaces: 0ï¼‰ã€å­—æ®µï¼ˆfields: 4ï¼‰ã€æ–¹æ³•ï¼ˆmethods: 2ï¼‰ä»¥åŠå±æ€§ï¼ˆattributes: 1ï¼‰çš„æ•°ç›®ã€‚</p>
<p>è¿™é‡Œå±æ€§æŒ‡çš„æ˜¯ class æ–‡ä»¶æ‰€æºå¸¦çš„è¾…åŠ©ä¿¡æ¯ï¼Œæ¯”å¦‚è¯¥ class æ–‡ä»¶çš„æºæ–‡ä»¶çš„åç§°ã€‚è¿™ç±»ä¿¡æ¯é€šå¸¸è¢«ç”¨äº Java è™šæ‹Ÿæœºçš„éªŒè¯å’Œè¿è¡Œï¼Œä»¥åŠ Java ç¨‹åºçš„è°ƒè¯•ï¼Œä¸€èˆ¬æ— é¡»æ·±å…¥äº†è§£ã€‚</p>
<pre tabindex="0"><code>Classfile ../Foo.class
  Last modified ..; size 541 bytes
  MD5 checksum 3828cdfbba56fea1da6c8d94fd13b20d
  Compiled from &quot;Foo.java&quot;
public class Foo
  minor version: 0
  major version: 54
  flags: (0x0021) ACC_PUBLIC, ACC_SUPER
  this_class: #7                          // Foo
  super_class: #8                         // java/lang/Object
  interfaces: 0, fields: 4, methods: 2, attributes: 1
</code></pre><p>class æ–‡ä»¶çš„ç‰ˆæœ¬å·æŒ‡çš„æ˜¯ç¼–è¯‘ç”Ÿæˆè¯¥ class æ–‡ä»¶æ—¶æ‰€ç”¨çš„ JRE ç‰ˆæœ¬ã€‚ç”±è¾ƒæ–°çš„ JRE ç‰ˆæœ¬ä¸­çš„ javac ç¼–è¯‘è€Œæˆçš„ class æ–‡ä»¶ï¼Œä¸èƒ½åœ¨æ—§ç‰ˆæœ¬çš„ JRE ä¸Šè·‘ï¼Œå¦åˆ™ï¼Œä¼šå‡ºç°å¦‚ä¸‹å¼‚å¸¸ä¿¡æ¯ã€‚ï¼ˆJava 8 å¯¹åº”çš„ç‰ˆæœ¬å·ä¸º 52ï¼ŒJava 10 å¯¹åº”çš„ç‰ˆæœ¬å·ä¸º 54ã€‚ï¼‰</p>
<pre tabindex="0"><code>Exception in thread &quot;main&quot; java.lang.UnsupportedClassVersionError: Foo has been compiled by a more recent version of the Java Runtime (class file version 54.0), this version of the Java Runtime only recognizes class file versions up to 52.0
</code></pre><p>ç±»çš„è®¿é—®æƒé™é€šå¸¸ä¸º ACC_ å¼€å¤´çš„å¸¸é‡ã€‚å…·ä½“æ¯ä¸ªå¸¸é‡çš„æ„ä¹‰å¯ä»¥æŸ¥é˜… Java è™šæ‹Ÿæœºè§„èŒƒ 4.1 å°èŠ‚ [1]ã€‚</p>
<p>\2. å¸¸é‡æ± ï¼Œç”¨æ¥å­˜æ”¾å„ç§å¸¸é‡ä»¥åŠç¬¦å·å¼•ç”¨ã€‚</p>
<p>å¸¸é‡æ± ä¸­çš„æ¯ä¸€é¡¹éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ç´¢å¼•ï¼ˆå¦‚ #1ï¼‰ï¼Œå¹¶ä¸”å¯èƒ½å¼•ç”¨å…¶ä»–çš„å¸¸é‡æ± é¡¹ï¼ˆ#1 = Methodref #8.#23ï¼‰ã€‚</p>
<pre tabindex="0"><code>Constant pool:
   #1 = Methodref          #8.#23         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V
... 
   #8 = Class              #30            // java/lang/Object
...
  #14 = Utf8               &lt;init&gt;
  #15 = Utf8               ()V
...
  #23 = NameAndType        #14:#15        // &quot;&lt;init&gt;&quot;:()V
...
  #30 = Utf8               java/lang/Object
</code></pre><p>ä¸¾ä¾‹æ¥è¯´ï¼Œä¸Šå›¾ä¸­çš„ 1 å·å¸¸é‡æ± é¡¹æ˜¯ä¸€ä¸ªæŒ‡å‘ Object ç±»æ„é€ å™¨çš„ç¬¦å·å¼•ç”¨ã€‚å®ƒæ˜¯ç”±å¦å¤–ä¸¤ä¸ªå¸¸é‡æ± é¡¹æ‰€æ„æˆã€‚å¦‚æœå°†å®ƒçœ‹æˆä¸€ä¸ªæ ‘ç»“æ„çš„è¯ï¼Œé‚£ä¹ˆå®ƒçš„å¶èŠ‚ç‚¹ä¼šæ˜¯å­—ç¬¦ä¸²å¸¸é‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA/assets/f87469e321c52b21b0d2abb88e7b288c.png" alt="img"></p>
<p>\3. å­—æ®µåŒºåŸŸï¼Œç”¨æ¥åˆ—ä¸¾è¯¥ç±»ä¸­çš„å„ä¸ªå­—æ®µã€‚</p>
<p>è¿™é‡Œæœ€ä¸»è¦çš„ä¿¡æ¯ä¾¿æ˜¯è¯¥å­—æ®µçš„ç±»å‹ï¼ˆdescriptor: Iï¼‰ä»¥åŠè®¿é—®æƒé™ï¼ˆflags: (0x0002) ACC_PRIVATEï¼‰ã€‚å¯¹äºå£°æ˜ä¸º final çš„é™æ€å­—æ®µè€Œè¨€ï¼Œå¦‚æœå®ƒæ˜¯åŸºæœ¬ç±»å‹æˆ–è€…å­—ç¬¦ä¸²ç±»å‹ï¼Œé‚£ä¹ˆå­—æ®µåŒºåŸŸè¿˜å°†åŒ…æ‹¬å®ƒçš„å¸¸é‡å€¼ã€‚</p>
<pre tabindex="0"><code>  private int tryBlock;
    descriptor: I
    flags: (0x0002) ACC_PRIVATE
 
</code></pre><p>å¦å¤–ï¼ŒJava è™šæ‹ŸæœºåŒæ ·ä½¿ç”¨äº†â€œæè¿°ç¬¦â€ï¼ˆdescriptorï¼‰æ¥æè¿°å­—æ®µçš„ç±»å‹ã€‚å…·ä½“çš„å¯¹ç…§å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚å…¶ä¸­æ¯”è¾ƒç‰¹æ®Šçš„ï¼Œæˆ‘å·²ç»é«˜äº®æ˜¾ç¤ºã€‚</p>
<p>\4. æ–¹æ³•åŒºåŸŸï¼Œç”¨æ¥åˆ—ä¸¾è¯¥ç±»ä¸­çš„å„ä¸ªæ–¹æ³•ã€‚</p>
<p>é™¤äº†æ–¹æ³•æè¿°ç¬¦ä»¥åŠè®¿é—®æƒé™ä¹‹å¤–ï¼Œæ¯ä¸ªæ–¹æ³•è¿˜åŒ…æ‹¬æœ€ä¸ºé‡è¦çš„ä»£ç åŒºåŸŸï¼ˆCode:)ã€‚</p>
<pre tabindex="0"><code>  public void test();
    descriptor: ()V
    flags: (0x0001) ACC_PUBLIC
    Code:
      stack=2, locals=3, args_size=1
         0: aload_0
...
        10: goto          35
...
        34: athrow
        35: aload_0
...
        40: return
      Exception table:
         from    to  target type
             0     5    13   Class java/lang/Exception
             0     5    27   any
            13    19    27   any
      LineNumberTable:
        line 9: 0
...
        line 16: 40
      StackMapTable: number_of_entries = 3
        frame_type = 77 /* same_locals_1_stack_item */
          stack = [ class java/lang/Exception ]
...
</code></pre><p>ä»£ç åŒºåŸŸä¸€å¼€å§‹ä¼šå£°æ˜è¯¥æ–¹æ³•ä¸­çš„æ“ä½œæ•°æ ˆï¼ˆstack=2ï¼‰å’Œå±€éƒ¨å˜é‡æ•°ç›®ï¼ˆlocals=3ï¼‰çš„æœ€å¤§å€¼ï¼Œä»¥åŠè¯¥æ–¹æ³•æ¥æ”¶å‚æ•°çš„ä¸ªæ•°ï¼ˆargs_size=1ï¼‰ã€‚æ³¨æ„è¿™é‡Œå±€éƒ¨å˜é‡æŒ‡çš„æ˜¯å­—èŠ‚ç ä¸­çš„å±€éƒ¨å˜é‡ï¼Œè€Œé Java ç¨‹åºä¸­çš„å±€éƒ¨å˜é‡ã€‚</p>
<p>æ¥ä¸‹æ¥åˆ™æ˜¯è¯¥æ–¹æ³•çš„å­—èŠ‚ç ã€‚æ¯æ¡å­—èŠ‚ç å‡æ ‡æ³¨äº†å¯¹åº”çš„åç§»é‡ï¼ˆbytecode indexï¼ŒBCIï¼‰ï¼Œè¿™æ˜¯ç”¨æ¥å®šä½å­—èŠ‚ç çš„ã€‚æ¯”å¦‚è¯´åç§»é‡ä¸º 10 çš„è·³è½¬å­—èŠ‚ç  10: goto 35ï¼Œå°†è·³è½¬è‡³åç§»é‡ä¸º 35 çš„å­—èŠ‚ç  35: aload_0ã€‚</p>
<p>ç´§è·Ÿç€çš„å¼‚å¸¸è¡¨ï¼ˆException table:ï¼‰ä¹Ÿä¼šä½¿ç”¨åç§»é‡æ¥å®šä½æ¯ä¸ªå¼‚å¸¸å¤„ç†å™¨æ‰€ç›‘æ§çš„èŒƒå›´ï¼ˆç”± from åˆ° to çš„ä»£ç åŒºåŸŸï¼‰ï¼Œä»¥åŠå¼‚å¸¸å¤„ç†å™¨çš„èµ·å§‹ä½ç½®ï¼ˆtargetï¼‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜ä¼šå£°æ˜æ‰€æ•è·çš„å¼‚å¸¸ç±»å‹ï¼ˆtypeï¼‰ã€‚å…¶ä¸­ï¼Œany æŒ‡ä»£ä»»æ„å¼‚å¸¸ç±»å‹ã€‚</p>
<p>å†æ¥ä¸‹æ¥çš„è¡Œæ•°è¡¨ï¼ˆLineNumberTable:ï¼‰åˆ™æ˜¯ Java æºç¨‹åºåˆ°å­—èŠ‚ç åç§»é‡çš„æ˜ å°„ã€‚å¦‚æœä½ åœ¨ç¼–è¯‘æ—¶ä½¿ç”¨äº† -g å‚æ•°ï¼ˆjavac -g Foo.javaï¼‰ï¼Œé‚£ä¹ˆè¿™é‡Œè¿˜å°†å‡ºç°å±€éƒ¨å˜é‡è¡¨ï¼ˆLocalVariableTable:ï¼‰ï¼Œå±•ç¤º Java ç¨‹åºä¸­æ¯ä¸ªå±€éƒ¨å˜é‡çš„åå­—ã€ç±»å‹ä»¥åŠä½œç”¨åŸŸã€‚</p>
<p>è¡Œæ•°è¡¨å’Œå±€éƒ¨å˜é‡è¡¨å‡å±äºè°ƒè¯•ä¿¡æ¯ã€‚Java è™šæ‹Ÿæœºå¹¶ä¸è¦æ±‚ class æ–‡ä»¶å¿…å¤‡è¿™äº›ä¿¡æ¯ã€‚</p>
<pre tabindex="0"><code>      LocalVariableTable:
        Start  Length  Slot  Name   Signature
           14       5     1     e   Ljava/lang/Exception;
            0      41     0  this   LFoo;
</code></pre><p>æœ€ååˆ™æ˜¯å­—èŠ‚ç æ“ä½œæ•°æ ˆçš„æ˜ å°„è¡¨ï¼ˆStackMapTable: number_of_entries = 3ï¼‰ã€‚è¯¥è¡¨æè¿°çš„æ˜¯å­—èŠ‚ç è·³è½¬åæ“ä½œæ•°æ ˆçš„åˆ†å¸ƒæƒ…å†µï¼Œä¸€èˆ¬è¢« Java è™šæ‹Ÿæœºç”¨äºéªŒè¯æ‰€åŠ è½½çš„ç±»ï¼Œä»¥åŠå³æ—¶ç¼–è¯‘ç›¸å…³çš„ä¸€äº›æ“ä½œï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä½ æ— é¡»æ·±å…¥äº†è§£ã€‚</p>
<h2 id="2openjdk-é¡¹ç›®-code-toolså®ç”¨å°å·¥å…·é›†">2.OpenJDK é¡¹ç›® Code Toolsï¼šå®ç”¨å°å·¥å…·é›†</h2>
<p>OpenJDK çš„ Code Tools é¡¹ç›® [2] åŒ…å«äº†å¥½å‡ ä¸ªå®ç”¨çš„å°å·¥å…·ã€‚</p>
<p>åœ¨ç¬¬ä¸€ç¯‡çš„å®è·µç¯èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å…¶ä¸­çš„å­—èŠ‚ç æ±‡ç¼–å™¨åæ±‡ç¼–å™¨ ASMTools[3]ï¼Œå½“å‰ 6.0 ç‰ˆæœ¬çš„ä¸‹è½½åœ°å€ä½äº [4]ã€‚ASMTools çš„åæ±‡ç¼–ä»¥åŠæ±‡ç¼–æ“ä½œæ‰€å¯¹åº”çš„å‘½ä»¤åˆ†åˆ«ä¸ºï¼š</p>
<pre tabindex="0"><code>$ java -cp /path/to/asmtools.jar org.openjdk.asmtools.jdis.Main Foo.class &gt; Foo.jasm
</code></pre><p>å’Œ</p>
<pre tabindex="0"><code>$ java -cp /path/to/asmtools.jar org.openjdk.asmtools.jasm.Main Foo.jasm
</code></pre><p>è¯¥åæ±‡ç¼–å™¨çš„è¾“å‡ºæ ¼å¼å’Œ javap çš„ä¸å°½ç›¸åŒã€‚ä¸€èˆ¬æˆ‘åªä½¿ç”¨å®ƒæ¥è¿›è¡Œä¸€äº›ç®€å•çš„å­—èŠ‚ç ä¿®æ”¹ï¼Œä»¥æ­¤ç”Ÿæˆæ— æ³•ç›´æ¥ç”± Java ç¼–è¯‘å™¨ç”Ÿæˆçš„ç±»ï¼Œå®ƒåœ¨ HotSpot è™šæ‹Ÿæœºè‡ªèº«çš„æµ‹è¯•ä¸­æ¯”è¾ƒå¸¸è§ã€‚</p>
<p>åœ¨ç¬¬ä¸€ç¯‡çš„å®è·µç¯èŠ‚ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†æ•´æ•° 2 èµ‹å€¼åˆ°ä¸€ä¸ªå£°æ˜ä¸º boolean ç±»å‹çš„å±€éƒ¨å˜é‡ä¸­ã€‚æˆ‘é‡‡å–çš„åšæ³•æ˜¯å°†ç¼–è¯‘ç”Ÿæˆçš„ class æ–‡ä»¶åæ±‡ç¼–è‡³ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œç„¶åæ‰¾åˆ° boolean flag = true å¯¹åº”çš„å­—èŠ‚ç åºåˆ—ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„ä¸¤ä¸ªã€‚</p>
<pre tabindex="0"><code>iconst_1;
istore_1;
</code></pre><p>å°†è¿™é‡Œçš„ iconst_1 æ”¹ä¸º iconst_2[5]ï¼Œä¿å­˜åå†æ±‡ç¼–è‡³ class æ–‡ä»¶å³å¯å®Œæˆç¬¬ä¸€ç¯‡å®è·µç¯èŠ‚çš„éœ€æ±‚ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥åˆ©ç”¨è¿™ä¸€å¥—å·¥å…·æ¥éªŒè¯æˆ‘ä¹‹å‰æ–‡ç« ä¸­çš„ä¸€äº›ç»“è®ºã€‚æ¯”å¦‚æˆ‘è¯´è¿‡ class æ–‡ä»¶å…è®¸å‡ºç°å‚æ•°ç±»å‹ç›¸åŒã€è€Œè¿”å›ç±»å‹ä¸åŒçš„æ–¹æ³•ï¼Œå¹¶ä¸”ï¼Œåœ¨ä½œä¸ºåº“æ–‡ä»¶æ—¶ Java ç¼–è¯‘å™¨å°†ä½¿ç”¨å…ˆå®šä¹‰çš„é‚£ä¸€ä¸ªï¼Œæ¥å†³å®šå…·ä½“çš„è¿”å›ç±»å‹ã€‚</p>
<p>å…·ä½“çš„éªŒè¯æ–¹æ³•ä¾¿æ˜¯åœ¨åæ±‡ç¼–ä¹‹åï¼Œåˆ©ç”¨æ–‡æœ¬ç¼–è¾‘å·¥å…·å¤åˆ¶æŸä¸€æ–¹æ³•ï¼Œå¹¶ä¸”æ›´æ”¹è¯¥æ–¹æ³•çš„æè¿°ç¬¦ï¼Œä¿å­˜åå†æ±‡ç¼–è‡³ class æ–‡ä»¶ã€‚</p>
<p>Code Tools é¡¹ç›®è¿˜åŒ…å«å¦ä¸€ä¸ªå®ç”¨çš„å°å·¥å…· JOL[6]ï¼Œå½“å‰ 0.9 ç‰ˆæœ¬çš„ä¸‹è½½åœ°å€ä½äº [7]ã€‚JOL å¯ç”¨äºæŸ¥é˜… Java è™šæ‹Ÿæœºä¸­å¯¹è±¡çš„å†…å­˜åˆ†å¸ƒï¼Œå…·ä½“å¯é€šè¿‡å¦‚ä¸‹ä¸¤æ¡æŒ‡ä»¤æ¥å®ç°ã€‚</p>
<pre tabindex="0"><code>$ java -jar /path/to/jol-cli-0.9-full.jar internals java.util.HashMap
$ java -jar /path/to/jol-cli-0.9-full.jar estimates java.util.HashMap
</code></pre><h2 id="3asmjava-å­—èŠ‚ç æ¡†æ¶">3.ASMï¼šJava å­—èŠ‚ç æ¡†æ¶</h2>
<p>ASM[8] æ˜¯ä¸€ä¸ªå­—èŠ‚ç åˆ†æåŠä¿®æ”¹æ¡†æ¶ã€‚å®ƒè¢«å¹¿æ³›åº”ç”¨äºè®¸å¤šé¡¹ç›®ä¹‹ä¸­ï¼Œä¾‹å¦‚ Groovyã€Kotlin çš„ç¼–è¯‘å™¨ï¼Œä»£ç è¦†ç›–æµ‹è¯•å·¥å…· Coberturaã€JaCoCoï¼Œä»¥åŠå„å¼å„æ ·é€šè¿‡å­—èŠ‚ç æ³¨å…¥å®ç°çš„ç¨‹åºè¡Œä¸ºç›‘æ§å·¥å…·ã€‚ç”šè‡³æ˜¯ Java 8 ä¸­ Lambda è¡¨è¾¾å¼çš„é€‚é…å™¨ç±»ï¼Œä¹Ÿæ˜¯å€ŸåŠ© ASM æ¥åŠ¨æ€ç”Ÿæˆçš„ã€‚</p>
<p>ASM æ—¢å¯ä»¥ç”Ÿæˆæ–°çš„ class æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹å·²æœ‰çš„ class æ–‡ä»¶ã€‚å‰è€…ç›¸å¯¹æ¯”è¾ƒç®€å•ä¸€äº›ã€‚ASM ç”šè‡³è¿˜æä¾›äº†ä¸€ä¸ªè¾…åŠ©ç±» ASMifierï¼Œå®ƒå°†æ¥æ”¶ä¸€ä¸ª class æ–‡ä»¶å¹¶ä¸”è¾“å‡ºä¸€æ®µç”Ÿæˆè¯¥ class æ–‡ä»¶åŸå§‹å­—èŠ‚æ•°ç»„çš„ä»£ç ã€‚å¦‚æœä½ æƒ³å¿«é€Ÿä¸Šæ‰‹ ASM çš„è¯ï¼Œé‚£ä¹ˆä½ å¯ä»¥å€ŸåŠ© ASMifier ç”Ÿæˆçš„ä»£ç æ¥æ¢ç´¢å„ä¸ª API çš„ç”¨æ³•ã€‚</p>
<p>ä¸‹é¢æˆ‘å°†å€ŸåŠ© ASMifierï¼Œæ¥ç”Ÿæˆç¬¬ä¸€ç¯‡å®è·µç¯èŠ‚æ‰€ç”¨åˆ°çš„ç±»ã€‚ï¼ˆä½ å¯ä»¥é€šè¿‡è¯¥åœ°å€ [9] ä¸‹è½½ 6.0-beta ç‰ˆã€‚ï¼‰</p>
<pre tabindex="0"><code>$ echo '
public class Foo {
 public static void main(String[] args) {
  boolean flag = true;
  if (flag) System.out.println(&quot;Hello, Java!&quot;);
  if (flag == true) System.out.println(&quot;Hello, JVM!&quot;);
 }
}' &gt; Foo.java
# è¿™é‡Œçš„ javac æˆ‘ä½¿ç”¨çš„æ˜¯ Java 8 ç‰ˆæœ¬çš„ã€‚ASM 6.0 å¯èƒ½æš‚ä¸æ”¯æŒæ–°ç‰ˆæœ¬çš„ javac ç¼–è¯‘å‡ºæ¥çš„ class æ–‡ä»¶
$ javac Foo.java
$ java -cp /PATH/TO/asm-all-6.0_BETA.jar org.objectweb.asm.util.ASMifier Foo.class | tee FooDump.java
...
public class FooDump implements Opcodes {
 
public static byte[] dump () throws Exception {
 
ClassWriter cw = new ClassWriter(0);
FieldVisitor fv;
MethodVisitor mv;
AnnotationVisitor av0;
 
cw.visit(V1_8, ACC_PUBLIC + ACC_SUPER, &quot;Foo&quot;, null, &quot;java/lang/Object&quot;, null);
 
...
 
{
mv = cw.visitMethod(ACC_PUBLIC + ACC_STATIC, &quot;main&quot;, &quot;([Ljava/lang/String;)V&quot;, null, null);
mv.visitCode();
mv.visitInsn(ICONST_1);
mv.visitVarInsn(ISTORE, 1);
mv.visitVarInsn(ILOAD, 1);
...
mv.visitInsn(RETURN);
mv.visitMaxs(2, 2);
mv.visitEnd();
}
...
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒASMifier ç”Ÿæˆçš„ä»£ç ä¸­åŒ…å«ä¸€ä¸ªåä¸º FooDump çš„ç±»ï¼Œå…¶ä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸º dump çš„æ–¹æ³•ã€‚è¯¥æ–¹æ³•å°†è¿”å›ä¸€ä¸ª byte æ•°ç»„ï¼Œå…¶å€¼ä¸ºç”Ÿæˆç±»çš„åŸå§‹å­—èŠ‚ã€‚</p>
<p>åœ¨ dump æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ–°å»ºäº†åŠŸèƒ½ç±» ClassWriter çš„ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶é€šè¿‡å®ƒæ¥è®¿é—®ä¸åŒçš„æˆå‘˜ï¼Œä¾‹å¦‚æ–¹æ³•ã€å­—æ®µç­‰ç­‰ã€‚</p>
<p>æ¯å½“è®¿é—®ä¸€ç§æˆå‘˜ï¼Œæˆ‘ä»¬ä¾¿ä¼šå¾—åˆ°å¦ä¸€ä¸ªè®¿é—®è€…ã€‚åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œå½“æˆ‘ä»¬è®¿é—®æ–¹æ³•æ—¶ï¼ˆå³ visitMethodï¼‰ï¼Œä¾¿ä¼šå¾—åˆ°ä¸€ä¸ª MethodVisitorã€‚åœ¨æ¥ä¸‹æ¥çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¼šç”¨è¿™ä¸ª MethodVisitor æ¥è®¿é—®ï¼ˆè¿™é‡Œç­‰åŒäºç”Ÿæˆï¼‰å…·ä½“çš„æŒ‡ä»¤ã€‚</p>
<p>è¿™ä¾¿æ˜¯ ASM æ‰€ä½¿ç”¨çš„è®¿é—®è€…æ¨¡å¼ã€‚å½“ç„¶ï¼Œè¿™æ®µä»£ç ä»…åŒ…å« ClassWriter è¿™ä¸€ä¸ªè®¿é—®è€…ï¼Œå› æ­¤çœ‹ä¸å‡ºå…·ä½“æœ‰ä»€ä¹ˆå¥½å¤„ã€‚</p>
<p>æˆ‘ä»¬æš‚ä¸”ä¸ç®¡è¿™ä¸ªè®¿é—®è€…æ¨¡å¼ï¼Œå…ˆæ¥çœ‹çœ‹å¦‚ä½•å®ç°ç¬¬ä¸€ç¯‡è¯¾åå®è·µçš„è¦æ±‚ã€‚é¦–å…ˆï¼Œmain æ–¹æ³•ä¸­çš„ boolean flag = true; è¯­å¥å¯¹åº”çš„ä»£ç æ˜¯ï¼š</p>
<pre tabindex="0"><code>mv.visitInsn(ICONST_1);
mv.visitVarInsn(ISTORE, 1);
</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªéœ€å°†è¿™é‡Œçš„ ICONST_1 æ›´æ”¹ä¸º ICONST_2ï¼Œä¾¿å¯ä»¥æ»¡è¶³è¦æ±‚ã€‚ä¸‹é¢æˆ‘ç”¨å¦ä¸€ä¸ªç±» Wrapperï¼Œæ¥è°ƒç”¨ä¿®æ”¹è¿‡åçš„ FooDump.dump æ–¹æ³•ã€‚</p>
<pre tabindex="0"><code>$ echo 'import java.nio.file.*;
 
public class Wrapper {
  public static void main(String[] args) throws Exception {
    Files.write(Paths.get(&quot;Foo.class&quot;), FooDump.dump());
  }
}' &gt; Wrapper.java
$ javac -cp /PATH/TO/asm-all-6.0_BETA.jar FooDump.java Wrapper.java
$ java -cp /PATH/TO/asm-all-6.0_BETA.jar:. Wrapper
$ java Foo
</code></pre><p>è¿™é‡Œçš„è¾“å‡ºç»“æœåº”å’Œé€šè¿‡ ASMTools ä¿®æ”¹çš„ç»“æœä¸€è‡´ã€‚</p>
<p>é€šè¿‡ ASM æ¥ä¿®æ”¹å·²æœ‰ class æ–‡ä»¶åˆ™ç›¸å¯¹å¤æ‚ä¸€äº›ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥ä»ä¸‹é¢è¿™æ®µç®€å•çš„ä»£ç æ¥å¼€å§‹å­¦èµ·ï¼š</p>
<pre tabindex="0"><code>  public static void main(String[] args) throws Exception {
    ClassReader cr = new ClassReader(&quot;Foo&quot;);
    ClassWriter cw = new ClassWriter(ClassWriter.COMPUTE_FRAMES);
    cr.accept(cw, ClassReader.SKIP_FRAMES);
    Files.write(Paths.get(&quot;Foo.class&quot;), cw.toByteArray());
  }
</code></pre><p>è¿™æ®µä»£ç çš„åŠŸèƒ½ä¾¿æ˜¯è¯»å–ä¸€ä¸ª class æ–‡ä»¶ï¼Œå°†ä¹‹è½¬æ¢ä¸º ASM çš„æ•°æ®ç»“æ„ï¼Œç„¶åå†è½¬æ¢ä¸ºåŸå§‹å­—èŠ‚æ•°ç»„ã€‚å…¶ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†ä¸¤ä¸ªåŠŸèƒ½ç±»ã€‚é™¤äº†å·²ç»ä»‹ç»è¿‡çš„ ClassWriter å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª ClassReaderã€‚</p>
<p>ClassReader å°†è¯»å–â€œFooâ€ç±»çš„åŸå§‹å­—èŠ‚ï¼Œå¹¶ä¸”ç¿»è¯‘æˆå¯¹åº”çš„è®¿é—®è¯·æ±‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸Šé¢ ASMifier ç”Ÿæˆçš„ä»£ç ä¸­çš„å„ä¸ªè®¿é—®æ“ä½œï¼Œç°åœ¨éƒ½äº¤ç»™ ClassReader.accept è¿™ä¸€æ–¹æ³•æ¥å‘å‡ºäº†ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚ä½•ä¿®æ”¹è¿™ä¸ª class æ–‡ä»¶çš„å­—èŠ‚ç å‘¢ï¼ŸåŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯å°† ClassReader çš„è®¿é—®è¯·æ±‚å‘ç»™å¦å¤–ä¸€ä¸ªè®¿é—®è€…ï¼Œå†ç”±è¿™ä¸ªè®¿é—®è€…å§”æ´¾ç»™ ClassWriterã€‚</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œæ–°å¢æ“ä½œå¯ä»¥é€šè¿‡åœ¨æŸä¸€éœ€è¦è½¬å‘çš„è¯·æ±‚åé¢é™„å¸¦æ–°çš„è¯·æ±‚æ¥å®ç°ï¼›åˆ é™¤æ“ä½œå¯ä»¥é€šè¿‡ä¸è½¬å‘è¯·æ±‚æ¥å®ç°ï¼›ä¿®æ”¹æ“ä½œå¯ä»¥é€šè¿‡å¿½ç•¥åŸè¯·æ±‚ï¼Œæ–°å»ºå¹¶å‘å‡ºå¦å¤–çš„è¯·æ±‚æ¥å®ç°ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA/assets/2a5d6813e32b8f88abae2b9f7b151fce.png" alt="img"></p>
<pre tabindex="0"><code>import java.nio.file.*;
import org.objectweb.asm.*;
 
public class ASMHelper implements Opcodes {
 
  static class MyMethodVisitor extends MethodVisitor {
    private MethodVisitor mv;
    public MyMethodVisitor(int api, MethodVisitor mv) {
      super(api, null);
      this.mv = mv;
    }
 
    @Override
    public void visitCode() {
      mv.visitCode();
      mv.visitFieldInsn(GETSTATIC, &quot;java/lang/System&quot;, &quot;out&quot;, &quot;Ljava/io/PrintStream;&quot;);
      mv.visitLdcInsn(&quot;Hello, World!&quot;);
      mv.visitMethodInsn(INVOKEVIRTUAL, &quot;java/io/PrintStream&quot;, &quot;println&quot;, &quot;(Ljava/lang/String;)V&quot;, false);
      mv.visitInsn(RETURN);
      mv.visitMaxs(2, 1);
      mv.visitEnd();
    }
  }
 
  static class MyClassVisitor extends ClassVisitor {
 
    public MyClassVisitor(int api, ClassVisitor cv) {
      super(api, cv);
    }
 
    @Override
    public MethodVisitor visitMethod(int access, String name, String descriptor, String signature,
        String[] exceptions) {
      MethodVisitor visitor = super.visitMethod(access, name, descriptor, signature, exceptions);
      if (&quot;main&quot;.equals(name)) {
        return new MyMethodVisitor(ASM6, visitor);
      }
      return visitor;
    }
  }
 
  public static void main(String[] args) throws Exception {
    ClassReader cr = new ClassReader(&quot;Foo&quot;);
    ClassWriter cw = new ClassWriter(ClassWriter.COMPUTE_FRAMES);
    ClassVisitor cv = new MyClassVisitor(ASM6, cw);
    cr.accept(cv, ClassReader.SKIP_FRAMES);
    Files.write(Paths.get(&quot;Foo.class&quot;), cw.toByteArray());
  }
}
</code></pre><p>è¿™é‡Œæˆ‘è´´äº†ä¸€æ®µä»£ç ï¼Œåœ¨ ClassReader å’Œ ClassWriter ä¸­é—´æ’å…¥äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„è®¿é—®è€… MyClassVisitorã€‚å®ƒå°†æˆªè·ç”± ClassReader å‘å‡ºçš„å¯¹åå­—ä¸ºâ€œmainâ€çš„æ–¹æ³•çš„è®¿é—®è¯·æ±‚ï¼Œå¹¶ä¸”æ›¿æ¢ä¸ºå¦ä¸€ä¸ªè‡ªå®šä¹‰çš„ MethodVisitorã€‚</p>
<p>è¿™ä¸ª MethodVisitor ä¼šå¿½ç•¥ç”± ClassReader å‘å‡ºçš„ä»»ä½•è¯·æ±‚ï¼Œä»…åœ¨é‡åˆ° visitCode è¯·æ±‚æ—¶ï¼Œç”Ÿæˆä¸€å¥â€œSystem.out.println(â€œHello World!â€);â€ã€‚</p>
<p>ç”±äºç¯‡å¹…çš„é™åˆ¶ï¼Œæˆ‘å°±ä¸ç»§ç»­æ·±å…¥ä»‹ç»ä¸‹å»äº†ã€‚å¦‚æœä½ å¯¹ ASM æœ‰æµ“åšçš„å…´è¶£ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ•™ç¨‹ [10]ã€‚</p>
<p>ä½ å¯¹è¿™äº›å¸¸ç”¨å·¥å…·è¿˜æœ‰å“ªäº›é—®é¢˜å‘¢ï¼Ÿå¯ä»¥ç»™æˆ‘ç•™è¨€ï¼Œæˆ‘ä»¬ä¸€èµ·è®¨è®ºã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ã€‚</p>
<p>[1] <a href="https://docs.oracle.com/javase/specs/jvms/se10/html/jvms-4.html#jvms-4.1">https://docs.oracle.com/javase/specs/jvms/se10/html/jvms-4.html#jvms-4.1</a> [2] <a href="http://openjdk.java.net/projects/code-tools/">http://openjdk.java.net/projects/code-tools/</a> [3] <a href="https://wiki.openjdk.java.net/display/CodeTools/asmtools">https://wiki.openjdk.java.net/display/CodeTools/asmtools</a> [4] <a href="https://adopt-openjdk.ci.cloudbees.com/view/OpenJDK/job/asmtools/lastSuccessfulBuild/artifact/asmtools-6.0.tar.gz">https://adopt-openjdk.ci.cloudbees.com/view/OpenJDK/job/asmtools/lastSuccessfulBuild/artifact/asmtools-6.0.tar.gz</a> [5] <a href="https://cs.au.dk/~mis/dOvs/jvmspec/ref--21.html">https://cs.au.dk/~mis/dOvs/jvmspec/ref--21.html</a> [6] <a href="http://openjdk.java.net/projects/code-tools/jol/">http://openjdk.java.net/projects/code-tools/jol/</a> [7] <a href="http://central.maven.org/maven2/org/openjdk/jol/jol-cli/0.9/jol-cli-0.9-full.jar">http://central.maven.org/maven2/org/openjdk/jol/jol-cli/0.9/jol-cli-0.9-full.jar</a> [8] <a href="https://asm.ow2.io/">https://asm.ow2.io/</a> [9] <a href="https://repository.ow2.org/nexus/content/repositories/releases/org/ow2/asm/asm-all/6.0">https://repository.ow2.org/nexus/content/repositories/releases/org/ow2/asm/asm-all/6.0</a>_BETA/asm-all-6.0_BETA.jar [10] <a href="http://web.cs.ucla.edu/~msb/cs239-tutorial/">http://web.cs.ucla.edu/~msb/cs239-tutorial/</a></p>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%8B%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA/%E5%B0%BE%E5%A3%B0%E4%B8%A8%E9%81%93%E9%98%BB%E4%B8%94%E9%95%BF%E5%8A%AA%E5%8A%9B%E5%8A%A0%E9%A4%90.html/"><span>å°¾å£°ä¸¨é“é˜»ä¸”é•¿ï¼ŒåŠªåŠ›åŠ é¤.html</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/java/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAjava%E8%99%9A%E6%8B%9F%E6%9C%BA/00-%E5%BC%80%E7%AF%87%E8%AF%8Djvm%E4%B8%80%E5%9D%97%E9%9A%BE%E5%95%83%E7%9A%84%E9%AA%A8%E5%A4%B4/"><span>00 å¼€ç¯‡è¯ï¼šJVMï¼Œä¸€å—éš¾å•ƒçš„éª¨å¤´</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 27270 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>