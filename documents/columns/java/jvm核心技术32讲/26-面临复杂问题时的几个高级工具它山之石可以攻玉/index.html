<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>26 é¢ä¸´å¤æ‚é—®é¢˜æ—¶çš„å‡ ä¸ªé«˜çº§å·¥å…·ï¼šå®ƒå±±ä¹‹çŸ³ï¼Œå¯ä»¥æ”»ç‰ | Yipsen Ye</title>
<meta name="description" content="å‰é¢æåˆ°äº†å¾ˆå¤š JVM çš„åˆ†æå·¥å…·ï¼Œæœ¬èŠ‚é‡Œæˆ‘ä»¬ä¼šå†ä»‹ç»å‡ ç§æœ‰ç”¨çš„å·¥å…·ï¼Œå¤§å®¶å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™æŒ‰éœ€ä½¿ç”¨ã€‚
OOM Killer åœ¨å‰é¢çš„ç« èŠ‚ï¼Œæˆ‘ä»¬ç®€å•æåŠè¿‡ Linux ç³»ç»Ÿä¸Šçš„ OOM Killerï¼ˆOut Of Memory killerï¼ŒOOM ç»ˆç»“è€…ï¼‰ã€‚å‡å¦‚ç‰©ç†å†…å­˜ä¸è¶³ï¼ŒLinux ä¼šæ‰¾å‡ºâ€œä¸€å¤´æ¯”è¾ƒå£®çš„è¿›ç¨‹â€æ¥æ€æ‰ã€‚
OOM Killer å‚æ•°è°ƒä¼˜ Java çš„å †å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰ï¼Œæ˜¯æŒ‡å †å†…å­˜ç”¨æ»¡äº†ï¼ŒGC æ²¡æ³•å›æ”¶å¯¼è‡´åˆ†é…ä¸äº†æ–°çš„å¯¹è±¡ã€‚
è€Œæ“ä½œç³»ç»Ÿçš„å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰ï¼Œåˆ™æ˜¯æŒ‡è®¡ç®—æœºæ‰€æœ‰çš„å†…å­˜ï¼ˆç‰©ç†å†…å­˜ &#43; äº¤æ¢ç©ºé—´ï¼‰ï¼Œéƒ½è¢«ä½¿ç”¨æ»¡äº†ã€‚
è¿™ç§æƒ…å†µä¸‹ï¼Œé»˜è®¤é…ç½®ä¼šå¯¼è‡´ç³»ç»ŸæŠ¥è­¦ï¼Œå¹¶åœæ­¢æ­£å¸¸è¿è¡Œã€‚å½“ç„¶ï¼Œå°† /proc/sys/vm/panic_on_oom å‚æ•°è®¾ç½®ä¸º 0 ä¹‹åï¼Œåˆ™ç³»ç»Ÿå†…æ ¸ä¼šåœ¨å‘ç”Ÿå†…å­˜æº¢å‡ºæ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨ OOM Killer åŠŸèƒ½ï¼Œæ¥æ€æ‰æœ€å£®å®çš„é‚£å¤´è¿›ç¨‹ï¼ˆRogue Processï¼Œæµæ°“è¿›ç¨‹ï¼‰ï¼Œè¿™æ ·ç³»ç»Ÿä¹Ÿè®¸å°±å¯ä»¥ç»§ç»­è¿è¡Œäº†ã€‚
ä»¥ä¸‹å‚æ•°å¯ä»¥åŸºäºå•ä¸ªè¿›ç¨‹è¿›è¡Œè®¾ç½®ï¼Œä»¥æ‰‹å·¥æ§åˆ¶å“ªäº›è¿›ç¨‹å¯ä»¥è¢« OOM Killer ç»ˆç»“ã€‚è¿™äº›å‚æ•°ä½äº proc æ–‡ä»¶ç³»ç»Ÿä¸­çš„ /proc/pid/ ç›®å½•ä¸‹ï¼Œå…¶ä¸­ pid æ˜¯æŒ‡è¿›ç¨‹çš„ IDã€‚
 oom_adjï¼šæ­£å¸¸èŒƒå›´æ˜¯ -16 åˆ° 15ï¼Œç”¨äºè®¡ç®—ä¸€ä¸ªè¿›ç¨‹çš„ OOM è¯„åˆ†ï¼ˆoom_scoreï¼‰ã€‚è¿™ä¸ªåˆ†å€¼è¶Šé«˜ï¼Œè¯¥è¿›ç¨‹è¶Šæœ‰å¯èƒ½è¢« OOM Killer ç»™å¹²æ‰ã€‚å¦‚æœè®¾ç½®ä¸º -17ï¼Œåˆ™ç¦æ­¢ OOM Killer æ€æ­»è¯¥è¿›ç¨‹ã€‚ proc æ–‡ä»¶ç³»ç»Ÿæ˜¯è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ŒæŸä¸ªè¿›ç¨‹è¢«æ€æ‰ï¼Œåˆ™ /proc/pid/ ç›®å½•ä¹Ÿå°±è¢«é”€æ¯äº†ã€‚  OOM Killer å‚æ•°è°ƒæ•´ç¤ºä¾‹ ä¾‹å¦‚è¿›ç¨‹çš„ pid=12884ï¼Œroot ç”¨æˆ·æ‰§è¡Œï¼š
$ cat /proc/12884/oom_adj0# æŸ¥çœ‹æœ€ç»ˆå¾—åˆ†$ cat /proc/12884/oom_score161$ cat /proc/12884/oom_score_adj 0# ä¿®æ”¹åˆ†å€¼ .">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/jvm%e6%a0%b8%e5%bf%83%e6%8a%80%e6%9c%af32%e8%ae%b2/">JVMæ ¸å¿ƒæŠ€æœ¯32è®²</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/01-%E9%98%85%E8%AF%BB%E6%AD%A4%E4%B8%93%E6%A0%8F%E7%9A%84%E6%AD%A3%E7%A1%AE%E5%A7%BF%E5%8A%BF/">01 é˜…è¯»æ­¤ä¸“æ çš„æ­£ç¡®å§¿åŠ¿</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/02-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E5%8D%83%E9%87%8C%E4%B9%8B%E8%A1%8C%E5%A7%8B%E4%BA%8E%E8%B6%B3%E4%B8%8B/">02 ç¯å¢ƒå‡†å¤‡ï¼šåƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/03-%E5%B8%B8%E7%94%A8%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%E6%B2%A1%E6%9C%89%E9%87%8F%E5%8C%96%E5%B0%B1%E6%B2%A1%E6%9C%89%E6%94%B9%E8%BF%9B/">03 å¸¸ç”¨æ€§èƒ½æŒ‡æ ‡ï¼šæ²¡æœ‰é‡åŒ–ï¼Œå°±æ²¡æœ‰æ”¹è¿›</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/04-jvm-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%8D%E7%A7%AF%E8%B7%AC%E6%AD%A5%E6%97%A0%E4%BB%A5%E8%87%B3%E5%8D%83%E9%87%8C/">04 JVM åŸºç¡€çŸ¥è¯†ï¼šä¸ç§¯è·¬æ­¥ï¼Œæ— ä»¥è‡³åƒé‡Œ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/05-java-%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF%E4%B8%8D%E7%A7%AF%E7%BB%86%E6%B5%81%E6%97%A0%E4%BB%A5%E6%88%90%E6%B1%9F%E6%B2%B3/">05 Java å­—èŠ‚ç æŠ€æœ¯ï¼šä¸ç§¯ç»†æµï¼Œæ— ä»¥æˆæ±Ÿæ²³</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/06-java-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%B1%B1%E4%B8%8D%E8%BE%9E%E5%9C%9F%E6%95%85%E8%83%BD%E6%88%90%E5%85%B6%E9%AB%98/">06 Java ç±»åŠ è½½å™¨ï¼šå±±ä¸è¾åœŸï¼Œæ•…èƒ½æˆå…¶é«˜</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/07-java-%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E6%B5%B7%E4%B8%8D%E8%BE%9E%E6%B0%B4%E6%95%85%E8%83%BD%E6%88%90%E5%85%B6%E6%B7%B1/">07 Java å†…å­˜æ¨¡å‹ï¼šæµ·ä¸è¾æ°´ï¼Œæ•…èƒ½æˆå…¶æ·±</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/08-jvm-%E5%90%AF%E5%8A%A8%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3%E5%8D%9A%E8%A7%82%E8%80%8C%E7%BA%A6%E5%8F%96%E5%8E%9A%E7%A7%AF%E8%80%8C%E8%96%84%E5%8F%91/">08 JVM å¯åŠ¨å‚æ•°è¯¦è§£ï¼šåšè§‚è€Œçº¦å–ã€åšç§¯è€Œè–„å‘</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/09-jdk-%E5%86%85%E7%BD%AE%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E5%B7%A5%E6%AC%B2%E5%96%84%E5%85%B6%E4%BA%8B%E5%BF%85%E5%85%88%E5%88%A9%E5%85%B6%E5%99%A8/">09 JDK å†…ç½®å‘½ä»¤è¡Œå·¥å…·ï¼šå·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/10-jdk-%E5%86%85%E7%BD%AE%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2%E5%B7%A5%E5%85%B7%E6%B5%B7%E9%98%94%E5%87%AD%E9%B1%BC%E8%B7%83%E5%A4%A9%E9%AB%98%E4%BB%BB%E9%B8%9F%E9%A3%9E/">10 JDK å†…ç½®å›¾å½¢ç•Œé¢å·¥å…·ï¼šæµ·é˜”å‡­é±¼è·ƒï¼Œå¤©é«˜ä»»é¸Ÿé£</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/11-jdwp-%E7%AE%80%E4%BB%8B%E5%8D%81%E6%AD%A5%E6%9D%80%E4%B8%80%E4%BA%BA%E5%8D%83%E9%87%8C%E4%B8%8D%E7%95%99%E8%A1%8C/">11 JDWP ç®€ä»‹ï¼šåæ­¥æ€ä¸€äººï¼Œåƒé‡Œä¸ç•™è¡Œ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/12-jmx-%E4%B8%8E%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7%E5%B1%B1%E9%AB%98%E6%9C%88%E5%B0%8F%E6%B0%B4%E8%90%BD%E7%9F%B3%E5%87%BA/">12 JMX ä¸ç›¸å…³å·¥å…·ï¼šå±±é«˜æœˆå°ï¼Œæ°´è½çŸ³å‡º</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/13-%E5%B8%B8%E8%A7%81%E7%9A%84-gc-%E7%AE%97%E6%B3%95gc-%E7%9A%84%E8%83%8C%E6%99%AF%E4%B8%8E%E5%8E%9F%E7%90%86/">13 å¸¸è§çš„ GC ç®—æ³•ï¼ˆGC çš„èƒŒæ™¯ä¸åŸç†ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/14-%E5%B8%B8%E8%A7%81%E7%9A%84-gc-%E7%AE%97%E6%B3%95parallelcmsg1/">14 å¸¸è§çš„ GC ç®—æ³•ï¼ˆParallelCMSG1ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/15-java11-zgc-%E5%92%8C-java12-shenandoah-%E4%BB%8B%E7%BB%8D%E8%8B%9F%E6%97%A5%E6%96%B0%E6%97%A5%E6%97%A5%E6%96%B0%E5%8F%88%E6%97%A5%E6%96%B0/">15 Java11 ZGC å’Œ Java12 Shenandoah ä»‹ç»ï¼šè‹Ÿæ—¥æ–°ã€æ—¥æ—¥æ–°ã€åˆæ—¥æ–°</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/16-oracle-graalvm-%E4%BB%8B%E7%BB%8D%E4%BC%9A%E5%BD%93%E5%87%8C%E7%BB%9D%E9%A1%B6%E4%B8%80%E8%A7%88%E4%BC%97%E5%B1%B1%E5%B0%8F/">16 Oracle GraalVM ä»‹ç»ï¼šä¼šå½“å‡Œç»é¡¶ã€ä¸€è§ˆä¼—å±±å°</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/17-gc-%E6%97%A5%E5%BF%97%E8%A7%A3%E8%AF%BB%E4%B8%8E%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/">17 GC æ—¥å¿—è§£è¯»ä¸åˆ†æï¼ˆåŸºç¡€é…ç½®ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/18-gc-%E6%97%A5%E5%BF%97%E8%A7%A3%E8%AF%BB%E4%B8%8E%E5%88%86%E6%9E%90%E5%AE%9E%E4%BE%8B%E5%88%86%E6%9E%90%E4%B8%8A%E7%AF%87/">18 GC æ—¥å¿—è§£è¯»ä¸åˆ†æï¼ˆå®ä¾‹åˆ†æä¸Šç¯‡ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/19-gc-%E6%97%A5%E5%BF%97%E8%A7%A3%E8%AF%BB%E4%B8%8E%E5%88%86%E6%9E%90%E5%AE%9E%E4%BE%8B%E5%88%86%E6%9E%90%E4%B8%AD%E7%AF%87/">19 GC æ—¥å¿—è§£è¯»ä¸åˆ†æï¼ˆå®ä¾‹åˆ†æä¸­ç¯‡ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/20-gc-%E6%97%A5%E5%BF%97%E8%A7%A3%E8%AF%BB%E4%B8%8E%E5%88%86%E6%9E%90%E5%AE%9E%E4%BE%8B%E5%88%86%E6%9E%90%E4%B8%8B%E7%AF%87/">20 GC æ—¥å¿—è§£è¯»ä¸åˆ†æï¼ˆå®ä¾‹åˆ†æä¸‹ç¯‡ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/21-gc-%E6%97%A5%E5%BF%97%E8%A7%A3%E8%AF%BB%E4%B8%8E%E5%88%86%E6%9E%90%E7%95%AA%E5%A4%96%E7%AF%87%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7/">21 GC æ—¥å¿—è§£è¯»ä¸åˆ†æï¼ˆç•ªå¤–ç¯‡å¯è§†åŒ–å·¥å…·ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/22-jvm-%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%A0%86%E6%A0%88%E7%AD%89%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%93%8D%E5%8D%83%E6%9B%B2%E8%80%8C%E5%90%8E%E6%99%93%E5%A3%B0%E8%A7%82%E5%8D%83%E5%89%91%E8%80%8C%E5%90%8E%E8%AF%86%E5%99%A8/">22 JVM çš„çº¿ç¨‹å †æ ˆç­‰æ•°æ®åˆ†æï¼šæ“åƒæ›²è€Œåæ™“å£°ã€è§‚åƒå‰‘è€Œåè¯†å™¨</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/23-%E5%86%85%E5%AD%98%E5%88%86%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7%E4%B8%8A%E7%AF%87%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80%E4%B8%8E%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/">23 å†…å­˜åˆ†æä¸ç›¸å…³å·¥å…·ä¸Šç¯‡ï¼ˆå†…å­˜å¸ƒå±€ä¸åˆ†æå·¥å…·ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/24-%E5%86%85%E5%AD%98%E5%88%86%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7%E4%B8%8B%E7%AF%87%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/">24 å†…å­˜åˆ†æä¸ç›¸å…³å·¥å…·ä¸‹ç¯‡ï¼ˆå¸¸è§é—®é¢˜åˆ†æï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/25-fastthread-%E7%9B%B8%E5%85%B3%E7%9A%84%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D%E6%AC%B2%E7%A9%B7%E5%8D%83%E9%87%8C%E7%9B%AE%E6%9B%B4%E4%B8%8A%E4%B8%80%E5%B1%82%E6%A5%BC/">25 FastThread ç›¸å…³çš„å·¥å…·ä»‹ç»ï¼šæ¬²ç©·åƒé‡Œç›®ï¼Œæ›´ä¸Šä¸€å±‚æ¥¼</a></li>
                
                
                
                    <li>26 é¢ä¸´å¤æ‚é—®é¢˜æ—¶çš„å‡ ä¸ªé«˜çº§å·¥å…·ï¼šå®ƒå±±ä¹‹çŸ³ï¼Œå¯ä»¥æ”»ç‰</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/27-jvm-%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E5%88%86%E6%9E%90%E4%B8%8A%E7%AF%87%E8%B0%83%E4%BC%98%E7%BB%8F%E9%AA%8C/">27 JVM é—®é¢˜æ’æŸ¥åˆ†æä¸Šç¯‡ï¼ˆè°ƒä¼˜ç»éªŒï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/28-jvm-%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E5%88%86%E6%9E%90%E4%B8%8B%E7%AF%87%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%88%98/">28 JVM é—®é¢˜æ’æŸ¥åˆ†æä¸‹ç¯‡ï¼ˆæ¡ˆä¾‹å®æˆ˜ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/29-gc-%E7%96%91%E9%9A%BE%E6%83%85%E5%86%B5%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E4%B8%8E%E5%88%86%E6%9E%90%E4%B8%8A%E7%AF%87/">29 GC ç–‘éš¾æƒ…å†µé—®é¢˜æ’æŸ¥ä¸åˆ†æï¼ˆä¸Šç¯‡ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/30-gc-%E7%96%91%E9%9A%BE%E6%83%85%E5%86%B5%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E4%B8%8E%E5%88%86%E6%9E%90%E4%B8%8B%E7%AF%87/">30 GC ç–‘éš¾æƒ…å†µé—®é¢˜æ’æŸ¥ä¸åˆ†æï¼ˆä¸‹ç¯‡ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/31-jvm-%E7%9B%B8%E5%85%B3%E7%9A%84%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB%E8%BF%90%E7%AD%B9%E7%AD%96%E5%B8%B7%E5%B8%90%E4%B9%8B%E4%B8%AD%E5%86%B3%E8%83%9C%E4%BA%8E%E5%8D%83%E9%87%8C%E4%B9%8B%E5%A4%96/">31 JVM ç›¸å…³çš„å¸¸è§é¢è¯•é—®é¢˜æ±‡æ€»ï¼šè¿ç­¹ç­–å¸·å¸ä¹‹ä¸­ï¼Œå†³èƒœäºåƒé‡Œä¹‹å¤–</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/32-%E5%BA%94%E5%AF%B9%E5%AE%B9%E5%99%A8%E6%97%B6%E4%BB%A3%E9%9D%A2%E4%B8%B4%E7%9A%84%E6%8C%91%E6%88%98%E9%95%BF%E9%A3%8E%E7%A0%B4%E6%B5%AA%E4%BC%9A%E6%9C%89%E6%97%B6%E7%9B%B4%E6%8C%82%E4%BA%91%E5%B8%86%E6%B5%8E%E6%B2%A7%E6%B5%B7/">32 åº”å¯¹å®¹å™¨æ—¶ä»£é¢ä¸´çš„æŒ‘æˆ˜ï¼šé•¿é£ç ´æµªä¼šæœ‰æ—¶ã€ç›´æŒ‚äº‘å¸†æµæ²§æµ·</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">26 é¢ä¸´å¤æ‚é—®é¢˜æ—¶çš„å‡ ä¸ªé«˜çº§å·¥å…·ï¼šå®ƒå±±ä¹‹çŸ³ï¼Œå¯ä»¥æ”»ç‰</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2021-12-22 01:45:27</span>ğŸ·ï¸&nbsp;<a class="post-tag" href="/tags/java/">java</a></div><div class="post-category">
                
                ğŸ“š&nbsp;<a href="/categories/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/">JVMæ ¸å¿ƒæŠ€æœ¯32è®²</a>
                
            </div></div>
        <div class="post-content">
            <p>å‰é¢æåˆ°äº†å¾ˆå¤š JVM çš„åˆ†æå·¥å…·ï¼Œæœ¬èŠ‚é‡Œæˆ‘ä»¬ä¼šå†ä»‹ç»å‡ ç§æœ‰ç”¨çš„å·¥å…·ï¼Œå¤§å®¶å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™æŒ‰éœ€ä½¿ç”¨ã€‚</p>
<h3 id="oom-killer">OOM Killer</h3>
<p>åœ¨å‰é¢çš„ç« èŠ‚ï¼Œæˆ‘ä»¬ç®€å•æåŠè¿‡ Linux ç³»ç»Ÿä¸Šçš„ OOM Killerï¼ˆOut Of Memory killerï¼ŒOOM ç»ˆç»“è€…ï¼‰ã€‚å‡å¦‚ç‰©ç†å†…å­˜ä¸è¶³ï¼ŒLinux ä¼šæ‰¾å‡ºâ€œä¸€å¤´æ¯”è¾ƒå£®çš„è¿›ç¨‹â€æ¥æ€æ‰ã€‚</p>
<h4 id="oom-killer-å‚æ•°è°ƒä¼˜"><strong>OOM Killer å‚æ•°è°ƒä¼˜</strong></h4>
<p>Java çš„å †å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰ï¼Œæ˜¯æŒ‡å †å†…å­˜ç”¨æ»¡äº†ï¼ŒGC æ²¡æ³•å›æ”¶å¯¼è‡´åˆ†é…ä¸äº†æ–°çš„å¯¹è±¡ã€‚</p>
<p>è€Œæ“ä½œç³»ç»Ÿçš„å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰ï¼Œåˆ™æ˜¯æŒ‡è®¡ç®—æœºæ‰€æœ‰çš„å†…å­˜ï¼ˆç‰©ç†å†…å­˜ + äº¤æ¢ç©ºé—´ï¼‰ï¼Œéƒ½è¢«ä½¿ç”¨æ»¡äº†ã€‚</p>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œé»˜è®¤é…ç½®ä¼šå¯¼è‡´ç³»ç»ŸæŠ¥è­¦ï¼Œå¹¶åœæ­¢æ­£å¸¸è¿è¡Œã€‚å½“ç„¶ï¼Œå°† /proc/sys/vm/panic_on_oom å‚æ•°è®¾ç½®ä¸º 0 ä¹‹åï¼Œåˆ™ç³»ç»Ÿå†…æ ¸ä¼šåœ¨å‘ç”Ÿå†…å­˜æº¢å‡ºæ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨ OOM Killer åŠŸèƒ½ï¼Œæ¥æ€æ‰æœ€å£®å®çš„é‚£å¤´è¿›ç¨‹ï¼ˆRogue Processï¼Œæµæ°“è¿›ç¨‹ï¼‰ï¼Œè¿™æ ·ç³»ç»Ÿä¹Ÿè®¸å°±å¯ä»¥ç»§ç»­è¿è¡Œäº†ã€‚</p>
<p>ä»¥ä¸‹å‚æ•°å¯ä»¥åŸºäºå•ä¸ªè¿›ç¨‹è¿›è¡Œè®¾ç½®ï¼Œä»¥æ‰‹å·¥æ§åˆ¶å“ªäº›è¿›ç¨‹å¯ä»¥è¢« OOM Killer ç»ˆç»“ã€‚è¿™äº›å‚æ•°ä½äº proc æ–‡ä»¶ç³»ç»Ÿä¸­çš„ /proc/pid/ ç›®å½•ä¸‹ï¼Œå…¶ä¸­ pid æ˜¯æŒ‡è¿›ç¨‹çš„ IDã€‚</p>
<ul>
<li>oom_adjï¼šæ­£å¸¸èŒƒå›´æ˜¯ -16 åˆ° 15ï¼Œç”¨äºè®¡ç®—ä¸€ä¸ªè¿›ç¨‹çš„ OOM è¯„åˆ†ï¼ˆoom_scoreï¼‰ã€‚è¿™ä¸ªåˆ†å€¼è¶Šé«˜ï¼Œè¯¥è¿›ç¨‹è¶Šæœ‰å¯èƒ½è¢« OOM Killer ç»™å¹²æ‰ã€‚å¦‚æœè®¾ç½®ä¸º -17ï¼Œåˆ™ç¦æ­¢ OOM Killer æ€æ­»è¯¥è¿›ç¨‹ã€‚</li>
<li>proc æ–‡ä»¶ç³»ç»Ÿæ˜¯è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ŒæŸä¸ªè¿›ç¨‹è¢«æ€æ‰ï¼Œåˆ™ /proc/pid/ ç›®å½•ä¹Ÿå°±è¢«é”€æ¯äº†ã€‚</li>
</ul>
<h4 id="oom-killer-å‚æ•°è°ƒæ•´ç¤ºä¾‹"><strong>OOM Killer å‚æ•°è°ƒæ•´ç¤ºä¾‹</strong></h4>
<p>ä¾‹å¦‚è¿›ç¨‹çš„ <code>pid=12884</code>ï¼Œroot ç”¨æˆ·æ‰§è¡Œï¼š</p>
<pre tabindex="0"><code>$ cat /proc/12884/oom_adj
0

# æŸ¥çœ‹æœ€ç»ˆå¾—åˆ†
$ cat /proc/12884/oom_score
161

$ cat /proc/12884/oom_score_adj 
0

# ä¿®æ”¹åˆ†å€¼ ...
$ echo -17 &gt; /proc/12884/oom_adj

$ cat /proc/12884/oom_adj
-17

$ cat /proc/12884/oom_score
0
# æŸ¥çœ‹åˆ†å€¼ä¿®æ­£å€¼
$ cat /proc/12884/oom_score_adj 
-1000

# ä¿®æ”¹åˆ†å€¼
$ echo 15 &gt; /proc/12884/oom_adj

$ cat /proc/12884/oom_adj
15

$ cat /proc/12884/oom_score
1160

$ cat /proc/12884/oom_score_adj 
1000

</code></pre><p>è¿™æ ·é…ç½®ä¹‹åï¼Œå°±å…è®¸æŸä¸ªå ç”¨äº†æœ€å¤šèµ„æºçš„è¿›ç¨‹ï¼Œåœ¨æ“ä½œç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶ï¼Œä¹Ÿä¸ä¼šæ€æ‰ä»–ï¼Œè€Œæ˜¯å…ˆå»æ€åˆ«çš„è¿›ç¨‹ã€‚</p>
<h4 id="æ¡ˆä¾‹"><strong>æ¡ˆä¾‹</strong></h4>
<p>æˆ‘ä»¬é€šè¿‡ä»¥ä¸‹è¿™ä¸ªæ¡ˆä¾‹æ¥å±•ç¤º OOM Killerã€‚</p>
<p><strong>1. é—®é¢˜æè¿°</strong></p>
<p>æŸä¸ª Java åº”ç”¨ç»å¸¸æŒ‚æ‰ï¼ŒåŸå› ç–‘ä¼¼ Java è¿›ç¨‹è¢«æ€æ­»ã€‚</p>
<p><strong>2. é…ç½®ä¿¡æ¯</strong></p>
<p>é…ç½®å¦‚ä¸‹ï¼š</p>
<ul>
<li>æœåŠ¡å™¨ï¼šé˜¿é‡Œäº‘ ECS</li>
<li>IP åœ°å€ï¼š192.168.1.52</li>
<li>CPUï¼š4 æ ¸ï¼Œè™šæ‹Ÿ CPU Intel Xeon E5-2650 2.60GHz</li>
<li>ç‰©ç†å†…å­˜ï¼š8GB</li>
</ul>
<p><strong>3. å¯ç”¨å†…å­˜</strong></p>
<p>å†…å­˜ä¸è¶³ï¼š4 ä¸ª Java è¿›ç¨‹ï¼Œ2.1+1.7+1.7+1.3=6.8Gï¼Œå·²å ç”¨ç»å¤§éƒ¨åˆ†å†…å­˜ã€‚</p>
<p><strong>4. æŸ¥çœ‹æ—¥å¿—</strong></p>
<p>Linux ç³»ç»Ÿçš„ OOM Killer æ—¥å¿—ï¼š</p>
<pre tabindex="0"><code>sudo cat /var/log/messages | grep killer -A 2 -B 2

</code></pre><p>ç»æ’æŸ¥å‘ç°ï¼Œå…·æœ‰å¦‚ä¸‹æ—¥å¿—ï¼š</p>
<pre tabindex="0"><code>$ sudo cat /var/log/messages | grep killer -A 2 -B 2
May 21 09:55:01 web1 systemd: Started Session 500687 of user root.
May 21 09:55:02 web1 systemd: Starting Session 500687 of user root.
May 21 09:55:23 web1 kernel: java invoked oom-killer: gfp_mask=0x201daï¼Œorder=0ï¼Œoom_score_adj=0
May 21 09:55:24 web1 kernel: java cpuset=/ mems_allowed=0
May 21 09:55:24 web1 kernel: CPU: 3 PID: 25434 Comm: java Not tainted 3.10.0-514.6.2.el7.x86_64 #1
--
May 21 12:05:01 web1 systemd: Started Session 500843 of user root.
May 21 12:05:01 web1 systemd: Starting Session 500843 of user root.
May 21 12:05:22 web1 kernel: jstatd invoked oom-killer: gfp_mask=0x201daï¼Œorder=0ï¼Œoom_score_adj=0
May 21 12:05:22 web1 kernel: jstatd cpuset=/ mems_allowed=0
May 21 12:05:23 web1 kernel: CPU: 2 PID: 10467 Comm: jstatd Not tainted 3.10.0-514.6.2.el7.x86_64 #1

</code></pre><p>å¯ä»¥ç¡®å®šï¼Œç¡®å®æ˜¯ç‰©ç†å†…å­˜ä¸è¶³å¼•èµ·çš„ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šæ‰€æœ‰ Java è¿›ç¨‹çš„ <code>-Xmx</code> åŠ èµ·æ¥ï¼Œå¦‚æœå¤§äºç³»ç»Ÿçš„å‰©ä½™å†…å­˜ï¼Œå°±å¯èƒ½å‘ç”Ÿè¿™ç§æƒ…å†µã€‚</p>
</blockquote>
<p>æŸ¥è¯¢ç³»ç»Ÿæ‰€æœ‰è¿›ç¨‹çš„ oom_scoreï¼š</p>
<pre tabindex="0"><code>ps -eo pid,comm,pmem --sort -rss | awk '{&quot;cat /proc/&quot;$1&quot;/oom_score&quot; | getline oom; print $0&quot;\t&quot;oom}'

</code></pre><blockquote>
<p>é‡è¦æç¤ºï¼š</p>
<p>å¦‚æœè°ƒæ•´è¿‡æŸä¸ªè¿›ç¨‹çš„ oom_adj é…ç½®ï¼Œé‚£ä¹ˆç”±è¯¥è¿›ç¨‹åˆ›å»ºçš„æ‰€æœ‰è¿›ç¨‹ï¼Œéƒ½ä¼šç»§æ‰¿ oom_score åˆ†å€¼ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æŸä¸ª sshd è¿›ç¨‹å— OOM Killer çš„ä¿æŠ¤ï¼Œåˆ™æ‰€æœ‰çš„ SSH ä¼šè¯ä¹Ÿå°†å—åˆ°ä¿æŠ¤ã€‚è¿™æ ·çš„é…ç½®ï¼Œå¦‚æœå‘ç”Ÿ OOMï¼Œæœ‰å¯èƒ½ä¼šå½±å“ OOM Killer æ‹¯æ•‘ç³»ç»Ÿçš„åŠŸèƒ½ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬ç°åœ¨è®¾æƒ³ä¸€ä¸ªåœºæ™¯ï¼Œå‡å¦‚æˆ‘ä»¬æƒ³è¦éšæ—¶è°ƒè¯•è·Ÿè¸ªçº¿ä¸Šè¿è¡Œçš„ç³»ç»Ÿï¼Œéœ€è¦ç”¨ä»€ä¹ˆæ ·çš„å·¥å…·å‘¢ï¼Ÿä¸‹é¢å°±ä»‹ç» 2 æ¬¾è¿™æ ·çš„å·¥å…·ã€‚</p>
<h3 id="btrace-è¯Šæ–­åˆ†æå·¥å…·">BTrace è¯Šæ–­åˆ†æå·¥å…·</h3>
<p>BTrace æ˜¯åŸºäº Java è¯­è¨€çš„ä¸€æ¬¾åŠ¨æ€è¿½è¸ªå·¥å…·ï¼Œå¯ç”¨äºè¾…åŠ©é—®é¢˜è¯Šæ–­å’Œåˆ†æã€‚</p>
<p>BTrace é¡¹ç›®åœ°å€ï¼š</p>
<blockquote>
<p><a href="https://github.com/btraceio/btrace/">https://github.com/btraceio/btrace/</a></p>
</blockquote>
<p>åœ¨ <a href="https://github.com/btraceio/btrace/wiki">Wiki é¡µé¢</a> ä¸­æœ‰ä¸€äº›ç®€å•çš„ä»‹ç»ï¼š</p>
<blockquote>
<p>BTrace åŸºäº ASMã€Java Attach APIã€Instruments å¼€å‘ï¼Œæä¾›å¾ˆå¤šæ³¨è§£ã€‚é€šè¿‡è¿™äº›æ³¨è§£ï¼Œå¯ä»¥é€šè¿‡ Java ä»£ç æ¥ç¼–å†™ BTrace è„šæœ¬è¿›è¡Œåªè¯»ç›‘æ§ï¼Œè€Œæ— éœ€æ·±å…¥äº†è§£ ASM å¯¹å­—èŠ‚ç çš„æ“çºµã€‚</p>
</blockquote>
<p>ä¸‹é¢æˆ‘ä»¬æ¥å®é™…æ“ä½œä¸€ä¸‹ã€‚</p>
<h4 id="btrace-ä¸‹è½½"><strong>BTrace ä¸‹è½½</strong></h4>
<p>æ‰¾åˆ° <a href="https://github.com/btraceio/btrace/releases">Release é¡µé¢</a>ï¼Œæ‰¾åˆ°æœ€æ–°çš„å‹ç¼©åŒ…ä¸‹è½½ï¼š</p>
<ul>
<li><a href="https://github.com/btraceio/btrace/releases/download/v2.0.0/btrace-bin.tar.gz">btrace-bin.tar.gz</a></li>
<li><a href="https://github.com/btraceio/btrace/releases/download/v2.0.0/btrace-bin.zip">btrace-bin.zip</a></li>
</ul>
<p>ä¸‹è½½å®Œæˆåè§£å‹å³å¯ä½¿ç”¨ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/b12ba340-7808-11ea-b264-6326f7cc0e82" alt="1613271.png"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œbin ç›®å½•ä¸‹æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼Œsamples ç›®å½•ä¸‹æ˜¯è„šæœ¬ç¤ºä¾‹ã€‚</p>
<h4 id="ç¤ºä¾‹ç¨‹åº"><strong>ç¤ºä¾‹ç¨‹åº</strong></h4>
<p>æˆ‘ä»¬å…ˆç¼–å†™ä¸€ä¸ªæœ‰å…¥å‚æœ‰è¿”å›å€¼çš„æ–¹æ³•ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>package demo.jvm0209;
import java.util.UUID;
import java.util.concurrent.TimeUnit;
public class RandomSample {
    public static void main(String[] args) throws Exception {
        //
        int count = 10000;
        int seed = 0;
        for (int i = 0; i &lt; count; i++) {
            seed = randomHash(seed);
            TimeUnit.SECONDS.sleep(2);
        }
    }
    public static int randomHash(Integer seed) {
        String uuid = UUID.randomUUID().toString();
        int hashCode = uuid.hashCode();
        System.out.println(&quot;prev.seed=&quot; + seed);
        return hashCode;
    }
}

</code></pre><p>è¿™ä¸ªç¤ºä¾‹ç¨‹åºå¾ˆç®€å•ï¼Œå¾ªç¯å¾ˆå¤šæ¬¡è°ƒç”¨æŸä¸ªæ–¹æ³•ï¼Œä½¿ç”¨å…¶ä»–ç¨‹åºä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p>
<p>ç„¶åè¿è¡Œç¨‹åºï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°æ¯éš”ä¸€æ®µæ—¶é—´å°±æœ‰ä¸€äº›è¾“å‡ºï¼š</p>
<pre tabindex="0"><code>prev.seed=1601831031
...

</code></pre><p>BTrace æä¾›äº†å‘½ä»¤è¡Œå·¥å…·ï¼Œä½†ä½¿ç”¨èµ·ä¸å¦‚åœ¨ JVisualVM ä¸­æ–¹ä¾¿ï¼Œä¸‹é¢é€šè¿‡ JVisualVM ä¸­é›†æˆ BTrace æ’ä»¶è¿›è¡Œç®€å•çš„æ¼”ç¤ºã€‚</p>
<h4 id="jvisualvm-ç¯å¢ƒä¸­ä½¿ç”¨-btrace"><strong>JVisualVM ç¯å¢ƒä¸­ä½¿ç”¨ BTrace</strong></h4>
<p>å®‰è£… JVisualVM æ’ä»¶çš„æ“ä½œï¼Œæˆ‘ä»¬åœ¨å‰é¢çš„ç« èŠ‚ã€Š[JDK å†…ç½®å›¾å½¢ç•Œé¢å·¥å…·]ã€‹ä¸­ä»‹ç»è¿‡ã€‚</p>
<p>ç»†å¿ƒçš„åŒå­¦å¯èƒ½å·²ç»å‘ç°ï¼Œåœ¨å®‰è£… JVisualVM çš„æ’ä»¶æ—¶ï¼Œæœ‰ä¸€æ¬¾æ’ä»¶å«åšâ€œBTrace Workbenchâ€ã€‚å®‰è£…è¿™æ¬¾æ’ä»¶ä¹‹åï¼Œåœ¨å¯¹åº”çš„ JVM å®ä¾‹ä¸Šç‚¹å³é”®ï¼Œå°±å¯ä»¥è¿›å…¥ BTrace çš„æ“ä½œç•Œé¢ã€‚</p>
<p><strong>1. BTrace æ’ä»¶å®‰è£…</strong></p>
<p>æ‰“å¼€ VisualVMï¼Œé€‰æ‹©èœå•â€œå·¥å…·â€“æ’ä»¶(G)â€ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/d59e3c10-7808-11ea-8c74-b966eb0a8d67" alt="82699966.png"></p>
<p>ç„¶ååœ¨æ’ä»¶å®‰è£…ç•Œé¢ä¸­ï¼Œæ‰¾åˆ°â€œå¯ç”¨æ’ä»¶â€ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/0665b8f0-7809-11ea-8e11-89f2c26dd0be" alt="82770532.png"></p>
<p>å‹¾é€‰â€œBTrace Workbenchâ€ä¹‹åï¼Œç‚¹å‡»â€œå®‰è£…(I)â€æŒ‰é’®ã€‚</p>
<blockquote>
<p>å¦‚æœæ’ä»¶ä¸æ˜¾ç¤ºï¼Œè¯·æ›´æ–° JDK åˆ°æœ€æ–°ç‰ˆã€‚</p>
</blockquote>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/3661cf80-7809-11ea-a98c-83821ebf98cb" alt="82937996.png"></p>
<p>æŒ‰ç…§å¼•å¯¼å’Œæç¤ºï¼Œç»§ç»­å®‰è£…å³å¯ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/4aa27120-7809-11ea-86cb-4dea263d5534" alt="82991766.png"></p>
<p>æ¥å—åè®®ï¼Œå¹¶ç‚¹å‡»å®‰è£…ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/53216e00-7809-11ea-b61a-45f5a80e7f1b" alt="83219940.png"></p>
<p>ç­‰å¾…å®‰è£…å®Œæˆï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/5c553bf0-7809-11ea-8e11-89f2c26dd0be" alt="83257210.png"></p>
<p>ç‚¹å‡»â€œå®Œæˆâ€æŒ‰é’®å³å¯ã€‚</p>
<p><strong>BTrace æ’ä»¶ä½¿ç”¨</strong></p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/689845b0-7809-11ea-8856-57a8f16560a7" alt="85267702.png"></p>
<p>æ‰“å¼€åé»˜è®¤çš„ç•Œé¢å¦‚ä¸‹ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/70515a80-7809-11ea-8e11-89f2c26dd0be" alt="85419826.png"></p>
<p>å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ª Java æ–‡ä»¶çš„æ ·å­ã€‚ç„¶åæˆ‘ä»¬å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼ŒåŠ ä¸€äº›è„šæœ¬è¿›å»ã€‚</p>
<h4 id="btrace-è„šæœ¬ç¤ºä¾‹"><strong>BTrace è„šæœ¬ç¤ºä¾‹</strong></h4>
<p>æˆ‘ä»¬ä¸‹è½½çš„ BTrace é¡¹ç›®ä¸­ï¼Œsamples ç›®å½•ä¸‹æœ‰ä¸€äº›è„šæœ¬ç¤ºä¾‹ã€‚ å‚ç…§è¿™äº›ç¤ºä¾‹ï¼Œç¼–å†™ä¸€ä¸ªç®€å•çš„ BTrace è„šæœ¬ï¼š</p>
<pre tabindex="0"><code>import com.sun.btrace.annotations.*;
import static com.sun.btrace.BTraceUtils.*;

@BTrace
public class TracingScript {
    @OnMethod(
            clazz = &quot;/demo.jvm0209.*/&quot;,
            method = &quot;/.*/&quot;
    )
    // æ–¹æ³•è¿›å…¥æ—¶
    public static void simple(
                @ProbeClassName String probeClass,
                @ProbeMethodName String probeMethod) {
        print(&quot;entered &quot; + probeClass);
        println(&quot;.&quot; + probeMethod);
    }

 @OnMethod(clazz = &quot;demo.jvm0209.RandomSample&quot;,
             method = &quot;randomHash&quot;,
             location = @Location(Kind.RETURN)
    )
    // æ–¹æ³•è¿”å›æ—¶
 public static void onMethodReturn(
                @ProbeClassName String probeClass,
                @ProbeMethodName String probeMethod,
                @Duration long duration,
                @Return int returnValue) {
      print(probeClass + &quot;.&quot; + probeMethod);
      print(Strings.strcat(&quot;(), duration=&quot;, duration+&quot;ns;&quot;));
      println(Strings.strcat(&quot; return: &quot;, &quot;&quot;+returnValue));
 }
}

</code></pre><h4 id="æ‰§è¡Œç»“æœ"><strong>æ‰§è¡Œç»“æœ</strong></h4>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¾“å‡ºäº†ç®€å•çš„æ‰§è¡Œç»“æœï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/60607910-780b-11ea-8e11-89f2c26dd0be" alt="6182718.png"></p>
<p>å¯ä»¥å’Œç¤ºä¾‹ç¨‹åºçš„æ§åˆ¶å°è¾“å‡ºæ¯”å¯¹ä¸€ä¸‹ã€‚</p>
<h4 id="æ›´å¤šç¤ºä¾‹"><strong>æ›´å¤šç¤ºä¾‹</strong></h4>
<p>BTrace æä¾›äº†å¾ˆå¤šç¤ºä¾‹ï¼Œç…§ç€æ”¹ä¸€æ”¹å°±èƒ½æ‰§è¡Œç®€å•çš„ç›‘æ§ã€‚</p>
<ul>
<li><a href="https://blogs.sap.com/2019/11/15/brief-introduction-to-btrace-a-very-useful-dynamic-tracing-tool/">BTrace ç®€ä»‹</a></li>
<li><a href="http://calvin1978.blogcn.com/articles/btrace1.html">Btrace å…¥é—¨åˆ°ç†Ÿç»ƒå°å·¥å®Œå…¨æŒ‡å—</a></li>
<li><a href="https://coderbee.net/index.php/jvm/20170514/1519">BTrace ç”¨æˆ·æŒ‡å—</a></li>
<li><a href="https://tech.meituan.com/2019/02/28/java-dynamic-trace.html">Java åŠ¨æ€è¿½è¸ªæŠ€æœ¯æ¢ç©¶</a></li>
</ul>
<h3 id="arthas-è¯Šæ–­åˆ†æå·¥å…·">Arthas è¯Šæ–­åˆ†æå·¥å…·</h3>
<p>ä¸Šé¢ä»‹ç»çš„ BTrace åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œä½†æ˜¯å®ç”¨é™åˆ¶ä¹Ÿä¸å°‘ï¼Œç¯å¢ƒé—®é¢˜ä¹Ÿå¾ˆå¤šã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰æ›´å¥½çš„ç±»ä¼¼å·¥å…·å‘¢ï¼Ÿ</p>
<p>æœ¬èŠ‚æˆ‘ä»¬å°±æ¥ä»‹ç»ä¸€ä¸‹ Arthas è¯Šæ–­åˆ†æå·¥å…·ï¼ŒArthas é¡¹ç›®é¦–é¡µï¼š</p>
<blockquote>
<p><a href="https://github.com/alibaba/arthas">https://github.com/alibaba/arthas</a></p>
</blockquote>
<h4 id="arthas-ç®€ä»‹"><strong>Arthas ç®€ä»‹</strong></h4>
<p>Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰æ˜¯é˜¿é‡Œå·´å·´æ¨å‡ºäº†ä¸€æ¬¾å¼€æºçš„ Java è¯Šæ–­å·¥å…·ï¼Œæ·±å—å¼€å‘è€…å–œçˆ±ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ</p>
<ul>
<li>Arthas æ”¯æŒ JDK 6 ä»¥åŠæ›´é«˜ç‰ˆæœ¬çš„ JDKï¼›</li>
<li>æ”¯æŒ Linux/Mac/Winodws æ“ä½œç³»ç»Ÿï¼›</li>
<li>é‡‡ç”¨å‘½ä»¤è¡Œäº¤äº’æ¨¡å¼ï¼ŒåŒæ—¶æä¾›ä¸°å¯Œçš„ Tab è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œæ–¹ä¾¿è¿›è¡Œé—®é¢˜çš„å®šä½å’Œè¯Šæ–­ï¼›</li>
<li>æ”¯æŒ WebConsoleï¼Œåœ¨æŸäº›å¤æ‚çš„æƒ…å†µä¸‹ï¼Œæ‰“é€š HTTP è·¯ç”±å°±å¯ä»¥è®¿é—®ã€‚</li>
</ul>
<p>å½“æˆ‘ä»¬é‡åˆ°ä»¥ä¸‹ç±»ä¼¼é—®é¢˜è€ŒæŸæ‰‹æ— ç­–æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ Arthas æ¥å¸®åŠ©æˆ‘ä»¬è§£å†³ï¼š</p>
<ol>
<li>è¿™ä¸ªç±»ä»å“ªä¸ª jar åŒ…åŠ è½½çš„ï¼Ÿä¸ºä»€ä¹ˆä¼šæŠ¥å„ç§ç±»ç›¸å…³çš„ Exceptionï¼Ÿ</li>
<li>æˆ‘æ”¹çš„ä»£ç ä¸ºä»€ä¹ˆæ²¡æœ‰æ‰§è¡Œåˆ°ï¼Ÿéš¾é“æ˜¯æˆ‘æ²¡ commitï¼Ÿåˆ†æ”¯æé”™äº†ï¼Ÿ</li>
<li>é‡åˆ°é—®é¢˜æ— æ³•åœ¨çº¿ä¸Š Debugï¼Œéš¾é“åªèƒ½é€šè¿‡åŠ æ—¥å¿—å†é‡æ–°å‘å¸ƒå—ï¼Ÿ</li>
<li>çº¿ä¸Šé‡åˆ°æŸä¸ªç”¨æˆ·çš„æ•°æ®å¤„ç†æœ‰é—®é¢˜ï¼Œä½†çº¿ä¸ŠåŒæ ·æ— æ³• debugï¼Œçº¿ä¸‹æ— æ³•é‡ç°ï¼</li>
<li>æ˜¯å¦æœ‰ä¸€ä¸ªå…¨å±€è§†è§’æ¥æŸ¥çœ‹ç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µï¼Ÿ</li>
<li>æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥ç›‘æ§åˆ° JVM çš„å®æ—¶è¿è¡ŒçŠ¶æ€ï¼Ÿ</li>
<li>æ€ä¹ˆå¿«é€Ÿå®šä½åº”ç”¨çš„çƒ­ç‚¹ï¼Œç”Ÿæˆç«ç„°å›¾ï¼Ÿ</li>
</ol>
<p>Arthas å®˜æ–¹æä¾›äº†<a href="https://alibaba.github.io/arthas/arthas-tutorials?language=cn&amp;id=arthas-basics">åŸºç¡€æ•™ç¨‹</a>å’Œ<a href="https://alibaba.github.io/arthas/arthas-tutorials?language=cn&amp;id=arthas-advanced">è¿›é˜¶æ•™ç¨‹</a>ï¼Œä»¥åŠç½‘é¡µç‰ˆçš„å‘½ä»¤è¡Œæ¨¡æ‹Ÿå™¨ï¼Œè·Ÿç€æ‰§è¡Œä¸€éå¾ˆå®¹æ˜“äº†è§£ç›¸å…³çš„åŠŸèƒ½ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬è·Ÿç€æ•™ç¨‹æ¥ä½“éªŒä¸€ä¸‹ã€‚</p>
<h4 id="ä¸‹è½½ä¸å®‰è£…"><strong>ä¸‹è½½ä¸å®‰è£…</strong></h4>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥å®‰è£… Arthasï¼š</p>
<pre tabindex="0"><code># å‡†å¤‡ç›®å½•
mkdir -p /usr/local/tools/arthas
cd /usr/local/tools/arthas
# æ‰§è¡Œå®‰è£…è„šæœ¬
curl -L https://alibaba.github.io/arthas/install.sh | sh
Â·Â·Â·Â·Â·Â·

</code></pre><p>å‘½ä»¤è¡Œå¯åŠ¨ï¼š</p>
<pre tabindex="0"><code># å¯åŠ¨
./as.sh -h
Error: telnet is not installed. Try to use java -jar arthas-boot.jar
# å®‰è£…telnet
# yum -y install telnet
# brew install telnet
# å†æ¬¡æ‰§è¡Œ
./as.sh

</code></pre><p>é€šè¿‡ jar å¯åŠ¨ï¼š</p>
<pre tabindex="0"><code># è¿›å…¥jarç›®å½•
cd ~/.arthas/lib/3.1.7/arthas/
# é€šè¿‡jarå¯åŠ¨ arthas
java -jar arthas-boot.jar

</code></pre><h4 id="ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</h4>
<p>å¯åŠ¨ä¹‹åæ˜¾ç¤ºçš„ä¿¡æ¯å¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/94b56270-780b-11ea-a3f1-b7b0a6636d71" alt="8128798.png"></p>
<p>ç„¶åæˆ‘ä»¬è¾“å…¥éœ€è¦è¿æ¥ï¼ˆAttachï¼‰çš„ JVM è¿›ç¨‹ï¼Œä¾‹å¦‚ 1ï¼Œç„¶åå›è½¦ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/a10febd0-780b-11ea-a3f1-b7b0a6636d71" alt="8296362.png"></p>
<p>å¦‚æœéœ€è¦é€€å‡ºï¼Œè¾“å…¥ exit å³å¯ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬è¾“å…¥ help å‘½ä»¤æŸ¥çœ‹å¸®åŠ©ï¼Œè¿”å›çš„ä¿¡æ¯å¤§è‡´å¦‚ä¸‹ã€‚</p>
<pre tabindex="0"><code>[arthas@27350]$ help
 NAME DESCRIPTION
 help Display Arthas Help
 keymap Display all the available keymap for the specified connection.
 sc Search all the classes loaded by JVM
 sm Search the method of classes loaded by JVM
 classloader Show classloader info
 jad Decompile class
 getstatic Show the static field of a class
 monitor Monitor method execution statistics, e.g. total/success/failure count, average rt, fail rate, etc.
 stack Display the stack trace for the specified class and method
 thread Display thread info, thread stack
 trace Trace the execution time of specified method invocation.
 watch Display the input/output parameter, return object, and thrown exception of specified method invocation
 tt Time Tunnel
 jvm Display the target JVM information
 ognl Execute ognl expression.
 mc Memory compiler, compiles java files into bytecode and class files in memory.
 redefine Redefine classes. @see Instrumentation#redefineClasses(ClassDefinition...)
 dashboard Overview of target jvm's thread, memory, gc, vm, tomcat info.
 dump Dump class byte array from JVM
 heapdump Heap dump
 options View and change various Arthas options
 cls Clear the screen
 reset Reset all the enhanced classes
 version Display Arthas version
 shutdown Shutdown Arthas server and exit the console
 stop Stop/Shutdown Arthas server and exit the console. Alias for shutdown.
 session Display current session information
 sysprop Display, and change the system properties.
 sysenv Display the system env.
 vmoption Display, and update the vm diagnostic options.
 logger Print logger info, and update the logger level
 history Display command history
 cat Concatenate and print files
 pwd Return working directory name
 mbean Display the mbean information
 grep grep command for pipes.
 profiler Async Profiler. https://github.com/jvm-profiling-tools/async-profiler

</code></pre><p>è¿™é‡Œåˆ—å‡ºäº†æ”¯æŒçš„å‘½ä»¤ã€‚å¦‚æœè¦æŸ¥çœ‹æŸä¸ªå‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯æ€ä¹ˆåŠå‘¢ï¼Ÿ å¯ä»¥ä½¿ç”¨ <code>help xxx</code> çš„å½¢å¼ã€‚ä¾‹å¦‚ï¼š</p>
<pre tabindex="0"><code>help thread

</code></pre><p>å¦‚æœæŸ¥çœ‹ JVM ä¿¡æ¯ï¼Œè¾“å…¥å‘½ä»¤ jvm å³å¯ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/ab1588b0-780b-11ea-b760-29671afaaa1a" alt="8871310.png"></p>
<p>ç¯å¢ƒå˜é‡ sysenvï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/b2e1d760-780b-11ea-8856-57a8f16560a7" alt="9257854.png"></p>
<p>æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯ï¼Œè¾“å…¥å‘½ä»¤ threadï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/bae2a390-780b-11ea-b61a-45f5a80e7f1b" alt="8831103.png"></p>
<p>æŸ¥çœ‹æŸä¸ªçº¿ç¨‹çš„ä¿¡æ¯ï¼š</p>
<pre tabindex="0"><code>[arthas@27350]$ thread 1
&quot;main&quot; Id=1 TIMED_WAITING
    at java.lang.Thread.sleep(Native Method)
    at java.lang.Thread.sleep(Thread.java:340)
    at java.util.concurrent.TimeUnit.sleep(TimeUnit.java:386)
    at demo.jvm0209.RandomSample.main(Unknown Source)

</code></pre><p>æŸ¥çœ‹ JVM é€‰é¡¹ vmoptionï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/c3a51210-780b-11ea-8e11-89f2c26dd0be" alt="9104344.png"></p>
<p>æŸäº›é€‰é¡¹å¯ä»¥è®¾ç½®ï¼Œè¿™é‡Œç»™å‡ºäº†ç¤ºä¾‹ <code>vmoption PrintGCDetails true</code>ã€‚</p>
<p>æŸ¥æ‰¾ç±» scï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/7c81e650-780c-11ea-a89b-47a48ccffebe" alt="9474443.png"></p>
<p>åç¼–è¯‘ä»£ç  jadï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/8ec49510-780c-11ea-8c74-b966eb0a8d67" alt="9593919.png"></p>
<p>å †å†…å­˜è½¬å‚¨ heapdumpï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/85d59850-780c-11ea-b760-29671afaaa1a" alt="9834789.png"></p>
<p>è·Ÿè¸ªæ–¹æ³•æ‰§è¡Œæ—¶é—´ traceï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/976068c0-780c-11ea-a98c-83821ebf98cb" alt="9997095.png"></p>
<p>è§‚å¯Ÿæ–¹æ³•æ‰§è¡Œ watchï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/9e27a380-780c-11ea-9105-57164a9a27ea" alt="10270279.png"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ”¯æŒæ¡ä»¶è¡¨è¾¾å¼ï¼Œç±»ä¼¼äºä»£ç è°ƒè¯•ä¸­çš„æ¡ä»¶æ–­ç‚¹ã€‚ åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå¹¶ä¸”ä½œä¸ºä¸€ä¸ª JVM åˆ†æçš„é›†æˆç¯å¢ƒï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”ä¸€èˆ¬å·¥å…·æ–¹ä¾¿ã€‚æ›´å¤šåŠŸèƒ½è¯·å‚è€ƒ <a href="https://alibaba.github.io/arthas/">Arthas ç”¨æˆ·æ–‡æ¡£</a>ã€‚</p>
<h3 id="æŠ½æ ·åˆ†æå™¨profilers">æŠ½æ ·åˆ†æå™¨ï¼ˆProfilersï¼‰</h3>
<p>ä¸‹é¢ä»‹ç»åˆ†æå™¨ï¼ˆ<a href="http://zeroturnaround.com/rebellabs/developer-productivity-report-2015-java-performance-survey-results/3/">profilers</a>ï¼ŒOracle å®˜æ–¹ç¿»è¯‘æ˜¯â€œæŠ½æ ·å™¨â€ï¼‰ã€‚</p>
<p>ç›¸å¯¹äºå‰é¢çš„å·¥å…·ï¼Œåˆ†æå™¨åªå…³å¿ƒ GC ä¸­çš„ä¸€éƒ¨åˆ†é¢†åŸŸï¼Œæœ¬èŠ‚æˆ‘ä»¬ä¹Ÿåªç®€å•ä»‹ç»åˆ†æå™¨ç›¸å…³çš„ GC åŠŸèƒ½ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„ï¼šä¸è¦è®¤ä¸ºåˆ†æå™¨é€‚ç”¨äºæ‰€æœ‰çš„åœºæ™¯ã€‚åˆ†æå™¨æœ‰æ—¶ç¡®å®ä½œç”¨å¾ˆå¤§ï¼Œæ¯”å¦‚æ£€æµ‹ä»£ç ä¸­çš„ CPU çƒ­ç‚¹æ—¶ï¼Œä½†æŸäº›æƒ…å†µä½¿ç”¨åˆ†æå™¨ä¸ä¸€å®šæ˜¯ä¸ªå¥½æ–¹æ¡ˆã€‚</p>
</blockquote>
<p>å¯¹ GC è°ƒä¼˜æ¥è¯´ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚è¦æ£€æµ‹æ˜¯å¦å› ä¸º GC è€Œå¼•èµ·å»¶è¿Ÿæˆ–ååé‡é—®é¢˜æ—¶ï¼Œä¸éœ€è¦ä½¿ç”¨åˆ†æå™¨ã€‚å‰é¢æåˆ°çš„å·¥å…·ï¼ˆjstat æˆ–åŸç”Ÿ/å¯è§†åŒ– GC æ—¥å¿—ï¼‰å°±èƒ½æ›´å¥½æ›´å¿«åœ°æ£€æµ‹å‡ºæ˜¯å¦å­˜åœ¨ GC é—®é¢˜.ã€‚ç‰¹åˆ«æ˜¯ä»ç”Ÿäº§ç¯å¢ƒä¸­æ”¶é›†æ€§èƒ½æ•°æ®æ—¶ï¼Œæœ€å¥½ä¸è¦ä½¿ç”¨åˆ†æå™¨ï¼Œå› ä¸ºæ€§èƒ½å¼€é”€éå¸¸å¤§ï¼Œå¯¹æ­£åœ¨è¿è¡Œçš„ç”Ÿäº§ç³»ç»Ÿä¼šæœ‰å½±å“ã€‚</p>
<p>å¦‚æœç¡®å®éœ€è¦å¯¹ GC è¿›è¡Œä¼˜åŒ–ï¼Œé‚£ä¹ˆåˆ†æå™¨å°±å¯ä»¥æ´¾ä¸Šç”¨åœºäº†ï¼Œå¯ä»¥å¯¹ Object çš„åˆ›å»ºä¿¡æ¯ä¸€ç›®äº†ç„¶ã€‚æ¢ä¸ªè§’åº¦çœ‹ï¼Œå¦‚æœ GC æš‚åœçš„åŸå› ä¸åœ¨æŸä¸ªå†…å­˜æ± ä¸­ï¼Œé‚£å°±åªä¼šæ˜¯å› ä¸ºåˆ›å»ºå¯¹è±¡å¤ªå¤šäº†ã€‚æ‰€æœ‰åˆ†æå™¨éƒ½èƒ½å¤Ÿè·Ÿè¸ªå¯¹è±¡åˆ†é…ï¼ˆvia allocation profilingï¼‰ï¼Œæ ¹æ®å†…å­˜åˆ†é…çš„è½¨è¿¹ï¼Œè®©ä½ çŸ¥é“ <strong>å®é™…é©»ç•™åœ¨å†…å­˜ä¸­çš„æ˜¯å“ªäº›å¯¹è±¡</strong>ã€‚</p>
<p>åˆ†é…åˆ†æèƒ½å®šä½åˆ°åœ¨å“ªä¸ªåœ°æ–¹åˆ›å»ºäº†å¤§é‡çš„å¯¹è±¡ã€‚ä½¿ç”¨åˆ†æå™¨è¾…åŠ©è¿›è¡Œ GC è°ƒä¼˜çš„å¥½å¤„æ˜¯ï¼Œèƒ½ç¡®å®šå“ªç§ç±»å‹çš„å¯¹è±¡æœ€å ç”¨å†…å­˜ï¼Œä»¥åŠå“ªäº›çº¿ç¨‹åˆ›å»ºäº†æœ€å¤šçš„å¯¹è±¡ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡å®ä¾‹ä»‹ç» 3 ç§åˆ†é…åˆ†æå™¨ï¼š<strong>hprof</strong>ã€<strong>JVisualVM</strong> å’Œ <strong>AProf</strong>ã€‚å®é™…ä¸Šè¿˜æœ‰å¾ˆå¤šåˆ†æå™¨å¯ä¾›é€‰æ‹©ï¼Œæœ‰å•†ä¸šäº§å“ï¼Œä¹Ÿæœ‰å…è´¹å·¥å…·ï¼Œä½†å…¶åŠŸèƒ½å’Œåº”ç”¨åŸºæœ¬ä¸Šéƒ½æ˜¯ç±»ä¼¼çš„ã€‚</p>
<h4 id="hprof"><strong>hprof</strong></h4>
<p><a href="https://docs.oracle.com/javase/8/docs/technotes/samples/hprof.html">hprof åˆ†æå™¨</a>å†…ç½®äº JDK ä¹‹ä¸­ã€‚åœ¨å„ç§ç¯å¢ƒä¸‹éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä¸€èˆ¬ä¼˜å…ˆä½¿ç”¨è¿™æ¬¾å·¥å…·ã€‚</p>
<p>æ€§èƒ½åˆ†æå·¥å…·â€”â€”HPROF ç®€ä»‹ï¼š</p>
<blockquote>
<p><a href="https://github.com/cncounter/translation/blob/master/tiemao_2017/20_hprof/20_hprof.md">https://github.com/cncounter/translation/blob/master/tiemao_2017/20_hprof/20_hprof.md</a></p>
</blockquote>
<p>HPROF å‚è€ƒæ–‡æ¡£ï¼š</p>
<blockquote>
<p><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr008.html">https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr008.html</a></p>
</blockquote>
<p>è¦è®© hprof å’Œç¨‹åºä¸€èµ·è¿è¡Œï¼Œéœ€è¦ä¿®æ”¹å¯åŠ¨è„šæœ¬ï¼Œç±»ä¼¼è¿™æ ·ï¼š</p>
<pre tabindex="0"><code>java -agentlib:hprof=heap=sites com.yourcompany.YourApplication

</code></pre><p>åœ¨ç¨‹åºé€€å‡ºæ—¶ï¼Œä¼šå°†åˆ†é…ä¿¡æ¯ dumpï¼ˆè½¬å‚¨ï¼‰åˆ°å·¥ä½œç›®å½•ä¸‹çš„ java.hprof.txt æ–‡ä»¶ä¸­ã€‚ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ï¼Œå¹¶æœç´¢â€œ<strong>SITES BEGIN</strong>â€å…³é”®å­—ï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p>
<pre tabindex="0"><code> SITES BEGIN (ordered by live bytes) Tue Dec 8 11:16:15 2015
           percent live alloc'ed stack class
  rank self accum bytes objs bytes objs trace name
     1 64.43% 4.43% 8370336 20121 27513408 66138 302116 int[]
     2 3.26% 88.49% 482976 20124 1587696 66154 302104 java.util.ArrayList
     3 1.76% 88.74% 241704 20121 1587312 66138 302115 eu.plumbr.demo.largeheap.ClonableClass0006
     ... éƒ¨åˆ†çœç•¥ ...

 SITES END

</code></pre><p>ä»ä»¥ä¸Šç‰‡æ®µå¯ä»¥çœ‹åˆ°ï¼Œallocations æ˜¯æ ¹æ®æ¯æ¬¡åˆ›å»ºçš„å¯¹è±¡æ•°é‡æ¥æ’åºçš„ã€‚ç¬¬ä¸€è¡Œæ˜¾ç¤ºæ‰€æœ‰å¯¹è±¡ä¸­æœ‰ <strong>64.43%</strong> çš„å¯¹è±¡æ˜¯æ•´å‹æ•°ç»„ (int[])ï¼Œåœ¨æ ‡è¯†ä¸º 302116 çš„ä½ç½®åˆ›å»ºã€‚æœç´¢â€œ<strong>TRACE 302116</strong>â€å¯ä»¥çœ‹åˆ°ï¼š</p>
<pre tabindex="0"><code> TRACE 302116: 
  eu.plumbr.demo.largeheap.ClonableClass0006.&lt;init&gt;(GeneratorClass.java:11)
  sun.reflect.GeneratedConstructorAccessor7.newInstance(&lt;Unknown Source&gt;:Unknown line)
  sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
  java.lang.reflect.Constructor.newInstance(Constructor.java:422)

</code></pre><p>ç°åœ¨ï¼ŒçŸ¥é“æœ‰ 64.43% çš„å¯¹è±¡æ˜¯æ•´æ•°æ•°ç»„ï¼Œåœ¨ ClonableClass0006 ç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œç¬¬ 11 è¡Œçš„ä½ç½®ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ä¼˜åŒ–ä»£ç ï¼Œä»¥å‡å°‘ GC çš„å‹åŠ›ã€‚</p>
<h4 id="java-visualvm"><strong>Java VisualVM</strong></h4>
<p>æœ¬ç« å‰é¢çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œåœ¨ç›‘æ§ JVM çš„ GC è¡Œä¸ºå·¥å…·æ—¶ä»‹ç»äº† JVisualVMï¼Œæœ¬èŠ‚ä»‹ç»å…¶åœ¨åˆ†é…åˆ†æä¸Šçš„åº”ç”¨ã€‚</p>
<p>JVisualVM é€šè¿‡ GUI çš„æ–¹å¼è¿æ¥åˆ°æ­£åœ¨è¿è¡Œçš„ JVMã€‚è¿æ¥ä¸Šç›®æ ‡ JVM ä¹‹åï¼š</p>
<ol>
<li>æ‰“å¼€â€œå·¥å…·â€â€“&gt;â€œé€‰é¡¹â€èœå•ï¼Œç‚¹å‡» **æ€§èƒ½åˆ†æï¼ˆProfilerï¼‰**æ ‡ç­¾ï¼Œæ–°å¢é…ç½®ï¼Œé€‰æ‹© Profiler å†…å­˜ï¼Œç¡®ä¿å‹¾é€‰äº†â€œRecord allocations stack tracesâ€ï¼ˆè®°å½•åˆ†é…æ ˆè·Ÿè¸ªï¼‰ã€‚</li>
<li>å‹¾é€‰â€œSettingsâ€ï¼ˆè®¾ç½®ï¼‰å¤é€‰æ¡†ï¼Œåœ¨å†…å­˜è®¾ç½®æ ‡ç­¾ä¸‹ï¼Œä¿®æ”¹é¢„è®¾é…ç½®ã€‚</li>
<li>ç‚¹å‡»â€œMemoryâ€ï¼ˆå†…å­˜ï¼‰æŒ‰é’®å¼€å§‹è¿›è¡Œå†…å­˜åˆ†æã€‚</li>
<li>è®©ç¨‹åºè¿è¡Œä¸€æ®µæ—¶é—´ï¼Œä»¥æ”¶é›†å…³äºå¯¹è±¡åˆ†é…çš„è¶³å¤Ÿä¿¡æ¯ã€‚</li>
<li>å•å‡»ä¸‹æ–¹çš„â€œSnapshotâ€ï¼ˆå¿«ç…§ï¼‰æŒ‰é’®ï¼Œå¯ä»¥è·å–æ”¶é›†åˆ°çš„å¿«ç…§ä¿¡æ¯ã€‚</li>
</ol>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/f4c62b30-780c-11ea-b264-6326f7cc0e82" alt="85731ea7-1c8c-4f9a-8869-bd25f61e3300.png"></p>
<p>å®Œæˆä¸Šé¢çš„æ­¥éª¤åï¼Œå¯ä»¥å¾—åˆ°ç±»ä¼¼è¿™æ ·çš„ä¿¡æ¯ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/fcd5eb80-780c-11ea-9105-57164a9a27ea" alt="f6c5d90d-104f-474e-b9fe-fa4d351871da.png"></p>
<p>ä¸Šå›¾æŒ‰ç…§æ¯ä¸ªç±»è¢«åˆ›å»ºçš„å¯¹è±¡æ•°é‡å¤šå°‘æ¥æ’åºã€‚çœ‹ç¬¬ä¸€è¡Œå¯ä»¥çŸ¥é“ï¼Œåˆ›å»ºçš„æœ€å¤šçš„å¯¹è±¡æ˜¯ int[] æ•°ç»„ã€‚é¼ æ ‡å³é”®å•å‡»è¿™è¡Œï¼Œå°±å¯ä»¥çœ‹åˆ°è¿™äº›å¯¹è±¡éƒ½åœ¨å“ªäº›åœ°æ–¹åˆ›å»ºçš„ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89/assets/05cc1430-780d-11ea-8856-57a8f16560a7" alt="e9583002-b04a-4a2c-8e94-3c9e0e57557a.png"></p>
<p>ä¸ hprof ç›¸æ¯”ï¼ŒJVisualVM æ›´åŠ å®¹æ˜“ä½¿ç”¨ â€”â€” æ¯”å¦‚ä¸Šé¢çš„æˆªå›¾ä¸­ï¼Œåœ¨ä¸€ä¸ªåœ°æ–¹å°±å¯ä»¥çœ‹åˆ°æ‰€æœ‰ int[] çš„åˆ†é…ä¿¡æ¯ï¼Œæ‰€ä»¥å¤šæ¬¡åœ¨åŒä¸€å¤„ä»£ç è¿›è¡Œåˆ†é…çš„æƒ…å†µå°±å¾ˆå®¹æ˜“å‘ç°ã€‚</p>
<h4 id="aprof"><strong>AProf</strong></h4>
<p>AProf æ˜¯ä¸€æ¬¾é‡è¦çš„åˆ†æå™¨ï¼Œæ˜¯ç”± Devexperts å¼€å‘çš„ <strong>AProf</strong>ã€‚å†…å­˜åˆ†é…åˆ†æå™¨ AProf ä¹Ÿè¢«æ‰“åŒ…ä¸º Java agent çš„å½¢å¼ã€‚</p>
<p>ç”¨ AProf åˆ†æåº”ç”¨ç¨‹åºï¼Œéœ€è¦ä¿®æ”¹ JVM å¯åŠ¨è„šæœ¬ï¼Œç±»ä¼¼è¿™æ ·ï¼š</p>
<pre tabindex="0"><code>java -javaagent:/path-to/aprof.jar com.yourcompany.YourApplication

</code></pre><p>é‡å¯åº”ç”¨ä¹‹åï¼Œå·¥ä½œç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ª aprof.txt æ–‡ä»¶ã€‚æ­¤æ–‡ä»¶æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ï¼ŒåŒ…å«è¿™æ ·çš„ä¿¡æ¯ï¼š</p>
<pre tabindex="0"><code> ========================================================================================================================
 TOTAL allocation dump for 91,289 ms (0h01m31s)
 Allocated 1,769,670,584 bytes in 24,868,088 objects of 425 classes in 2,127 locations
 ========================================================================================================================

 Top allocation-inducing locations with the data types allocated from them
 ------------------------------------------------------------------------------------------------------------------------
 eu.plumbr.demo.largeheap.ManyTargetsGarbageProducer.newRandomClassObject: 1,423,675,776 (80.44%) bytes in 17,113,721 (68.81%) objects (avg size 83 bytes)
  int[]: 711,322,976 (40.19%) bytes in 1,709,911 (6.87%) objects (avg size 416 bytes)
  char[]: 369,550,816 (20.88%) bytes in 5,132,759 (20.63%) objects (avg size 72 bytes)
  java.lang.reflect.Constructor: 136,800,000 (7.73%) bytes in 1,710,000 (6.87%) objects (avg size 80 bytes)
  java.lang.Object[]: 41,079,872 (2.32%) bytes in 1,710,712 (6.87%) objects (avg size 24 bytes)
  java.lang.String: 41,063,496 (2.32%) bytes in 1,710,979 (6.88%) objects (avg size 24 bytes)
  java.util.ArrayList: 41,050,680 (2.31%) bytes in 1,710,445 (6.87%) objects (avg size 24 bytes)
           ... cut for brevity ... 

</code></pre><p>ä¸Šé¢çš„è¾“å‡ºæ˜¯æŒ‰ç…§ size è¿›è¡Œæ’åºçš„ã€‚å¯ä»¥çœ‹å‡ºï¼Œ80.44% çš„ bytes å’Œ 68.81% çš„ objects æ˜¯åœ¨ ManyTargetsGarbageProducer.newRandomClassObject() æ–¹æ³•ä¸­åˆ†é…çš„ã€‚å…¶ä¸­ï¼Œ<strong>int[]</strong> æ•°ç»„å ç”¨äº† 40.19% çš„å†…å­˜ï¼Œæ˜¯æœ€å¤§çš„ä¸€ä¸ªã€‚</p>
<p>ç»§ç»­å¾€ä¸‹çœ‹ï¼Œä¼šå‘ç° allocation tracesï¼ˆåˆ†é…ç—•è¿¹ï¼‰ç›¸å…³çš„å†…å®¹ï¼Œä¹Ÿæ˜¯ä»¥ allocation size æ’åºçš„ï¼š</p>
<pre tabindex="0"><code> Top allocated data types with reverse location traces
 ------------------------------------------------------------------------------------------------------------------------
 int[]: 725,306,304 (40.98%) bytes in 1,954,234 (7.85%) objects (avg size 371 bytes)
  eu.plumbr.demo.largeheap.ClonableClass0006.: 38,357,696 (2.16%) bytes in 92,206 (0.37%) objects (avg size 416 bytes)
   java.lang.reflect.Constructor.newInstance: 38,357,696 (2.16%) bytes in 92,206 (0.37%) objects (avg size 416 bytes)
    eu.plumbr.demo.largeheap.ManyTargetsGarbageProducer.newRandomClassObject: 38,357,280 (2.16%) bytes in 92,205 (0.37%) objects (avg size 416 bytes)
    java.lang.reflect.Constructor.newInstance: 416 (0.00%) bytes in 1 (0.00%) objects (avg size 416 bytes)
 ... cut for brevity ... 

</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œint[] æ•°ç»„çš„åˆ†é…ï¼Œåœ¨ ClonableClass0006 æ„é€ å‡½æ•°ä¸­ç»§ç»­å¢å¤§ã€‚</p>
<p>å’Œå…¶ä»–å·¥å…·ä¸€æ ·ï¼ŒAProf æ­éœ²äº† åˆ†é…çš„å¤§å°ä»¥åŠä½ç½®ä¿¡æ¯ï¼ˆallocation size and locationsï¼‰ï¼Œä»è€Œèƒ½å¤Ÿå¿«é€Ÿæ‰¾åˆ°æœ€è€—å†…å­˜çš„éƒ¨åˆ†ã€‚</p>
<p>åœ¨æˆ‘ä»¬çœ‹æ¥ï¼Œ<strong>AProf</strong> æ˜¯éå¸¸æœ‰ç”¨çš„åˆ†é…åˆ†æå™¨ï¼Œå› ä¸ºå®ƒåªä¸“æ³¨äºå†…å­˜åˆ†é…ï¼Œæ‰€ä»¥åšå¾—æœ€å¥½ã€‚åŒæ—¶è¿™æ¬¾å·¥å…·æ˜¯å¼€æºå…è´¹çš„ï¼Œèµ„æºå¼€é”€ä¹Ÿæœ€å°ã€‚</p>
<h3 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h3>
<ul>
<li><a href="http://blog.51cto.com/laoxu/1267097">Linux å†…æ ¸ OOM æœºåˆ¶çš„è¯¦ç»†åˆ†æ</a></li>
<li><a href="https://github.com/Yhzhtk/note/issues/31">Linux æ‰¾å‡ºæœ€æœ‰å¯èƒ½è¢« OOM Killer æ€æ‰çš„è¿›ç¨‹</a></li>
<li><a href="https://github.com/cncounter/translation/blob/master/tiemao_2017/20_hprof/20_hprof.md">æ€§èƒ½åˆ†æå·¥å…·â€”â€”HPROF ç®€ä»‹</a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr008.html">HPROF å‚è€ƒæ–‡æ¡£</a></li>
</ul>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/25-fastthread-%E7%9B%B8%E5%85%B3%E7%9A%84%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D%E6%AC%B2%E7%A9%B7%E5%8D%83%E9%87%8C%E7%9B%AE%E6%9B%B4%E4%B8%8A%E4%B8%80%E5%B1%82%E6%A5%BC/"><span>25 FastThread ç›¸å…³çš„å·¥å…·ä»‹ç»ï¼šæ¬²ç©·åƒé‡Œç›®ï¼Œæ›´ä¸Šä¸€å±‚æ¥¼</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/java/jvm%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF32%E8%AE%B2/27-jvm-%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E5%88%86%E6%9E%90%E4%B8%8A%E7%AF%87%E8%B0%83%E4%BC%98%E7%BB%8F%E9%AA%8C/"><span>27 JVM é—®é¢˜æ’æŸ¥åˆ†æä¸Šç¯‡ï¼ˆè°ƒä¼˜ç»éªŒï¼‰</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 28280 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>