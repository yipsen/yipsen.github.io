<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>28 å¦‚ä½•ä½¿ç”¨è®¾è®¡æ¨¡å¼ä¼˜åŒ–å¹¶å‘ç¼–ç¨‹ï¼Ÿ | Yipsen Ye</title>
<meta name="description" content="ä½ å¥½ï¼Œæˆ‘æ˜¯åˆ˜è¶…ã€‚
åœ¨æˆ‘ä»¬ä½¿ç”¨å¤šçº¿ç¨‹ç¼–ç¨‹æ—¶ï¼Œå¾ˆå¤šæ—¶å€™éœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯è®¾è®¡ä¸€å¥—ä¸šåŠ¡åŠŸèƒ½ã€‚å…¶å®ï¼Œåœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œæœ¬èº«å°±å­˜åœ¨å¾ˆå¤šæˆç†Ÿçš„åŠŸèƒ½è®¾è®¡æ¨¡å¼ï¼Œå­¦å¥½å®ƒä»¬ï¼Œç”¨å¥½å®ƒä»¬ï¼Œé‚£å°±æ˜¯å¦‚è™æ·»ç¿¼äº†ã€‚ä»Šå¤©æˆ‘å°±å¸¦ä½ äº†è§£å‡ ç§å¹¶å‘ç¼–ç¨‹ä¸­å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ã€‚
çº¿ç¨‹ä¸Šä¸‹æ–‡è®¾è®¡æ¨¡å¼ çº¿ç¨‹ä¸Šä¸‹æ–‡æ˜¯æŒ‡è´¯ç©¿çº¿ç¨‹æ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ä¸­çš„ä¸€äº›å…¨å±€ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ¯”è¾ƒç†Ÿæ‚‰çš„ Spring ä¸­çš„ ApplicationContext å°±æ˜¯ä¸€ä¸ªå…³äºä¸Šä¸‹æ–‡çš„ç±»ï¼Œå®ƒåœ¨æ•´ä¸ªç³»ç»Ÿçš„ç”Ÿå‘½å‘¨æœŸä¸­ä¿å­˜äº†é…ç½®ä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯ä»¥åŠæ³¨å†Œçš„ bean ç­‰ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚
è¿™æ ·çš„è§£é‡Šå¯èƒ½æœ‰ç‚¹æŠ½è±¡ï¼Œæˆ‘ä»¬ä¸å¦¨é€šè¿‡ä¸€ä¸ªå…·ä½“çš„æ¡ˆä¾‹ï¼Œæ¥çœ‹çœ‹åˆ°åº•åœ¨ä»€ä¹ˆçš„åœºæ™¯ä¸‹æ‰éœ€è¦ä¸Šä¸‹æ–‡å‘¢ï¼Ÿ
åœ¨æ‰§è¡Œä¸€ä¸ªæ¯”è¾ƒé•¿çš„è¯·æ±‚ä»»åŠ¡æ—¶ï¼Œè¿™ä¸ªè¯·æ±‚å¯èƒ½ä¼šç»å†å¾ˆå¤šå±‚çš„æ–¹æ³•è°ƒç”¨ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦å°†æœ€å¼€å§‹çš„æ–¹æ³•çš„ä¸­é—´ç»“æœä¼ é€’åˆ°æœ«å°¾çš„æ–¹æ³•ä¸­è¿›è¡Œè®¡ç®—ï¼Œä¸€ä¸ªç®€å•çš„å®ç°æ–¹å¼å°±æ˜¯åœ¨æ¯ä¸ªå‡½æ•°ä¸­æ–°å¢è¿™ä¸ªä¸­é—´ç»“æœçš„å‚æ•°ï¼Œä¾æ¬¡ä¼ é€’ä¸‹å»ã€‚ä»£ç å¦‚ä¸‹ï¼š
public class ContextTest {// ä¸Šä¸‹æ–‡ç±»public class Context {private String name;private long idpublic long getId() {return id;}public void setId(long id) {this.id = id;}public String getName() {return this.name;}public void setName(String name) {this.name = name;}}// è®¾ç½®ä¸Šä¸‹æ–‡åå­—public class QueryNameAction {public void execute(Context context) {try {Thread.">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/java%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b%e5%ae%9e%e6%88%98/">Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/00-%E5%BC%80%E7%AF%87%E8%AF%8D%E4%BD%A0%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AD%A6%E4%B9%A0%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">00 å¼€ç¯‡è¯ä½ ä¸ºä»€ä¹ˆéœ€è¦å­¦ä¹ å¹¶å‘ç¼–ç¨‹ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/01-%E5%A6%82%E4%BD%95%E5%88%B6%E5%AE%9A%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E6%A0%87%E5%87%86/">01 å¦‚ä½•åˆ¶å®šæ€§èƒ½è°ƒä¼˜æ ‡å‡†ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/02-%E5%A6%82%E4%BD%95%E5%88%B6%E5%AE%9A%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E7%AD%96%E7%95%A5/">02 å¦‚ä½•åˆ¶å®šæ€§èƒ½è°ƒä¼˜ç­–ç•¥ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/03-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B8%8D%E5%AE%B9%E5%B0%8F%E8%A7%91%E7%99%BEm%E5%86%85%E5%AD%98%E8%BD%BB%E6%9D%BE%E5%AD%98%E5%82%A8%E5%87%A0%E5%8D%81g%E6%95%B0%E6%8D%AE/">03 å­—ç¬¦ä¸²æ€§èƒ½ä¼˜åŒ–ä¸å®¹å°è§‘ï¼Œç™¾Må†…å­˜è½»æ¾å­˜å‚¨å‡ åGæ•°æ®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/04-%E6%85%8E%E9%87%8D%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">04 æ…é‡ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/05-arraylist%E8%BF%98%E6%98%AFlinkedlist%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%BD%93%E6%80%A7%E8%83%BD%E5%B7%AE%E5%8D%83%E5%80%8D/">05 ArrayListè¿˜æ˜¯LinkedListï¼Ÿä½¿ç”¨ä¸å½“æ€§èƒ½å·®åƒå€</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/06-stream%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98%E9%81%8D%E5%8E%86%E9%9B%86%E5%90%88%E6%95%88%E7%8E%87/">06 Streamå¦‚ä½•æé«˜éå†é›†åˆæ•ˆç‡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/07-%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAhashmap%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E4%BC%98%E5%8C%96/">07 æ·±å…¥æµ…å‡ºHashMapçš„è®¾è®¡ä¸ä¼˜åŒ–</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/08-%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E4%BC%98%E5%8C%96%E4%B9%8Bio%E6%A8%A1%E5%9E%8B%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E9%AB%98%E5%B9%B6%E5%8F%91%E4%B8%8Bio%E7%93%B6%E9%A2%88/">08 ç½‘ç»œé€šä¿¡ä¼˜åŒ–ä¹‹IOæ¨¡å‹ï¼šå¦‚ä½•è§£å†³é«˜å¹¶å‘ä¸‹IOç“¶é¢ˆï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/09-%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E4%BC%98%E5%8C%96%E4%B9%8B%E5%BA%8F%E5%88%97%E5%8C%96%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8java%E5%BA%8F%E5%88%97%E5%8C%96/">09 ç½‘ç»œé€šä¿¡ä¼˜åŒ–ä¹‹åºåˆ—åŒ–ï¼šé¿å…ä½¿ç”¨Javaåºåˆ—åŒ–</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/10-%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E4%BC%98%E5%8C%96%E4%B9%8B%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE%E5%A6%82%E4%BD%95%E4%BC%98%E5%8C%96rpc%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/">10 ç½‘ç»œé€šä¿¡ä¼˜åŒ–ä¹‹é€šä¿¡åè®®ï¼šå¦‚ä½•ä¼˜åŒ–RPCç½‘ç»œé€šä¿¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/11-%E7%AD%94%E7%96%91%E8%AF%BE%E5%A0%82%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3nio%E7%9A%84%E4%BC%98%E5%8C%96%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/">11 ç­”ç–‘è¯¾å ‚ï¼šæ·±å…¥äº†è§£NIOçš„ä¼˜åŒ–å®ç°åŸç†</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/12-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8B%E9%94%81%E4%BC%98%E5%8C%96%E4%B8%8A%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3synchronized%E5%90%8C%E6%AD%A5%E9%94%81%E7%9A%84%E4%BC%98%E5%8C%96%E6%96%B9%E6%B3%95/">12 å¤šçº¿ç¨‹ä¹‹é”ä¼˜åŒ–ï¼ˆä¸Šï¼‰ï¼šæ·±å…¥äº†è§£SynchronizedåŒæ­¥é”çš„ä¼˜åŒ–æ–¹æ³•</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/13-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8B%E9%94%81%E4%BC%98%E5%8C%96%E4%B8%AD%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3lock%E5%90%8C%E6%AD%A5%E9%94%81%E7%9A%84%E4%BC%98%E5%8C%96%E6%96%B9%E6%B3%95/">13 å¤šçº¿ç¨‹ä¹‹é”ä¼˜åŒ–ï¼ˆä¸­ï¼‰ï¼šæ·±å…¥äº†è§£LockåŒæ­¥é”çš„ä¼˜åŒ–æ–¹æ³•</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/14-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8B%E9%94%81%E4%BC%98%E5%8C%96%E4%B8%8B%E4%BD%BF%E7%94%A8%E4%B9%90%E8%A7%82%E9%94%81%E4%BC%98%E5%8C%96%E5%B9%B6%E8%A1%8C%E6%93%8D%E4%BD%9C/">14 å¤šçº¿ç¨‹ä¹‹é”ä¼˜åŒ–ï¼ˆä¸‹ï¼‰ï¼šä½¿ç”¨ä¹è§‚é”ä¼˜åŒ–å¹¶è¡Œæ“ä½œ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/15-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%B0%83%E4%BC%98%E4%B8%8A%E5%93%AA%E4%BA%9B%E6%93%8D%E4%BD%9C%E5%AF%BC%E8%87%B4%E4%BA%86%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2/">15 å¤šçº¿ç¨‹è°ƒä¼˜ï¼ˆä¸Šï¼‰ï¼šå“ªäº›æ“ä½œå¯¼è‡´äº†ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/16-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%B0%83%E4%BC%98%E4%B8%8B%E5%A6%82%E4%BD%95%E4%BC%98%E5%8C%96%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2/">16 å¤šçº¿ç¨‹è°ƒä¼˜ï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•ä¼˜åŒ–å¤šçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/17-%E5%B9%B6%E5%8F%91%E5%AE%B9%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8%E8%AF%86%E5%88%AB%E4%B8%8D%E5%90%8C%E5%9C%BA%E6%99%AF%E4%B8%8B%E6%9C%80%E4%BC%98%E5%AE%B9%E5%99%A8/">17 å¹¶å‘å®¹å™¨çš„ä½¿ç”¨ï¼šè¯†åˆ«ä¸åŒåœºæ™¯ä¸‹æœ€ä¼˜å®¹å™¨</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/18-%E5%A6%82%E4%BD%95%E8%AE%BE%E7%BD%AE%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%A4%A7%E5%B0%8F/">18 å¦‚ä½•è®¾ç½®çº¿ç¨‹æ± å¤§å°ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/19-%E5%A6%82%E4%BD%95%E7%94%A8%E5%8D%8F%E7%A8%8B%E6%9D%A5%E4%BC%98%E5%8C%96%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%9A%E5%8A%A1/">19 å¦‚ä½•ç”¨åç¨‹æ¥ä¼˜åŒ–å¤šçº¿ç¨‹ä¸šåŠ¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/20-%E7%A3%A8%E5%88%80%E4%B8%8D%E8%AF%AF%E7%A0%8D%E6%9F%B4%E5%B7%A5%E6%AC%B2%E7%9F%A5jvm%E8%B0%83%E4%BC%98%E5%85%88%E4%BA%86%E8%A7%A3jvm%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/">20 ç£¨åˆ€ä¸è¯¯ç æŸ´å·¥ï¼šæ¬²çŸ¥JVMè°ƒä¼˜å…ˆäº†è§£JVMå†…å­˜æ¨¡å‹</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/21-%E6%B7%B1%E5%85%A5jvm%E5%8D%B3%E6%97%B6%E7%BC%96%E8%AF%91%E5%99%A8jit%E4%BC%98%E5%8C%96java%E7%BC%96%E8%AF%91/">21 æ·±å…¥JVMå³æ—¶ç¼–è¯‘å™¨JITï¼Œä¼˜åŒ–Javaç¼–è¯‘</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/22-%E5%A6%82%E4%BD%95%E4%BC%98%E5%8C%96%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/">22 å¦‚ä½•ä¼˜åŒ–åƒåœ¾å›æ”¶æœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/23-%E5%A6%82%E4%BD%95%E4%BC%98%E5%8C%96jvm%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/">23 å¦‚ä½•ä¼˜åŒ–JVMå†…å­˜åˆ†é…ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/24-%E5%86%85%E5%AD%98%E6%8C%81%E7%BB%AD%E4%B8%8A%E5%8D%87%E6%88%91%E8%AF%A5%E5%A6%82%E4%BD%95%E6%8E%92%E6%9F%A5%E9%97%AE%E9%A2%98/">24 å†…å­˜æŒç»­ä¸Šå‡ï¼Œæˆ‘è¯¥å¦‚ä½•æ’æŸ¥é—®é¢˜ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/25-%E7%AD%94%E7%96%91%E8%AF%BE%E5%A0%82%E6%A8%A1%E5%9D%97%E5%9B%9B%E7%83%AD%E7%82%B9%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94/">25 ç­”ç–‘è¯¾å ‚ï¼šæ¨¡å—å››çƒ­ç‚¹é—®é¢˜è§£ç­”</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/26-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E5%8D%95%E4%B8%80%E5%AF%B9%E8%B1%A1%E4%BC%98%E5%8C%96%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD/">26 å•ä¾‹æ¨¡å¼ï¼šå¦‚ä½•åˆ›å»ºå•ä¸€å¯¹è±¡ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/27-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F%E4%B8%8E%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F%E6%8F%90%E5%8D%87%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E7%9A%84%E5%88%A9%E5%99%A8/">27 åŸå‹æ¨¡å¼ä¸äº«å…ƒæ¨¡å¼ï¼šæå‡ç³»ç»Ÿæ€§èƒ½çš„åˆ©å™¨</a></li>
                
                
                
                    <li>28 å¦‚ä½•ä½¿ç”¨è®¾è®¡æ¨¡å¼ä¼˜åŒ–å¹¶å‘ç¼–ç¨‹ï¼Ÿ</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/29-%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%BC%8F%E7%94%B5%E5%95%86%E5%BA%93%E5%AD%98%E8%AE%BE%E8%AE%A1%E4%BC%98%E5%8C%96/">29 ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼šç”µå•†åº“å­˜è®¾è®¡ä¼˜åŒ–</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/30-%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E5%A6%82%E4%BD%95%E4%BC%98%E5%8C%96%E7%94%B5%E5%95%86%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%A4%8D%E6%9D%82%E7%9A%84%E5%95%86%E5%93%81%E4%BB%B7%E6%A0%BC%E7%AD%96%E7%95%A5/">30 è£…é¥°å™¨æ¨¡å¼ï¼šå¦‚ä½•ä¼˜åŒ–ç”µå•†ç³»ç»Ÿä¸­å¤æ‚çš„å•†å“ä»·æ ¼ç­–ç•¥ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/31-%E7%AD%94%E7%96%91%E8%AF%BE%E5%A0%82%E6%A8%A1%E5%9D%97%E4%BA%94%E6%80%9D%E8%80%83%E9%A2%98%E9%9B%86%E9%94%A6/">31 ç­”ç–‘è¯¾å ‚ï¼šæ¨¡å—äº”æ€è€ƒé¢˜é›†é”¦</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/32-mysql%E8%B0%83%E4%BC%98%E4%B9%8Bsql%E8%AF%AD%E5%8F%A5%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E9%AB%98%E6%80%A7%E8%83%BDsql%E8%AF%AD%E5%8F%A5/">32 MySQLè°ƒä¼˜ä¹‹SQLè¯­å¥ï¼šå¦‚ä½•å†™å‡ºé«˜æ€§èƒ½SQLè¯­å¥ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/33-mysql%E8%B0%83%E4%BC%98%E4%B9%8B%E4%BA%8B%E5%8A%A1%E9%AB%98%E5%B9%B6%E5%8F%91%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E8%B0%83%E4%BC%98/">33 MySQLè°ƒä¼˜ä¹‹äº‹åŠ¡ï¼šé«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ•°æ®åº“äº‹åŠ¡è°ƒä¼˜</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/34-mysql%E8%B0%83%E4%BC%98%E4%B9%8B%E7%B4%A2%E5%BC%95%E7%B4%A2%E5%BC%95%E7%9A%84%E5%A4%B1%E6%95%88%E4%B8%8E%E4%BC%98%E5%8C%96/">34 MySQLè°ƒä¼˜ä¹‹ç´¢å¼•ï¼šç´¢å¼•çš„å¤±æ•ˆä¸ä¼˜åŒ–</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/35-%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Asql%E6%AD%BB%E9%94%81%E4%BA%8B%E6%95%85%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D%E6%AD%BB%E9%94%81/">35 è®°ä¸€æ¬¡çº¿ä¸ŠSQLæ­»é”äº‹æ•…ï¼šå¦‚ä½•é¿å…æ­»é”ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/36-%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E9%9C%80%E8%A6%81%E5%88%86%E8%A1%A8%E5%88%86%E5%BA%93/">36 ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ†è¡¨åˆ†åº“ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/37-%E7%94%B5%E5%95%86%E7%B3%BB%E7%BB%9F%E8%A1%A8%E8%AE%BE%E8%AE%A1%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/">37 ç”µå•†ç³»ç»Ÿè¡¨è®¾è®¡ä¼˜åŒ–æ¡ˆä¾‹åˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/38-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE%E4%BC%98%E5%8C%96%E5%A4%B1%E4%B9%8B%E6%AF%AB%E5%8E%98%E5%B7%AE%E4%B9%8B%E5%8D%83%E9%87%8C/">38 æ•°æ®åº“å‚æ•°è®¾ç½®ä¼˜åŒ–ï¼Œå¤±ä¹‹æ¯«å˜å·®ä¹‹åƒé‡Œ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/39-%E7%AD%94%E7%96%91%E8%AF%BE%E5%A0%82mysql%E4%B8%ADinnodb%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%B2%E8%AE%B2/">39 ç­”ç–‘è¯¾å ‚ï¼šMySQLä¸­InnoDBçš„çŸ¥è¯†ç‚¹ä¸²è®²</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/41-%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E6%9B%B4%E4%BC%98%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/">41 å¦‚ä½•è®¾è®¡æ›´ä¼˜çš„åˆ†å¸ƒå¼é”ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/42-%E7%94%B5%E5%95%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E8%B0%83%E4%BC%98/">42 ç”µå•†ç³»ç»Ÿçš„åˆ†å¸ƒå¼äº‹åŠ¡è°ƒä¼˜</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/43-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98%E4%BC%98%E5%8C%96%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD/">43 å¦‚ä½•ä½¿ç”¨ç¼“å­˜ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/44-%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%8F%8C%E5%8D%81%E4%B8%80%E6%8A%A2%E8%B4%AD%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88%E8%B0%83%E4%BC%98/">44 è®°ä¸€æ¬¡åŒåä¸€æŠ¢è´­æ€§èƒ½ç“¶é¢ˆè°ƒä¼˜</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/%E5%8A%A0%E9%A4%90-%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%B0%E6%8D%AE%E7%9A%84%E5%BC%BA%E5%BC%B1%E4%B8%80%E8%87%B4%E6%80%A7/">åŠ é¤ ä»€ä¹ˆæ˜¯æ•°æ®çš„å¼ºã€å¼±ä¸€è‡´æ€§ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/%E5%8A%A0%E9%A4%90-%E6%8E%A8%E8%8D%90%E5%87%A0%E6%AC%BE%E5%B8%B8%E7%94%A8%E7%9A%84%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/">åŠ é¤ æ¨èå‡ æ¬¾å¸¸ç”¨çš„æ€§èƒ½æµ‹è¯•å·¥å…·</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/%E7%AD%94%E7%96%91%E8%AF%BE%E5%A0%82%E6%A8%A1%E5%9D%97%E4%B8%89%E7%83%AD%E7%82%B9%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94/">ç­”ç–‘è¯¾å ‚ï¼šæ¨¡å—ä¸‰çƒ­ç‚¹é—®é¢˜è§£ç­”</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/%E7%BB%93%E6%9D%9F%E8%AF%AD-%E6%A0%89%E9%A3%8E%E6%B2%90%E9%9B%A8%E7%A0%A5%E7%A0%BA%E5%89%8D%E8%A1%8C/">ç»“æŸè¯­ æ ‰é£æ²é›¨ï¼Œç ¥ç ºå‰è¡Œï¼</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">28 å¦‚ä½•ä½¿ç”¨è®¾è®¡æ¨¡å¼ä¼˜åŒ–å¹¶å‘ç¼–ç¨‹ï¼Ÿ</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2021-12-22 01:44:32</span>ğŸ·ï¸&nbsp;<a class="post-tag" href="/tags/java/">java</a></div><div class="post-category">
                
                ğŸ“š&nbsp;<a href="/categories/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/">Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜</a>
                
            </div></div>
        <div class="post-content">
            <p>ä½ å¥½ï¼Œæˆ‘æ˜¯åˆ˜è¶…ã€‚</p>
<p>åœ¨æˆ‘ä»¬ä½¿ç”¨å¤šçº¿ç¨‹ç¼–ç¨‹æ—¶ï¼Œå¾ˆå¤šæ—¶å€™éœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯è®¾è®¡ä¸€å¥—ä¸šåŠ¡åŠŸèƒ½ã€‚å…¶å®ï¼Œåœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œæœ¬èº«å°±å­˜åœ¨å¾ˆå¤šæˆç†Ÿçš„åŠŸèƒ½è®¾è®¡æ¨¡å¼ï¼Œå­¦å¥½å®ƒä»¬ï¼Œç”¨å¥½å®ƒä»¬ï¼Œé‚£å°±æ˜¯å¦‚è™æ·»ç¿¼äº†ã€‚ä»Šå¤©æˆ‘å°±å¸¦ä½ äº†è§£å‡ ç§å¹¶å‘ç¼–ç¨‹ä¸­å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ã€‚</p>
<h2 id="çº¿ç¨‹ä¸Šä¸‹æ–‡è®¾è®¡æ¨¡å¼">çº¿ç¨‹ä¸Šä¸‹æ–‡è®¾è®¡æ¨¡å¼</h2>
<p>çº¿ç¨‹ä¸Šä¸‹æ–‡æ˜¯æŒ‡è´¯ç©¿çº¿ç¨‹æ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ä¸­çš„ä¸€äº›å…¨å±€ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ¯”è¾ƒç†Ÿæ‚‰çš„ Spring ä¸­çš„ ApplicationContext å°±æ˜¯ä¸€ä¸ªå…³äºä¸Šä¸‹æ–‡çš„ç±»ï¼Œå®ƒåœ¨æ•´ä¸ªç³»ç»Ÿçš„ç”Ÿå‘½å‘¨æœŸä¸­ä¿å­˜äº†é…ç½®ä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯ä»¥åŠæ³¨å†Œçš„ bean ç­‰ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</p>
<p>è¿™æ ·çš„è§£é‡Šå¯èƒ½æœ‰ç‚¹æŠ½è±¡ï¼Œæˆ‘ä»¬ä¸å¦¨é€šè¿‡ä¸€ä¸ªå…·ä½“çš„æ¡ˆä¾‹ï¼Œæ¥çœ‹çœ‹åˆ°åº•åœ¨ä»€ä¹ˆçš„åœºæ™¯ä¸‹æ‰éœ€è¦ä¸Šä¸‹æ–‡å‘¢ï¼Ÿ</p>
<p>åœ¨æ‰§è¡Œä¸€ä¸ªæ¯”è¾ƒé•¿çš„è¯·æ±‚ä»»åŠ¡æ—¶ï¼Œè¿™ä¸ªè¯·æ±‚å¯èƒ½ä¼šç»å†å¾ˆå¤šå±‚çš„æ–¹æ³•è°ƒç”¨ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦å°†æœ€å¼€å§‹çš„æ–¹æ³•çš„ä¸­é—´ç»“æœä¼ é€’åˆ°æœ«å°¾çš„æ–¹æ³•ä¸­è¿›è¡Œè®¡ç®—ï¼Œä¸€ä¸ªç®€å•çš„å®ç°æ–¹å¼å°±æ˜¯åœ¨æ¯ä¸ªå‡½æ•°ä¸­æ–°å¢è¿™ä¸ªä¸­é—´ç»“æœçš„å‚æ•°ï¼Œä¾æ¬¡ä¼ é€’ä¸‹å»ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>public class ContextTest {
 
// ä¸Šä¸‹æ–‡ç±»
public class Context {
private String name;
private long id
 
public long getId() {
return id;
}
 
public void setId(long id) {
this.id = id;
}
 
public String getName() {
return this.name;
}
 
public void setName(String name) {
this.name = name;
}
}
 
// è®¾ç½®ä¸Šä¸‹æ–‡åå­—
public class QueryNameAction {
public void execute(Context context) {
try {
Thread.sleep(1000L);
String name = Thread.currentThread().getName();
context.setName(name);
} catch (InterruptedException e) {
e.printStackTrace();
}
}
}
 
// è®¾ç½®ä¸Šä¸‹æ–‡ ID
public class QueryIdAction {
public void execute(Context context) {
try {
Thread.sleep(1000L);
long id = Thread.currentThread().getId();
context.setId(id);
} catch (InterruptedException e) {
e.printStackTrace();
}
}
}
 
// æ‰§è¡Œæ–¹æ³•
public class ExecutionTask implements Runnable {
 
private QueryNameAction queryNameAction = new QueryNameAction();
private QueryIdAction queryIdAction = new QueryIdAction();
 
@Override
public void run() {
final Context context = new Context();
queryNameAction.execute(context);
System.out.println(&quot;The name query successful&quot;);
queryIdAction.execute(context);
System.out.println(&quot;The id query successful&quot;);
 
System.out.println(&quot;The Name is &quot; + context.getName() + &quot; and id &quot; + context.getId());
}
}
 
public static void main(String[] args) {
IntStream.range(1, 5).forEach(i -&gt; new Thread(new ContextTest().new ExecutionTask()).start());
}
}
</code></pre><p>æ‰§è¡Œç»“æœï¼š</p>
<pre tabindex="0"><code>The name query successful
The name query successful
The name query successful
The name query successful
The id query successful
The id query successful
The id query successful
The id query successful
The Name is Thread-1 and id 11
The Name is Thread-2 and id 12
The Name is Thread-3 and id 13
The Name is Thread-0 and id 10
</code></pre><p>ç„¶è€Œè¿™ç§æ–¹å¼å¤ªç¬¨æ‹™äº†ï¼Œæ¯æ¬¡è°ƒç”¨æ–¹æ³•æ—¶ï¼Œéƒ½éœ€è¦ä¼ å…¥ Context ä½œä¸ºå‚æ•°ï¼Œè€Œä¸”å½±å“ä¸€äº›ä¸­é—´å…¬å…±æ–¹æ³•çš„å°è£…ã€‚</p>
<p>é‚£èƒ½ä¸èƒ½è®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡å‘¢ï¼Ÿå¦‚æœæ˜¯åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨ï¼Œè¿™æ ·çš„è¯å°±åˆæ¶‰åŠåˆ°äº†é”ç«äº‰ã€‚</p>
<p>é™¤äº†ä»¥ä¸Šè¿™äº›æ–¹æ³•ï¼Œå…¶å®æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ ThreadLocal å®ç°ä¸Šä¸‹æ–‡ã€‚ThreadLocal æ˜¯çº¿ç¨‹æœ¬åœ°å˜é‡ï¼Œå¯ä»¥å®ç°å¤šçº¿ç¨‹çš„æ•°æ®éš”ç¦»ã€‚ThreadLocal ä¸ºæ¯ä¸€ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çº¿ç¨‹éƒ½æä¾›ä¸€ä»½ç‹¬ç«‹çš„å‰¯æœ¬ï¼Œçº¿ç¨‹é—´çš„æ•°æ®æ˜¯éš”ç¦»çš„ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹åªèƒ½è®¿é—®å„è‡ªå†…éƒ¨çš„å‰¯æœ¬å˜é‡ã€‚</p>
<p>ThreadLocal ä¸­æœ‰ä¸‰ä¸ªå¸¸ç”¨çš„æ–¹æ³•ï¼šsetã€getã€initialValueï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥çœ‹çœ‹ ThreadLocal çš„ä½¿ç”¨ï¼š</p>
<pre tabindex="0"><code>private void testThreadLocal() {
    Thread t = new Thread() {
        ThreadLocal&lt;String&gt; mStringThreadLocal = new ThreadLocal&lt;String&gt;();
 
        @Override
        public void run() {
            super.run();
            mStringThreadLocal.set(&quot;test&quot;);
            mStringThreadLocal.get();
        }
    };
 
    t.start();
}
</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ ThreadLocal æ¥é‡æ–°å®ç°æœ€å¼€å§‹çš„ä¸Šä¸‹æ–‡è®¾è®¡ã€‚ä½ ä¼šå‘ç°ï¼Œæˆ‘ä»¬åœ¨ä¸¤ä¸ªæ–¹æ³•ä¸­å¹¶æ²¡æœ‰é€šè¿‡å˜é‡æ¥ä¼ é€’ä¸Šä¸‹æ–‡ï¼Œåªæ˜¯é€šè¿‡ ThreadLocal è·å–äº†å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š</p>
<pre tabindex="0"><code>public class ContextTest {
// ä¸Šä¸‹æ–‡ç±»
public static class Context {
private String name;
private long id;
 
public long getId() {
return id;
}
 
public void setId(long id) {
this.id = id;
}
 
public String getName() {
return this.name;
}
 
public void setName(String name) {
this.name = name;
}
}
 
// å¤åˆ¶ä¸Šä¸‹æ–‡åˆ° ThreadLocal ä¸­
public final static class ActionContext {
 
private static final ThreadLocal&lt;Context&gt; threadLocal = new ThreadLocal&lt;Context&gt;() {
@Override
protected Context initialValue() {
return new Context();
}
};
 
public static ActionContext getActionContext() {
return ContextHolder.actionContext;
}
 
public Context getContext() {
return threadLocal.get();
}
 
// è·å– ActionContext å•ä¾‹
public static class ContextHolder {
private final static ActionContext actionContext = new ActionContext();
}
}
 
// è®¾ç½®ä¸Šä¸‹æ–‡åå­—
public class QueryNameAction {
public void execute() {
try {
Thread.sleep(1000L);
String name = Thread.currentThread().getName();
ActionContext.getActionContext().getContext().setName(name);
} catch (InterruptedException e) {
e.printStackTrace();
}
}
}
 
// è®¾ç½®ä¸Šä¸‹æ–‡ ID
public class QueryIdAction {
public void execute() {
try {
Thread.sleep(1000L);
long id = Thread.currentThread().getId();
ActionContext.getActionContext().getContext().setId(id);
} catch (InterruptedException e) {
e.printStackTrace();
}
}
}
 
// æ‰§è¡Œæ–¹æ³•
public class ExecutionTask implements Runnable {
private QueryNameAction queryNameAction = new QueryNameAction();
private QueryIdAction queryIdAction = new QueryIdAction();
 
@Override
public void run() {
queryNameAction.execute();// è®¾ç½®çº¿ç¨‹å
System.out.println(&quot;The name query successful&quot;);
queryIdAction.execute();// è®¾ç½®çº¿ç¨‹ ID
System.out.println(&quot;The id query successful&quot;);
 
System.out.println(&quot;The Name is &quot; + ActionContext.getActionContext().getContext().getName() + &quot; and id &quot; + ActionContext.getActionContext().getContext().getId())
}
}
 
public static void main(String[] args) {
IntStream.range(1, 5).forEach(i -&gt; new Thread(new ContextTest().new ExecutionTask()).start());
}
}
</code></pre><p>è¿è¡Œç»“æœï¼š</p>
<pre tabindex="0"><code>The name query successful
The name query successful
The name query successful
The name query successful
The id query successful
The id query successful
The id query successful
The id query successful
The Name is Thread-2 and id 12
The Name is Thread-0 and id 10
The Name is Thread-1 and id 11
The Name is Thread-3 and id 13
</code></pre><h2 id="thread-per-message-è®¾è®¡æ¨¡å¼">Thread-Per-Message è®¾è®¡æ¨¡å¼</h2>
<p>Thread-Per-Message è®¾è®¡æ¨¡å¼ç¿»è¯‘è¿‡æ¥çš„æ„æ€å°±æ˜¯æ¯ä¸ªæ¶ˆæ¯ä¸€ä¸ªçº¿ç¨‹çš„æ„æ€ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨å¤„ç† Socket é€šä¿¡çš„æ—¶å€™ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å¤„ç†äº‹ä»¶ç›‘å¬ä»¥åŠ I/O è¯»å†™ï¼Œå¦‚æœ I/O è¯»å†™æ“ä½œéå¸¸è€—æ—¶ï¼Œè¿™ä¸ªæ—¶å€™ä¾¿ä¼šå½±å“åˆ°äº‹ä»¶ç›‘å¬å¤„ç†äº‹ä»¶ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™ Thread-Per-Message æ¨¡å¼å°±å¯ä»¥å¾ˆå¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªçº¿ç¨‹ç›‘å¬ I/O äº‹ä»¶ï¼Œæ¯å½“ç›‘å¬åˆ°ä¸€ä¸ª I/O äº‹ä»¶ï¼Œåˆ™äº¤ç»™å¦ä¸€ä¸ªå¤„ç†çº¿ç¨‹æ‰§è¡Œ I/O æ“ä½œã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬è¿˜æ˜¯é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥å­¦ä¹ ä¸‹è¯¥è®¾è®¡æ¨¡å¼çš„å®ç°ã€‚</p>
<pre tabindex="0"><code>//IO å¤„ç†
public class ServerHandler implements Runnable{
private Socket socket;
 
    public ServerHandler(Socket socket) {
        this.socket = socket;
    }
    
    public void run() {
        BufferedReader in = null;
        PrintWriter out = null;
        String msg = null;
        try {
            in = new BufferedReader(new InputStreamReader(socket.getInputStream()));
            out = new PrintWriter(socket.getOutputStream(),true);
            while ((msg = in.readLine()) != null &amp;&amp; msg.length()!=0) {// å½“è¿æ¥æˆåŠŸååœ¨æ­¤ç­‰å¾…æ¥æ”¶æ¶ˆæ¯ï¼ˆæŒ‚èµ·ï¼Œè¿›å…¥é˜»å¡çŠ¶æ€ï¼‰
                System.out.println(&quot;server received : &quot; + msg);
                out.print(&quot;received~\n&quot;);
                out.flush();
            }
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
        try {
                in.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
            try {
                out.close();
            } catch (Exception e) {
                e.printStackTrace();
            }
            try {
                socket.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
}
//Socket å¯åŠ¨æœåŠ¡
public class Server {

private static int DEFAULT_PORT = 12345;
private static ServerSocket server;
 
public static void start() throws IOException {
start(DEFAULT_PORT);
}
 
public static void start(int port) throws IOException {
if (server != null) {
return;
}

try {
// å¯åŠ¨æœåŠ¡
server = new ServerSocket(port);
// é€šè¿‡æ— çº¿å¾ªç¯ç›‘å¬å®¢æˆ·ç«¯è¿æ¥
while (true) {

Socket socket = server.accept();
// å½“æœ‰æ–°çš„å®¢æˆ·ç«¯æ¥å…¥æ—¶ï¼Œä¼šæ‰§è¡Œä¸‹é¢çš„ä»£ç 
long start = System.currentTimeMillis();
new Thread(new ServerHandler(socket)).start();

long end = System.currentTimeMillis();
 
System.out.println(&quot;Spend time is &quot; + (end - start));
}
} finally {
if (server != null) {
System.out.println(&quot; æœåŠ¡å™¨å·²å…³é—­ã€‚&quot;);
server.close();
}
 
}
 
}

public static void main(String[] args) throws InterruptedException{
 
// è¿è¡ŒæœåŠ¡ç«¯
new Thread(new Runnable() {
public void run() {
try {
Server.start();
} catch (IOException e) {
e.printStackTrace();
}
}
}).start();
 
}
}
</code></pre><p>ä»¥ä¸Šï¼Œæˆ‘ä»¬æ˜¯å®Œæˆäº†ä¸€ä¸ªä½¿ç”¨ Thread-Per-Message è®¾è®¡æ¨¡å¼å®ç°çš„ Socket æœåŠ¡ç«¯çš„ä»£ç ã€‚ä½†è¿™é‡Œæ˜¯æœ‰ä¸€ä¸ªé—®é¢˜çš„ï¼Œä½ å‘ç°äº†å—ï¼Ÿ</p>
<p>ä½¿ç”¨è¿™ç§è®¾è®¡æ¨¡å¼ï¼Œå¦‚æœé‡åˆ°å¤§çš„é«˜å¹¶å‘ï¼Œå°±ä¼šå‡ºç°ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚å¦‚æœé’ˆå¯¹æ¯ä¸ª I/O è¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ï¼Œåœ¨æœ‰å¤§é‡è¯·æ±‚åŒæ—¶è¿›æ¥æ—¶ï¼Œå°±ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œè€Œæ­¤æ—¶ JVM æœ‰å¯èƒ½ä¼šå› ä¸ºæ— æ³•å¤„ç†è¿™ä¹ˆå¤šçº¿ç¨‹ï¼Œè€Œå‡ºç°å†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚</p>
<p>é€€ä¸€æ­¥è®²ï¼Œå³ä½¿æ˜¯ä¸ä¼šæœ‰å¤§é‡çº¿ç¨‹çš„åœºæ™¯ï¼Œæ¯æ¬¡è¯·æ±‚è¿‡æ¥ä¹Ÿéƒ½éœ€è¦åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ï¼Œè¿™å¯¹ç³»ç»Ÿæ¥è¯´ï¼Œä¹Ÿæ˜¯ä¸€ç¬”ä¸å°çš„æ€§èƒ½å¼€é”€ã€‚</p>
<p>é¢å¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± æ¥ä»£æ›¿çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…åˆ›å»ºå¤§é‡çº¿ç¨‹è€Œå¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼Œæ˜¯ä¸€ç§å¾ˆå¥½çš„è°ƒä¼˜æ–¹æ³•ã€‚</p>
<h2 id="worker-thread-è®¾è®¡æ¨¡å¼">Worker-Thread è®¾è®¡æ¨¡å¼</h2>
<p>è¿™é‡Œçš„ Worker æ˜¯å·¥äººçš„æ„æ€ï¼Œä»£è¡¨åœ¨ Worker Thread è®¾è®¡æ¨¡å¼ä¸­ï¼Œä¼šæœ‰ä¸€äº›å·¥äººï¼ˆçº¿ç¨‹ï¼‰ä¸æ–­è½®æµå¤„ç†è¿‡æ¥çš„å·¥ä½œï¼Œå½“æ²¡æœ‰å·¥ä½œæ—¶ï¼Œå·¥äººåˆ™ä¼šå¤„äºç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°æœ‰æ–°çš„å·¥ä½œè¿›æ¥ã€‚é™¤äº†å·¥äººè§’è‰²ï¼ŒWorker Thread è®¾è®¡æ¨¡å¼ä¸­è¿˜åŒ…æ‹¬äº†æµæ°´çº¿å’Œäº§å“ã€‚</p>
<p>è¿™ç§è®¾è®¡æ¨¡å¼ç›¸æ¯” Thread-Per-Message è®¾è®¡æ¨¡å¼ï¼Œå¯ä»¥å‡å°‘é¢‘ç¹åˆ›å»ºã€é”€æ¯çº¿ç¨‹æ‰€å¸¦æ¥çš„æ€§èƒ½å¼€é”€ï¼Œè¿˜æœ‰æ— é™åˆ¶åœ°åˆ›å»ºçº¿ç¨‹æ‰€å¸¦æ¥çš„å†…å­˜æº¢å‡ºé£é™©ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å‡è®¾ä¸€ä¸ªåœºæ™¯æ¥çœ‹ä¸‹è¯¥æ¨¡å¼çš„å®ç°ï¼Œé€šè¿‡ Worker Thread è®¾è®¡æ¨¡å¼æ¥å®Œæˆä¸€ä¸ªç‰©æµåˆ†æ‹£çš„ä½œä¸šã€‚</p>
<p>å‡è®¾ä¸€ä¸ªç‰©æµä»“åº“çš„ç‰©æµåˆ†æ‹£æµæ°´çº¿ä¸Šæœ‰ 8 ä¸ªæœºå™¨äººï¼Œå®ƒä»¬ä¸æ–­ä»æµæ°´çº¿ä¸Šè·å–åŒ…è£¹å¹¶å¯¹å…¶è¿›è¡ŒåŒ…è£…ï¼Œé€å…¶ä¸Šè½¦ã€‚å½“ä»“åº“ä¸­çš„å•†å“è¢«æ‰“åŒ…å¥½åï¼Œä¼šæŠ•æ”¾åˆ°ç‰©æµåˆ†æ‹£æµæ°´çº¿ä¸Šï¼Œè€Œä¸æ˜¯ç›´æ¥äº¤ç»™æœºå™¨äººï¼Œæœºå™¨äººä¼šå†ä»æµæ°´çº¿ä¸­éšæœºåˆ†æ‹£åŒ…è£¹ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>// åŒ…è£¹ç±»
public class Package {
private String name;
private String address;
 
public String getName() {
return name;
}
 
public void setName(String name) {
this.name = name;
}
 
public String getAddress() {
return address;
}
 
public void setAddress(String address) {
this.address = address;
}
 
public void execute() {
System.out.println(Thread.currentThread().getName()+&quot; executed &quot;+this);
}
}
// æµæ°´çº¿
public class PackageChannel {
private final static int MAX_PACKAGE_NUM = 100;
 
private final Package[] packageQueue;
private final Worker[] workerPool;
private int head;
private int tail;
private int count;
 
public PackageChannel(int workers) {
this.packageQueue = new Package[MAX_PACKAGE_NUM];
this.head = 0;
this.tail = 0;
this.count = 0;
this.workerPool = new Worker[workers];
this.init();
}
 
private void init() {
for (int i = 0; i &lt; workerPool.length; i++) {
workerPool[i] = new Worker(&quot;Worker-&quot; + i, this);
}
}
 
/**
 * push switch to start all of worker to work
 */
public void startWorker() {
Arrays.asList(workerPool).forEach(Worker::start);
}
 
public synchronized void put(Package packagereq) {
while (count &gt;= packageQueue.length) {
try {
this.wait();
} catch (InterruptedException e) {
e.printStackTrace();
}
}
this.packageQueue[tail] = packagereq;
this.tail = (tail + 1) % packageQueue.length;
this.count++;
this.notifyAll();
}
 
public synchronized Package take() {
while (count &lt;= 0) {
try {
this.wait();
} catch (InterruptedException e) {
e.printStackTrace();
}
}
Package request = this.packageQueue[head];
this.head = (this.head + 1) % this.packageQueue.length;
this.count--;
this.notifyAll();
return request;
}
 
}
// æœºå™¨äºº
public class Worker extends Thread{
 private static final Random random = new Random(System.currentTimeMillis());
 private final PackageChannel channel;
 
    public Worker(String name, PackageChannel channel) {
        super(name);
        this.channel = channel;
    }
 
    @Override
    public void run() {
        while (true) {
            channel.take().execute();
 
            try {
                Thread.sleep(random.nextInt(1000));
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
 
}
public class Test {
   public static void main(String[] args) {
            // æ–°å»º 8 ä¸ªå·¥äºº
        final PackageChannel channel = new PackageChannel(8);
            // å¼€å§‹å·¥ä½œ
        channel.startWorker();
            // ä¸ºæµæ°´çº¿æ·»åŠ åŒ…è£¹
        for(int i=0; i&lt;100; i++) {
         Package packagereq = new Package();
         packagereq.setAddress(&quot;test&quot;);
         packagereq.setName(&quot;test&quot;);
         channel.put(packagereq);
        }
    }
}
</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæœ‰ 8 ä¸ªå·¥äººåœ¨ä¸æ–­åœ°åˆ†æ‹£ä»“åº“ä¸­å·²ç»åŒ…è£…å¥½çš„å•†å“ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>å¹³æ—¶ï¼Œå¦‚æœéœ€è¦ä¼ é€’æˆ–éš”ç¦»ä¸€äº›çº¿ç¨‹å˜é‡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸Šä¸‹æ–‡è®¾è®¡æ¨¡å¼ã€‚åœ¨æ•°æ®åº“è¯»å†™åˆ†ç¦»çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œåˆ™ç»å¸¸ä¼šç”¨åˆ° ThreadLocal å®ç°åŠ¨æ€åˆ‡æ¢æ•°æ®æºæ“ä½œã€‚ä½†åœ¨ä½¿ç”¨ ThreadLocal æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„å†…å­˜æ³„æ¼é—®é¢˜ï¼Œåœ¨ä¹‹å‰çš„[ç¬¬ 25 è®²]ä¸­ï¼Œæˆ‘ä»¬å·²ç»è®¨è®ºè¿‡è¿™ä¸ªé—®é¢˜äº†ã€‚</p>
<p>å½“ä¸»çº¿ç¨‹å¤„ç†æ¯æ¬¡è¯·æ±‚éƒ½éå¸¸è€—æ—¶æ—¶ï¼Œå°±å¯èƒ½å‡ºç°é˜»å¡é—®é¢˜ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥è€ƒè™‘å°†ä¸»çº¿ç¨‹ä¸šåŠ¡åˆ†å·¥åˆ°æ–°çš„ä¸šåŠ¡çº¿ç¨‹ä¸­ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¹¶è¡Œå¤„ç†èƒ½åŠ›ã€‚è€Œ Thread-Per-Message è®¾è®¡æ¨¡å¼ä»¥åŠ Worker-Thread è®¾è®¡æ¨¡å¼åˆ™éƒ½æ˜¯é€šè¿‡å¤šçº¿ç¨‹åˆ†å·¥æ¥æé«˜ç³»ç»Ÿå¹¶è¡Œå¤„ç†èƒ½åŠ›çš„è®¾è®¡æ¨¡å¼ã€‚</p>
<h2 id="æ€è€ƒé¢˜">æ€è€ƒé¢˜</h2>
<p>é™¤äº†ä»¥ä¸Šè¿™äº›å¤šçº¿ç¨‹çš„è®¾è®¡æ¨¡å¼ï¼Œå¹³æ—¶ä½ è¿˜ä½¿ç”¨è¿‡å…¶å®ƒçš„è®¾è®¡æ¨¡å¼æ¥ä¼˜åŒ–å¤šçº¿ç¨‹ä¸šåŠ¡å—ï¼Ÿ</p>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/27-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F%E4%B8%8E%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F%E6%8F%90%E5%8D%87%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E7%9A%84%E5%88%A9%E5%99%A8/"><span>27 åŸå‹æ¨¡å¼ä¸äº«å…ƒæ¨¡å¼ï¼šæå‡ç³»ç»Ÿæ€§èƒ½çš„åˆ©å™¨</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/29-%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%BC%8F%E7%94%B5%E5%95%86%E5%BA%93%E5%AD%98%E8%AE%BE%E8%AE%A1%E4%BC%98%E5%8C%96/"><span>29 ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼šç”µå•†åº“å­˜è®¾è®¡ä¼˜åŒ–</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 28280 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>