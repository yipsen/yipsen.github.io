<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>03 è§„èŒƒå…¼å®¹ï¼šJDBC è§„èŒƒä¸ ShardingSphere æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ | Yipsen Ye</title>
<meta name="description" content="æˆ‘ä»¬çŸ¥é“ ShardingSphere æ˜¯ä¸€ç§å…¸å‹çš„å®¢æˆ·ç«¯åˆ†ç‰‡è§£å†³æ–¹æ¡ˆï¼Œè€Œå®¢æˆ·ç«¯åˆ†ç‰‡çš„å®ç°æ–¹å¼ä¹‹ä¸€å°±æ˜¯é‡å†™ JDBC è§„èŒƒã€‚åœ¨ä¸Šä¸€è¯¾æ—¶ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä»‹ç»äº†ï¼ŒShardingSphere åœ¨è®¾è®¡ä¸Šä»ä¸€å¼€å§‹å°±å®Œå…¨å…¼å®¹ JDBC è§„èŒƒï¼ŒShardingSphere å¯¹å¤–æš´éœ²çš„ä¸€å¥—åˆ†ç‰‡æ“ä½œæ¥å£ä¸ JDBC è§„èŒƒä¸­æ‰€æä¾›çš„æ¥å£å®Œå…¨ä¸€è‡´ã€‚
è®²åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šè§‰å¾—æœ‰ç‚¹ç¥å¥‡ï¼ŒShardingSphere ç©¶ç«Ÿæ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼ï¼Œå®ç°äº†ä¸ JDBC è§„èŒƒå®Œå…¨å…¼å®¹çš„ API æ¥æä¾›åˆ†ç‰‡åŠŸèƒ½å‘¢ï¼Ÿ
è¿™ä¸ªé—®é¢˜éå¸¸é‡è¦ï¼Œå€¼å¾—æˆ‘ä»¬ä¸“é—¨èŠ±ä¸€ä¸ªè¯¾æ—¶çš„å†…å®¹æ¥è¿›è¡Œåˆ†æå’Œè®²è§£ã€‚å¯ä»¥è¯´ï¼Œç†è§£ JDBC è§„èŒƒä»¥åŠ ShardingSphere å¯¹ JDBC è§„èŒƒçš„é‡å†™æ–¹å¼ï¼Œæ˜¯æ­£ç¡®ä½¿ç”¨ ShardingSphere å®ç°æ•°æ®åˆ†ç‰‡çš„å‰æã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ·±å…¥è®¨è®º JDBC è§„èŒƒä¸ ShardingSphere çš„è¿™å±‚å…³ç³»ï¼Œå¸®ä½ ä»åº•å±‚è®¾è®¡ä¸Šè§£å¼€å…¶ä¸­çš„ç¥å¥‡ä¹‹å¤„ã€‚
JDBC è§„èŒƒç®€ä»‹ ShardingSphere æä¾›äº†ä¸ JDBC è§„èŒƒå®Œå…¨å…¼å®¹çš„å®ç°è¿‡ç¨‹ï¼Œåœ¨å¯¹è¿™ä¸€è¿‡ç¨‹è¿›è¡Œè¯¦ç»†å±•å¼€ä¹‹å‰ï¼Œå…ˆæ¥å›é¡¾ä¸€ä¸‹ JDBC è§„èŒƒã€‚JDBCï¼ˆJava Database Connectivityï¼‰çš„è®¾è®¡åˆè¡·æ˜¯æä¾›ä¸€å¥—ç”¨äºå„ç§æ•°æ®åº“çš„ç»Ÿä¸€æ ‡å‡†ï¼Œè€Œä¸åŒçš„æ•°æ®åº“å‚å®¶å…±åŒéµå®ˆè¿™å¥—æ ‡å‡†ï¼Œå¹¶æä¾›å„è‡ªçš„å®ç°æ–¹æ¡ˆä¾›åº”ç”¨ç¨‹åºè°ƒç”¨ã€‚ä½œä¸ºç»Ÿä¸€æ ‡å‡†ï¼ŒJDBC è§„èŒƒå…·æœ‰å®Œæ•´çš„æ¶æ„ä½“ç³»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
JDBC æ¶æ„ä¸­çš„ Driver Manager è´Ÿè´£åŠ è½½å„ç§ä¸åŒçš„é©±åŠ¨ç¨‹åºï¼ˆDriverï¼‰ï¼Œå¹¶æ ¹æ®ä¸åŒçš„è¯·æ±‚ï¼Œå‘è°ƒç”¨è€…è¿”å›ç›¸åº”çš„æ•°æ®åº“è¿æ¥ï¼ˆConnectionï¼‰ã€‚è€Œåº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨ JDBC API æ¥å®ç°å¯¹æ•°æ®åº“çš„æ“ä½œã€‚å¯¹äºå¼€å‘äººå‘˜è€Œè¨€ï¼ŒJDBC API æ˜¯æˆ‘ä»¬è®¿é—®æ•°æ®åº“çš„ä¸»è¦é€”å¾„ï¼Œä¹Ÿæ˜¯ ShardingSphere é‡å†™ JDBC è§„èŒƒå¹¶æ·»åŠ åˆ†ç‰‡åŠŸèƒ½çš„å…¥å£ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ JDBC å¼€å‘ä¸€ä¸ªè®¿é—®æ•°æ®åº“çš„å¤„ç†æµç¨‹ï¼Œå¸¸è§çš„ä»£ç é£æ ¼å¦‚ä¸‹æ‰€ç¤ºï¼š
// åˆ›å»ºæ± åŒ–çš„æ•°æ®æºPooledDataSource dataSource = new PooledDataSource ();// è®¾ç½®MySQL DriverdataSource.setDriver (&amp;quot;com.mysql.jdbc.Driver&amp;quot;);// è®¾ç½®æ•°æ®åº“URLã€ç”¨æˆ·åå’Œå¯†ç dataSource.">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="nav-logo">
    <a href="http://yipsen.github.io/">
        
        <span class="nav-title">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æ–‡ç« </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/shardingsphere%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86%e7%b2%be%e8%ae%b2/">ShardingSphereæ ¸å¿ƒåŸç†ç²¾è®²</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/00-%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E5%AD%A6%E4%B9%A0%E4%B8%80%E6%AC%BE%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E5%BC%80%E6%BA%90%E6%A1%86%E6%9E%B6/">00 å¦‚ä½•æ­£ç¡®å­¦ä¹ ä¸€æ¬¾åˆ†åº“åˆ†è¡¨å¼€æºæ¡†æ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/01-%E4%BB%8E%E7%90%86%E8%AE%BA%E5%88%B0%E5%AE%9E%E8%B7%B5%E5%A6%82%E4%BD%95%E8%AE%A9%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E7%9C%9F%E6%AD%A3%E8%90%BD%E5%9C%B0/">01 ä»ç†è®ºåˆ°å®è·µï¼šå¦‚ä½•è®©åˆ†åº“åˆ†è¡¨çœŸæ­£è½åœ°ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/02-%E9%A1%B6%E7%BA%A7%E9%A1%B9%E7%9B%AEshardingsphere-%E6%98%AF%E4%B8%80%E6%AC%BE%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84-apache-%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6/">02 é¡¶çº§é¡¹ç›®ï¼šShardingSphere æ˜¯ä¸€æ¬¾ä»€ä¹ˆæ ·çš„ Apache å¼€æºè½¯ä»¶ï¼Ÿ</a></li>
                
                
                
                    <li>03 è§„èŒƒå…¼å®¹ï¼šJDBC è§„èŒƒä¸ ShardingSphere æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/04-%E5%BA%94%E7%94%A8%E9%9B%86%E6%88%90%E5%9C%A8%E4%B8%9A%E5%8A%A1%E7%B3%BB%E7%BB%9F%E4%B8%AD%E4%BD%BF%E7%94%A8-shardingsphere-%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B/">04 åº”ç”¨é›†æˆï¼šåœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ä½¿ç”¨ ShardingSphere çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/05-%E9%85%8D%E7%BD%AE%E9%A9%B1%E5%8A%A8shardingsphere-%E4%B8%AD%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BD%93%E7%B3%BB%E6%98%AF%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E7%9A%84/">05 é…ç½®é©±åŠ¨ï¼šShardingSphere ä¸­çš„é…ç½®ä½“ç³»æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/09-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E4%B8%8E%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1/">09 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ä½¿ç”¨å¼ºä¸€è‡´æ€§äº‹åŠ¡ä¸æŸ”æ€§äº‹åŠ¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/10-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E5%A6%82%E4%BD%95%E7%A1%AE%E4%BF%9D%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%89%E5%85%A8%E8%AE%BF%E9%97%AE/">10 æ•°æ®è„±æ•ï¼šå¦‚ä½•ç¡®ä¿æ•æ„Ÿæ•°æ®çš„å®‰å…¨è®¿é—®ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/11-%E7%BC%96%E6%8E%92%E6%B2%BB%E7%90%86%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E5%8A%A8%E6%80%81%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/">11 ç¼–æ’æ²»ç†ï¼šå¦‚ä½•å®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„åŠ¨æ€é…ç½®ç®¡ç†ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/12-%E4%BB%8E%E5%BA%94%E7%94%A8%E5%88%B0%E5%8E%9F%E7%90%86%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E9%98%85%E8%AF%BB-shardingsphere-%E6%BA%90%E7%A0%81/">12 ä»åº”ç”¨åˆ°åŸç†ï¼šå¦‚ä½•é«˜æ•ˆé˜…è¯» ShardingSphere æºç ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/13-%E5%BE%AE%E5%86%85%E6%A0%B8%E6%9E%B6%E6%9E%84shardingsphere-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%89%A9%E5%B1%95%E6%80%A7/">13 å¾®å†…æ ¸æ¶æ„ï¼šShardingSphere å¦‚ä½•å®ç°ç³»ç»Ÿçš„æ‰©å±•æ€§ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/14-%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AEshardingsphere-%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AE%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/">14 åˆ†å¸ƒå¼ä¸»é”®ï¼šShardingSphere ä¸­æœ‰å“ªäº›åˆ†å¸ƒå¼ä¸»é”®å®ç°æ–¹å¼ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/15-%E8%A7%A3%E6%9E%90%E5%BC%95%E6%93%8Esql-%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%8C%85%E6%8B%AC%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E9%98%B6%E6%AE%B5%E4%B8%8A/">15 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/16-%E8%A7%A3%E6%9E%90%E5%BC%95%E6%93%8Esql-%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%8C%85%E6%8B%AC%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E9%98%B6%E6%AE%B5%E4%B8%8B/">16 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/17-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E5%88%86%E7%89%87%E8%B7%AF%E7%94%B1%E6%A0%B8%E5%BF%83%E7%B1%BB-shardingrouter-%E7%9A%84%E8%BF%90%E4%BD%9C%E6%9C%BA%E5%88%B6/">17 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•ç†è§£åˆ†ç‰‡è·¯ç”±æ ¸å¿ƒç±» ShardingRouter çš„è¿ä½œæœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/18-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E7%9A%84%E5%88%86%E7%89%87%E8%B7%AF%E7%94%B1%E5%92%8C%E5%B9%BF%E6%92%AD%E8%B7%AF%E7%94%B1/">18 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•å®ç°æ•°æ®è®¿é—®çš„åˆ†ç‰‡è·¯ç”±å’Œå¹¿æ’­è·¯ç”±ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/19-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E5%9C%A8%E8%B7%AF%E7%94%B1%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%9B%86%E6%88%90%E5%A4%9A%E7%A7%8D%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5%E5%92%8C%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95/">19 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•åœ¨è·¯ç”±è¿‡ç¨‹ä¸­é›†æˆå¤šç§è·¯ç”±ç­–ç•¥å’Œè·¯ç”±ç®—æ³•ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/20-%E6%94%B9%E5%86%99%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84-sql-%E6%94%B9%E5%86%99%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6/">20 æ”¹å†™å¼•æ“ï¼šå¦‚ä½•ç†è§£è£…é¥°å™¨æ¨¡å¼ä¸‹çš„ SQL æ”¹å†™å®ç°æœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/21-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%88%86%E7%89%87%E7%8E%AF%E5%A2%83%E4%B8%8B-sql-%E6%89%A7%E8%A1%8C%E7%9A%84%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E6%8A%BD%E8%B1%A1/">21 æ‰§è¡Œå¼•æ“ï¼šåˆ†ç‰‡ç¯å¢ƒä¸‹ SQL æ‰§è¡Œçš„æ•´ä½“æµç¨‹åº”è¯¥å¦‚ä½•è¿›è¡ŒæŠ½è±¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/22-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E6%8A%8A%E6%8F%A1-shardingsphere-%E4%B8%AD%E7%9A%84-executor-%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B%E4%B8%8A/">22 æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•æŠŠæ¡ ShardingSphere ä¸­çš„ Executor æ‰§è¡Œæ¨¡å‹ï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/23-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E6%8A%8A%E6%8F%A1-shardingsphere-%E4%B8%AD%E7%9A%84-executor-%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B%E4%B8%8B/">23 æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•æŠŠæ¡ ShardingSphere ä¸­çš„ Executor æ‰§è¡Œæ¨¡å‹ï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/24-%E5%BD%92%E5%B9%B6%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%95%B0%E6%8D%AE%E5%BD%92%E5%B9%B6%E7%9A%84%E7%B1%BB%E5%9E%8B%E4%BB%A5%E5%8F%8A%E7%AE%80%E5%8D%95%E5%BD%92%E5%B9%B6%E7%AD%96%E7%95%A5%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/">24 å½’å¹¶å¼•æ“ï¼šå¦‚ä½•ç†è§£æ•°æ®å½’å¹¶çš„ç±»å‹ä»¥åŠç®€å•å½’å¹¶ç­–ç•¥çš„å®ç°è¿‡ç¨‹ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/25-%E5%BD%92%E5%B9%B6%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%B5%81%E5%BC%8F%E5%BD%92%E5%B9%B6%E5%92%8C%E5%86%85%E5%AD%98%E5%BD%92%E5%B9%B6%E5%9C%A8%E5%A4%8D%E6%9D%82%E5%BD%92%E5%B9%B6%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84%E5%BA%94%E7%94%A8%E6%96%B9%E5%BC%8F/">25 å½’å¹¶å¼•æ“ï¼šå¦‚ä½•ç†è§£æµå¼å½’å¹¶å’Œå†…å­˜å½’å¹¶åœ¨å¤æ‚å½’å¹¶åœºæ™¯ä¸‹çš„åº”ç”¨æ–¹å¼ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/26-%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%99%AE%E9%80%9A%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84%E5%92%8C%E5%88%86%E7%89%87%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84%E5%88%86%E5%88%AB%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%9A%84/">26 è¯»å†™åˆ†ç¦»ï¼šæ™®é€šä¸»ä»æ¶æ„å’Œåˆ†ç‰‡ä¸»ä»æ¶æ„åˆ†åˆ«æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/27-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3-shardingsphere-%E4%B8%AD%E5%AF%B9%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%8A%BD%E8%B1%A1%E8%BF%87%E7%A8%8B/">27 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ç†è§£ ShardingSphere ä¸­å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„æŠ½è±¡è¿‡ç¨‹ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/28-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1shardingsphere-%E4%B8%AD%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E5%92%8C%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1%E6%94%AF%E6%8C%81%E4%B8%8A/">28 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šShardingSphere ä¸­å¦‚ä½•é›†æˆå¼ºä¸€è‡´æ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡æ”¯æŒï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/29-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1shardingsphere-%E4%B8%AD%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E5%92%8C%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1%E6%94%AF%E6%8C%81%E4%B8%8B/">29 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šShardingSphere ä¸­å¦‚ä½•é›†æˆå¼ºä¸€è‡´æ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡æ”¯æŒï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/30-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E6%94%B9%E5%86%99%E5%BC%95%E6%93%8E%E5%AE%9E%E7%8E%B0%E4%BD%8E%E4%BE%B5%E5%85%A5%E6%80%A7%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E6%96%B9%E6%A1%88/">30 æ•°æ®è„±æ•ï¼šå¦‚ä½•åŸºäºæ”¹å†™å¼•æ“å®ç°ä½ä¾µå…¥æ€§æ•°æ®è„±æ•æ–¹æ¡ˆï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/31-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%AE%9E%E7%8E%B0%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E7%9A%84%E5%8A%A8%E6%80%81%E5%8C%96%E7%AE%A1%E7%90%86/">31 é…ç½®ä¸­å¿ƒï¼šå¦‚ä½•åŸºäºé…ç½®ä¸­å¿ƒå®ç°é…ç½®ä¿¡æ¯çš„åŠ¨æ€åŒ–ç®¡ç†ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/32-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BF%E9%97%AE%E7%86%94%E6%96%AD%E6%9C%BA%E5%88%B6/">32 æ³¨å†Œä¸­å¿ƒï¼šå¦‚ä½•åŸºäºæ³¨å†Œä¸­å¿ƒå®ç°æ•°æ®åº“è®¿é—®ç†”æ–­æœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/33-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E-hook-%E6%9C%BA%E5%88%B6%E4%BB%A5%E5%8F%8A-opentracing-%E5%8D%8F%E8%AE%AE%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/">33 é“¾è·¯è·Ÿè¸ªï¼šå¦‚ä½•åŸºäº Hook æœºåˆ¶ä»¥åŠ OpenTracing åè®®å®ç°æ•°æ®è®¿é—®é“¾è·¯è·Ÿè¸ªï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/35-%E7%BB%93%E8%AF%ADshardingsphere-%E6%80%BB%E7%BB%93%E5%8F%8A%E5%B1%95%E6%9C%9B/">35 ç»“è¯­ï¼šShardingSphere æ€»ç»“åŠå±•æœ›</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">03 è§„èŒƒå…¼å®¹ï¼šJDBC è§„èŒƒä¸ ShardingSphere æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</h1>
        <div class="post-info">
            <div class="post-date"> 
                <span>2021-12-22 01:55:45</span>
            </div>
        </div>
        <div class="post-content">
            <p>æˆ‘ä»¬çŸ¥é“ ShardingSphere æ˜¯ä¸€ç§å…¸å‹çš„å®¢æˆ·ç«¯åˆ†ç‰‡è§£å†³æ–¹æ¡ˆï¼Œè€Œå®¢æˆ·ç«¯åˆ†ç‰‡çš„å®ç°æ–¹å¼ä¹‹ä¸€å°±æ˜¯é‡å†™ JDBC è§„èŒƒã€‚åœ¨ä¸Šä¸€è¯¾æ—¶ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä»‹ç»äº†ï¼ŒShardingSphere åœ¨è®¾è®¡ä¸Šä»ä¸€å¼€å§‹å°±å®Œå…¨å…¼å®¹ JDBC è§„èŒƒï¼ŒShardingSphere å¯¹å¤–æš´éœ²çš„ä¸€å¥—åˆ†ç‰‡æ“ä½œæ¥å£ä¸ JDBC è§„èŒƒä¸­æ‰€æä¾›çš„æ¥å£å®Œå…¨ä¸€è‡´ã€‚</p>
<p>è®²åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šè§‰å¾—æœ‰ç‚¹ç¥å¥‡ï¼Œ<strong>ShardingSphere ç©¶ç«Ÿæ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼ï¼Œå®ç°äº†ä¸ JDBC è§„èŒƒå®Œå…¨å…¼å®¹çš„ API æ¥æä¾›åˆ†ç‰‡åŠŸèƒ½å‘¢ï¼Ÿ</strong></p>
<p>è¿™ä¸ªé—®é¢˜éå¸¸é‡è¦ï¼Œå€¼å¾—æˆ‘ä»¬ä¸“é—¨èŠ±ä¸€ä¸ªè¯¾æ—¶çš„å†…å®¹æ¥è¿›è¡Œåˆ†æå’Œè®²è§£ã€‚å¯ä»¥è¯´ï¼Œ<strong>ç†è§£ JDBC è§„èŒƒä»¥åŠ ShardingSphere å¯¹ JDBC è§„èŒƒçš„é‡å†™æ–¹å¼ï¼Œæ˜¯æ­£ç¡®ä½¿ç”¨ ShardingSphere å®ç°æ•°æ®åˆ†ç‰‡çš„å‰æ</strong>ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ·±å…¥è®¨è®º JDBC è§„èŒƒä¸ ShardingSphere çš„è¿™å±‚å…³ç³»ï¼Œå¸®ä½ ä»åº•å±‚è®¾è®¡ä¸Šè§£å¼€å…¶ä¸­çš„ç¥å¥‡ä¹‹å¤„ã€‚</p>
<h3 id="jdbc-è§„èŒƒç®€ä»‹">JDBC è§„èŒƒç®€ä»‹</h3>
<p>ShardingSphere æä¾›äº†ä¸ JDBC è§„èŒƒå®Œå…¨å…¼å®¹çš„å®ç°è¿‡ç¨‹ï¼Œåœ¨å¯¹è¿™ä¸€è¿‡ç¨‹è¿›è¡Œè¯¦ç»†å±•å¼€ä¹‹å‰ï¼Œå…ˆæ¥å›é¡¾ä¸€ä¸‹ JDBC è§„èŒƒã€‚<strong>JDBCï¼ˆJava Database Connectivityï¼‰çš„è®¾è®¡åˆè¡·æ˜¯æä¾›ä¸€å¥—ç”¨äºå„ç§æ•°æ®åº“çš„ç»Ÿä¸€æ ‡å‡†</strong>ï¼Œè€Œä¸åŒçš„æ•°æ®åº“å‚å®¶å…±åŒéµå®ˆè¿™å¥—æ ‡å‡†ï¼Œå¹¶æä¾›å„è‡ªçš„å®ç°æ–¹æ¡ˆä¾›åº”ç”¨ç¨‹åºè°ƒç”¨ã€‚ä½œä¸ºç»Ÿä¸€æ ‡å‡†ï¼ŒJDBC è§„èŒƒå…·æœ‰å®Œæ•´çš„æ¶æ„ä½“ç³»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl7xtaiASay6AAB0vuO1kAA457.png" alt="Drawing 0.png"></p>
<p>JDBC æ¶æ„ä¸­çš„ Driver Manager è´Ÿè´£åŠ è½½å„ç§ä¸åŒçš„é©±åŠ¨ç¨‹åºï¼ˆDriverï¼‰ï¼Œå¹¶æ ¹æ®ä¸åŒçš„è¯·æ±‚ï¼Œå‘è°ƒç”¨è€…è¿”å›ç›¸åº”çš„æ•°æ®åº“è¿æ¥ï¼ˆConnectionï¼‰ã€‚è€Œåº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨ JDBC API æ¥å®ç°å¯¹æ•°æ®åº“çš„æ“ä½œã€‚<strong>å¯¹äºå¼€å‘äººå‘˜è€Œè¨€ï¼ŒJDBC API æ˜¯æˆ‘ä»¬è®¿é—®æ•°æ®åº“çš„ä¸»è¦é€”å¾„ï¼Œä¹Ÿæ˜¯ ShardingSphere é‡å†™ JDBC è§„èŒƒå¹¶æ·»åŠ åˆ†ç‰‡åŠŸèƒ½çš„å…¥å£</strong>ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ JDBC å¼€å‘ä¸€ä¸ªè®¿é—®æ•°æ®åº“çš„å¤„ç†æµç¨‹ï¼Œå¸¸è§çš„ä»£ç é£æ ¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>// åˆ›å»ºæ± åŒ–çš„æ•°æ®æº
PooledDataSource dataSource = new PooledDataSource ();
// è®¾ç½®MySQL Driver
dataSource.setDriver (&quot;com.mysql.jdbc.Driver&quot;);
// è®¾ç½®æ•°æ®åº“URLã€ç”¨æˆ·åå’Œå¯†ç 
dataSource.setUrl (&quot;jdbc:mysql://localhost:3306/test&quot;);
dataSource.setUsername (&quot;root&quot;);
dataSource.setPassword (&quot;root&quot;);
// è·å–è¿æ¥
Connection connection = dataSource.getConnection();
// æ‰§è¡ŒæŸ¥è¯¢
PreparedStatement statement = connection.prepareStatement (&quot;select * from user&quot;);
// è·å–æŸ¥è¯¢ç»“æœåº”è¯¥å¤„ç†
ResultSet resultSet = statement.executeQuery();
while (resultSet.next()) {
â€¦
}
// å…³é—­èµ„æº
statement.close();
resultSet.close();
connection.close();
</code></pre><p>è¿™æ®µä»£ç ä¸­åŒ…å«äº† JDBC API ä¸­çš„æ ¸å¿ƒæ¥å£ï¼Œä½¿ç”¨è¿™äº›æ ¸å¿ƒæ¥å£æ˜¯æˆ‘ä»¬åŸºäº JDBC è¿›è¡Œæ•°æ®è®¿é—®çš„åŸºæœ¬æ–¹å¼ï¼Œè¿™é‡Œæœ‰å¿…è¦å¯¹è¿™äº›æ¥å£çš„ä½œç”¨å’Œä½¿ç”¨æ–¹æ³•åšä¸€äº›å±•å¼€ã€‚äº‹å®ä¸Šï¼Œéšç€è¯¾ç¨‹å†…å®¹çš„ä¸æ–­æ¼”è¿›ï¼Œä½ ä¼šå‘ç°åœ¨ ShardingSphere ä¸­ï¼Œå®Œæˆæ—¥å¸¸å¼€å‘æ‰€ä½¿ç”¨çš„ä¹Ÿå°±æ˜¯è¿™äº›æ¥å£ã€‚</p>
<h4 id="datasource">DataSource</h4>
<p>DataSource åœ¨ JDBC è§„èŒƒä¸­ä»£è¡¨çš„æ˜¯ä¸€ç§æ•°æ®æºï¼Œæ ¸å¿ƒä½œç”¨æ˜¯è·å–æ•°æ®åº“è¿æ¥å¯¹è±¡ Connectionã€‚åœ¨ JDBC è§„èŒƒä¸­ï¼Œå®é™…å¯ä»¥ç›´æ¥é€šè¿‡ DriverManager è·å– Connectionã€‚æˆ‘ä»¬çŸ¥é“è·å– Connection çš„è¿‡ç¨‹éœ€è¦å»ºç«‹ä¸æ•°æ®åº“ä¹‹é—´çš„è¿æ¥ï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹ä¼šäº§ç”Ÿè¾ƒå¤§çš„ç³»ç»Ÿå¼€é”€ã€‚</p>
<p>ä¸ºäº†æé«˜æ€§èƒ½ï¼Œé€šå¸¸ä¼šå»ºç«‹ä¸€ä¸ªä¸­é—´å±‚ï¼Œè¯¥ä¸­é—´å±‚å°† DriverManager ç”Ÿæˆçš„ Connection å­˜æ”¾åˆ°è¿æ¥æ± ä¸­ï¼Œç„¶åä»æ± ä¸­è·å– Connectionï¼Œå¯ä»¥è®¤ä¸ºï¼ŒDataSource å°±æ˜¯è¿™æ ·ä¸€ä¸ªä¸­é—´å±‚ã€‚åœ¨æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éƒ½ä¼šåŸºäº DataSource æ¥è·å– Connectionã€‚è€Œåœ¨ ShardingSphere ä¸­ï¼Œæš´éœ²ç»™ä¸šåŠ¡å¼€å‘äººå‘˜çš„åŒæ ·æ˜¯ä¸€ä¸ªç»è¿‡å¢å¼ºçš„ DataSource å¯¹è±¡ã€‚DataSource æ¥å£çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</p>
<pre tabindex="0"><code>public interface DataSource  extends CommonDataSource, Wrapper {
  Connection getConnection() throws SQLException; 
  Connection getConnection(String username, String password)
    throws SQLException;
}
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒDataSource æ¥å£æä¾›äº†ä¸¤ä¸ªè·å– Connection çš„é‡è½½æ–¹æ³•ï¼Œå¹¶ç»§æ‰¿äº† CommonDataSource æ¥å£ï¼Œè¯¥æ¥å£æ˜¯ JDBC ä¸­å…³äºæ•°æ®æºå®šä¹‰çš„æ ¹æ¥å£ã€‚é™¤äº† DataSource æ¥å£ä¹‹å¤–ï¼Œå®ƒè¿˜æœ‰ä¸¤ä¸ªå­æ¥å£ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl7xtbuALDZqAABj4c2IofU664.png" alt="Drawing 1.png"></p>
<p>å…¶ä¸­ï¼ŒDataSource æ˜¯å®˜æ–¹å®šä¹‰çš„è·å– Connection çš„åŸºç¡€æ¥å£ï¼ŒConnectionPoolDataSource æ˜¯ä»è¿æ¥æ±  ConnectionPool ä¸­è·å–çš„ Connection æ¥å£ã€‚è€Œ XADataSource åˆ™ç”¨æ¥å®ç°åœ¨åˆ†å¸ƒå¼äº‹åŠ¡ç¯å¢ƒä¸‹è·å– Connectionï¼Œæˆ‘ä»¬åœ¨è®¨è®º ShardingSphere çš„åˆ†å¸ƒå¼äº‹åŠ¡æ—¶ä¼šæ¥è§¦åˆ°è¿™ä¸ªæ¥å£ã€‚</p>
<p><strong>è¯·æ³¨æ„ï¼ŒDataSource æ¥å£åŒæ—¶è¿˜ç»§æ‰¿äº†ä¸€ä¸ª Wrapper æ¥å£</strong>ã€‚ä»æ¥å£çš„å‘½åä¸Šçœ‹ï¼Œå¯ä»¥åˆ¤æ–­è¯¥æ¥å£åº”è¯¥èµ·åˆ°ä¸€ç§åŒ…è£…å™¨çš„ä½œç”¨ï¼Œäº‹å®ä¸Šï¼Œç”±äºå¾ˆå¤šæ•°æ®åº“ä¾›åº”å•†æä¾›äº†è¶…è¶Šæ ‡å‡† JDBC API çš„æ‰©å±•åŠŸèƒ½ï¼Œæ‰€ä»¥ï¼ŒWrapper æ¥å£å¯ä»¥æŠŠä¸€ä¸ªç”±ç¬¬ä¸‰æ–¹ä¾›åº”å•†æä¾›çš„ã€é JDBC æ ‡å‡†çš„æ¥å£åŒ…è£…æˆæ ‡å‡†æ¥å£ã€‚ä»¥ DataSource æ¥å£ä¸ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å®ç°è‡ªå·±çš„æ•°æ®æº MyDataSourceï¼Œå°±å¯ä»¥æä¾›ä¸€ä¸ªå®ç°äº† Wrapper æ¥å£çš„ MyDataSourceWrapper ç±»æ¥å®ŒæˆåŒ…è£…å’Œé€‚é…ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl7xtdOAZEGNAABnV-ZtNrk288.png" alt="Drawing 2.png"></p>
<p>åœ¨ JDBC è§„èŒƒä¸­ï¼Œé™¤äº† DataSource ä¹‹å¤–ï¼ŒConnectionã€Statementã€ResultSet ç­‰æ ¸å¿ƒå¯¹è±¡ä¹Ÿéƒ½ç»§æ‰¿äº†è¿™ä¸ªæ¥å£ã€‚æ˜¾ç„¶ï¼ŒShardingSphere æä¾›çš„å°±æ˜¯é JDBC æ ‡å‡†çš„æ¥å£ï¼Œæ‰€ä»¥ä¹Ÿåº”è¯¥ä¼šç”¨åˆ°è¿™ä¸ª Wrapper æ¥å£ï¼Œå¹¶æä¾›äº†ç±»ä¼¼çš„å®ç°æ–¹æ¡ˆã€‚</p>
<h4 id="connection">Connection</h4>
<p>DataSource çš„ç›®çš„æ˜¯è·å– Connection å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ Connection ç†è§£ä¸ºä¸€ç§<strong>ä¼šè¯ï¼ˆSessionï¼‰æœºåˆ¶</strong>ã€‚Connection ä»£è¡¨ä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œè´Ÿè´£å®Œæˆä¸æ•°æ®åº“ä¹‹é—´çš„é€šä¿¡ã€‚æ‰€æœ‰ SQL çš„æ‰§è¡Œéƒ½æ˜¯åœ¨æŸä¸ªç‰¹å®š Connection ç¯å¢ƒä¸­è¿›è¡Œçš„ï¼ŒåŒæ—¶å®ƒè¿˜æä¾›äº†ä¸€ç»„é‡è½½æ–¹æ³•ï¼Œåˆ†åˆ«ç”¨äºåˆ›å»º Statement å’Œ PreparedStatementã€‚å¦ä¸€æ–¹é¢ï¼ŒConnection ä¹Ÿæ¶‰åŠäº‹åŠ¡ç›¸å…³çš„æ“ä½œï¼Œä¸ºäº†å®ç°åˆ†ç‰‡æ“ä½œï¼ŒShardingSphere åŒæ ·ä¹Ÿå®ç°äº†å®šåˆ¶åŒ–çš„ Connection ç±» ShardingConnectionã€‚</p>
<h4 id="statement">Statement</h4>
<p>JDBC è§„èŒƒä¸­çš„ Statement å­˜åœ¨ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯<strong>æ™®é€šçš„ Statement</strong>ï¼Œä¸€ç§æ˜¯<strong>æ”¯æŒé¢„ç¼–è¯‘çš„ PreparedStatement</strong>ã€‚æ‰€è°“é¢„ç¼–è¯‘ï¼Œæ˜¯æŒ‡æ•°æ®åº“çš„ç¼–è¯‘å™¨ä¼šå¯¹ SQL è¯­å¥æå‰ç¼–è¯‘ï¼Œç„¶åå°†é¢„ç¼–è¯‘çš„ç»“æœç¼“å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œè¿™æ ·ä¸‹æ¬¡æ‰§è¡Œæ—¶å°±å¯ä»¥æ›¿æ¢å‚æ•°å¹¶ç›´æ¥ä½¿ç”¨ç¼–è¯‘è¿‡çš„è¯­å¥ï¼Œä»è€Œæé«˜ SQL çš„æ‰§è¡Œæ•ˆç‡ã€‚å½“ç„¶ï¼Œè¿™ç§é¢„ç¼–è¯‘ä¹Ÿéœ€è¦æˆæœ¬ï¼Œæ‰€ä»¥åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¯¹æ•°æ®åº“åªæ‰§è¡Œä¸€æ¬¡æ€§è¯»å†™æ“ä½œæ—¶ï¼Œç”¨ Statement å¯¹è±¡è¿›è¡Œå¤„ç†æ¯”è¾ƒåˆé€‚ï¼›è€Œå½“æ¶‰åŠ SQL è¯­å¥çš„å¤šæ¬¡æ‰§è¡Œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ PreparedStatementã€‚</p>
<p>å¦‚æœéœ€è¦æŸ¥è¯¢æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œåªéœ€è¦è°ƒç”¨ Statement æˆ– PreparedStatement å¯¹è±¡çš„ executeQuery æ–¹æ³•å³å¯ï¼Œè¯¥æ–¹æ³•ä»¥ SQL è¯­å¥ä½œä¸ºå‚æ•°ï¼Œæ‰§è¡Œå®Œåè¿”å›ä¸€ä¸ª JDBC çš„ ResultSet å¯¹è±¡ã€‚å½“ç„¶ï¼ŒStatement æˆ– PreparedStatement ä¸­æä¾›äº†ä¸€å¤§æ‰¹æ‰§è¡Œ SQL æ›´æ–°å’ŒæŸ¥è¯¢çš„é‡è½½æ–¹æ³•ã€‚åœ¨ ShardingSphere ä¸­ï¼ŒåŒæ ·ä¹Ÿæä¾›äº† ShardingStatement å’Œ ShardingPreparedStatement è¿™ä¸¤ä¸ªæ”¯æŒåˆ†ç‰‡æ“ä½œçš„ Statement å¯¹è±¡ã€‚</p>
<h4 id="resultset">ResultSet</h4>
<p>ä¸€æ—¦é€šè¿‡ Statement æˆ– PreparedStatement æ‰§è¡Œäº† SQL è¯­å¥å¹¶è·å¾—äº† ResultSet å¯¹è±¡åï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡è°ƒç”¨ Resulset å¯¹è±¡ä¸­çš„ next() æ–¹æ³•éå†æ•´ä¸ªç»“æœé›†ã€‚å¦‚æœ next() æ–¹æ³•è¿”å›ä¸º trueï¼Œå°±æ„å‘³ç»“æœé›†ä¸­å­˜åœ¨æ•°æ®ï¼Œåˆ™å¯ä»¥è°ƒç”¨ ResultSet å¯¹è±¡çš„ä¸€ç³»åˆ— getXXX() æ–¹æ³•æ¥å–å¾—å¯¹åº”çš„ç»“æœå€¼ã€‚å¯¹äºåˆ†åº“åˆ†è¡¨æ“ä½œè€Œè¨€ï¼Œå› ä¸ºæ¶‰åŠä»å¤šä¸ªæ•°æ®åº“æˆ–æ•°æ®è¡¨ä¸­è·å–ç›®æ ‡æ•°æ®ï¼ŒåŠ¿å¿…éœ€è¦å¯¹è·å–çš„ç»“æœè¿›è¡Œå½’å¹¶ã€‚å› æ­¤ï¼ŒShardingSphere ä¸­ä¹Ÿæä¾›äº†åˆ†ç‰‡ç¯å¢ƒä¸‹çš„ ShardingResultSet å¯¹è±¡ã€‚</p>
<p>ä½œä¸ºæ€»ç»“ï¼Œæˆ‘ä»¬æ¢³ç†äº†åŸºäº JDBC è§„èŒƒè¿›è¡Œæ•°æ®åº“è®¿é—®çš„å¼€å‘æµç¨‹å›¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F7xteqAQsj5AAB1bj_eu10085.png" alt="Drawing 3.png"></p>
<p>ShardingSphere æä¾›äº†ä¸ JDBC è§„èŒƒå®Œå…¨å…¼å®¹çš„ APIã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¼€å‘äººå‘˜å¯ä»¥åŸºäºè¿™ä¸ªå¼€å‘æµç¨‹å’Œ JDBC ä¸­çš„æ ¸å¿ƒæ¥å£å®Œæˆåˆ†ç‰‡å¼•æ“ã€æ•°æ®è„±æ•ç­‰æ“ä½œï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ã€‚</p>
<h3 id="åŸºäºé€‚é…å™¨æ¨¡å¼çš„-jdbc-é‡å†™å®ç°æ–¹æ¡ˆ">åŸºäºé€‚é…å™¨æ¨¡å¼çš„ JDBC é‡å†™å®ç°æ–¹æ¡ˆ</h3>
<p>åœ¨ ShardingSphere ä¸­ï¼Œå®ç°ä¸ JDBC è§„èŒƒå…¼å®¹æ€§çš„åŸºæœ¬ç­–ç•¥å°±æ˜¯é‡‡ç”¨äº†è®¾è®¡æ¨¡å¼ä¸­çš„é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰ã€‚<strong>é€‚é…å™¨æ¨¡å¼é€šå¸¸è¢«ç”¨ä½œè¿æ¥ä¸¤ä¸ªä¸å…¼å®¹æ¥å£ä¹‹é—´çš„æ¡¥æ¢ï¼Œæ¶‰åŠä¸ºæŸä¸€ä¸ªæ¥å£åŠ å…¥ç‹¬ç«‹çš„æˆ–ä¸å…¼å®¹çš„åŠŸèƒ½ã€‚</strong></p>
<p>ä½œä¸ºä¸€å¥—é€‚é… JDBC è§„èŒƒçš„å®ç°æ–¹æ¡ˆï¼ŒShardingSphere éœ€è¦å¯¹ä¸Šé¢ä»‹ç»çš„ JDBC API ä¸­çš„ DataSourceã€Connectionã€Statement åŠ ResultSet ç­‰æ ¸å¿ƒå¯¹è±¡éƒ½å®Œæˆé‡å†™ã€‚è™½ç„¶è¿™äº›å¯¹è±¡æ‰¿è½½ç€ä¸åŒåŠŸèƒ½ï¼Œä½†é‡å†™æœºåˆ¶åº”è¯¥æ˜¯å…±é€šçš„ï¼Œå¦åˆ™å°±éœ€è¦å¯¹ä¸åŒå¯¹è±¡éƒ½å®ç°å®šåˆ¶åŒ–å¼€å‘ï¼Œæ˜¾ç„¶ï¼Œè¿™ä¸ç¬¦åˆæˆ‘ä»¬çš„è®¾è®¡åŸåˆ™ã€‚ä¸ºæ­¤ï¼ŒShardingSphere æŠ½è±¡å¹¶å¼€å‘äº†ä¸€å¥—åŸºäºé€‚é…å™¨æ¨¡å¼çš„å®ç°æ–¹æ¡ˆï¼Œæ•´ä½“ç»“æ„æ˜¯è¿™æ ·çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F7xtfeAIlV7AABhpWkSy7c199.png" alt="Drawing 4.png"></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹åˆ°è¿™é‡Œæœ‰ä¸€ä¸ª JdbcObject æ¥å£ï¼Œè¿™ä¸ªæ¥å£æ³›æŒ‡ JDBC API ä¸­çš„ DataSourceã€Connectionã€Statement ç­‰æ ¸å¿ƒæ¥å£ã€‚å‰é¢æåˆ°ï¼Œè¿™äº›æ¥å£éƒ½ç»§æ‰¿è‡ªåŒ…è£…å™¨ Wrapper æ¥å£ã€‚ShardingSphere ä¸ºè¿™ä¸ª Wrapper æ¥å£æä¾›äº†ä¸€ä¸ªå®ç°ç±» WrapperAdapterï¼Œè¿™ç‚¹åœ¨å›¾ä¸­å¾—åˆ°äº†å±•ç¤ºã€‚åœ¨ ShardingSphere ä»£ç å·¥ç¨‹ sharding-jdbc-core çš„ org.apache.shardingsphere.shardingjdbc.jdbc.adapter åŒ…ä¸­åŒ…å«äº†æ‰€æœ‰ä¸ Adapter ç›¸å…³çš„å®ç°ç±»ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F7xtgWAb3PaAAAW8D9SY1w475.png" alt="Drawing 5.png"></p>
<p>åœ¨ ShardingSphere åŸºäºé€‚é…å™¨æ¨¡å¼çš„å®ç°æ–¹æ¡ˆå›¾çš„åº•éƒ¨ï¼Œæœ‰ä¸€ä¸ª ShardingJdbcObject ç±»çš„å®šä¹‰ã€‚è¿™ä¸ªç±»ä¹Ÿæ˜¯ä¸€ç§æ³›æŒ‡ï¼Œä»£è¡¨ ShardingSphere ä¸­ç”¨äºåˆ†ç‰‡çš„ ShardingDataSourceã€ShardingConnectionã€ShardingStatement ç­‰å¯¹è±¡ã€‚</p>
<p>æœ€åå‘ç° ShardingJdbcObject ç»§æ‰¿è‡ªä¸€ä¸ª AbstractJdbcObjectAdapterï¼Œè€Œ AbstractJdbcObjectAdapter åˆç»§æ‰¿è‡ª AbstractUnsupportedOperationJdbcObjectï¼Œè¿™ä¸¤ä¸ªç±»éƒ½æ˜¯æŠ½è±¡ç±»ï¼Œè€Œä¸”ä¹Ÿéƒ½æ³›æŒ‡ä¸€ç»„ç±»ã€‚ä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼ŒAbstractJdbcObjectAdapter åªæä¾›äº†é’ˆå¯¹ JdbcObject æ¥å£çš„ä¸€éƒ¨åˆ†å®ç°æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•æ˜¯æˆ‘ä»¬å®Œæˆåˆ†ç‰‡æ“ä½œæ‰€éœ€è¦çš„ã€‚è€Œå¯¹äºé‚£äº›æˆ‘ä»¬ä¸éœ€è¦çš„æ–¹æ³•å®ç°ï¼Œåˆ™å…¨éƒ¨äº¤ç”± AbstractUnsupportedOperationJdbcObject è¿›è¡Œå®ç°ï¼Œè¿™ä¸¤ä¸ªç±»çš„æ‰€æœ‰æ–¹æ³•çš„åˆé›†ï¼Œå°±æ˜¯åŸæœ‰ JdbcObject æ¥å£çš„æ‰€æœ‰æ–¹æ³•å®šä¹‰ã€‚</p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å¤§è‡´äº†è§£äº† ShardingSphere å¯¹ JDBC è§„èŒƒä¸­æ ¸å¿ƒæ¥å£çš„é‡å†™æœºåˆ¶ã€‚è¿™ä¸ªé‡å†™æœºåˆ¶éå¸¸é‡è¦ï¼Œåœ¨ ShardingSphere ä¸­åº”ç”¨ä¹Ÿå¾ˆå¹¿æ³›ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¤ºä¾‹å¯¹è¿™ä¸€æœºåˆ¶åšè¿›ä¸€æ­¥ç†è§£ã€‚</p>
<h3 id="shardingsphere-é‡å†™-jdbc-è§„èŒƒç¤ºä¾‹shardingconnection">ShardingSphere é‡å†™ JDBC è§„èŒƒç¤ºä¾‹ï¼šShardingConnection</h3>
<p>é€šè¿‡å‰é¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬çŸ¥é“ ShardingSphere çš„åˆ†ç‰‡å¼•æ“ä¸­æä¾›äº†ä¸€ç³»åˆ— ShardingJdbcObject æ¥æ”¯æŒåˆ†ç‰‡æ“ä½œï¼ŒåŒ…æ‹¬ ShardingDataSourceã€ShardingConnectionã€ShardingStatementã€ShardingPreparedStament ç­‰ã€‚è¿™é‡Œä»¥æœ€å…·ä»£è¡¨æ€§çš„ ShardingConnection ä¸ºä¾‹ï¼Œæ¥è®²è§£å®ƒçš„å®ç°è¿‡ç¨‹ã€‚è¯·æ³¨æ„ï¼Œä»Šå¤©æˆ‘ä»¬å…³æ³¨çš„è¿˜æ˜¯é‡å†™æœºåˆ¶ï¼Œä¸ä¼šå¯¹ ShardingConnection ä¸­çš„å…·ä½“åŠŸèƒ½ä»¥åŠä¸å…¶ä»–ç±»ä¹‹é—´çš„äº¤äº’è¿‡ç¨‹åšè¿‡å¤šå±•å¼€è®²è§£ã€‚</p>
<h4 id="shardingconnection-ç±»å±‚ç»“æ„">ShardingConnection ç±»å±‚ç»“æ„</h4>
<p>ShardingConnection æ˜¯å¯¹ JDBC ä¸­ Connection çš„é€‚é…å’ŒåŒ…è£…ï¼Œæ‰€ä»¥å®ƒéœ€è¦æä¾› Connection æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ createConnectionã€getMetaDataã€å„ç§é‡è½½çš„ prepareStatement å’Œ createStatement ä»¥åŠé’ˆå¯¹äº‹åŠ¡çš„ setAutoCommitã€commit å’Œ rollback æ–¹æ³•ç­‰ã€‚ShardingConnection å¯¹è¿™äº›æ–¹æ³•éƒ½è¿›è¡Œäº†é‡å†™ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl7xthSAHp4DAACJDJsvmyk879.png" alt="Drawing 6.png"> ShardingConnection ä¸­çš„æ–¹æ³•åˆ—è¡¨å›¾</p>
<p>ShardingConnection ç±»çš„ä¸€æ¡ç±»å±‚ç»“æ„æ”¯çº¿å°±æ˜¯é€‚é…å™¨æ¨¡å¼çš„å…·ä½“åº”ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹çš„ç±»å±‚ç»“æ„ä¸å‰é¢ä»‹ç»çš„é‡å†™æœºåˆ¶çš„ç±»å±‚ç»“æ„æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl9MudqAOb9wAAEeGv0YTn807.jpeg" alt="111.jpeg"></p>
<h4 id="abstractconnectionadapter">AbstractConnectionAdapter</h4>
<p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹ AbstractConnectionAdapter æŠ½è±¡ç±»ï¼ŒShardingConnection ç›´æ¥ç»§æ‰¿äº†å®ƒã€‚åœ¨ AbstractConnectionAdapter ä¸­å‘ç°äº†ä¸€ä¸ª cachedConnections å±æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ª Map å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å…¶å®ç¼“å­˜äº†è¿™ä¸ªç»è¿‡å°è£…çš„ ShardingConnection èƒŒåçœŸå®çš„ Connection å¯¹è±¡ã€‚å¦‚æœæˆ‘ä»¬å¯¹ä¸€ä¸ª AbstractConnectionAdapter é‡å¤ä½¿ç”¨ï¼Œé‚£ä¹ˆè¿™äº› cachedConnections ä¹Ÿä¼šä¸€ç›´è¢«ç¼“å­˜ï¼Œç›´åˆ°è°ƒç”¨ close æ–¹æ³•ã€‚å¯ä»¥ä» AbstractConnectionAdapter çš„ getConnections æ–¹æ³•ä¸­ç†è§£å…·ä½“çš„æ“ä½œè¿‡ç¨‹ï¼š</p>
<pre tabindex="0"><code>public final List&lt;Connection&gt; getConnections(final ConnectionMode connectionMode, final String dataSourceName, final int connectionSize) throws SQLException {
        //è·å–DataSource
        DataSource dataSource = getDataSourceMap().get(dataSourceName);
        Preconditions.checkState(null != dataSource, &quot;Missing the data source name: '%s'&quot;, dataSourceName);
        Collection&lt;Connection&gt; connections;

        //æ ¹æ®æ•°æ®æºä»cachedConnectionsä¸­è·å–connections
        synchronized (cachedConnections) {
            connections = cachedConnections.get(dataSourceName);
        }

        //å¦‚æœconnectionså¤šäºæƒ³è¦çš„connectionSizeï¼Œåˆ™åªè·å–æ‰€éœ€éƒ¨åˆ†
        List&lt;Connection&gt; result;
        if (connections.size() &gt;= connectionSize) {
            result = new ArrayList&lt;&gt;(connections).subList(0, connectionSize);
        } else if (!connections.isEmpty()) {//å¦‚æœconnectionsä¸å¤Ÿ
            result = new ArrayList&lt;&gt;(connectionSize);
            result.addAll(connections);
            //åˆ›å»ºæ–°çš„connections
            List&lt;Connection&gt; newConnections = createConnections(dataSourceName, connectionMode, dataSource, connectionSize - connections.size());
            result.addAll(newConnections);
            synchronized (cachedConnections) {
                //å°†æ–°åˆ›å»ºçš„connectionsä¹Ÿæ”¾å…¥ç¼“å­˜ä¸­è¿›è¡Œç®¡ç†
                cachedConnections.putAll(dataSourceName, newConnections);
            }
        } else {//å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰å¯¹åº”dataSourceçš„Connectionsï¼ŒåŒæ ·è¿›è¡Œåˆ›å»ºå¹¶æ”¾å…¥ç¼“å­˜ä¸­
            result = new ArrayList&lt;&gt;(createConnections(dataSourceName, connectionMode, dataSource, connectionSize));
            synchronized (cachedConnections) {
                cachedConnections.putAll(dataSourceName, result);
            }
        }
        return result;
}
</code></pre><p>è¿™æ®µä»£ç æœ‰ä¸‰ä¸ªåˆ¤æ–­ï¼Œæµç¨‹ä¸Šæ¯”è¾ƒç®€å•ï¼Œå‚è€ƒæ³¨é‡Šå³å¯ï¼Œéœ€è¦å…³æ³¨çš„æ˜¯å…¶ä¸­çš„ createConnections æ–¹æ³•ï¼š</p>
<pre tabindex="0"><code>private List&lt;Connection&gt; createConnections(final String dataSourceName, final ConnectionMode connectionMode, final DataSource dataSource, final int connectionSize) throws SQLException {
        if (1 == connectionSize) {
            Connection connection = createConnection(dataSourceName, dataSource);
            replayMethodsInvocation(connection);
            return Collections.singletonList(connection);
        }
        if (ConnectionMode.CONNECTION_STRICTLY == connectionMode) {
            return createConnections(dataSourceName, dataSource, connectionSize);
        }
        synchronized (dataSource) {
            return createConnections(dataSourceName, dataSource, connectionSize);
        }
}
</code></pre><p>è¿™æ®µä»£ç æ¶‰åŠäº† ConnectionModeï¼ˆè¿æ¥æ¨¡å¼ï¼‰ï¼Œè¿™æ˜¯ ShardingSphere æ‰§è¡Œå¼•æ“ä¸­çš„é‡è¦æ¦‚å¿µï¼Œä»Šå¤©æˆ‘ä»¬å…ˆä¸å±•å¼€ï¼Œå°†åœ¨ç¬¬ 21 è¯¾æ—¶â€œæ‰§è¡Œå¼•æ“ï¼šåˆ†ç‰‡ç¯å¢ƒä¸‹SQLæ‰§è¡Œçš„æ•´ä½“æµç¨‹åº”è¯¥å¦‚ä½•è¿›è¡ŒæŠ½è±¡ï¼Ÿâ€ä¸­è¯¦ç»†è®²è§£ã€‚è¿™é‡Œï¼Œå¯ä»¥çœ‹åˆ° createConnections æ–¹æ³•æ‰¹é‡è°ƒç”¨äº†ä¸€ä¸ª createConnection æŠ½è±¡æ–¹æ³•ï¼Œè¯¥æ–¹æ³•éœ€è¦ AbstractConnectionAdapter çš„å­ç±»è¿›è¡Œå®ç°ï¼š</p>
<pre tabindex="0"><code>protected abstract Connection createConnection(String dataSourceName, DataSource dataSource) throws SQLException;
</code></pre><p>åŒæ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°å¯¹äºåˆ›å»ºçš„ Connection å¯¹è±¡ï¼Œéƒ½éœ€è¦æ‰§è¡Œè¿™æ ·ä¸€ä¸ªè¯­å¥ï¼š</p>
<pre tabindex="0"><code>replayMethodsInvocation(connection);
</code></pre><p>è¿™è¡Œä»£ç æ¯”è¾ƒéš¾ä»¥ç†è§£ï¼Œè®©æˆ‘ä»¬æ¥åˆ°å®šä¹‰å®ƒçš„åœ°æ–¹ï¼Œå³ WrapperAdapter ç±»ã€‚</p>
<h4 id="wrapperadapter">WrapperAdapter</h4>
<p>ä»å‘½åä¸Šçœ‹ï¼ŒWrapperAdapter æ˜¯ä¸€ä¸ªåŒ…è£…å™¨çš„é€‚é…ç±»ï¼Œå®ç°äº† JDBC ä¸­çš„ Wrapper æ¥å£ã€‚æˆ‘ä»¬åœ¨è¯¥ç±»ä¸­æ‰¾åˆ°äº†è¿™æ ·ä¸€å¯¹æ–¹æ³•å®šä¹‰ï¼š</p>
<pre tabindex="0"><code>    //è®°å½•æ–¹æ³•è°ƒç”¨
    public final void recordMethodInvocation(final Class&lt;?&gt; targetClass, final String methodName, final Class&lt;?&gt;[] argumentTypes, final Object[] arguments) {
        jdbcMethodInvocations.add(new JdbcMethodInvocation(targetClass.getMethod(methodName, argumentTypes), arguments));
}
 
//é‡æ”¾æ–¹æ³•è°ƒç”¨
    public final void replayMethodsInvocation(final Object target) {
        for (JdbcMethodInvocation each : jdbcMethodInvocations) {
            each.invoke(target);
        }
}
</code></pre><p>è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ç”¨åˆ°äº† JdbcMethodInvocation ç±»ï¼š</p>
<pre tabindex="0"><code>public class JdbcMethodInvocation {

    @Getter
    private final Method method;

    @Getter
    private final Object[] arguments;

    public void invoke(final Object target) {
        method.invoke(target, arguments);
    }
}
</code></pre><p>æ˜¾ç„¶ï¼ŒJdbcMethodInvocation ç±»ä¸­ç”¨åˆ°äº†åå°„æŠ€æœ¯æ ¹æ®ä¼ å…¥çš„ method å’Œ arguments å¯¹è±¡æ‰§è¡Œå¯¹åº”æ–¹æ³•ã€‚</p>
<p>äº†è§£äº† JdbcMethodInvocation ç±»çš„åŸç†åï¼Œæˆ‘ä»¬å°±ä¸éš¾ç†è§£ recordMethodInvocation å’Œ replayMethodsInvocation æ–¹æ³•çš„ä½œç”¨ã€‚å…¶ä¸­ï¼ŒrecordMethodInvocation ç”¨äºè®°å½•éœ€è¦æ‰§è¡Œçš„æ–¹æ³•å’Œå‚æ•°ï¼Œè€Œ replayMethodsInvocation åˆ™æ ¹æ®è¿™äº›æ–¹æ³•å’Œå‚æ•°é€šè¿‡åå°„æŠ€æœ¯è¿›è¡Œæ‰§è¡Œã€‚</p>
<p>å¯¹äºæ‰§è¡Œ replayMethodsInvocationï¼Œæˆ‘ä»¬å¿…é¡»å…ˆæ‰¾åˆ° recordMethodInvocation çš„è°ƒç”¨å…¥å£ã€‚é€šè¿‡ä»£ç çš„è°ƒç”¨å…³ç³»ï¼Œå¯ä»¥çœ‹åˆ°åœ¨ AbstractConnectionAdapter ä¸­å¯¹å…¶è¿›è¡Œäº†è°ƒç”¨ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ setAutoCommitã€setReadOnly å’Œ setTransactionIsolation è¿™ä¸‰å¤„æ–¹æ³•ã€‚è¿™é‡Œä»¥ setReadOnly æ–¹æ³•ä¸ºä¾‹ç»™å‡ºå®ƒçš„å®ç°ï¼š</p>
<pre tabindex="0"><code>    @Override
    public final void setReadOnly(final boolean readOnly) throws SQLException {
        this.readOnly = readOnly; 
        //è°ƒç”¨recordMethodInvocationæ–¹æ³•è®°å½•æ–¹æ³•è°ƒç”¨çš„å…ƒæ•°æ®
        recordMethodInvocation(Connection.class, &quot;setReadOnly&quot;, new Class[]{boolean.class}, new Object[]{readOnly});

        //æ‰§è¡Œå›è°ƒ
        forceExecuteTemplate.execute(cachedConnections.values(), new ForceExecuteCallback&lt;Connection&gt;() {

            @Override
            public void execute(final Connection connection) throws SQLException {
                connection.setReadOnly(readOnly);
            }
        });
    }
</code></pre><h4 id="abstractunsupportedoperationconnection">AbstractUnsupportedOperationConnection</h4>
<p>å¦ä¸€æ–¹é¢ï¼Œä»ç±»å±‚å…³ç³»ä¸Šï¼Œå¯ä»¥çœ‹åˆ° AbstractConnectionAdapter ç›´æ¥ç»§æ‰¿çš„æ˜¯ AbstractUnsupportedOperationConnection è€Œä¸æ˜¯ WrapperAdapterï¼Œè€Œåœ¨ AbstractUnsupportedOperationConnection ä¸­éƒ½æ˜¯ä¸€ç»„ç›´æ¥æŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•ã€‚è¿™é‡Œæˆªå–éƒ¨åˆ†ä»£ç ï¼š</p>
<pre tabindex="0"><code>public abstract class AbstractUnsupportedOperationConnection extends WrapperAdapter implements Connection {

    @Override
    public final CallableStatement prepareCall(final String sql) throws SQLException {
        throw new SQLFeatureNotSupportedException(&quot;prepareCall&quot;);
    }

    @Override
    public final CallableStatement prepareCall(final String sql, final int resultSetType, final int resultSetConcurrency) throws SQLException {
        throw new SQLFeatureNotSupportedException(&quot;prepareCall&quot;);
}
â€¦
}
</code></pre><p>AbstractUnsupportedOperationConnection è¿™ç§å¤„ç†æ–¹å¼çš„ç›®çš„å°±æ˜¯æ˜ç¡®å“ªäº›æ“ä½œæ˜¯ AbstractConnectionAdapter åŠå…¶å­ç±» ShardingConnection æ‰€ä¸èƒ½æ”¯æŒçš„ï¼Œå±äºèŒè´£åˆ†ç¦»çš„ä¸€ç§å…·ä½“å®ç°æ–¹æ³•ã€‚</p>
<h3 id="å°ç»“">å°ç»“</h3>
<p>JDBC è§„èŒƒæ˜¯ç†è§£å’Œåº”ç”¨ ShardingSphere çš„åŸºç¡€ï¼ŒShardingSphere å¯¹ JDBC è§„èŒƒè¿›è¡Œäº†é‡å†™ï¼Œå¹¶æä¾›äº†å®Œå…¨å…¼å®¹çš„ä¸€å¥—æ¥å£ã€‚åœ¨è¿™ä¸€è¯¾æ—¶ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆç»™å‡ºäº† JDBC è§„èŒƒä¸­å„ä¸ªæ ¸å¿ƒæ¥å£çš„ä»‹ç»ï¼›æ­£æ˜¯åœ¨è¿™äº›æ¥å£çš„åŸºç¡€ä¸Šï¼ŒShardingSphere åŸºäºé€‚é…å™¨æ¨¡å¼å¯¹ JDBC è§„èŒƒè¿›è¡Œäº†é‡å†™ï¼›æˆ‘ä»¬å¯¹è¿™ä¸€é‡å†™æ–¹æ¡ˆè¿›è¡Œäº†æŠ½è±¡ï¼Œå¹¶åŸºäº ShardingConnectin ç±»çš„å®ç°è¿‡ç¨‹è¯¦ç»†é˜è¿°äº† ShardingSphere é‡å†™ Connection æ¥å£çš„æºç åˆ†æã€‚</p>
<p>è¿™é‡Œç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜ï¼šShardingSphereå¦‚ä½•åŸºäºé€‚é…å™¨æ¨¡å¼å®ç°å¯¹JDBCä¸­æ ¸å¿ƒç±»çš„é‡å†™ï¼Ÿ</p>
<p>JDBC è§„èŒƒä¸ ShardingSphere çš„å…¼å®¹æ€§æ¦‚å¿µè‡³å…³é‡è¦ã€‚åœ¨æŒæ¡äº†è¿™ä¸ªæ¦‚å¿µä¹‹åï¼Œä¸‹ä¸€è¯¾æ—¶å°†ä»‹ç»åº”ç”¨é›†æˆæ–¹é¢çš„è¯é¢˜ï¼Œå³åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ä½¿ç”¨ ShardingSphere çš„å…·ä½“æ–¹å¼ã€‚</p>

        </div>
    </article>
</div>
<div class="division-line"></div>
<div class="others">
    <div>æ ‡ç­¾ï¼šğŸ·ï¸<a class="post-tag" href="/tags/sharding/">sharding</a>&nbsp;</div>
    <div>åˆ†ç±»ï¼š ğŸ“’<a class="post-category" href="/categories/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/">ShardingSphereæ ¸å¿ƒåŸç†ç²¾è®²</a>&nbsp; </div>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/02-%E9%A1%B6%E7%BA%A7%E9%A1%B9%E7%9B%AEshardingsphere-%E6%98%AF%E4%B8%80%E6%AC%BE%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84-apache-%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6/"><span>02 é¡¶çº§é¡¹ç›®ï¼šShardingSphere æ˜¯ä¸€æ¬¾ä»€ä¹ˆæ ·çš„ Apache å¼€æºè½¯ä»¶ï¼Ÿ</span></a>
    </div>
    <div class="next">
        
        <a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/04-%E5%BA%94%E7%94%A8%E9%9B%86%E6%88%90%E5%9C%A8%E4%B8%9A%E5%8A%A1%E7%B3%BB%E7%BB%9F%E4%B8%AD%E4%BD%BF%E7%94%A8-shardingsphere-%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B/"><span>04 åº”ç”¨é›†æˆï¼šåœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ä½¿ç”¨ ShardingSphere çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</span></a>
    </div>
</div>

        </div>
        <div id="float">
            <ul class="float-button-bar">
    <li>
        <button class="float-button top" onclick="scrollToTop(this);">UP</button>
    </li>
    <li>
        <button class="float-button toggler" onclick="changeSkin(this);">DARK</button>
    </li>
</ul>
        </div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 2020 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    const changeSkin = () => {
        document.getElementById('page').classList.toggle('night');
    }
    const scrollToTop = () => {
        window.scrollTo(0, 0);
    }
</script>
</body>

</html>