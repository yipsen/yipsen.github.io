<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>23 æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•æŠŠæ¡ ShardingSphere ä¸­çš„ Executor æ‰§è¡Œæ¨¡å‹ï¼Ÿï¼ˆä¸‹ï¼‰ | Yipsen Ye</title>
<meta name="description" content="åœ¨ä¸Šä¸€è¯¾æ—¶ï¼Œæˆ‘ä»¬å·²ç»å¯¹ ShardingSphere æ‰§è¡Œå¼•æ“ä¸­å…³äºåº•å±‚çš„ SQLExecuteTemplateï¼Œä»¥åŠä¸Šå±‚çš„ StatementExecutor å’Œ PreparedStatementExecutor å¯¹è±¡è¿›è¡Œäº†å…¨é¢ä»‹ç»ã€‚
ä»Šå¤©ï¼Œæˆ‘ä»¬åœ¨æ­¤åŸºç¡€ä¸Šæ›´ä¸Šä¸€å±‚ï¼Œé‡ç‚¹å…³æ³¨ ShardingStatement å’Œ ShardingPreparedStatement å¯¹è±¡ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡åˆ†åˆ«æ˜¯ StatementExecutor å’Œ PreparedStatementExecutor çš„ä½¿ç”¨è€…ã€‚
ShardingStatement æˆ‘ä»¬å…ˆæ¥çœ‹ ShardingStatement ç±»ï¼Œè¯¥ç±»ä¸­çš„å˜é‡åœ¨å‰é¢çš„å†…å®¹ä¸­éƒ½å·²ç»æœ‰è¿‡ä»‹ç»ï¼š
private final ShardingConnection connection;private final StatementExecutor statementExecutor;private boolean returnGeneratedKeys;private SQLRouteResult sqlRouteResult;private ResultSet currentResultSet;ShardingStatement ç±»çš„æ„é€ å‡½æ•°åŒæ ·ä¸æ˜¯å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬å‘ç° StatementExecutor å°±æ˜¯åœ¨è¿™ä¸ªæ„é€ å‡½æ•°ä¸­å®Œæˆäº†å…¶åˆ›å»ºè¿‡ç¨‹ï¼š
public ShardingStatement(final ShardingConnection connection, final int resultSetType, final int resultSetConcurrency, final int resultSetHoldability) {super(Statement.class);this.connection = connection;//åˆ›å»º StatementExecutorstatementExecutor = new StatementExecutor(resultSetType, resultSetConcurrency, resultSetHoldability, connection);}åœ¨ç»§ç»­ä»‹ç» ShardingStatement ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¢³ç†ä¸€ä¸‹ä¸å®ƒç›¸å…³çš„ç±»å±‚ç»“æ„ã€‚æˆ‘ä»¬åœ¨ â€œ06 | è§„èŒƒå…¼å®¹ï¼šJDBC è§„èŒƒä¸ ShardingSphere æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿâ€ ä¸­çš„ ShardingConnection æåˆ°ï¼ŒShardingSphere é€šè¿‡é€‚é…å™¨æ¨¡å¼åŒ…è£…äº†è‡ªå·±çš„å®ç°ç±»ï¼Œé™¤äº†å·²ç»ä»‹ç»çš„ ShardingConnection ç±»ä¹‹å¤–ï¼Œè¿˜åŒ…å«ä»Šå¤©è¦ä»‹ç»çš„ ShardingStatement å’Œ ShardingPreparedStamentã€‚">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="nav-logo">
    <a href="http://yipsen.github.io/">
        
        <span class="nav-title">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æ–‡ç« </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/shardingsphere%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86%e7%b2%be%e8%ae%b2/">ShardingSphereæ ¸å¿ƒåŸç†ç²¾è®²</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/00-%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E5%AD%A6%E4%B9%A0%E4%B8%80%E6%AC%BE%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E5%BC%80%E6%BA%90%E6%A1%86%E6%9E%B6/">00 å¦‚ä½•æ­£ç¡®å­¦ä¹ ä¸€æ¬¾åˆ†åº“åˆ†è¡¨å¼€æºæ¡†æ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/01-%E4%BB%8E%E7%90%86%E8%AE%BA%E5%88%B0%E5%AE%9E%E8%B7%B5%E5%A6%82%E4%BD%95%E8%AE%A9%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E7%9C%9F%E6%AD%A3%E8%90%BD%E5%9C%B0/">01 ä»ç†è®ºåˆ°å®è·µï¼šå¦‚ä½•è®©åˆ†åº“åˆ†è¡¨çœŸæ­£è½åœ°ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/02-%E9%A1%B6%E7%BA%A7%E9%A1%B9%E7%9B%AEshardingsphere-%E6%98%AF%E4%B8%80%E6%AC%BE%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84-apache-%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6/">02 é¡¶çº§é¡¹ç›®ï¼šShardingSphere æ˜¯ä¸€æ¬¾ä»€ä¹ˆæ ·çš„ Apache å¼€æºè½¯ä»¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/03-%E8%A7%84%E8%8C%83%E5%85%BC%E5%AE%B9jdbc-%E8%A7%84%E8%8C%83%E4%B8%8E-shardingsphere-%E6%98%AF%E4%BB%80%E4%B9%88%E5%85%B3%E7%B3%BB/">03 è§„èŒƒå…¼å®¹ï¼šJDBC è§„èŒƒä¸ ShardingSphere æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/04-%E5%BA%94%E7%94%A8%E9%9B%86%E6%88%90%E5%9C%A8%E4%B8%9A%E5%8A%A1%E7%B3%BB%E7%BB%9F%E4%B8%AD%E4%BD%BF%E7%94%A8-shardingsphere-%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B/">04 åº”ç”¨é›†æˆï¼šåœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ä½¿ç”¨ ShardingSphere çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/05-%E9%85%8D%E7%BD%AE%E9%A9%B1%E5%8A%A8shardingsphere-%E4%B8%AD%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BD%93%E7%B3%BB%E6%98%AF%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E7%9A%84/">05 é…ç½®é©±åŠ¨ï¼šShardingSphere ä¸­çš„é…ç½®ä½“ç³»æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/09-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E4%B8%8E%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1/">09 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ä½¿ç”¨å¼ºä¸€è‡´æ€§äº‹åŠ¡ä¸æŸ”æ€§äº‹åŠ¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/10-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E5%A6%82%E4%BD%95%E7%A1%AE%E4%BF%9D%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%89%E5%85%A8%E8%AE%BF%E9%97%AE/">10 æ•°æ®è„±æ•ï¼šå¦‚ä½•ç¡®ä¿æ•æ„Ÿæ•°æ®çš„å®‰å…¨è®¿é—®ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/11-%E7%BC%96%E6%8E%92%E6%B2%BB%E7%90%86%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E5%8A%A8%E6%80%81%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/">11 ç¼–æ’æ²»ç†ï¼šå¦‚ä½•å®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„åŠ¨æ€é…ç½®ç®¡ç†ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/12-%E4%BB%8E%E5%BA%94%E7%94%A8%E5%88%B0%E5%8E%9F%E7%90%86%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E9%98%85%E8%AF%BB-shardingsphere-%E6%BA%90%E7%A0%81/">12 ä»åº”ç”¨åˆ°åŸç†ï¼šå¦‚ä½•é«˜æ•ˆé˜…è¯» ShardingSphere æºç ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/13-%E5%BE%AE%E5%86%85%E6%A0%B8%E6%9E%B6%E6%9E%84shardingsphere-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%89%A9%E5%B1%95%E6%80%A7/">13 å¾®å†…æ ¸æ¶æ„ï¼šShardingSphere å¦‚ä½•å®ç°ç³»ç»Ÿçš„æ‰©å±•æ€§ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/14-%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AEshardingsphere-%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AE%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/">14 åˆ†å¸ƒå¼ä¸»é”®ï¼šShardingSphere ä¸­æœ‰å“ªäº›åˆ†å¸ƒå¼ä¸»é”®å®ç°æ–¹å¼ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/15-%E8%A7%A3%E6%9E%90%E5%BC%95%E6%93%8Esql-%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%8C%85%E6%8B%AC%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E9%98%B6%E6%AE%B5%E4%B8%8A/">15 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/16-%E8%A7%A3%E6%9E%90%E5%BC%95%E6%93%8Esql-%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%8C%85%E6%8B%AC%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E9%98%B6%E6%AE%B5%E4%B8%8B/">16 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/17-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E5%88%86%E7%89%87%E8%B7%AF%E7%94%B1%E6%A0%B8%E5%BF%83%E7%B1%BB-shardingrouter-%E7%9A%84%E8%BF%90%E4%BD%9C%E6%9C%BA%E5%88%B6/">17 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•ç†è§£åˆ†ç‰‡è·¯ç”±æ ¸å¿ƒç±» ShardingRouter çš„è¿ä½œæœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/18-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E7%9A%84%E5%88%86%E7%89%87%E8%B7%AF%E7%94%B1%E5%92%8C%E5%B9%BF%E6%92%AD%E8%B7%AF%E7%94%B1/">18 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•å®ç°æ•°æ®è®¿é—®çš„åˆ†ç‰‡è·¯ç”±å’Œå¹¿æ’­è·¯ç”±ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/19-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E5%9C%A8%E8%B7%AF%E7%94%B1%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%9B%86%E6%88%90%E5%A4%9A%E7%A7%8D%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5%E5%92%8C%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95/">19 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•åœ¨è·¯ç”±è¿‡ç¨‹ä¸­é›†æˆå¤šç§è·¯ç”±ç­–ç•¥å’Œè·¯ç”±ç®—æ³•ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/20-%E6%94%B9%E5%86%99%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84-sql-%E6%94%B9%E5%86%99%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6/">20 æ”¹å†™å¼•æ“ï¼šå¦‚ä½•ç†è§£è£…é¥°å™¨æ¨¡å¼ä¸‹çš„ SQL æ”¹å†™å®ç°æœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/21-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%88%86%E7%89%87%E7%8E%AF%E5%A2%83%E4%B8%8B-sql-%E6%89%A7%E8%A1%8C%E7%9A%84%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E6%8A%BD%E8%B1%A1/">21 æ‰§è¡Œå¼•æ“ï¼šåˆ†ç‰‡ç¯å¢ƒä¸‹ SQL æ‰§è¡Œçš„æ•´ä½“æµç¨‹åº”è¯¥å¦‚ä½•è¿›è¡ŒæŠ½è±¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/22-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E6%8A%8A%E6%8F%A1-shardingsphere-%E4%B8%AD%E7%9A%84-executor-%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B%E4%B8%8A/">22 æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•æŠŠæ¡ ShardingSphere ä¸­çš„ Executor æ‰§è¡Œæ¨¡å‹ï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li>23 æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•æŠŠæ¡ ShardingSphere ä¸­çš„ Executor æ‰§è¡Œæ¨¡å‹ï¼Ÿï¼ˆä¸‹ï¼‰</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/24-%E5%BD%92%E5%B9%B6%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%95%B0%E6%8D%AE%E5%BD%92%E5%B9%B6%E7%9A%84%E7%B1%BB%E5%9E%8B%E4%BB%A5%E5%8F%8A%E7%AE%80%E5%8D%95%E5%BD%92%E5%B9%B6%E7%AD%96%E7%95%A5%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/">24 å½’å¹¶å¼•æ“ï¼šå¦‚ä½•ç†è§£æ•°æ®å½’å¹¶çš„ç±»å‹ä»¥åŠç®€å•å½’å¹¶ç­–ç•¥çš„å®ç°è¿‡ç¨‹ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/25-%E5%BD%92%E5%B9%B6%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%B5%81%E5%BC%8F%E5%BD%92%E5%B9%B6%E5%92%8C%E5%86%85%E5%AD%98%E5%BD%92%E5%B9%B6%E5%9C%A8%E5%A4%8D%E6%9D%82%E5%BD%92%E5%B9%B6%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84%E5%BA%94%E7%94%A8%E6%96%B9%E5%BC%8F/">25 å½’å¹¶å¼•æ“ï¼šå¦‚ä½•ç†è§£æµå¼å½’å¹¶å’Œå†…å­˜å½’å¹¶åœ¨å¤æ‚å½’å¹¶åœºæ™¯ä¸‹çš„åº”ç”¨æ–¹å¼ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/26-%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%99%AE%E9%80%9A%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84%E5%92%8C%E5%88%86%E7%89%87%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84%E5%88%86%E5%88%AB%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%9A%84/">26 è¯»å†™åˆ†ç¦»ï¼šæ™®é€šä¸»ä»æ¶æ„å’Œåˆ†ç‰‡ä¸»ä»æ¶æ„åˆ†åˆ«æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/27-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3-shardingsphere-%E4%B8%AD%E5%AF%B9%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%8A%BD%E8%B1%A1%E8%BF%87%E7%A8%8B/">27 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ç†è§£ ShardingSphere ä¸­å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„æŠ½è±¡è¿‡ç¨‹ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/28-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1shardingsphere-%E4%B8%AD%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E5%92%8C%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1%E6%94%AF%E6%8C%81%E4%B8%8A/">28 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šShardingSphere ä¸­å¦‚ä½•é›†æˆå¼ºä¸€è‡´æ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡æ”¯æŒï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/29-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1shardingsphere-%E4%B8%AD%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E5%92%8C%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1%E6%94%AF%E6%8C%81%E4%B8%8B/">29 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šShardingSphere ä¸­å¦‚ä½•é›†æˆå¼ºä¸€è‡´æ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡æ”¯æŒï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/30-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E6%94%B9%E5%86%99%E5%BC%95%E6%93%8E%E5%AE%9E%E7%8E%B0%E4%BD%8E%E4%BE%B5%E5%85%A5%E6%80%A7%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E6%96%B9%E6%A1%88/">30 æ•°æ®è„±æ•ï¼šå¦‚ä½•åŸºäºæ”¹å†™å¼•æ“å®ç°ä½ä¾µå…¥æ€§æ•°æ®è„±æ•æ–¹æ¡ˆï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/31-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%AE%9E%E7%8E%B0%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E7%9A%84%E5%8A%A8%E6%80%81%E5%8C%96%E7%AE%A1%E7%90%86/">31 é…ç½®ä¸­å¿ƒï¼šå¦‚ä½•åŸºäºé…ç½®ä¸­å¿ƒå®ç°é…ç½®ä¿¡æ¯çš„åŠ¨æ€åŒ–ç®¡ç†ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/32-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BF%E9%97%AE%E7%86%94%E6%96%AD%E6%9C%BA%E5%88%B6/">32 æ³¨å†Œä¸­å¿ƒï¼šå¦‚ä½•åŸºäºæ³¨å†Œä¸­å¿ƒå®ç°æ•°æ®åº“è®¿é—®ç†”æ–­æœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/33-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E-hook-%E6%9C%BA%E5%88%B6%E4%BB%A5%E5%8F%8A-opentracing-%E5%8D%8F%E8%AE%AE%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/">33 é“¾è·¯è·Ÿè¸ªï¼šå¦‚ä½•åŸºäº Hook æœºåˆ¶ä»¥åŠ OpenTracing åè®®å®ç°æ•°æ®è®¿é—®é“¾è·¯è·Ÿè¸ªï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/35-%E7%BB%93%E8%AF%ADshardingsphere-%E6%80%BB%E7%BB%93%E5%8F%8A%E5%B1%95%E6%9C%9B/">35 ç»“è¯­ï¼šShardingSphere æ€»ç»“åŠå±•æœ›</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">23 æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•æŠŠæ¡ ShardingSphere ä¸­çš„ Executor æ‰§è¡Œæ¨¡å‹ï¼Ÿï¼ˆä¸‹ï¼‰</h1>
        <div class="post-info">
            <div class="post-date"> 
                <span>2021-12-22 01:56:02</span>
            </div>
        </div>
        <div class="post-content">
            <p>åœ¨ä¸Šä¸€è¯¾æ—¶ï¼Œæˆ‘ä»¬å·²ç»å¯¹ ShardingSphere æ‰§è¡Œå¼•æ“ä¸­å…³äºåº•å±‚çš„ SQLExecuteTemplateï¼Œä»¥åŠä¸Šå±‚çš„ StatementExecutor å’Œ PreparedStatementExecutor å¯¹è±¡è¿›è¡Œäº†å…¨é¢ä»‹ç»ã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘ä»¬åœ¨æ­¤åŸºç¡€ä¸Šæ›´ä¸Šä¸€å±‚ï¼Œé‡ç‚¹å…³æ³¨ ShardingStatement å’Œ ShardingPreparedStatement å¯¹è±¡ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡åˆ†åˆ«æ˜¯ StatementExecutor å’Œ PreparedStatementExecutor çš„ä½¿ç”¨è€…ã€‚</p>
<h3 id="shardingstatement">ShardingStatement</h3>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ ShardingStatement ç±»ï¼Œè¯¥ç±»ä¸­çš„å˜é‡åœ¨å‰é¢çš„å†…å®¹ä¸­éƒ½å·²ç»æœ‰è¿‡ä»‹ç»ï¼š</p>
<pre tabindex="0"><code>private final ShardingConnection connection;
private final StatementExecutor statementExecutor;
private boolean returnGeneratedKeys;
private SQLRouteResult sqlRouteResult;
private ResultSet currentResultSet;
</code></pre><p>ShardingStatement ç±»çš„æ„é€ å‡½æ•°åŒæ ·ä¸æ˜¯å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬å‘ç° StatementExecutor å°±æ˜¯åœ¨è¿™ä¸ªæ„é€ å‡½æ•°ä¸­å®Œæˆäº†å…¶åˆ›å»ºè¿‡ç¨‹ï¼š</p>
<pre tabindex="0"><code>public ShardingStatement(final ShardingConnection connection, final int resultSetType, final int resultSetConcurrency, final int resultSetHoldability) {
    super(Statement.class);
    this.connection = connection;
    //åˆ›å»º StatementExecutor
    statementExecutor = new StatementExecutor(resultSetType, resultSetConcurrency, resultSetHoldability, connection);
}
</code></pre><p>åœ¨ç»§ç»­ä»‹ç» ShardingStatement ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¢³ç†ä¸€ä¸‹ä¸å®ƒç›¸å…³çš„ç±»å±‚ç»“æ„ã€‚æˆ‘ä»¬åœ¨ <strong>â€œ06 | è§„èŒƒå…¼å®¹ï¼šJDBC è§„èŒƒä¸ ShardingSphere æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿâ€</strong> ä¸­çš„ ShardingConnection æåˆ°ï¼ŒShardingSphere é€šè¿‡é€‚é…å™¨æ¨¡å¼åŒ…è£…äº†è‡ªå·±çš„å®ç°ç±»ï¼Œé™¤äº†å·²ç»ä»‹ç»çš„ ShardingConnection ç±»ä¹‹å¤–ï¼Œè¿˜åŒ…å«ä»Šå¤©è¦ä»‹ç»çš„ ShardingStatement å’Œ ShardingPreparedStamentã€‚</p>
<p>æ ¹æ®è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³è±¡ ShardingStatement åº”è¯¥å…·å¤‡ä¸ ShardingConnection ç±»ä¼¼çš„ç±»å±‚ç»“æ„ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl9MzLGAdeNfAACM0dnojxQ073.png" alt="Drawing 0.png"></p>
<p>ç„¶åæˆ‘ä»¬æ¥åˆ°ä¸Šå›¾ä¸­ AbstractStatementAdapter ç±»ï¼Œè¿™é‡Œçš„å¾ˆå¤šæ–¹æ³•çš„é£æ ¼éƒ½ä¸ ShardingConnection çš„çˆ¶ç±» AbstractConnectionAdapter ä¸€è‡´ï¼Œä¾‹å¦‚å¦‚ä¸‹æ‰€ç¤ºçš„ setPoolable æ–¹æ³•ï¼š</p>
<pre tabindex="0"><code>public final void setPoolable(final boolean poolable) throws SQLException {
    this.poolable = poolable;
    recordMethodInvocation(targetClass, &quot;setPoolable&quot;, new Class[] {boolean.class}, new Object[] {poolable});
    forceExecuteTemplate.execute((Collection) getRoutedStatements(), new ForceExecuteCallback&lt;Statement&gt;() {

        @Override
        public void execute(final Statement statement) throws SQLException {
            statement.setPoolable(poolable);
        }
    });
</code></pre><blockquote>
<p>è¿™é‡Œæ¶‰åŠçš„ recordMethodInvocation æ–¹æ³•ã€ForceExecuteTemplateï¼Œä»¥åŠ ForceExecuteCallback æˆ‘ä»¬éƒ½å·²ç»åœ¨â€œ03 | è§„èŒƒå…¼å®¹ï¼šJDBC è§„èŒƒä¸ ShardingSphere æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿâ€ä¸­è¿›è¡Œäº†ä»‹ç»ï¼Œè¿™é‡Œä¸å†å±•å¼€ã€‚</p>
</blockquote>
<p>åŒæ ·ï¼ŒAbstractStatementAdapter çš„çˆ¶ç±» AbstractUnsupportedOperationStatement çš„ä½œç”¨ä¹Ÿä¸ AbstractUnsupportedOperationConnection çš„ä½œç”¨å®Œå…¨ä¸€è‡´ã€‚</p>
<p>äº†è§£äº† ShardingStatement çš„ç±»å±‚ç»“æ„ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹å®ƒçš„æ ¸å¿ƒæ–¹æ³•ï¼Œé¦–å½“å…¶å†²çš„è¿˜æ˜¯å®ƒçš„ executeQuery æ–¹æ³•ï¼š</p>
<pre tabindex="0"><code>@Override
public ResultSet executeQuery(final String sql) throws SQLException {
    if (Strings.isNullOrEmpty(sql)) {
        throw new SQLException(SQLExceptionConstant.SQL_STRING_NULL_OR_EMPTY);
    }
    ResultSet result;
    try {
         //æ¸…é™¤ StatementExecutor ä¸­çš„ç›¸å…³å˜é‡
        clearPrevious();
        //æ‰§è¡Œè·¯ç”±å¼•æ“ï¼Œè·å–è·¯ç”±ç»“æœ
        shard(sql);
        //åˆå§‹åŒ– StatementExecutor
        initStatementExecutor();
        //è°ƒç”¨å½’å¹¶å¼•æ“
        MergeEngine mergeEngine = MergeEngineFactory.newInstance(connection.getRuntimeContext().getDatabaseType(), connection.getRuntimeContext().getRule(), sqlRouteResult, connection.getRuntimeContext().getMetaData().getRelationMetas(), statementExecutor.executeQuery());
        //è·å–å½’å¹¶ç»“æœ
        result = getResultSet(mergeEngine);
    } finally {
        currentResultSet = null;
    }
    currentResultSet = result;
    return result;
}
</code></pre><p>è¿™ä¸ªæ–¹æ³•ä¸­æœ‰å‡ ä¸ªå­æ–¹æ³•å€¼å¾—å…·ä½“å±•å¼€ä¸€ä¸‹ï¼Œé¦–å…ˆæ˜¯ shard æ–¹æ³•ï¼š</p>
<pre tabindex="0"><code>private void shard(final String sql) {
    //ä» Connection ä¸­è·å– ShardingRuntimeContext ä¸Šä¸‹æ–‡
    ShardingRuntimeContext runtimeContext = connection.getRuntimeContext();
    //åˆ›å»º SimpleQueryShardingEngine
    SimpleQueryShardingEngine shardingEngine = new SimpleQueryShardingEngine(runtimeContext.getRule(), runtimeContext.getProps(), runtimeContext.getMetaData(), runtimeContext.getParseEngine());
    //æ‰§è¡Œåˆ†ç‰‡è·¯ç”±å¹¶è·å–è·¯ç”±ç»“æœ
    sqlRouteResult = shardingEngine.shard(sql, Collections.emptyList());
}
</code></pre><p>è¿™æ®µä»£ç å°±æ˜¯è·¯ç”±å¼•æ“çš„å…¥å£ï¼Œæˆ‘ä»¬åˆ›å»ºäº† SimpleQueryShardingEngineï¼Œå¹¶è°ƒç”¨å®ƒçš„ shard æ–¹æ³•è·å–è·¯ç”±ç»“æœå¯¹è±¡ SQLRouteResultã€‚</p>
<p>ç„¶åæˆ‘ä»¬æ¥çœ‹ initStatementExecutor æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>private void initStatementExecutor() throws SQLException {
    statementExecutor.init(sqlRouteResult);
    replayMethodForStatements();
}
</code></pre><p>è¿™é‡Œé€šè¿‡è·¯ç”±ç»“æœå¯¹è±¡ SQLRouteResult å¯¹ statementExecutor è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œç„¶åæ‰§è¡Œäº†ä¸€ä¸ª replayMethodForStatements æ–¹æ³•ï¼š</p>
<pre tabindex="0"><code>private void replayMethodForStatements() {
    for (Statement each : statementExecutor.getStatements()) {
        replayMethodsInvocation(each);
    }
}
</code></pre><p>è¯¥æ–¹æ³•å®é™…ä¸Šå°±æ˜¯è°ƒç”¨äº†åŸºäºåå°„çš„ replayMethodsInvocation æ–¹æ³•ï¼Œç„¶åè¿™ä¸ªreplayMethodsInvocation æ–¹æ³•ä¼šé’ˆå¯¹ statementExecutor ä¸­æ‰€æœ‰ Statementçš„ SQL æ“ä½œæ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬é€šè¿‡æ‰§è¡Œ statementExecutor.executeQuery() æ–¹æ³•è·å– SQL æ‰§è¡Œçš„ç»“æœï¼Œå¹¶ç”¨è¿™ä¸ªç»“æœæ¥åˆ›å»º<strong>å½’å¹¶å¼•æ“ MergeEngine</strong>ï¼Œå¹¶é€šè¿‡å½’å¹¶å¼•æ“ MergeEngine è·å–æœ€ç»ˆçš„æ‰§è¡Œç»“æœã€‚</p>
<blockquote>
<p><strong>å½’å¹¶å¼•æ“</strong>æ˜¯ ShardingSphere ä¸­ä¸ SQL è§£æå¼•æ“ã€è·¯ç”±å¼•æ“ä»¥åŠæ‰§è¡Œå¼•æ“å¹¶åˆ—çš„ä¸€ä¸ªå¼•æ“ï¼Œæˆ‘ä»¬åœ¨ä¸‹ä¸€è¯¾æ—¶ä¸­å°±ä¼šå¼€å§‹ä»‹ç»è¿™å—å†…å®¹ï¼Œè¿™é‡Œå…ˆä¸åšå…·ä½“å±•å¼€ã€‚</p>
</blockquote>
<p>ä»¥ ShardingStatement ä¸­çš„å…¶ä¸­ä¸€ä¸ª executeUpdate æ–¹æ³•ä¸ºä¾‹ï¼Œå¯ä»¥çœ‹åˆ°å®ƒçš„æ‰§è¡Œæµç¨‹ä¹Ÿä¸å‰é¢çš„ executeQuery æ–¹æ³•éå¸¸ç±»ä¼¼ï¼š</p>
<pre tabindex="0"><code>@Override
public int executeUpdate(final String sql) throws SQLException {
    try {
         //æ¸…é™¤ StatementExecutor ä¸­çš„ç›¸å…³å˜é‡
        clearPrevious();
        //æ‰§è¡Œè·¯ç”±å¼•æ“ï¼Œè·å–è·¯ç”±ç»“æœ
        shard(sql);
        //åˆå§‹åŒ– StatementExecutor
        initStatementExecutor();
        return statementExecutor.executeUpdate();
    } finally {
        currentResultSet = null;
    }
}
</code></pre><p>å½“ç„¶ï¼Œå¯¹äº Update æ“ä½œè€Œè¨€ï¼Œä¸éœ€è¦é€šè¿‡å½’å¹¶å¼•æ“åšç»“æœçš„å½’å¹¶ã€‚</p>
<h3 id="shardingpreparedstatement">ShardingPreparedStatement</h3>
<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹ ShardingPreparedStatement ç±»ï¼Œè¿™ä¸ªç±»çš„å˜é‡ä¹ŸåŸºæœ¬éƒ½æ˜¯å‰é¢ä»‹ç»è¿‡çš„å¯¹è±¡ï¼š</p>
<pre tabindex="0"><code>private final ShardingConnection connection;
private final String sql;
private final PreparedQueryShardingEngine shardingEngine;
private final PreparedStatementExecutor preparedStatementExecutor;
private final BatchPreparedStatementExecutor batchPreparedStatementExecutor;
private SQLRouteResult sqlRouteResult;
private ResultSet currentResultSet;
</code></pre><p>è¿™é‡Œçš„ ShardingEngineã€PreparedStatementExecutor å’Œ BatchPreparedStatementExecutor å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹éƒ½å‘ç”Ÿåœ¨ ShardingPreparedStatement çš„æ„é€ å‡½æ•°ä¸­ã€‚</p>
<p>ç„¶åæˆ‘ä»¬æ¥çœ‹å®ƒçš„ä»£è¡¨æ€§æ–¹æ³• ExecuteQueryï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>@Override
public ResultSet executeQuery() throws SQLException {
    ResultSet result;
    try {
        clearPrevious();
        shard();
        initPreparedStatementExecutor();
        MergeEngine mergeEngine = MergeEngineFactory.newInstance(connection.getRuntimeContext().getDatabaseType(), connection.getRuntimeContext().getRule(), sqlRouteResult, connection.getRuntimeContext().getMetaData().getRelationMetas(), preparedStatementExecutor.executeQuery());
        result = getResultSet(mergeEngine);
    } finally {
        clearBatch();
    }
    currentResultSet = result;
    return result;
}
</code></pre><p>è¿™é‡Œæˆ‘ä»¬æ²¡åŠ æ³¨é‡Šï¼Œä½†ä¹Ÿåº”è¯¥ç†è§£è¿™ä¸€æ–¹æ³•çš„æ‰§è¡Œæµç¨‹ï¼Œå› ä¸ºè¯¥æ–¹æ³•çš„é£æ ¼ä¸ ShardingStatement ä¸­çš„åŒåæ–¹æ³•éå¸¸ä¸€è‡´ã€‚</p>
<p>å…³äº ShardingPreparedStatement å°±æ²¡æœ‰å¤ªå¤šå¯ä»¥ä»‹ç»çš„å†…å®¹äº†ï¼Œæˆ‘ä»¬æ¥ç€æ¥çœ‹å®ƒçš„çˆ¶ç±»<strong>AbstractShardingPreparedStatementAdapter ç±»</strong>ï¼Œçœ‹åˆ°è¯¥ç±»æŒæœ‰ä¸€ä¸ª SetParameterMethodInvocation çš„åˆ—è¡¨ï¼Œä»¥åŠä¸€ä¸ªå‚æ•°åˆ—è¡¨ï¼š</p>
<pre tabindex="0"><code>private final List&lt;SetParameterMethodInvocation&gt; setParameterMethodInvocations = new LinkedList&lt;&gt;();
private final List&lt;Object&gt; parameters = new ArrayList&lt;&gt;();
</code></pre><p>è¿™é‡Œçš„ SetParameterMethodInvocation ç±»ç›´æ¥é›†æˆäº†ä»‹ç» ShardingConnection æ—¶æåˆ°çš„ JdbcMethodInvocation ç±»ï¼š</p>
<pre tabindex="0"><code>public final class SetParameterMethodInvocation extends JdbcMethodInvocation {

    @Getter
    private final int index;

    @Getter
    private final Object value;

    public SetParameterMethodInvocation(final Method method, final Object[] arguments, final Object value) {
        super(method, arguments);
        this.index = (int) arguments[0];
        this.value = value;
    }

    public void changeValueArgument(final Object value) {
        getArguments()[1] = value;
    }
}
</code></pre><p>å¯¹äº ShardingPreparedStatement è€Œè¨€ï¼Œè¿™ä¸ªç±»çš„ä½œç”¨æ˜¯åœ¨ JdbcMethodInvocation ä¸­æ‰€ä¿å­˜çš„æ–¹æ³•å’Œå‚æ•°çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ äº† SQL æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€éœ€è¦çš„å‚æ•°ä¿¡æ¯ã€‚</p>
<p>æ‰€ä»¥å®ƒçš„ replaySetParameter æ–¹æ³•å°±å˜æˆäº†å¦‚ä¸‹çš„é£æ ¼ï¼š</p>
<pre tabindex="0"><code>protected final void replaySetParameter(final PreparedStatement preparedStatement, final List&lt;Object&gt; parameters) {
    setParameterMethodInvocations.clear();
   //æ·»åŠ å‚æ•°ä¿¡æ¯
    addParameters(parameters);
    for (SetParameterMethodInvocation each : setParameterMethodInvocations) {
        each.invoke(preparedStatement);
    }
}
</code></pre><p>å…³äº AbstractShardingPreparedStatementAdapter è¿˜éœ€è¦æ³¨æ„çš„æ˜¯å®ƒçš„<strong>ç±»å±‚ç»“æ„</strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ° AbstractShardingPreparedStatementAdapter ç»§æ‰¿äº† AbstractUnsupportedOperationPreparedStatement ç±»ï¼›è€Œ AbstractUnsupportedOperationPreparedStatement å´åˆç»§æ‰¿äº† AbstractStatementAdapter ç±»å¹¶å®ç°äº† PreparedStatementï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F9MzNeACiagAACzQd-8eig186.png" alt="Drawing 2.png"></p>
<p>å½¢æˆè¿™ç§ç±»å±‚ç»“æ„çš„åŸå› åœ¨äºï¼ŒPreparedStatement æœ¬æ¥å°±æ˜¯åœ¨ Statement çš„åŸºç¡€ä¸Šæ·»åŠ äº†å„ç§å‚æ•°è®¾ç½®åŠŸèƒ½ï¼Œæ¢å¥è¯è¯´ï¼ŒStatement çš„åŠŸèƒ½ PreparedStatement éƒ½åº”è¯¥æœ‰ã€‚</p>
<p>æ‰€ä»¥ä¸€æ–¹é¢ AbstractStatementAdapter æä¾›äº†æ‰€æœ‰ Statement çš„åŠŸèƒ½ï¼›å¦ä¸€æ–¹é¢ï¼ŒAbstractShardingPreparedStatementAdapter é¦–å…ˆæŠŠ AbstractStatementAdapter æ‰€æœ‰çš„åŠŸèƒ½ç»§æ‰¿è¿‡æ¥ï¼Œä½†å®ƒè‡ªèº«å¯èƒ½æœ‰ä¸€äº›æ— æ³•å®ç°çš„å…³äº PreparedStatement çš„åŠŸèƒ½ï¼Œæ‰€ä»¥åŒæ ·æä¾›äº† AbstractUnsupportedOperationPreparedStatement ç±»ï¼Œå¹¶è¢«æœ€ç»ˆçš„ AbstractShardingPreparedStatementAdapter é€‚é…å™¨ç±»æ‰€ç»§æ‰¿ã€‚</p>
<p>è¿™æ ·å°±å½¢æˆäº†å¦‚ä¸Šå›¾æ‰€ç¤ºçš„å¤æ‚ç±»å±‚ç»“æ„ã€‚</p>
<h3 id="shardingconnection">ShardingConnection</h3>
<p>ä»‹ç»å®Œ ShardingStatement å’Œ ShardingPreparedStatement ä¹‹åï¼Œæˆ‘ä»¬æ¥å…³æ³¨ä½¿ç”¨å®ƒä»¬çš„å…·ä½“åº”ç”¨åœºæ™¯ï¼Œè¿™ä¹Ÿæ˜¯ ShardingSphere æ‰§è¡Œå¼•æ“çš„æœ€åä¸€éƒ¨åˆ†å†…å®¹ã€‚</p>
<p>é€šè¿‡æŸ¥çœ‹è°ƒç”¨å…³ç³»ï¼Œæˆ‘ä»¬å‘ç°åˆ›å»ºè¿™ä¸¤ä¸ªç±»çš„å…¥å£éƒ½åœ¨ ShardingConnection ç±»ä¸­ï¼Œè¯¥ç±»åŒ…å«äº†ç”¨äºåˆ›å»º ShardingStatement çš„ createStatement æ–¹æ³•å’Œç”¨äºåˆ›å»º ShardingPreparedStatement çš„ prepareStatement æ–¹æ³•ï¼Œä»¥åŠå®ƒä»¬çš„å„ç§é‡è½½æ–¹æ³•ï¼š</p>
<pre tabindex="0"><code>@Override
public Statement createStatement(final int resultSetType, final int resultSetConcurrency, final int resultSetHoldability) {
    return new ShardingStatement(this, resultSetType, resultSetConcurrency, resultSetHoldability);
 }
 
@Override
public PreparedStatement prepareStatement(final String sql, final int resultSetType, final int resultSetConcurrency, final int resultSetHoldability) throws SQLException {
    return new ShardingPreparedStatement(this, sql, resultSetType, resultSetConcurrency, resultSetHoldability);
}
</code></pre><p>åŒæ—¶ï¼ŒShardingConnection ä¸­åŒ…å«äº†ç”¨äºç®¡ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„ ShardingTransactionManagerã€‚å…³äºåˆ†å¸ƒå¼äº‹åŠ¡çš„è®¨è®ºä¸æ˜¯ä»Šå¤©çš„é‡ç‚¹ï¼Œæˆ‘ä»¬åé¢ä¼šæœ‰ä¸“é¢˜æ¥åšè¯¦ç»†å±•å¼€ã€‚</p>
<p>ä½†æˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸€ä¸‹ commit å’Œ rollback æ–¹æ³•ï¼š</p>
<pre tabindex="0"><code>@Override
public void commit() throws SQLException {
    if (TransactionType.LOCAL == transactionType) {
        super.commit();
    } else {
        shardingTransactionManager.commit();
    }
}

@Override
public void rollback() throws SQLException {
    if (TransactionType.LOCAL == transactionType) {
        super.rollback();
    } else {
        shardingTransactionManager.rollback();
    }
}
</code></pre><p>å¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªæ–¹æ³•çš„é€»è¾‘è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°çš„ï¼Œå³å½“äº‹åŠ¡ç±»å‹ä¸ºæœ¬åœ°äº‹åŠ¡æ—¶ç›´æ¥è°ƒç”¨ ShardingConnection çˆ¶ç±» AbstractConnectionAdapter ä¸­çš„ commit å’Œ rollback æ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¼šè°ƒç”¨çœŸæ­£çš„ connection çš„ç›¸å…³æ–¹æ³•ã€‚</p>
<p>ä»¥ commit æ–¹æ³•ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° AbstractConnectionAdapter ä¸­åŸºäºè¿™ä¸€è®¾è®¡æ€æƒ³çš„å®ç°è¿‡ç¨‹ï¼š</p>
<pre tabindex="0"><code>@Override
public void commit() throws SQLException {
    forceExecuteTemplate.execute(cachedConnections.values(), new ForceExecuteCallback&lt;Connection&gt;() {

        @Override
        public void execute(final Connection connection) throws SQLException {
            connection.commit();
        }
    });
}
</code></pre><h3 id="shardingdatasource">ShardingDataSource</h3>
<p>æˆ‘ä»¬çŸ¥é“åœ¨ JDBC è§„èŒƒä¸­ï¼Œå¯ä»¥é€šè¿‡ DataSource è·å– Connection å¯¹è±¡ã€‚ShardingSphere å®Œå…¨å…¼å®¹ JDBC è§„èŒƒï¼Œæ‰€ä»¥ ShardingConnection çš„åˆ›å»ºè¿‡ç¨‹åº”è¯¥ä¹Ÿæ˜¯åœ¨å¯¹åº”çš„ DataSource ä¸­ï¼Œè¿™ä¸ª DataSource å°±æ˜¯<strong>ShardingDataSource</strong>ã€‚</p>
<p>ShardingDataSource ç±»æ¯”è¾ƒç®€å•ï¼Œå…¶æ„é€ å‡½æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public ShardingDataSource(final Map&lt;String, DataSource&gt; dataSourceMap, final ShardingRule shardingRule, final Properties props) throws SQLException {
    super(dataSourceMap);
    checkDataSourceType(dataSourceMap);
    runtimeContext = new ShardingRuntimeContext(dataSourceMap, shardingRule, props, getDatabaseType());
}
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒShardingRuntimeContext è¿™ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡æ˜¯åœ¨ ShardingDataSource çš„æ„é€ å‡½æ•°ä¸­è¢«åˆ›å»ºçš„ï¼Œè€Œåˆ›å»º ShardingConnection çš„è¿‡ç¨‹ä¹Ÿå¾ˆç›´æ¥ï¼š</p>
<pre tabindex="0"><code>@Override
public final ShardingConnection getConnection() {
    return new ShardingConnection(getDataSourceMap(), runtimeContext, TransactionTypeHolder.get());
}
</code></pre><p>åœ¨ ShardingDataSource çš„å®ç°ä¸Šï¼Œä¹ŸåŒæ ·é‡‡ç”¨çš„æ˜¯è£…é¥°å™¨æ¨¡å¼ï¼Œæ‰€ä»¥å®ƒçš„ç±»å±‚ç»“æ„ä¹Ÿä¸ ShardingConnection çš„ç±»ä¼¼ã€‚åœ¨ ShardingDataSource çš„çˆ¶ç±» AbstractDataSourceAdapter ä¸­ï¼Œä¸»è¦çš„å·¥ä½œæ˜¯å®Œæˆ DatabaseType çš„åˆ›å»ºï¼Œæ ¸å¿ƒæ–¹æ³• createDatabaseType å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>private DatabaseType createDatabaseType(final DataSource dataSource) throws SQLException {
    if (dataSource instanceof AbstractDataSourceAdapter) {
        return ((AbstractDataSourceAdapter) dataSource).databaseType;
    }
    try (Connection connection = dataSource.getConnection()) {
        return DatabaseTypes.getDatabaseTypeByURL(connection.getMetaData().getURL());
    }
}
</code></pre><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œä½¿ç”¨åˆ°äº† DatabaseTypes ç±»ï¼Œè¯¥ç±»è´Ÿè´£ DatabaseType å®ä¾‹çš„åŠ¨æ€ç®¡ç†ã€‚è€Œåœ¨ ShardingSphere ä¸­ï¼ŒDatabaseType æ¥å£ä»£è¡¨æ•°æ®åº“ç±»å‹ï¼š</p>
<pre tabindex="0"><code>public interface DatabaseType {
    //è·å–æ•°æ®åº“åç§°
String getName();
//è·å– JDBC URL çš„å‰ç¼€
Collection&lt;String&gt; getJdbcUrlPrefixAlias();
//è·å–æ•°æ®æºå…ƒæ•°æ®
    DataSourceMetaData getDataSourceMetaData(String url, String username);
}
</code></pre><p>å¯ä»¥æƒ³è±¡ ShardingSphere ä¸­é’ˆå¯¹å„ç§æ•°æ®åº“æä¾›äº† DatabaseType æ¥å£çš„å®ç°ç±»ï¼Œå…¶ä¸­ä»¥ MySQLDatabaseType ä¸ºä¾‹ï¼š</p>
<pre tabindex="0"><code>public final class MySQLDatabaseType implements DatabaseType {

    @Override
    public String getName() {
        return &quot;MySQL&quot;;
    }

    @Override
    public Collection&lt;String&gt; getJdbcUrlPrefixAlias() {
        return Collections.singletonList(&quot;jdbc:mysqlx:&quot;);
    }

    @Override
    public MySQLDataSourceMetaData getDataSourceMetaData(final String url, final String username) {
        return new MySQLDataSourceMetaData(url);
    }
}
</code></pre><p>ä¸Šè¿°ä»£ç ä¸­çš„ MySQLDataSourceMetaData å®ç°äº† DataSourceMetaData æ¥å£ï¼Œå¹¶æä¾›å¦‚ä¸‹æ‰€ç¤ºçš„å¯¹è¾“å…¥ url çš„è§£æè¿‡ç¨‹ï¼š</p>
<pre tabindex="0"><code>public MySQLDataSourceMetaData(final String url) {
    Matcher matcher = pattern.matcher(url);
    if (!matcher.find()) {
        throw new UnrecognizedDatabaseURLException(url, pattern.pattern());
    }
    hostName = matcher.group(4);
    port = Strings.isNullOrEmpty(matcher.group(5)) ? DEFAULT_PORT : Integer.valueOf(matcher.group(5));
    catalog = matcher.group(6);
    schema = null;
}
</code></pre><p>æ˜¾ç„¶ï¼ŒDatabaseType ç”¨äºä¿å­˜ä¸ç‰¹å®šæ•°æ®åº“å…ƒæ•°æ®ç›¸å…³çš„ä¿¡æ¯ï¼ŒShardingSphere è¿˜åŸºäº SPI æœºåˆ¶å®ç°å¯¹å„ç§ DatabaseType å®ä¾‹çš„åŠ¨æ€ç®¡ç†ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬æ¥åˆ° ShardingDataSourceFactory å·¥å‚ç±»ï¼Œè¯¥ç±»è´Ÿè´£ ShardingDataSource çš„åˆ›å»ºï¼š</p>
<pre tabindex="0"><code>public final class ShardingDataSourceFactory {

    public static DataSource createDataSource(
            final Map&lt;String, DataSource&gt; dataSourceMap, final ShardingRuleConfiguration shardingRuleConfig, final Properties props) throws SQLException {
        return new ShardingDataSource(dataSourceMap, new ShardingRule(shardingRuleConfig, dataSourceMap.keySet()), props);
    }
}
</code></pre><p>æˆ‘ä»¬åœ¨è¿™é‡Œåˆ›å»ºäº† ShardingDataSourceï¼ŒåŒæ—¶å‘ç° ShardingRule çš„åˆ›å»ºè¿‡ç¨‹å®é™…ä¸Šä¹Ÿæ˜¯åœ¨è¿™é‡Œï¼Œé€šè¿‡ä¼ å…¥çš„ ShardingRuleConfiguration æ¥æ„å»ºä¸€ä¸ªæ–°çš„ ShardingRule å¯¹è±¡ã€‚</p>
<p>ä¸€æ—¦åˆ›å»ºäº† DataSourceï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä¸ JDBC è§„èŒƒå®Œå…¨å…¼å®¹çš„ APIï¼Œé€šè¿‡è¯¥ DataSource å®Œæˆå„ç§ SQL çš„æ‰§è¡Œã€‚æˆ‘ä»¬å¯ä»¥å›é¡¾ ShardingDataSourceFactory çš„ä½¿ç”¨è¿‡ç¨‹æ¥åŠ æ·±å¯¹ä»–çš„ç†è§£ï¼š</p>
<pre tabindex="0"><code>public DataSource dataSource() throws SQLException {
     //åˆ›å»ºåˆ†ç‰‡è§„åˆ™é…ç½®ç±»
    ShardingRuleConfiguration shardingRuleConfig = new ShardingRuleConfiguration();

    //åˆ›å»ºåˆ†è¡¨è§„åˆ™é…ç½®ç±»
    TableRuleConfiguration tableRuleConfig = new TableRuleConfiguration(&quot;user&quot;, &quot;ds${0..1}.user${0..1}&quot;);

    //åˆ›å»ºåˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆé…ç½®ç±»
    Properties properties = new Properties();
    result.setProperty(&quot;worker.id&quot;, &quot;33&quot;);
    KeyGeneratorConfiguration keyGeneratorConfig = new KeyGeneratorConfiguration(&quot;SNOWFLAKE&quot;, &quot;id&quot;, properties);
    result.setKeyGeneratorConfig(keyGeneratorConfig);
    shardingRuleConfig.getTableRuleConfigs().add(tableRuleConfig);

    //æ ¹æ®å¹´é¾„åˆ†åº“ï¼Œä¸€å…±åˆ†ä¸º 2 ä¸ªåº“
   shardingRuleConfig.setDefaultDatabaseShardingStrategyConfig(new InlineShardingStrategyConfiguration(&quot;sex&quot;, &quot;ds${sex % 2}&quot;));

    //æ ¹æ®ç”¨æˆ· id åˆ†è¡¨ï¼Œä¸€å…±åˆ†ä¸º 2 å¼ è¡¨
    shardingRuleConfig.setDefaultTableShardingStrategyConfig(new StandardShardingStrategyConfiguration(&quot;id&quot;, &quot;user${id % 2}&quot;));

    //é€šè¿‡å·¥å‚ç±»åˆ›å»ºå…·ä½“çš„ DataSource
    return ShardingDataSourceFactory.createDataSource(createDataSourceMap(), shardingRuleConfig, new Properties());
}
</code></pre><p>ä¸€æ—¦è·å–äº†ç›®æ ‡ DataSource ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ JDBC ä¸­çš„æ ¸å¿ƒæ¥å£æ¥æ‰§è¡Œä¼ å…¥çš„ SQL è¯­å¥ï¼š</p>
<pre tabindex="0"><code>List&lt;User&gt; getUsers(final String sql) throws SQLException {
    List&lt;User&gt; result = new LinkedList&lt;&gt;();
    try (Connection connection = dataSource.getConnection();
         PreparedStatement preparedStatement = connection.prepareStatement(sql);
         ResultSet resultSet = preparedStatement.executeQuery()) {
        while (resultSet.next()) {
            User user= new User();
            //çœç•¥è®¾ç½® User å¯¹è±¡çš„èµ‹å€¼è¯­å¥
            result.add(user);
        }
    }
    return result;
}
</code></pre><p>ShardingSphere é€šè¿‡åœ¨å‡†å¤‡é˜¶æ®µè·å–çš„è¿æ¥æ¨¡å¼ï¼Œåœ¨æ‰§è¡Œé˜¶æ®µç”Ÿæˆ<strong>å†…å­˜å½’å¹¶ç»“æœé›†</strong>æˆ–<strong>æµå¼å½’å¹¶ç»“æœé›†</strong>ï¼Œå¹¶å°†å…¶ä¼ é€’è‡³<strong>ç»“æœå½’å¹¶å¼•æ“</strong>ï¼Œä»¥è¿›è¡Œä¸‹ä¸€æ­¥å·¥ä½œã€‚</p>
<h3 id="ä»æºç è§£æåˆ°æ—¥å¸¸å¼€å‘">ä»æºç è§£æåˆ°æ—¥å¸¸å¼€å‘</h3>
<p>åŸºäº<strong>é€‚é…å™¨æ¨¡å¼</strong>å®Œæˆå¯¹ JDBC è§„èŒƒçš„é‡å†™ï¼Œæ˜¯æˆ‘ä»¬å­¦ä¹  ShardingSphere æ¡†æ¶éå¸¸é‡è¦çš„ä¸€ä¸ªåˆ‡å…¥ç‚¹ï¼ŒåŒæ ·ä¹Ÿæ˜¯æˆ‘ä»¬å°†è¿™ç§æ¨¡å¼åº”ç”¨åˆ°æ—¥å¸¸å¼€å‘å·¥ä½œä¸­çš„ä¸€ä¸ªåˆ‡å…¥ç‚¹ã€‚</p>
<p>é€‚é…å™¨æ¨¡å¼æ˜¯ä½œä¸ºä¸¤ä¸ªä¸å…¼å®¹çš„æ¥å£ä¹‹é—´çš„æ¡¥æ¢ã€‚åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šç¢°åˆ°éœ€è¦ä¸å¤–éƒ¨ç³»ç»Ÿè¿›è¡Œå¯¹æ¥å’Œé›†æˆçš„åœºæ™¯ï¼Œè¿™ä¸ªæ—¶å€™ä¸ºäº†ä¿è¯å†…éƒ¨ç³»ç»Ÿçš„åŠŸèƒ½æ¼”è¿›ï¼Œèƒ½å¤Ÿç‹¬ç«‹äºå¤–éƒ¨ç³»ç»Ÿè¿›è¡Œå‘å±•ï¼Œä¸€èˆ¬éƒ½éœ€è¦é‡‡ç”¨é€‚é…å™¨æ¨¡å¼å®Œæˆä¸¤è€…ä¹‹é—´çš„éš”ç¦»ã€‚</p>
<p>å½“æˆ‘ä»¬è®¾è®¡è¿™ç§ç³»ç»Ÿæ—¶ï¼Œå¯ä»¥å‚è€ƒ JDBC è§„èŒƒä¸­çš„æ¥å£å®šä¹‰æ–¹å¼ï¼Œä»¥åŠ ShardingSphere ä¸­åŸºäºè¿™ç§æ¥å£å®šä¹‰æ–¹å¼ï¼Œè€Œå®Œæˆé€‚é…çš„å…·ä½“åšæ³•ã€‚</p>
<h3 id="å°ç»“ä¸é¢„å‘Š">å°ç»“ä¸é¢„å‘Š</h3>
<p>è¿™æ˜¯ ShardingSphere æ‰§è¡Œå¼•æ“çš„æœ€åä¸€ä¸ªè¯¾æ—¶ï¼Œæˆ‘ä»¬å›´ç»•æ‰§è¡Œå¼•æ“çš„ä¸Šå±‚ç»„ä»¶ï¼Œç»™å‡ºäº†ä»¥â€œ Shardingâ€ä½œä¸ºå‰ç¼€çš„å„ç§ JDBC è§„èŒƒä¸­çš„æ ¸å¿ƒæ¥å£å®ç°ç±»ã€‚</p>
<p>å…¶ä¸­ ShardingStatement å’Œ ShardingPreparedStatement ç›´æ¥ä¾èµ–äºä¸Šä¸€è¯¾æ—¶ä»‹ç»çš„ StatementExecutor å’Œ PreparedStatementExecutorï¼›è€Œ ShardingConnection å’Œ ShardingDataSource åˆ™ä¸ºæˆ‘ä»¬ä½¿ç”¨æ‰§è¡Œå¼•æ“æä¾›äº†å…¥å£ã€‚</p>
<p>è¿™é‡Œç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜ï¼šShardingSphere ä¸­ï¼ŒAbstractShardingPreparedStatementAdapter çš„ç±»å±‚ç»“æ„ä¸ºä»€ä¹ˆä¼šæ¯” AbstractStatementAdapter å¤æ‚å¾ˆå¤šï¼Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸å¤§å®¶è®¨è®ºï¼Œæˆ‘å°†é€ä¸€ç‚¹è¯„è§£ç­”ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»é€šè¿‡æ‰§è¡Œå¼•æ“è·å–äº†æ¥è‡ªä¸åŒæ•°æ®æºçš„ç»“æœæ•°æ®ï¼Œå¯¹äºæŸ¥è¯¢è¯­å¥è€Œè¨€ï¼Œæˆ‘ä»¬é€šå¸¸éƒ½éœ€è¦å¯¹è¿™äº›ç»“æœæ•°æ®è¿›è¡Œå½’å¹¶æ‰èƒ½è¿”å›ç»™å®¢æˆ·ç«¯ã€‚åœ¨æ¥ä¸‹æ¥çš„å†…å®¹ä¸­ï¼Œå°±è®©æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ ShardingSphere çš„å½’å¹¶å¼•æ“ã€‚</p>

        </div>
    </article>
</div>
<div class="division-line"></div>
<div class="others">
    <div>æ ‡ç­¾ï¼šğŸ·ï¸<a class="post-tag" href="/tags/sharding/">sharding</a>&nbsp;</div>
    <div>åˆ†ç±»ï¼š ğŸ“’<a class="post-category" href="/categories/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/">ShardingSphereæ ¸å¿ƒåŸç†ç²¾è®²</a>&nbsp; </div>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/22-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E6%8A%8A%E6%8F%A1-shardingsphere-%E4%B8%AD%E7%9A%84-executor-%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B%E4%B8%8A/"><span>22 æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•æŠŠæ¡ ShardingSphere ä¸­çš„ Executor æ‰§è¡Œæ¨¡å‹ï¼Ÿï¼ˆä¸Šï¼‰</span></a>
    </div>
    <div class="next">
        
        <a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/24-%E5%BD%92%E5%B9%B6%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%95%B0%E6%8D%AE%E5%BD%92%E5%B9%B6%E7%9A%84%E7%B1%BB%E5%9E%8B%E4%BB%A5%E5%8F%8A%E7%AE%80%E5%8D%95%E5%BD%92%E5%B9%B6%E7%AD%96%E7%95%A5%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/"><span>24 å½’å¹¶å¼•æ“ï¼šå¦‚ä½•ç†è§£æ•°æ®å½’å¹¶çš„ç±»å‹ä»¥åŠç®€å•å½’å¹¶ç­–ç•¥çš„å®ç°è¿‡ç¨‹ï¼Ÿ</span></a>
    </div>
</div>

        </div>
        <div id="float">
            <ul class="float-button-bar">
    <li>
        <button class="float-button top" onclick="scrollToTop(this);">UP</button>
    </li>
    <li>
        <button class="float-button toggler" onclick="changeSkin(this);">DARK</button>
    </li>
</ul>
        </div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 2020 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    const changeSkin = () => {
        document.getElementById('page').classList.toggle('night');
    }
    const scrollToTop = () => {
        window.scrollTo(0, 0);
    }
</script>
</body>

</html>