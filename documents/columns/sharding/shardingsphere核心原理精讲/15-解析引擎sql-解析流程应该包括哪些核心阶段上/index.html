<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>15 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸Šï¼‰ | Yipsen Ye</title>
<meta name="description" content="ä½ å¥½ï¼Œæ¬¢è¿è¿›å…¥ç¬¬ 15 è¯¾æ—¶çš„å­¦ä¹ ï¼Œç»“æŸäº†å¯¹ ShardingSphere ä¸­å¾®å†…æ ¸æ¶æ„ç­‰åŸºç¡€è®¾æ–½ç›¸å…³å®ç°æœºåˆ¶çš„ä»‹ç»åï¼Œä»Šå¤©æˆ‘ä»¬å°†æ­£å¼è¿›å…¥åˆ°åˆ†ç‰‡å¼•æ“çš„å­¦ä¹ ã€‚
å¯¹äºä¸€æ¬¾åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶è€Œè¨€ï¼Œåˆ†ç‰‡æ˜¯å…¶æœ€æ ¸å¿ƒçš„åŠŸèƒ½ã€‚ä¸‹å›¾å±•ç¤ºäº†æ•´ä¸ª ShardingSphere åˆ†ç‰‡å¼•æ“çš„ç»„æˆç»“æ„ï¼Œæˆ‘ä»¬å·²ç»åœ¨[ã€Š12 | ä»åº”ç”¨åˆ°åŸç†ï¼šå¦‚ä½•é«˜æ•ˆé˜…è¯» ShardingSphere æºç ã€‹]è¿™ä¸ªè¯¾æ—¶ä¸­å¯¹åˆ†ç‰‡å¼•æ“ä¸­æ‰€åŒ…å«çš„å„ä¸ªç»„ä»¶è¿›è¡Œäº†ç®€å•ä»‹ç»ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºåˆ†ç‰‡å¼•æ“è€Œè¨€ï¼Œç¬¬ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶å°±æ˜¯ SQL è§£æå¼•æ“ã€‚
å¯¹äºå¤šæ•°å¼€å‘äººå‘˜è€Œè¨€ï¼ŒSQL è§£ææ˜¯ä¸€ä¸ªé™Œç”Ÿçš„è¯é¢˜ï¼Œä½†å¯¹äºä¸€ä¸ªåˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶æ¥è¯´å´æ˜¯ä¸€ä¸ªåŸºç¡€ç»„ä»¶ï¼Œç›®å‰ä¸»æµçš„åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶éƒ½åŒ…å«äº†å¯¹è§£æç»„ä»¶çš„å®ç°ç­–ç•¥ã€‚å¯ä»¥è¯´ï¼ŒSQL è§£æå¼•æ“æ‰€ç”Ÿæˆçš„ç»“æœè´¯ç©¿æ•´ä¸ª ShardingSphereã€‚å¦‚æœæˆ‘ä»¬æ— æ³•å¾ˆå¥½åœ°æŠŠæ¡ SQL çš„è§£æè¿‡ç¨‹ï¼Œåœ¨é˜…è¯» ShardingSphere æºç æ—¶å°±ä¼šé‡åˆ°ä¸€äº›éšœç¢ã€‚
å¦ä¸€æ–¹é¢ï¼ŒSQL çš„è§£æè¿‡ç¨‹æœ¬èº«ä¹Ÿå¾ˆå¤æ‚ï¼Œä½ åœ¨æ‹¿åˆ° ShardingSphere æ¡†æ¶çš„æºä»£ç æ—¶ï¼Œå¯èƒ½é¦–å…ˆä¼šé—®è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šSQL çš„è§£æè¿‡ç¨‹åº”è¯¥åŒ…å«å“ªäº›æ ¸å¿ƒé˜¶æ®µå‘¢ï¼Ÿæ¥ä¸‹æ¥æˆ‘å°†å¸¦ä½ æ·±åº¦å‰–æè¿™ä¸ªè¯é¢˜ã€‚
ä» DataSource åˆ° SQL è§£æå¼•æ“å…¥å£ åœ¨å¯¹åˆ†ç‰‡å¼•æ“çš„æ•´ä½“ä»‹ç»ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¦æƒ³å®Œæˆåˆ†ç‰‡æ“ä½œï¼Œé¦–å…ˆéœ€è¦å¼•å…¥ SQL è§£æå¼•æ“ã€‚å¯¹äºåˆšæ¥è§¦ ShardingSphere æºç çš„åŒå­¦è€Œè¨€ï¼Œæƒ³è¦æ‰¾åˆ° SQL è§£æå¼•æ“çš„å…¥å£æœ‰ä¸€å®šéš¾åº¦ã€‚è¿™é‡Œå¼•ç”¨åœ¨[ã€Š04 | åº”ç”¨é›†æˆï¼šåœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ä½¿ç”¨ ShardingSphere çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿã€‹]è¿™ä¸ªè¯¾æ—¶ä¸­ä»‹ç»çš„ä»£ç ç¤ºä¾‹ï¼Œæ¥åˆ†æ SQL è§£æå¼•æ“çš„å…¥å£ã€‚
æˆ‘ä»¬å›é¡¾å¦‚ä¸‹æ‰€ç¤ºçš„ä»£ç ç‰‡æ®µï¼Œè¿™äº›ä»£ç ç‰‡æ®µåŸºäº Java è¯­è¨€æä¾›äº†æ•°æ®åˆ†ç‰‡çš„å®ç°æ–¹å¼ï¼š
//åˆ›å»ºåˆ†ç‰‡è§„åˆ™é…ç½®ç±» ShardingRuleConfiguration shardingRuleConfig = new ShardingRuleConfiguration(); //åˆ›å»ºåˆ†è¡¨è§„åˆ™é…ç½®ç±» TableRuleConfiguration tableRuleConfig = new TableRuleConfiguration(&amp;quot;user&amp;quot;, &amp;quot;ds${0..1}.user${0..1}&amp;quot;); //åˆ›å»ºåˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆé…ç½®ç±» Properties properties = new Properties(); result.setProperty(&amp;quot;worker.id&amp;quot;, &amp;quot;33&amp;quot;); KeyGeneratorConfiguration keyGeneratorConfig = new KeyGeneratorConfiguration(&amp;quot;SNOWFLAKE&amp;quot;, &amp;quot;id&amp;quot;, properties);result.">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/shardingsphere%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86%e7%b2%be%e8%ae%b2/">ShardingSphereæ ¸å¿ƒåŸç†ç²¾è®²</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/00-%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E5%AD%A6%E4%B9%A0%E4%B8%80%E6%AC%BE%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E5%BC%80%E6%BA%90%E6%A1%86%E6%9E%B6/">00 å¦‚ä½•æ­£ç¡®å­¦ä¹ ä¸€æ¬¾åˆ†åº“åˆ†è¡¨å¼€æºæ¡†æ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/01-%E4%BB%8E%E7%90%86%E8%AE%BA%E5%88%B0%E5%AE%9E%E8%B7%B5%E5%A6%82%E4%BD%95%E8%AE%A9%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E7%9C%9F%E6%AD%A3%E8%90%BD%E5%9C%B0/">01 ä»ç†è®ºåˆ°å®è·µï¼šå¦‚ä½•è®©åˆ†åº“åˆ†è¡¨çœŸæ­£è½åœ°ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/02-%E9%A1%B6%E7%BA%A7%E9%A1%B9%E7%9B%AEshardingsphere-%E6%98%AF%E4%B8%80%E6%AC%BE%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84-apache-%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6/">02 é¡¶çº§é¡¹ç›®ï¼šShardingSphere æ˜¯ä¸€æ¬¾ä»€ä¹ˆæ ·çš„ Apache å¼€æºè½¯ä»¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/03-%E8%A7%84%E8%8C%83%E5%85%BC%E5%AE%B9jdbc-%E8%A7%84%E8%8C%83%E4%B8%8E-shardingsphere-%E6%98%AF%E4%BB%80%E4%B9%88%E5%85%B3%E7%B3%BB/">03 è§„èŒƒå…¼å®¹ï¼šJDBC è§„èŒƒä¸ ShardingSphere æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/04-%E5%BA%94%E7%94%A8%E9%9B%86%E6%88%90%E5%9C%A8%E4%B8%9A%E5%8A%A1%E7%B3%BB%E7%BB%9F%E4%B8%AD%E4%BD%BF%E7%94%A8-shardingsphere-%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B/">04 åº”ç”¨é›†æˆï¼šåœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ä½¿ç”¨ ShardingSphere çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/05-%E9%85%8D%E7%BD%AE%E9%A9%B1%E5%8A%A8shardingsphere-%E4%B8%AD%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BD%93%E7%B3%BB%E6%98%AF%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E7%9A%84/">05 é…ç½®é©±åŠ¨ï¼šShardingSphere ä¸­çš„é…ç½®ä½“ç³»æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/09-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E4%B8%8E%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1/">09 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ä½¿ç”¨å¼ºä¸€è‡´æ€§äº‹åŠ¡ä¸æŸ”æ€§äº‹åŠ¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/10-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E5%A6%82%E4%BD%95%E7%A1%AE%E4%BF%9D%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%89%E5%85%A8%E8%AE%BF%E9%97%AE/">10 æ•°æ®è„±æ•ï¼šå¦‚ä½•ç¡®ä¿æ•æ„Ÿæ•°æ®çš„å®‰å…¨è®¿é—®ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/11-%E7%BC%96%E6%8E%92%E6%B2%BB%E7%90%86%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E5%8A%A8%E6%80%81%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/">11 ç¼–æ’æ²»ç†ï¼šå¦‚ä½•å®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„åŠ¨æ€é…ç½®ç®¡ç†ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/12-%E4%BB%8E%E5%BA%94%E7%94%A8%E5%88%B0%E5%8E%9F%E7%90%86%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E9%98%85%E8%AF%BB-shardingsphere-%E6%BA%90%E7%A0%81/">12 ä»åº”ç”¨åˆ°åŸç†ï¼šå¦‚ä½•é«˜æ•ˆé˜…è¯» ShardingSphere æºç ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/13-%E5%BE%AE%E5%86%85%E6%A0%B8%E6%9E%B6%E6%9E%84shardingsphere-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%89%A9%E5%B1%95%E6%80%A7/">13 å¾®å†…æ ¸æ¶æ„ï¼šShardingSphere å¦‚ä½•å®ç°ç³»ç»Ÿçš„æ‰©å±•æ€§ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/14-%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AEshardingsphere-%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AE%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/">14 åˆ†å¸ƒå¼ä¸»é”®ï¼šShardingSphere ä¸­æœ‰å“ªäº›åˆ†å¸ƒå¼ä¸»é”®å®ç°æ–¹å¼ï¼Ÿ</a></li>
                
                
                
                    <li>15 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸Šï¼‰</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/16-%E8%A7%A3%E6%9E%90%E5%BC%95%E6%93%8Esql-%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%8C%85%E6%8B%AC%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E9%98%B6%E6%AE%B5%E4%B8%8B/">16 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/17-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E5%88%86%E7%89%87%E8%B7%AF%E7%94%B1%E6%A0%B8%E5%BF%83%E7%B1%BB-shardingrouter-%E7%9A%84%E8%BF%90%E4%BD%9C%E6%9C%BA%E5%88%B6/">17 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•ç†è§£åˆ†ç‰‡è·¯ç”±æ ¸å¿ƒç±» ShardingRouter çš„è¿ä½œæœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/18-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E7%9A%84%E5%88%86%E7%89%87%E8%B7%AF%E7%94%B1%E5%92%8C%E5%B9%BF%E6%92%AD%E8%B7%AF%E7%94%B1/">18 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•å®ç°æ•°æ®è®¿é—®çš„åˆ†ç‰‡è·¯ç”±å’Œå¹¿æ’­è·¯ç”±ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/19-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E5%9C%A8%E8%B7%AF%E7%94%B1%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%9B%86%E6%88%90%E5%A4%9A%E7%A7%8D%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5%E5%92%8C%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95/">19 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•åœ¨è·¯ç”±è¿‡ç¨‹ä¸­é›†æˆå¤šç§è·¯ç”±ç­–ç•¥å’Œè·¯ç”±ç®—æ³•ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/20-%E6%94%B9%E5%86%99%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84-sql-%E6%94%B9%E5%86%99%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6/">20 æ”¹å†™å¼•æ“ï¼šå¦‚ä½•ç†è§£è£…é¥°å™¨æ¨¡å¼ä¸‹çš„ SQL æ”¹å†™å®ç°æœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/21-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%88%86%E7%89%87%E7%8E%AF%E5%A2%83%E4%B8%8B-sql-%E6%89%A7%E8%A1%8C%E7%9A%84%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E6%8A%BD%E8%B1%A1/">21 æ‰§è¡Œå¼•æ“ï¼šåˆ†ç‰‡ç¯å¢ƒä¸‹ SQL æ‰§è¡Œçš„æ•´ä½“æµç¨‹åº”è¯¥å¦‚ä½•è¿›è¡ŒæŠ½è±¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/22-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E6%8A%8A%E6%8F%A1-shardingsphere-%E4%B8%AD%E7%9A%84-executor-%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B%E4%B8%8A/">22 æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•æŠŠæ¡ ShardingSphere ä¸­çš„ Executor æ‰§è¡Œæ¨¡å‹ï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/23-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E6%8A%8A%E6%8F%A1-shardingsphere-%E4%B8%AD%E7%9A%84-executor-%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B%E4%B8%8B/">23 æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•æŠŠæ¡ ShardingSphere ä¸­çš„ Executor æ‰§è¡Œæ¨¡å‹ï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/24-%E5%BD%92%E5%B9%B6%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%95%B0%E6%8D%AE%E5%BD%92%E5%B9%B6%E7%9A%84%E7%B1%BB%E5%9E%8B%E4%BB%A5%E5%8F%8A%E7%AE%80%E5%8D%95%E5%BD%92%E5%B9%B6%E7%AD%96%E7%95%A5%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/">24 å½’å¹¶å¼•æ“ï¼šå¦‚ä½•ç†è§£æ•°æ®å½’å¹¶çš„ç±»å‹ä»¥åŠç®€å•å½’å¹¶ç­–ç•¥çš„å®ç°è¿‡ç¨‹ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/25-%E5%BD%92%E5%B9%B6%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%B5%81%E5%BC%8F%E5%BD%92%E5%B9%B6%E5%92%8C%E5%86%85%E5%AD%98%E5%BD%92%E5%B9%B6%E5%9C%A8%E5%A4%8D%E6%9D%82%E5%BD%92%E5%B9%B6%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84%E5%BA%94%E7%94%A8%E6%96%B9%E5%BC%8F/">25 å½’å¹¶å¼•æ“ï¼šå¦‚ä½•ç†è§£æµå¼å½’å¹¶å’Œå†…å­˜å½’å¹¶åœ¨å¤æ‚å½’å¹¶åœºæ™¯ä¸‹çš„åº”ç”¨æ–¹å¼ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/26-%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%99%AE%E9%80%9A%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84%E5%92%8C%E5%88%86%E7%89%87%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84%E5%88%86%E5%88%AB%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%9A%84/">26 è¯»å†™åˆ†ç¦»ï¼šæ™®é€šä¸»ä»æ¶æ„å’Œåˆ†ç‰‡ä¸»ä»æ¶æ„åˆ†åˆ«æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/27-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3-shardingsphere-%E4%B8%AD%E5%AF%B9%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%8A%BD%E8%B1%A1%E8%BF%87%E7%A8%8B/">27 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ç†è§£ ShardingSphere ä¸­å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„æŠ½è±¡è¿‡ç¨‹ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/28-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1shardingsphere-%E4%B8%AD%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E5%92%8C%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1%E6%94%AF%E6%8C%81%E4%B8%8A/">28 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šShardingSphere ä¸­å¦‚ä½•é›†æˆå¼ºä¸€è‡´æ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡æ”¯æŒï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/29-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1shardingsphere-%E4%B8%AD%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E5%92%8C%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1%E6%94%AF%E6%8C%81%E4%B8%8B/">29 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šShardingSphere ä¸­å¦‚ä½•é›†æˆå¼ºä¸€è‡´æ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡æ”¯æŒï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/30-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E6%94%B9%E5%86%99%E5%BC%95%E6%93%8E%E5%AE%9E%E7%8E%B0%E4%BD%8E%E4%BE%B5%E5%85%A5%E6%80%A7%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E6%96%B9%E6%A1%88/">30 æ•°æ®è„±æ•ï¼šå¦‚ä½•åŸºäºæ”¹å†™å¼•æ“å®ç°ä½ä¾µå…¥æ€§æ•°æ®è„±æ•æ–¹æ¡ˆï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/31-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%AE%9E%E7%8E%B0%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E7%9A%84%E5%8A%A8%E6%80%81%E5%8C%96%E7%AE%A1%E7%90%86/">31 é…ç½®ä¸­å¿ƒï¼šå¦‚ä½•åŸºäºé…ç½®ä¸­å¿ƒå®ç°é…ç½®ä¿¡æ¯çš„åŠ¨æ€åŒ–ç®¡ç†ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/32-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BF%E9%97%AE%E7%86%94%E6%96%AD%E6%9C%BA%E5%88%B6/">32 æ³¨å†Œä¸­å¿ƒï¼šå¦‚ä½•åŸºäºæ³¨å†Œä¸­å¿ƒå®ç°æ•°æ®åº“è®¿é—®ç†”æ–­æœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/33-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E-hook-%E6%9C%BA%E5%88%B6%E4%BB%A5%E5%8F%8A-opentracing-%E5%8D%8F%E8%AE%AE%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/">33 é“¾è·¯è·Ÿè¸ªï¼šå¦‚ä½•åŸºäº Hook æœºåˆ¶ä»¥åŠ OpenTracing åè®®å®ç°æ•°æ®è®¿é—®é“¾è·¯è·Ÿè¸ªï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/35-%E7%BB%93%E8%AF%ADshardingsphere-%E6%80%BB%E7%BB%93%E5%8F%8A%E5%B1%95%E6%9C%9B/">35 ç»“è¯­ï¼šShardingSphere æ€»ç»“åŠå±•æœ›</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">15 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸Šï¼‰</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2021-12-22 01:55:54</span>ğŸ·ï¸&nbsp;<a class="post-tag" href="/tags/sharding/">sharding</a></div><div class="post-category">
                
                ğŸ“š&nbsp;<a href="/categories/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/">ShardingSphereæ ¸å¿ƒåŸç†ç²¾è®²</a>
                
            </div></div>
        <div class="post-content">
            <p>ä½ å¥½ï¼Œæ¬¢è¿è¿›å…¥ç¬¬ 15 è¯¾æ—¶çš„å­¦ä¹ ï¼Œç»“æŸäº†å¯¹ ShardingSphere ä¸­å¾®å†…æ ¸æ¶æ„ç­‰åŸºç¡€è®¾æ–½ç›¸å…³å®ç°æœºåˆ¶çš„ä»‹ç»åï¼Œä»Šå¤©æˆ‘ä»¬å°†æ­£å¼è¿›å…¥åˆ°åˆ†ç‰‡å¼•æ“çš„å­¦ä¹ ã€‚</p>
<p>å¯¹äºä¸€æ¬¾åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶è€Œè¨€ï¼Œåˆ†ç‰‡æ˜¯å…¶æœ€æ ¸å¿ƒçš„åŠŸèƒ½ã€‚ä¸‹å›¾å±•ç¤ºäº†æ•´ä¸ª ShardingSphere åˆ†ç‰‡å¼•æ“çš„ç»„æˆç»“æ„ï¼Œæˆ‘ä»¬å·²ç»åœ¨[ã€Š12 | ä»åº”ç”¨åˆ°åŸç†ï¼šå¦‚ä½•é«˜æ•ˆé˜…è¯» ShardingSphere æºç ã€‹]è¿™ä¸ªè¯¾æ—¶ä¸­å¯¹åˆ†ç‰‡å¼•æ“ä¸­æ‰€åŒ…å«çš„å„ä¸ªç»„ä»¶è¿›è¡Œäº†ç®€å•ä»‹ç»ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºåˆ†ç‰‡å¼•æ“è€Œè¨€ï¼Œç¬¬ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶å°±æ˜¯ SQL è§£æå¼•æ“ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F8nypyARZV3AACJf1UYtf4213.png" alt="Drawing 0.png"></p>
<p>å¯¹äºå¤šæ•°å¼€å‘äººå‘˜è€Œè¨€ï¼ŒSQL è§£ææ˜¯ä¸€ä¸ªé™Œç”Ÿçš„è¯é¢˜ï¼Œä½†å¯¹äºä¸€ä¸ªåˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶æ¥è¯´å´æ˜¯ä¸€ä¸ªåŸºç¡€ç»„ä»¶ï¼Œç›®å‰ä¸»æµçš„åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶éƒ½åŒ…å«äº†å¯¹è§£æç»„ä»¶çš„å®ç°ç­–ç•¥ã€‚å¯ä»¥è¯´ï¼ŒSQL è§£æå¼•æ“æ‰€ç”Ÿæˆçš„ç»“æœè´¯ç©¿æ•´ä¸ª ShardingSphereã€‚å¦‚æœæˆ‘ä»¬æ— æ³•å¾ˆå¥½åœ°æŠŠæ¡ SQL çš„è§£æè¿‡ç¨‹ï¼Œåœ¨é˜…è¯» ShardingSphere æºç æ—¶å°±ä¼šé‡åˆ°ä¸€äº›éšœç¢ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼ŒSQL çš„è§£æè¿‡ç¨‹æœ¬èº«ä¹Ÿå¾ˆå¤æ‚ï¼Œä½ åœ¨æ‹¿åˆ° ShardingSphere æ¡†æ¶çš„æºä»£ç æ—¶ï¼Œå¯èƒ½é¦–å…ˆä¼šé—®è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šSQL çš„è§£æè¿‡ç¨‹åº”è¯¥åŒ…å«å“ªäº›æ ¸å¿ƒé˜¶æ®µå‘¢ï¼Ÿæ¥ä¸‹æ¥æˆ‘å°†å¸¦ä½ æ·±åº¦å‰–æè¿™ä¸ªè¯é¢˜ã€‚</p>
<h3 id="ä»-datasource-åˆ°-sql-è§£æå¼•æ“å…¥å£">ä» DataSource åˆ° SQL è§£æå¼•æ“å…¥å£</h3>
<p>åœ¨å¯¹åˆ†ç‰‡å¼•æ“çš„æ•´ä½“ä»‹ç»ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¦æƒ³å®Œæˆåˆ†ç‰‡æ“ä½œï¼Œé¦–å…ˆéœ€è¦å¼•å…¥ SQL è§£æå¼•æ“ã€‚å¯¹äºåˆšæ¥è§¦ ShardingSphere æºç çš„åŒå­¦è€Œè¨€ï¼Œæƒ³è¦æ‰¾åˆ° SQL è§£æå¼•æ“çš„å…¥å£æœ‰ä¸€å®šéš¾åº¦ã€‚è¿™é‡Œå¼•ç”¨åœ¨[ã€Š04 | åº”ç”¨é›†æˆï¼šåœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ä½¿ç”¨ ShardingSphere çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿã€‹]è¿™ä¸ªè¯¾æ—¶ä¸­ä»‹ç»çš„ä»£ç ç¤ºä¾‹ï¼Œæ¥åˆ†æ SQL è§£æå¼•æ“çš„å…¥å£ã€‚</p>
<p>æˆ‘ä»¬å›é¡¾å¦‚ä¸‹æ‰€ç¤ºçš„ä»£ç ç‰‡æ®µï¼Œè¿™äº›ä»£ç ç‰‡æ®µåŸºäº Java è¯­è¨€æä¾›äº†æ•°æ®åˆ†ç‰‡çš„å®ç°æ–¹å¼ï¼š</p>
<pre tabindex="0"><code>//åˆ›å»ºåˆ†ç‰‡è§„åˆ™é…ç½®ç±» 
ShardingRuleConfiguration shardingRuleConfig = new ShardingRuleConfiguration(); 

//åˆ›å»ºåˆ†è¡¨è§„åˆ™é…ç½®ç±» 
TableRuleConfiguration tableRuleConfig = new TableRuleConfiguration(&quot;user&quot;, &quot;ds${0..1}.user${0..1}&quot;); 

//åˆ›å»ºåˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆé…ç½®ç±» 
Properties properties = new Properties(); 
result.setProperty(&quot;worker.id&quot;, &quot;33&quot;); 
KeyGeneratorConfiguration keyGeneratorConfig = new KeyGeneratorConfiguration(&quot;SNOWFLAKE&quot;, &quot;id&quot;, properties);
result.setKeyGeneratorConfig(keyGeneratorConfig);
shardingRuleConfig.getTableRuleConfigs().add(tableRuleConfig); 

//æ ¹æ®å¹´é¾„åˆ†åº“ï¼Œä¸€å…±åˆ†ä¸º2ä¸ªåº“ 
shardingRuleConfig.setDefaultDatabaseShardingStrategyConfig(new InlineShardingStrategyConfiguration(&quot;sex&quot;, &quot;ds${sex % 2}&quot;)); 

//æ ¹æ®ç”¨æˆ·idåˆ†è¡¨ï¼Œä¸€å…±åˆ†ä¸º2å¼ è¡¨ 
shardingRuleConfig.setDefaultTableShardingStrategyConfig(new StandardShardingStrategyConfiguration(&quot;id&quot;, &quot;user${id % 2}&quot;)); 

//é€šè¿‡å·¥å‚ç±»åˆ›å»ºå…·ä½“çš„DataSource 
return ShardingDataSourceFactory.createDataSource(createDataSourceMap(), shardingRuleConfig, new Properties());
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šè¿°ä»£ç æ„å»ºäº†å‡ ä¸ªæ•°æ®æºï¼ŒåŠ ä¸Šåˆ†åº“ã€åˆ†è¡¨ç­–ç•¥ä»¥åŠåˆ†ç‰‡è§„åˆ™ï¼Œç„¶åé€šè¿‡ ShardingDataSourceFactory è·å–äº†ç›®å‰æ•°æ®æº DataSource ã€‚æ˜¾ç„¶ï¼Œå¯¹äºåº”ç”¨å¼€å‘è€Œè¨€ï¼Œ<strong>DataSource å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨ ShardingSphere æ¡†æ¶çš„å…¥å£</strong>ã€‚äº‹å®ä¸Šï¼Œå¯¹äº ShardingSphere å†…éƒ¨çš„è¿è¡Œæœºåˆ¶è€Œè¨€ï¼ŒDataSource åŒæ ·æ˜¯å¼•å¯¼æˆ‘ä»¬è¿›å…¥åˆ†ç‰‡å¼•æ“çš„å…¥å£ã€‚å›´ç»• DataSourceï¼Œé€šè¿‡è·Ÿè¸ªä»£ç çš„è°ƒç”¨é“¾è·¯ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„ç±»å±‚ç»“æ„å›¾ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F8nyriAPY8tAAB8wwhtMU4809.png" alt="Drawing 2.png"></p>
<p>ä¸Šå›¾å·²ç»å¼•å‡ºäº† ShardingSphere å†…æ ¸ä¸­çš„å¾ˆå¤šæ ¸å¿ƒå¯¹è±¡ï¼Œä½†ä»Šå¤©æˆ‘ä»¬åªå…³æ³¨ä½äºæ•´ä¸ªé“¾è·¯çš„æœ€åº•å±‚å¯¹è±¡ï¼Œå³å›¾ä¸­çš„ SQLParseEngineã€‚ä¸€æ–¹é¢ï¼Œåœ¨ DataSource çš„åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œæœ€ç»ˆåˆå§‹åŒ–äº† SQLParseEngineï¼›å¦ä¸€æ–¹é¢ï¼Œè´Ÿè´£æ‰§è¡Œè·¯ç”±åŠŸèƒ½çš„ ShardingRouter ä¹Ÿä¾èµ–äº SQLParseEngineã€‚è¿™ä¸ª SQLParseEngine å°±æ˜¯ ShardingSphere ä¸­è´Ÿè´£æ•´ä¸ª SQL è§£æè¿‡ç¨‹çš„å…¥å£ã€‚</p>
<h3 id="ä»-sql-è§£æå¼•æ“åˆ°-sql-è§£æå†…æ ¸">ä» SQL è§£æå¼•æ“åˆ° SQL è§£æå†…æ ¸</h3>
<p>åœ¨ ShardingSphere ä¸­ï¼Œå­˜åœ¨ä¸€æ‰¹ä»¥â€œEngineâ€ç»“å°¾çš„å¼•æ“ç±»ã€‚ä»æ¶æ„æ€æƒ³ä¸Šçœ‹ï¼Œè¿™äº›ç±»åœ¨è®¾è®¡å’Œå®ç°ä¸Šæ™®éé‡‡ç”¨äº†å¤–è§‚æ¨¡å¼ã€‚å¤–è§‚ï¼ˆFacadeï¼‰æ¨¡å¼çš„æ„å›¾å¯ä»¥æè¿°ä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªä¸€è‡´çš„ç•Œé¢ã€‚å¤–è§‚æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä½¿å¾—è¿™ä¸€å­ç³»ç»Ÿæ›´åŠ å®¹æ˜“ä½¿ç”¨ã€‚è¯¥æ¨¡å¼çš„ç¤ºæ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F8nysKAKGdhAABINS6qFpI839.png" alt="Drawing 4.png"></p>
<p>ä»ä½œç”¨ä¸Šè®²ï¼Œå¤–è§‚æ¨¡å¼èƒ½å¤Ÿèµ·åˆ°<strong>å®¢æˆ·ç«¯ä¸åç«¯æœåŠ¡ä¹‹é—´çš„éš”ç¦»ä½œç”¨</strong>ï¼Œéšç€ä¸šåŠ¡éœ€æ±‚çš„å˜åŒ–å’Œæ—¶é—´çš„æ¼”è¿›ï¼Œå¤–è§‚èƒŒåå„ä¸ªå­ç³»ç»Ÿçš„åˆ’åˆ†å’Œå®ç°å¯èƒ½éœ€è¦è¿›è¡Œç›¸åº”çš„è°ƒæ•´å’Œå‡çº§ï¼Œè¿™ç§è°ƒæ•´å’Œå‡çº§éœ€è¦åšåˆ°<strong>å¯¹å®¢æˆ·ç«¯é€æ˜</strong>ã€‚åœ¨è®¾è®¡è¯¸å¦‚ ShardingSphere è¿™æ ·çš„ä¸­é—´ä»¶æ¡†æ¶æ—¶ï¼Œè¿™ç§éš”ç¦»æ€§å°¤ä¸ºé‡è¦ã€‚</p>
<p>å¯¹äº SQL è§£æå¼•æ“è€Œè¨€ï¼Œæƒ…å†µåŒæ ·ç±»ä¼¼ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼ŒSQLParseEngine æœ¬èº«å¹¶ä¸æä¾›å¤–è§‚ä½œç”¨ï¼Œè€Œæ˜¯æŠŠè¿™éƒ¨åˆ†åŠŸèƒ½å§”æ‰˜ç»™äº†å¦ä¸€ä¸ªæ ¸å¿ƒç±» SQLParseKernelã€‚ä»å‘½åä¸Šçœ‹ï¼Œè¿™ä¸ªç±»æ‰æ˜¯ SQL è§£æçš„å†…æ ¸ç±»ï¼Œä¹Ÿæ˜¯æ‰€è°“çš„å¤–è§‚ç±»ã€‚SQLParseKernel å±è”½äº†åç«¯æœåŠ¡ä¸­å¤æ‚çš„ SQL æŠ½è±¡è¯­æ³•æ ‘å¯¹è±¡ SQLASTã€SQL ç‰‡æ®µå¯¹è±¡ SQLSegment ï¼Œä»¥åŠæœ€ç»ˆçš„ SQL è¯­å¥ SQLStatement å¯¹è±¡çš„åˆ›å»ºå’Œç®¡ç†è¿‡ç¨‹ã€‚ä¸Šè¿°è¿™äº›ç±»ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl8nytiAcb6GAABVel2mPvE115.png" alt="Drawing 6.png"></p>
<h4 id="1sqlparseengine">1.SQLParseEngine</h4>
<p>ä»å‰é¢çš„ç±»å±‚ç»“æ„å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒAbstractRuntimeContext æ˜¯ SQLParseEngine çš„æ„å»ºå…¥å£ã€‚é¡¾åæ€ä¹‰ï¼ŒRuntimeContext åœ¨ ShardingSphere ä¸­å……å½“ä¸€ç§è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ï¼Œä¿å­˜ç€ä¸è¿è¡Œæ—¶ç¯å¢ƒä¸‹ç›¸å…³çš„åˆ†ç‰‡è§„åˆ™ã€åˆ†ç‰‡å±æ€§ã€æ•°æ®åº“ç±»å‹ã€æ‰§è¡Œå¼•æ“ä»¥åŠ SQL è§£æå¼•æ“ã€‚ä½œä¸º RuntimeContext æ¥å£çš„å®ç°ç±»ï¼ŒAbstractRuntimeContex åœ¨å…¶æ„é€ å‡½æ•°ä¸­å®Œæˆäº†å¯¹ SQLParseEngine çš„æ„å»ºï¼Œæ„å»ºè¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>protected AbstractRuntimeContext(final T rule, final Properties props, final DatabaseType databaseType) { 
       â€¦ 
       parseEngine = SQLParseEngineFactory.getSQLParseEngine(DatabaseTypes.getTrunkDatabaseTypeName(databaseType)); 
       â€¦ 
}
</code></pre><p>æ˜¾ç„¶ï¼Œè¿™é‡Œé€šè¿‡å·¥å‚ç±» SQLParseEngineFactory å®Œæˆäº† SQLParseEngine çš„åˆ›å»ºè¿‡ç¨‹ã€‚å·¥å‚ç±» SQLParseEngineFactory çš„å®ç°å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>public final class SQLParseEngineFactory { 

    private static final Map&lt;String, SQLParseEngine&gt; ENGINES = new ConcurrentHashMap&lt;&gt;(); 

public static SQLParseEngine getSQLParseEngine(final String databaseTypeName) {
        if (ENGINES.containsKey(databaseTypeName)) { 
            return ENGINES.get(databaseTypeName); 
        } 
        synchronized (ENGINES) { 
           //å¦‚æœç¼“å­˜ä¸­åŒ…å«äº†æŒ‡å®šæ•°æ®åº“ç±»å‹å¯¹åº”çš„SQLParseEngineï¼Œåˆ™ç›´æ¥è¿”å› 
            if (ENGINES.containsKey(databaseTypeName)) { 
                return ENGINES.get(databaseTypeName); 
            } 
           //åˆ›å»ºSQLParseEngine 
            SQLParseEngine result = new SQLParseEngine(databaseTypeName); 
           //å°†æ–°åˆ›å»ºçš„SQLParseEngineæ”¾å…¥ç¼“å­˜ä¸­ 
            ENGINES.put(databaseTypeName, result); 
            return result; 
        } 
    } 
}
</code></pre><p>ä»ä¸Šè¿°ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡ŒåŸºäº ConcurrentHashMap å¯¹è±¡åšäº†ä¸€å±‚åŸºäºå†…å­˜çš„ç¼“å­˜å¤„ç†ï¼ŒSQLParseEngineFactory çš„å®ç°æ–¹å¼åœ¨ ShardingSphere ä¸­å…·æœ‰ä»£è¡¨æ€§ã€‚ä¸ºäº†æé«˜è®¿é—®æ€§èƒ½ï¼ŒShardingSphere å¤§é‡ä½¿ç”¨è¿™ç§æ–¹å¼æ¥æ„å»ºåŸºäºå†…å®¹çš„ç¼“å­˜æœºåˆ¶ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ SQLParseEngine ç±»æœ¬èº«ï¼Œè¯¥ç±»çš„å®Œæ•´ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public final class SQLParseEngine { 

    private final String databaseTypeName; 

    private final SQLParseResultCache cache = new SQLParseResultCache(); 

public SQLStatement parse(final String sql, final boolean useCache) { 
    //åŸºäºHookæœºåˆ¶è¿›è¡Œç›‘æ§å’Œè·Ÿè¸ª 
        ParsingHook parsingHook = new SPIParsingHook(); 
        parsingHook.start(sql); 
        try { 
           //å®ŒæˆSQLçš„è§£æï¼Œå¹¶è¿”å›ä¸€ä¸ªSQLStatementå¯¹è±¡ 
            SQLStatement result = parse0(sql, useCache); 
            parsingHook.finishSuccess(result); 
            return result; 
        } catch (final Exception ex) { 
            parsingHook.finishFailure(ex); 
            throw ex; 
        } 
    } 

private SQLStatement parse0(final String sql, final boolean useCache) { 
    //å¦‚æœä½¿ç”¨ç¼“å­˜ï¼Œå…ˆå°è¯•ä»ç¼“å­˜ä¸­è·å–SQLStatement 
        if (useCache) { 
            Optional&lt;SQLStatement&gt; cachedSQLStatement = cache.getSQLStatement(sql); 
            if (cachedSQLStatement.isPresent()) { 
                return cachedSQLStatement.get(); 
            } 
        } 
        //å§”æ‰˜SQLParseKernelåˆ›å»ºSQLStatement 
SQLStatement result = new SQLParseKernel(ParseRuleRegistry.getInstance(), databaseTypeName, sql).parse(); 
        if (useCache) { 
            cache.put(sql, result); 
        } 
        return result; 
    } 
}
</code></pre><p>å…³äº SQLParseEngine æœ‰å‡ ç‚¹å€¼å¾—æ³¨æ„ï¼š</p>
<ul>
<li>é¦–å…ˆï¼Œè¿™é‡Œä½¿ç”¨äº† ParsingHook ä½œä¸ºç³»ç»Ÿè¿è¡Œæ—¶çš„ Hook ç®¡ç†ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ä»£ç é’©å­ã€‚ShardingSphere æä¾›äº†ä¸€ç³»åˆ—çš„ ParsingHook å®ç°ï¼Œåç»­æˆ‘ä»¬åœ¨è®¨è®ºåˆ° ShardingSphere çš„é“¾è·¯è·Ÿè¸ªæ—¶ä¼šå¯¹ Hook æœºåˆ¶è¿›ä¸€æ­¥å±•å¼€ã€‚</li>
<li>å…¶æ¬¡ï¼Œæˆ‘ä»¬å‘ç°ç”¨äºè§£æ SQL çš„ parse æ–¹æ³•è¿”å›äº†ä¸€ä¸ª SQLStatement å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ª SQLStatement å°±æ˜¯æ•´ä¸ª SQL è§£æå¼•æ“çš„æœ€ç»ˆè¾“å‡ºå¯¹è±¡ã€‚è¿™é‡ŒåŒæ ·åŸºäº Google Guava æ¡†æ¶ä¸­çš„ Cache ç±»æ„å»ºäº†ä¸€ä¸ª SQLParseResultCacheï¼Œå¯¹è§£æå‡ºæ¥çš„ SQLStatement è¿›è¡Œç¼“å­˜å¤„ç†ã€‚</li>
</ul>
<p>æœ€åï¼Œæˆ‘ä»¬å‘ç° SQLParseEngine æŠŠçœŸæ­£çš„è§£æå·¥ä½œå§”æ‰˜ç»™äº† SQLParseKernelã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥çœ‹è¿™ä¸ª SQLParseKernel ç±»ã€‚</p>
<h4 id="2sqlparsekernel">2.SQLParseKernel</h4>
<p>åœ¨ SQLParseKernel ç±»ä¸­ï¼Œå‘ç°äº†å¦‚ä¸‹æ‰€ç¤ºçš„ä¸‰ä¸ª Engine ç±»å®šä¹‰ï¼ŒåŒ…æ‹¬ SQL è§£æå™¨å¼•æ“ SQLParserEngineï¼ˆ<strong>è¯·æ³¨æ„è¯¥ç±»åä¸ SQLParseEngine ç±»åçš„åŒºåˆ«</strong>ï¼‰ã€SQLSegment æå–å™¨å¼•æ“ SQLSegmentsExtractor ä»¥åŠ SQLStatement å¡«å……å™¨å¼•æ“ SQLStatementFillerã€‚</p>
<pre tabindex="0"><code>//SQLè§£æå™¨å¼•æ“ 
private final SQLParserEngine parserEngine; 
//SQLSegmentæå–å™¨å¼•æ“ 
private final SQLSegmentsExtractorEngine extractorEngine; 
//SQLStatementå¡«å……å™¨å¼•æ“ 
private final SQLStatementFillerEngine fillerEngine;
</code></pre><p>ä½œä¸ºå¤–è§‚ç±»çš„ SQLParseKernel æä¾›äº†å¦‚ä¸‹æ‰€ç¤ºçš„ parse æ–¹æ³•ï¼Œæ¥å®Œæˆ SQL è§£æçš„æ•´ä¸ªè¿‡ç¨‹ï¼Œè¯¥æ–¹æ³•ä¸­åˆ†åˆ«ç”¨åˆ°äº†ä¸Šè¿°ä¸‰ä¸ªå¼•æ“ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public SQLStatement parse() { 

   //åˆ©ç”¨ANTLR4 è§£æSQLçš„æŠ½è±¡è¯­æ³•æ ‘ 
   SQLAST ast = parserEngine.parse(); 

   //æå–ASTä¸­çš„Tokenï¼Œå°è£…æˆå¯¹åº”çš„TableSegmentã€IndexSegment ç­‰å„ç§Segment 
   Collection&lt;SQLSegment&gt; sqlSegments = extractorEngine.extract(ast); 
   Map&lt;ParserRuleContext, Integer&gt; parameterMarkerIndexes = ast.getParameterMarkerIndexes(); 

    //å¡«å……SQLStatementå¹¶è¿”å› 
    return fillerEngine.fill(sqlSegments, parameterMarkerIndexes.size(), ast.getSqlStatementRule()); 
  }
</code></pre><h3 id="sql-è§£æå¼•æ“çš„ä¸‰å¤§é˜¶æ®µä¹‹å¦‚ä½•-ç”Ÿæˆ-sqlast">SQL è§£æå¼•æ“çš„ä¸‰å¤§é˜¶æ®µä¹‹å¦‚ä½• ç”Ÿæˆ SQLAST</h3>
<p>ä¸Šé¢è¿™æ®µä»£ç éå¸¸ç¬¦åˆå¤–è§‚ç±»çš„å¤„ç†é£æ ¼ï¼Œå³æŠŠå†…éƒ¨ç³»ç»Ÿçš„æ ¸å¿ƒç±»é€šè¿‡ç®€å•çš„è°ƒç”¨æ–¹å¼ç»„åˆåœ¨ä¸€èµ·å®Œæˆä¸šåŠ¡é“¾è·¯ã€‚æˆ‘ä»¬å¯¹ä¸‰æ®µä»£ç åˆ†åˆ«æ·»åŠ äº†æ³¨é‡Šï¼Œå®é™…ä¸Šï¼Œæ ¹æ®è¿™äº›æ³¨é‡Šï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å›ç­”åœ¨æœ¬è¯¾æ—¶å¼€å§‹æ—¶æ‰€æå‡º <strong>â€œSQL è§£æè¿‡ç¨‹åº”è¯¥åŒ…å«å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿâ€</strong> è¿™ä¸€é—®é¢˜ï¼Œå³ï¼š</p>
<ul>
<li>é€šè¿‡ SQLParserEngine ç”Ÿæˆ SQL æŠ½è±¡è¯­æ³•æ ‘</li>
<li>é€šè¿‡ SQLSegmentsExtractorEngine æå– SQLSegment</li>
<li>é€šè¿‡ SQLStatementFiller å¡«å…… SQLStatement</li>
</ul>
<p>è¿™ä¸‰ä¸ªé˜¶æ®µä¾¿æ˜¯ ShardingSphere æ–°ä¸€ä»£ SQL è§£æå¼•æ“çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ã€‚å…¶æ•´ä½“æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F8nyz2AaMf0AACQcl1OWTw870.png" alt="Drawing 8.png"></p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬çœ‹åˆ°ç”±<strong>è§£æã€æå–å’Œå¡«å……</strong>è¿™ä¸‰ä¸ªé˜¶æ®µæ‰€æ„æˆçš„æ•´ä½“ SQL è§£ææµç¨‹å·²ç»å®Œæˆã€‚ç°åœ¨èƒ½å¤Ÿæ ¹æ®ä¸€æ¡ SQL è¯­å¥è§£æå‡ºå¯¹åº”çš„ SQLStatement å¯¹è±¡ï¼Œä¾›åç»­çš„ ShardingRouter ç­‰è·¯ç”±å¼•æ“è¿›è¡Œä½¿ç”¨ã€‚</p>
<p>æœ¬è¯¾æ—¶æˆ‘ä»¬é¦–å…ˆå…³æ³¨æµç¨‹ä¸­çš„ç¬¬ä¸€é˜¶æ®µï¼Œå³å¦‚ä½•ç”Ÿæˆä¸€ä¸ª SQLASTï¼ˆåä¸¤ä¸ªé˜¶æ®µä¼šåœ¨åç»­è¯¾æ—¶ä¸­è®²è§£ï¼‰ã€‚è¿™éƒ¨åˆ†çš„å®ç°è¿‡ç¨‹ä½äº SQLParserEngine çš„ parse æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public SQLAST parse() { 
    SQLParser sqlParser = SQLParserFactory.newInstance(databaseTypeName, sql); 

     //åˆ©ç”¨ANTLR4è·å–è§£ææ ‘ 
     ParseTree parseTree; 
     try { 
         ((Parser) sqlParser).setErrorHandler(new BailErrorStrategy()); 
         ((Parser) sqlParser).getInterpreter().setPredictionMode(PredictionMode.SLL); 
         parseTree = sqlParser.execute().getChild(0); 
        } catch (final ParseCancellationException ex) { 
         ((Parser) sqlParser).reset(); 
         ((Parser) sqlParser).setErrorHandler(new DefaultErrorStrategy()); 
         ((Parser) sqlParser).getInterpreter().setPredictionMode(PredictionMode.LL); 
         parseTree = sqlParser.execute().getChild(0); 
        } 
     if (parseTree instanceof ErrorNode) { 
            throw new SQLParsingException(String.format(&quot;Unsupported SQL of `%s`&quot;, sql)); 
        } 

     //è·å–é…ç½®æ–‡ä»¶ä¸­çš„StatementRule 
     SQLStatementRule rule = parseRuleRegistry.getSQLStatementRule(databaseTypeName, parseTree.getClass().getSimpleName()); 
     if (null == rule) { 
         throw new SQLParsingException(String.format(&quot;Unsupported SQL of `%s`&quot;, sql)); 
        } 

     //å°è£…æŠ½è±¡è¯­æ³•æ ‘AST 
     return new SQLAST((ParserRuleContext) parseTree, getParameterMarkerIndexes((ParserRuleContext) parseTree), rule); 
}
</code></pre><p>ä¸Šè¿°ä»£ç ä¸­ SQLParser æ¥å£è´Ÿè´£å…·ä½“çš„ SQL åˆ° ASTï¼ˆAbstract Syntax Treeï¼ŒæŠ½è±¡è¯­æ³•æ ‘ï¼‰çš„è§£æè¿‡ç¨‹ã€‚è€Œå…·ä½“ SQLParser å®ç°ç±»çš„ç”Ÿæˆç”± SQLParserFactory è´Ÿè´£ï¼ŒSQLParserFactory å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>public final class SQLParserFactory { 

    public static SQLParser newInstance(final String databaseTypeName, final String sql) { 
     //é€šè¿‡SPIæœºåˆ¶åŠ è½½æ‰€æœ‰æ‰©å±• 
     for (SQLParserEntry each : NewInstanceServiceLoader.newServiceInstances(SQLParserEntry.class)) { 

        //åˆ¤æ–­æ•°æ®åº“ç±»å‹ 
        if (each.getDatabaseTypeName().equals(databaseTypeName)) { 
              return createSQLParser(sql, each); 
         } 
     } 
     throw new UnsupportedOperationException(String.format(&quot;Cannot support database type '%s'&quot;, databaseTypeName)); 
    } 
â€¦
}
</code></pre><p>è¿™é‡Œåˆå¼•å…¥äº†å¦ä¸€ä¸ªæ ¸å¿ƒæ¥å£ï¼Œå³ SQLParserEntryã€‚å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ SQLParserFactory ç±»ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä½¿ç”¨äº†[ã€Š13 | å¾®å†…æ ¸æ¶æ„ï¼šShardingSphere å¦‚ä½•å®ç°ç³»ç»Ÿçš„æ‰©å±•æ€§ã€‹]è¿™ä¸ªè¯¾æ—¶ä¸­ä»‹ç»çš„ NewInstanceServiceLoader å·¥å…·ç±»æ¥åŠ è½½å…·ä½“ SQLParserEntry çš„å®ç°ç±»ã€‚</p>
<p>ä»è¿™ç§å®ç°æ–¹å¼ä¸Šçœ‹ï¼Œæˆ‘ä»¬å¯ä»¥æ–­å®š SQLParserEntry æ˜¯ä¸€ä¸ª SPI æ¥å£ã€‚é€šè¿‡æŸ¥çœ‹ SQLParserEntry æ‰€å¤„çš„ä»£ç åŒ…ç»“æ„ï¼Œæ›´å°è¯äº†è¿™ä¸€è§‚ç‚¹ï¼Œå› ä¸ºè¯¥ç±»ä½äº shardingsphere-sql-parser-spi å·¥ç¨‹çš„ org.apache.shardingsphere.sql.parser.spi åŒ…ä¸­ã€‚</p>
<p>å…³äº SQLParser å’Œ SQLParserEntry è¿™ä¸€å¯¹æ¥å£ï¼Œè¿˜æœ‰ä¸€ç‚¹å€¼å¾—æ¢è®¨ã€‚æ³¨æ„åˆ° SQLParser æ¥å£ä½äº shardingsphere-sql-parser-spi å·¥ç¨‹çš„ org.apache.shardingsphere.sql.parser.api åŒ…ä¸­ï¼Œæ‰€ç¤ºå®ƒæ˜¯ä¸€ä¸ª API æ¥å£ã€‚</p>
<p>ä»å®šä½ä¸Šè®²ï¼ŒSQLParser æ˜¯è§£æå™¨å¯¹å¤–æš´éœ²çš„å…¥å£ï¼Œè€Œ SQLParserEntry æ˜¯è§£æå™¨çš„åº•å±‚å®ç°ï¼Œä¸¤è€…å…±åŒæ„æˆäº† SQL è§£æå™¨æœ¬èº«ã€‚æ›´å®½æ³›çš„ï¼Œä»æ¶æ„è®¾è®¡å±‚æ¬¡ä¸Šè®²ï¼ŒAPI é¢å‘é«˜å±‚ä¸šåŠ¡å¼€å‘äººå‘˜ï¼Œè€Œ SPI é¢å‘åº•å±‚æ¡†æ¶å¼€å‘äººå‘˜ï¼Œä¸¤è€…çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ä½œä¸ºä¸€æ¬¾ä¼˜ç§€çš„ä¸­é—´ä»¶æ¡†æ¶ï¼Œè¿™ç§ API å’Œ SPI çš„å¯¹åº”å…³ç³»åœ¨ ShardingSphere ä¸­éå¸¸æ™®éï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æ­£ç¡®ç†è§£ ShardingSphere æ¶æ„è®¾è®¡ä¸Šçš„ä¸€ä¸ªåˆ‡å…¥ç‚¹ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl8ny3WAAR7gAABKWeCFeTg698.png" alt="Drawing 10.png"></p>
<p>SQLParser å’Œ SQLParserEntry è¿™ä¸¤ä¸ªæ¥å£çš„å®šä¹‰å’Œå®ç°éƒ½ä¸åŸºäº ANTLR4 çš„ AST ç”Ÿæˆæœºåˆ¶æœ‰å…³ã€‚ANTLR æ˜¯ Another Tool for Language Recognition çš„ç®€å†™ï¼Œæ˜¯ä¸€æ¬¾èƒ½å¤Ÿæ ¹æ®è¾“å…¥è‡ªåŠ¨ç”Ÿæˆè¯­æ³•æ ‘çš„å¼€æºè¯­æ³•åˆ†æå™¨ã€‚ANTLR å¯ä»¥å°†ç”¨æˆ·ç¼–å†™çš„ ANTLR è¯­æ³•è§„åˆ™ç›´æ¥ç”Ÿæˆ Javaã€Go è¯­è¨€çš„è§£æå™¨ï¼Œåœ¨ ShardingSphere ä¸­å°±ä½¿ç”¨äº† ANTLR4 æ¥ç”Ÿæˆ ASTã€‚</p>
<p>æˆ‘ä»¬æ³¨æ„åˆ° SQLParserEngine çš„ parse æ–¹æ³•æœ€ç»ˆè¿”å›çš„æ˜¯ä¸€ä¸ª SQLASTï¼Œè¯¥ç±»çš„å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<pre tabindex="0"><code>public final class SQLAST { 

    private final ParserRuleContext parserRuleContext; 

    private final Map&lt;ParserRuleContext, Integer&gt; parameterMarkerIndexes; 

    private final SQLStatementRule sqlStatementRule; 
}
</code></pre><p>è¿™é‡Œçš„ ParserRuleContext å®é™…ä¸Šå°±æ¥è‡ª ANTLR4ï¼Œè€Œ SQLStatementRule åˆ™æ˜¯ä¸€ä¸ªè§„åˆ™å¯¹è±¡ï¼ŒåŒ…å«äº†å¯¹ SQLSegment æå–å™¨çš„å®šä¹‰ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µçš„è®¨è®ºï¼Œå³å¦‚ä½•æå– SQLSegmentï¼ˆä¸‹ä¸€è¯¾æ—¶ä¼šè®²è§£ï¼‰ã€‚</p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>ä½œä¸º ShardingSphere åˆ†ç‰‡å¼•æ“çš„ç¬¬ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œè§£æå¼•æ“çš„ç›®çš„åœ¨äºç”Ÿæˆ SQLStatement ç›®æ ‡å¯¹è±¡ã€‚è€Œæ•´ä¸ªè§£æå¼•æ“åˆ†æˆä¸‰å¤§é˜¶æ®µï¼Œå³ç”Ÿæˆ SQL æŠ½è±¡è¯­æ³•æ ‘ã€æå– SQL ç‰‡æ®µä»¥åŠä½¿ç”¨è¿™äº›ç‰‡æ®µæ¥å¡«å…… SQL è¯­å¥ã€‚æœ¬è¯¾æ—¶å¯¹è§£æå¼•æ“çš„æ•´ä½“ç»“æ„ä»¥åŠè¿™ä¸‰ä¸ªé˜¶æ®µä¸­çš„ç¬¬ä¸€ä¸ªé˜¶æ®µè¿›è¡Œäº†è¯¦ç»†çš„è®¨è®ºã€‚</p>
<p>è¿™é‡Œç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜ï¼šåœ¨ ShardingSphere ä¸­ï¼Œå¤–è§‚æ¨¡å¼å¦‚ä½•åº”ç”¨åˆ° SQL è§£æè¿‡ç¨‹ä¸­ï¼Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸å¤§å®¶è®¨è®ºï¼Œæˆ‘å°†ä¸€ä¸€ç‚¹è¯„è§£ç­”ã€‚</p>
<p>æœ¬è¯¾æ—¶çš„å†…å®¹å°±åˆ°è¿™é‡Œï¼Œåœ¨ä¸‹ä¸€è¯¾æ—¶ä¸­ï¼Œæˆ‘ä»¬å°†å®Œæˆå¯¹ SQL è§£æå¼•æ“å‰©ä½™ä¸¤ä¸ªé˜¶æ®µå†…å®¹çš„ä»‹ç»ï¼Œå³å¦‚ä½•æå– SQL ç‰‡æ®µä»¥åŠå¡«å…… SQL è¯­å¥ï¼Œè®°å¾—æŒ‰æ—¶æ¥å¬è¯¾ã€‚</p>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/14-%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AEshardingsphere-%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AE%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/"><span>14 åˆ†å¸ƒå¼ä¸»é”®ï¼šShardingSphere ä¸­æœ‰å“ªäº›åˆ†å¸ƒå¼ä¸»é”®å®ç°æ–¹å¼ï¼Ÿ</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/16-%E8%A7%A3%E6%9E%90%E5%BC%95%E6%93%8Esql-%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%8C%85%E6%8B%AC%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E9%98%B6%E6%AE%B5%E4%B8%8B/"><span>16 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸‹ï¼‰</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 27270 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>