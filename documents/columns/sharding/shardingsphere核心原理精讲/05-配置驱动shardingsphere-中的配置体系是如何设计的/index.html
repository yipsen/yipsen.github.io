<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>05 é…ç½®é©±åŠ¨ï¼šShardingSphere ä¸­çš„é…ç½®ä½“ç³»æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ | Yipsen Ye</title>
<meta name="description" content="åœ¨ä¸Šä¸€è¯¾æ—¶ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­åº”ç”¨ ShardingSphere çš„å‡ ç§æ–¹æ³•ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬å‘ç°ï¼Œé™¤äº†æŒæ¡ Springã€Spring Bootã€Mybatis ç­‰å¸¸è§æ¡†æ¶çš„åŠŸèƒ½ç‰¹æ€§ä¹‹å¤–ï¼Œä½¿ç”¨ ShardingSphere çš„ä¸»è¦å·¥ä½œåœ¨äºæ ¹æ®ä¸šåŠ¡éœ€æ±‚å®Œæˆå„ç§åˆ†ç‰‡æ“ä½œç›¸å…³é…ç½®é¡¹çš„è®¾ç½®ã€‚ä»Šå¤©ï¼Œæˆ‘å°±æ¥å¸¦é¢†ä½ å‰–æ ShardingSphere ä¸­çš„é…ç½®ä½“ç³»åˆ°åº•æ˜¯å¦‚ä½•è¿›è¡Œè®¾è®¡å¹¶å®ç°çš„ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä»‹ç» ShardingSphere æ ¸å¿ƒåŠŸèƒ½çš„å‰æã€‚
ä»€ä¹ˆæ˜¯è¡Œè¡¨è¾¾å¼ï¼Ÿ åœ¨å¼•å…¥é…ç½®ä½“ç³»çš„å­¦ä¹ ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ä»‹ç» ShardingSphere æ¡†æ¶ä¸ºå¼€å‘äººå‘˜æä¾›çš„ä¸€ä¸ªè¾…åŠ©åŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½å°±æ˜¯è¡Œè¡¨è¾¾å¼ã€‚
è¡Œè¡¨è¾¾å¼æ˜¯ ShardingSphere ä¸­ç”¨äºå®ç°ç®€åŒ–å’Œç»Ÿä¸€é…ç½®ä¿¡æ¯çš„ä¸€ç§å·¥å…·ï¼Œåœ¨æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­åº”ç”¨å¾—éå¸¸å¹¿æ³›ã€‚ å®ƒçš„ä½¿ç”¨æ–¹å¼éå¸¸ç›´è§‚ï¼Œåªéœ€è¦åœ¨é…ç½®ä¸­ä½¿ç”¨ ${expression} æˆ– $-&amp;gt;{expression} è¡¨è¾¾å¼å³å¯ã€‚
ä¾‹å¦‚ä¸Šä¸€è¯¾æ—¶ä¸­ä½¿ç”¨çš„&amp;quot;ds${0..1}.user${0..1}&amp;ldquo;å°±æ˜¯ä¸€ä¸ªè¡Œè¡¨è¾¾å¼ï¼Œç”¨æ¥è®¾ç½®å¯ç”¨çš„æ•°æ®æºæˆ–æ•°æ®è¡¨åç§°ã€‚åŸºäºè¡Œè¡¨è¾¾å¼è¯­æ³•ï¼Œ${begin..end} è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªä»&amp;quot;begin&amp;quot;åˆ°&amp;quot;end&amp;quot;çš„èŒƒå›´åŒºé—´ï¼Œè€Œå¤šä¸ª ${expression} ä¹‹é—´å¯ä»¥ç”¨&amp;rdquo;.&amp;ldquo;ç¬¦å·è¿›è¡Œè¿æ¥ï¼Œä»£è¡¨å¤šä¸ªè¡¨è¾¾å¼æ•°å€¼ä¹‹é—´çš„ä¸€ç§ç¬›å¡å°”ç§¯å…³ç³»ã€‚è¿™æ ·ï¼Œå¦‚æœé‡‡ç”¨å›¾å½¢åŒ–çš„è¡¨ç°å½¢å¼ï¼Œ&amp;ldquo;ds${0..1}.user${0..1}&amp;ldquo;è¡¨è¾¾å¼æœ€ç»ˆä¼šè§£ææˆè¿™æ ·ä¸€ç§ç»“æœï¼š
å½“ç„¶ï¼Œç±»ä¼¼åœºæ™¯ä¹Ÿå¯ä»¥ä½¿ç”¨æšä¸¾çš„æ–¹å¼æ¥åˆ—ä¸¾æ‰€æœ‰å¯èƒ½å€¼ã€‚è¡Œè¡¨è¾¾å¼ä¹Ÿæä¾›äº† ${[enum1, enum2,â€¦, enumx]} è¯­æ³•æ¥è¡¨ç¤ºæšä¸¾å€¼ï¼Œæ‰€ä»¥&amp;quot;ds${0..1}.user${0..1}&amp;ldquo;çš„æ•ˆæœç­‰åŒäº&amp;quot;ds${[0,1]}.user${[0,1]}&amp;quot;ã€‚
åŒæ ·ï¼Œåœ¨ä¸Šä¸€è¯¾æ—¶ä¸­ä½¿ç”¨åˆ°çš„ ds${age % 2} è¡¨è¾¾å¼ï¼Œå®ƒè¡¨ç¤ºæ ¹æ® age å­—æ®µè¿›è¡Œå¯¹ 2 å–æ¨¡ï¼Œä»è€Œè‡ªåŠ¨è®¡ç®—ç›®æ ‡æ•°æ®æºæ˜¯ ds0 è¿˜æ˜¯ ds1ã€‚æ‰€ä»¥ï¼Œé™¤äº†é…ç½®æ•°æ®æºå’Œæ•°æ®è¡¨åç§°ä¹‹å¤–ï¼Œè¡Œè¡¨è¾¾å¼åœ¨ ShardingSphere ä¸­å¦ä¸€ä¸ªå¸¸è§çš„åº”ç”¨åœºæ™¯å°±æ˜¯é…ç½®å„ç§åˆ†ç‰‡ç®—æ³•ï¼Œæˆ‘ä»¬ä¼šåœ¨åç»­çš„ç¤ºä¾‹ä¸­å¤§é‡çœ‹åˆ°è¿™ç§ä½¿ç”¨æ–¹æ³•ã€‚
ç”±äº ${expression} ä¸ Spring æœ¬èº«çš„å±æ€§æ–‡ä»¶å ä½ç¬¦å†²çªï¼Œè€Œ Spring åˆæ˜¯ç›®å‰ä¸»æµçš„å¼€å‘æ¡†æ¶ï¼Œå› æ­¤åœ¨æ­£å¼ç¯å¢ƒä¸­å»ºè®®ä½ ä½¿ç”¨ $-&amp;gt;{expression} æ¥è¿›è¡Œé…ç½®ã€‚
ShardingSphere æœ‰å“ªäº›æ ¸å¿ƒé…ç½®ï¼Ÿ å¯¹äºåˆ†åº“åˆ†è¡¨ã€è¯»å†™åˆ†ç¦»æ“ä½œè€Œè¨€ï¼Œé…ç½®çš„ä¸»è¦ä»»åŠ¡æ˜¯å®Œæˆå„ç§è§„åˆ™çš„åˆ›å»ºå’Œåˆå§‹åŒ–ã€‚é…ç½®æ˜¯æ•´ä¸ª ShardingSphere çš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯æˆ‘ä»¬åœ¨æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­çš„ä¸»è¦å·¥ä½œã€‚å¯ä»¥è¯´ï¼Œåªè¦æˆ‘ä»¬æŒæ¡äº† ShardingSphere çš„æ ¸å¿ƒé…ç½®é¡¹ï¼Œå°±ç›¸å½“äºæŒæ¡äº†è¿™ä¸ªæ¡†æ¶çš„ä½¿ç”¨æ–¹æ³•ã€‚é‚£ä¹ˆï¼ŒShardingSphere æœ‰å“ªäº›æ ¸å¿ƒé…ç½®å‘¢ï¼Ÿè¿™é‡Œä»¥åˆ†ç‰‡å¼•æ“ä¸ºä¾‹ä»‹ç»æœ€å¸¸ç”¨çš„å‡ ä¸ªé…ç½®é¡¹ï¼Œè€Œä¸è¯»å†™åˆ†ç¦»ã€æ•°æ®è„±æ•ã€ç¼–æ’æ²»ç†ç›¸å…³çš„é…ç½®é¡¹æˆ‘ä»¬ä¼šåœ¨ä»‹ç»å…·ä½“çš„åº”ç”¨åœºæ™¯æ—¶å†åšå±•å¼€ã€‚
ShardingRuleConfiguration æˆ‘ä»¬åœ¨ä¸Šä¸€è¯¾æ—¶ä¸­å·²ç»äº†è§£äº†å¦‚ä½•é€šè¿‡æ¡†æ¶ä¹‹é—´çš„é›†æˆæ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ª DataSourceï¼Œè¿™ä¸ª DataSource å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨ ShardingSphere çš„å…¥å£ã€‚æˆ‘ä»¬ä¹Ÿçœ‹åˆ°åœ¨åˆ›å»º DataSource çš„è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°äº†ä¸€ä¸ª ShardingDataSourceFactory ç±»ï¼Œè¿™ä¸ªå·¥å‚ç±»çš„æ„é€ å‡½æ•°ä¸­éœ€è¦ä¼ å…¥ä¸€ä¸ª ShardingRuleConfiguration å¯¹è±¡ã€‚æ˜¾ç„¶ï¼Œä»å‘½åä¸Šçœ‹ï¼Œè¿™ä¸ª ShardingRuleConfiguration å°±æ˜¯ç”¨äºåˆ†ç‰‡è§„åˆ™çš„é…ç½®å…¥å£ã€‚">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/shardingsphere%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86%e7%b2%be%e8%ae%b2/">ShardingSphereæ ¸å¿ƒåŸç†ç²¾è®²</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/00-%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E5%AD%A6%E4%B9%A0%E4%B8%80%E6%AC%BE%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E5%BC%80%E6%BA%90%E6%A1%86%E6%9E%B6/">00 å¦‚ä½•æ­£ç¡®å­¦ä¹ ä¸€æ¬¾åˆ†åº“åˆ†è¡¨å¼€æºæ¡†æ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/01-%E4%BB%8E%E7%90%86%E8%AE%BA%E5%88%B0%E5%AE%9E%E8%B7%B5%E5%A6%82%E4%BD%95%E8%AE%A9%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E7%9C%9F%E6%AD%A3%E8%90%BD%E5%9C%B0/">01 ä»ç†è®ºåˆ°å®è·µï¼šå¦‚ä½•è®©åˆ†åº“åˆ†è¡¨çœŸæ­£è½åœ°ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/02-%E9%A1%B6%E7%BA%A7%E9%A1%B9%E7%9B%AEshardingsphere-%E6%98%AF%E4%B8%80%E6%AC%BE%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84-apache-%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6/">02 é¡¶çº§é¡¹ç›®ï¼šShardingSphere æ˜¯ä¸€æ¬¾ä»€ä¹ˆæ ·çš„ Apache å¼€æºè½¯ä»¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/03-%E8%A7%84%E8%8C%83%E5%85%BC%E5%AE%B9jdbc-%E8%A7%84%E8%8C%83%E4%B8%8E-shardingsphere-%E6%98%AF%E4%BB%80%E4%B9%88%E5%85%B3%E7%B3%BB/">03 è§„èŒƒå…¼å®¹ï¼šJDBC è§„èŒƒä¸ ShardingSphere æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/04-%E5%BA%94%E7%94%A8%E9%9B%86%E6%88%90%E5%9C%A8%E4%B8%9A%E5%8A%A1%E7%B3%BB%E7%BB%9F%E4%B8%AD%E4%BD%BF%E7%94%A8-shardingsphere-%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B/">04 åº”ç”¨é›†æˆï¼šåœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ä½¿ç”¨ ShardingSphere çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</a></li>
                
                
                
                    <li>05 é…ç½®é©±åŠ¨ï¼šShardingSphere ä¸­çš„é…ç½®ä½“ç³»æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/09-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E4%B8%8E%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1/">09 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ä½¿ç”¨å¼ºä¸€è‡´æ€§äº‹åŠ¡ä¸æŸ”æ€§äº‹åŠ¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/10-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E5%A6%82%E4%BD%95%E7%A1%AE%E4%BF%9D%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%89%E5%85%A8%E8%AE%BF%E9%97%AE/">10 æ•°æ®è„±æ•ï¼šå¦‚ä½•ç¡®ä¿æ•æ„Ÿæ•°æ®çš„å®‰å…¨è®¿é—®ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/11-%E7%BC%96%E6%8E%92%E6%B2%BB%E7%90%86%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E5%8A%A8%E6%80%81%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/">11 ç¼–æ’æ²»ç†ï¼šå¦‚ä½•å®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„åŠ¨æ€é…ç½®ç®¡ç†ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/12-%E4%BB%8E%E5%BA%94%E7%94%A8%E5%88%B0%E5%8E%9F%E7%90%86%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E9%98%85%E8%AF%BB-shardingsphere-%E6%BA%90%E7%A0%81/">12 ä»åº”ç”¨åˆ°åŸç†ï¼šå¦‚ä½•é«˜æ•ˆé˜…è¯» ShardingSphere æºç ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/13-%E5%BE%AE%E5%86%85%E6%A0%B8%E6%9E%B6%E6%9E%84shardingsphere-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%89%A9%E5%B1%95%E6%80%A7/">13 å¾®å†…æ ¸æ¶æ„ï¼šShardingSphere å¦‚ä½•å®ç°ç³»ç»Ÿçš„æ‰©å±•æ€§ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/14-%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AEshardingsphere-%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AE%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/">14 åˆ†å¸ƒå¼ä¸»é”®ï¼šShardingSphere ä¸­æœ‰å“ªäº›åˆ†å¸ƒå¼ä¸»é”®å®ç°æ–¹å¼ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/15-%E8%A7%A3%E6%9E%90%E5%BC%95%E6%93%8Esql-%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%8C%85%E6%8B%AC%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E9%98%B6%E6%AE%B5%E4%B8%8A/">15 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/16-%E8%A7%A3%E6%9E%90%E5%BC%95%E6%93%8Esql-%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%8C%85%E6%8B%AC%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E9%98%B6%E6%AE%B5%E4%B8%8B/">16 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/17-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E5%88%86%E7%89%87%E8%B7%AF%E7%94%B1%E6%A0%B8%E5%BF%83%E7%B1%BB-shardingrouter-%E7%9A%84%E8%BF%90%E4%BD%9C%E6%9C%BA%E5%88%B6/">17 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•ç†è§£åˆ†ç‰‡è·¯ç”±æ ¸å¿ƒç±» ShardingRouter çš„è¿ä½œæœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/18-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E7%9A%84%E5%88%86%E7%89%87%E8%B7%AF%E7%94%B1%E5%92%8C%E5%B9%BF%E6%92%AD%E8%B7%AF%E7%94%B1/">18 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•å®ç°æ•°æ®è®¿é—®çš„åˆ†ç‰‡è·¯ç”±å’Œå¹¿æ’­è·¯ç”±ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/19-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E5%9C%A8%E8%B7%AF%E7%94%B1%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%9B%86%E6%88%90%E5%A4%9A%E7%A7%8D%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5%E5%92%8C%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95/">19 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•åœ¨è·¯ç”±è¿‡ç¨‹ä¸­é›†æˆå¤šç§è·¯ç”±ç­–ç•¥å’Œè·¯ç”±ç®—æ³•ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/20-%E6%94%B9%E5%86%99%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84-sql-%E6%94%B9%E5%86%99%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6/">20 æ”¹å†™å¼•æ“ï¼šå¦‚ä½•ç†è§£è£…é¥°å™¨æ¨¡å¼ä¸‹çš„ SQL æ”¹å†™å®ç°æœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/21-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%88%86%E7%89%87%E7%8E%AF%E5%A2%83%E4%B8%8B-sql-%E6%89%A7%E8%A1%8C%E7%9A%84%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E6%8A%BD%E8%B1%A1/">21 æ‰§è¡Œå¼•æ“ï¼šåˆ†ç‰‡ç¯å¢ƒä¸‹ SQL æ‰§è¡Œçš„æ•´ä½“æµç¨‹åº”è¯¥å¦‚ä½•è¿›è¡ŒæŠ½è±¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/22-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E6%8A%8A%E6%8F%A1-shardingsphere-%E4%B8%AD%E7%9A%84-executor-%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B%E4%B8%8A/">22 æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•æŠŠæ¡ ShardingSphere ä¸­çš„ Executor æ‰§è¡Œæ¨¡å‹ï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/23-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E6%8A%8A%E6%8F%A1-shardingsphere-%E4%B8%AD%E7%9A%84-executor-%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B%E4%B8%8B/">23 æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•æŠŠæ¡ ShardingSphere ä¸­çš„ Executor æ‰§è¡Œæ¨¡å‹ï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/24-%E5%BD%92%E5%B9%B6%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%95%B0%E6%8D%AE%E5%BD%92%E5%B9%B6%E7%9A%84%E7%B1%BB%E5%9E%8B%E4%BB%A5%E5%8F%8A%E7%AE%80%E5%8D%95%E5%BD%92%E5%B9%B6%E7%AD%96%E7%95%A5%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/">24 å½’å¹¶å¼•æ“ï¼šå¦‚ä½•ç†è§£æ•°æ®å½’å¹¶çš„ç±»å‹ä»¥åŠç®€å•å½’å¹¶ç­–ç•¥çš„å®ç°è¿‡ç¨‹ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/25-%E5%BD%92%E5%B9%B6%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%B5%81%E5%BC%8F%E5%BD%92%E5%B9%B6%E5%92%8C%E5%86%85%E5%AD%98%E5%BD%92%E5%B9%B6%E5%9C%A8%E5%A4%8D%E6%9D%82%E5%BD%92%E5%B9%B6%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84%E5%BA%94%E7%94%A8%E6%96%B9%E5%BC%8F/">25 å½’å¹¶å¼•æ“ï¼šå¦‚ä½•ç†è§£æµå¼å½’å¹¶å’Œå†…å­˜å½’å¹¶åœ¨å¤æ‚å½’å¹¶åœºæ™¯ä¸‹çš„åº”ç”¨æ–¹å¼ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/26-%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%99%AE%E9%80%9A%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84%E5%92%8C%E5%88%86%E7%89%87%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84%E5%88%86%E5%88%AB%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%9A%84/">26 è¯»å†™åˆ†ç¦»ï¼šæ™®é€šä¸»ä»æ¶æ„å’Œåˆ†ç‰‡ä¸»ä»æ¶æ„åˆ†åˆ«æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/27-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3-shardingsphere-%E4%B8%AD%E5%AF%B9%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%8A%BD%E8%B1%A1%E8%BF%87%E7%A8%8B/">27 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ç†è§£ ShardingSphere ä¸­å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„æŠ½è±¡è¿‡ç¨‹ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/28-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1shardingsphere-%E4%B8%AD%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E5%92%8C%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1%E6%94%AF%E6%8C%81%E4%B8%8A/">28 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šShardingSphere ä¸­å¦‚ä½•é›†æˆå¼ºä¸€è‡´æ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡æ”¯æŒï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/29-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1shardingsphere-%E4%B8%AD%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E5%92%8C%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1%E6%94%AF%E6%8C%81%E4%B8%8B/">29 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šShardingSphere ä¸­å¦‚ä½•é›†æˆå¼ºä¸€è‡´æ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡æ”¯æŒï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/30-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E6%94%B9%E5%86%99%E5%BC%95%E6%93%8E%E5%AE%9E%E7%8E%B0%E4%BD%8E%E4%BE%B5%E5%85%A5%E6%80%A7%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E6%96%B9%E6%A1%88/">30 æ•°æ®è„±æ•ï¼šå¦‚ä½•åŸºäºæ”¹å†™å¼•æ“å®ç°ä½ä¾µå…¥æ€§æ•°æ®è„±æ•æ–¹æ¡ˆï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/31-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%AE%9E%E7%8E%B0%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E7%9A%84%E5%8A%A8%E6%80%81%E5%8C%96%E7%AE%A1%E7%90%86/">31 é…ç½®ä¸­å¿ƒï¼šå¦‚ä½•åŸºäºé…ç½®ä¸­å¿ƒå®ç°é…ç½®ä¿¡æ¯çš„åŠ¨æ€åŒ–ç®¡ç†ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/32-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BF%E9%97%AE%E7%86%94%E6%96%AD%E6%9C%BA%E5%88%B6/">32 æ³¨å†Œä¸­å¿ƒï¼šå¦‚ä½•åŸºäºæ³¨å†Œä¸­å¿ƒå®ç°æ•°æ®åº“è®¿é—®ç†”æ–­æœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/33-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E-hook-%E6%9C%BA%E5%88%B6%E4%BB%A5%E5%8F%8A-opentracing-%E5%8D%8F%E8%AE%AE%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/">33 é“¾è·¯è·Ÿè¸ªï¼šå¦‚ä½•åŸºäº Hook æœºåˆ¶ä»¥åŠ OpenTracing åè®®å®ç°æ•°æ®è®¿é—®é“¾è·¯è·Ÿè¸ªï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/35-%E7%BB%93%E8%AF%ADshardingsphere-%E6%80%BB%E7%BB%93%E5%8F%8A%E5%B1%95%E6%9C%9B/">35 ç»“è¯­ï¼šShardingSphere æ€»ç»“åŠå±•æœ›</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">05 é…ç½®é©±åŠ¨ï¼šShardingSphere ä¸­çš„é…ç½®ä½“ç³»æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2021-12-22 01:55:47</span>ğŸ·ï¸&nbsp;<a class="post-tag" href="/tags/sharding/">sharding</a></div><div class="post-category">
                
                ğŸ“š&nbsp;<a href="/categories/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/">ShardingSphereæ ¸å¿ƒåŸç†ç²¾è®²</a>
                
            </div></div>
        <div class="post-content">
            <p>åœ¨ä¸Šä¸€è¯¾æ—¶ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­åº”ç”¨ ShardingSphere çš„å‡ ç§æ–¹æ³•ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬å‘ç°ï¼Œé™¤äº†æŒæ¡ Springã€Spring Bootã€Mybatis ç­‰å¸¸è§æ¡†æ¶çš„åŠŸèƒ½ç‰¹æ€§ä¹‹å¤–ï¼Œä½¿ç”¨ ShardingSphere çš„ä¸»è¦å·¥ä½œåœ¨äºæ ¹æ®ä¸šåŠ¡éœ€æ±‚å®Œæˆå„ç§åˆ†ç‰‡æ“ä½œç›¸å…³é…ç½®é¡¹çš„è®¾ç½®ã€‚ä»Šå¤©ï¼Œæˆ‘å°±æ¥å¸¦é¢†ä½ å‰–æ ShardingSphere ä¸­çš„é…ç½®ä½“ç³»åˆ°åº•æ˜¯å¦‚ä½•è¿›è¡Œè®¾è®¡å¹¶å®ç°çš„ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä»‹ç» ShardingSphere æ ¸å¿ƒåŠŸèƒ½çš„å‰æã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯è¡Œè¡¨è¾¾å¼">ä»€ä¹ˆæ˜¯è¡Œè¡¨è¾¾å¼ï¼Ÿ</h3>
<p>åœ¨å¼•å…¥é…ç½®ä½“ç³»çš„å­¦ä¹ ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ä»‹ç» ShardingSphere æ¡†æ¶ä¸ºå¼€å‘äººå‘˜æä¾›çš„ä¸€ä¸ªè¾…åŠ©åŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½å°±æ˜¯è¡Œè¡¨è¾¾å¼ã€‚</p>
<p><strong>è¡Œè¡¨è¾¾å¼æ˜¯ ShardingSphere ä¸­ç”¨äºå®ç°ç®€åŒ–å’Œç»Ÿä¸€é…ç½®ä¿¡æ¯çš„ä¸€ç§å·¥å…·ï¼Œåœ¨æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­åº”ç”¨å¾—éå¸¸å¹¿æ³›ã€‚</strong> å®ƒçš„ä½¿ç”¨æ–¹å¼éå¸¸ç›´è§‚ï¼Œåªéœ€è¦åœ¨é…ç½®ä¸­ä½¿ç”¨ ${expression} æˆ– $-&gt;{expression} è¡¨è¾¾å¼å³å¯ã€‚</p>
<p>ä¾‹å¦‚ä¸Šä¸€è¯¾æ—¶ä¸­ä½¿ç”¨çš„&quot;ds${0..1}.user${0..1}&ldquo;å°±æ˜¯ä¸€ä¸ªè¡Œè¡¨è¾¾å¼ï¼Œç”¨æ¥è®¾ç½®å¯ç”¨çš„æ•°æ®æºæˆ–æ•°æ®è¡¨åç§°ã€‚åŸºäºè¡Œè¡¨è¾¾å¼è¯­æ³•ï¼Œ${begin..end} è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªä»&quot;begin&quot;åˆ°&quot;end&quot;çš„èŒƒå›´åŒºé—´ï¼Œè€Œå¤šä¸ª ${expression} ä¹‹é—´å¯ä»¥ç”¨&rdquo;.&ldquo;ç¬¦å·è¿›è¡Œè¿æ¥ï¼Œä»£è¡¨å¤šä¸ªè¡¨è¾¾å¼æ•°å€¼ä¹‹é—´çš„ä¸€ç§ç¬›å¡å°”ç§¯å…³ç³»ã€‚è¿™æ ·ï¼Œå¦‚æœé‡‡ç”¨å›¾å½¢åŒ–çš„è¡¨ç°å½¢å¼ï¼Œ&ldquo;ds${0..1}.user${0..1}&ldquo;è¡¨è¾¾å¼æœ€ç»ˆä¼šè§£ææˆè¿™æ ·ä¸€ç§ç»“æœï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl75rReAY_fbAACRt1sYKS0524.png" alt="image"></p>
<p>å½“ç„¶ï¼Œç±»ä¼¼åœºæ™¯ä¹Ÿå¯ä»¥ä½¿ç”¨æšä¸¾çš„æ–¹å¼æ¥åˆ—ä¸¾æ‰€æœ‰å¯èƒ½å€¼ã€‚è¡Œè¡¨è¾¾å¼ä¹Ÿæä¾›äº† ${[enum1, enum2,â€¦, enumx]} è¯­æ³•æ¥è¡¨ç¤ºæšä¸¾å€¼ï¼Œæ‰€ä»¥&quot;ds${0..1}.user${0..1}&ldquo;çš„æ•ˆæœç­‰åŒäº&quot;ds${[0,1]}.user${[0,1]}&quot;ã€‚</p>
<p>åŒæ ·ï¼Œåœ¨ä¸Šä¸€è¯¾æ—¶ä¸­ä½¿ç”¨åˆ°çš„ ds${age % 2} è¡¨è¾¾å¼ï¼Œå®ƒè¡¨ç¤ºæ ¹æ® age å­—æ®µè¿›è¡Œå¯¹ 2 å–æ¨¡ï¼Œä»è€Œè‡ªåŠ¨è®¡ç®—ç›®æ ‡æ•°æ®æºæ˜¯ ds0 è¿˜æ˜¯ ds1ã€‚æ‰€ä»¥ï¼Œé™¤äº†é…ç½®æ•°æ®æºå’Œæ•°æ®è¡¨åç§°ä¹‹å¤–ï¼Œè¡Œè¡¨è¾¾å¼åœ¨ ShardingSphere ä¸­å¦ä¸€ä¸ªå¸¸è§çš„åº”ç”¨åœºæ™¯å°±æ˜¯é…ç½®å„ç§åˆ†ç‰‡ç®—æ³•ï¼Œæˆ‘ä»¬ä¼šåœ¨åç»­çš„ç¤ºä¾‹ä¸­å¤§é‡çœ‹åˆ°è¿™ç§ä½¿ç”¨æ–¹æ³•ã€‚</p>
<p>ç”±äº ${expression} ä¸ Spring æœ¬èº«çš„å±æ€§æ–‡ä»¶å ä½ç¬¦å†²çªï¼Œè€Œ Spring åˆæ˜¯ç›®å‰ä¸»æµçš„å¼€å‘æ¡†æ¶ï¼Œå› æ­¤åœ¨æ­£å¼ç¯å¢ƒä¸­å»ºè®®ä½ ä½¿ç”¨ $-&gt;{expression} æ¥è¿›è¡Œé…ç½®ã€‚</p>
<h3 id="shardingsphere-æœ‰å“ªäº›æ ¸å¿ƒé…ç½®">ShardingSphere æœ‰å“ªäº›æ ¸å¿ƒé…ç½®ï¼Ÿ</h3>
<p>å¯¹äºåˆ†åº“åˆ†è¡¨ã€è¯»å†™åˆ†ç¦»æ“ä½œè€Œè¨€ï¼Œé…ç½®çš„ä¸»è¦ä»»åŠ¡æ˜¯å®Œæˆå„ç§è§„åˆ™çš„åˆ›å»ºå’Œåˆå§‹åŒ–ã€‚é…ç½®æ˜¯æ•´ä¸ª ShardingSphere çš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯æˆ‘ä»¬åœ¨æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­çš„ä¸»è¦å·¥ä½œã€‚å¯ä»¥è¯´ï¼Œåªè¦æˆ‘ä»¬æŒæ¡äº† ShardingSphere çš„æ ¸å¿ƒé…ç½®é¡¹ï¼Œå°±ç›¸å½“äºæŒæ¡äº†è¿™ä¸ªæ¡†æ¶çš„ä½¿ç”¨æ–¹æ³•ã€‚é‚£ä¹ˆï¼ŒShardingSphere æœ‰å“ªäº›æ ¸å¿ƒé…ç½®å‘¢ï¼Ÿè¿™é‡Œä»¥åˆ†ç‰‡å¼•æ“ä¸ºä¾‹ä»‹ç»æœ€å¸¸ç”¨çš„å‡ ä¸ªé…ç½®é¡¹ï¼Œè€Œä¸è¯»å†™åˆ†ç¦»ã€æ•°æ®è„±æ•ã€ç¼–æ’æ²»ç†ç›¸å…³çš„é…ç½®é¡¹æˆ‘ä»¬ä¼šåœ¨ä»‹ç»å…·ä½“çš„åº”ç”¨åœºæ™¯æ—¶å†åšå±•å¼€ã€‚</p>
<h4 id="shardingruleconfiguration">ShardingRuleConfiguration</h4>
<p>æˆ‘ä»¬åœ¨ä¸Šä¸€è¯¾æ—¶ä¸­å·²ç»äº†è§£äº†å¦‚ä½•é€šè¿‡æ¡†æ¶ä¹‹é—´çš„é›†æˆæ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ª DataSourceï¼Œè¿™ä¸ª DataSource å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨ ShardingSphere çš„å…¥å£ã€‚æˆ‘ä»¬ä¹Ÿçœ‹åˆ°åœ¨åˆ›å»º DataSource çš„è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°äº†ä¸€ä¸ª ShardingDataSourceFactory ç±»ï¼Œè¿™ä¸ªå·¥å‚ç±»çš„æ„é€ å‡½æ•°ä¸­éœ€è¦ä¼ å…¥ä¸€ä¸ª ShardingRuleConfiguration å¯¹è±¡ã€‚æ˜¾ç„¶ï¼Œä»å‘½åä¸Šçœ‹ï¼Œè¿™ä¸ª ShardingRuleConfiguration å°±æ˜¯ç”¨äºåˆ†ç‰‡è§„åˆ™çš„é…ç½®å…¥å£ã€‚</p>
<p>ShardingRuleConfiguration ä¸­æ‰€éœ€è¦é…ç½®çš„è§„åˆ™æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€å¼ å›¾ä¾‹æ¥è¿›è¡Œç®€å•è¯´æ˜ï¼Œåœ¨è¿™å¼ å›¾ä¸­ï¼Œæˆ‘ä»¬åˆ—ä¸¾äº†æ¯ä¸ªé…ç½®é¡¹çš„åç§°ã€ç±»å‹ä»¥åŠä¸ªæ•°å…³ç³»ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F75rTaADRO6AAD5MCLrohA562.png" alt="image"></p>
<p>è¿™é‡Œå¼•å…¥äº†ä¸€äº›æ–°çš„æ¦‚å¿µï¼ŒåŒ…æ‹¬ç»‘å®šè¡¨ã€å¹¿æ’­è¡¨ç­‰ï¼Œè¿™äº›æ¦‚å¿µåœ¨ä¸‹ä¸€è¯¾æ—¶ä»‹ç»åˆ° ShardingSphere çš„åˆ†åº“åˆ†è¡¨æ“ä½œæ—¶éƒ½ä¼šè¯¦ç»†å±•å¼€ï¼Œè¿™é‡Œä¸åšå…·ä½“ä»‹ç»ã€‚<strong>äº‹å®ä¸Šï¼Œå¯¹äº ShardingRuleConfiguration è€Œè¨€ï¼Œå¿…é¡»è¦è®¾ç½®çš„åªæœ‰ä¸€ä¸ªé…ç½®é¡¹ï¼Œå³ TableRuleConfigurationã€‚</strong></p>
<h4 id="tableruleconfiguration">TableRuleConfiguration</h4>
<p>ä»å‘½åä¸Šçœ‹ï¼ŒTableRuleConfiguration æ˜¯è¡¨åˆ†ç‰‡è§„åˆ™é…ç½®ï¼Œä½†äº‹å®ä¸Šï¼Œè¿™ä¸ªç±»åŒæ—¶åŒ…å«äº†å¯¹åˆ†åº“å’Œåˆ†è¡¨ä¸¤ç§åœºæ™¯çš„è®¾ç½®ã€‚TableRuleConfiguration åŒ…å«å¾ˆå¤šé‡è¦çš„é…ç½®é¡¹ï¼š</p>
<ul>
<li>actualDataNodes</li>
</ul>
<p>actualDataNodes ä»£è¡¨çœŸå®çš„æ•°æ®èŠ‚ç‚¹ï¼Œç”±æ•°æ®æºå+è¡¨åç»„æˆï¼Œæ”¯æŒè¡Œè¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼Œå‰é¢ä»‹ç»çš„&quot;ds${0..1}.user${0..1}&ldquo;å°±æ˜¯æ¯”è¾ƒå…¸å‹çš„ä¸€ç§é…ç½®æ–¹å¼ã€‚</p>
<ul>
<li>databaseShardingStrategyConfig</li>
</ul>
<p>databaseShardingStrategyConfig ä»£è¡¨åˆ†åº“ç­–ç•¥ï¼Œå¦‚æœä¸è®¾ç½®åˆ™ä½¿ç”¨é»˜è®¤åˆ†åº“ç­–ç•¥ï¼Œè¿™é‡Œçš„é»˜è®¤åˆ†åº“ç­–ç•¥å°±æ˜¯ ShardingRuleConfiguration ä¸­çš„ defaultDatabaseShardingStrategyConfig é…ç½®ã€‚</p>
<ul>
<li>tableShardingStrategyConfig</li>
</ul>
<p>å’Œ databaseShardingStrategyConfig ä¸€æ ·ï¼ŒtableShardingStrategyConfig ä»£è¡¨åˆ†è¡¨ç­–ç•¥ï¼Œå¦‚æœä¸è®¾ç½®ä¹Ÿä¼šä½¿ç”¨é»˜è®¤åˆ†è¡¨ç­–ç•¥ï¼Œè¿™é‡Œçš„é»˜è®¤åˆ†è¡¨ç­–ç•¥åŒæ ·æ¥è‡ª ShardingRuleConfiguration ä¸­çš„ defaultTableShardingStrategyConfig é…ç½®ã€‚</p>
<ul>
<li>keyGeneratorConfig</li>
</ul>
<p>keyGeneratorConfig ä»£è¡¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„è‡ªå¢åˆ—ç”Ÿæˆå™¨é…ç½®ï¼ŒShardingSphere ä¸­é›†æˆäº†é›ªèŠ±ç®—æ³•ç­‰åˆ†å¸ƒå¼ ID çš„ç”Ÿæˆå™¨å®ç°ã€‚</p>
<h4 id="shardingstrategyconfiguration">ShardingStrategyConfiguration</h4>
<p>æˆ‘ä»¬æ³¨æ„åˆ°ï¼ŒdatabaseShardingStrategyConfig å’Œ tableShardingStrategyConfig çš„ç±»å‹éƒ½æ˜¯ä¸€ä¸ª ShardingStrategyConfiguration å¯¹è±¡ã€‚åœ¨ ShardingSphere ä¸­ï¼ŒShardingStrategyConfiguration å®é™…ä¸Šæ˜¯ä¸€ä¸ªç©ºæ¥å£ï¼Œå­˜åœ¨ä¸€ç³»åˆ—çš„å®ç°ç±»ï¼Œå…¶ä¸­çš„æ¯ä¸ªå®ç°ç±»éƒ½ä»£è¡¨ä¸€ç§åˆ†ç‰‡ç­–ç•¥ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl75rUiACYZ1AAA8JV6ve54396.png" alt="3.png"> ã€€ShardingStrategyConfiguration çš„ç±»å±‚ç»“æ„å›¾</p>
<p>åœ¨è¿™äº›å…·ä½“çš„åˆ†ç‰‡ç­–ç•¥ä¸­ï¼Œé€šå¸¸éœ€è¦æŒ‡å®šä¸€ä¸ªåˆ†ç‰‡åˆ— shardingColumn ä»¥åŠä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç‰‡ç®—æ³• ShardingAlgorithmã€‚å½“ç„¶ä¹Ÿæœ‰ä¾‹å¤–ï¼Œä¾‹å¦‚ HintShardingStrategyConfiguration ç›´æ¥ä½¿ç”¨æ•°æ®åº“çš„ Hint æœºåˆ¶å®ç°å¼ºåˆ¶è·¯ç”±ï¼Œæ‰€ä»¥ä¸éœ€è¦åˆ†ç‰‡åˆ—ã€‚æˆ‘ä»¬ä¼šåœ¨ã€Šè·¯ç”±å¼•æ“ï¼šå¦‚ä½•åœ¨è·¯ç”±è¿‡ç¨‹ä¸­é›†æˆå¤šç§åˆ†ç‰‡ç­–ç•¥å’Œåˆ†ç‰‡ç®—æ³•ï¼Ÿã€‹ä¸­å¯¹è¿™äº›ç­–ç•¥çš„å®ç°è¿‡ç¨‹åšè¯¦ç»†çš„å‰–æã€‚</p>
<h4 id="keygeneratorconfiguration">KeyGeneratorConfiguration</h4>
<p>å¯ä»¥æƒ³è±¡ï¼Œå¯¹äºä¸€ä¸ªè‡ªå¢åˆ—è€Œè¨€ï¼ŒKeyGeneratorConfiguration ä¸­é¦–å…ˆéœ€è¦æŒ‡å®šä¸€ä¸ªåˆ—å columnã€‚åŒæ—¶ï¼Œå› ä¸º ShardingSphere ä¸­å†…ç½®äº†ä¸€æ‰¹è‡ªå¢åˆ—çš„å®ç°æœºåˆ¶ï¼ˆä¾‹å¦‚é›ªèŠ±ç®—æ³• SNOWFLAKE ä»¥åŠé€šç”¨å”¯ä¸€è¯†åˆ«ç  UUIDï¼‰ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡ä¸€ä¸ª type é…ç½®é¡¹è¿›è¡ŒæŒ‡å®šã€‚æœ€åï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Properties é…ç½®é¡¹æ¥æŒ‡å®šè‡ªå¢å€¼ç”Ÿæˆè¿‡ç¨‹ä¸­æ‰€éœ€è¦çš„ç›¸å…³å±æ€§é…ç½®ã€‚å…³äºè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åœ¨ä¸Šä¸€è¯¾æ—¶ä¸­ä¹Ÿçœ‹åˆ°äº†ç¤ºä¾‹ï¼Œå³é›ªèŠ±ç®—æ³•ä¸­é…ç½® workerId ä¸º 33ã€‚</p>
<p>åŸºäºä»¥ä¸Šæ ¸å¿ƒé…ç½®é¡¹ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®Œæˆæ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­å¸¸è§çš„åˆ†åº“åˆ†è¡¨æ“ä½œã€‚å½“ç„¶ï¼Œå¯¹äºä¸åŒçš„å¼€å‘äººå‘˜ï¼Œå¦‚ä½•é‡‡ç”¨æŸä¸€ä¸ªç‰¹å®šçš„æ–¹å¼å°†è¿™äº›é…ç½®é¡¹ä¿¡æ¯é›†æˆåˆ°ä¸šåŠ¡ä»£ç ä¸­ï¼Œä¹Ÿå­˜åœ¨ç€ä¸åŒçš„è¯‰æ±‚ã€‚å› æ­¤ï¼ŒShardingSphere ä¸­ä¹Ÿæä¾›äº†ä¸€ç³»åˆ—çš„é…ç½®æ–¹å¼ä¾›å¼€å‘äººå‘˜è¿›è¡Œé€‰æ‹©ã€‚</p>
<h3 id="shardingsphere-æä¾›äº†å“ªäº›é…ç½®æ–¹å¼">ShardingSphere æä¾›äº†å“ªäº›é…ç½®æ–¹å¼ï¼Ÿ</h3>
<p>ä» Java ä»£ç åˆ°é…ç½®æ–‡ä»¶ï¼ŒShardingSphere æä¾›äº† 4 ç§é…ç½®æ–¹å¼ï¼Œç”¨äºä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>Java ä»£ç é…ç½®</li>
<li>Yaml é…ç½®</li>
<li>Spring å‘½åç©ºé—´é…ç½®</li>
<li>Spring Booté…ç½®</li>
</ul>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™å››ç§é…ç½®çš„å…·ä½“æ–¹æ³•ã€‚</p>
<h4 id="java-ä»£ç é…ç½®">Java ä»£ç é…ç½®</h4>
<p>Java ä»£ç é…ç½®æ˜¯ä½¿ç”¨ ShardingSphere æ‰€æä¾›çš„åº•å±‚ API æ¥å®Œæˆé…ç½®ç³»ç»Ÿæ„å»ºçš„åŸå§‹æ–¹å¼ã€‚åœ¨ä¸Šä¸€è¯¾æ—¶ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•åˆå§‹åŒ– ShardingRuleConfiguration å’Œ TableRuleConfiguration ç±»ï¼Œå¹¶é€šè¿‡ ShardingDataSourceFactory åˆ›å»ºç›®æ ‡ DataSource çš„å…·ä½“æ–¹å¼ï¼Œè¿™é‡Œä¸å†å±•å¼€ã€‚</p>
<p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šç›´æ¥ä½¿ç”¨ Java ä»£ç æ¥å®Œæˆ ShardingSphere é…ç½®ä½“ç³»çš„æ„å»ºã€‚ä¸€æ–¹é¢ï¼Œå¦‚æœä½¿ç”¨ Java ä»£ç æ¥å®ç°é…ç½®ï¼Œä¸€æ—¦æœ‰å˜åŠ¨å°±éœ€è¦é‡æ–°ç¼–è¯‘ä»£ç å¹¶å‘å¸ƒï¼Œä¸åˆ©äºå®ç°é…ç½®ä¿¡æ¯çš„åŠ¨æ€åŒ–ç®¡ç†å’Œç³»ç»Ÿçš„æŒç»­é›†æˆã€‚å¦ä¸€æ–¹é¢ï¼Œä»£ç çº§åˆ«çš„é…ç½®æ–¹å¼ä¹Ÿæ¯”è¾ƒç¹çï¼Œä¸å¤Ÿç›´æ¥ä¸”å®¹æ˜“å‡ºé”™ï¼Œç»´æŠ¤æ€§ä¹Ÿä¸å¥½ã€‚</p>
<p>å½“ç„¶ï¼Œä¹Ÿå¯èƒ½æœ‰ä¾‹å¤–æƒ…å†µã€‚ä¸€ç§æƒ…å†µæ˜¯ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å’Œå…¶ä»–æ¡†æ¶è¿›è¡Œæ›´åŠ åº•å±‚çš„é›†æˆæˆ–å®šåˆ¶åŒ–å¼€å‘æ—¶ï¼Œå¾€å¾€åªèƒ½é‡‡ç”¨ Java ä»£ç æ‰èƒ½è¾¾åˆ°ç†æƒ³çš„æ•ˆæœã€‚åŒæ—¶ï¼Œå¯¹äºåˆšæ¥è§¦ ShardingSphere çš„å¼€å‘äººå‘˜è€Œè¨€ï¼ŒåŸºäºæ¡†æ¶æä¾›çš„ API è¿›è¡Œå¼€å‘æ›´åŠ æœ‰åˆ©äºå¿«é€ŸæŒæ¡æ¡†æ¶æä¾›çš„å„ç§ç±»ä¹‹é—´çš„å…³è”å…³ç³»å’Œç±»å±‚ç»“æ„ã€‚</p>
<h4 id="yaml-é…ç½®">Yaml é…ç½®</h4>
<p>Yaml é…ç½®æ˜¯ ShardingSphere æ‰€æ¨å´‡çš„ä¸€ç§é…ç½®æ–¹å¼ã€‚Yaml çš„è¯­æ³•å’Œå…¶ä»–é«˜çº§è¯­è¨€ç±»ä¼¼ï¼Œå¹¶ä¸”å¯ä»¥éå¸¸ç›´è§‚åœ°æè¿°å¤šå±‚åˆ—è¡¨å’Œå¯¹è±¡ç­‰æ•°æ®å½¢æ€ï¼Œç‰¹åˆ«é€‚åˆç”¨æ¥è¡¨ç¤ºæˆ–ç¼–è¾‘æ•°æ®ç»“æ„å’Œå„ç§é…ç½®æ–‡ä»¶ã€‚</p>
<p>åœ¨è¯­æ³•ä¸Šï¼Œå¸¸è§çš„&rdquo;!!&ldquo;è¡¨ç¤ºå®ä¾‹åŒ–è¯¥ç±»ï¼›ä»¥&rdquo;-&ldquo;å¼€å¤´çš„å¤šè¡Œæ„æˆä¸€ä¸ªæ•°ç»„ï¼›ä»¥&rdquo;:&ldquo;è¡¨ç¤ºé”®å€¼å¯¹ï¼›ä»¥&rdquo;#&ldquo;è¡¨ç¤ºæ³¨é‡Šã€‚å…³äº Yaml è¯­æ³•çš„æ›´å¤šä»‹ç»å¯ä»¥å‚è€ƒç™¾åº¦ç™¾ç§‘ <a href="https://baike.baidu.com/item/YAML">https://baike.baidu.com/item/YAML</a>ã€‚<strong>è¯·æ³¨æ„ï¼ŒYaml å¤§å°å†™æ•æ„Ÿï¼Œå¹¶ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»ã€‚</strong> è¿™é‡Œç»™å‡ºä¸€ä¸ªåŸºäº ShardingSphere å®ç°è¯»å†™åˆ†ç¦»åœºæ™¯ä¸‹çš„é…ç½®æ¡ˆä¾‹ï¼š</p>
<pre tabindex="0"><code>dataSources:
  dsmaster: !!com.alibaba.druid.pool.DruidDataSource
    driverClassName: com.mysql.jdbc.Driver
    url: jdbc:mysql://119.3.52.175:3306/dsmaster
    username: root
    password: root
  dsslave0: !!com.alibaba.druid.pool.DruidDataSource
    driverClassName: com.mysql.jdbc.Driver
    url: jdbc:mysql://119.3.52.175:3306/dsslave0
    username: root
    password: root
  dsslave1: !!com.alibaba.druid.pool.DruidDataSource
    driverClassName: com.mysql.jdbc.Driver
    url: jdbc:mysql://119.3.52.175:3306/dsslave1
    username: root
    password: root 
masterSlaveRule:
  name: health_ms
  masterDataSourceName: dsmaster
  slaveDataSourceNames: [dsslave0, dsslave1]
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œé…ç½®äº† dsmasterã€dsslave0 å’Œ dsslave1 è¿™ä¸‰ä¸ª DataSourceï¼Œç„¶åé’ˆå¯¹æ¯ä¸ª DataSource åˆ†åˆ«è®¾ç½®äº†å®ƒä»¬çš„é©±åŠ¨ä¿¡æ¯ã€‚æœ€åï¼ŒåŸºäºè¿™ä¸‰ä¸ª DataSource é…ç½®äº†ä¸€ä¸ª masterSlaveRule è§„åˆ™ï¼Œç”¨äºæŒ‡å®šå…·ä½“çš„ä¸»ä»æ¶æ„ã€‚</p>
<p>åœ¨ ShardingSphere ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠé…ç½®ä¿¡æ¯å­˜æ”¾åœ¨ä¸€ä¸ª .yaml é…ç½®æ–‡ä»¶ä¸­ï¼Œå¹¶é€šè¿‡åŠ è½½è¿™ä¸ªé…ç½®æ–‡ä»¶æ¥å®Œæˆé…ç½®ä¿¡æ¯çš„è§£æã€‚è¿™ç§æœºåˆ¶ä¸ºå¼€å‘äººå‘˜é«˜æ•ˆç®¡ç†é…ç½®ä¿¡æ¯æä¾›äº†æ›´å¤šçš„çµæ´»æ€§å’Œå¯å®šåˆ¶æ€§ã€‚åœ¨ä»Šå¤©å†…å®¹çš„æœ€åï¼Œæˆ‘ä»¬ä¼šè¯¦ç»†å‰–æè¿™ä¸€æœºåˆ¶çš„å®ç°åŸç†ã€‚</p>
<h4 id="spring-å‘½åç©ºé—´é…ç½®">Spring å‘½åç©ºé—´é…ç½®</h4>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰é…ç½®æ ‡ç­¾å®ç°æ–¹æ¡ˆæ¥æ‰©å±• Spring çš„å‘½åç©ºé—´ï¼Œä»è€Œåœ¨ Spring ä¸­åµŒå…¥å„ç§è‡ªå®šä¹‰çš„é…ç½®é¡¹ã€‚Spring æ¡†æ¶ä» 2.0 ç‰ˆæœ¬å¼€å§‹æä¾›äº†åŸºäº XML Schema çš„é£æ ¼æ¥å®šä¹‰ Javabean çš„æ‰©å±•æœºåˆ¶ã€‚é€šè¿‡ XML Schema çš„å®šä¹‰ï¼ŒæŠŠä¸€äº›åŸæœ¬éœ€è¦é€šè¿‡å¤æ‚çš„ Javabean ç»„åˆå®šä¹‰çš„é…ç½®å½¢å¼ï¼Œç”¨ä¸€ç§æ›´åŠ ç®€å•è€Œå¯è¯»çš„æ–¹å¼å‘ˆç°å‡ºæ¥ã€‚åŸºäº Scheme çš„ XML ç”±ä¸‰éƒ¨åˆ†æ„æˆï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªç¤ºä¾‹è¯´æ˜ï¼š</p>
<pre tabindex="0"><code>&lt;master-slave:load-balance-algorithm id=&quot;randomStrategy&quot;/&gt;
</code></pre><p>è¿™æ®µ XML ä¸­ï¼Œmaster-slave æ˜¯å‘½åç©ºé—´ï¼Œä»è¿™ä¸ªå‘½åç©ºé—´ä¸­å¯ä»¥æ˜ç¡®åœ°åŒºåˆ†å‡ºæ‰€å±çš„é€»è¾‘åˆ†ç±»æ˜¯ç”¨äºå®ç°è¯»å†™åˆ†ç¦»ï¼›load-balance-algorithm æ˜¯ä¸€ç§å…ƒç´ ï¼Œä»£è¡¨ç”¨äºè®¾ç½®è¯»å†™åˆ†ç¦»ä¸­çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼›è€Œ ID å°±æ˜¯è´Ÿè½½å‡è¡¡ä¸‹çš„ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œå®ƒçš„å€¼ä¸ºéšæœºç­–ç•¥ randomStrategyã€‚</p>
<p>åœ¨ ShardingSphere ä¸­ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥åŸºäºå‘½åç©ºé—´æ¥å®ç°å®Œæ•´çš„è¯»å†™åˆ†ç¦»é…ç½®ï¼š</p>
<pre tabindex="0"><code>&lt;beans
    ...
    http://shardingsphere.apache.org/schema/shardingsphere/masterslave
    http://shardingsphere.apache.org/schema/shardingsphere/masterslave/master-slave.xsd&quot;&gt; 
&lt;bean id=&quot; dsmaster &quot; class=&quot; com.alibaba.druid.pool.DruidDataSource&quot; destroy-method=&quot;close&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;
        &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/dsmaster&quot;/&gt;
        &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;
        &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;
    &lt;/bean&gt;

    &lt;bean id=&quot;dsslave0&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot; destroy-method=&quot;close&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;
        &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/dsslave0&quot;/&gt;
        &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;
        &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;
    &lt;/bean&gt;

   &lt;bean id=&quot;dsslave1&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot; destroy-method=&quot;close&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;
        &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/dsslave1&quot;/&gt;
        &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;
        &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;
    &lt;/bean&gt; 
    &lt;master-slave:load-balance-algorithm id=&quot;randomStrategy&quot; type=&quot;RANDOM&quot; /&gt;
    &lt;master-slave:data-source id=&quot;masterSlaveDataSource&quot; master-data-source-name=&quot;dsmaster&quot; slave-data-source-names=&quot;dsslave0, dsslave1&quot; strategy-ref=&quot;randomStrategy&quot; /&gt;

&lt;/beans&gt;
</code></pre><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨ Spring ä¸­å¼•å…¥äº† master-slave è¿™ä¸ªæ–°çš„å‘½åç©ºé—´ï¼Œå¹¶å®Œæˆäº†è´Ÿè½½å‡è¡¡ç®—æ³•å’Œä¸‰ä¸ªä¸»ä» DataSource çš„è®¾ç½®ã€‚</p>
<h4 id="spring-boot-é…ç½®">Spring Boot é…ç½®</h4>
<p>Spring Boot å·²ç»æˆä¸º Java é¢†åŸŸæœ€æµè¡Œçš„å¼€å‘æ¡†æ¶ï¼Œæä¾›äº†çº¦å®šä¼˜äºé…ç½®çš„è®¾è®¡ç†å¿µã€‚é€šå¸¸ï¼Œå¼€å‘äººå‘˜å¯ä»¥æŠŠé…ç½®é¡¹æ”¾åœ¨ application.properties æ–‡ä»¶ä¸­ã€‚åŒæ—¶ï¼Œä¸ºäº†ä¾¿äºå¯¹é…ç½®ä¿¡æ¯è¿›è¡Œç®¡ç†å’Œç»´æŠ¤ï¼ŒSpring Boot ä¹Ÿæä¾›äº† profile çš„æ¦‚å¿µï¼Œå¯ä»¥åŸºäº profile æ¥çµæ´»ç»„ç»‡é¢å¯¹ä¸åŒç¯å¢ƒæˆ–åº”ç”¨åœºæ™¯çš„é…ç½®ä¿¡æ¯ã€‚åœ¨é‡‡ç”¨ profile æ—¶ï¼Œé…ç½®æ–‡ä»¶çš„å‘½åæ–¹å¼æœ‰ä¸€å®šçš„çº¦å®šï¼š</p>
<pre tabindex="0"><code>{application}-{profile}.properties
</code></pre><p>åŸºäºè¿™ç§å‘½åçº¦å®šï¼Œå¦‚æœæˆ‘ä»¬æ ¹æ®é¢å‘çš„æ˜¯ä¼ ç»Ÿçš„å•åº“å•è¡¨åœºæ™¯ï¼Œè¿˜æ˜¯ä¸»ä»æ¶æ„çš„è¯»å†™åˆ†ç¦»åœºæ™¯è¿›è¡Œå‘½åï¼Œå°±éœ€è¦åˆ†åˆ«æä¾›ä¸¤ä¸ªä¸åŒçš„ .properties é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>application-traditional.properties
application-master-slave.properties
</code></pre><p>è¿™ä¸¤ä¸ªæ–‡ä»¶åä¸­çš„ traditional å’Œ master-slave å°±æ˜¯å…·ä½“çš„ profileï¼Œç°åœ¨åœ¨ application.properties æ–‡ä»¶ä¸­å°±å¯ä»¥ä½¿ç”¨ spring.profiles.active é…ç½®é¡¹æ¥è®¾ç½®å½“å‰æ‰€ä½¿ç”¨çš„ profileï¼š</p>
<pre tabindex="0"><code>#spring.profiles.active=traditional
spring.profiles.active=master-slave
</code></pre><p>åŸºäº Spring Boot çš„é…ç½®é£æ ¼å°±æ˜¯ä¸€ç»„é”®å€¼å¯¹ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼æ¥å®ç°å‰é¢ä»‹ç»çš„è¯»å†™åˆ†ç¦»é…ç½®ï¼š</p>
<pre tabindex="0"><code>spring.shardingsphere.datasource.names=dsmaster,dsslave0,dsslave1 
spring.shardingsphere.datasource.dsmaster.type=com.alibaba.druid.pool.DruidDataSource
spring.shardingsphere.datasource.dsmaster.driver-class-name=com.mysql.jdbc.Driver
spring.shardingsphere.datasource.dsmaster.url=jdbc:mysql://localhost:3306/dsmaster
spring.shardingsphere.datasource.dsmaster.username=root
spring.shardingsphere.datasource.dsmaster.password=root 
spring.shardingsphere.datasource.dsslave0.type=com.alibaba.druid.pool.DruidDataSource
spring.shardingsphere.datasource.dsslave0.driver-class-name=com.mysql.jdbc.Driver
spring.shardingsphere.datasource.dsslave0.url=jdbc:mysql://localhost:3306/dsslave0
spring.shardingsphere.datasource.dsslave0.username=root
spring.shardingsphere.datasource.dsslave0.password=root 
spring.shardingsphere.datasource.dsslave1.type=com.alibaba.druid.pool.DruidDataSource
spring.shardingsphere.datasource.dsslave1.driver-class-name=com.mysql.jdbc.Driver
spring.shardingsphere.datasource.dsslave1.url=jdbc:mysql://localhost:3306/dsslave1
spring.shardingsphere.datasource.dsslave1.username=root
spring.shardingsphere.datasource.dsslave1.password=root 
spring.shardingsphere.masterslave.load-balance-algorithm-type=random
spring.shardingsphere.masterslave.name=health_ms
spring.shardingsphere.masterslave.master-data-source-name=dsmaster
spring.shardingsphere.masterslave.slave-data-source-names=dsslave0,dsslave1
</code></pre><p>é€šè¿‡è¿™äº›ä¸åŒçš„é…ç½®æ–¹å¼ï¼Œå¼€å‘äººå‘˜å¯ä»¥åŸºäºè‡ªå·±æ“…é•¿çš„æˆ–å¼€å‘æ¡†æ¶æ‰€è¦æ±‚çš„æ–¹å¼ï¼Œçµæ´»å®Œæˆå„é¡¹é…ç½®å·¥ä½œã€‚åœ¨æœ¬è¯¾ç¨‹ä¸­çš„åç»­å†…å®¹ä¸­ï¼Œæˆ‘ä»¬ä¼šç»„åˆä½¿ç”¨ Yaml é…ç½®å’Œ Spring Boot é…ç½®è¿™ä¸¤ç§é…ç½®æ–¹å¼æ¥ä»‹ç» ShardingSphere çš„å…·ä½“ä½¿ç”¨æ–¹å¼ã€‚</p>
<h3 id="shardingsphere-çš„é…ç½®ä½“ç³»æ˜¯å¦‚ä½•å®ç°çš„">ShardingSphere çš„é…ç½®ä½“ç³»æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h3>
<p>å°½ç®¡åœ¨æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­å¾ˆå°‘ä½¿ç”¨ï¼Œä½†åœ¨å‰é¢ä»‹ç»çš„å››ç§é…ç½®æ–¹å¼ä¸­ï¼ŒJava ä»£ç é…ç½®çš„å®ç°æ–¹å¼æœ€å®¹æ˜“ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å„ä¸ªé…ç½®ç±»çš„è°ƒç”¨å…³ç³»æ¥æ¢³ç† ShardingSphere æä¾›çš„é…ç½®åŠŸèƒ½ã€‚æ‰€ä»¥ï¼Œä¸ºäº†æ·±å…¥ç†è§£é…ç½®ä½“ç³»çš„å®ç°åŸç†ï¼Œæˆ‘ä»¬è¿˜æ˜¯é€‰æ‹©ä» ShardingRuleConfiguration ç±»è¿›è¡Œåˆ‡å…¥ã€‚</p>
<h4 id="shardingruleconfiguration-é…ç½®ä½“ç³»">ShardingRuleConfiguration é…ç½®ä½“ç³»</h4>
<p>å¯¹äº ShardingSphere è€Œè¨€ï¼Œé…ç½®ä½“ç³»çš„ä½œç”¨æœ¬è´¨ä¸Šå°±æ˜¯ç”¨æ¥åˆå§‹åŒ– DataSource ç­‰ JDBC å¯¹è±¡ã€‚ä¾‹å¦‚ï¼ŒShardingDataSourceFactory å°±æ˜¯åŸºäºä¼ å…¥çš„æ•°æ®æº Mapã€ShardingRuleConfiguration ä»¥åŠ Properties æ¥åˆ›å»ºä¸€ä¸ª ShardingDataSource å¯¹è±¡ï¼š</p>
<pre tabindex="0"><code>public final class ShardingDataSourceFactory {

    public static DataSource createDataSource(
            final Map&lt;String, DataSource&gt; dataSourceMap, final ShardingRuleConfiguration shardingRuleConfig, final Properties props) throws SQLException {
        return new ShardingDataSource(dataSourceMap, new ShardingRule(shardingRuleConfig, dataSourceMap.keySet()), props);
} 
}
</code></pre><p>åœ¨ ShardingSphere ä¸­ï¼Œæ‰€æœ‰è§„åˆ™é…ç½®ç±»éƒ½å®ç°äº†ä¸€ä¸ªé¡¶å±‚æ¥å£ RuleConfigurationã€‚RuleConfiguration æ˜¯ä¸€ä¸ªç©ºæ¥å£ï¼ŒShardingRuleConfiguration å°±æ˜¯è¿™ä¸ªæ¥å£çš„å®ç°ç±»ä¹‹ä¸€ï¼Œä¸“é—¨ç”¨æ¥å¤„ç†åˆ†ç‰‡å¼•æ“çš„åº”ç”¨åœºæ™¯ã€‚ä¸‹é¢è¿™æ®µä»£ç å°±æ˜¯ ShardingRuleConfiguration ç±»çš„å®ç°è¿‡ç¨‹ï¼š</p>
<pre tabindex="0"><code>public final class ShardingRuleConfiguration implements RuleConfiguration {
    //è¡¨åˆ†ç‰‡è§„åˆ™åˆ—è¡¨
    private Collection&lt;TableRuleConfiguration&gt; tableRuleConfigs = new LinkedList&lt;&gt;();
    //ç»‘å®šè¡¨è§„åˆ™åˆ—è¡¨
    private Collection&lt;String&gt; bindingTableGroups = new LinkedList&lt;&gt;();
    //å¹¿æ’­è¡¨è§„åˆ™åˆ—è¡¨
    private Collection&lt;String&gt; broadcastTables = new LinkedList&lt;&gt;();
    //é»˜è®¤æ•°æ®æº
    private String defaultDataSourceName;
    //é»˜è®¤åˆ†åº“ç­–ç•¥
    private ShardingStrategyConfiguration defaultDatabaseShardingStrategyConfig;
    //é»˜è®¤åˆ†è¡¨ç­–ç•¥
    private ShardingStrategyConfiguration defaultTableShardingStrategyConfig;
    //é»˜è®¤è‡ªå¢åˆ—å€¼ç”Ÿæˆå™¨
    private KeyGeneratorConfiguration defaultKeyGeneratorConfig;
    //è¯»å†™åˆ†ç¦»è§„åˆ™
    private Collection&lt;MasterSlaveRuleConfiguration&gt; masterSlaveRuleConfigs = new LinkedList&lt;&gt;();
    //æ•°æ®è„±æ•è§„åˆ™
    private EncryptRuleConfiguration encryptRuleConfig;
}
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒShardingRuleConfiguration ä¸­åŒ…å«çš„å°±æ˜¯ä¸€ç³»åˆ—çš„é…ç½®ç±»å®šä¹‰ï¼Œé€šè¿‡å‰é¢çš„å†…å®¹ä»‹ç»ï¼Œæˆ‘ä»¬å·²ç»æ˜ç™½äº†è¿™äº›é…ç½®ç±»çš„ä½œç”¨å’Œä½¿ç”¨æ–¹æ³•ã€‚å…¶ä¸­ï¼Œæ ¸å¿ƒçš„ TableRuleConfiguration å®šä¹‰ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŒ…å«äº†é€»è¾‘è¡¨ã€çœŸå®æ•°æ®èŠ‚ç‚¹ä»¥åŠåˆ†åº“ç­–ç•¥å’Œåˆ†è¡¨ç­–ç•¥çš„å®šä¹‰ï¼š</p>
<pre tabindex="0"><code>public final class TableRuleConfiguration {
    //é€»è¾‘è¡¨
    private final String logicTable;
    //çœŸå®æ•°æ®èŠ‚ç‚¹
    private final String actualDataNodes;
    //åˆ†åº“ç­–ç•¥
    private ShardingStrategyConfiguration databaseShardingStrategyConfig;
    //åˆ†è¡¨ç­–ç•¥
    private ShardingStrategyConfiguration tableShardingStrategyConfig;
    //è‡ªå¢åˆ—ç”Ÿæˆå™¨
    private KeyGeneratorConfiguration keyGeneratorConfig;

    public TableRuleConfiguration(final String logicTable) {
        this(logicTable, null);
    }

    public TableRuleConfiguration(final String logicTable, final String actualDataNodes) {
        Preconditions.checkArgument(!Strings.isNullOrEmpty(logicTable), &quot;LogicTable is required.&quot;);
        this.logicTable = logicTable;
        this.actualDataNodes = actualDataNodes;
    }
}
</code></pre><p>å› ä¸ºç¯‡å¹…æœ‰é™ï¼Œæˆ‘ä»¬ä¸å¯¹å…¶ä»–é…ç½®ç±»çš„å®šä¹‰åšå…·ä½“å±•å¼€ã€‚äº‹å®ä¸Šï¼Œæ— è®ºé‡‡ç”¨å“ªç§é…ç½®æ–¹å¼ï¼Œæ‰€æœ‰çš„é…ç½®é¡¹éƒ½æ˜¯åœ¨è¿™äº›æ ¸å¿ƒé…ç½®ç±»çš„åŸºç¡€ä¹‹ä¸Šè¿›è¡Œå°è£…å’Œè½¬æ¢ã€‚åŸºäº Spring å‘½åç©ºé—´å’Œ Spring Boot é…ç½®çš„ä½¿ç”¨æ–¹å¼æ¯”è¾ƒå¸¸è§ï¼Œè¿™ä¸¤ç§æ–¹å¼çš„å®ç°åŸç†éƒ½ä¾èµ–äº ShardingSphere ä¸è¿™ä¸¤ä¸ªæ¡†æ¶çš„é›†æˆæ–¹å¼ï¼Œæˆ‘ä¼šåœ¨åç»­è¯¾æ—¶ä¸­åšè¯¦ç»†å±•å¼€ã€‚è€Œ Yaml é…ç½®æ˜¯ ShardingSphere éå¸¸æ¨å´‡çš„ä¸€ç§ä½¿ç”¨æ–¹å¼ï¼Œä¸ºæ­¤ï¼ŒShardingSphere åœ¨å†…éƒ¨å¯¹ Yaml é…ç½®çš„åº”ç”¨åœºæ™¯æœ‰ä¸“é—¨çš„å¤„ç†ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥è¯¦ç»†è§£æä¸€ä¸‹é’ˆå¯¹ Yaml é…ç½®çš„å®Œæ•´å®ç°æ–¹æ¡ˆã€‚</p>
<h4 id="yamlshardingruleconfiguration-é…ç½®ä½“ç³»">YamlShardingRuleConfiguration é…ç½®ä½“ç³»</h4>
<p>åœ¨ ShardingSphere æºç çš„ sharding-core-common å·¥ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªåŒ…ç»“æ„ org.apache.shardingsphere.core.yaml.configï¼Œåœ¨è¿™ä¸ªåŒ…ç»“æ„ä¸‹åŒ…å«ç€æ‰€æœ‰ä¸ Yaml é…ç½®ç›¸å…³çš„å®ç°ç±»ã€‚</p>
<p>ä¸ RuleConfiguration ä¸€æ ·ï¼ŒShardingSphere åŒæ ·æä¾›äº†ä¸€ä¸ªç©ºçš„ YamlConfiguration æ¥å£ã€‚è¿™ä¸ªæ¥å£çš„å®ç°ç±»éå¸¸å¤šï¼Œä½†æˆ‘ä»¬å‘ç°å…¶ä¸­åŒ…å«äº†å”¯ä¸€çš„ä¸€ä¸ªæŠ½è±¡ç±» YamlRootRuleConfigurationï¼Œæ˜¾ç„¶ï¼Œè¿™ä¸ªç±»æ˜¯ Yaml é…ç½®ä½“ç³»ä¸­çš„åŸºç¡€ç±»ã€‚ åœ¨è¿™ä¸ª YamlRootRuleConfiguration ä¸­ï¼ŒåŒ…å«ç€æ•°æ®æº Map å’Œ Propertiesï¼š</p>
<pre tabindex="0"><code>public abstract class YamlRootRuleConfiguration implements YamlConfiguration {

    private Map&lt;String, DataSource&gt; dataSources = new HashMap&lt;&gt;();

    private Properties props = new Properties();
}
</code></pre><p>åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å‘ç°å°‘äº† ShardingRuleConfiguration çš„å¯¹åº”ç±»ï¼Œå…¶å®ï¼Œè¿™ä¸ªç±»çš„å®šä¹‰åœ¨ YamlRootRuleConfiguration çš„å­ç±» YamlRootShardingConfiguration ä¸­ï¼Œå®ƒçš„ç±»å YamlShardingRuleConfiguration å°±æ˜¯åœ¨ ShardingRuleConfiguration ä¸ŠåŠ äº†ä¸€ä¸ª Yaml å‰ç¼€ï¼Œå¦‚ä¸‹é¢è¿™æ®µä»£ç æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public class YamlRootShardingConfiguration extends YamlRootRuleConfiguration {

    private YamlShardingRuleConfiguration shardingRule;
}
</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥åˆ° YamlShardingRuleConfiguration ç±»ï¼Œå‘ç°å®ƒæ‰€åŒ…å«çš„å˜é‡ä¸ ShardingRuleConfiguration ç±»ä¸­çš„å˜é‡å­˜åœ¨ä¸€è‡´å¯¹åº”å…³ç³»ï¼Œè¿™äº› Yaml é…ç½®ç±»éƒ½ä½äº org.apache.shardingsphere.core.yaml.config.sharding åŒ…ä¸­ï¼š</p>
<pre tabindex="0"><code>public class YamlShardingRuleConfiguration implements YamlConfiguration {

    private Map&lt;String, YamlTableRuleConfiguration&gt; tables = new LinkedHashMap&lt;&gt;(); 
    private Collection&lt;String&gt; bindingTables = new ArrayList&lt;&gt;(); 
    private Collection&lt;String&gt; broadcastTables = new ArrayList&lt;&gt;();
    private String defaultDataSourceName;
    private YamlShardingStrategyConfiguration defaultDatabaseStrategy;
    private YamlShardingStrategyConfiguration defaultTableStrategy;
    private YamlKeyGeneratorConfiguration defaultKeyGenerator; 
    private Map&lt;String, YamlMasterSlaveRuleConfiguration&gt; masterSlaveRules = new LinkedHashMap&lt;&gt;(); 
    private YamlEncryptRuleConfiguration encryptRule;
}
</code></pre><p>é‚£ä¹ˆè¿™ä¸ª YamlShardingRuleConfiguration æ˜¯æ€ä¹ˆæ„å»ºå‡ºæ¥çš„å‘¢ï¼Ÿè¿™å°±è¦æ¥åˆ° YamlShardingDataSourceFactory å·¥å‚ç±»ï¼Œè¿™ä¸ªå·¥å‚ç±»å®é™…ä¸Šæ˜¯å¯¹ ShardingDataSourceFactory ç±»çš„è¿›ä¸€æ­¥å°è£…ï¼Œä¸‹é¢è¿™æ®µä»£ç å°±æ¼”ç¤ºäº†è¿™ä¸€è¿‡ç¨‹ï¼š</p>
<pre tabindex="0"><code>public final class YamlShardingDataSourceFactory {

    public static DataSource createDataSource(final File yamlFile) throws SQLException, IOException {
        YamlRootShardingConfiguration config = YamlEngine.unmarshal(yamlFile, YamlRootShardingConfiguration.class);
        return ShardingDataSourceFactory.createDataSource(config.getDataSources(), new ShardingRuleConfigurationYamlSwapper().swap(config.getShardingRule()), config.getProps());
}
â€¦
}
</code></pre><p>å¯ä»¥çœ‹åˆ° createDataSource æ–¹æ³•çš„è¾“å…¥å‚æ•°æ˜¯ä¸€ä¸ª File å¯¹è±¡ï¼Œæˆ‘ä»¬é€šè¿‡è¿™ä¸ª File å¯¹è±¡æ„å»ºå‡º YamlRootShardingConfiguration å¯¹è±¡ï¼Œç„¶åå†é€šè¿‡ YamlRootShardingConfiguration å¯¹è±¡è·å–äº† ShardingRuleConfiguration å¯¹è±¡ï¼Œå¹¶äº¤ç”± ShardingDataSourceFactory å®Œæˆç›®æ ‡ DataSource çš„æ„å»ºã€‚è¿™é‡Œçš„è°ƒç”¨å…³ç³»æœ‰ç‚¹å¤æ‚ï¼Œæˆ‘ä»¬æ¥æ¢³ç†æ•´ä¸ªè¿‡ç¨‹çš„ç±»å±‚ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F75rqaAGL8qAABR8QxogB0683.png" alt="image"></p>
<p>æ˜¾ç„¶ï¼Œè¿™é‡Œå¼•å…¥äº†ä¸¤ä¸ªæ–°çš„å·¥å…·ç±»ï¼ŒYamlEngine å’Œ YamlSwapperã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ƒä»¬åœ¨æ•´ä¸ªæµç¨‹ä¸­èµ·åˆ°çš„ä½œç”¨ã€‚</p>
<h4 id="yamlengine-å’Œ-yamlswapper">YamlEngine å’Œ YamlSwapper</h4>
<p>YamlEngine çš„ä½œç”¨æ˜¯å°†å„ç§å½¢å¼çš„è¾“å…¥å†…å®¹è½¬æ¢æˆä¸€ä¸ª Yaml å¯¹è±¡ï¼Œè¿™äº›è¾“å…¥å½¢å¼åŒ…æ‹¬ Fileã€å­—ç¬¦ä¸²ã€byte[] ç­‰ã€‚YamlEngine åŒ…å«äº†ä¸€æ‰¹ unmarshal/marshal æ–¹æ³•æ¥å®Œæˆæ•°æ®çš„è½¬æ¢ã€‚ä»¥ File è¾“å…¥ä¸ºä¾‹ï¼Œunmarshal æ–¹æ³•é€šè¿‡åŠ è½½ FileInputStream æ¥å®Œæˆ Yaml å¯¹è±¡çš„æ„å»ºï¼š</p>
<pre tabindex="0"><code>    public static &lt;T extends YamlConfiguration&gt; T unmarshal(final File yamlFile, final Class&lt;T&gt; classType) throws IOException {
        try (
                FileInputStream fileInputStream = new FileInputStream(yamlFile);
                InputStreamReader inputStreamReader = new InputStreamReader(fileInputStream, &quot;UTF-8&quot;)
        ) {
            return new Yaml(new Constructor(classType)).loadAs(inputStreamReader, classType);
        }
    }
</code></pre><p>å½“åœ¨ unmarshal æ–¹æ³•ä¸­ä¼ å…¥æƒ³è¦çš„ classType æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–è¿™ä¸ª classType å¯¹åº”çš„å®ä¾‹ã€‚åœ¨ YamlShardingDataSourceFactory ä¸­æˆ‘ä»¬ä¼ å…¥äº† YamlRootShardingConfiguration ç±»å‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å°†å¾—åˆ°ä¸€ä¸ª YamlRootShardingConfiguration çš„ç±»å®ä¾‹ YamlShardingRuleConfigurationã€‚</p>
<p>åœ¨å¾—åˆ° YamlShardingRuleConfiguration ä¹‹åï¼Œä¸‹ä¸€æ­¥éœ€è¦å®ç°å°† YamlShardingRuleConfiguration è½¬æ¢ä¸º ShardingRuleConfigurationã€‚ä¸ºäº†å®Œæˆè¿™ç§å…·æœ‰å¯¹åº”å…³ç³»çš„ç±»åœ°è½¬æ¢ï¼ŒShardingSphere è¿˜ä¸“é—¨æä¾›äº†ä¸€æ‰¹è½¬æ¢å™¨ç±»ï¼ŒShardingRuleConfigurationYamlSwapper å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚ShardingRuleConfigurationYamlSwapper å®ç°äº† YamlSwapper æ¥å£ï¼š</p>
<pre tabindex="0"><code>public interface YamlSwapper&lt;Y extends YamlConfiguration, T&gt; {
    Y swap(T data);
    T swap(Y yamlConfiguration);
}
</code></pre><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæä¾›äº†ä¸€å¯¹æ–¹æ³•å®Œæˆä¸¤ç§æ•°æ®ç»“æ„ä¹‹é—´çš„ç›¸äº’è½¬æ¢ï¼ŒShardingRuleConfigurationYamlSwapper ä¸­å¯¹è¿™ä¸¤ä¸ªæ–¹æ³•çš„å®ç°è¿‡ç¨‹ä¹Ÿæ¯”è¾ƒç›´æ¥ã€‚ä»¥ç›®æ ‡å¯¹è±¡ä¸º ShardingRuleConfiguration çš„ swap æ–¹æ³•ä¸ºä¾‹ï¼Œä»£ç ç»“æ„åŸºæœ¬ä¸Šå°±æ˜¯å®Œæˆäº† YamlShardingRuleConfiguration ä¸ ShardingRuleConfiguration ä¸­å¯¹åº”å­—æ®µçš„ä¸€å¯¹ä¸€è½¬æ¢ï¼š</p>
<pre tabindex="0"><code>@Override
    public ShardingRuleConfiguration swap(final YamlShardingRuleConfiguration yamlConfiguration) {
        ShardingRuleConfiguration result = new ShardingRuleConfiguration();
        for (Entry&lt;String, YamlTableRuleConfiguration&gt; entry : yamlConfiguration.getTables().entrySet()) {
            YamlTableRuleConfiguration tableRuleConfig = entry.getValue();
            tableRuleConfig.setLogicTable(entry.getKey());
            result.getTableRuleConfigs().add(tableRuleConfigurationYamlSwapper.swap(tableRuleConfig));
        }
        result.setDefaultDataSourceName(yamlConfiguration.getDefaultDataSourceName());
        result.getBindingTableGroups().addAll(yamlConfiguration.getBindingTables());
        result.getBroadcastTables().addAll(yamlConfiguration.getBroadcastTables());
        if (null != yamlConfiguration.getDefaultDatabaseStrategy()) {
            result.setDefaultDatabaseShardingStrategyConfig(shardingStrategyConfigurationYamlSwapper.swap(yamlConfiguration.getDefaultDatabaseStrategy()));
        }
        if (null != yamlConfiguration.getDefaultTableStrategy()) {
            result.setDefaultTableShardingStrategyConfig(shardingStrategyConfigurationYamlSwapper.swap(yamlConfiguration.getDefaultTableStrategy()));
        }
        if (null != yamlConfiguration.getDefaultKeyGenerator()) {
            result.setDefaultKeyGeneratorConfig(keyGeneratorConfigurationYamlSwapper.swap(yamlConfiguration.getDefaultKeyGenerator()));
        }
        Collection&lt;MasterSlaveRuleConfiguration&gt; masterSlaveRuleConfigs = new LinkedList&lt;&gt;();
        for (Entry&lt;String, YamlMasterSlaveRuleConfiguration&gt; entry : yamlConfiguration.getMasterSlaveRules().entrySet()) {
            YamlMasterSlaveRuleConfiguration each = entry.getValue();
            each.setName(entry.getKey());
            masterSlaveRuleConfigs.add(masterSlaveRuleConfigurationYamlSwapper.swap(entry.getValue()));
        }
        result.setMasterSlaveRuleConfigs(masterSlaveRuleConfigs);
        if (null != yamlConfiguration.getEncryptRule()) {
            result.setEncryptRuleConfig(encryptRuleConfigurationYamlSwapper.swap(yamlConfiguration.getEncryptRule()));
        }
        return result;
    }
</code></pre><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±ä»å¤–éƒ¨çš„ Yaml æ–‡ä»¶ä¸­è·å–äº†ä¸€ä¸ª ShardingRuleConfiguration å¯¹è±¡ï¼Œç„¶åå¯ä»¥ä½¿ç”¨ ShardingDataSourceFactory å·¥å‚ç±»å®Œæˆç›®æ ‡ DataSource çš„åˆ›å»ºè¿‡ç¨‹ã€‚</p>
<h3 id="å°ç»“">å°ç»“</h3>
<p>æ‰¿æ¥ä¸Šä¸€è¯¾æ—¶çš„å†…å®¹ï¼Œæœ¬è¯¾æ—¶æˆ‘ä»¬å¯¹ ShardingSphere ä¸­çš„é…ç½®ä½“ç³»è¿›è¡Œäº†å…¨é¢çš„ä»‹ç»ã€‚äº‹å®ä¸Šï¼Œåœ¨ä½¿ç”¨è¿™ä¸ªæ¡†æ¶æ—¶ï¼Œé…ç½®æ˜¯å¼€å‘äººå‘˜æœ€ä¸»è¦çš„å·¥ä½œå†…å®¹ã€‚æˆ‘ä»¬å¯¹ ShardingSphere çš„æ ¸å¿ƒé…ç½®é¡¹è¿›è¡Œäº†æ¢³ç†ï¼Œç„¶åç»™å‡ºäº†å…·ä½“çš„å››ç§é…ç½®æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ Java ä»£ç é…ç½®ã€Yaml é…ç½®ã€Spring å‘½åç©ºé—´é…ç½®ä»¥åŠ Spring Boot é…ç½®ã€‚æœ€åï¼Œä»å®ç°åŸç†ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿå¯¹ Yaml é…ç½®è¿™ä¸€ç‰¹å®šçš„é…ç½®æ–¹å¼è¿›è¡Œäº†æ·±å…¥çš„å‰–æã€‚</p>
<p>è¿™é‡Œç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜ï¼šåœ¨ ShardingSphereä¸­ï¼Œé…ç½®ä½“ç³»ç›¸å…³çš„æ ¸å¿ƒç±»ä¹‹é—´å­˜åœ¨ä»€ä¹ˆæ ·çš„å…³è”å…³ç³»ï¼Ÿ</p>
<p>ä»ä¸‹ä¸€è¯¾æ—¶å¼€å§‹ï¼Œæˆ‘ä»¬å°±å°†åŸºäº ShardingSphere æä¾›çš„é…ç½®ä½“ç³»ï¼Œæ¥é€æ­¥å®Œæˆåˆ†åº“åˆ†è¡¨ã€è¯»å†™åˆ†ç¦»ä»¥åŠåˆ†åº“åˆ†è¡¨+è¯»å†™åˆ†ç¦»ç­‰æ“ä½œçš„å¼€å‘å·¥ä½œã€‚</p>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/04-%E5%BA%94%E7%94%A8%E9%9B%86%E6%88%90%E5%9C%A8%E4%B8%9A%E5%8A%A1%E7%B3%BB%E7%BB%9F%E4%B8%AD%E4%BD%BF%E7%94%A8-shardingsphere-%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B/"><span>04 åº”ç”¨é›†æˆï¼šåœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ä½¿ç”¨ ShardingSphere çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/09-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E4%B8%8E%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1/"><span>09 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ä½¿ç”¨å¼ºä¸€è‡´æ€§äº‹åŠ¡ä¸æŸ”æ€§äº‹åŠ¡ï¼Ÿ</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 27270 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>