<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>19 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•åœ¨è·¯ç”±è¿‡ç¨‹ä¸­é›†æˆå¤šç§è·¯ç”±ç­–ç•¥å’Œè·¯ç”±ç®—æ³•ï¼Ÿ | Yipsen Ye</title>
<meta name="description" content="ä¸Šä¸€è¯¾æ—¶ã€Š18 | è·¯ç”±å¼•æ“ï¼šå¦‚ä½•å®ç°æ•°æ®è®¿é—®çš„åˆ†ç‰‡è·¯ç”±å’Œå¹¿æ’­è·¯ç”±ï¼Ÿã€‹ï¼Œæˆ‘ä»¬åœ¨ä»‹ç» ShardingRule å¯¹è±¡æ—¶ï¼Œå¼•å‡ºäº† ShardingSphere è·¯ç”±å¼•æ“ä¸­çš„åˆ†ç‰‡ç­–ç•¥ ShardingStrategyï¼Œåˆ†ç‰‡ç­–ç•¥æ˜¯è·¯ç”±å¼•æ“ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œç›´æ¥å½±å“äº†æœ€ç»ˆçš„è·¯ç”±ç»“æœã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†å›´ç»•è¿™ä¸€æ ¸å¿ƒæ¦‚å¿µå±•å¼€è®¨è®ºã€‚
åˆ†ç‰‡ç­–ç•¥æ•´ä½“ç»“æ„ æˆ‘ä»¬å…ˆæ¥çœ‹åˆ†ç‰‡ç­–ç•¥ ShardingStrategy çš„å®šä¹‰ï¼ŒShardingStrategy ä½äº sharding-core-common å·¥ç¨‹çš„ org.apache.shardingsphere.core.strategy.route åŒ…ä¸­ï¼Œå…¶å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š
public interface ShardingStrategy { //è·å–åˆ†ç‰‡ Column Collection&amp;lt;String&amp;gt; getShardingColumns(); //æ‰§è¡Œåˆ†ç‰‡ Collection&amp;lt;String&amp;gt; doSharding(Collection&amp;lt;String&amp;gt; availableTargetNames, Collection&amp;lt;RouteValue&amp;gt; shardingValues); }å¯ä»¥çœ‹åˆ° ShardingStrategy åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼šä¸€ä¸ªç”¨äºæŒ‡å®šåˆ†ç‰‡çš„ Columnï¼Œè€Œå¦ä¸€ä¸ªè´Ÿè´£æ‰§è¡Œåˆ†ç‰‡å¹¶è¿”å›ç›®æ ‡ DataSource å’Œ Tableã€‚ShardingSphere ä¸­ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç³»åˆ—çš„åˆ†ç‰‡ç­–ç•¥å®ä¾‹ï¼Œç±»å±‚ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š
ShardingStrategy å®ç°ç±»å›¾
å¦‚æœæˆ‘ä»¬ç¿»é˜…è¿™äº›å…·ä½“ ShardingStrategy å®ç°ç±»çš„ä»£ç ï¼Œä¼šå‘ç°æ¯ä¸ª ShardingStrategy ä¸­éƒ½ä¼šåŒ…å«å¦ä¸€ä¸ªä¸è·¯ç”±ç›¸å…³çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå³åˆ†ç‰‡ç®—æ³• ShardingAlgorithmï¼Œæˆ‘ä»¬å‘ç° ShardingAlgorithm æ˜¯ä¸€ä¸ªç©ºæ¥å£ï¼Œä½†åŒ…å«äº†å››ä¸ªç»§æ‰¿æ¥å£ï¼Œå³
 PreciseShardingAlgorithm RangeShardingAlgorithm ComplexKeysShardingAlgorithm HintShardingAlgorithm  è€Œè¿™å››ä¸ªæ¥å£åˆåˆ†åˆ«å…·æœ‰ä¸€æ‰¹å®ç°ç±»ï¼ŒShardingAlgorithm çš„ç±»å±‚ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š
ShardingAlgorithm å­æ¥å£å’Œå®ç°ç±»å›¾
è¯·æ³¨æ„ï¼ŒShardingStrategy ä¸ ShardingAlgorithm ä¹‹é—´å¹¶ä¸æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚åœ¨ä¸€ä¸ª ShardingStrategy ä¸­ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ª ShardingAlgorithm æ¥å®Œæˆå…·ä½“çš„è·¯ç”±æ‰§è¡Œç­–ç•¥ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å…·æœ‰å¦‚ä¸‹æ‰€ç¤ºçš„ç±»å±‚ç»“æ„å…³ç³»å›¾ï¼š
ç”±äºåˆ†ç‰‡ç®—æ³•çš„ç‹¬ç«‹æ€§ï¼ŒShardingSphere å°†å…¶è¿›è¡Œå•ç‹¬æŠ½ç¦»ã€‚ä»å…³ç³»ä¸Šè®²ï¼Œåˆ†ç‰‡ç­–ç•¥ä¸­åŒ…å«äº†åˆ†ç‰‡ç®—æ³•å’Œåˆ†ç‰‡é”®ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåˆ†ç‰‡ç­–ç•¥çš„ç»„æˆç»“æ„ç®€å•æŠ½è±¡æˆå¦‚ä¸‹æ‰€ç¤ºçš„å…¬å¼ï¼š">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="nav-logo">
    <a href="http://yipsen.github.io/">
        
        <span class="nav-title">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æ–‡ç« </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/shardingsphere%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86%e7%b2%be%e8%ae%b2/">ShardingSphereæ ¸å¿ƒåŸç†ç²¾è®²</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/00-%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E5%AD%A6%E4%B9%A0%E4%B8%80%E6%AC%BE%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E5%BC%80%E6%BA%90%E6%A1%86%E6%9E%B6/">00 å¦‚ä½•æ­£ç¡®å­¦ä¹ ä¸€æ¬¾åˆ†åº“åˆ†è¡¨å¼€æºæ¡†æ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/01-%E4%BB%8E%E7%90%86%E8%AE%BA%E5%88%B0%E5%AE%9E%E8%B7%B5%E5%A6%82%E4%BD%95%E8%AE%A9%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E7%9C%9F%E6%AD%A3%E8%90%BD%E5%9C%B0/">01 ä»ç†è®ºåˆ°å®è·µï¼šå¦‚ä½•è®©åˆ†åº“åˆ†è¡¨çœŸæ­£è½åœ°ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/02-%E9%A1%B6%E7%BA%A7%E9%A1%B9%E7%9B%AEshardingsphere-%E6%98%AF%E4%B8%80%E6%AC%BE%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84-apache-%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6/">02 é¡¶çº§é¡¹ç›®ï¼šShardingSphere æ˜¯ä¸€æ¬¾ä»€ä¹ˆæ ·çš„ Apache å¼€æºè½¯ä»¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/03-%E8%A7%84%E8%8C%83%E5%85%BC%E5%AE%B9jdbc-%E8%A7%84%E8%8C%83%E4%B8%8E-shardingsphere-%E6%98%AF%E4%BB%80%E4%B9%88%E5%85%B3%E7%B3%BB/">03 è§„èŒƒå…¼å®¹ï¼šJDBC è§„èŒƒä¸ ShardingSphere æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/04-%E5%BA%94%E7%94%A8%E9%9B%86%E6%88%90%E5%9C%A8%E4%B8%9A%E5%8A%A1%E7%B3%BB%E7%BB%9F%E4%B8%AD%E4%BD%BF%E7%94%A8-shardingsphere-%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B/">04 åº”ç”¨é›†æˆï¼šåœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ä½¿ç”¨ ShardingSphere çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/05-%E9%85%8D%E7%BD%AE%E9%A9%B1%E5%8A%A8shardingsphere-%E4%B8%AD%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BD%93%E7%B3%BB%E6%98%AF%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E7%9A%84/">05 é…ç½®é©±åŠ¨ï¼šShardingSphere ä¸­çš„é…ç½®ä½“ç³»æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/09-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E4%B8%8E%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1/">09 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ä½¿ç”¨å¼ºä¸€è‡´æ€§äº‹åŠ¡ä¸æŸ”æ€§äº‹åŠ¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/10-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E5%A6%82%E4%BD%95%E7%A1%AE%E4%BF%9D%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%89%E5%85%A8%E8%AE%BF%E9%97%AE/">10 æ•°æ®è„±æ•ï¼šå¦‚ä½•ç¡®ä¿æ•æ„Ÿæ•°æ®çš„å®‰å…¨è®¿é—®ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/11-%E7%BC%96%E6%8E%92%E6%B2%BB%E7%90%86%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E5%8A%A8%E6%80%81%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/">11 ç¼–æ’æ²»ç†ï¼šå¦‚ä½•å®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„åŠ¨æ€é…ç½®ç®¡ç†ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/12-%E4%BB%8E%E5%BA%94%E7%94%A8%E5%88%B0%E5%8E%9F%E7%90%86%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E9%98%85%E8%AF%BB-shardingsphere-%E6%BA%90%E7%A0%81/">12 ä»åº”ç”¨åˆ°åŸç†ï¼šå¦‚ä½•é«˜æ•ˆé˜…è¯» ShardingSphere æºç ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/13-%E5%BE%AE%E5%86%85%E6%A0%B8%E6%9E%B6%E6%9E%84shardingsphere-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%89%A9%E5%B1%95%E6%80%A7/">13 å¾®å†…æ ¸æ¶æ„ï¼šShardingSphere å¦‚ä½•å®ç°ç³»ç»Ÿçš„æ‰©å±•æ€§ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/14-%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AEshardingsphere-%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AE%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/">14 åˆ†å¸ƒå¼ä¸»é”®ï¼šShardingSphere ä¸­æœ‰å“ªäº›åˆ†å¸ƒå¼ä¸»é”®å®ç°æ–¹å¼ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/15-%E8%A7%A3%E6%9E%90%E5%BC%95%E6%93%8Esql-%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%8C%85%E6%8B%AC%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E9%98%B6%E6%AE%B5%E4%B8%8A/">15 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/16-%E8%A7%A3%E6%9E%90%E5%BC%95%E6%93%8Esql-%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%8C%85%E6%8B%AC%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E9%98%B6%E6%AE%B5%E4%B8%8B/">16 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/17-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E5%88%86%E7%89%87%E8%B7%AF%E7%94%B1%E6%A0%B8%E5%BF%83%E7%B1%BB-shardingrouter-%E7%9A%84%E8%BF%90%E4%BD%9C%E6%9C%BA%E5%88%B6/">17 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•ç†è§£åˆ†ç‰‡è·¯ç”±æ ¸å¿ƒç±» ShardingRouter çš„è¿ä½œæœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/18-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E7%9A%84%E5%88%86%E7%89%87%E8%B7%AF%E7%94%B1%E5%92%8C%E5%B9%BF%E6%92%AD%E8%B7%AF%E7%94%B1/">18 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•å®ç°æ•°æ®è®¿é—®çš„åˆ†ç‰‡è·¯ç”±å’Œå¹¿æ’­è·¯ç”±ï¼Ÿ</a></li>
                
                
                
                    <li>19 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•åœ¨è·¯ç”±è¿‡ç¨‹ä¸­é›†æˆå¤šç§è·¯ç”±ç­–ç•¥å’Œè·¯ç”±ç®—æ³•ï¼Ÿ</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/20-%E6%94%B9%E5%86%99%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84-sql-%E6%94%B9%E5%86%99%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6/">20 æ”¹å†™å¼•æ“ï¼šå¦‚ä½•ç†è§£è£…é¥°å™¨æ¨¡å¼ä¸‹çš„ SQL æ”¹å†™å®ç°æœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/21-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%88%86%E7%89%87%E7%8E%AF%E5%A2%83%E4%B8%8B-sql-%E6%89%A7%E8%A1%8C%E7%9A%84%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E6%8A%BD%E8%B1%A1/">21 æ‰§è¡Œå¼•æ“ï¼šåˆ†ç‰‡ç¯å¢ƒä¸‹ SQL æ‰§è¡Œçš„æ•´ä½“æµç¨‹åº”è¯¥å¦‚ä½•è¿›è¡ŒæŠ½è±¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/22-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E6%8A%8A%E6%8F%A1-shardingsphere-%E4%B8%AD%E7%9A%84-executor-%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B%E4%B8%8A/">22 æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•æŠŠæ¡ ShardingSphere ä¸­çš„ Executor æ‰§è¡Œæ¨¡å‹ï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/23-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E6%8A%8A%E6%8F%A1-shardingsphere-%E4%B8%AD%E7%9A%84-executor-%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B%E4%B8%8B/">23 æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•æŠŠæ¡ ShardingSphere ä¸­çš„ Executor æ‰§è¡Œæ¨¡å‹ï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/24-%E5%BD%92%E5%B9%B6%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%95%B0%E6%8D%AE%E5%BD%92%E5%B9%B6%E7%9A%84%E7%B1%BB%E5%9E%8B%E4%BB%A5%E5%8F%8A%E7%AE%80%E5%8D%95%E5%BD%92%E5%B9%B6%E7%AD%96%E7%95%A5%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/">24 å½’å¹¶å¼•æ“ï¼šå¦‚ä½•ç†è§£æ•°æ®å½’å¹¶çš„ç±»å‹ä»¥åŠç®€å•å½’å¹¶ç­–ç•¥çš„å®ç°è¿‡ç¨‹ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/25-%E5%BD%92%E5%B9%B6%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%B5%81%E5%BC%8F%E5%BD%92%E5%B9%B6%E5%92%8C%E5%86%85%E5%AD%98%E5%BD%92%E5%B9%B6%E5%9C%A8%E5%A4%8D%E6%9D%82%E5%BD%92%E5%B9%B6%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84%E5%BA%94%E7%94%A8%E6%96%B9%E5%BC%8F/">25 å½’å¹¶å¼•æ“ï¼šå¦‚ä½•ç†è§£æµå¼å½’å¹¶å’Œå†…å­˜å½’å¹¶åœ¨å¤æ‚å½’å¹¶åœºæ™¯ä¸‹çš„åº”ç”¨æ–¹å¼ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/26-%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%99%AE%E9%80%9A%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84%E5%92%8C%E5%88%86%E7%89%87%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84%E5%88%86%E5%88%AB%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%9A%84/">26 è¯»å†™åˆ†ç¦»ï¼šæ™®é€šä¸»ä»æ¶æ„å’Œåˆ†ç‰‡ä¸»ä»æ¶æ„åˆ†åˆ«æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/27-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3-shardingsphere-%E4%B8%AD%E5%AF%B9%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%8A%BD%E8%B1%A1%E8%BF%87%E7%A8%8B/">27 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ç†è§£ ShardingSphere ä¸­å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„æŠ½è±¡è¿‡ç¨‹ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/28-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1shardingsphere-%E4%B8%AD%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E5%92%8C%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1%E6%94%AF%E6%8C%81%E4%B8%8A/">28 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šShardingSphere ä¸­å¦‚ä½•é›†æˆå¼ºä¸€è‡´æ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡æ”¯æŒï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/29-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1shardingsphere-%E4%B8%AD%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E5%92%8C%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1%E6%94%AF%E6%8C%81%E4%B8%8B/">29 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šShardingSphere ä¸­å¦‚ä½•é›†æˆå¼ºä¸€è‡´æ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡æ”¯æŒï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/30-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E6%94%B9%E5%86%99%E5%BC%95%E6%93%8E%E5%AE%9E%E7%8E%B0%E4%BD%8E%E4%BE%B5%E5%85%A5%E6%80%A7%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E6%96%B9%E6%A1%88/">30 æ•°æ®è„±æ•ï¼šå¦‚ä½•åŸºäºæ”¹å†™å¼•æ“å®ç°ä½ä¾µå…¥æ€§æ•°æ®è„±æ•æ–¹æ¡ˆï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/31-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%AE%9E%E7%8E%B0%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E7%9A%84%E5%8A%A8%E6%80%81%E5%8C%96%E7%AE%A1%E7%90%86/">31 é…ç½®ä¸­å¿ƒï¼šå¦‚ä½•åŸºäºé…ç½®ä¸­å¿ƒå®ç°é…ç½®ä¿¡æ¯çš„åŠ¨æ€åŒ–ç®¡ç†ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/32-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BF%E9%97%AE%E7%86%94%E6%96%AD%E6%9C%BA%E5%88%B6/">32 æ³¨å†Œä¸­å¿ƒï¼šå¦‚ä½•åŸºäºæ³¨å†Œä¸­å¿ƒå®ç°æ•°æ®åº“è®¿é—®ç†”æ–­æœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/33-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E-hook-%E6%9C%BA%E5%88%B6%E4%BB%A5%E5%8F%8A-opentracing-%E5%8D%8F%E8%AE%AE%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/">33 é“¾è·¯è·Ÿè¸ªï¼šå¦‚ä½•åŸºäº Hook æœºåˆ¶ä»¥åŠ OpenTracing åè®®å®ç°æ•°æ®è®¿é—®é“¾è·¯è·Ÿè¸ªï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/35-%E7%BB%93%E8%AF%ADshardingsphere-%E6%80%BB%E7%BB%93%E5%8F%8A%E5%B1%95%E6%9C%9B/">35 ç»“è¯­ï¼šShardingSphere æ€»ç»“åŠå±•æœ›</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">19 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•åœ¨è·¯ç”±è¿‡ç¨‹ä¸­é›†æˆå¤šç§è·¯ç”±ç­–ç•¥å’Œè·¯ç”±ç®—æ³•ï¼Ÿ</h1>
        <div class="post-info">
            <div class="post-date"> 
                <span>2021-12-22 01:55:58</span>
            </div>
        </div>
        <div class="post-content">
            <p>ä¸Šä¸€è¯¾æ—¶ã€Š18 | è·¯ç”±å¼•æ“ï¼šå¦‚ä½•å®ç°æ•°æ®è®¿é—®çš„åˆ†ç‰‡è·¯ç”±å’Œå¹¿æ’­è·¯ç”±ï¼Ÿã€‹ï¼Œæˆ‘ä»¬åœ¨ä»‹ç» ShardingRule å¯¹è±¡æ—¶ï¼Œå¼•å‡ºäº† ShardingSphere è·¯ç”±å¼•æ“ä¸­çš„<strong>åˆ†ç‰‡ç­–ç•¥ ShardingStrategy</strong>ï¼Œåˆ†ç‰‡ç­–ç•¥æ˜¯è·¯ç”±å¼•æ“ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œç›´æ¥å½±å“äº†æœ€ç»ˆçš„è·¯ç”±ç»“æœã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†å›´ç»•è¿™ä¸€æ ¸å¿ƒæ¦‚å¿µå±•å¼€è®¨è®ºã€‚</p>
<h3 id="åˆ†ç‰‡ç­–ç•¥æ•´ä½“ç»“æ„">åˆ†ç‰‡ç­–ç•¥æ•´ä½“ç»“æ„</h3>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹åˆ†ç‰‡ç­–ç•¥ ShardingStrategy çš„å®šä¹‰ï¼ŒShardingStrategy ä½äº sharding-core-common å·¥ç¨‹çš„ org.apache.shardingsphere.core.strategy.route åŒ…ä¸­ï¼Œå…¶å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public interface ShardingStrategy { 

    //è·å–åˆ†ç‰‡ Column 
    Collection&lt;String&gt; getShardingColumns(); 

    //æ‰§è¡Œåˆ†ç‰‡ 
    Collection&lt;String&gt; doSharding(Collection&lt;String&gt; availableTargetNames, Collection&lt;RouteValue&gt; shardingValues); 
}
</code></pre><p>å¯ä»¥çœ‹åˆ° ShardingStrategy åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼šä¸€ä¸ªç”¨äºæŒ‡å®šåˆ†ç‰‡çš„ Columnï¼Œè€Œå¦ä¸€ä¸ªè´Ÿè´£æ‰§è¡Œåˆ†ç‰‡å¹¶è¿”å›ç›®æ ‡ DataSource å’Œ Tableã€‚ShardingSphere ä¸­ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç³»åˆ—çš„åˆ†ç‰‡ç­–ç•¥å®ä¾‹ï¼Œç±»å±‚ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F86ZlmARCBiAAEMHwjkZPk259.png" alt="Drawing 0.png"></p>
<p>ShardingStrategy å®ç°ç±»å›¾</p>
<p>å¦‚æœæˆ‘ä»¬ç¿»é˜…è¿™äº›å…·ä½“ ShardingStrategy å®ç°ç±»çš„ä»£ç ï¼Œä¼šå‘ç°æ¯ä¸ª ShardingStrategy ä¸­éƒ½ä¼šåŒ…å«å¦ä¸€ä¸ªä¸è·¯ç”±ç›¸å…³çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå³<strong>åˆ†ç‰‡ç®—æ³• ShardingAlgorithm</strong>ï¼Œæˆ‘ä»¬å‘ç° ShardingAlgorithm æ˜¯ä¸€ä¸ªç©ºæ¥å£ï¼Œä½†åŒ…å«äº†<strong>å››ä¸ªç»§æ‰¿æ¥å£</strong>ï¼Œå³</p>
<ul>
<li>PreciseShardingAlgorithm</li>
<li>RangeShardingAlgorithm</li>
<li>ComplexKeysShardingAlgorithm</li>
<li>HintShardingAlgorithm</li>
</ul>
<p>è€Œè¿™å››ä¸ªæ¥å£åˆåˆ†åˆ«å…·æœ‰ä¸€æ‰¹å®ç°ç±»ï¼ŒShardingAlgorithm çš„ç±»å±‚ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F86ZmSAaVqsAACWpLDZQm8610.png" alt="Drawing 1.png"></p>
<p>ShardingAlgorithm å­æ¥å£å’Œå®ç°ç±»å›¾</p>
<p>è¯·æ³¨æ„ï¼ŒShardingStrategy ä¸ ShardingAlgorithm ä¹‹é—´å¹¶ä¸æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚<strong>åœ¨ä¸€ä¸ª ShardingStrategy ä¸­ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ª ShardingAlgorithm æ¥å®Œæˆå…·ä½“çš„è·¯ç”±æ‰§è¡Œç­–ç•¥</strong>ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å…·æœ‰å¦‚ä¸‹æ‰€ç¤ºçš„ç±»å±‚ç»“æ„å…³ç³»å›¾ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F86Zm-AE3bOAACLylkVuks873.png" alt="Drawing 2.png"></p>
<p>ç”±äºåˆ†ç‰‡ç®—æ³•çš„ç‹¬ç«‹æ€§ï¼ŒShardingSphere å°†å…¶è¿›è¡Œå•ç‹¬æŠ½ç¦»ã€‚ä»å…³ç³»ä¸Šè®²ï¼Œåˆ†ç‰‡ç­–ç•¥ä¸­åŒ…å«äº†åˆ†ç‰‡ç®—æ³•å’Œåˆ†ç‰‡é”®ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåˆ†ç‰‡ç­–ç•¥çš„ç»„æˆç»“æ„ç®€å•æŠ½è±¡æˆå¦‚ä¸‹æ‰€ç¤ºçš„å…¬å¼ï¼š</p>
<p><strong>åˆ†ç‰‡ç­–ç•¥ = åˆ†ç‰‡ç®—æ³• + åˆ†ç‰‡é”®</strong></p>
<h3 id="shardingsphere-åˆ†ç‰‡ç­–ç•¥è¯¦è§£">ShardingSphere åˆ†ç‰‡ç­–ç•¥è¯¦è§£</h3>
<p>åœ¨ ShardingSphere ä¸­ï¼Œä¸€å…±å­˜åœ¨äº”ç§ ShardingStrategy å®ç°ï¼š</p>
<ul>
<li>ä¸åˆ†ç‰‡ç­–ç•¥ï¼ˆNoneShardingStrategyï¼‰</li>
<li>Hint åˆ†ç‰‡ç­–ç•¥ï¼ˆHintShardingStrategyï¼‰</li>
<li>æ ‡å‡†åˆ†ç‰‡ç­–ç•¥ï¼ˆStandardShardingStrategyï¼‰</li>
<li>å¤åˆåˆ†ç‰‡ç­–ç•¥ï¼ˆComplexShardingStrategyï¼‰</li>
<li>è¡Œè¡¨è¾¾å¼åˆ†ç‰‡ç­–ç•¥ï¼ˆInlineShardingStrategyï¼‰</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯¹è¿™äº› ShardingStrategyä¸€ ä¸€è¿›è¡Œå±•å¼€è®¨è®ºã€‚</p>
<h4 id="1ä¸åˆ†ç‰‡ç­–ç•¥-noneshardingstrategy">1.ä¸åˆ†ç‰‡ç­–ç•¥ NoneShardingStrategy</h4>
<p>è¿™æ¬¡æˆ‘ä»¬ä»ç®€å•çš„å¼€å§‹ï¼Œå…ˆæ¥çœ‹ NoneShardingStrategyï¼Œè¿™æ˜¯ä¸€ç§ä¸æ‰§è¡Œåˆ†ç‰‡çš„ç­–ç•¥ï¼Œå®ç°æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public final class NoneShardingStrategy implements ShardingStrategy { 

    private final Collection&lt;String&gt; shardingColumns = Collections.emptyList(); 

    @Override 
    public Collection&lt;String&gt; doSharding(final Collection&lt;String&gt; availableTargetNames, final Collection&lt;RouteValue&gt; shardingValues) { 
        return availableTargetNames; 
    } 
}
</code></pre><p>å¯ä»¥çœ‹åˆ°åœ¨ NoneShardingStrategy ä¸­ï¼Œç›´æ¥è¿”å›äº†è¾“å…¥çš„ availableTargetNames è€Œä¸æ‰§è¡Œä»»ä½•å…·ä½“è·¯ç”±æ“ä½œã€‚</p>
<h4 id="2hint-åˆ†ç‰‡ç­–ç•¥-hintshardingstrategy">2.Hint åˆ†ç‰‡ç­–ç•¥ HintShardingStrategy</h4>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ HintShardingStrategyï¼Œå›æƒ³æˆ‘ä»¬åœ¨ä¸Šä¸€è¯¾æ—¶ä¸­é€šè¿‡è¿™ä¸ª ShardingStrategy æ¥åˆ¤æ–­æ˜¯å¦æ ¹æ® Hint è¿›è¡Œè·¯ç”±ã€‚æˆ‘ä»¬çŸ¥é“åœ¨æœ‰äº›åœºæ™¯ä¸‹ï¼Œåˆ†ç‰‡å­—æ®µä¸æ˜¯ç”± SQL æœ¬èº«å†³å®šï¼Œè€Œç”±ä¾èµ–äºå…¶ä»–å¤–ç½®æ¡ä»¶ï¼Œè¿™æ—¶å€™ï¼Œå°±å¯ä½¿ç”¨ SQL Hint çµæ´»åœ°æ³¨å…¥åˆ†ç‰‡å­—æ®µã€‚</p>
<blockquote>
<p>å…³äº Hint çš„æ¦‚å¿µå’Œå‰ç½®è·¯ç”±çš„åº”ç”¨æ–¹å¼ï¼Œå¯ä»¥å›é¡¾ [ã€Š07 | æ•°æ®åˆ†ç‰‡ï¼šå¦‚ä½•å®ç°åˆ†åº“ã€åˆ†è¡¨ã€åˆ†åº“+åˆ†è¡¨ä»¥åŠå¼ºåˆ¶è·¯ç”±ï¼ˆä¸‹ï¼‰ï¼Ÿã€‹]ä¸­çš„å†…å®¹ã€‚</p>
</blockquote>
<p>åŸºäº HintShardingStrategyï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Hint è€Œé SQL è§£æçš„æ–¹å¼æ‰§è¡Œåˆ†ç‰‡ç­–ç•¥ã€‚è€Œ HintShardingStrategy çš„å®ç°ä¾èµ–äº <strong>HintShardingAlgorithm</strong>ï¼ŒHintShardingAlgorithm ç»§æ‰¿äº† ShardingAlgorithm æ¥å£ã€‚</p>
<p>å…¶å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°è¯¥æ¥å£åŒæ ·å­˜åœ¨ä¸€ä¸ª doSharding æ–¹æ³•ï¼š</p>
<pre tabindex="0"><code>public interface HintShardingAlgorithm&lt;T extends Comparable&lt;?&gt;&gt; extends ShardingAlgorithm { 

    //æ ¹æ® Hint ä¿¡æ¯æ‰§è¡Œåˆ†ç‰‡ 
    Collection&lt;String&gt; doSharding(Collection&lt;String&gt; availableTargetNames, HintShardingValue&lt;T&gt; shardingValue); 
}
</code></pre><p>å¯¹äº Hint è€Œè¨€ï¼Œå› ä¸ºå®ƒå®é™…ä¸Šæ˜¯å¯¹ SQL æ‰§è¡Œè¿‡ç¨‹çš„ä¸€ç§ç›´æ¥å¹²é¢„ï¼Œæ‰€ä»¥å¾€å¾€æ ¹æ®ä¼ å…¥çš„ availableTargetNames è¿›è¡Œç›´æ¥è·¯ç”±ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥çœ‹ ShardingSphere ä¸­ HintShardingAlgorithm æ¥å£<strong>å”¯ä¸€çš„ä¸€ä¸ªå®ç°ç±» DefaultHintShardingAlgorithm</strong>ï¼š</p>
<pre tabindex="0"><code>public final class DefaultHintShardingAlgorithm implements HintShardingAlgorithm&lt;Integer&gt; { 

    @Override 
    public Collection&lt;String&gt; doSharding(final Collection&lt;String&gt; availableTargetNames, final HintShardingValue&lt;Integer&gt; shardingValue) { 
        return availableTargetNames; 
    } 
}
</code></pre><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªåˆ†ç‰‡ç®—æ³•çš„æ‰§è¡Œæ–¹å¼ç¡®å®æ˜¯åŸºäº availableTargetNamesï¼Œä½†åªæ˜¯ç›´æ¥è¿”å›è€Œå·²ã€‚æ‰€ä»¥å¯¹äº HintShardingStrategy è€Œè¨€ï¼Œé»˜è®¤æƒ…å†µä¸‹å®é™…ä¸Šå¹¶æ²¡æœ‰æ‰§è¡Œä»»ä½•è·¯ç”±æ•ˆæœã€‚HintShardingStrategy çš„å®Œæ•´å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public final class HintShardingStrategy implements ShardingStrategy { 

    @Getter 
    private final Collection&lt;String&gt; shardingColumns; 

    private final HintShardingAlgorithm shardingAlgorithm; 

    public HintShardingStrategy(final HintShardingStrategyConfiguration hintShardingStrategyConfig) { 
        Preconditions.checkNotNull(hintShardingStrategyConfig.getShardingAlgorithm(), &quot;Sharding algorithm cannot be null.&quot;); 
        shardingColumns = new TreeSet&lt;&gt;(String.CASE_INSENSITIVE_ORDER); 
        //ä»é…ç½®ä¸­è·å– HintShardingAlgorithm 
        shardingAlgorithm = hintShardingStrategyConfig.getShardingAlgorithm(); 
    } 

    @SuppressWarnings(&quot;unchecked&quot;) 
    @Override 
    public Collection&lt;String&gt; doSharding(final Collection&lt;String&gt; availableTargetNames, final Collection&lt;RouteValue&gt; shardingValues) { 
        ListRouteValue shardingValue = (ListRouteValue) shardingValues.iterator().next(); 
        Collection&lt;String&gt; shardingResult = shardingAlgorithm.doSharding(availableTargetNames,
                new HintShardingValue(shardingValue.getTableName(), shardingValue.getColumnName(), shardingValue.getValues())); 
        Collection&lt;String&gt; result = new TreeSet&lt;&gt;(String.CASE_INSENSITIVE_ORDER); 
        result.addAll(shardingResult); 
        return result; 
    } 
}
</code></pre><p>æˆ‘ä»¬æ³¨æ„åˆ°åœ¨ HintShardingStrategy ä¸­ï¼ŒshardingAlgorithm å˜é‡çš„æ„å»ºæ˜¯é€šè¿‡ HintShardingStrategyConfiguration é…ç½®ç±»å®Œæˆçš„ï¼Œæ˜¾ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®é¡¹æ¥è®¾ç½®å…·ä½“çš„ HintShardingAlgorithmã€‚åœ¨æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½éœ€è¦å®ç°è‡ªå®šä¹‰çš„ HintShardingAlgorithm å¹¶è¿›è¡Œé…ç½®ã€‚</p>
<blockquote>
<p>[ã€Š07 | æ•°æ®åˆ†ç‰‡ï¼šå¦‚ä½•å®ç°åˆ†åº“ã€åˆ†è¡¨ã€åˆ†åº“+åˆ†è¡¨ä»¥åŠå¼ºåˆ¶è·¯ç”±ï¼ˆä¸‹ï¼‰ï¼Ÿã€‹]ä¸­æ¼”ç¤ºäº†è¿™ç§åšæ³•ï¼Œä½ å¯ä»¥åšä¸€äº›å›é¡¾ã€‚</p>
</blockquote>
<h4 id="3æ ‡å‡†åˆ†ç‰‡ç­–ç•¥-standardshardingstrategy">3.æ ‡å‡†åˆ†ç‰‡ç­–ç•¥ StandardShardingStrategy</h4>
<p>StandardShardingStrategy æ˜¯ä¸€ç§æ ‡å‡†åˆ†ç‰‡ç­–ç•¥ï¼Œæä¾›å¯¹ SQL è¯­å¥ä¸­çš„=, &gt;, &lt;, &gt;=, &lt;=, IN å’Œ BETWEEN AND ç­‰æ“ä½œçš„åˆ†ç‰‡æ”¯æŒã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“åˆ†ç‰‡ç­–ç•¥ç›¸å½“äºåˆ†ç‰‡ç®—æ³•ä¸åˆ†ç‰‡é”®çš„ç»„åˆã€‚å¯¹äº StandardShardingStrategy è€Œè¨€ï¼Œå®ƒ<strong>åªæ”¯æŒå•åˆ†ç‰‡é”®</strong>ï¼Œå¹¶æä¾› <strong>PreciseShardingAlgorithm</strong> å’Œ <strong>RangeShardingAlgorithm</strong> è¿™ä¸¤ä¸ªåˆ†ç‰‡ç®—æ³•ã€‚</p>
<ul>
<li>PreciseShardingAlgorithm æ˜¯å¿…é€‰çš„ï¼Œç”¨äºå¤„ç† = å’Œ IN çš„åˆ†ç‰‡ï¼›</li>
<li>RangeShardingAlgorithm æ˜¯å¯é€‰çš„ï¼Œç”¨äºå¤„ç† BETWEEN AND, &gt;, &lt;, &gt;=, &lt;= åˆ†ç‰‡ã€‚</li>
</ul>
<p>ä»‹ç» StandardShardingStrategy ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¯¹å…¶æ¶‰åŠçš„è¿™ä¸¤ç§åˆ†ç‰‡ç®—æ³•åˆ†åˆ«è¿›è¡Œè®¨è®ºã€‚</p>
<p><strong>ï¼ˆ1ï¼‰PreciseShardingAlgorithm</strong></p>
<p>å¯¹äº PreciseShardingAlgorithm è€Œè¨€ï¼Œè¯¥æ¥å£ç”¨äºå¤„ç†ä½¿ç”¨å•ä¸€é”®ä½œä¸ºåˆ†ç‰‡é”®çš„ = å’Œ IN è¿›è¡Œåˆ†ç‰‡çš„åœºæ™¯ã€‚</p>
<p>å®ƒæœ‰ä¸¤ä¸ªå®ç°ç±»ï¼Œåˆ†åˆ«æ˜¯ PreciseModuloDatabaseShardingAlgorithm å’Œ PreciseModuloTableShardingAlgorithmã€‚æ˜¾ç„¶ï¼Œå‰è€…ç”¨äºæ•°æ®åº“çº§åˆ«çš„åˆ†ç‰‡ï¼Œè€Œåè€…é¢å‘è¡¨æ“ä½œã€‚å®ƒä»¬çš„åˆ†ç‰‡æ–¹æ³•éƒ½ä¸€æ ·ï¼Œå°±æ˜¯ä½¿ç”¨å–æ¨¡ï¼ˆModuloï¼‰æ“ä½œã€‚ä»¥ PreciseModuloDatabaseShardingAlgorithm ä¸ºä¾‹ï¼Œå…¶å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public final class PreciseModuloDatabaseShardingAlgorithm implements PreciseShardingAlgorithm&lt;Integer&gt; { 

    @Override 
    public String doSharding(final Collection&lt;String&gt; availableTargetNames, final PreciseShardingValue&lt;Integer&gt; shardingValue) { 
        for (String each : availableTargetNames) { 
             //æ ¹æ®åˆ†ç‰‡å€¼æ‰§è¡Œå¯¹2çš„å–æ¨¡æ“ä½œ 
            if (each.endsWith(shardingValue.getValue() % 2 + &quot;&quot;)) { 
                return each; 
            } 
        } 
        throw new UnsupportedOperationException(); 
    } 
}
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå¯¹ PreciseShardingValue è¿›è¡Œäº†å¯¹ 2 çš„å–æ¨¡è®¡ç®—ï¼Œå¹¶ä¸ä¼ å…¥çš„ availableTargetNames è¿›è¡Œæ¯”å¯¹ï¼Œä»è€Œå†³å®šç›®æ ‡æ•°æ®åº“ã€‚</p>
<p><strong>ï¼ˆ2ï¼‰RangeShardingAlgorithm</strong></p>
<p>è€Œå¯¹äº RangeShardingAlgorithm è€Œè¨€ï¼Œæƒ…å†µå°±ç›¸å¯¹å¤æ‚ã€‚RangeShardingAlgorithm åŒæ ·å…·æœ‰ä¸¤ä¸ªå®ç°ç±»ï¼šåˆ†åˆ«ä¸º RangeModuloDatabaseShardingAlgorithm å’Œ RangeModuloTableShardingAlgorithmï¼Œå®ƒä»¬çš„å‘½åå’Œä»£ç é£æ ¼ä¸ PreciseShardingAlgorithm çš„å®ç°ç±»éå¸¸ç±»ä¼¼ã€‚</p>
<p>è¿™é‡Œä¹Ÿä»¥ RangeModuloDatabaseShardingAlgorithm ä¸ºä¾‹ï¼Œå®ƒçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public final class RangeModuloDatabaseShardingAlgorithm implements RangeShardingAlgorithm&lt;Integer&gt; { 

    @Override 
    public Collection&lt;String&gt; doSharding(final Collection&lt;String&gt; availableTargetNames, final RangeShardingValue&lt;Integer&gt; shardingValue) { 
        Collection&lt;String&gt; result = new LinkedHashSet&lt;&gt;(availableTargetNames.size()); 
        //æ ¹æ®åˆ†ç‰‡å€¼ï¼Œå†³å®šåˆ†ç‰‡çš„èŒƒå›´ 
        for (Integer i = shardingValue.getValueRange().lowerEndpoint(); i &lt;= shardingValue.getValueRange().upperEndpoint(); i++) { 
            for (String each : availableTargetNames) { 
              //åˆ†ç‰‡å€¼æ‰§è¡Œå¯¹ 2 çš„å–æ¨¡æ“ä½œï¼Œå¹¶ä¸ç›®æ ‡æ•°æ®åº“è¿›è¡Œæ¯”å¯¹ 
              if (each.endsWith(i % 2 + &quot;&quot;)) { 
                    result.add(each); 
                } 
            } 
        } 
        return result; 
    } 
}
</code></pre><p>ä¸ PreciseModuloDatabaseShardingAlgorithm ç›¸æ¯”ï¼Œè¿™é‡Œå¤šäº†ä¸€å±‚ for å¾ªç¯ï¼Œåœ¨è¯¥å¾ªç¯ä¸­æ·»åŠ äº†å¯¹èŒƒå›´ ValueRange çš„ lowerEndpoint() åˆ° upperEndpoint() ä¸­å„ä¸ªå€¼çš„è®¡ç®—å’Œæ¯”å¯¹ã€‚</p>
<p><strong>ï¼ˆ3ï¼‰ StandardShardingStrategy ç±»</strong></p>
<p>ä»‹ç»å®Œåˆ†ç‰‡ç®—æ³•ä¹‹åï¼Œæˆ‘ä»¬å›åˆ° StandardShardingStrategy ç±»ï¼Œæˆ‘ä»¬æ¥çœ‹å®ƒçš„ doSharding æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>@Override 
public Collection&lt;String&gt; doSharding(final Collection&lt;String&gt; availableTargetNames, final Collection&lt;RouteValue&gt; shardingValues) { 
    RouteValue shardingValue = shardingValues.iterator().next(); 
    Collection&lt;String&gt; shardingResult = shardingValue instanceof ListRouteValue 
         //å¦‚æœåˆ†ç‰‡å€¼æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ™æ‰§è¡Œ PreciseShardingAlgorithm 
            ? doSharding(availableTargetNames, (ListRouteValue) shardingValue)
            //å¦‚æœåˆ†ç‰‡å€¼æ˜¯ä¸€ä¸ªèŒƒå›´ï¼Œåˆ™ æ‰§è¡ŒRangeShardingAlgorithm 
            : doSharding(availableTargetNames, (RangeRouteValue) shardingValue); 
    Collection&lt;String&gt; result = new TreeSet&lt;&gt;(String.CASE_INSENSITIVE_ORDER); 
    result.addAll(shardingResult); 
    return result; 
}
</code></pre><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæ ¹æ®ä¼ å…¥çš„ shardingValues çš„ç±»å‹åˆ†åˆ«æ‰§è¡Œä¸åŒçš„ doSharding æ–¹æ³•ï¼Œå¦‚æœè¾“å…¥çš„æ˜¯ <strong>ListRouteValue</strong> åˆ™ä¼šä½¿ç”¨ PreciseShardingAlgorithmï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>private Collection&lt;String&gt; doSharding(final Collection&lt;String&gt; availableTargetNames, final ListRouteValue&lt;?&gt; shardingValue) { 
    Collection&lt;String&gt; result = new LinkedList&lt;&gt;(); 
    for (Comparable&lt;?&gt; each : shardingValue.getValues()) { 
       //ä½¿ç”¨ PreciseShardingAlgorithm è¿›è¡Œåˆ†ç‰‡ 
        String target = preciseShardingAlgorithm.doSharding(availableTargetNames, new PreciseShardingValue(shardingValue.getTableName(), shardingValue.getColumnName(), each)); 
        if (null != target) { 
            result.add(target); 
        } 
    } 
    return result; 
}
</code></pre><p>è€Œå¦‚æœæ˜¯ <strong>RangeRouteValue</strong> åˆ™ä½¿ç”¨ RangeShardingAlgorithmï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>private Collection&lt;String&gt; doSharding(final Collection&lt;String&gt; availableTargetNames, final RangeRouteValue&lt;?&gt; shardingValue) { 
        if (null == rangeShardingAlgorithm) { 
            throw new UnsupportedOperationException(&quot;Cannot find range sharding strategy in sharding rule.&quot;); 
        } 
    //ä½¿ç”¨ RangeShardingAlgorithm è¿›è¡Œåˆ†ç‰‡ 
        return rangeShardingAlgorithm.doSharding(availableTargetNames,
                new RangeShardingValue(shardingValue.getTableName(), shardingValue.getColumnName(), shardingValue.getValueRange())); 
}
</code></pre><h4 id="4å¤åˆåˆ†ç‰‡ç­–ç•¥-complexshardingstrategy">4.å¤åˆåˆ†ç‰‡ç­–ç•¥ ComplexShardingStrategy</h4>
<p>ä¸ StandardShardingStrategy åªæ”¯æŒå•åˆ†ç‰‡é”®ä¸åŒï¼ŒShardingSphere çš„å®˜ç½‘è¡¨æ˜ ComplexShardingStrategy <strong>æ”¯æŒå¤šåˆ†ç‰‡é”®</strong>ã€‚</p>
<p>ComplexShardingStrategy çš„ doSharding æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public Collection&lt;String&gt; doSharding(final Collection&lt;String&gt; availableTargetNames, final Collection&lt;RouteValue&gt; shardingValues) { 
    Map&lt;String, Collection&lt;Comparable&lt;?&gt;&gt;&gt; columnShardingValues = new HashMap&lt;&gt;(shardingValues.size(), 1); 
    Map&lt;String, Range&lt;Comparable&lt;?&gt;&gt;&gt; columnRangeValues = new HashMap&lt;&gt;(shardingValues.size(), 1); 
    String logicTableName = &quot;&quot;; 
    for (RouteValue each : shardingValues) { 
        if (each instanceof ListRouteValue) { 
          //æ„å»º ListRouteValue 
            columnShardingValues.put(each.getColumnName(), ((ListRouteValue) each).getValues()); 
        } else if (each instanceof RangeRouteValue) { 
          //æ„å»º RangeRouteValue 
            columnRangeValues.put(each.getColumnName(), ((RangeRouteValue) each).getValueRange()); 
        } 
        logicTableName = each.getTableName(); 
    } 
    Collection&lt;String&gt; shardingResult = shardingAlgorithm.doSharding(availableTargetNames, new ComplexKeysShardingValue(logicTableName, columnShardingValues, columnRangeValues)); 
    Collection&lt;String&gt; result = new TreeSet&lt;&gt;(String.CASE_INSENSITIVE_ORDER); 
    result.addAll(shardingResult); 
    return result; 
}
</code></pre><p>è¿™é‡ŒåŸºäºä¼ å…¥çš„ RouteValue åˆ†åˆ«æ„å»ºäº† ListRouteValue å’Œ RangeRouteValueï¼Œç„¶åä¼ é€’ç»™ <strong>ComplexKeysShardingAlgorithm</strong> è¿›è¡Œè®¡ç®—ã€‚ç”±äºå¤šåˆ†ç‰‡é”®ä¹‹é—´çš„å…³ç³»å¤æ‚ï¼Œå› æ­¤ ComplexShardingStrategy å¹¶æœªè¿›è¡Œè¿‡å¤šçš„å°è£…ï¼Œè€Œæ˜¯ç›´æ¥å°†åˆ†ç‰‡é”®å€¼ç»„åˆä»¥åŠåˆ†ç‰‡æ“ä½œç¬¦é€ä¼ è‡³åˆ†ç‰‡ç®—æ³•ï¼Œå®Œå…¨ç”±åº”ç”¨å¼€å‘è€…å®ç°ï¼Œæä¾›æœ€å¤§çš„çµæ´»åº¦ã€‚</p>
<p>åŸºäºè¿™ä¸€ç‚¹è€ƒè™‘ï¼ŒShardingSphere çš„ ComplexKeysShardingAlgorithm çš„<strong>å”¯ä¸€å®ç°ç±» DefaultComplexKeysShardingAlgorithm</strong> æ˜¾å¾—éå¸¸ç®€å•ï¼Œå…¶ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public final class DefaultComplexKeysShardingAlgorithm implements ComplexKeysShardingAlgorithm&lt;Integer&gt; { 

    @Override 
    public Collection&lt;String&gt; doSharding(final Collection&lt;String&gt; availableTargetNames, final ComplexKeysShardingValue&lt;Integer&gt; shardingValue) { 
        return availableTargetNames; 
    } 
}
</code></pre><p>å¯ä»¥çœ‹åˆ° DefaultComplexKeysShardingAlgorithm ä¸ NoneShardingStrategy çš„å®ç°å®é™…ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œç›¸å½“äºå°±æ˜¯ä»€ä¹ˆéƒ½æ²¡æœ‰åšï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰çš„å·¥ä½œéƒ½éœ€è¦äº¤ç»™å¼€å‘è€…è‡ªè¡Œè¿›è¡Œè®¾è®¡å’Œå®ç°ã€‚</p>
<h4 id="5è¡Œè¡¨è¾¾å¼åˆ†ç‰‡ç­–ç•¥-inlineshardingstrategy">5.è¡Œè¡¨è¾¾å¼åˆ†ç‰‡ç­–ç•¥ InlineShardingStrategy</h4>
<p>ä¸å‰é¢ä»‹ç»çš„å„ç§åˆ†ç‰‡ç­–ç•¥ç›¸æ¯”ï¼ŒInlineShardingStrategy é‡‡ç”¨äº†ä¸€ç§ç‰¹æ®Šçš„æœºåˆ¶æ¥å®ç°è·¯ç”±ã€‚</p>
<p>æˆ‘ä»¬å·²ç»åœ¨ä»‹ç»åˆ†åº“åˆ†è¡¨æ¡ˆä¾‹ä¸­å¤§é‡ä½¿ç”¨äº†è¡Œè¡¨è¾¾å¼ï¼Œä¹ŸçŸ¥é“åœ¨ä½¿ç”¨è¡Œè¡¨è¾¾å¼æ—¶éœ€è¦æŒ‡å®šä¸€ä¸ªåˆ†ç‰‡åˆ— shardingColumn ä»¥åŠä¸€ä¸ªç±»ä¼¼ ds$-&gt;{user_id % 2} çš„è¡¨è¾¾å¼ã€‚</p>
<p>ä½ å¯èƒ½ä¼šå¥½å¥‡ ShardingSphere æ˜¯å¦‚ä½•æ¥è§£æè¿™æ ·çš„è¡¨è¾¾å¼çš„å‘¢ï¼ŸåŸºäº InlineShardingStrategy å®šä¹‰çš„å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°é—®é¢˜çš„ç­”æ¡ˆï¼š</p>
<pre tabindex="0"><code>//åˆ†ç‰‡åˆ— 
private final String shardingColumn; 
//Groovy ä¸­çš„ Closure å®ä¾‹ 
private final Closure&lt;?&gt; closure;
</code></pre><p>åŸæ¥ï¼ŒShardingSphere åœ¨è¿™é‡Œç”¨åˆ°äº† Groovy ä¸­çš„ Closure å¯¹è±¡ã€‚Groovy æ˜¯å¯è¿è¡Œåœ¨ JVM ä¸­çš„ä¸€ç§åŠ¨æ€è¯­è¨€ï¼Œæ—¢å¯ä»¥ç”¨äºé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œåˆå¯ä»¥ç”¨ä½œçº¯ç²¹çš„è„šæœ¬è¯­è¨€ã€‚ä½¿ç”¨è¯¥ç§è¯­è¨€ä¸å¿…ç¼–å†™è¿‡å¤šçš„ä»£ç ï¼ŒåŒæ—¶åˆå…·æœ‰ Closure å’ŒåŠ¨æ€è¯­è¨€ä¸­çš„å…¶ä»–ç‰¹æ€§ã€‚åœ¨ä½¿ç”¨æ–¹å¼ä¸Šï¼ŒåŸºæœ¬ä¹Ÿä¸ä½¿ç”¨ Java ä»£ç çš„æ–¹å¼ç›¸åŒã€‚</p>
<p>åŸºäº Groovy çš„åŠ¨æ€è¯­è¨€ç‰¹æ€§ï¼ŒInlineShardingStrategy æä¾›å¯¹ SQL è¯­å¥ä¸­çš„ = å’Œ IN çš„åˆ†ç‰‡æ“ä½œæ”¯æŒï¼Œç›®å‰åªæ”¯æŒå•åˆ†ç‰‡é”®ã€‚å¯¹äºç±»ä¼¼ ds$-&gt;{user_id % 2} è¿™æ ·çš„å¸¸è§åˆ†ç‰‡ç®—æ³•ï¼Œå¯ä»¥é€šè¿‡ç®€å•é…ç½®è¿›è¡Œä½¿ç”¨ï¼Œä»è€Œé¿å…çƒ¦ççš„ Java ä»£ç å¼€å‘ã€‚</p>
<p>æˆ‘ä»¬ç›´æ¥æ¥åˆ° InlineShardingStrategy çš„ doSharding æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å®ç°è¿‡ç¨‹ä¸æ ‡å‡†åˆ†ç‰‡ç­–ç•¥ StandardShardingStrategy ä¸­çš„ç›¸åŒï¼Œä¸åŒçš„æ˜¯éœ€è¦é€šè¿‡ Groovy è¿›è¡Œè§£æè¾“å…¥å‚æ•°ä»è€Œè·å–æœ€ç»ˆè·¯ç”±ç»“æœï¼š</p>
<pre tabindex="0"><code>private Collection&lt;String&gt; doSharding(final ListRouteValue shardingValue) { 
    Collection&lt;String&gt; result = new LinkedList&lt;&gt;(); 
    for (PreciseShardingValue&lt;?&gt; each : transferToPreciseShardingValues(shardingValue)) { 
     //é€šè¿‡ execute æ–¹æ³•è§£æå‡ºæœ€ç»ˆçš„ç»“æœ 
        result.add(execute(each)); 
    } 
    return result; 
}
</code></pre><p>è¿™é‡Œçš„ execute æ–¹æ³•ä¸­æ„å»ºäº† Groovy çš„ Closure å¯¹è±¡ï¼Œå¹¶è®¾ç½®äº†å¯¹åº”çš„è§£æç­–ç•¥ä»¥åŠæ‰€éœ€è¦è§£æçš„å±æ€§ï¼Œå¹¶æœ€ç»ˆè¿”å›è§£æçš„ç»“æœï¼š</p>
<pre tabindex="0"><code>private String execute(final PreciseShardingValue shardingValue) { 
     //æ„å»º Groovy çš„ Closur eå¯¹è±¡ 
    Closure&lt;?&gt; result = closure.rehydrate(new Expando(), null, null); 
    result.setResolveStrategy(Closure.DELEGATE_ONLY); 
    result.setProperty(shardingColumn, shardingValue.getValue()); 
    //è·å–è§£æç»“æœ 
    return result.call().toString(); 
}
</code></pre><p>æœ€åï¼Œä½œä¸ºæ€»ç»“ï¼Œæˆ‘ä»¬è¦æ³¨æ„æ‰€æœ‰çš„ ShardingStrategy ç›¸å…³ç±»éƒ½ä½äº sharding-core-common å·¥ç¨‹çš„ org.apache.shardingsphere.core.strategy åŒ…ä¸‹ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl86Zp-AOn75AAII97S_QVE429.png" alt="Drawing 4.png"></p>
<p>ShardingStrategy ç›¸å…³ç±»çš„åŒ…ç»“æ„</p>
<p>è€Œæ‰€æœ‰çš„ ShardingAlgorithm ç›¸å…³ç±»åˆ™ä½äº sharding-core-api å·¥ç¨‹çš„ org.apache.shardingsphere.api.sharding åŒ…ä¸‹ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl86ZqeAEn76AAGjHlgYljM135.png" alt="Drawing 5.png"></p>
<p>ShardingAlgorithm ç›¸å…³ç±»çš„åŒ…ç»“æ„</p>
<p>æˆ‘ä»¬åœ¨å‰é¢å·²ç»æåˆ°è¿‡ ShardingStrategy çš„åˆ›å»ºä¾èµ–äº ShardingStrategyConfigurationï¼ŒShardingSphere ä¹Ÿæä¾›äº†ä¸€ä¸ª ShardingStrategyFactory å·¥å‚ç±»ç”¨äºåˆ›å»ºå„ç§å…·ä½“çš„ ShardingStrategyï¼š</p>
<pre tabindex="0"><code>public final class ShardingStrategyFactory { 

    public static ShardingStrategy newInstance(final ShardingStrategyConfiguration shardingStrategyConfig) { 
        if (shardingStrategyConfig instanceof StandardShardingStrategyConfiguration) { 
            return new StandardShardingStrategy((StandardShardingStrategyConfiguration) shardingStrategyConfig); 
        } 
        if (shardingStrategyConfig instanceof InlineShardingStrategyConfiguration) { 
            return new InlineShardingStrategy((InlineShardingStrategyConfiguration) shardingStrategyConfig); 
        } 
        if (shardingStrategyConfig instanceof ComplexShardingStrategyConfiguration) { 
            return new ComplexShardingStrategy((ComplexShardingStrategyConfiguration) shardingStrategyConfig); 
        } 
        if (shardingStrategyConfig instanceof HintShardingStrategyConfiguration) { 
            return new HintShardingStrategy((HintShardingStrategyConfiguration) shardingStrategyConfig); 
        } 
        return new NoneShardingStrategy(); 
    } 
}
</code></pre><p>è€Œè¿™é‡Œç”¨åˆ°çš„å„ç§ ShardingStrategyConfiguration ä¹Ÿéƒ½ä½äº sharding-core-api å·¥ç¨‹çš„org.apache.shardingsphere.api.sharding.strategy åŒ…ä¸‹ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl86ZrGAJLi5AADslitwfjk537.png" alt="Drawing 6.png"></p>
<p>ShardingStrategyConfiguration ç›¸å…³ç±»çš„åŒ…ç»“æ„</p>
<p>è¿™æ ·ï¼Œé€šè¿‡å¯¹è·¯ç”±å¼•æ“çš„ä»‹ç»ï¼Œæˆ‘ä»¬åˆæ¥è§¦åˆ°äº†ä¸€å¤§æ‰¹ ShardingSphere ä¸­çš„æºä»£ç ã€‚</p>
<p>è‡³æ­¤ï¼Œå…³äº ShardingSphere è·¯ç”±å¼•æ“éƒ¨åˆ†çš„å†…å®¹åŸºæœ¬éƒ½ä»‹ç»å®Œæ¯•ã€‚ä½œä¸ºæ€»ç»“ï¼Œæˆ‘ä»¬åœ¨ã€Š17 | è·¯ç”±å¼•æ“ï¼šå¦‚ä½•ç†è§£åˆ†ç‰‡è·¯ç”±æ ¸å¿ƒç±» ShardingRouter çš„è¿ä½œæœºåˆ¶ï¼Ÿã€‹ä¸­æ‰€ç»™å‡ºçš„æ—¶åºå›¾ä¸­æ·»åŠ äº† ShardingStrategy å’Œ ShardingAlgorithm éƒ¨åˆ†çš„å†…å®¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl86ZrmAcGiLAADURjzyD4w363.png" alt="Drawing 7.png"></p>
<h3 id="ä»æºç è§£æåˆ°æ—¥å¸¸å¼€å‘">ä»æºç è§£æåˆ°æ—¥å¸¸å¼€å‘</h3>
<p>åœ¨æˆ‘ä»¬è®¾è®¡è½¯ä»¶ç³»ç»Ÿçš„è¿‡ç¨‹ä¸­ï¼Œé¢å¯¹å¤æ‚ä¸šåŠ¡åœºæ™¯æ—¶ï¼Œ<strong>èŒè´£åˆ†ç¦»</strong>å§‹ç»ˆæ˜¯éœ€è¦è€ƒè™‘çš„ä¸€ä¸ªè®¾è®¡ç‚¹ã€‚ShardingSphere å¯¹äºåˆ†ç‰‡ç­–ç•¥çš„è®¾è®¡å’Œå®ç°å¾ˆå¥½åœ°å°è¯äº†è¿™ä¸€è§‚ç‚¹ã€‚</p>
<p>åˆ†ç‰‡ç­–ç•¥åœ¨ ShardingSphere ä¸­å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„æ¦‚å¿µï¼Œä½†é€šè¿‡å°†åˆ†ç‰‡çš„å…·ä½“ç®—æ³•åˆ†ç¦»å‡ºå»å¹¶æç‚¼ ShardingAlgorithm æ¥å£ï¼Œå¹¶æ„å»º ShardingStrategy å’Œ ShardingAlgorithm ä¹‹é—´ä¸€å¯¹å¤šçš„çµæ´»å…³è”å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°æŠŠæ¡æ•´ä¸ªåˆ†ç‰‡ç­–ç•¥ä½“ç³»çš„ç±»å±‚ç»“æ„ï¼Œè¿™ç§èŒè´£åˆ†ç¦»æœºåˆ¶åŒæ ·å¯ä»¥åº”ç”¨ä¸æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­ã€‚</p>
<h3 id="å°ç»“ä¸é¢„å‘Š">å°ç»“ä¸é¢„å‘Š</h3>
<p>æ‰¿æ¥ä¸Šä¸€è¯¾æ—¶çš„å†…å®¹ï¼Œä»Šå¤©æˆ‘ä»¬å…¨é¢ä»‹ç»äº† ShardingSphere ä¸­çš„äº”å¤§åˆ†ç‰‡ç­–ç•¥å’Œå››ç§åˆ†ç‰‡ç®—æ³•ä»¥åŠå®ƒä»¬ä¹‹é—´çš„ç»„åˆå…³ç³»ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl86ZsaAQx7cAABspIBuz1Y073.png" alt="Drawing 9.png"></p>
<p>ShardingSphere è·¯ç”±å¼•æ“ä¸­æ‰§è¡Œè·¯ç”±çš„è¿‡ç¨‹æ­£æ˜¯ä¾èµ–äºè¿™äº›åˆ†ç‰‡ç­–ç•¥å’Œåˆ†ç‰‡ç®—æ³•çš„åŠŸèƒ½ç‰¹æ€§ã€‚å½“ç„¶ï¼Œä½œä¸ºä¸€æ¬¾å…·æœ‰é«˜æ‰©å±•æ€§çš„å¼€æºæ¡†æ¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åŸºäºè‡ªèº«çš„ä¸šåŠ¡éœ€æ±‚ï¼Œå®ç°ç‰¹å®šçš„åˆ†ç‰‡ç®—æ³•å¹¶åµŒå…¥åˆ°å…·ä½“çš„åˆ†ç‰‡ç­–ç•¥ä¸­ã€‚</p>
<p>è¿™é‡Œç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜ï¼šShardingSphere ä¸­åˆ†ç‰‡ç­–ç•¥ä¸åˆ†ç‰‡ç®—æ³•ä¹‹é—´æ˜¯å¦‚ä½•åä½œçš„ï¼Ÿ æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸å¤§å®¶è®¨è®ºï¼Œæˆ‘å°†ä¸€ä¸€ç‚¹è¯„è§£ç­”ã€‚</p>
<p>åœ¨è·¯ç”±å¼•æ“çš„åŸºç¡€ä¸Šï¼Œä¸‹ä¸€è¯¾æ—¶å°†è¿›å…¥ ShardingSphere åˆ†ç‰‡å¼•æ“çš„å¦ä¸€ä¸ªæ ¸å¿ƒé˜¶æ®µï¼Œå³æ”¹å†™å¼•æ“ã€‚</p>

        </div>
    </article>
</div>
<div class="division-line"></div>
<div class="others">
    <div>æ ‡ç­¾ï¼šğŸ·ï¸<a class="post-tag" href="/tags/sharding/">sharding</a>&nbsp;</div>
    <div>åˆ†ç±»ï¼š ğŸ“’<a class="post-category" href="/categories/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/">ShardingSphereæ ¸å¿ƒåŸç†ç²¾è®²</a>&nbsp; </div>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/18-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E7%9A%84%E5%88%86%E7%89%87%E8%B7%AF%E7%94%B1%E5%92%8C%E5%B9%BF%E6%92%AD%E8%B7%AF%E7%94%B1/"><span>18 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•å®ç°æ•°æ®è®¿é—®çš„åˆ†ç‰‡è·¯ç”±å’Œå¹¿æ’­è·¯ç”±ï¼Ÿ</span></a>
    </div>
    <div class="next">
        
        <a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/20-%E6%94%B9%E5%86%99%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84-sql-%E6%94%B9%E5%86%99%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6/"><span>20 æ”¹å†™å¼•æ“ï¼šå¦‚ä½•ç†è§£è£…é¥°å™¨æ¨¡å¼ä¸‹çš„ SQL æ”¹å†™å®ç°æœºåˆ¶ï¼Ÿ</span></a>
    </div>
</div>

        </div>
        <div id="float">
            <ul class="float-button-bar">
    <li>
        <button class="float-button top" onclick="scrollToTop(this);">UP</button>
    </li>
    <li>
        <button class="float-button toggler" onclick="changeSkin(this);">DARK</button>
    </li>
</ul>
        </div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 2020 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    const changeSkin = () => {
        document.getElementById('page').classList.toggle('night');
    }
    const scrollToTop = () => {
        window.scrollTo(0, 0);
    }
</script>
</body>

</html>