<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>29 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šShardingSphere ä¸­å¦‚ä½•é›†æˆå¼ºä¸€è‡´æ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡æ”¯æŒï¼Ÿï¼ˆä¸‹ï¼‰ | Yipsen Ye</title>
<meta name="description" content="åœ¨ä¸Šä¸€è¯¾æ—¶ä¸­ï¼Œæˆ‘ä»¬é’ˆå¯¹ ShardingSphere ä¸­æ”¯æŒå¼ºä¸€è‡´æ€§äº‹åŠ¡çš„ XAShardingTransactionManager çš„éƒ¨åˆ†å†…å®¹è¿›è¡Œäº†è¯¦ç»†çš„å±•å¼€ï¼Œä»Šå¤©æˆ‘ä»¬ç»§ç»­è®²è§£è¯¥ç±»çš„å‰©ä½™å†…å®¹ï¼ŒåŒæ—¶ä¹Ÿä¼šä»‹ç»æ”¯æŒæŸ”æ€§äº‹åŠ¡çš„ SeataATShardingTransactionManagerã€‚
XAShardingTransactionManager å…³äº XAShardingTransactionManagerï¼Œä¸Šä¸€è®²ä¸­æˆ‘ä»¬ä»‹ç»äº† XADataSourceã€XAConnection å’Œ XATransactionDataSource ç­‰æ ¸å¿ƒç±»ã€‚
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨ä¸Šä¸€è®²çš„åŸºç¡€ä¸Šç»™å‡º XATransactionManager å’Œ ShardingConnection ç±»çš„å®ç°è¿‡ç¨‹ã€‚
1.XATransactionManager è®©æˆ‘ä»¬å…ˆå›åˆ° XAShardingTransactionManagerã€‚æˆ‘ä»¬å·²ç»åœ¨å‰é¢ä»‹ç»äº† XAShardingTransactionManager ä¸­çš„å˜é‡ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å®ƒæ‰€å®ç°çš„æ–¹æ³•ï¼Œé¦–å…ˆæ˜¯å¦‚ä¸‹æ‰€ç¤ºçš„ init æ–¹æ³•ï¼š
public void init(final DatabaseType databaseType, final Collection&amp;lt;ResourceDataSource&amp;gt; resourceDataSources) {for (ResourceDataSource each : resourceDataSources) {//åˆ›å»ºXATransactionDataSourceå¹¶è¿›è¡Œç¼“å­˜cachedDataSources.put(each.getOriginalName(), new XATransactionDataSource(databaseType, each.getUniqueResourceName(), each.getDataSource(), xaTransactionManager));}//åˆå§‹åŒ–XATransactionManagerxaTransactionManager.init();}ä¸Šè¿°æ–¹æ³•æ ¹æ®ä¼ å…¥çš„ ResourceDataSource æ„å»ºäº† XATransactionDataSource å¹¶æ”¾å…¥ç¼“å­˜ä¸­ï¼ŒåŒæ—¶å¯¹é€šè¿‡ SPI æœºåˆ¶åˆ›å»ºçš„ XATransactionManager ä¹Ÿæ‰§è¡Œäº†å®ƒçš„ init æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ã€‚
XAShardingTransactionManager çš„ getTransactionTypeã€isInTransaction å’Œ getConnection æ–¹æ³•éƒ½æ¯”è¾ƒç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
@Overridepublic TransactionType getTransactionType() {return TransactionType.">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/shardingsphere%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86%e7%b2%be%e8%ae%b2/">ShardingSphereæ ¸å¿ƒåŸç†ç²¾è®²</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/00-%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E5%AD%A6%E4%B9%A0%E4%B8%80%E6%AC%BE%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E5%BC%80%E6%BA%90%E6%A1%86%E6%9E%B6/">00 å¦‚ä½•æ­£ç¡®å­¦ä¹ ä¸€æ¬¾åˆ†åº“åˆ†è¡¨å¼€æºæ¡†æ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/01-%E4%BB%8E%E7%90%86%E8%AE%BA%E5%88%B0%E5%AE%9E%E8%B7%B5%E5%A6%82%E4%BD%95%E8%AE%A9%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E7%9C%9F%E6%AD%A3%E8%90%BD%E5%9C%B0/">01 ä»ç†è®ºåˆ°å®è·µï¼šå¦‚ä½•è®©åˆ†åº“åˆ†è¡¨çœŸæ­£è½åœ°ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/02-%E9%A1%B6%E7%BA%A7%E9%A1%B9%E7%9B%AEshardingsphere-%E6%98%AF%E4%B8%80%E6%AC%BE%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84-apache-%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6/">02 é¡¶çº§é¡¹ç›®ï¼šShardingSphere æ˜¯ä¸€æ¬¾ä»€ä¹ˆæ ·çš„ Apache å¼€æºè½¯ä»¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/03-%E8%A7%84%E8%8C%83%E5%85%BC%E5%AE%B9jdbc-%E8%A7%84%E8%8C%83%E4%B8%8E-shardingsphere-%E6%98%AF%E4%BB%80%E4%B9%88%E5%85%B3%E7%B3%BB/">03 è§„èŒƒå…¼å®¹ï¼šJDBC è§„èŒƒä¸ ShardingSphere æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/04-%E5%BA%94%E7%94%A8%E9%9B%86%E6%88%90%E5%9C%A8%E4%B8%9A%E5%8A%A1%E7%B3%BB%E7%BB%9F%E4%B8%AD%E4%BD%BF%E7%94%A8-shardingsphere-%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B/">04 åº”ç”¨é›†æˆï¼šåœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ä½¿ç”¨ ShardingSphere çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/05-%E9%85%8D%E7%BD%AE%E9%A9%B1%E5%8A%A8shardingsphere-%E4%B8%AD%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BD%93%E7%B3%BB%E6%98%AF%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E7%9A%84/">05 é…ç½®é©±åŠ¨ï¼šShardingSphere ä¸­çš„é…ç½®ä½“ç³»æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/09-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E4%B8%8E%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1/">09 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ä½¿ç”¨å¼ºä¸€è‡´æ€§äº‹åŠ¡ä¸æŸ”æ€§äº‹åŠ¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/10-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E5%A6%82%E4%BD%95%E7%A1%AE%E4%BF%9D%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%89%E5%85%A8%E8%AE%BF%E9%97%AE/">10 æ•°æ®è„±æ•ï¼šå¦‚ä½•ç¡®ä¿æ•æ„Ÿæ•°æ®çš„å®‰å…¨è®¿é—®ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/11-%E7%BC%96%E6%8E%92%E6%B2%BB%E7%90%86%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E5%8A%A8%E6%80%81%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/">11 ç¼–æ’æ²»ç†ï¼šå¦‚ä½•å®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„åŠ¨æ€é…ç½®ç®¡ç†ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/12-%E4%BB%8E%E5%BA%94%E7%94%A8%E5%88%B0%E5%8E%9F%E7%90%86%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E9%98%85%E8%AF%BB-shardingsphere-%E6%BA%90%E7%A0%81/">12 ä»åº”ç”¨åˆ°åŸç†ï¼šå¦‚ä½•é«˜æ•ˆé˜…è¯» ShardingSphere æºç ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/13-%E5%BE%AE%E5%86%85%E6%A0%B8%E6%9E%B6%E6%9E%84shardingsphere-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%89%A9%E5%B1%95%E6%80%A7/">13 å¾®å†…æ ¸æ¶æ„ï¼šShardingSphere å¦‚ä½•å®ç°ç³»ç»Ÿçš„æ‰©å±•æ€§ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/14-%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AEshardingsphere-%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AE%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/">14 åˆ†å¸ƒå¼ä¸»é”®ï¼šShardingSphere ä¸­æœ‰å“ªäº›åˆ†å¸ƒå¼ä¸»é”®å®ç°æ–¹å¼ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/15-%E8%A7%A3%E6%9E%90%E5%BC%95%E6%93%8Esql-%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%8C%85%E6%8B%AC%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E9%98%B6%E6%AE%B5%E4%B8%8A/">15 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/16-%E8%A7%A3%E6%9E%90%E5%BC%95%E6%93%8Esql-%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%8C%85%E6%8B%AC%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E9%98%B6%E6%AE%B5%E4%B8%8B/">16 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/17-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E5%88%86%E7%89%87%E8%B7%AF%E7%94%B1%E6%A0%B8%E5%BF%83%E7%B1%BB-shardingrouter-%E7%9A%84%E8%BF%90%E4%BD%9C%E6%9C%BA%E5%88%B6/">17 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•ç†è§£åˆ†ç‰‡è·¯ç”±æ ¸å¿ƒç±» ShardingRouter çš„è¿ä½œæœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/18-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E7%9A%84%E5%88%86%E7%89%87%E8%B7%AF%E7%94%B1%E5%92%8C%E5%B9%BF%E6%92%AD%E8%B7%AF%E7%94%B1/">18 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•å®ç°æ•°æ®è®¿é—®çš„åˆ†ç‰‡è·¯ç”±å’Œå¹¿æ’­è·¯ç”±ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/19-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E5%9C%A8%E8%B7%AF%E7%94%B1%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%9B%86%E6%88%90%E5%A4%9A%E7%A7%8D%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5%E5%92%8C%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95/">19 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•åœ¨è·¯ç”±è¿‡ç¨‹ä¸­é›†æˆå¤šç§è·¯ç”±ç­–ç•¥å’Œè·¯ç”±ç®—æ³•ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/20-%E6%94%B9%E5%86%99%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84-sql-%E6%94%B9%E5%86%99%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6/">20 æ”¹å†™å¼•æ“ï¼šå¦‚ä½•ç†è§£è£…é¥°å™¨æ¨¡å¼ä¸‹çš„ SQL æ”¹å†™å®ç°æœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/21-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%88%86%E7%89%87%E7%8E%AF%E5%A2%83%E4%B8%8B-sql-%E6%89%A7%E8%A1%8C%E7%9A%84%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E6%8A%BD%E8%B1%A1/">21 æ‰§è¡Œå¼•æ“ï¼šåˆ†ç‰‡ç¯å¢ƒä¸‹ SQL æ‰§è¡Œçš„æ•´ä½“æµç¨‹åº”è¯¥å¦‚ä½•è¿›è¡ŒæŠ½è±¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/22-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E6%8A%8A%E6%8F%A1-shardingsphere-%E4%B8%AD%E7%9A%84-executor-%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B%E4%B8%8A/">22 æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•æŠŠæ¡ ShardingSphere ä¸­çš„ Executor æ‰§è¡Œæ¨¡å‹ï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/23-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E6%8A%8A%E6%8F%A1-shardingsphere-%E4%B8%AD%E7%9A%84-executor-%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B%E4%B8%8B/">23 æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•æŠŠæ¡ ShardingSphere ä¸­çš„ Executor æ‰§è¡Œæ¨¡å‹ï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/24-%E5%BD%92%E5%B9%B6%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%95%B0%E6%8D%AE%E5%BD%92%E5%B9%B6%E7%9A%84%E7%B1%BB%E5%9E%8B%E4%BB%A5%E5%8F%8A%E7%AE%80%E5%8D%95%E5%BD%92%E5%B9%B6%E7%AD%96%E7%95%A5%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/">24 å½’å¹¶å¼•æ“ï¼šå¦‚ä½•ç†è§£æ•°æ®å½’å¹¶çš„ç±»å‹ä»¥åŠç®€å•å½’å¹¶ç­–ç•¥çš„å®ç°è¿‡ç¨‹ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/25-%E5%BD%92%E5%B9%B6%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%B5%81%E5%BC%8F%E5%BD%92%E5%B9%B6%E5%92%8C%E5%86%85%E5%AD%98%E5%BD%92%E5%B9%B6%E5%9C%A8%E5%A4%8D%E6%9D%82%E5%BD%92%E5%B9%B6%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84%E5%BA%94%E7%94%A8%E6%96%B9%E5%BC%8F/">25 å½’å¹¶å¼•æ“ï¼šå¦‚ä½•ç†è§£æµå¼å½’å¹¶å’Œå†…å­˜å½’å¹¶åœ¨å¤æ‚å½’å¹¶åœºæ™¯ä¸‹çš„åº”ç”¨æ–¹å¼ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/26-%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%99%AE%E9%80%9A%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84%E5%92%8C%E5%88%86%E7%89%87%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84%E5%88%86%E5%88%AB%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%9A%84/">26 è¯»å†™åˆ†ç¦»ï¼šæ™®é€šä¸»ä»æ¶æ„å’Œåˆ†ç‰‡ä¸»ä»æ¶æ„åˆ†åˆ«æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/27-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3-shardingsphere-%E4%B8%AD%E5%AF%B9%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%8A%BD%E8%B1%A1%E8%BF%87%E7%A8%8B/">27 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ç†è§£ ShardingSphere ä¸­å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„æŠ½è±¡è¿‡ç¨‹ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/28-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1shardingsphere-%E4%B8%AD%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E5%92%8C%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1%E6%94%AF%E6%8C%81%E4%B8%8A/">28 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šShardingSphere ä¸­å¦‚ä½•é›†æˆå¼ºä¸€è‡´æ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡æ”¯æŒï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li>29 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šShardingSphere ä¸­å¦‚ä½•é›†æˆå¼ºä¸€è‡´æ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡æ”¯æŒï¼Ÿï¼ˆä¸‹ï¼‰</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/30-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E6%94%B9%E5%86%99%E5%BC%95%E6%93%8E%E5%AE%9E%E7%8E%B0%E4%BD%8E%E4%BE%B5%E5%85%A5%E6%80%A7%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E6%96%B9%E6%A1%88/">30 æ•°æ®è„±æ•ï¼šå¦‚ä½•åŸºäºæ”¹å†™å¼•æ“å®ç°ä½ä¾µå…¥æ€§æ•°æ®è„±æ•æ–¹æ¡ˆï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/31-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%AE%9E%E7%8E%B0%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E7%9A%84%E5%8A%A8%E6%80%81%E5%8C%96%E7%AE%A1%E7%90%86/">31 é…ç½®ä¸­å¿ƒï¼šå¦‚ä½•åŸºäºé…ç½®ä¸­å¿ƒå®ç°é…ç½®ä¿¡æ¯çš„åŠ¨æ€åŒ–ç®¡ç†ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/32-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BF%E9%97%AE%E7%86%94%E6%96%AD%E6%9C%BA%E5%88%B6/">32 æ³¨å†Œä¸­å¿ƒï¼šå¦‚ä½•åŸºäºæ³¨å†Œä¸­å¿ƒå®ç°æ•°æ®åº“è®¿é—®ç†”æ–­æœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/33-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E-hook-%E6%9C%BA%E5%88%B6%E4%BB%A5%E5%8F%8A-opentracing-%E5%8D%8F%E8%AE%AE%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/">33 é“¾è·¯è·Ÿè¸ªï¼šå¦‚ä½•åŸºäº Hook æœºåˆ¶ä»¥åŠ OpenTracing åè®®å®ç°æ•°æ®è®¿é—®é“¾è·¯è·Ÿè¸ªï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/35-%E7%BB%93%E8%AF%ADshardingsphere-%E6%80%BB%E7%BB%93%E5%8F%8A%E5%B1%95%E6%9C%9B/">35 ç»“è¯­ï¼šShardingSphere æ€»ç»“åŠå±•æœ›</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">29 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šShardingSphere ä¸­å¦‚ä½•é›†æˆå¼ºä¸€è‡´æ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡æ”¯æŒï¼Ÿï¼ˆä¸‹ï¼‰</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2021-12-22 01:56:09</span>ğŸ·ï¸&nbsp;<a class="post-tag" href="/tags/sharding/">sharding</a></div><div class="post-category">
                
                ğŸ“š&nbsp;<a href="/categories/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/">ShardingSphereæ ¸å¿ƒåŸç†ç²¾è®²</a>
                
            </div></div>
        <div class="post-content">
            <p>åœ¨ä¸Šä¸€è¯¾æ—¶ä¸­ï¼Œæˆ‘ä»¬é’ˆå¯¹ ShardingSphere ä¸­æ”¯æŒå¼ºä¸€è‡´æ€§äº‹åŠ¡çš„ XAShardingTransactionManager çš„éƒ¨åˆ†å†…å®¹è¿›è¡Œäº†è¯¦ç»†çš„å±•å¼€ï¼Œä»Šå¤©æˆ‘ä»¬ç»§ç»­è®²è§£è¯¥ç±»çš„å‰©ä½™å†…å®¹ï¼ŒåŒæ—¶ä¹Ÿä¼šä»‹ç»æ”¯æŒæŸ”æ€§äº‹åŠ¡çš„ SeataATShardingTransactionManagerã€‚</p>
<h3 id="xashardingtransactionmanager">XAShardingTransactionManager</h3>
<p>å…³äº XAShardingTransactionManagerï¼Œä¸Šä¸€è®²ä¸­æˆ‘ä»¬ä»‹ç»äº† XADataSourceã€XAConnection å’Œ XATransactionDataSource ç­‰æ ¸å¿ƒç±»ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨ä¸Šä¸€è®²çš„åŸºç¡€ä¸Šç»™å‡º XATransactionManager å’Œ ShardingConnection ç±»çš„å®ç°è¿‡ç¨‹ã€‚</p>
<h4 id="1xatransactionmanager">1.XATransactionManager</h4>
<p>è®©æˆ‘ä»¬å…ˆå›åˆ° XAShardingTransactionManagerã€‚æˆ‘ä»¬å·²ç»åœ¨å‰é¢ä»‹ç»äº† XAShardingTransactionManager ä¸­çš„å˜é‡ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å®ƒæ‰€å®ç°çš„æ–¹æ³•ï¼Œé¦–å…ˆæ˜¯å¦‚ä¸‹æ‰€ç¤ºçš„ init æ–¹æ³•ï¼š</p>
<pre tabindex="0"><code>public void init(final DatabaseType databaseType, final Collection&lt;ResourceDataSource&gt; resourceDataSources) {
        for (ResourceDataSource each : resourceDataSources) {
           //åˆ›å»ºXATransactionDataSourceå¹¶è¿›è¡Œç¼“å­˜
            cachedDataSources.put(each.getOriginalName(), new XATransactionDataSource(databaseType, each.getUniqueResourceName(), each.getDataSource(), xaTransactionManager));
        }
       //åˆå§‹åŒ–XATransactionManager
        xaTransactionManager.init();
}
</code></pre><p>ä¸Šè¿°æ–¹æ³•æ ¹æ®ä¼ å…¥çš„ ResourceDataSource æ„å»ºäº† XATransactionDataSource å¹¶æ”¾å…¥ç¼“å­˜ä¸­ï¼ŒåŒæ—¶å¯¹é€šè¿‡ SPI æœºåˆ¶åˆ›å»ºçš„ XATransactionManager ä¹Ÿæ‰§è¡Œäº†å®ƒçš„ init æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ã€‚</p>
<p>XAShardingTransactionManager çš„ getTransactionTypeã€isInTransaction å’Œ getConnection æ–¹æ³•éƒ½æ¯”è¾ƒç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>@Override
public TransactionType getTransactionType() {
        return TransactionType.XA;
}

@Override
public boolean isInTransaction() {
        return Status.STATUS_NO_TRANSACTION != xaTransactionManager.getTransactionManager().getStatus();
}
 
@Override
public Connection getConnection(final String dataSourceName) throws SQLException {
        try {
            return cachedDataSources.get(dataSourceName).getConnection();
        } catch (final SystemException | RollbackException ex) {
            throw new SQLException(ex);
        }
}
</code></pre><p>è€Œä¸äº‹åŠ¡æ“ä½œç›¸å…³çš„ beginã€commit å’Œ rollback æ–¹æ³•çš„å®ç°åŒæ ·æ¯”è¾ƒç®€å•ï¼Œéƒ½æ˜¯ç›´æ¥å§”æ‰˜ä¿å­˜åœ¨ XATransactionManager ä¸­çš„ TransactionManager è¿›è¡Œå®Œæˆï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>@Override
public void begin() {
        xaTransactionManager.getTransactionManager().begin();
}

@Override
public void commit() {
        xaTransactionManager.getTransactionManager().commit();
}

@Override
public void rollback() {
        xaTransactionManager.getTransactionManager().rollback();
}
</code></pre><p>è‡³æ­¤ï¼Œsharding-transaction-xa-core å·¥ç¨‹ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½å·²ç»ä»‹ç»å®Œæ¯•ã€‚è®©æˆ‘ä»¬è½¬åˆ° sharding-transaction-xa-atomikos-manager å·¥ç¨‹ï¼Œçœ‹çœ‹ AtomikosTransactionManager çš„å®ç°ï¼Œè¿™ä¹Ÿæ˜¯ ShardingSphere ä¸­å…³äº TransactionManager çš„é»˜è®¤å®ç°ã€‚</p>
<p>è€Œåœ¨æ­¤ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ä»£è¡¨èµ„æºçš„ AtomikosXARecoverableResource çš„å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public final class AtomikosXARecoverableResource extends JdbcTransactionalResource {

    private final String resourceName;

    AtomikosXARecoverableResource(final String serverName, final XADataSource xaDataSource) {
        super(serverName, xaDataSource);
        resourceName = serverName;
    }

    @Override
    public boolean usesXAResource(final XAResource xaResource) {
        return resourceName.equals(((SingleXAResource) xaResource).getResourceName());
    }
}
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„ usesXAResource æ–¹æ³•å®é™…ä¸Šå°±æ˜¯é€šè¿‡åŸºäºå¯¹ SingleXAResource çš„ ResourceName è¿›è¡Œæ¯”å¯¹æ¥ç¡®å®šæ˜¯å¦åœ¨ä½¿ç”¨èµ„æºï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦è®¾è®¡åŒ…è£…äº† XAResource çš„ SingleXAResource ç±»çš„åŸå› ã€‚</p>
<p>AtomikosTransactionManager ä¸­ä½¿ç”¨äº† AtomikosXARecoverableResourceï¼Œå…¶å®ç°è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public final class AtomikosTransactionManager implements XATransactionManager {

    private final UserTransactionManager transactionManager = new UserTransactionManager();

    private final UserTransactionService userTransactionService = new UserTransactionServiceImp();

    @Override
    public void init() {
        userTransactionService.init();
    }

    @Override
    public void registerRecoveryResource(final String dataSourceName, final XADataSource xaDataSource) {
        userTransactionService.registerResource(new AtomikosXARecoverableResource(dataSourceName, xaDataSource));
    }

    @Override
    public void removeRecoveryResource(final String dataSourceName, final XADataSource xaDataSource) {
        userTransactionService.removeResource(new AtomikosXARecoverableResource(dataSourceName, xaDataSource));
    }

    @Override
    @SneakyThrows
    public void enlistResource(final SingleXAResource xaResource) {
        transactionManager.getTransaction().enlistResource(xaResource);
    }

    @Override
    public TransactionManager getTransactionManager() {
        return transactionManager;
    }

    @Override
    public void close() {
        userTransactionService.shutdown(true);
    }
}
</code></pre><p>ä¸Šè¿°æ–¹æ³•æœ¬è´¨ä¸Šéƒ½æ˜¯å¯¹ Atomikos çš„ UserTransactionManager å’Œ UserTransactionService çš„ç®€å•è°ƒç”¨ï¼Œæ³¨æ„åˆ° Atomikos çš„ UserTransactionManager å®ç°äº† TransactionManager æ¥å£ï¼Œå°è£…äº†æ‰€æœ‰ TransactionManager éœ€è¦å®Œæˆçš„å·¥ä½œã€‚</p>
<p>çœ‹å®Œ sharding-transaction-xa-atomikos-manager å·¥ç¨‹ä¹‹åï¼Œæˆ‘ä»¬æ¥åˆ°å¦ä¸€ä¸ª sharding-transaction-xa-bitronix-manager å·¥ç¨‹ï¼Œè¯¥å·¥ç¨‹æä¾›äº†åŸºäº bitronix çš„ XATransactionManager å®ç°æ–¹æ¡ˆï¼Œå³ BitronixXATransactionManager ç±»ï¼š</p>
<pre tabindex="0"><code>public final class BitronixXATransactionManager implements XATransactionManager {

    private final BitronixTransactionManager bitronixTransactionManager = TransactionManagerServices.getTransactionManager();

    @Override
    public void init() {
    }

    @SneakyThrows
    @Override
    public void registerRecoveryResource(final String dataSourceName, final XADataSource xaDataSource) {
        ResourceRegistrar.register(new BitronixRecoveryResource(dataSourceName, xaDataSource));
    }

    @SneakyThrows
    @Override
    public void removeRecoveryResource(final String dataSourceName, final XADataSource xaDataSource) {
        ResourceRegistrar.unregister(new BitronixRecoveryResource(dataSourceName, xaDataSource));
    }

    @SneakyThrows
    @Override
    public void enlistResource(final SingleXAResource singleXAResource) {
        bitronixTransactionManager.getTransaction().enlistResource(singleXAResource);
    }

    @Override
    public TransactionManager getTransactionManager() {
        return bitronixTransactionManager;
    }

    @Override
    public void close() {
        bitronixTransactionManager.shutdown();
    }
}
</code></pre><p>å¯¹ä¸Šè¿°ä»£ç çš„ç†è§£ä¹Ÿä¾èµ–ä¸å¯¹ bitronix æ¡†æ¶çš„ç†Ÿæ‚‰ç¨‹åº¦ï¼Œæ•´ä¸ªå°è£…è¿‡ç¨‹ç®€å•æ˜äº†ã€‚æˆ‘ä»¬æ— æ„å¯¹ bitronix æ¡†æ¶åšè¿‡å¤šå±•å¼€ï¼Œè€Œæ˜¯æ›´å¤šå…³æ³¨äº ShardingSphere ä¸­å¯¹ XATransactionManager çš„æŠ½è±¡è¿‡ç¨‹ã€‚</p>
<p>ä½œä¸ºæ€»ç»“ï¼Œæˆ‘ä»¬åœ¨ä¸Šä¸€è¯¾æ—¶çš„åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥æ¢³ç†äº† XA ä¸¤é˜¶æ®µæäº¤ç›¸å…³çš„æ ¸å¿ƒç±»ä¹‹é—´çš„å…³ç³»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl9oXe6AK8JkAAByEfwPBs0489.png" alt="image.png"></p>
<h4 id="2shardingconnection">2.ShardingConnection</h4>
<p>ä¸Šå›¾å±•ç¤ºäº†æ•´ä¸ªæµç¨‹çš„æºå¤´æ˜¯åœ¨ ShardingConnection ç±»ã€‚æˆ‘ä»¬åœ¨ ShardingConnection çš„æ„é€ å‡½æ•°ä¸­å‘ç°äº†åˆ›å»º ShardingTransactionManager çš„è¿‡ç¨‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>shardingTransactionManager = runtimeContext.getShardingTransactionManagerEngine().getTransactionManager(transactionType);
</code></pre><p>åœ¨ ShardingConnection çš„å¤šå¤„ä»£ç ä¸­éƒ½ç”¨åˆ°äº†ä¸Šé¢æ‰€åˆ›å»ºçš„ shardingTransactionManager å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œç”¨äºè·å–è¿æ¥çš„ createConnection æ–¹æ³•ï¼š</p>
<pre tabindex="0"><code>@Override
protected Connection createConnection(final String dataSourceName, final DataSource dataSource) throws SQLException {
        return isInShardingTransaction() ? shardingTransactionManager.getConnection(dataSourceName) : dataSource.getConnection();
}
</code></pre><p>ç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¯åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­çš„ isInShardingTransaction æ–¹æ³•ï¼š</p>
<pre tabindex="0"><code>private boolean isInShardingTransaction() {
        return null != shardingTransactionManager &amp;&amp; shardingTransactionManager.isInTransaction();
}
</code></pre><p>ä»¥åŠå¦‚ä¸‹æ‰€ç¤ºçš„ setAutoCommit æ–¹æ³•å®Œæˆäº†å¯¹ autoCommit çš„å¤„ç†ï¼š</p>
<pre tabindex="0"><code>@Override
public void setAutoCommit(final boolean autoCommit) throws SQLException {
        if (TransactionType.LOCAL == transactionType) {
            super.setAutoCommit(autoCommit);
            return;
        }
        if (autoCommit &amp;&amp; !shardingTransactionManager.isInTransaction() || !autoCommit &amp;&amp; shardingTransactionManager.isInTransaction()) {
            return;
        }
        if (autoCommit &amp;&amp; shardingTransactionManager.isInTransaction()) {
            shardingTransactionManager.commit();
            return;
        }
        if (!autoCommit &amp;&amp; !shardingTransactionManager.isInTransaction()) {
            closeCachedConnections();
            shardingTransactionManager.begin();
        }
}
</code></pre><p>åœ¨ä¸Šè¿°æ–¹æ³•ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å½“äº‹åŠ¡ç±»å‹ä¸ºæœ¬åœ°äº‹åŠ¡æ—¶ï¼Œç›´æ¥è°ƒç”¨ ShardingConnection çš„çˆ¶ç±» AbstractConnectionAdapter ä¸­çš„ setAutoCommit æ–¹æ³•å®Œæˆæœ¬åœ°äº‹åŠ¡çš„è‡ªåŠ¨æäº¤å¤„ç†ã€‚</p>
<p>è€Œå½“ autoCommit ä¸º true ä¸”è¿è¡Œåœ¨äº‹åŠ¡ä¸­æ—¶ï¼Œä¼šè°ƒç”¨ shardingTransactionManager.commit() æ–¹æ³•å®Œæˆæäº¤ï¼›è€Œå½“ autoCommit ä¸º false ä¸”å½“å‰ä¸åœ¨äº‹åŠ¡ä¸­æ—¶ï¼Œä¼šè°ƒç”¨ shardingTransactionManager.begin() æ–¹æ³•å¯åŠ¨äº‹åŠ¡ã€‚</p>
<p>æœ€åçš„ commit å’Œ rollback çš„å¤„ç†æ–¹å¼ä¸ setAutoCommit ç±»ä¼¼ï¼Œéƒ½æ˜¯æ ¹æ®äº‹åŠ¡ç±»å‹æ¥å†³å®šæ˜¯å¦è¦è¿›è¡Œåˆ†å¸ƒå¼æäº¤å’Œå›æ»šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>@Override
public void commit() throws SQLException {
        if (TransactionType.LOCAL == transactionType) {
            super.commit();
        } else {
            shardingTransactionManager.commit();
        }
}

@Override
public void rollback() throws SQLException {
        if (TransactionType.LOCAL == transactionType) {
            super.rollback();
        } else {
            shardingTransactionManager.rollback();
        }
}
</code></pre><p>æˆ‘ä»¬åœ¨ä¸Šä¸€è¯¾æ—¶ä¸­æåˆ°ï¼ŒShardingSphere åœ¨æä¾›äº†ä¸¤é˜¶æ®µæäº¤çš„ XA åè®®å®ç°æ–¹æ¡ˆçš„åŒæ—¶ï¼Œä¹Ÿå®ç°äº†æŸ”æ€§äº‹åŠ¡ã€‚</p>
<p>åœ¨ä»‹ç»å®Œ XAShardingTransactionManager ä¹‹åï¼Œæˆ‘ä»¬ç»§ç»­æ¥çœ‹åŸºäº Seata æ¡†æ¶çš„æŸ”æ€§äº‹åŠ¡ TransactionManager å®ç°ç±» SeataATShardingTransactionManagerã€‚</p>
<h3 id="seataatshardingtransactionmanager">SeataATShardingTransactionManager</h3>
<p>å› ä¸º SeataATShardingTransactionManager å®Œå…¨é‡‡ç”¨é˜¿é‡Œå·´å·´çš„ Seata æ¡†æ¶æ¥æä¾›åˆ†å¸ƒå¼äº‹åŠ¡ç‰¹æ€§ï¼Œè€Œä¸æ˜¯éµå¾ªç±»ä¼¼ XA è¿™æ ·çš„å¼€å‘è§„èŒƒï¼Œæ‰€ä»¥åœ¨ä»£ç å®ç°ä¸Šæ¯” XAShardingTransactionManager çš„ç±»å±‚ç»“æ„è¦ç®€å•å¾ˆå¤šï¼ŒæŠŠå¤æ‚æ€§éƒ½å±è”½åœ¨äº†æ¡†æ¶çš„å†…éƒ¨ã€‚</p>
<p>è¦æƒ³é›†æˆ Seataï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åˆå§‹åŒ– TMClient å’Œ RMClient è¿™ä¸¤ä¸ªå®¢æˆ·ç«¯å¯¹è±¡ï¼Œåœ¨ Seata å†…éƒ¨ï¼Œè¿™ä¸¤ä¸ªå®¢æˆ·ç«¯ä¹‹é—´ä¼šåŸºäº RPC çš„æ–¹å¼è¿›è¡Œé€šä¿¡ã€‚</p>
<p>æ‰€ä»¥ï¼ŒShardingSphere åœ¨ XAShardingTransactionManager ä¸­çš„ init æ–¹æ³•ä¸­å®ç°äº†ä¸€ä¸ª initSeataRPCClient æ–¹æ³•æ¥åˆå§‹åŒ–è¿™ä¸¤ä¸ªå®¢æˆ·ç«¯å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>//æ ¹æ® seata.conf é…ç½®æ–‡ä»¶åˆ›å»ºé…ç½®å¯¹è±¡
private final FileConfiguration configuration = new FileConfiguration(&quot;seata.conf&quot;); 
private void initSeataRPCClient() {
        String applicationId = configuration.getConfig(&quot;client.application.id&quot;);
        Preconditions.checkNotNull(applicationId, &quot;please config application id within seata.conf file&quot;);
        String transactionServiceGroup = configuration.getConfig(&quot;client.transaction.service.group&quot;, &quot;default&quot;);
        TMClient.init(applicationId, transactionServiceGroup);
        RMClient.init(applicationId, transactionServiceGroup);
}
</code></pre><p>å›æƒ³æˆ‘ä»¬åœ¨â€œ09 | åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ä½¿ç”¨å¼ºä¸€è‡´äº‹åŠ¡ä¸æŸ”æ€§äº‹åŠ¡ï¼Ÿâ€ä¸­å…³äº Seata ä½¿ç”¨æ–¹å¼çš„ä»‹ç»ï¼Œä¸éš¾ç†è§£è¿™é‡Œé€šè¿‡ seata.conf é…ç½®æ–‡ä»¶ä¸­æ‰€é…ç½®çš„ application.id å’Œ transaction.service.group è¿™ä¸¤ä¸ªé…ç½®é¡¹æ¥æ‰§è¡Œåˆå§‹åŒ–æ“ä½œã€‚</p>
<p>åŒæ—¶ï¼Œå¯¹äº Seata è€Œè¨€ï¼Œå®ƒä¹Ÿæä¾›äº†ä¸€å¥—æ„å»ºåœ¨ JDBC è§„èŒƒä¹‹ä¸Šçš„å®ç°ç­–ç•¥ï¼Œè¿™ç‚¹å’Œâ€œ03 | è§„èŒƒå…¼å®¹ï¼šJDBC è§„èŒƒä¸ ShardingSphere æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿâ€ä¸­ä»‹ç»çš„ ShardingSphere ä¸ JDBC è§„èŒƒä¹‹é—´çš„å…¼å®¹æ€§ç±»ä¼¼ã€‚</p>
<p>è€Œåœ¨å‘½åä¸Šï¼ŒSeata æ›´ä¸ºç›´æ¥æ˜äº†ï¼Œä½¿ç”¨ DataSourceProxy å’Œ ConnectionProxy è¿™ç§ä»£ç†å¯¹è±¡ã€‚ä»¥ DataSourceProxy ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æ¢³ç†å®ƒçš„ç±»å±‚ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl9oXgKACi15AAA7sb7XKlo735.png" alt="image"></p>
<p>å¯ä»¥çœ‹åˆ° DataSourceProxy å®ç°äº†è‡ªå·±å®šä¹‰çš„ Resource æ¥å£ï¼Œç„¶åç»§æ‰¿äº†æŠ½è±¡ç±» AbstractDataSourceProxyï¼Œè€Œåè€…åˆ™å®ç°äº† JDBC ä¸­çš„ DataSource æ¥å£ã€‚</p>
<p>æ‰€ä»¥ï¼Œåœ¨æˆ‘ä»¬åˆå§‹åŒ– Seata æ¡†æ¶æ—¶ï¼ŒåŒæ ·éœ€è¦æ ¹æ®è¾“å…¥çš„ DataSource å¯¹è±¡æ¥æ„å»º DataSourceProxyï¼Œå¹¶é€šè¿‡ DataSourceProxy è·å– ConnectionProxyã€‚SeataATShardingTransactionManager ç±»ä¸­çš„ç›¸å…³ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>@Override
public void init(final DatabaseType databaseType, final Collection&lt;ResourceDataSource&gt; resourceDataSources) {
     //åˆå§‹åŒ– Seata å®¢æˆ·ç«¯
     initSeataRPCClient();
     //åˆ›å»º DataSourceProxy å¹¶æ”¾å…¥åˆ° Map ä¸­
     for (ResourceDataSource each : resourceDataSources) {
            dataSourceMap.put(each.getOriginalName(), new DataSourceProxy(each.getDataSource()));
     }
}

@Override
public Connection getConnection(final String dataSourceName) throws SQLException {
         //æ ¹æ® DataSourceProxy è·å– ConnectionProxy
     return dataSourceMap.get(dataSourceName).getConnection();
}
</code></pre><p>ä»‹ç»å®Œåˆå§‹åŒ–å·¥ä½œä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ SeataATShardingTransactionManager ä¸­æä¾›äº†äº‹åŠ¡å¼€å¯å’Œæäº¤ç›¸å…³çš„å…¥å£ã€‚åœ¨ Seata ä¸­ï¼ŒGlobalTransaction æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¥å£ï¼Œå°è£…äº†é¢å‘ç”¨æˆ·æ“ä½œå±‚çš„åˆ†å¸ƒå¼äº‹åŠ¡è®¿é—®å…¥å£ï¼Œè¯¥æ¥å£çš„å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼Œå¯ä»¥ä»æ–¹æ³•å‘½åä¸Šç›´æ¥çœ‹å‡ºå¯¹åº”çš„æ“ä½œå«ä¹‰ï¼š</p>
<pre tabindex="0"><code>public interface GlobalTransaction {
    void begin() throws TransactionException;
    void begin(int timeout) throws TransactionException;
    void begin(int timeout, String name) throws TransactionException;
    void commit() throws TransactionException;
    void rollback() throws TransactionException;
    GlobalStatus getStatus() throws TransactionException;
    String getXid();
}
</code></pre><p>ShardingSphere ä½œä¸º GlobalTransaction çš„ç”¨æˆ·å±‚ï¼ŒåŒæ ·åŸºäº GlobalTransaction æ¥å£æ¥å®Œæˆåˆ†å¸ƒå¼äº‹åŠ¡æ“ä½œã€‚ä½† ShardingSphere å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨è¿™ä¸€å±‚ï¼Œè€Œæ˜¯è®¾è®¡äº†ä¸€ä¸ª SeataTransactionHolder ç±»ï¼Œä¿å­˜ç€çº¿ç¨‹å®‰å…¨çš„ GlobalTransaction å¯¹è±¡ã€‚</p>
<p>SeataTransactionHolder ç±»ä½äº sharding-transaction-base-seata-at å·¥ç¨‹ä¸­ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>final class SeataTransactionHolder {

    private static final ThreadLocal&lt;GlobalTransaction&gt; CONTEXT = new ThreadLocal&lt;&gt;();

    static void set(final GlobalTransaction transaction) {
        CONTEXT.set(transaction);
    } 
    static GlobalTransaction get() {
        return CONTEXT.get();
    }

    static void clear() {
        CONTEXT.remove();
    }
}
</code></pre><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œä½¿ç”¨äº† ThreadLocal å·¥å…·ç±»æ¥ç¡®ä¿å¯¹ GlobalTransaction è®¿é—®çš„çº¿ç¨‹å®‰å…¨æ€§ã€‚</p>
<p>æ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•åˆ¤æ–­å½“å‰æ“ä½œæ˜¯å¦å¤„äºä¸€ä¸ªå…¨å±€äº‹åŠ¡ä¸­å‘¢ï¼Ÿ</p>
<p>åœ¨ Seata ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ RootContexï¼Œè¯¥ç±»å°±æ˜¯ç”¨æ¥ä¿å­˜å‚ä¸è€…å’Œå‘èµ·è€…ä¹‹é—´ä¼ æ’­çš„ Xidã€‚å½“äº‹åŠ¡å‘èµ·è€…å¼€å¯å…¨å±€äº‹åŠ¡åï¼Œä¼šå°† Xid å¡«å……åˆ° RootContext é‡Œï¼›ç„¶å Xid å°†æ²¿ç€æœåŠ¡è°ƒç”¨é“¾ä¸€ç›´ä¼ æ’­ï¼Œè¿›è€Œå¡«å……åˆ°æ¯ä¸ªäº‹åŠ¡å‚ä¸è€…è¿›ç¨‹çš„ RootContext é‡Œï¼›äº‹åŠ¡å‚ä¸è€…å‘ç° RootContext ä¸­å­˜åœ¨ Xid æ—¶ï¼Œå°±å¯ä»¥çŸ¥é“è‡ªå·±å¤„äºå…¨å±€äº‹åŠ¡ä¸­ã€‚</p>
<p>åŸºäºè¿™å±‚åŸç†ï¼Œæˆ‘ä»¬åªéœ€è¦é‡‡ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„åˆ¤æ–­æ–¹æ³•å°±èƒ½å¾—å‡ºæ˜¯å¦å¤„äºå…¨å±€äº‹åŠ¡ä¸­çš„ç»“è®ºï¼š</p>
<pre tabindex="0"><code>@Override
public boolean isInTransaction() {
        return null != RootContext.getXID();
}
</code></pre><p>åŒæ—¶ï¼ŒSeata ä¹Ÿæä¾›äº†ä¸€ä¸ªé’ˆå¯¹å…¨å±€äº‹åŠ¡çš„ä¸Šä¸‹æ–‡ç±» GlobalTransactionContextï¼Œé€šè¿‡è¿™ä¸ªä¸Šä¸‹æ–‡ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ getCurrent æ–¹æ³•æ¥è·å–ä¸€ä¸ª GlobalTransactionå¯¹è±¡ï¼Œæˆ–è€…é€šè¿‡ getCurrentOrCreate æ–¹æ³•åœ¨æ— æ³•è·å– GlobalTransaction å¯¹è±¡æ—¶æ–°å»ºä¸€ä¸ªã€‚</p>
<p>è®²åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±ä¸éš¾ç†è§£ SeataATShardingTransactionManager ä¸­ begin æ–¹æ³•çš„å®ç°è¿‡ç¨‹äº†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>@Override
@SneakyThrows
public void begin() {
        SeataTransactionHolder.set(GlobalTransactionContext.getCurrentOrCreate());
        SeataTransactionHolder.get().begin();
        SeataTransactionBroadcaster.collectGlobalTxId();
}
</code></pre><p>è¿™é‡Œé€šè¿‡ GlobalTransactionContext.getCurrentOrCreate() æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ª GlobalTransactionï¼Œç„¶åå°†å…¶ä¿å­˜åˆ°äº† SeataTransactionHolder ä¸­ã€‚æ¥ç€ä» SeataTransactionHolder ä¸­è·å–ä¸€ä¸ª GlobalTransactionï¼Œå¹¶è°ƒç”¨ begin æ–¹æ³•å¯åŠ¨äº‹åŠ¡ã€‚</p>
<p>æ³¨æ„åˆ°è¿™é‡Œè¿˜æœ‰ä¸€ä¸ª SeataTransactionBroadcaster ç±»ï¼Œè¯¥ç±»å°±æ˜¯ç”¨æ¥ä¿å­˜ Seata å…¨å±€ Xid çš„ä¸€ä¸ªå®¹å™¨ç±»ã€‚æˆ‘ä»¬ä¼šåœ¨äº‹åŠ¡å¯åŠ¨æ—¶æ”¶é›†å…¨å±€ Xid å¹¶è¿›è¡Œä¿å­˜ï¼Œè€Œåœ¨äº‹åŠ¡æäº¤æˆ–å›æ»šæ—¶æ¸…ç©ºè¿™äº› Xidã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºçš„ commitã€rollback å’Œ close æ–¹æ³•çš„å®ç°è¿‡ç¨‹å°±éƒ½å˜å¾—å®¹æ˜“ç†è§£äº†ï¼š</p>
<pre tabindex="0"><code>@Override
public void commit() {
        try {
            SeataTransactionHolder.get().commit();
        } finally {
            SeataTransactionBroadcaster.clear();
            SeataTransactionHolder.clear();
        }
}

@Override
public void rollback() {
        try {
            SeataTransactionHolder.get().rollback();
        } finally {
            SeataTransactionBroadcaster.clear();
            SeataTransactionHolder.clear();
        }
}

@Override
public void close() {
        dataSourceMap.clear();
        SeataTransactionHolder.clear();
        TmRpcClient.getInstance().destroy();
        RmRpcClient.getInstance().destroy();
}
</code></pre><p>sharding-transaction-base-seata-at å·¥ç¨‹ä¸­çš„ä»£ç å®é™…ä¸Šå°±åªæœ‰è¿™äº›å†…å®¹ï¼Œè¿™äº›å†…å®¹ä¹Ÿæ„æˆäº†åœ¨ ShardingSphereä¸­ é›†æˆ Seata æ¡†æ¶çš„å®ç°è¿‡ç¨‹ã€‚</p>
<h3 id="ä»æºç è§£æåˆ°æ—¥å¸¸å¼€å‘">ä»æºç è§£æåˆ°æ—¥å¸¸å¼€å‘</h3>
<p>ä»Šå¤©çš„å†…å®¹ç»™å‡ºäº†åœ¨åº”ç”¨ç¨‹åºä¸­å¦‚ä½•é›†æˆ Seata åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶çš„è¯¦ç»†è¿‡ç¨‹ï¼ŒShardingSphere ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§æ¨¡ç‰ˆå®ç°ã€‚åœ¨æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨ä¸šåŠ¡ä»£ç ä¸­é›†æˆ Seataï¼Œå°±å¯ä»¥å‚è€ƒ SeataTransactionHolderã€SeataATShardingTransactionManager ç­‰æ ¸å¿ƒç±»ä¸­çš„ä»£ç ï¼Œè€Œä¸éœ€è¦åšå¤ªå¤šçš„ä¿®æ”¹ã€‚</p>
<h3 id="å°ç»“ä¸é¢„å‘Š">å°ç»“ä¸é¢„å‘Š</h3>
<p>æœ¬è¯¾æ—¶æ˜¯ ShardingSphere åˆ†å¸ƒå¼äº‹åŠ¡çš„æœ€åä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»å®Œäº† XAShardingTransactionManager çš„å‰©ä½™éƒ¨åˆ†å†…å®¹ï¼Œä»¥åŠ SeataATShardingTransactionManager çš„å®Œæ•´å®ç°ã€‚</p>
<p>å›é¡¾ä¸Šä¸€è¯¾æ—¶å†…å®¹ï¼Œæˆ‘ä»¬å‘ç°ç†è§£ XAShardingTransactionManager çš„éš¾ç‚¹åœ¨äºï¼Œä» ShardingConnection åˆ°åº•å±‚ JDBC è§„èŒƒçš„æ•´ä¸ªé›†æˆå’Œå…¼å®¹è¿‡ç¨‹ã€‚è€Œå¯¹äº XAShardingTransactionManager è€Œè¨€ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ Seata æ¡†æ¶æœ¬èº«æœ‰ä¸€å®šçš„äº†è§£ï¼Œæ‰èƒ½æ›´å¥½åœ°ç†è§£ä»Šå¤©çš„å†…å®¹ã€‚</p>
<p>è¿™é‡Œç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜ï¼šå¦‚æœè®©ä½ å®ç°å¯¹ Seata æ¡†æ¶çš„é›†æˆï¼Œä½ éœ€è¦åšå“ªäº›æ ¸å¿ƒæ­¥éª¤ï¼Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸å¤§å®¶è®¨è®ºï¼Œæˆ‘å°†é€ä¸€ç‚¹è¯„è§£ç­”ã€‚</p>
<p>ä»‹ç»å®Œåˆ†å¸ƒå¼äº‹åŠ¡ä¹‹åï¼Œæˆ‘ä»¬å°†è¿›å…¥â€œShardingSphere ä¸­ç¼–æ’æ²»ç†æ–¹é¢çš„æºç è§£æâ€æ¨¡å—ï¼Œä»ä¸‹ä¸€è¯¾æ—¶å¼€å§‹ï¼Œæˆ‘å°†è¦ä»‹ç»æ•°æ®è„±æ•æ¨¡å—çš„å®ç°åŸç†ã€‚</p>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/28-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1shardingsphere-%E4%B8%AD%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E5%92%8C%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1%E6%94%AF%E6%8C%81%E4%B8%8A/"><span>28 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šShardingSphere ä¸­å¦‚ä½•é›†æˆå¼ºä¸€è‡´æ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡æ”¯æŒï¼Ÿï¼ˆä¸Šï¼‰</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/30-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E6%94%B9%E5%86%99%E5%BC%95%E6%93%8E%E5%AE%9E%E7%8E%B0%E4%BD%8E%E4%BE%B5%E5%85%A5%E6%80%A7%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E6%96%B9%E6%A1%88/"><span>30 æ•°æ®è„±æ•ï¼šå¦‚ä½•åŸºäºæ”¹å†™å¼•æ“å®ç°ä½ä¾µå…¥æ€§æ•°æ®è„±æ•æ–¹æ¡ˆï¼Ÿ</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 28280 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>