<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>09 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ä½¿ç”¨å¼ºä¸€è‡´æ€§äº‹åŠ¡ä¸æŸ”æ€§äº‹åŠ¡ï¼Ÿ | Yipsen Ye</title>
<meta name="description" content="ä½ å¥½ï¼Œæ¬¢è¿è¿›å…¥ç¬¬ 09 è¯¾æ—¶çš„å­¦ä¹ ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸€ä¸ªåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„é‡è¦ä¸»é¢˜ï¼Œå³åˆ†å¸ƒå¼äº‹åŠ¡ã€‚åœ¨ä»‹ç» ShardingSphere ä¸­çš„å…·ä½“åº”ç”¨æ–¹å¼ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¿…è¦å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„åŸºæœ¬æ¦‚å¿µåšç®€è¦ä»‹ç»ã€‚
å¦‚ä½•ç†è§£åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ åœ¨ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œäº‹åŠ¡æ˜¯ä¸€ä¸ªæ ‡å‡†ç»„ä»¶ï¼Œå‡ ä¹æ‰€æœ‰æˆç†Ÿçš„å…³ç³»å‹æ•°æ®åº“éƒ½æä¾›äº†å¯¹æœ¬åœ°äº‹åŠ¡çš„åŸç”Ÿæ”¯æŒã€‚æœ¬åœ°äº‹åŠ¡æä¾›äº† ACID äº‹åŠ¡ç‰¹æ€§ã€‚åŸºäºæœ¬åœ°äº‹åŠ¡ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæˆ‘ä»¬å…ˆå¼€å¯ä¸€ä¸ªäº‹åŠ¡åï¼Œæ‰å¯ä»¥æ‰§è¡Œæ•°æ®æ“ä½œï¼Œæœ€åæäº¤æˆ–å›æ»šå°±å¯ä»¥äº†ã€‚æ›´è¿›ä¸€æ­¥ï¼Œå€ŸåŠ©äº Spring ç­‰é›†æˆåŒ–æ¡†æ¶ï¼Œå¼€å‘äººå‘˜åªéœ€å…³æ³¨å¼•èµ·æ•°æ®æ”¹å˜çš„ä¸šåŠ¡å³å¯ã€‚
ä½†åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œäº‹æƒ…å°±ä¼šå˜å¾—æ¯”è¾ƒå¤æ‚ã€‚å‡è®¾ç³»ç»Ÿä¸­å­˜åœ¨å¤šä¸ªç‹¬ç«‹çš„æ•°æ®åº“ï¼Œä¸ºäº†ç¡®ä¿æ•°æ®åœ¨è¿™äº›ç‹¬ç«‹çš„æ•°æ®åº“ä¸­ä¿æŒä¸€è‡´ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™äº›æ•°æ®åº“çº³å…¥åŒä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚è¿™æ—¶æœ¬åœ°äº‹åŠ¡å°±æ— èƒ½ä¸ºåŠ›äº†ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ã€‚
ä¸šç•Œå…³äºå¦‚ä½•å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ä¹Ÿæœ‰ä¸€äº›é€šç”¨çš„å®ç°æœºåˆ¶ï¼Œä¾‹å¦‚æ”¯æŒä¸¤é˜¶æ®µæäº¤çš„ XA åè®®ä»¥åŠä»¥ Saga ä¸ºä»£è¡¨çš„æŸ”æ€§äº‹åŠ¡ã€‚é’ˆå¯¹ä¸åŒçš„å®ç°æœºåˆ¶ï¼Œä¹Ÿå­˜åœ¨ä¸€äº›ä¾›åº”å•†å’Œå¼€å‘å·¥å…·ã€‚å› ä¸ºè¿™äº›å¼€å‘å·¥å…·åœ¨ä½¿ç”¨æ–¹å¼ä¸Šå’Œå®ç°åŸç†ä¸Šéƒ½æœ‰è¾ƒå¤§çš„å·®å¼‚æ€§ï¼Œæ‰€ä»¥å¼€å‘äººå‘˜çš„ä¸€å¤§è¯‰æ±‚åœ¨äºï¼Œå¸Œæœ›èƒ½æœ‰ä¸€å¥—ç»Ÿä¸€çš„è§£å†³æ–¹æ¡ˆèƒ½å¤Ÿå±è”½è¿™äº›å·®å¼‚ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¸Œæœ›è¿™ç§è§£å†³æ–¹æ¡ˆèƒ½å¤Ÿæä¾›å‹å¥½çš„ç³»ç»Ÿé›†æˆæ€§ã€‚
ShardingSphere ä½œä¸ºä¸€æ¬¾åˆ†å¸ƒå¼æ•°æ®åº“ä¸­é—´ä»¶ï¼ŒåŠ¿å¿…è¦è€ƒè™‘åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°æ–¹æ¡ˆã€‚è€Œåœ¨è®¾è®¡ä¸Šï¼ŒShardingSphere ä»ä¸€å¼€å§‹å°±å……åˆ†è€ƒè™‘åˆ°äº†å¼€å‘äººå‘˜çš„è¿™äº›è¯‰æ±‚ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ã€‚
ShardingSphere ä¸­çš„åˆ†å¸ƒå¼äº‹åŠ¡ åœ¨ ShardingSphere ä¸­ï¼Œé™¤æœ¬åœ°äº‹åŠ¡ä¹‹å¤–ï¼Œè¿˜æä¾›é’ˆå¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸¤ç§å®ç°æ–¹æ¡ˆï¼Œåˆ†åˆ«æ˜¯ XA äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡ã€‚è¿™ç‚¹å¯ä»¥ä»äº‹åŠ¡ç±»å‹æšä¸¾å€¼ TransactionType ä¸­å¾—åˆ°éªŒè¯ï¼š
public enum TransactionType {LOCAL, XA, BASE}XA äº‹åŠ¡ XA äº‹åŠ¡æä¾›åŸºäºä¸¤é˜¶æ®µæäº¤åè®®çš„å®ç°æœºåˆ¶ã€‚æ‰€è°“ä¸¤é˜¶æ®µæäº¤ï¼Œé¡¾åæ€ä¹‰åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼Œä¸€ä¸ªæ˜¯å‡†å¤‡é˜¶æ®µï¼Œä¸€ä¸ªæ˜¯æ‰§è¡Œé˜¶æ®µã€‚åœ¨å‡†å¤‡é˜¶æ®µä¸­ï¼Œåè°ƒè€…å‘èµ·ä¸€ä¸ªæè®®ï¼Œåˆ†åˆ«è¯¢é—®å„å‚ä¸è€…æ˜¯å¦æ¥å—ã€‚åœ¨æ‰§è¡Œé˜¶æ®µï¼Œåè°ƒè€…æ ¹æ®å‚ä¸è€…çš„åé¦ˆï¼Œæäº¤æˆ–ç»ˆæ­¢äº‹åŠ¡ã€‚å¦‚æœå‚ä¸è€…å…¨éƒ¨åŒæ„åˆ™æäº¤ï¼Œåªè¦æœ‰ä¸€ä¸ªå‚ä¸è€…ä¸åŒæ„å°±ç»ˆæ­¢ã€‚
ä¸¤é˜¶æ®µæäº¤ç¤ºæ„å›¾
ç›®å‰ï¼Œä¸šç•Œåœ¨å®ç° XA äº‹åŠ¡æ—¶ä¹Ÿå­˜åœ¨ä¸€äº›ä¸»æµå·¥å…·åº“ï¼ŒåŒ…æ‹¬ Atomikosã€Narayana å’Œ Bitronixã€‚ShardingSphere å¯¹è¿™ä¸‰ç§å·¥å…·åº“éƒ½è¿›è¡Œäº†é›†æˆï¼Œå¹¶é»˜è®¤ä½¿ç”¨ Atomikos æ¥å®Œæˆä¸¤é˜¶æ®µæäº¤ã€‚
BASE äº‹åŠ¡ XA äº‹åŠ¡æ˜¯å…¸å‹çš„å¼ºä¸€è‡´æ€§äº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯å®Œå…¨éµå¾ªäº‹åŠ¡çš„ ACID è®¾è®¡åŸåˆ™ã€‚ä¸ XA äº‹åŠ¡è¿™ç§â€œåˆšæ€§â€ä¸åŒï¼ŒæŸ”æ€§äº‹åŠ¡åˆ™éµå¾ª BASE è®¾è®¡ç†è®ºï¼Œè¿½æ±‚çš„æ˜¯æœ€ç»ˆä¸€è‡´æ€§ã€‚è¿™é‡Œçš„ BASE æ¥è‡ªåŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰ã€è½¯çŠ¶æ€ï¼ˆSoft Stateï¼‰å’Œæœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual Consistencyï¼‰è¿™ä¸‰ä¸ªæ¦‚å¿µã€‚
å…³äºå¦‚ä½•å®ç°åŸºäº BASE åŸåˆ™çš„æŸ”æ€§äº‹åŠ¡ï¼Œä¸šç•Œä¹Ÿå­˜åœ¨ä¸€äº›ä¼˜ç§€çš„æ¡†æ¶ï¼Œä¾‹å¦‚é˜¿é‡Œå·´å·´æä¾›çš„ Seataã€‚ShardingSphere å†…éƒ¨ä¹Ÿé›†æˆäº†å¯¹ Seata çš„æ”¯æŒã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦ï¼Œé›†æˆå…¶ä»–åˆ†å¸ƒå¼äº‹åŠ¡ç±»å¼€æºæ¡†æ¶ï¼Œå¹¶åŸºäºå¾®å†…æ ¸æ¶æ„åµŒå…¥åˆ° ShardingSphere è¿è¡Œæ—¶ç¯å¢ƒä¸­ã€‚">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="nav-logo">
    <a href="http://yipsen.github.io/">
        
        <span class="nav-title">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æ–‡ç« </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/shardingsphere%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86%e7%b2%be%e8%ae%b2/">ShardingSphereæ ¸å¿ƒåŸç†ç²¾è®²</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/00-%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E5%AD%A6%E4%B9%A0%E4%B8%80%E6%AC%BE%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E5%BC%80%E6%BA%90%E6%A1%86%E6%9E%B6/">00 å¦‚ä½•æ­£ç¡®å­¦ä¹ ä¸€æ¬¾åˆ†åº“åˆ†è¡¨å¼€æºæ¡†æ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/01-%E4%BB%8E%E7%90%86%E8%AE%BA%E5%88%B0%E5%AE%9E%E8%B7%B5%E5%A6%82%E4%BD%95%E8%AE%A9%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E7%9C%9F%E6%AD%A3%E8%90%BD%E5%9C%B0/">01 ä»ç†è®ºåˆ°å®è·µï¼šå¦‚ä½•è®©åˆ†åº“åˆ†è¡¨çœŸæ­£è½åœ°ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/02-%E9%A1%B6%E7%BA%A7%E9%A1%B9%E7%9B%AEshardingsphere-%E6%98%AF%E4%B8%80%E6%AC%BE%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84-apache-%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6/">02 é¡¶çº§é¡¹ç›®ï¼šShardingSphere æ˜¯ä¸€æ¬¾ä»€ä¹ˆæ ·çš„ Apache å¼€æºè½¯ä»¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/03-%E8%A7%84%E8%8C%83%E5%85%BC%E5%AE%B9jdbc-%E8%A7%84%E8%8C%83%E4%B8%8E-shardingsphere-%E6%98%AF%E4%BB%80%E4%B9%88%E5%85%B3%E7%B3%BB/">03 è§„èŒƒå…¼å®¹ï¼šJDBC è§„èŒƒä¸ ShardingSphere æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/04-%E5%BA%94%E7%94%A8%E9%9B%86%E6%88%90%E5%9C%A8%E4%B8%9A%E5%8A%A1%E7%B3%BB%E7%BB%9F%E4%B8%AD%E4%BD%BF%E7%94%A8-shardingsphere-%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B/">04 åº”ç”¨é›†æˆï¼šåœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ä½¿ç”¨ ShardingSphere çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/05-%E9%85%8D%E7%BD%AE%E9%A9%B1%E5%8A%A8shardingsphere-%E4%B8%AD%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BD%93%E7%B3%BB%E6%98%AF%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E7%9A%84/">05 é…ç½®é©±åŠ¨ï¼šShardingSphere ä¸­çš„é…ç½®ä½“ç³»æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ</a></li>
                
                
                
                    <li>09 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ä½¿ç”¨å¼ºä¸€è‡´æ€§äº‹åŠ¡ä¸æŸ”æ€§äº‹åŠ¡ï¼Ÿ</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/10-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E5%A6%82%E4%BD%95%E7%A1%AE%E4%BF%9D%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%89%E5%85%A8%E8%AE%BF%E9%97%AE/">10 æ•°æ®è„±æ•ï¼šå¦‚ä½•ç¡®ä¿æ•æ„Ÿæ•°æ®çš„å®‰å…¨è®¿é—®ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/11-%E7%BC%96%E6%8E%92%E6%B2%BB%E7%90%86%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E5%8A%A8%E6%80%81%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/">11 ç¼–æ’æ²»ç†ï¼šå¦‚ä½•å®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„åŠ¨æ€é…ç½®ç®¡ç†ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/12-%E4%BB%8E%E5%BA%94%E7%94%A8%E5%88%B0%E5%8E%9F%E7%90%86%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E9%98%85%E8%AF%BB-shardingsphere-%E6%BA%90%E7%A0%81/">12 ä»åº”ç”¨åˆ°åŸç†ï¼šå¦‚ä½•é«˜æ•ˆé˜…è¯» ShardingSphere æºç ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/13-%E5%BE%AE%E5%86%85%E6%A0%B8%E6%9E%B6%E6%9E%84shardingsphere-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%89%A9%E5%B1%95%E6%80%A7/">13 å¾®å†…æ ¸æ¶æ„ï¼šShardingSphere å¦‚ä½•å®ç°ç³»ç»Ÿçš„æ‰©å±•æ€§ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/14-%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AEshardingsphere-%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AE%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/">14 åˆ†å¸ƒå¼ä¸»é”®ï¼šShardingSphere ä¸­æœ‰å“ªäº›åˆ†å¸ƒå¼ä¸»é”®å®ç°æ–¹å¼ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/15-%E8%A7%A3%E6%9E%90%E5%BC%95%E6%93%8Esql-%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%8C%85%E6%8B%AC%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E9%98%B6%E6%AE%B5%E4%B8%8A/">15 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/16-%E8%A7%A3%E6%9E%90%E5%BC%95%E6%93%8Esql-%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%8C%85%E6%8B%AC%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E9%98%B6%E6%AE%B5%E4%B8%8B/">16 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/17-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E5%88%86%E7%89%87%E8%B7%AF%E7%94%B1%E6%A0%B8%E5%BF%83%E7%B1%BB-shardingrouter-%E7%9A%84%E8%BF%90%E4%BD%9C%E6%9C%BA%E5%88%B6/">17 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•ç†è§£åˆ†ç‰‡è·¯ç”±æ ¸å¿ƒç±» ShardingRouter çš„è¿ä½œæœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/18-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E7%9A%84%E5%88%86%E7%89%87%E8%B7%AF%E7%94%B1%E5%92%8C%E5%B9%BF%E6%92%AD%E8%B7%AF%E7%94%B1/">18 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•å®ç°æ•°æ®è®¿é—®çš„åˆ†ç‰‡è·¯ç”±å’Œå¹¿æ’­è·¯ç”±ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/19-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E5%9C%A8%E8%B7%AF%E7%94%B1%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%9B%86%E6%88%90%E5%A4%9A%E7%A7%8D%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5%E5%92%8C%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95/">19 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•åœ¨è·¯ç”±è¿‡ç¨‹ä¸­é›†æˆå¤šç§è·¯ç”±ç­–ç•¥å’Œè·¯ç”±ç®—æ³•ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/20-%E6%94%B9%E5%86%99%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84-sql-%E6%94%B9%E5%86%99%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6/">20 æ”¹å†™å¼•æ“ï¼šå¦‚ä½•ç†è§£è£…é¥°å™¨æ¨¡å¼ä¸‹çš„ SQL æ”¹å†™å®ç°æœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/21-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%88%86%E7%89%87%E7%8E%AF%E5%A2%83%E4%B8%8B-sql-%E6%89%A7%E8%A1%8C%E7%9A%84%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E6%8A%BD%E8%B1%A1/">21 æ‰§è¡Œå¼•æ“ï¼šåˆ†ç‰‡ç¯å¢ƒä¸‹ SQL æ‰§è¡Œçš„æ•´ä½“æµç¨‹åº”è¯¥å¦‚ä½•è¿›è¡ŒæŠ½è±¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/22-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E6%8A%8A%E6%8F%A1-shardingsphere-%E4%B8%AD%E7%9A%84-executor-%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B%E4%B8%8A/">22 æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•æŠŠæ¡ ShardingSphere ä¸­çš„ Executor æ‰§è¡Œæ¨¡å‹ï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/23-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E6%8A%8A%E6%8F%A1-shardingsphere-%E4%B8%AD%E7%9A%84-executor-%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B%E4%B8%8B/">23 æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•æŠŠæ¡ ShardingSphere ä¸­çš„ Executor æ‰§è¡Œæ¨¡å‹ï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/24-%E5%BD%92%E5%B9%B6%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%95%B0%E6%8D%AE%E5%BD%92%E5%B9%B6%E7%9A%84%E7%B1%BB%E5%9E%8B%E4%BB%A5%E5%8F%8A%E7%AE%80%E5%8D%95%E5%BD%92%E5%B9%B6%E7%AD%96%E7%95%A5%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/">24 å½’å¹¶å¼•æ“ï¼šå¦‚ä½•ç†è§£æ•°æ®å½’å¹¶çš„ç±»å‹ä»¥åŠç®€å•å½’å¹¶ç­–ç•¥çš„å®ç°è¿‡ç¨‹ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/25-%E5%BD%92%E5%B9%B6%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%B5%81%E5%BC%8F%E5%BD%92%E5%B9%B6%E5%92%8C%E5%86%85%E5%AD%98%E5%BD%92%E5%B9%B6%E5%9C%A8%E5%A4%8D%E6%9D%82%E5%BD%92%E5%B9%B6%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84%E5%BA%94%E7%94%A8%E6%96%B9%E5%BC%8F/">25 å½’å¹¶å¼•æ“ï¼šå¦‚ä½•ç†è§£æµå¼å½’å¹¶å’Œå†…å­˜å½’å¹¶åœ¨å¤æ‚å½’å¹¶åœºæ™¯ä¸‹çš„åº”ç”¨æ–¹å¼ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/26-%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%99%AE%E9%80%9A%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84%E5%92%8C%E5%88%86%E7%89%87%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84%E5%88%86%E5%88%AB%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%9A%84/">26 è¯»å†™åˆ†ç¦»ï¼šæ™®é€šä¸»ä»æ¶æ„å’Œåˆ†ç‰‡ä¸»ä»æ¶æ„åˆ†åˆ«æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/27-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3-shardingsphere-%E4%B8%AD%E5%AF%B9%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%8A%BD%E8%B1%A1%E8%BF%87%E7%A8%8B/">27 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ç†è§£ ShardingSphere ä¸­å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„æŠ½è±¡è¿‡ç¨‹ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/28-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1shardingsphere-%E4%B8%AD%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E5%92%8C%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1%E6%94%AF%E6%8C%81%E4%B8%8A/">28 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šShardingSphere ä¸­å¦‚ä½•é›†æˆå¼ºä¸€è‡´æ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡æ”¯æŒï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/29-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1shardingsphere-%E4%B8%AD%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E5%92%8C%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1%E6%94%AF%E6%8C%81%E4%B8%8B/">29 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šShardingSphere ä¸­å¦‚ä½•é›†æˆå¼ºä¸€è‡´æ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡æ”¯æŒï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/30-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E6%94%B9%E5%86%99%E5%BC%95%E6%93%8E%E5%AE%9E%E7%8E%B0%E4%BD%8E%E4%BE%B5%E5%85%A5%E6%80%A7%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E6%96%B9%E6%A1%88/">30 æ•°æ®è„±æ•ï¼šå¦‚ä½•åŸºäºæ”¹å†™å¼•æ“å®ç°ä½ä¾µå…¥æ€§æ•°æ®è„±æ•æ–¹æ¡ˆï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/31-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%AE%9E%E7%8E%B0%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E7%9A%84%E5%8A%A8%E6%80%81%E5%8C%96%E7%AE%A1%E7%90%86/">31 é…ç½®ä¸­å¿ƒï¼šå¦‚ä½•åŸºäºé…ç½®ä¸­å¿ƒå®ç°é…ç½®ä¿¡æ¯çš„åŠ¨æ€åŒ–ç®¡ç†ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/32-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BF%E9%97%AE%E7%86%94%E6%96%AD%E6%9C%BA%E5%88%B6/">32 æ³¨å†Œä¸­å¿ƒï¼šå¦‚ä½•åŸºäºæ³¨å†Œä¸­å¿ƒå®ç°æ•°æ®åº“è®¿é—®ç†”æ–­æœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/33-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E-hook-%E6%9C%BA%E5%88%B6%E4%BB%A5%E5%8F%8A-opentracing-%E5%8D%8F%E8%AE%AE%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/">33 é“¾è·¯è·Ÿè¸ªï¼šå¦‚ä½•åŸºäº Hook æœºåˆ¶ä»¥åŠ OpenTracing åè®®å®ç°æ•°æ®è®¿é—®é“¾è·¯è·Ÿè¸ªï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/35-%E7%BB%93%E8%AF%ADshardingsphere-%E6%80%BB%E7%BB%93%E5%8F%8A%E5%B1%95%E6%9C%9B/">35 ç»“è¯­ï¼šShardingSphere æ€»ç»“åŠå±•æœ›</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">09 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ä½¿ç”¨å¼ºä¸€è‡´æ€§äº‹åŠ¡ä¸æŸ”æ€§äº‹åŠ¡ï¼Ÿ</h1>
        <div class="post-info">
            <div class="post-date"> 
                <span>2021-12-22 01:55:48</span>
            </div>
        </div>
        <div class="post-content">
            <p>ä½ å¥½ï¼Œæ¬¢è¿è¿›å…¥ç¬¬ 09 è¯¾æ—¶çš„å­¦ä¹ ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸€ä¸ªåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„é‡è¦ä¸»é¢˜ï¼Œå³åˆ†å¸ƒå¼äº‹åŠ¡ã€‚åœ¨ä»‹ç» ShardingSphere ä¸­çš„å…·ä½“åº”ç”¨æ–¹å¼ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¿…è¦å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„åŸºæœ¬æ¦‚å¿µåšç®€è¦ä»‹ç»ã€‚</p>
<h3 id="å¦‚ä½•ç†è§£åˆ†å¸ƒå¼äº‹åŠ¡">å¦‚ä½•ç†è§£åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ</h3>
<p>åœ¨ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œäº‹åŠ¡æ˜¯ä¸€ä¸ªæ ‡å‡†ç»„ä»¶ï¼Œå‡ ä¹æ‰€æœ‰æˆç†Ÿçš„å…³ç³»å‹æ•°æ®åº“éƒ½æä¾›äº†å¯¹æœ¬åœ°äº‹åŠ¡çš„åŸç”Ÿæ”¯æŒã€‚æœ¬åœ°äº‹åŠ¡æä¾›äº† ACID äº‹åŠ¡ç‰¹æ€§ã€‚åŸºäºæœ¬åœ°äº‹åŠ¡ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæˆ‘ä»¬å…ˆå¼€å¯ä¸€ä¸ªäº‹åŠ¡åï¼Œæ‰å¯ä»¥æ‰§è¡Œæ•°æ®æ“ä½œï¼Œæœ€åæäº¤æˆ–å›æ»šå°±å¯ä»¥äº†ã€‚æ›´è¿›ä¸€æ­¥ï¼Œå€ŸåŠ©äº Spring ç­‰é›†æˆåŒ–æ¡†æ¶ï¼Œå¼€å‘äººå‘˜åªéœ€å…³æ³¨å¼•èµ·æ•°æ®æ”¹å˜çš„ä¸šåŠ¡å³å¯ã€‚</p>
<p>ä½†åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œäº‹æƒ…å°±ä¼šå˜å¾—æ¯”è¾ƒå¤æ‚ã€‚å‡è®¾ç³»ç»Ÿä¸­å­˜åœ¨å¤šä¸ªç‹¬ç«‹çš„æ•°æ®åº“ï¼Œä¸ºäº†ç¡®ä¿æ•°æ®åœ¨è¿™äº›ç‹¬ç«‹çš„æ•°æ®åº“ä¸­ä¿æŒä¸€è‡´ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™äº›æ•°æ®åº“çº³å…¥åŒä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚è¿™æ—¶æœ¬åœ°äº‹åŠ¡å°±æ— èƒ½ä¸ºåŠ›äº†ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p>
<p>ä¸šç•Œå…³äºå¦‚ä½•å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ä¹Ÿæœ‰ä¸€äº›é€šç”¨çš„å®ç°æœºåˆ¶ï¼Œä¾‹å¦‚æ”¯æŒä¸¤é˜¶æ®µæäº¤çš„ XA åè®®ä»¥åŠä»¥ Saga ä¸ºä»£è¡¨çš„æŸ”æ€§äº‹åŠ¡ã€‚é’ˆå¯¹ä¸åŒçš„å®ç°æœºåˆ¶ï¼Œä¹Ÿå­˜åœ¨ä¸€äº›ä¾›åº”å•†å’Œå¼€å‘å·¥å…·ã€‚å› ä¸ºè¿™äº›å¼€å‘å·¥å…·åœ¨ä½¿ç”¨æ–¹å¼ä¸Šå’Œå®ç°åŸç†ä¸Šéƒ½æœ‰è¾ƒå¤§çš„å·®å¼‚æ€§ï¼Œæ‰€ä»¥å¼€å‘äººå‘˜çš„ä¸€å¤§è¯‰æ±‚åœ¨äºï¼Œå¸Œæœ›èƒ½æœ‰ä¸€å¥—ç»Ÿä¸€çš„è§£å†³æ–¹æ¡ˆèƒ½å¤Ÿå±è”½è¿™äº›å·®å¼‚ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¸Œæœ›è¿™ç§è§£å†³æ–¹æ¡ˆèƒ½å¤Ÿæä¾›å‹å¥½çš„ç³»ç»Ÿé›†æˆæ€§ã€‚</p>
<p>ShardingSphere ä½œä¸ºä¸€æ¬¾åˆ†å¸ƒå¼æ•°æ®åº“ä¸­é—´ä»¶ï¼ŒåŠ¿å¿…è¦è€ƒè™‘åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°æ–¹æ¡ˆã€‚è€Œåœ¨è®¾è®¡ä¸Šï¼ŒShardingSphere ä»ä¸€å¼€å§‹å°±å……åˆ†è€ƒè™‘åˆ°äº†å¼€å‘äººå‘˜çš„è¿™äº›è¯‰æ±‚ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ã€‚</p>
<h3 id="shardingsphere-ä¸­çš„åˆ†å¸ƒå¼äº‹åŠ¡">ShardingSphere ä¸­çš„åˆ†å¸ƒå¼äº‹åŠ¡</h3>
<p>åœ¨ ShardingSphere ä¸­ï¼Œé™¤æœ¬åœ°äº‹åŠ¡ä¹‹å¤–ï¼Œè¿˜æä¾›é’ˆå¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸¤ç§å®ç°æ–¹æ¡ˆï¼Œåˆ†åˆ«æ˜¯ XA äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡ã€‚è¿™ç‚¹å¯ä»¥ä»äº‹åŠ¡ç±»å‹æšä¸¾å€¼ TransactionType ä¸­å¾—åˆ°éªŒè¯ï¼š</p>
<pre tabindex="0"><code>public enum TransactionType {
    LOCAL, XA, BASE
}
</code></pre><h4 id="xa-äº‹åŠ¡">XA äº‹åŠ¡</h4>
<p>XA äº‹åŠ¡æä¾›åŸºäºä¸¤é˜¶æ®µæäº¤åè®®çš„å®ç°æœºåˆ¶ã€‚æ‰€è°“ä¸¤é˜¶æ®µæäº¤ï¼Œé¡¾åæ€ä¹‰åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼Œä¸€ä¸ªæ˜¯å‡†å¤‡é˜¶æ®µï¼Œä¸€ä¸ªæ˜¯æ‰§è¡Œé˜¶æ®µã€‚åœ¨å‡†å¤‡é˜¶æ®µä¸­ï¼Œåè°ƒè€…å‘èµ·ä¸€ä¸ªæè®®ï¼Œåˆ†åˆ«è¯¢é—®å„å‚ä¸è€…æ˜¯å¦æ¥å—ã€‚åœ¨æ‰§è¡Œé˜¶æ®µï¼Œåè°ƒè€…æ ¹æ®å‚ä¸è€…çš„åé¦ˆï¼Œæäº¤æˆ–ç»ˆæ­¢äº‹åŠ¡ã€‚å¦‚æœå‚ä¸è€…å…¨éƒ¨åŒæ„åˆ™æäº¤ï¼Œåªè¦æœ‰ä¸€ä¸ªå‚ä¸è€…ä¸åŒæ„å°±ç»ˆæ­¢ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl8MBruAHHnkAABo-3eRic0694.png" alt="Drawing 0.png"></p>
<p>ä¸¤é˜¶æ®µæäº¤ç¤ºæ„å›¾</p>
<p>ç›®å‰ï¼Œä¸šç•Œåœ¨å®ç° XA äº‹åŠ¡æ—¶ä¹Ÿå­˜åœ¨ä¸€äº›ä¸»æµå·¥å…·åº“ï¼ŒåŒ…æ‹¬ Atomikosã€Narayana å’Œ Bitronixã€‚ShardingSphere å¯¹è¿™ä¸‰ç§å·¥å…·åº“éƒ½è¿›è¡Œäº†é›†æˆï¼Œå¹¶é»˜è®¤ä½¿ç”¨ Atomikos æ¥å®Œæˆä¸¤é˜¶æ®µæäº¤ã€‚</p>
<h4 id="base-äº‹åŠ¡">BASE äº‹åŠ¡</h4>
<p>XA äº‹åŠ¡æ˜¯å…¸å‹çš„å¼ºä¸€è‡´æ€§äº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯å®Œå…¨éµå¾ªäº‹åŠ¡çš„ ACID è®¾è®¡åŸåˆ™ã€‚ä¸ XA äº‹åŠ¡è¿™ç§â€œåˆšæ€§â€ä¸åŒï¼ŒæŸ”æ€§äº‹åŠ¡åˆ™éµå¾ª BASE è®¾è®¡ç†è®ºï¼Œè¿½æ±‚çš„æ˜¯æœ€ç»ˆä¸€è‡´æ€§ã€‚è¿™é‡Œçš„ BASE æ¥è‡ªåŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰ã€è½¯çŠ¶æ€ï¼ˆSoft Stateï¼‰å’Œæœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual Consistencyï¼‰è¿™ä¸‰ä¸ªæ¦‚å¿µã€‚</p>
<p>å…³äºå¦‚ä½•å®ç°åŸºäº BASE åŸåˆ™çš„æŸ”æ€§äº‹åŠ¡ï¼Œä¸šç•Œä¹Ÿå­˜åœ¨ä¸€äº›ä¼˜ç§€çš„æ¡†æ¶ï¼Œä¾‹å¦‚é˜¿é‡Œå·´å·´æä¾›çš„ Seataã€‚ShardingSphere å†…éƒ¨ä¹Ÿé›†æˆäº†å¯¹ Seata çš„æ”¯æŒã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦ï¼Œé›†æˆå…¶ä»–åˆ†å¸ƒå¼äº‹åŠ¡ç±»å¼€æºæ¡†æ¶ï¼Œå¹¶åŸºäºå¾®å†…æ ¸æ¶æ„åµŒå…¥åˆ° ShardingSphere è¿è¡Œæ—¶ç¯å¢ƒä¸­ã€‚</p>
<p>ä»‹ç»å®Œç†è®ºçŸ¥è¯†ä¹‹åï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨ XA äº‹åŠ¡å’Œ BASE äº‹åŠ¡æ¥å®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p>
<h3 id="ä½¿ç”¨-xa-äº‹åŠ¡">ä½¿ç”¨ XA äº‹åŠ¡</h3>
<p>åœ¨ Spring åº”ç”¨ç¨‹åºä¸­æ·»åŠ å¯¹ XA äº‹åŠ¡çš„æ”¯æŒç›¸å¯¹ç®€å•ï¼Œæ— è®ºæ˜¯ Spring æ¡†æ¶ï¼Œè¿˜æ˜¯ ShardingSphere è‡ªèº«ï¼Œéƒ½ä¸ºæˆ‘ä»¬æä¾›äº†ä½æˆæœ¬çš„å¼€å‘æœºåˆ¶ã€‚</p>
<h4 id="å¼€å‘ç¯å¢ƒå‡†å¤‡">å¼€å‘ç¯å¢ƒå‡†å¤‡</h4>
<p>è¦æƒ³ä½¿ç”¨ XA äº‹åŠ¡ï¼Œæˆ‘ä»¬é¦–å…ˆè¦åœ¨ pom æ–‡ä»¶ä¸­æ·»åŠ  sharding-jdbc-core å’Œ sharding-transaction-xa-core è¿™ä¸¤ä¸ªä¾èµ–ï¼š</p>
<pre tabindex="0"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt;
    &lt;artifactId&gt;sharding-jdbc-core&lt;/artifactId&gt;
&lt;/dependency&gt; 
&lt;dependency&gt;
     &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt;
     &lt;artifactId&gt;sharding-transaction-xa-core&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><p>åœ¨ä»Šå¤©çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¼”ç¤ºå¦‚ä½•åœ¨åˆ†åº“ç¯å¢ƒä¸‹å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨ Spring Boot ä¸­åˆ›å»ºä¸€ä¸ª .properties æ–‡ä»¶ï¼Œå¹¶åŒ…å«åˆ†åº“éœ€è¦çš„æ‰€æœ‰é…ç½®é¡¹ä¿¡æ¯ï¼š</p>
<pre tabindex="0"><code>spring.shardingsphere.datasource.names=ds0,ds1 
spring.shardingsphere.datasource.ds0.type=com.zaxxer.hikari.HikariDataSource
spring.shardingsphere.datasource.ds0.driver-class-name=com.mysql.jdbc.Driver
spring.shardingsphere.datasource.ds0.jdbc-url=jdbc:mysql://localhost:3306/ds0
spring.shardingsphere.datasource.ds0.username=root
spring.shardingsphere.datasource.ds0.password=root
spring.shardingsphere.datasource.ds0.autoCommit: false 
spring.shardingsphere.datasource.ds1.type=com.zaxxer.hikari.HikariDataSource
spring.shardingsphere.datasource.ds1.driver-class-name=com.mysql.jdbc.Driver
spring.shardingsphere.datasource.ds1.jdbc-url=jdbc:mysql://localhost:3306/ds1
spring.shardingsphere.datasource.ds1.username=root
spring.shardingsphere.datasource.ds1.password=root
spring.shardingsphere.datasource.ds0.autoCommit: false 
spring.shardingsphere.sharding.default-database-strategy.inline.sharding-column=user_id
spring.shardingsphere.sharding.default-database-strategy.inline.algorithm-expression=ds$-&gt;{user_id % 2}
spring.shardingsphere.sharding.binding-tables=health_record,health_task
spring.shardingsphere.sharding.broadcast-tables=health_level 
spring.shardingsphere.sharding.tables.health_record.actual-data-nodes=ds$-&gt;{0..1}.health_record
spring.shardingsphere.sharding.tables.health_record.key-generator.column=record_id
spring.shardingsphere.sharding.tables.health_record.key-generator.type=SNOWFLAKE
spring.shardingsphere.sharding.tables.health_record.key-generator.props.worker.id=33
spring.shardingsphere.sharding.tables.health_task.actual-data-nodes=ds$-&gt;{0..1}.health_task
spring.shardingsphere.sharding.tables.health_task.key-generator.column=task_id
spring.shardingsphere.sharding.tables.health_task.key-generator.type=SNOWFLAKE
spring.shardingsphere.sharding.tables.health_task.key-generator.props.worker.id=33 
spring.shardingsphere.props.sql.show=true
</code></pre><h4 id="å®ç°-xa-äº‹åŠ¡">å®ç° XA äº‹åŠ¡</h4>
<p>é€šè¿‡åˆ†åº“é…ç½®ï¼Œæˆ‘ä»¬å°†è·å– SQL æ‰§è¡Œçš„ç›®æ ‡ DataSourceã€‚ç”±äºæˆ‘ä»¬ä½¿ç”¨ Spring æ¡†æ¶è€Œä¸æ˜¯ä½¿ç”¨åŸç”Ÿçš„ JDBC è¿›è¡Œäº‹åŠ¡ç®¡ç†ï¼Œæ‰€ä»¥éœ€è¦å°† DataSource ä¸ Spring ä¸­çš„äº‹åŠ¡ç®¡ç†å™¨ PlatformTransactionManager å…³è”èµ·æ¥ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œä¸ºäº†æ›´å¥½åœ°é›†æˆ ShardingSphere ä¸­çš„åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Spring æ¡†æ¶æä¾›çš„ JdbcTemplate æ¨¡æ¿ç±»æ¥ç®€åŒ– SQL çš„æ‰§è¡Œè¿‡ç¨‹ã€‚ä¸€ç§å¸¸è§çš„åšæ³•æ˜¯åˆ›å»ºä¸€ä¸ªäº‹åŠ¡é…ç½®ç±»æ¥åˆå§‹åŒ–æ‰€éœ€çš„ PlatformTransactionManager å’Œ JdbcTemplate å¯¹è±¡ï¼š</p>
<pre tabindex="0"><code>@Configuration
@EnableTransactionManagement
public class TransactionConfiguration {

    @Bean
    public PlatformTransactionManager txManager(final DataSource dataSource) {
        return new DataSourceTransactionManager(dataSource);
    }

    @Bean
    public JdbcTemplate jdbcTemplate(final DataSource dataSource) {
        return new JdbcTemplate(dataSource);
    }
}
</code></pre><p>ä¸€æ—¦åˆå§‹åŒ–äº† JdbcTemplateï¼Œå°±å¯ä»¥åœ¨ä¸šåŠ¡ä»£ç ä¸­æ³¨å…¥è¿™ä¸ªæ¨¡æ¿ç±»æ¥æ‰§è¡Œå„ç§ SQL æ“ä½œï¼Œå¸¸è§çš„åšæ³•æ˜¯ä¼ å…¥ä¸€ä¸ª PreparedStatementCallbackï¼Œå¹¶åœ¨è¿™ä¸ªå›è°ƒä¸­æ‰§è¡Œå„ç§å…·ä½“çš„ SQLï¼š</p>
<pre tabindex="0"><code>@Autowired
JdbcTemplate jdbcTemplate; 
jdbcTemplate.execute(SQL, (PreparedStatementCallback&lt;Object&gt;) preparedStatement -&gt; {
    â€¦
    return preparedStatement;
});
</code></pre><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ PreparedStatementCallback å›è°ƒè·å–ä¸€ä¸ª PreparedStatement å¯¹è±¡ã€‚æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ JdbcTemplate å¦ä¸€ç§æ‰§è¡Œ SQL çš„ä»£ç é£æ ¼ï¼Œé€šè¿‡ä½¿ç”¨æ›´åŸºç¡€çš„ ConnectionCallback å›è°ƒæ¥å£ï¼š</p>
<pre tabindex="0"><code>jdbcTemplate.execute((ConnectionCallback&lt;Object&gt;) connection-&gt; {
    â€¦
    return connection;
});
</code></pre><p>ä¸ºäº†åœ¨ä¸šåŠ¡ä»£ç ä¸­ä»¥æœ€å°‘çš„å¼€å‘æˆæœ¬åµŒå…¥åˆ†å¸ƒå¼äº‹åŠ¡æœºåˆ¶ï¼ŒShardingSphere ä¹Ÿä¸“é—¨æä¾›äº†ä¸€ä¸ª @ShardingTransactionType æ³¨è§£æ¥é…ç½®æ‰€éœ€è¦æ‰§è¡Œçš„äº‹åŠ¡ç±»å‹ï¼š</p>
<pre tabindex="0"><code>@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Inherited
public @interface ShardingTransactionType {

    TransactionType value() default TransactionType.LOCAL;
}
</code></pre><p>æˆ‘ä»¬çŸ¥é“ï¼ŒShardingSphere æä¾›çš„äº‹åŠ¡ç±»å‹æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯ LOCALã€XA å’Œ BASEï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯ LOCALã€‚æ‰€ä»¥å¦‚æœéœ€è¦ç”¨åˆ°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œéœ€è¦åœ¨ä¸šåŠ¡æ–¹æ³•ä¸Šæ˜¾å¼çš„æ·»åŠ è¿™ä¸ªæ³¨è§£ï¼š</p>
<pre tabindex="0"><code>@Transactional
@ShardingTransactionType(TransactionType.XA)
public void insert(){
    â€¦
}
</code></pre><p>å¦ä¸€ç§è®¾ç½® TransactionType çš„æ–¹å¼æ˜¯ä½¿ç”¨ TransactionTypeHolder å·¥å…·ç±»ã€‚TransactionTypeHolder ç±»ä¸­é€šè¿‡ ThreadLocal æ¥ä¿å­˜ TransactionTypeï¼š</p>
<pre tabindex="0"><code>public final class TransactionTypeHolder {

    private static final ThreadLocal&lt;TransactionType&gt; CONTEXT = new ThreadLocal&lt;TransactionType&gt;() {

        @Override
        protected TransactionType initialValue() {
            return TransactionType.LOCAL;
        }
    };

    public static TransactionType get() {
        return CONTEXT.get();
    }

    public static void set(final TransactionType transactionType) {
        CONTEXT.set(transactionType);
    }

    public static void clear() {
        CONTEXT.remove();
    }
}
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒTransactionTypeHolder ä¸­é»˜è®¤é‡‡ç”¨çš„æ˜¯æœ¬åœ°äº‹åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ set æ–¹æ³•æ¥æ”¹å˜åˆå§‹è®¾ç½®ï¼š</p>
<pre tabindex="0"><code>TransactionTypeHolder.set(TransactionType.XA);
</code></pre><p>ç°åœ¨ï¼Œä½¿ç”¨ XA å¼€å‘åˆ†å¸ƒå¼äº‹åŠ¡çš„æ•´ä½“ç»“æ„çš„æ–¹æ³•å·²ç»æ¢³ç†æ¸…æ¥šäº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ª insertHealthRecords æ–¹æ³•ï¼Œåœ¨å…¶ä¸­æ·»åŠ å¯¹ HealthRecord å’Œ HealthTask çš„æ•°æ®æ’å…¥ä»£ç ï¼š</p>
<pre tabindex="0"><code>private List&lt;Long&gt; insertHealthRecords() throws SQLException {
       List&lt;Long&gt; result = new ArrayList&lt;&gt;(10);
       jdbcTemplate.execute((ConnectionCallback&lt;Object&gt;) connection-&gt; {
           connection.setAutoCommit(false);

         try {
             for (Long i = 1L; i &lt;= 10; i++) {
                HealthRecord healthRecord = createHealthRecord(i);
             insertHealthRecord(healthRecord, connection);

             HealthTask healthTask = createHealthTask(i, healthRecord);
              insertHealthTask(healthTask, connection);

              result.add(healthRecord.getRecordId()); 
                }
             connection.commit();
         } catch (final SQLException ex) {
             connection.rollback();
                throw ex;
            }

           return connection;
        });

       return result;
    }
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ‰§è¡Œæ’å…¥æ“ä½œä¹‹å‰ï¼Œæˆ‘ä»¬å…³é—­äº† Connection çš„è‡ªåŠ¨æäº¤åŠŸèƒ½ã€‚åœ¨ SQL æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæ‰‹åŠ¨é€šè¿‡ Connection commit æ–¹æ³•æ‰§è¡Œäº‹åŠ¡æäº¤ã€‚ä¸€æ—¦åœ¨ SQL çš„æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°ä»»ä½•å¼‚å¸¸æ—¶ï¼Œå°±è°ƒç”¨ Connection çš„ rollback æ–¹æ³•å›æ»šäº‹åŠ¡ã€‚</p>
<p>è¿™é‡Œæœ‰å¿…è¦ä»‹ç»æ‰§è¡Œæ•°æ®æ’å…¥çš„å…·ä½“å®ç°è¿‡ç¨‹ï¼Œæˆ‘ä»¬ä»¥ insertHealthRecord æ–¹æ³•ä¸ºä¾‹è¿›è¡Œå±•å¼€ï¼š</p>
<pre tabindex="0"><code>private void insertHealthRecord(HealthRecord healthRecord, Connection connection) throws SQLException {
     try (PreparedStatement preparedStatement = connection.prepareStatement(sql_health_record_insert, Statement.RETURN_GENERATED_KEYS)) {
        preparedStatement.setLong(1, healthRecord.getUserId());
            preparedStatement.setLong(2, healthRecord.getLevelId() % 5 );
            preparedStatement.setString(3, &quot;Remark&quot; + healthRecord.getUserId());
            preparedStatement.executeUpdate(); 

            try (ResultSet resultSet = preparedStatement.getGeneratedKeys()) {
                if (resultSet.next()) {
                  healthRecord.setRecordId(resultSet.getLong(1));
                }
            }
     }
}
</code></pre><p>é¦–å…ˆé€šè¿‡ Connection å¯¹è±¡æ„å»ºä¸€ä¸ª PreparedStatementã€‚è¯·æ³¨æ„ï¼Œ<strong>ç”±äºæˆ‘ä»¬éœ€è¦é€šè¿‡ ShardingSphere çš„ä¸»é”®è‡ªåŠ¨ç”Ÿæˆæœºåˆ¶ï¼Œæ‰€ä»¥åœ¨åˆ›å»º PreparedStatement æ—¶éœ€è¦è¿›è¡Œç‰¹æ®Šåœ°è®¾ç½®ï¼š</strong></p>
<pre tabindex="0"><code>connection.prepareStatement(sql_health_record_insert, Statement.RETURN_GENERATED_KEYS)
</code></pre><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œåœ¨ PreparedStatement å®Œæˆ SQL æ‰§è¡Œä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–è‡ªåŠ¨ç”Ÿæˆçš„ä¸»é”®å€¼ï¼š</p>
<pre tabindex="0"><code>try (ResultSet resultSet = preparedStatement.getGeneratedKeys()) {
     if (resultSet.next()) {
          healthRecord.setRecordId(resultSet.getLong(1));
     }
}
</code></pre><p>å½“è·å–è¿™ä¸ªä¸»é”®å€¼ä¹‹åï¼Œå°±å°†è¿™ä¸ªä¸»é”®å€¼è®¾ç½®å› HealthRecordï¼Œè¿™æ˜¯ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆä¸»é”®çš„å¸¸è§åšæ³•ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬åœ¨äº‹åŠ¡æ–¹æ³•çš„å…¥å£å¤„ï¼Œéœ€è¦è®¾ç½® TransactionTypeï¼š</p>
<pre tabindex="0"><code>    @Override
    public void processWithXA() throws SQLException {
       TransactionTypeHolder.set(TransactionType.XA);

       insertHealthRecords();
    }
</code></pre><p>ç°åœ¨è®©æˆ‘ä»¬æ‰§è¡Œè¿™ä¸ª processWithXA æ–¹æ³•ï¼Œçœ‹çœ‹æ•°æ®æ˜¯å¦å·²ç»æŒ‰ç…§åˆ†åº“çš„é…ç½®å†™å…¥åˆ°ç›®æ ‡æ•°æ®åº“è¡¨ä¸­ã€‚ä¸‹é¢æ˜¯ ds0 ä¸­çš„ health_record è¡¨å’Œ health_task è¡¨ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F8MB4yADpvNAAAn7gHRWyw024.png" alt="Drawing 2.png"></p>
<p>ds0 ä¸­çš„ health_record è¡¨</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F8MCEuAUA1NAAAuoAPD9w4209.png" alt="Drawing 3.png"></p>
<p>ds0 ä¸­çš„ health_task è¡¨</p>
<p>ä¸‹é¢åˆ™æ˜¯ ds1 ä¸­çš„ health_record è¡¨å’Œ health_task è¡¨ï¼š <img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl8MB6SAOFIhAAAoGKuCLOw688.png" alt="Drawing 4.png"></p>
<p>ds1 ä¸­çš„ health_record è¡¨</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F8MCFiAH4szAAAvGNmTj1Y923.png" alt="Drawing 5.png"></p>
<p>ds1 ä¸­çš„ health_task è¡¨</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ§åˆ¶å°æ—¥å¿—æ¥è·Ÿè¸ªå…·ä½“çš„ SQL æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<pre tabindex="0"><code>2020-06-01 20:11:52.043  INFO 10720 --- [           main] ShardingSphere-SQL                       : Rule Type: sharding
2020-06-01 20:11:52.043  INFO 10720 --- [           main] ShardingSphere-SQL                       : Logic SQL: INSERT INTO health_record (user_id, level_id, remark) VALUES (?, ?, ?)
â€¦
2020-06-01 20:11:52.043  INFO 10720 --- [           main] ShardingSphere-SQL                       : Actual SQL: ds1 ::: INSERT INTO health_record (user_id, level_id, remark, record_id) VALUES (?, ?, ?, ?) ::: [1, 1, Remark1, 474308304135393280]
â€¦
</code></pre><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¨¡æ‹Ÿäº‹åŠ¡å¤±è´¥çš„åœºæ™¯ï¼Œå¯ä»¥åœ¨ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ•…æ„æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼š</p>
<pre tabindex="0"><code>try {
             for (Long i = 1L; i &lt;= 10; i++) {
                HealthRecord healthRecord = createHealthRecord(i);
             insertHealthRecord(healthRecord, connection);

             HealthTask healthTask = createHealthTask(i, healthRecord);
              insertHealthTask(healthTask, connection);

              result.add(healthRecord.getRecordId());

              //æ‰‹å·¥æŠ›å‡ºå¼‚å¸¸
              throw new SQLException(&quot;æ•°æ®åº“æ‰§è¡Œå¼‚å¸¸!&quot;);
                }
             connection.commit();
         } catch (final SQLException ex) {
             connection.rollback();
                throw ex;
    }
</code></pre><p>å†æ¬¡æ‰§è¡Œ processWithXA æ–¹æ³•ï¼ŒåŸºäº connection æä¾›çš„ rollback æ–¹æ³•ï¼Œæˆ‘ä»¬å‘ç°å·²ç»æ‰§è¡Œçš„éƒ¨åˆ† SQL å¹¶æ²¡æœ‰æäº¤åˆ°ä»»ä½•ä¸€ä¸ªæ•°æ®åº“ä¸­ã€‚</p>
<h3 id="ä½¿ç”¨-base-äº‹åŠ¡">ä½¿ç”¨ BASE äº‹åŠ¡</h3>
<p>ç›¸è¾ƒäº XA äº‹åŠ¡ï¼Œåœ¨ä¸šåŠ¡ä»£ç ä¸­é›†æˆ BASE äº‹åŠ¡çš„è¿‡ç¨‹å°±æ˜¾å¾—ç›¸å¯¹å¤æ‚ä¸€ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å€ŸåŠ©å¤–éƒ¨æ¡†æ¶æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å°†åŸºäºé˜¿é‡Œå·´å·´æä¾›çš„ Seata æ¡†æ¶æ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ BASE äº‹åŠ¡ã€‚</p>
<h4 id="å¼€å‘ç¯å¢ƒå‡†å¤‡-1">å¼€å‘ç¯å¢ƒå‡†å¤‡</h4>
<p>åŒæ ·ï¼Œè¦æƒ³ä½¿ç”¨åŸºäº Seata çš„ BASE äº‹åŠ¡ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åœ¨ pom æ–‡ä»¶ä¸­æ·»åŠ å¯¹ sharding-jdbc-core å’Œ sharding-transaction-base-seata-at è¿™ä¸¤ä¸ªä¾èµ–ï¼š</p>
<pre tabindex="0"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt;
    &lt;artifactId&gt;sharding-jdbc-core&lt;/artifactId&gt;
&lt;/dependency&gt; 
&lt;dependency&gt;
     &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt;
     &lt;artifactId&gt;sharding-transaction-base-seata-at&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><p>å› ä¸ºç”¨åˆ°äº† Seata æ¡†æ¶ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦å¼•å…¥ Seate æ¡†æ¶çš„ç›¸å…³ç»„ä»¶ï¼š</p>
<pre tabindex="0"><code>       &lt;dependency&gt;
            &lt;groupId&gt;io.seata&lt;/groupId&gt;
            &lt;artifactId&gt;seata-rm-datasource&lt;/artifactId&gt;
        &lt;/dependency&gt; 
        &lt;dependency&gt;
            &lt;groupId&gt;io.seata&lt;/groupId&gt;
            &lt;artifactId&gt;seata-tm&lt;/artifactId&gt;
        &lt;/dependency&gt; 
        &lt;dependency&gt;
            &lt;groupId&gt;io.seata&lt;/groupId&gt;
            &lt;artifactId&gt;seata-codec-all&lt;/artifactId&gt;
        &lt;/dependency&gt;
</code></pre><p>ç„¶åï¼Œæˆ‘ä»¬ä¸‹è½½å¹¶å¯åŠ¨ Seata æœåŠ¡å™¨ï¼Œè¿™ä¸ªè¿‡ç¨‹éœ€è¦è®¾ç½® Seata æœåŠ¡å™¨ config ç›®å½•ä¸‹çš„ registry.confï¼Œä»¥ä¾¿æŒ‡å®šæ³¨å†Œä¸­å¿ƒï¼Œè¿™é‡Œä½¿ç”¨ ZooKeeper æ¥å……å½“æ³¨å†Œä¸­å¿ƒã€‚å…³äºå¦‚ä½•å¯åŠ¨ Seata æœåŠ¡å™¨çš„è¿‡ç¨‹å¯ä»¥å‚è€ƒ Seata çš„å®˜æ–¹æ–‡æ¡£ã€‚è¯·æ³¨æ„ï¼ŒæŒ‰ç…§ Seata çš„è¿è¡Œè¦æ±‚ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸€ä¸ªåˆ†ç‰‡æ•°æ®åº“å®ä¾‹ä¸­åˆ›å»ºä¸€å¼  undo_log è¡¨ã€‚ç„¶åï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨ä»£ç å·¥ç¨‹ä¸­ classpath ä¸­å¢åŠ ä¸€ä¸ª seata.conf é…ç½®æ–‡ä»¶ï¼š</p>
<pre tabindex="0"><code>client {
    application.id = health-base
    transaction.service.group = health-base-group
}
</code></pre><p>ç°åœ¨ï¼Œåœ¨ src/main/resources ç›®å½•ä¸‹çš„æ–‡ä»¶ç»„ç»‡å½¢å¼åº”è¯¥æ˜¯è¿™æ ·ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F8MB7aAL-kkAAAU1FYPsK0495.png" alt="Drawing 6.png"></p>
<p>å½“ç„¶ï¼Œè¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯ç»§ç»­æ²¿ç”¨å‰é¢ä»‹ç»çš„åˆ†åº“é…ç½®ã€‚</p>
<h3 id="å®ç°-base-äº‹åŠ¡">å®ç° BASE äº‹åŠ¡</h3>
<p>åŸºäº ShardingSphere æä¾›çš„åˆ†å¸ƒå¼äº‹åŠ¡çš„æŠ½è±¡ï¼Œæˆ‘ä»¬ä» XA äº‹åŠ¡è½¬åˆ° BASE äº‹åŠ¡å”¯ä¸€è¦åšçš„äº‹æƒ…å°±æ˜¯é‡æ–°è®¾ç½® TransactionTypeï¼Œä¹Ÿå°±æ˜¯ä¿®æ”¹ä¸€è¡Œä»£ç ï¼š</p>
<pre tabindex="0"><code>    @Override
    public void processWithBASE() throws SQLException {
       TransactionTypeHolder.set(TransactionType.BASE);

       insertHealthRecords();
    }
</code></pre><p>é‡æ–°æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œæˆ‘ä»¬å‘ç°åœ¨æ­£å¸¸æäº¤å’Œå¼‚å¸¸å›æ»šçš„åœºæ™¯ä¸‹ï¼ŒåŸºäº Seata çš„åˆ†å¸ƒå¼äº‹åŠ¡åŒæ ·å‘æŒ¥äº†æ•ˆæœã€‚</p>
<h3 id="å°ç»“">å°ç»“</h3>
<p>åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯ ShardingSphere ä¸­æä¾›çš„ä¸€å¤§æ ¸å¿ƒåŠŸèƒ½ï¼Œä¹Ÿæ˜¯åˆ†å¸ƒå¼ç¯å¢ƒä¸‹æ•°æ®å¤„ç†æ‰€å¿…é¡»è¦è€ƒè™‘çš„è¯é¢˜ã€‚ShardingSphere æä¾›äº†ä¸¤ç§å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯åŸºäºå¼ºä¸€è‡´æ€§çš„ XA äº‹åŠ¡ï¼Œä»¥åŠåŸºäºæœ€ç»ˆä¸€è‡´æ€§çš„ BASE äº‹åŠ¡ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬ç»“åˆæ¡ˆä¾‹å¯¹è¿™ä¸¤ç§äº‹åŠ¡çš„ä½¿ç”¨æ–¹å¼åšäº†è¯¦ç»†çš„ä»‹ç»ã€‚</p>
<p>è¿™é‡Œç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜ï¼šå½“ä½¿ç”¨ ShardingSphere æ—¶ï¼Œåœ¨ä¸šåŠ¡ä»£ç ä¸­åµŒå…¥åˆ†å¸ƒå¼äº‹åŠ¡æœ‰å“ªäº›å¼€å‘æ–¹å¼ï¼Ÿ</p>
<p>æœ¬è¯¾æ—¶çš„å†…å®¹å°±åˆ°è¿™é‡Œã€‚åœ¨ä¸‹ä¸€è¯¾æ—¶ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç» ShardingSphere ä¸­æä¾›äº†ä¸æ•°æ®è®¿é—®å®‰å…¨æ€§ç›¸å…³çš„ä¸€ä¸ªè¯é¢˜ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡æ•°æ®è„±æ•å®Œæˆå¯¹æ•æ„Ÿæ•°æ®çš„å®‰å…¨è®¿é—®ã€‚</p>

        </div>
    </article>
</div>
<div class="division-line"></div>
<div class="others">
    <div>æ ‡ç­¾ï¼šğŸ·ï¸<a class="post-tag" href="/tags/sharding/">sharding</a>&nbsp;</div>
    <div>åˆ†ç±»ï¼š ğŸ“’<a class="post-category" href="/categories/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/">ShardingSphereæ ¸å¿ƒåŸç†ç²¾è®²</a>&nbsp; </div>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/05-%E9%85%8D%E7%BD%AE%E9%A9%B1%E5%8A%A8shardingsphere-%E4%B8%AD%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BD%93%E7%B3%BB%E6%98%AF%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E7%9A%84/"><span>05 é…ç½®é©±åŠ¨ï¼šShardingSphere ä¸­çš„é…ç½®ä½“ç³»æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ</span></a>
    </div>
    <div class="next">
        
        <a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/10-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E5%A6%82%E4%BD%95%E7%A1%AE%E4%BF%9D%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%89%E5%85%A8%E8%AE%BF%E9%97%AE/"><span>10 æ•°æ®è„±æ•ï¼šå¦‚ä½•ç¡®ä¿æ•æ„Ÿæ•°æ®çš„å®‰å…¨è®¿é—®ï¼Ÿ</span></a>
    </div>
</div>

        </div>
        <div id="float">
            <ul class="float-button-bar">
    <li>
        <button class="float-button top" onclick="scrollToTop(this);">UP</button>
    </li>
    <li>
        <button class="float-button toggler" onclick="changeSkin(this);">DARK</button>
    </li>
</ul>
        </div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 2020 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    const changeSkin = () => {
        document.getElementById('page').classList.toggle('night');
    }
    const scrollToTop = () => {
        window.scrollTo(0, 0);
    }
</script>
</body>

</html>