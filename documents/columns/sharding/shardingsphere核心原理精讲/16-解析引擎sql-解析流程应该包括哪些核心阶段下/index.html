<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>16 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸‹ï¼‰ | Yipsen Ye</title>
<meta name="description" content="æˆ‘ä»¬çŸ¥é“æ•´ä¸ª SQL è§£æå¼•æ“å¯ä»¥åˆ†æˆä¸‰ä¸ªé˜¶æ®µï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ï¼Œä¸Šä¸€è¯¾æ—¶æˆ‘ä»¬ä¸»è¦ä»‹ç»äº† ShardingSphere ä¸­ SQL è§£æå¼•æ“çš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œé‚£ä¹ˆä»Šå¤©æˆ‘å°†æ‰¿æ¥ä¸Šä¸€è¯¾æ—¶ï¼Œç»§ç»­è®²è§£ ShardingSphere ä¸­ SQL è§£ææµç¨‹ä¸­å‰©ä½™çš„ä¸¤ä¸ªé˜¶æ®µã€‚
SQL è§£æå¼•æ“çš„ä¸‰å¤§é˜¶æ®µ åœ¨ SQL è§£æå¼•æ“çš„ç¬¬ä¸€é˜¶æ®µä¸­ï¼Œæˆ‘ä»¬è¯¦ç»†ä»‹ç»äº† ShardingSphere ç”Ÿæˆ SQL æŠ½è±¡è¯­æ³•æ ‘çš„è¿‡ç¨‹ï¼Œå¹¶å¼•å‡ºäº† SQLStatementRule è§„åˆ™ç±»ã€‚ä»Šå¤©æˆ‘ä»¬å°†åŸºäºè¿™ä¸ªè§„åˆ™ç±»æ¥åˆ†æå¦‚ä½•æå– SQLSegment ä»¥åŠå¦‚ä½•å¡«å…… SQL è¯­å¥çš„å®ç°æœºåˆ¶ã€‚
1.ç¬¬äºŒé˜¶æ®µï¼šæå– SQL ç‰‡æ®µ è¦ç†è§£ SQLStatementRuleï¼Œå°±éœ€è¦å…ˆä»‹ç» ParseRuleRegistry ç±»ã€‚ä»å‘½åä¸Šçœ‹ï¼Œè¯¥ç±»å°±æ˜¯ä¸€ä¸ªè§„åˆ™æ³¨å†Œè¡¨ï¼Œä¿å­˜ç€å„ç§è§£æè§„åˆ™ä¿¡æ¯ã€‚ParseRuleRegistry ç±»ä¸­çš„æ ¸å¿ƒå˜é‡åŒ…æ‹¬å¦‚ä¸‹æ‰€ç¤ºçš„ä¸‰ä¸ª Loader ç±»ï¼š
private final ExtractorRuleDefinitionEntityLoader extractorRuleLoader = new ExtractorRuleDefinitionEntityLoader(); private final FillerRuleDefinitionEntityLoader fillerRuleLoader = new FillerRuleDefinitionEntityLoader(); private final SQLStatementRuleDefinitionEntityLoader statementRuleLoader = new SQLStatementRuleDefinitionEntityLoader(); ä»å‘½åä¸Šå¯ä»¥çœ‹åˆ°è¿™ä¸‰ä¸ª Loader ç±»åˆ†åˆ«å¤„ç†å¯¹ SQLStatementRuleã€ExtractorRule å’Œ FillerRule è¿™ä¸‰ç§è§„åˆ™å®šä¹‰çš„åŠ è½½ã€‚
æˆ‘ä»¬å…ˆæ¥çœ‹ SQLStatementRuleï¼Œå®ƒä»¬çš„å®šä¹‰ä½äº sql-statement-rule-definition.xml é…ç½®æ–‡ä»¶ä¸­ã€‚æˆ‘ä»¬ä»¥ Mysql ä¸ºä¾‹ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶ä½äº shardingsphere-sql-parser-mysql å·¥ç¨‹ä¸­çš„ META-INF/parsing-rule-definition/mysql ç›®å½•ä¸‹ã€‚æˆ‘ä»¬æˆªå–è¯¥é…ç½®æ–‡ä»¶ä¸­çš„éƒ¨åˆ†é…ç½®ä¿¡æ¯ä½œä¸ºæ¼”ç¤ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="nav-logo">
    <a href="http://yipsen.github.io/">
        
        <span class="nav-title">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æ–‡ç« </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/shardingsphere%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86%e7%b2%be%e8%ae%b2/">ShardingSphereæ ¸å¿ƒåŸç†ç²¾è®²</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/00-%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E5%AD%A6%E4%B9%A0%E4%B8%80%E6%AC%BE%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E5%BC%80%E6%BA%90%E6%A1%86%E6%9E%B6/">00 å¦‚ä½•æ­£ç¡®å­¦ä¹ ä¸€æ¬¾åˆ†åº“åˆ†è¡¨å¼€æºæ¡†æ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/01-%E4%BB%8E%E7%90%86%E8%AE%BA%E5%88%B0%E5%AE%9E%E8%B7%B5%E5%A6%82%E4%BD%95%E8%AE%A9%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E7%9C%9F%E6%AD%A3%E8%90%BD%E5%9C%B0/">01 ä»ç†è®ºåˆ°å®è·µï¼šå¦‚ä½•è®©åˆ†åº“åˆ†è¡¨çœŸæ­£è½åœ°ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/02-%E9%A1%B6%E7%BA%A7%E9%A1%B9%E7%9B%AEshardingsphere-%E6%98%AF%E4%B8%80%E6%AC%BE%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84-apache-%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6/">02 é¡¶çº§é¡¹ç›®ï¼šShardingSphere æ˜¯ä¸€æ¬¾ä»€ä¹ˆæ ·çš„ Apache å¼€æºè½¯ä»¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/03-%E8%A7%84%E8%8C%83%E5%85%BC%E5%AE%B9jdbc-%E8%A7%84%E8%8C%83%E4%B8%8E-shardingsphere-%E6%98%AF%E4%BB%80%E4%B9%88%E5%85%B3%E7%B3%BB/">03 è§„èŒƒå…¼å®¹ï¼šJDBC è§„èŒƒä¸ ShardingSphere æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/04-%E5%BA%94%E7%94%A8%E9%9B%86%E6%88%90%E5%9C%A8%E4%B8%9A%E5%8A%A1%E7%B3%BB%E7%BB%9F%E4%B8%AD%E4%BD%BF%E7%94%A8-shardingsphere-%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B/">04 åº”ç”¨é›†æˆï¼šåœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ä½¿ç”¨ ShardingSphere çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/05-%E9%85%8D%E7%BD%AE%E9%A9%B1%E5%8A%A8shardingsphere-%E4%B8%AD%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BD%93%E7%B3%BB%E6%98%AF%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E7%9A%84/">05 é…ç½®é©±åŠ¨ï¼šShardingSphere ä¸­çš„é…ç½®ä½“ç³»æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/09-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E4%B8%8E%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1/">09 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ä½¿ç”¨å¼ºä¸€è‡´æ€§äº‹åŠ¡ä¸æŸ”æ€§äº‹åŠ¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/10-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E5%A6%82%E4%BD%95%E7%A1%AE%E4%BF%9D%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%89%E5%85%A8%E8%AE%BF%E9%97%AE/">10 æ•°æ®è„±æ•ï¼šå¦‚ä½•ç¡®ä¿æ•æ„Ÿæ•°æ®çš„å®‰å…¨è®¿é—®ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/11-%E7%BC%96%E6%8E%92%E6%B2%BB%E7%90%86%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E5%8A%A8%E6%80%81%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/">11 ç¼–æ’æ²»ç†ï¼šå¦‚ä½•å®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„åŠ¨æ€é…ç½®ç®¡ç†ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/12-%E4%BB%8E%E5%BA%94%E7%94%A8%E5%88%B0%E5%8E%9F%E7%90%86%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E9%98%85%E8%AF%BB-shardingsphere-%E6%BA%90%E7%A0%81/">12 ä»åº”ç”¨åˆ°åŸç†ï¼šå¦‚ä½•é«˜æ•ˆé˜…è¯» ShardingSphere æºç ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/13-%E5%BE%AE%E5%86%85%E6%A0%B8%E6%9E%B6%E6%9E%84shardingsphere-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%89%A9%E5%B1%95%E6%80%A7/">13 å¾®å†…æ ¸æ¶æ„ï¼šShardingSphere å¦‚ä½•å®ç°ç³»ç»Ÿçš„æ‰©å±•æ€§ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/14-%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AEshardingsphere-%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%BB%E9%94%AE%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/">14 åˆ†å¸ƒå¼ä¸»é”®ï¼šShardingSphere ä¸­æœ‰å“ªäº›åˆ†å¸ƒå¼ä¸»é”®å®ç°æ–¹å¼ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/15-%E8%A7%A3%E6%9E%90%E5%BC%95%E6%93%8Esql-%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%8C%85%E6%8B%AC%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E9%98%B6%E6%AE%B5%E4%B8%8A/">15 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li>16 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸‹ï¼‰</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/17-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E5%88%86%E7%89%87%E8%B7%AF%E7%94%B1%E6%A0%B8%E5%BF%83%E7%B1%BB-shardingrouter-%E7%9A%84%E8%BF%90%E4%BD%9C%E6%9C%BA%E5%88%B6/">17 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•ç†è§£åˆ†ç‰‡è·¯ç”±æ ¸å¿ƒç±» ShardingRouter çš„è¿ä½œæœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/18-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E7%9A%84%E5%88%86%E7%89%87%E8%B7%AF%E7%94%B1%E5%92%8C%E5%B9%BF%E6%92%AD%E8%B7%AF%E7%94%B1/">18 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•å®ç°æ•°æ®è®¿é—®çš„åˆ†ç‰‡è·¯ç”±å’Œå¹¿æ’­è·¯ç”±ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/19-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E5%9C%A8%E8%B7%AF%E7%94%B1%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%9B%86%E6%88%90%E5%A4%9A%E7%A7%8D%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5%E5%92%8C%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95/">19 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•åœ¨è·¯ç”±è¿‡ç¨‹ä¸­é›†æˆå¤šç§è·¯ç”±ç­–ç•¥å’Œè·¯ç”±ç®—æ³•ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/20-%E6%94%B9%E5%86%99%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84-sql-%E6%94%B9%E5%86%99%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6/">20 æ”¹å†™å¼•æ“ï¼šå¦‚ä½•ç†è§£è£…é¥°å™¨æ¨¡å¼ä¸‹çš„ SQL æ”¹å†™å®ç°æœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/21-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%88%86%E7%89%87%E7%8E%AF%E5%A2%83%E4%B8%8B-sql-%E6%89%A7%E8%A1%8C%E7%9A%84%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E6%8A%BD%E8%B1%A1/">21 æ‰§è¡Œå¼•æ“ï¼šåˆ†ç‰‡ç¯å¢ƒä¸‹ SQL æ‰§è¡Œçš„æ•´ä½“æµç¨‹åº”è¯¥å¦‚ä½•è¿›è¡ŒæŠ½è±¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/22-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E6%8A%8A%E6%8F%A1-shardingsphere-%E4%B8%AD%E7%9A%84-executor-%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B%E4%B8%8A/">22 æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•æŠŠæ¡ ShardingSphere ä¸­çš„ Executor æ‰§è¡Œæ¨¡å‹ï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/23-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E6%8A%8A%E6%8F%A1-shardingsphere-%E4%B8%AD%E7%9A%84-executor-%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B%E4%B8%8B/">23 æ‰§è¡Œå¼•æ“ï¼šå¦‚ä½•æŠŠæ¡ ShardingSphere ä¸­çš„ Executor æ‰§è¡Œæ¨¡å‹ï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/24-%E5%BD%92%E5%B9%B6%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%95%B0%E6%8D%AE%E5%BD%92%E5%B9%B6%E7%9A%84%E7%B1%BB%E5%9E%8B%E4%BB%A5%E5%8F%8A%E7%AE%80%E5%8D%95%E5%BD%92%E5%B9%B6%E7%AD%96%E7%95%A5%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/">24 å½’å¹¶å¼•æ“ï¼šå¦‚ä½•ç†è§£æ•°æ®å½’å¹¶çš„ç±»å‹ä»¥åŠç®€å•å½’å¹¶ç­–ç•¥çš„å®ç°è¿‡ç¨‹ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/25-%E5%BD%92%E5%B9%B6%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%B5%81%E5%BC%8F%E5%BD%92%E5%B9%B6%E5%92%8C%E5%86%85%E5%AD%98%E5%BD%92%E5%B9%B6%E5%9C%A8%E5%A4%8D%E6%9D%82%E5%BD%92%E5%B9%B6%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84%E5%BA%94%E7%94%A8%E6%96%B9%E5%BC%8F/">25 å½’å¹¶å¼•æ“ï¼šå¦‚ä½•ç†è§£æµå¼å½’å¹¶å’Œå†…å­˜å½’å¹¶åœ¨å¤æ‚å½’å¹¶åœºæ™¯ä¸‹çš„åº”ç”¨æ–¹å¼ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/26-%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%99%AE%E9%80%9A%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84%E5%92%8C%E5%88%86%E7%89%87%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84%E5%88%86%E5%88%AB%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%9A%84/">26 è¯»å†™åˆ†ç¦»ï¼šæ™®é€šä¸»ä»æ¶æ„å’Œåˆ†ç‰‡ä¸»ä»æ¶æ„åˆ†åˆ«æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/27-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3-shardingsphere-%E4%B8%AD%E5%AF%B9%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%8A%BD%E8%B1%A1%E8%BF%87%E7%A8%8B/">27 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¦‚ä½•ç†è§£ ShardingSphere ä¸­å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„æŠ½è±¡è¿‡ç¨‹ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/28-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1shardingsphere-%E4%B8%AD%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E5%92%8C%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1%E6%94%AF%E6%8C%81%E4%B8%8A/">28 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šShardingSphere ä¸­å¦‚ä½•é›†æˆå¼ºä¸€è‡´æ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡æ”¯æŒï¼Ÿï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/29-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1shardingsphere-%E4%B8%AD%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7%E4%BA%8B%E5%8A%A1%E5%92%8C%E6%9F%94%E6%80%A7%E4%BA%8B%E5%8A%A1%E6%94%AF%E6%8C%81%E4%B8%8B/">29 åˆ†å¸ƒå¼äº‹åŠ¡ï¼šShardingSphere ä¸­å¦‚ä½•é›†æˆå¼ºä¸€è‡´æ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡æ”¯æŒï¼Ÿï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/30-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E6%94%B9%E5%86%99%E5%BC%95%E6%93%8E%E5%AE%9E%E7%8E%B0%E4%BD%8E%E4%BE%B5%E5%85%A5%E6%80%A7%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E6%96%B9%E6%A1%88/">30 æ•°æ®è„±æ•ï¼šå¦‚ä½•åŸºäºæ”¹å†™å¼•æ“å®ç°ä½ä¾µå…¥æ€§æ•°æ®è„±æ•æ–¹æ¡ˆï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/31-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%AE%9E%E7%8E%B0%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E7%9A%84%E5%8A%A8%E6%80%81%E5%8C%96%E7%AE%A1%E7%90%86/">31 é…ç½®ä¸­å¿ƒï¼šå¦‚ä½•åŸºäºé…ç½®ä¸­å¿ƒå®ç°é…ç½®ä¿¡æ¯çš„åŠ¨æ€åŒ–ç®¡ç†ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/32-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BF%E9%97%AE%E7%86%94%E6%96%AD%E6%9C%BA%E5%88%B6/">32 æ³¨å†Œä¸­å¿ƒï¼šå¦‚ä½•åŸºäºæ³¨å†Œä¸­å¿ƒå®ç°æ•°æ®åº“è®¿é—®ç†”æ–­æœºåˆ¶ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/33-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E-hook-%E6%9C%BA%E5%88%B6%E4%BB%A5%E5%8F%8A-opentracing-%E5%8D%8F%E8%AE%AE%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/">33 é“¾è·¯è·Ÿè¸ªï¼šå¦‚ä½•åŸºäº Hook æœºåˆ¶ä»¥åŠ OpenTracing åè®®å®ç°æ•°æ®è®¿é—®é“¾è·¯è·Ÿè¸ªï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/35-%E7%BB%93%E8%AF%ADshardingsphere-%E6%80%BB%E7%BB%93%E5%8F%8A%E5%B1%95%E6%9C%9B/">35 ç»“è¯­ï¼šShardingSphere æ€»ç»“åŠå±•æœ›</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">16 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸‹ï¼‰</h1>
        <div class="post-info">
            <div class="post-date"> 
                <span>2021-12-22 01:55:55</span>
            </div>
        </div>
        <div class="post-content">
            <p>æˆ‘ä»¬çŸ¥é“æ•´ä¸ª SQL è§£æå¼•æ“å¯ä»¥åˆ†æˆä¸‰ä¸ªé˜¶æ®µï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ï¼Œä¸Šä¸€è¯¾æ—¶æˆ‘ä»¬ä¸»è¦ä»‹ç»äº† ShardingSphere ä¸­ SQL è§£æå¼•æ“çš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œé‚£ä¹ˆä»Šå¤©æˆ‘å°†æ‰¿æ¥ä¸Šä¸€è¯¾æ—¶ï¼Œç»§ç»­è®²è§£ ShardingSphere ä¸­ SQL è§£ææµç¨‹ä¸­å‰©ä½™çš„ä¸¤ä¸ªé˜¶æ®µã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F8ry7-AWFaOAACKmUmdLPs289.png" alt="Drawing 0.png"></p>
<h3 id="sql-è§£æå¼•æ“çš„ä¸‰å¤§é˜¶æ®µ">SQL è§£æå¼•æ“çš„ä¸‰å¤§é˜¶æ®µ</h3>
<p>åœ¨ SQL è§£æå¼•æ“çš„ç¬¬ä¸€é˜¶æ®µä¸­ï¼Œæˆ‘ä»¬è¯¦ç»†ä»‹ç»äº† ShardingSphere ç”Ÿæˆ SQL æŠ½è±¡è¯­æ³•æ ‘çš„è¿‡ç¨‹ï¼Œå¹¶å¼•å‡ºäº† SQLStatementRule è§„åˆ™ç±»ã€‚ä»Šå¤©æˆ‘ä»¬å°†åŸºäºè¿™ä¸ªè§„åˆ™ç±»æ¥åˆ†æå¦‚ä½•æå– SQLSegment ä»¥åŠå¦‚ä½•å¡«å…… SQL è¯­å¥çš„å®ç°æœºåˆ¶ã€‚</p>
<h4 id="1ç¬¬äºŒé˜¶æ®µæå–-sql-ç‰‡æ®µ">1.ç¬¬äºŒé˜¶æ®µï¼šæå– SQL ç‰‡æ®µ</h4>
<p>è¦ç†è§£ SQLStatementRuleï¼Œå°±éœ€è¦å…ˆä»‹ç» ParseRuleRegistry ç±»ã€‚ä»å‘½åä¸Šçœ‹ï¼Œè¯¥ç±»å°±æ˜¯ä¸€ä¸ªè§„åˆ™æ³¨å†Œè¡¨ï¼Œä¿å­˜ç€å„ç§è§£æè§„åˆ™ä¿¡æ¯ã€‚ParseRuleRegistry ç±»ä¸­çš„æ ¸å¿ƒå˜é‡åŒ…æ‹¬å¦‚ä¸‹æ‰€ç¤ºçš„ä¸‰ä¸ª Loader ç±»ï¼š</p>
<pre tabindex="0"><code>private final ExtractorRuleDefinitionEntityLoader extractorRuleLoader = new ExtractorRuleDefinitionEntityLoader(); 
     
    private final FillerRuleDefinitionEntityLoader fillerRuleLoader = new FillerRuleDefinitionEntityLoader(); 
     
    private final SQLStatementRuleDefinitionEntityLoader statementRuleLoader = new SQLStatementRuleDefinitionEntityLoader(); 
</code></pre><p>ä»å‘½åä¸Šå¯ä»¥çœ‹åˆ°è¿™ä¸‰ä¸ª Loader ç±»åˆ†åˆ«å¤„ç†å¯¹ SQLStatementRuleã€ExtractorRule å’Œ FillerRule è¿™ä¸‰ç§è§„åˆ™å®šä¹‰çš„åŠ è½½ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ SQLStatementRuleï¼Œå®ƒä»¬çš„å®šä¹‰ä½äº sql-statement-rule-definition.xml é…ç½®æ–‡ä»¶ä¸­ã€‚æˆ‘ä»¬ä»¥ Mysql ä¸ºä¾‹ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶ä½äº shardingsphere-sql-parser-mysql å·¥ç¨‹ä¸­çš„ META-INF/parsing-rule-definition/mysql ç›®å½•ä¸‹ã€‚æˆ‘ä»¬æˆªå–è¯¥é…ç½®æ–‡ä»¶ä¸­çš„éƒ¨åˆ†é…ç½®ä¿¡æ¯ä½œä¸ºæ¼”ç¤ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>&lt;sql-statement-rule-definition&gt; 
    &lt;sql-statement-rule context=&quot;select&quot; sql-statement-class=&quot;org.apache.shardingsphere.sql.parser.sql.statement.dml.SelectStatement&quot; extractor-rule-refs=&quot;tableReferences, columns, selectItems, where, predicate, groupBy, orderBy, limit, subqueryPredicate, lock&quot; /&gt; 
    &lt;sql-statement-rule context=&quot;insert&quot; sql-statement-class=&quot;org.apache.shardingsphere.sql.parser.sql.statement.dml.InsertStatement&quot; extractor-rule-refs=&quot;table, columns, insertColumns, insertValues, setAssignments, onDuplicateKeyColumns&quot; /&gt; 
    &lt;sql-statement-rule context=&quot;update&quot; sql-statement-class=&quot;org.apache.shardingsphere.sql.parser.sql.statement.dml.UpdateStatement&quot; extractor-rule-refs=&quot;tableReferences, columns, setAssignments, where, predicate&quot; /&gt; 
    &lt;sql-statement-rule context=&quot;delete&quot; sql-statement-class=&quot;org.apache.shardingsphere.sql.parser.sql.statement.dml.DeleteStatement&quot; extractor-rule-refs=&quot;tables, columns, where, predicate&quot; /&gt; 
â€¦ 
&lt;/sql-statement-rule-definition&gt; 
</code></pre><p>åŸºäº ParseRuleRegistry ç±»è¿›è¡Œè§„åˆ™è·å–å’Œå¤„ç†è¿‡ç¨‹ï¼Œæ¶‰åŠä¸€å¤§æ‰¹å®ä½“å¯¹è±¡ä»¥åŠç”¨äºè§£æ XML é…ç½®æ–‡ä»¶çš„ JAXB å·¥å…·ç±»çš„å®šä¹‰ï¼Œå†…å®¹è™½å¤šä½†å¹¶ä¸å¤æ‚ã€‚æ ¸å¿ƒç±»ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F8ry9CAPtDdAACEYYKrCTU070.png" alt="Drawing 2.png"></p>
<p>ParseRuleRegistry ç±»å±‚ç»“æ„å›¾</p>
<p>å½“è·å–è§„åˆ™ä¹‹åï¼Œå¯¹äºå…·ä½“æŸç§æ•°æ®åº“ç±»å‹çš„æ¯æ¡ SQL è€Œè¨€ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ª SQLStatementRule å¯¹è±¡ã€‚æˆ‘ä»¬æ³¨æ„åˆ°æ¯ä¸ª SQLStatementRule éƒ½å®šä¹‰äº†ä¸€ä¸ªâ€œcontextâ€ä»¥åŠä¸€ä¸ªâ€œsql-statement-classâ€ã€‚</p>
<p>è¿™é‡Œçš„ context å®é™…ä¸Šå°±æ˜¯é€šè¿‡ SQL è§£ææ‰€ç”Ÿæˆçš„æŠ½è±¡è¯­æ³•æ ‘ SQLAST ä¸­çš„ ParserRuleContextï¼ŒåŒ…æ‹¬ CreateTableContextã€SelectContext ç­‰å„ç§ StatementContextã€‚è€Œé’ˆå¯¹æ¯ä¸€ç§ contextï¼Œéƒ½æœ‰ä¸“é—¨çš„ä¸€ä¸ª SQLStatement å¯¹è±¡ä¸ä¹‹å¯¹åº”ï¼Œé‚£ä¹ˆè¿™ä¸ª SQLStatement ç©¶ç«Ÿé•¿ä»€ä¹ˆæ ·å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ã€‚</p>
<pre tabindex="0"><code>public interface SQLStatement { 
     
    //è·å–å‚æ•°ä¸ªæ•° 
    int getParametersCount(); 
     
    //è·å–æ‰€æœ‰SQLSegment 
    Collection&lt;SQLSegment&gt; getAllSQLSegments(); 
     
    //æ ¹æ®ç±»å‹è·å–ä¸€ä¸ªSQLSegment 
    &lt;T extends SQLSegment&gt; Optional&lt;T&gt; findSQLSegment(Class&lt;T&gt; sqlSegmentType); 
     
    //æ ¹æ®ç±»å‹è·å–ä¸€ç»„SQLSegment 
    &lt;T extends SQLSegment&gt; Collection&lt;T&gt; findSQLSegments(Class&lt;T&gt; sqlSegmentType); 
} 
</code></pre><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œä½œä¸ºè§£æå¼•æ“æœ€ç»ˆäº§ç‰©çš„ SQLStatement ï¼Œå®é™…ä¸Šå°è£…çš„æ˜¯å¯¹ SQL ç‰‡æ®µå¯¹è±¡ SQLSegment çš„è·å–æ“ä½œã€‚æ˜¾ç„¶ï¼Œå¯¹äºæ¯ä¸€ä¸ª ParserRuleContext è€Œè¨€ï¼Œæˆ‘ä»¬æœ€ç»ˆå°±æ˜¯æ„å»ºäº†ä¸€ä¸ªåŒ…å«ä¸€ç»„ SQLSegment çš„ SQLStatement å¯¹è±¡ï¼Œè€Œè¿™äº› SQLSegment çš„æ„å»ºè¿‡ç¨‹å°±æ˜¯æ‰€è°“çš„æå– SQLSegment çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­ä¹Ÿæ˜ç¡®çœ‹åˆ°äº† SQLStatementRule ä¸­å¯¹å„ç§æå–è§„åˆ™å¯¹è±¡ ExtractorRule çš„å¼•ç”¨ã€‚</p>
<p>åœ¨ ShardingSphere ä¸­å†…ç½®äº†ä¸€å¤§æ‰¹é€šç”¨çš„ SQLSegmentï¼ŒåŒ…æ‹¬æŸ¥è¯¢é€‰æ‹©é¡¹ï¼ˆSelectItemsï¼‰ã€è¡¨ä¿¡æ¯ï¼ˆTableï¼‰ã€æ’åºä¿¡æ¯ï¼ˆOrderByï¼‰ã€åˆ†ç»„ä¿¡æ¯ï¼ˆGroupByï¼‰ä»¥åŠåˆ†é¡µä¿¡æ¯ï¼ˆLimitï¼‰ç­‰ã€‚è¿™äº›é€šç”¨ SQLSegment éƒ½æœ‰å¯¹åº”çš„ SQLSegmentExtractorï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ SQLStatementRule ä¸­è¿›è¡Œä½¿ç”¨ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œè€ƒè™‘åˆ° SQL æ–¹è¨€çš„å·®å¼‚æ€§ï¼ŒShardingSphere åŒæ ·æä¾›äº†é’ˆå¯¹å„ç§æ•°æ®åº“çš„ SQLSegment çš„æå–å™¨å®šä¹‰ã€‚ä»¥ Mysql ä¸ºä¾‹ï¼Œåœ¨å…¶ä»£ç å·¥ç¨‹çš„ META-INF/parsing-rule-definition/mysql ç›®å½•ä¸‹ï¼Œå­˜åœ¨ä¸€ä¸ª extractor-rule-definition.xml é…ç½®æ–‡ä»¶ï¼Œä¸“é—¨ç”¨æ¥å®šä¹‰é’ˆå¯¹ Mysql çš„å„ç§ SQLSegmentExtractorï¼Œéƒ¨åˆ†å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼Œä½œä¸ºä¸€æ¬¾é€‚ç”¨äºå¤šæ•°æ®åº“çš„ä¸­é—´ä»¶ï¼Œè¿™ä¹Ÿæ˜¯ ShardingSphere åº”å¯¹ SQL æ–¹è¨€çš„å®ç°æœºåˆ¶ä¹‹ä¸€ã€‚</p>
<pre tabindex="0"><code>&lt;extractor-rule-definition&gt; 
    &lt;extractor-rule id=&quot;addColumnDefinition&quot; extractor-class=&quot;org.apache.shardingsphere.sql.parser.core.extractor.ddl.MySQLAddColumnDefinitionExtractor&quot; /&gt; 
    &lt;extractor-rule id=&quot;modifyColumnDefinition&quot; extractor-class=&quot;org.apache.shardingsphere.sql.parser.core.extractor.ddl.MySQLModifyColumnDefinitionExtractor&quot; /&gt; 
    â€¦ 
&lt;/extractor-rule-definition&gt; 
</code></pre><p>ç°åœ¨ï¼Œå‡è®¾æœ‰è¿™æ ·ä¸€å¥ SQLï¼š</p>
<pre tabindex="0"><code>SELECT task_id, task_name FROM health_task WHERE user_id = 'user1' AND record_id = 2  
</code></pre><p>é€šè¿‡è§£æï¼Œæˆ‘ä»¬è·å–äº†å¦‚ä¸‹æ‰€ç¤ºçš„æŠ½è±¡è¯­æ³•æ ‘ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F8ry_WAEwAzAACKQ3CnEFw961.png" alt="Drawing 4.png"></p>
<p>æŠ½è±¡è¯­æ³•æ ‘ç¤ºæ„å›¾</p>
<p>æˆ‘ä»¬å‘ç°ï¼Œå¯¹äºä¸Šè¿°æŠ½è±¡è¯­æ³•æ ‘ä¸­çš„æŸäº›èŠ‚ç‚¹ï¼ˆå¦‚ SELECTã€FROM å’Œ WHEREï¼‰æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œè€Œå¯¹äºå¦‚ FIELDSã€TABLES å’Œ CONDITIONS èŠ‚ç‚¹è€Œè¨€ï¼Œæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸¤ç§èŠ‚ç‚¹çš„æå–è§„åˆ™åº”è¯¥æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p>å› æ­¤ï¼ŒShardingSphere æä¾›äº†ä¸¤ç§ SQLSegmentExtractorï¼Œä¸€ç§æ˜¯é’ˆå¯¹å•èŠ‚ç‚¹çš„ OptionalSQLSegmentExtractorï¼›å¦ä¸€ç§æ˜¯é’ˆå¯¹æ ‘çŠ¶èŠ‚ç‚¹çš„ CollectionSQLSegmentExtractorã€‚ç”±äºç¯‡å¹…å› ç´ ï¼Œè¿™é‡Œä»¥ TableExtractor ä¸ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•æå– TableSegment çš„è¿‡ç¨‹ï¼ŒTableExtractor çš„å®ç°æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public final class TableExtractor implements OptionalSQLSegmentExtractor { 
     
    @Override 
    public Optional&lt;TableSegment&gt; extract(final ParserRuleContext ancestorNode, final Map&lt;ParserRuleContext, Integer&gt; parameterMarkerIndexes) { 
        //ä»Contextä¸­è·å–TableNameèŠ‚ç‚¹ 
     Optional&lt;ParserRuleContext&gt; tableNameNode = ExtractorUtils.findFirstChildNode(ancestorNode, RuleName.TABLE_NAME); 
        if (!tableNameNode.isPresent()) { 
            return Optional.absent(); 
        }         
        //æ ¹æ®TableNameèŠ‚ç‚¹æ„å»ºTableSegment 
        TableSegment result = getTableSegment(tableNameNode.get()); 
        //è®¾ç½®è¡¨çš„åˆ«å 
        setAlias(tableNameNode.get(), result); 
        return Optional.of(result); 
    } 
     
    private TableSegment getTableSegment(final ParserRuleContext tableNode) { 
     //ä»Contextä¸­è·å–NameèŠ‚ç‚¹       
        ParserRuleContext nameNode = ExtractorUtils.getFirstChildNode(tableNode, RuleName.NAME); 
        //æ ¹æ®NameèŠ‚ç‚¹è·å–èŠ‚ç‚¹çš„èµ·æ­¢ä½ç½®ä»¥åŠèŠ‚ç‚¹å†…å®¹ 
        TableSegment result = new TableSegment(nameNode.getStart().getStartIndex(), nameNode.getStop().getStopIndex(), nameNode.getText()); 
        //ä»Contextä¸­è·å–è¡¨çš„OwnerèŠ‚ç‚¹ï¼Œå¦‚æœæœ‰çš„è¯å°±è®¾ç½®Owner 
        Optional&lt;ParserRuleContext&gt; ownerNode = ExtractorUtils.findFirstChildNodeNoneRecursive(tableNode, RuleName.OWNER); 
        if (ownerNode.isPresent()) { 
            result.setOwner(new SchemaSegment(ownerNode.get().getStart().getStartIndex(), ownerNode.get().getStop().getStopIndex(), ownerNode.get().getText())); 
        } 
        return result; 
    } 
     
    private void setAlias(final ParserRuleContext tableNameNode, final TableSegment tableSegment) { 
     //ä»Contextä¸­è·å–AliasèŠ‚ç‚¹ï¼Œå¦‚æœæœ‰çš„è¯å°±è®¾ç½®åˆ«å 
     Optional&lt;ParserRuleContext&gt; aliasNode = ExtractorUtils.findFirstChildNode(tableNameNode.getParent(), RuleName.ALIAS); 
        if (aliasNode.isPresent()) { 
            tableSegment.setAlias(aliasNode.get().getText()); 
        } 
    } 
} 
</code></pre><p>æ˜¾ç„¶ï¼Œè¯­æ³•æ ‘ä¸­çš„ Table æ˜¯ä¸€ç§å•èŠ‚ç‚¹ï¼Œæ‰€ä»¥ TableExtractor ç»§æ‰¿è‡ª OptionalSQLSegmentExtractorã€‚å¯¹äº TableExtractor è€Œè¨€ï¼Œæ•´ä¸ªè§£æè¿‡ç¨‹å°±æ˜¯ä» ParserRuleContext ä¸­è·å–ä¸è¡¨å®šä¹‰ç›¸å…³çš„å„ç§èŠ‚ç‚¹ï¼Œç„¶åé€šè¿‡èŠ‚ç‚¹çš„èµ·æ­¢ä½ç½®ä»¥åŠèŠ‚ç‚¹å†…å®¹æ¥æ„å»º TableSegment å¯¹è±¡ã€‚TableSegment å®ç°äº† SQLSegmentï¼Œå…¶æ ¸å¿ƒå˜é‡çš„å®šä¹‰ä¹Ÿæ¯”è¾ƒæ˜ç¡®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public final class TableSegment implements SQLSegment, TableAvailable, OwnerAvailable&lt;SchemaSegment&gt;, AliasAvailable { 
     
    private final int startIndex;     
    private final int stopIndex;   
    private final String name;  
    private final QuoteCharacter quoteCharacter; 
    private SchemaSegment owner;  
private String alias; 
       â€¦ 
} 
</code></pre><p>ç°åœ¨ï¼ŒåŸºäºä»¥ä¸Šå…³äºæå–å™¨ä»¥åŠæå–æ“ä½œçš„ç›¸å…³æ¦‚å¿µçš„ç†è§£ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ SQLSegment æå–å¼•æ“ SQLSegmentsExtractorEngine çš„å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public final class SQLSegmentsExtractorEngine { 
     
    //ç”¨æ¥æå–SQLASTè¯­æ³•æ ‘ä¸­çš„SQLç‰‡æ®µ 
    public Collection&lt;SQLSegment&gt; extract(final SQLAST ast) { 
        Collection&lt;SQLSegment&gt; result = new LinkedList&lt;&gt;(); 
         
        //éå†æå–å™¨ï¼Œä»Contextä¸­æå–å¯¹åº”ç±»å‹çš„SQLSegmentï¼Œæ¯”å¦‚TableSegment         
        for (SQLSegmentExtractor each : ast.getSqlStatementRule().getExtractors()) {            
            //å•èŠ‚ç‚¹çš„åœºæ™¯ï¼Œç›´æ¥æå–å•ä¸€èŠ‚ç‚¹ä¸‹çš„å†…å®¹ 
            if (each instanceof OptionalSQLSegmentExtractor) { 
                Optional&lt;? extends SQLSegment&gt; sqlSegment = ((OptionalSQLSegmentExtractor) each).extract(ast.getParserRuleContext(), ast.getParameterMarkerIndexes()); 
                if (sqlSegment.isPresent()) { 
                    result.add(sqlSegment.get()); 
                } 
                 
            æ ‘çŠ¶èŠ‚ç‚¹çš„åœºæ™¯ï¼Œéå†æå–èŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹// 
            } else if (each instanceof CollectionSQLSegmentExtractor) { 
                result.addAll(((CollectionSQLSegmentExtractor) each).extract(ast.getParserRuleContext(), ast.getParameterMarkerIndexes())); 
            } 
        } 
        return result; 
    } 
} 
</code></pre><p>æ˜¾ç„¶ï¼ŒSQLSegmentsExtractorEngine çš„ä½œç”¨å°±æ˜¯é’ˆå¯¹æŸä¸€æ¡ SQLï¼Œéå† SQLStatementRule ä¸­æ‰€é…ç½®çš„æå–å™¨ï¼Œç„¶åä» Context ä¸­æå–å¯¹åº”ç±»å‹çš„ SQLSegmentï¼Œå¹¶æœ€ç»ˆå­˜æ”¾åœ¨ä¸€ä¸ªé›†åˆå¯¹è±¡ä¸­è¿›è¡Œè¿”å›ã€‚</p>
<h4 id="2ç¬¬ä¸‰é˜¶æ®µå¡«å……-sql-è¯­å¥">2.ç¬¬ä¸‰é˜¶æ®µï¼šå¡«å…… SQL è¯­å¥</h4>
<p>å®Œæˆæ‰€æœ‰ SQLSegment çš„æå–ä¹‹åï¼Œæˆ‘ä»¬å°±æ¥åˆ°äº†è§£æå¼•æ“çš„æœ€åä¸€ä¸ªé˜¶æ®µï¼Œå³å¡«å…… SQLStatementã€‚æ‰€è°“çš„<strong>å¡«å……è¿‡ç¨‹</strong>ï¼Œå°±æ˜¯é€šè¿‡å¡«å……å™¨ SQLSegmentFiller ä¸º SQLStatement æ³¨å…¥å…·ä½“ SQLSegment çš„è¿‡ç¨‹ã€‚è¿™ç‚¹ä» SQLSegmentFiller æ¥å£å®šä¹‰ä¸­çš„å„ä¸ªå‚æ•°å°±å¯ä»¥å¾—åˆ°æ˜ç¡®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public interface SQLSegmentFiller&lt;T extends SQLSegment&gt; { 
     
    void fill(T sqlSegment, SQLStatement sqlStatement); 
} 
</code></pre><p>é‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼Œæˆ‘ä»¬å¦‚ä½•æ­£ç¡®æŠŠæ¡ SQLSegmentFillerã€SQLSegment å’Œ SQLStatement è¿™ä¸‰è€…ä¹‹é—´çš„å¤„ç†å…³ç³»å‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ ¹æ®æŸä¸ª SQLSegment æ‰¾åˆ°å¯¹åº”çš„ SQLSegmentFillerï¼Œè¿™éƒ¨åˆ†å…³ç³»åœ¨ ShardingSphere ä¸­åŒæ ·æ˜¯ç»´æŠ¤åœ¨ä¸€ä¸ª filler-rule-definition.xml é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆªå–éƒ¨åˆ†é…ç½®é¡¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>&lt;filler-rule-definition&gt; 
    &lt;filler-rule sql-segment-class=&quot;org.apache.shardingsphere.sql.parser.sql.segment.generic.TableSegment&quot; filler-class=&quot;org.apache.shardingsphere.sql.parser.core.filler.impl.TableFiller&quot; /&gt; 
    &lt;filler-rule sql-segment-class=&quot;org.apache.shardingsphere.sql.parser.sql.segment.generic.SchemaSegment&quot; filler-class=&quot;org.apache.shardingsphere.sql.parser.core.filler.impl.dal.SchemaFiller&quot; /&gt; 
â€¦ 
&lt;/filler-rule-definition&gt; 
</code></pre><p>æ˜¾ç„¶ï¼Œè¿™é‡Œä¿å­˜ç€ SQLSegment ä¸ SQLSegmentFiller ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚å½“ç„¶ï¼Œå¯¹äºä¸åŒçš„ SQL æ–¹è¨€ï¼Œä¹ŸåŒæ ·å¯ä»¥ç»´æŠ¤è‡ªèº«çš„ filler-rule-definition.xml æ–‡ä»¶ã€‚</p>
<p>æˆ‘ä»¬è¿˜æ˜¯ä»¥ä¸ TableSegment å¯¹åº”çš„ TableFiller ä¸ºä¾‹ï¼Œæ¥åˆ†æä¸€ä¸ª SQLSegmentFiller çš„å…·ä½“å®ç°æ–¹æ³•ï¼ŒTableFiller ç±»å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public final class TableFiller implements SQLSegmentFiller&lt;TableSegment&gt; { 
     
    @Override 
    public void fill(final TableSegment sqlSegment, final SQLStatement sqlStatement) { 
        if (sqlStatement instanceof TableSegmentAvailable) { 
            ((TableSegmentAvailable) sqlStatement).setTable(sqlSegment); 
        } else if (sqlStatement instanceof TableSegmentsAvailable) { 
            ((TableSegmentsAvailable) sqlStatement).getTables().add(sqlSegment); 
        } 
    } 
} 
</code></pre><p>è¿™æ®µä»£ç åœ¨å®ç°ä¸Šé‡‡ç”¨äº†å›è°ƒæœºåˆ¶æ¥å®Œæˆå¯¹è±¡çš„æ³¨å…¥ã€‚åœ¨ ShardingSphere ä¸­ï¼ŒåŸºäºå›è°ƒçš„å¤„ç†æ–¹å¼ä¹Ÿéå¸¸æ™®éã€‚æœ¬è´¨ä¸Šï¼Œå›è°ƒè§£å†³äº†å› ä¸ºç±»ä¸ç±»ä¹‹é—´çš„ç›¸äº’è°ƒç”¨è€Œé€ æˆçš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå›è°ƒçš„å®ç°ç­–ç•¥é€šå¸¸é‡‡ç”¨äº†å¦‚ä¸‹æ‰€ç¤ºçš„ç±»å±‚ç»“æ„ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/Ciqc1F8rzBeAL-gtAAAtxVTlOkM440.png" alt="Drawing 6.png"></p>
<p>å›è°ƒæœºåˆ¶ç¤ºæ„å›¾</p>
<p>TableFiller ä¸­æ‰€ä¾èµ–çš„ TableSegmentAvailable å’Œ TableSegmentsAvailable æ¥å£å°±ç±»ä¼¼äºä¸Šå›¾ä¸­çš„ Callback æ¥å£ï¼Œå…·ä½“çš„ SQLStatement å°±æ˜¯ Callback çš„å®ç°ç±»ï¼Œè€Œ TableFiller åˆ™æ˜¯ Callback çš„è°ƒç”¨è€…ã€‚ä»¥ TableFiller ä¸ºä¾‹ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ï¼Œå¦‚æœå¯¹åº”çš„ SQLStatement å®ç°äº†è¿™ä¸¤ä¸ªæ¥å£ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡ TableFiller æ³¨å…¥å¯¹åº”çš„ TableSegmentï¼Œä»è€Œå®Œæˆ SQLSegment çš„å¡«å……ã€‚</p>
<p>è¿™é‡Œä»¥ TableSegmentAvailable æ¥å£ä¸ºä¾‹ï¼Œå®ƒæœ‰ä¸€ç»„å®ç°ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl8rzC2ADPHvAAAxxRKUUYw921.png" alt="Drawing 8.png"></p>
<p>TableSegmentAvailableå®ç°ç±»</p>
<p>ä»¥ä¸Šå›¾ä¸­çš„ CreateTableStatement ä¸ºä¾‹ï¼Œè¯¥ç±»åŒæ—¶å®ç°äº† TableSegmentAvailable å’Œ IndexSegmentsAvailable è¿™ä¸¤ä¸ªå›è°ƒæ¥å£ï¼Œæ‰€ä»¥å°±å¯ä»¥åŒæ—¶æ“ä½œ TableSegment å’Œ IndexSegment è¿™ä¸¤ä¸ª SQLSegmentã€‚CreateTableStatement ç±»çš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public final class CreateTableStatement extends DDLStatement implements TableSegmentAvailable, IndexSegmentsAvailable { 
     
    private TableSegment table; 
     
    private final Collection&lt;ColumnDefinitionSegment&gt; columnDefinitions = new LinkedList&lt;&gt;(); 
     
    private final Collection&lt;IndexSegment&gt; indexes = new LinkedList&lt;&gt;(); 
} 
</code></pre><p>è‡³æ­¤ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç¤ºä¾‹è§£é‡Šäº†ä¸å¡«å……æ“ä½œç›¸å…³çš„å„ä¸ªç±»ä¹‹é—´çš„åä½œå…³ç³»ï¼Œå¦‚ä¸‹æ‰€ç¤ºçš„ç±»å›¾å±•ç¤ºäº†è¿™ç§åä½œå…³ç³»çš„æ•´ä½“ç»“æ„ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ShardingSphere%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2-%E5%AE%8C/assets/CgqCHl8rzDqAVtDCAAB-8xyeFnI893.png" alt="Drawing 9.png"></p>
<p>SQLStatementç±»å±‚ç»“æ„å›¾</p>
<p>æœ‰äº†ä¸Šå›¾çš„åŸºç¡€ï¼Œæˆ‘ä»¬ç†è§£å¡«å……å¼•æ“ SQLStatementFillerEngine å°±æ˜¾å¾—æ¯”è¾ƒç®€å•äº†ï¼ŒSQLStatementFillerEngine ç±»çš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public final class SQLStatementFillerEngine { 
     
    private final ParseRuleRegistry parseRuleRegistry;     
    private final String databaseTypeName; 
    
    @SuppressWarnings(&quot;unchecked&quot;) 
    @SneakyThrows 
    public SQLStatement fill(final Collection&lt;SQLSegment&gt; sqlSegments, final int parameterMarkerCount, final SQLStatementRule rule) { 
     //ä»SQLStatementRuleä¸­è·å–SQLStatementå®ä¾‹ï¼Œå¦‚CreateTableStatement 
     SQLStatement result = rule.getSqlStatementClass().newInstance(); 
        //é€šè¿‡æ–­è¨€å¯¹SQLStatementçš„åˆæ³•æ€§è¿›è¡Œæ ¡éªŒ 
     Preconditions.checkArgument(result instanceof AbstractSQLStatement, &quot;%s must extends AbstractSQLStatement&quot;, result.getClass().getName()); 
         
        //è®¾ç½®å‚æ•°ä¸ªæ•° 
        ((AbstractSQLStatement) result).setParametersCount(parameterMarkerCount); 
       
        //æ·»åŠ æ‰€æœ‰çš„SQLSegmentåˆ°SQLStatementä¸­ 
        result.getAllSQLSegments().addAll(sqlSegments); 
         
        //éå†å¡«å……å¯¹åº”ç±»å‹çš„SQLSegment 
        for (SQLSegment each : sqlSegments) { 
         //æ ¹æ®æ•°æ®åº“ç±»å‹å’ŒSQLSegmentæ‰¾åˆ°å¯¹åº”çš„SQLSegmentFillerï¼Œå¹¶ä¸ºSQLStatementå¡«å……SQLSegment 
            //å¦‚é€šè¿‡TableSegmentæ‰¾åˆ°è·å–TableFillerï¼Œç„¶åé€šè¿‡TableFillerä¸ºCreateTableStatementå¡«å……TableSegment 
         Optional&lt;SQLSegmentFiller&gt; filler = parseRuleRegistry.findSQLSegmentFiller(databaseTypeName, each.getClass()); 
            if (filler.isPresent()) {                
              //åˆ©ç”¨SQLSegmentFilleræ¥å¡«å……SQLStatementä¸­çš„SQLSegment 
                filler.get().fill(each, result); 
            } 
        } 
        return result; 
}  
} 
</code></pre><p>æˆ‘ä»¬å¯¹ SQLStatementFillerEngine ä¸­çš„æ ¸å¿ƒä»£ç éƒ½æ·»åŠ äº†æ³¨é‡Šï¼Œæ³¨æ„åˆ°è¿™é‡Œé€šè¿‡æ•°æ®åº“ç±»å‹ä»¥åŠ SQLSegment çš„ç±»å‹ï¼Œä»è§„åˆ™æ³¨å†Œè¡¨ ParseRuleRegistry ä¸­è·å–äº†å¯¹åº”çš„ SQLSegmentFiller å¹¶å®Œæˆå¯¹ SQLStatement çš„å¡«å……æ“ä½œã€‚</p>
<p>è‡³æ­¤ï¼ŒShardingSphere ä¸­ SQL è§£æå¼•æ“çš„ä¸‰å¤§é˜¶æ®µä»‹ç»å®Œæ¯•ã€‚æˆ‘ä»¬å·²ç»è·å–äº†ç›®æ ‡ SQLStatementï¼Œä¸ºè¿›è¡Œåç»­çš„è·¯ç”±ç­‰æ“ä½œæä¾›äº†åŸºç¡€ã€‚</p>
<h3 id="ä»æºç è§£æåˆ°æ—¥å¸¸å¼€å‘">ä»æºç è§£æåˆ°æ—¥å¸¸å¼€å‘</h3>
<p>é€šè¿‡å¯¹æ¡†æ¶æºä»£ç çš„å­¦ä¹ ï¼Œä¸€æ–¹é¢å¯ä»¥å¸®å¿™æˆ‘ä»¬æ›´å¥½åœ°ç†è§£è¯¥æ¡†æ¶æ ¸å¿ƒåŠŸèƒ½èƒŒåçš„å®ç°åŸç†ï¼›å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¸æ”¶è¿™äº›ä¼˜ç§€æ¡†æ¶çš„è®¾è®¡æ€æƒ³å’Œå®ç°æ–¹æ³•ï¼Œä»è€Œæ›´å¥½åœ°æŒ‡å¯¼æ—¥å¸¸å¼€å‘å·¥ä½œã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬åŒæ ·æ€»ç»“äº†ä¸€ç»„è®¾è®¡å’Œå®ç°ä¸Šçš„æŠ€å·§ã€‚</p>
<h4 id="1è®¾è®¡æ¨¡å¼çš„åº”ç”¨æ–¹å¼">1.è®¾è®¡æ¨¡å¼çš„åº”ç”¨æ–¹å¼</h4>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦æ¶‰åŠäº†ä¸¤ç§è®¾è®¡æ¨¡å¼çš„åº”ç”¨åœºæ™¯ï¼Œä¸€ç§æ˜¯å·¥å‚æ¨¡å¼ï¼Œå¦ä¸€ç§æ˜¯å¤–è§‚æ¨¡å¼ã€‚</p>
<p><strong>å·¥å‚æ¨¡å¼</strong>çš„åº”ç”¨æ¯”è¾ƒç®€å•ï¼Œä½œç”¨ä¹Ÿæ¯”è¾ƒç›´æ¥ã€‚ä¾‹å¦‚ï¼ŒSQLParseEngineFactory å·¥å‚ç±»ç”¨äºåˆ›å»º SQLParseEngineï¼Œè€Œ SQLParserFactory å·¥å‚ç±»ç”¨äºåˆ›å»º SQLParserã€‚</p>
<p>ç›¸æ¯”å·¥å‚æ¨¡å¼ï¼Œ<strong>å¤–è§‚ç±»</strong>é€šå¸¸æ¯”è¾ƒéš¾è¯†åˆ«å’ŒæŠŠæ¡ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¹ŸèŠ±äº†ä¸€å®šç¯‡å¹…ä»‹ç»äº† SQL è§£æå¼•æ“ä¸­çš„å¤–è§‚ç±» SQLParseKernelï¼Œä»¥åŠä¸ SQLParseEngine ä¹‹é—´çš„å§”æ‰˜å…³ç³»ã€‚</p>
<h4 id="2ç¼“å­˜çš„å®ç°æ–¹å¼">2.ç¼“å­˜çš„å®ç°æ–¹å¼</h4>
<p>ç¼“å­˜åœ¨ ShardingSphere ä¸­åº”ç”¨éå¸¸å¹¿æ³›ï¼Œå…¶å®ç°æ–¹å¼ä¹Ÿæ¯”è¾ƒå¤šæ ·ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°±æ¥è§¦åˆ°äº†ä¸¤ç§ç¼“å­˜çš„å®ç°æ–¹å¼ã€‚</p>
<p>ç¬¬ä¸€ç§æ˜¯é€šè¿‡ ConcurrentHashMap ç±»æ¥ä¿å­˜ SQLParseEngine çš„å®ä¾‹ï¼Œä½¿ç”¨ä¸Šæ¯”è¾ƒç®€å•ã€‚</p>
<p>å¦ä¸€ç§åˆ™åŸºäº Guava æ¡†æ¶ä¸­çš„ Cache ç±»æ„å»ºäº†ä¸€ä¸ª SQLParseResultCache æ¥ä¿å­˜ SQLStatement å¯¹è±¡ã€‚Guava ä¸­çš„ Cache ç±»åˆå§‹åŒ–æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ put å’Œ getIfPresent ç­‰æ–¹æ³•å¯¹ç¼“å­˜è¿›è¡Œæ“ä½œï¼š</p>
<pre tabindex="0"><code>Cache&lt;String, SQLStatement&gt; cache = CacheBuilder.newBuilder().softValues().initialCapacity(2000).maximumSize(65535).build();     
</code></pre><h4 id="3é…ç½®ä¿¡æ¯çš„ä¸¤çº§ç®¡ç†æœºåˆ¶">3.é…ç½®ä¿¡æ¯çš„ä¸¤çº§ç®¡ç†æœºåˆ¶</h4>
<p>åœ¨ ShardingSphere ä¸­ï¼Œå…³äºå„ç§æå–è§„åˆ™å’Œå¡«å……è§„åˆ™çš„å®šä¹‰éƒ½æ”¾åœ¨äº† XML é…ç½®æ–‡ä»¶ä¸­ï¼Œå¹¶é‡‡ç”¨äº†é…ç½®ä¿¡æ¯çš„ä¸¤çº§ç®¡ç†æœºåˆ¶ã€‚è¿™ç§<strong>ä¸¤çº§ç®¡ç†æœºåˆ¶</strong>çš„è®¾è®¡æ€æƒ³åœ¨äºï¼Œç³»ç»Ÿåœ¨æä¾›äº†å¯¹å„ç§é€šç”¨è§„åˆ™é»˜è®¤å®ç°çš„åŒæ—¶ï¼Œä¹Ÿèƒ½å¤Ÿé›†æˆæ¥è‡ªå„ç§ SQL æ–¹è¨€çš„å®šåˆ¶åŒ–è§„åˆ™ï¼Œä»è€Œå½¢æˆä¸€å¥—å…·æœ‰è¾ƒé«˜çµæ´»æ€§ä»¥åŠå¯æ‰©å±•æ€§çš„è§„åˆ™ç®¡ç†ä½“ç³»ã€‚</p>
<h4 id="4å›è°ƒæœºåˆ¶">4.å›è°ƒæœºåˆ¶</h4>
<p>æ‰€è°“<strong>å›è°ƒ</strong>ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç§<strong>åŒå‘è°ƒç”¨æ¨¡å¼</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¢«è°ƒç”¨æ–¹åœ¨è¢«è°ƒç”¨çš„åŒæ—¶ä¹Ÿä¼šè°ƒç”¨å¯¹æ–¹ã€‚åœ¨å®ç°ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥æå–ä¸€ä¸ªç”¨äºä¸šåŠ¡æ¥å£ä½œä¸ºä¸€ç§ Callback æ¥å£ï¼Œç„¶åè®©å…·ä½“çš„ä¸šåŠ¡å¯¹è±¡å»å®ç°è¿™ä¸ªæ¥å£ã€‚è¿™æ ·ï¼Œå½“å¤–éƒ¨å¯¹è±¡ä¾èµ–äºè¿™ä¸ªä¸šåŠ¡åœºæ™¯æ—¶ï¼Œåªéœ€è¦ä¾èµ–è¿™ä¸ª Callback æ¥å£ï¼Œè€Œä¸éœ€è¦å…³å¿ƒè¿™ä¸ªæ¥å£çš„å…·ä½“å®ç°ç±»ã€‚</p>
<p>è¿™åœ¨è½¯ä»¶è®¾è®¡å’Œå®ç°è¿‡ç¨‹ä¸­æ˜¯ä¸€ç§å¸¸è§çš„æ¶ˆé™¤ä¸šåŠ¡å¯¹è±¡å’Œå¤–éƒ¨å¯¹è±¡ä¹‹é—´å¾ªç¯ä¾èµ–çš„å¤„ç†æ–¹å¼ã€‚ShardingSphere ä¸­å¤§é‡é‡‡ç”¨äº†è¿™ç§å®ç°æ–¹å¼æ¥ç¡®ä¿ä»£ç çš„å¯ç»´æŠ¤æ€§ï¼Œè¿™éå¸¸å€¼å¾—æˆ‘ä»¬å­¦ä¹ ã€‚</p>
<h3 id="å°ç»“">å°ç»“</h3>
<p>ä½œä¸º ShardingSphere åˆ†ç‰‡å¼•æ“çš„ç¬¬ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œè§£æå¼•æ“çš„ç›®çš„åœ¨äºç”Ÿæˆ SQLStatement ç›®æ ‡å¯¹è±¡ã€‚è€Œæ•´ä¸ªè§£æå¼•æ“åˆ†æˆä¸‰å¤§é˜¶æ®µï¼Œå³ç”Ÿæˆ SQL æŠ½è±¡è¯­æ³•æ ‘ã€æå– SQL ç‰‡æ®µä»¥åŠä½¿ç”¨è¿™äº›ç‰‡æ®µæ¥å¡«å…… SQL è¯­å¥ã€‚æœ¬æ–‡å¯¹è§£æå¼•æ“çš„æ•´ä½“ç»“æ„ä»¥åŠè¿™ä¸‰ä¸ªé˜¶æ®µè¿›è¡Œäº†è¯¦ç»†çš„è®¨è®ºã€‚</p>
<p>æœ€åç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜ï¼šç®€è¦ä»‹ç» ShardingSphere ä¸­ SQL è§£æçš„å„ä¸ªé˜¶æ®µçš„è¾“å…¥å’Œäº§å‡ºï¼Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸å¤§å®¶è®¨è®ºï¼Œæˆ‘å°†ä¸€ä¸€ç‚¹è¯„è§£ç­”ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»è·å–äº† SQLStatementï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ç”¨æ¥æ‰§è¡Œ SQL è·¯ç”±æ“ä½œï¼Œè¿™å°±æ˜¯ä¸‹ä¸€è¯¾æ—¶å†…å®¹ã€‚</p>

        </div>
    </article>
</div>
<div class="division-line"></div>
<div class="others">
    <div>æ ‡ç­¾ï¼šğŸ·ï¸<a class="post-tag" href="/tags/sharding/">sharding</a>&nbsp;</div>
    <div>åˆ†ç±»ï¼š ğŸ“’<a class="post-category" href="/categories/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/">ShardingSphereæ ¸å¿ƒåŸç†ç²¾è®²</a>&nbsp; </div>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/15-%E8%A7%A3%E6%9E%90%E5%BC%95%E6%93%8Esql-%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B%E5%BA%94%E8%AF%A5%E5%8C%85%E6%8B%AC%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E9%98%B6%E6%AE%B5%E4%B8%8A/"><span>15 è§£æå¼•æ“ï¼šSQL è§£ææµç¨‹åº”è¯¥åŒ…æ‹¬å“ªäº›æ ¸å¿ƒé˜¶æ®µï¼Ÿï¼ˆä¸Šï¼‰</span></a>
    </div>
    <div class="next">
        
        <a href="http://yipsen.github.io/documents/columns/sharding/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/17-%E8%B7%AF%E7%94%B1%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E5%88%86%E7%89%87%E8%B7%AF%E7%94%B1%E6%A0%B8%E5%BF%83%E7%B1%BB-shardingrouter-%E7%9A%84%E8%BF%90%E4%BD%9C%E6%9C%BA%E5%88%B6/"><span>17 è·¯ç”±å¼•æ“ï¼šå¦‚ä½•ç†è§£åˆ†ç‰‡è·¯ç”±æ ¸å¿ƒç±» ShardingRouter çš„è¿ä½œæœºåˆ¶ï¼Ÿ</span></a>
    </div>
</div>

        </div>
        <div id="float">
            <ul class="float-button-bar">
    <li>
        <button class="float-button top" onclick="scrollToTop(this);">UP</button>
    </li>
    <li>
        <button class="float-button toggler" onclick="changeSkin(this);">DARK</button>
    </li>
</ul>
        </div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 2020 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    const changeSkin = () => {
        document.getElementById('page').classList.toggle('night');
    }
    const scrollToTop = () => {
        window.scrollTo(0, 0);
    }
</script>
</body>

</html>