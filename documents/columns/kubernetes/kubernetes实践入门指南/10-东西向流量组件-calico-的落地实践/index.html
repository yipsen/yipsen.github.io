<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>10 ä¸œè¥¿å‘æµé‡ç»„ä»¶ Calico çš„è½åœ°å®è·µ | Yipsen Ye</title>
<meta name="description" content="Kubernetes ç½‘ç»œå¹¶æ²¡æœ‰åŸç”Ÿçš„æ–¹æ¡ˆï¼Œå®ƒä»ä¸€å¼€å§‹å°±ç»™æˆ‘ä»¬é€æ¥äº†ä¸€ä¸ªé€‰æ‹©é¢˜ã€‚åˆ°åº•é€‰å“ªç§ç½‘ç»œæ–¹æ¡ˆæ‰æ˜¯æœ€ä½³çš„æ–¹æ¡ˆå‘¢ï¼Ÿç½‘ç»œé—®é¢˜ä¸€ç›´è®©ç¤¾åŒºç”¨æˆ·å¾ˆå›°æƒ‘ï¼Œä»¥è‡³äºåœ¨æ—©æœŸï¼Œä¸åŒåœºæ™¯ä¸‹çš„æ–¹æ¡ˆå¦‚é›¨åæ˜¥ç¬‹èˆ¬æ¶Œç°å‡ºæ¥ã€‚å…¶ä¸­æ¯”è¾ƒä¼˜ç§€çš„å°±æ˜¯ä»Šå¤©é€‰æ‹©ç»™å¤§å®¶ä»‹ç»çš„ç½‘ç»œç»„ä»¶ Calicoã€‚è¿™é‡Œæˆ‘ä»¬è¦å¼ºè°ƒçš„æ˜¯ï¼ŒCalico æ–¹æ¡ˆå¹¶ä¸æ˜¯å”¯ä¸€æ–¹æ¡ˆï¼Œæˆ‘ä»¬åœ¨ç¤¾åŒºä»ç„¶èƒ½çœ‹åˆ°å¾ˆå¤šä¼˜ç§€çš„æ–¹æ¡ˆæ¯”å¦‚ Ciliumã€OvSã€Contivã€Flannel ç­‰ï¼Œè‡³äºé€‰æ‹©å®ƒæ¥è®²è§£ä¸œè¥¿å‘æµé‡çš„ç»„ä»¶è½åœ°ï¼Œå®åœ¨æ˜¯å½“å‰å›½å†…ä¸šç•Œå¤§éƒ¨åˆ†çš„æ–¹æ¡ˆéƒ½æ˜¯ä»¥ Cailico å®è·µä¸ºä¸»ï¼Œä»‹ç»å®ƒå¯ä»¥èµ·åˆ°ä¸€ä¸ªæ¡ˆä¾‹ç¤ºèŒƒçš„ä½œç”¨ã€‚
å®¹å™¨ç½‘ç»œè·¯ç”±çš„åŸç† ä¼—æ‰€å‘¨çŸ¥å®¹å™¨åŸç”Ÿç½‘ç»œæ¨¡å‹åŸºäºå•æœºçš„ veth è™šæ‹Ÿç½‘æ¡¥å®ç°ï¼Œæ— æ³•è·¨ä¸»æœºäº’è”äº’é€šã€‚å¦‚æœæƒ³è®©å®¹å™¨è·¨ä¸»æœºäº’è”äº’é€šï¼Œéœ€è¦æ”¯æŒä»¥ä¸‹ 3 ç‚¹ï¼š
 ç½‘ç»œæ§åˆ¶é¢éœ€è¦ä¿è¯å®¹å™¨ IP çš„å”¯ä¸€æ€§ ä¸¤ä¸ªå®¹å™¨éœ€è¦æ”¾åœ¨ä¸€ä¸ªæ•°æ®å¹³é¢ éœ€è¦å·¥å…·æ¥è‡ªåŠ¨è§£å†³å®¹å™¨ç½‘ç»œåœ°å€è½¬æ¢  è¿™é‡Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªåŸç”Ÿç½‘ç»œè·¯ç”±çš„ä¾‹å­æ¥å¸®åŠ©å¤§å®¶ç†è§£å®¹å™¨ç½‘ç»œäº’è”äº’é€šçš„åŸºæœ¬åŸç†ï¼š
å›¾ï¼šDocker 19.03.12 ç‰ˆæœ¬ç›´æ¥è·¯ç”±æ¨¡å¼å›¾ä¾‹
åˆ†åˆ«å¯¹ä¸»æœº 1 å’Œä¸»æœº 2 ä¸Šçš„ docker0 è¿›è¡Œé…ç½®ï¼Œé‡å¯ docker æœåŠ¡ç”Ÿæ•ˆ ç¼–è¾‘ä¸»æœº 1 ä¸Šçš„ /etc/docker/daemon.json æ–‡ä»¶ï¼Œæ·»åŠ å†…å®¹ï¼š&amp;quot;bip&amp;quot; : &amp;quot;ip/netmask&amp;quot;ã€‚
{&amp;quot;bip&amp;quot;: &amp;quot;172.17.1.252/24&amp;quot;}ç¼–è¾‘ä¸»æœº 2 ä¸Šçš„ /etc/docker/daemon.json æ–‡ä»¶ï¼Œæ·»åŠ å†…å®¹ï¼š&amp;quot;bip&amp;quot; : &amp;quot;ip/netmask&amp;quot;ã€‚
{&amp;quot;bip&amp;quot;: &amp;quot;172.17.2.252/24&amp;quot;}ä¸»æœº 1 å’Œä¸»æœº 2 ä¸Šå‡æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œé‡å¯ Docker æœåŠ¡ä»¥ä½¿ä¿®æ”¹åçš„ docker0 ç½‘æ®µç”Ÿæ•ˆã€‚
systemctl restart dockeræ·»åŠ è·¯ç”±è§„åˆ™ ä¸»æœº 1 ä¸Šæ·»åŠ è·¯ç”±è§„åˆ™å¦‚ä¸‹ï¼š">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/kubernetes%e5%ae%9e%e8%b7%b5%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97/">Kuberneteså®è·µå…¥é—¨æŒ‡å—</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/00-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E4%BB%AC%E8%A6%81%E5%AD%A6%E4%B9%A0-kubernetes-%E6%8A%80%E6%9C%AF/">00 ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å­¦ä¹  Kubernetes æŠ€æœ¯</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/01-%E9%87%8D%E6%96%B0%E8%AE%A4%E8%AF%86-kubernetes-%E7%9A%84%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6/">01 é‡æ–°è®¤è¯† Kubernetes çš„æ ¸å¿ƒç»„ä»¶</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/02-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-kubernets-%E7%9A%84%E7%BC%96%E6%8E%92%E5%AF%B9%E8%B1%A1/">02 æ·±å…¥ç†è§£ Kubernets çš„ç¼–æ’å¯¹è±¡</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/03-devops-%E5%9C%BA%E6%99%AF%E4%B8%8B%E8%90%BD%E5%9C%B0-k8s-%E7%9A%84%E5%9B%B0%E9%9A%BE%E5%88%86%E6%9E%90/">03 DevOps åœºæ™¯ä¸‹è½åœ° K8s çš„å›°éš¾åˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/04-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E4%B8%8B%E8%90%BD%E5%9C%B0-k8s-%E7%9A%84%E5%9B%B0%E9%9A%BE%E5%88%86%E6%9E%90/">04 å¾®æœåŠ¡åº”ç”¨åœºæ™¯ä¸‹è½åœ° K8s çš„å›°éš¾åˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/05-%E8%A7%A3%E5%86%B3-k8s-%E8%90%BD%E5%9C%B0%E9%9A%BE%E9%A2%98%E7%9A%84%E6%96%B9%E6%B3%95%E8%AE%BA%E6%8F%90%E7%82%BC/">05 è§£å†³ K8s è½åœ°éš¾é¢˜çš„æ–¹æ³•è®ºæç‚¼</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/06-%E7%BB%83%E4%B9%A0%E7%AF%87k8s-%E6%A0%B8%E5%BF%83%E5%AE%9E%E8%B7%B5%E7%9F%A5%E8%AF%86%E6%8E%8C%E6%8F%A1/">06 ç»ƒä¹ ç¯‡ï¼šK8s æ ¸å¿ƒå®è·µçŸ¥è¯†æŒæ¡</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/07-%E5%AE%B9%E5%99%A8%E5%BC%95%E6%93%8E-containerd-%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">07 å®¹å™¨å¼•æ“ containerd è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/08-k8s-%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E5%B7%A5%E5%85%B7-kubeadm-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">08 K8s é›†ç¾¤å®‰è£…å·¥å…· kubeadm çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/09-%E5%8D%97%E5%8C%97%E5%90%91%E6%B5%81%E9%87%8F%E7%BB%84%E4%BB%B6-ipvs-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">09 å—åŒ—å‘æµé‡ç»„ä»¶ IPVS çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li>10 ä¸œè¥¿å‘æµé‡ç»„ä»¶ Calico çš„è½åœ°å®è·µ</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/11-%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0-dns-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">11 æœåŠ¡å‘ç° DNS çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/12-%E7%BB%83%E4%B9%A0%E7%AF%87k8s-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E6%B5%8B%E9%AA%8C/">12 ç»ƒä¹ ç¯‡ï¼šK8s é›†ç¾¤é…ç½®æµ‹éªŒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/13-%E7%90%86%E8%A7%A3%E5%AF%B9%E6%96%B9%E6%9A%B4%E9%9C%B2%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%AF%B9%E8%B1%A1-ingress-%E5%92%8C-service/">13 ç†è§£å¯¹æ–¹æš´éœ²æœåŠ¡çš„å¯¹è±¡ Ingress å’Œ Service</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/14-%E5%BA%94%E7%94%A8%E7%BD%91%E5%85%B3-openresty-%E5%AF%B9%E6%8E%A5-k8s-%E5%AE%9E%E8%B7%B5/">14 åº”ç”¨ç½‘å…³ OpenResty å¯¹æ¥ K8s å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/15-service-%E5%B1%82%E5%BC%95%E6%B5%81%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/">15 Service å±‚å¼•æµæŠ€æœ¯å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/16-cilium-%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">16 Cilium å®¹å™¨ç½‘ç»œçš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/17-%E5%BA%94%E7%94%A8%E6%B5%81%E9%87%8F%E7%9A%84%E4%BC%98%E9%9B%85%E6%97%A0%E6%8D%9F%E5%88%87%E6%8D%A2%E5%AE%9E%E8%B7%B5/">17 åº”ç”¨æµé‡çš„ä¼˜é›…æ— æŸåˆ‡æ¢å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/18-%E7%BB%83%E4%B9%A0%E7%AF%87%E5%BA%94%E7%94%A8%E6%B5%81%E9%87%8F%E6%97%A0%E6%8D%9F%E5%88%87%E6%8D%A2%E6%8A%80%E6%9C%AF%E6%B5%8B%E9%AA%8C/">18 ç»ƒä¹ ç¯‡ï¼šåº”ç”¨æµé‡æ— æŸåˆ‡æ¢æŠ€æœ¯æµ‹éªŒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/19-%E4%BD%BF%E7%94%A8-rook-%E6%9E%84%E5%BB%BA%E7%94%9F%E4%BA%A7%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E7%8E%AF%E5%A2%83%E5%AE%9E%E8%B7%B5/">19 ä½¿ç”¨ Rook æ„å»ºç”Ÿäº§å¯ç”¨å­˜å‚¨ç¯å¢ƒå®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/20-%E6%9C%89%E7%8A%B6%E6%80%81%E5%BA%94%E7%94%A8%E7%9A%84%E9%BB%98%E8%AE%A4%E7%89%B9%E6%80%A7%E8%90%BD%E5%9C%B0%E5%88%86%E6%9E%90/">20 æœ‰çŠ¶æ€åº”ç”¨çš„é»˜è®¤ç‰¹æ€§è½åœ°åˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/21-%E6%A1%88%E4%BE%8B%E5%88%86%E5%B8%83%E5%BC%8F-mysql-%E9%9B%86%E7%BE%A4%E5%B7%A5%E5%85%B7-vitess-%E5%AE%9E%E8%B7%B5%E5%88%86%E6%9E%90/">21 æ¡ˆä¾‹ï¼šåˆ†å¸ƒå¼ MySQL é›†ç¾¤å·¥å…· Vitess å®è·µåˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/22-%E5%AD%98%E5%82%A8%E5%AF%B9%E8%B1%A1-pvpvcstorage-classes-%E7%9A%84%E7%AE%A1%E7%90%86%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">22 å­˜å‚¨å¯¹è±¡ PVã€PVCã€Storage Classes çš„ç®¡ç†è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/23-k8s-%E9%9B%86%E7%BE%A4%E4%B8%AD%E5%AD%98%E5%82%A8%E5%AF%B9%E8%B1%A1%E7%81%BE%E5%A4%87%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">23 K8s é›†ç¾¤ä¸­å­˜å‚¨å¯¹è±¡ç¾å¤‡çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/24-%E7%BB%83%E4%B9%A0%E7%AF%87k8s-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E6%B5%8B%E9%AA%8C/">24 ç»ƒä¹ ç¯‡ï¼šK8s é›†ç¾¤é…ç½®æµ‹éªŒ</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">10 ä¸œè¥¿å‘æµé‡ç»„ä»¶ Calico çš„è½åœ°å®è·µ</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2021-12-22 01:48:16</span>ğŸ·ï¸&nbsp;<a class="post-tag" href="/tags/kubernetes/">kubernetes</a></div><div class="post-category">
                
                ğŸ“š&nbsp;<a href="/categories/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/">Kuberneteså®è·µå…¥é—¨æŒ‡å—</a>
                
            </div></div>
        <div class="post-content">
            <p>Kubernetes ç½‘ç»œå¹¶æ²¡æœ‰åŸç”Ÿçš„æ–¹æ¡ˆï¼Œå®ƒä»ä¸€å¼€å§‹å°±ç»™æˆ‘ä»¬é€æ¥äº†ä¸€ä¸ªé€‰æ‹©é¢˜ã€‚åˆ°åº•é€‰å“ªç§ç½‘ç»œæ–¹æ¡ˆæ‰æ˜¯æœ€ä½³çš„æ–¹æ¡ˆå‘¢ï¼Ÿç½‘ç»œé—®é¢˜ä¸€ç›´è®©ç¤¾åŒºç”¨æˆ·å¾ˆå›°æƒ‘ï¼Œä»¥è‡³äºåœ¨æ—©æœŸï¼Œä¸åŒåœºæ™¯ä¸‹çš„æ–¹æ¡ˆå¦‚é›¨åæ˜¥ç¬‹èˆ¬æ¶Œç°å‡ºæ¥ã€‚å…¶ä¸­æ¯”è¾ƒä¼˜ç§€çš„å°±æ˜¯ä»Šå¤©é€‰æ‹©ç»™å¤§å®¶ä»‹ç»çš„ç½‘ç»œç»„ä»¶ Calicoã€‚è¿™é‡Œæˆ‘ä»¬è¦å¼ºè°ƒçš„æ˜¯ï¼ŒCalico æ–¹æ¡ˆå¹¶ä¸æ˜¯å”¯ä¸€æ–¹æ¡ˆï¼Œæˆ‘ä»¬åœ¨ç¤¾åŒºä»ç„¶èƒ½çœ‹åˆ°å¾ˆå¤šä¼˜ç§€çš„æ–¹æ¡ˆæ¯”å¦‚ Ciliumã€OvSã€Contivã€Flannel ç­‰ï¼Œè‡³äºé€‰æ‹©å®ƒæ¥è®²è§£ä¸œè¥¿å‘æµé‡çš„ç»„ä»¶è½åœ°ï¼Œå®åœ¨æ˜¯å½“å‰å›½å†…ä¸šç•Œå¤§éƒ¨åˆ†çš„æ–¹æ¡ˆéƒ½æ˜¯ä»¥ Cailico å®è·µä¸ºä¸»ï¼Œä»‹ç»å®ƒå¯ä»¥èµ·åˆ°ä¸€ä¸ªæ¡ˆä¾‹ç¤ºèŒƒçš„ä½œç”¨ã€‚</p>
<h3 id="å®¹å™¨ç½‘ç»œè·¯ç”±çš„åŸç†">å®¹å™¨ç½‘ç»œè·¯ç”±çš„åŸç†</h3>
<p>ä¼—æ‰€å‘¨çŸ¥å®¹å™¨åŸç”Ÿç½‘ç»œæ¨¡å‹åŸºäºå•æœºçš„ veth è™šæ‹Ÿç½‘æ¡¥å®ç°ï¼Œæ— æ³•è·¨ä¸»æœºäº’è”äº’é€šã€‚å¦‚æœæƒ³è®©å®¹å™¨è·¨ä¸»æœºäº’è”äº’é€šï¼Œéœ€è¦æ”¯æŒä»¥ä¸‹ 3 ç‚¹ï¼š</p>
<ol>
<li>ç½‘ç»œæ§åˆ¶é¢éœ€è¦ä¿è¯å®¹å™¨ IP çš„å”¯ä¸€æ€§</li>
<li>ä¸¤ä¸ªå®¹å™¨éœ€è¦æ”¾åœ¨ä¸€ä¸ªæ•°æ®å¹³é¢</li>
<li>éœ€è¦å·¥å…·æ¥è‡ªåŠ¨è§£å†³å®¹å™¨ç½‘ç»œåœ°å€è½¬æ¢</li>
</ol>
<p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªåŸç”Ÿç½‘ç»œè·¯ç”±çš„ä¾‹å­æ¥å¸®åŠ©å¤§å®¶ç†è§£å®¹å™¨ç½‘ç»œäº’è”äº’é€šçš„åŸºæœ¬åŸç†ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Kubernetes%20%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/assets/7dc3f9e0-dc3e-11ea-a66a-d5ea9de370fe.jpg" alt="9-1-hosts-container-network"></p>
<p>å›¾ï¼šDocker 19.03.12 ç‰ˆæœ¬ç›´æ¥è·¯ç”±æ¨¡å¼å›¾ä¾‹</p>
<h4 id="åˆ†åˆ«å¯¹ä¸»æœº-1-å’Œä¸»æœº-2-ä¸Šçš„-docker0-è¿›è¡Œé…ç½®é‡å¯-docker-æœåŠ¡ç”Ÿæ•ˆ"><strong>åˆ†åˆ«å¯¹ä¸»æœº 1 å’Œä¸»æœº 2 ä¸Šçš„ docker0 è¿›è¡Œé…ç½®ï¼Œé‡å¯ docker æœåŠ¡ç”Ÿæ•ˆ</strong></h4>
<p>ç¼–è¾‘ä¸»æœº 1 ä¸Šçš„ <code>/etc/docker/daemon.json</code> æ–‡ä»¶ï¼Œæ·»åŠ å†…å®¹ï¼š<code>&quot;bip&quot; : &quot;ip/netmask&quot;</code>ã€‚</p>
<pre tabindex="0"><code>{
  &quot;bip&quot;: &quot;172.17.1.252/24&quot;
}

</code></pre><p>ç¼–è¾‘ä¸»æœº 2 ä¸Šçš„ <code>/etc/docker/daemon.json</code> æ–‡ä»¶ï¼Œæ·»åŠ å†…å®¹ï¼š<code>&quot;bip&quot; : &quot;ip/netmask&quot;</code>ã€‚</p>
<pre tabindex="0"><code>{
  &quot;bip&quot;: &quot;172.17.2.252/24&quot;
}

</code></pre><p>ä¸»æœº 1 å’Œä¸»æœº 2 ä¸Šå‡æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œé‡å¯ Docker æœåŠ¡ä»¥ä½¿ä¿®æ”¹åçš„ docker0 ç½‘æ®µç”Ÿæ•ˆã€‚</p>
<pre tabindex="0"><code>systemctl restart docker

</code></pre><h4 id="æ·»åŠ è·¯ç”±è§„åˆ™"><strong>æ·»åŠ è·¯ç”±è§„åˆ™</strong></h4>
<p>ä¸»æœº 1 ä¸Šæ·»åŠ è·¯ç”±è§„åˆ™å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>route add -net 172.17.2.0/24 gw 172.26.15.215

</code></pre><p>ä¸»æœº 2 ä¸Šæ·»åŠ è·¯ç”±è§„åˆ™å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>route add -net 172.17.1.0/24 gw 172.26.14.120

</code></pre><p>ç†è®ºä¸Šé…ç½®å®Œè·¯ç”±ååº”è¯¥ä»ä¸»æœº 1 å¯ä»¥è¿æ¥åˆ°ä¸»æœº 2 çš„ docker0ï¼Œå®é™…åœºæ™¯ä¸‹å› ä¸ºäº¤æ¢æœºä¼šæ£€æŸ¥ docker0 çš„ mac åœ°å€ï¼Œå¹¶æŠŠè¿™ä¸ªéæ³•çš„åœ°å€ä¸‹çš„æ•°æ®åŒ…ç›´æ¥ DROP æ‰ï¼Œè®©è·¨ä¸»æœºçš„å®¹å™¨æ— æ³•æƒ³é€šï¼Œä½†è¿™ä¸ªå¹¶ä¸å¦¨ç¢æˆ‘ä»¬ç†è§£åŸç†ã€‚Calico ç½‘ç»œè·¯ç”±åŸç†å’Œä»¥ä¸Šç¤ºèŒƒé™æ€è·¯ç”±åŸç†æ˜¯ä¸€è‡´çš„ï¼Œé‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•å®ç°è¿é€šçš„å‘¢ï¼Ÿ</p>
<p>å®‰è£… Calico åï¼Œä¸»æœºä¸Šæ£€æŸ¥å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>### ä¸»æœº 1 ä¸Šçš„
vxlan.calico: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1410 qdisc noqueue state UNKNOWN group default
link/ether 66:18:b6:89:bd:6f brd ff:ff:ff:ff:ff:ff 
inet 192.168.206.0/32 brd 192.168.206.0 scope global vxlan.calico 

### ä¸»æœº 2 ä¸Šçš„
vxlan.calico: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1410 qdisc noqueue state UNKNOWN group default
link/ether 66:85:17:26:23:b1 brd ff:ff:ff:ff:ff:ff
inet 192.168.49.0/32 brd 192.168.49.0 scope global vxlan.calico

</code></pre><p>å¯¹æ¯”å¯ä»¥çŸ¥é“ï¼Œå’Œä¸Šé¢èŒƒä¾‹ä¸­åˆ†é… IP æ®µä¸€æ ·ï¼ŒCalico ä¹Ÿæ˜¯ä¸ºæ¯å°ä¸»æœºåˆ†é…å›ºå®šçš„ IP æ®µä¿è¯å®¹å™¨ç½‘ç»œ IP ä¸å†²çªã€‚æˆ‘ä»¬å†æ¥çœ‹ä¸‹è·¯ç”±è§„åˆ™ï¼š</p>
<pre tabindex="0"><code>root@ip-172-26-8-126:~# route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         172.26.0.1      0.0.0.0         UG    100    0        0 eth0
172.26.0.0      0.0.0.0         255.255.240.0   U     0      0        0 eth0
172.26.0.1      0.0.0.0         255.255.255.255 UH    100    0        0 eth0
192.168.49.1    0.0.0.0         255.255.255.255 UH    0      0        0 cali3f1b566e6d6
192.168.49.2    0.0.0.0         255.255.255.255 UH    0      0        0 cali408c6db5188
192.168.206.0   172.26.5.8      255.255.255.192 UG    0      0        0 eth0

root@ip-172-26-5-8:~# route -n 
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         172.26.0.1      0.0.0.0         UG    100    0        0 eth0             
172.26.0.0      0.0.0.0         255.255.240.0   U     0      0        0 eth0             
172.26.0.1      0.0.0.0         255.255.255.255 UH    100    0        0 eth0             
192.168.49.0    172.26.8.126    255.255.255.192 UG    0      0        0 eth0             
192.168.206.1   0.0.0.0         255.255.255.255 UH    0      0        0 cali517a7f7f853
192.168.206.3   0.0.0.0         255.255.255.255 UH    0      0        0 cali8d8ae1f64d9
192.168.206.4   0.0.0.0         255.255.255.255 UH    0      0        0 cali99a5d6c4e2d
192.168.206.5   0.0.0.0         255.255.255.255 UH    0      0        0 cali3b6d130f2eb
192.168.206.6   0.0.0.0         255.255.255.255 UH    0      0        0 calid8aeffc724c

</code></pre><p>ä¸¤å°ä¸»æœºè·¯ç”±è¡¨ä¸Šéƒ½åšäº†å¯¹æ–¹ IP çš„è·¯ç”±ä¿¡æ¯ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡éƒ¨ç½²å®¹å™¨æ¥æµ‹è¯•ç½‘ç»œè¿é€šæ€§ï¼š</p>
<pre tabindex="0"><code>root@ip-172-26-5-8:~# cat pingtest-deployment.yaml 
apiVersion: apps/v1
kind: Deployment
metadata:
  name: pingtest-deployment
  labels:
    app: pingtest
spec:
  replicas: 3
  selector:
    matchLabels:
      app: pingtest
  template:
    metadata:
      labels:
        app: pingtest
    spec:
      containers:
      - name: pingtest
        image: busybox
        args: [&quot;sleep&quot;, &quot;infinity&quot;]

root@ip-172-26-5-8:~# kubectl apply -f pingtest-deployment.yaml 

root@ip-172-26-5-8:~# kubectl get pod -l app=pingtest -o wide
NAME                                   READY   STATUS        RESTARTS   AGE     IP              NODE              NOMINATED NODE   READINESS GATES
pingtest-deployment-6dcb8d6c77-8ntqf   1/1     Running       0          10m     192.168.49.4    ip-172-26-8-126   &lt;none&gt;           &lt;none&gt;
pingtest-deployment-6dcb8d6c77-l5hq2   1/1     Running       0          10m     192.168.49.5    ip-172-26-8-126   &lt;none&gt;           &lt;none&gt;
pingtest-deployment-6dcb8d6c77-6fcdn   1/1     Running       0          6m48s   192.168.206.7   ip-172-26-5-8     &lt;none&gt;           &lt;none&gt;

</code></pre><p>å› ä¸ºæœ€æ–°çš„ Calico é»˜è®¤é…ç½®çš„æ¨¡å¼æ˜¯ vxlanMode æ¨¡å¼ï¼Œä½ æ²¡æœ‰ä¿®æ”¹è·¯ç”±å™¨çš„æƒé™ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹ ipipMode ä¸º Alwaysã€‚</p>
<pre tabindex="0"><code>root@ip-172-26-12-198:~# cat pool.json 
{
  &quot;kind&quot;: &quot;IPPoolList&quot;,
  &quot;apiVersion&quot;: &quot;projectcalico.org/v3&quot;,
  &quot;metadata&quot;: {
    &quot;resourceVersion&quot;: &quot;2306&quot;
  },
  &quot;items&quot;: [
    {
      &quot;kind&quot;: &quot;IPPool&quot;,
      &quot;apiVersion&quot;: &quot;projectcalico.org/v3&quot;,
      &quot;metadata&quot;: {
        &quot;name&quot;: &quot;default-ipv4-ippool&quot;,
        &quot;uid&quot;: &quot;0ba1e107-0582-4b7b-b99f-f7105525e987&quot;,
        &quot;resourceVersion&quot;: &quot;763&quot;,
        &quot;creationTimestamp&quot;: &quot;2020-08-10T16:59:28Z&quot;
      },
      &quot;spec&quot;: {
        &quot;cidr&quot;: &quot;192.168.0.0/16&quot;,
        &quot;vxlanMode&quot;: &quot;Never&quot;,
        &quot;ipipMode&quot;: &quot;Always&quot;,
        &quot;natOutgoing&quot;: true,
        &quot;blockSize&quot;: 26,
        &quot;nodeSelector&quot;: &quot;all()&quot;
      }
    }
  ]
}

</code></pre><p>ä¿®æ”¹ååœ¨å‘½ä»¤è¡Œä¸‹æŸ¥çœ‹è·¯ç”±è§„åˆ™çš„åŠæ³•ï¼Œç¡®è®¤è™šæ‹Ÿç½‘ç»œèµ°äº† tunnel ç½‘å¡å£ï¼š</p>
<pre tabindex="0"><code>root@ip-172-26-12-198:~# ip route
default via 172.26.0.1 dev eth0 proto dhcp src 172.26.12.198 metric 100 
172.26.0.0/20 dev eth0 proto kernel scope link src 172.26.12.198 
172.26.0.1 dev eth0 proto dhcp scope link src 172.26.12.198 metric 100 
192.168.31.0 via 172.26.5.10 dev tunl0 proto bird onlink 
192.168.31.0/26 via 172.26.5.10 dev eth0 proto 80 onlink 
192.168.31.1 via 172.26.5.10 dev tunl0 proto bird onlink 
192.168.31.3 via 172.26.5.10 dev tunl0 proto bird onlink 
192.168.31.4 via 172.26.5.10 dev tunl0 proto bird onlink 
192.168.31.5 via 172.26.5.10 dev tunl0 proto bird onlink 
192.168.31.7 via 172.26.5.10 dev tunl0 proto bird onlink 
192.168.31.64/26 via 172.26.5.10 dev tunl0 proto bird onlink 
192.168.41.137 dev calie486eacd845 scope link 
192.168.41.138 dev calif383cce9723 scope link 
192.168.41.139 dev calia4f3d6b96e0 scope link 
192.168.41.140 dev cali391d55f6fc3 scope link 
192.168.41.141 dev cali981dc37e1ca scope link 
192.168.41.142 dev calic0a72d40721 scope link 
192.168.41.143 dev calicfb8f80c8c5 scope link 
blackhole 192.168.41.192/26 proto bird 
192.168.41.193 dev calia6f4721616e scope link 

</code></pre><p>é€šè¿‡ kubectl exec å¯ä»¥è¿›å…¥ Pod å®¹å™¨è¿›è¡Œè¿é€šæ€§æµ‹è¯•ï¼š</p>
<pre tabindex="0"><code>root@ip-172-26-12-198:~# kubectl get po -o wide
NAME                                   READY   STATUS    RESTARTS   AGE   IP               NODE               NOMINATED NODE   READINESS GATES
pingtest-deployment-6dcb8d6c77-95vrw   1/1     Running   0          23m   192.168.41.139   ip-172-26-12-198   &lt;none&gt;           &lt;none&gt;
pingtest-deployment-6dcb8d6c77-p4cqx   1/1     Running   0          23m   192.168.41.140   ip-172-26-12-198   &lt;none&gt;           &lt;none&gt;
pingtest-deployment-6dcb8d6c77-kfmhp   1/1     Running   0          23m   192.168.41.137   ip-172-26-12-198   &lt;none&gt;           &lt;none&gt;
pingtest-deployment-6dcb8d6c77-w582x   1/1     Running   0          23m   192.168.41.141   ip-172-26-12-198   &lt;none&gt;           &lt;none&gt;
pingtest-deployment-6dcb8d6c77-ts9fh   1/1     Running   0          23m   192.168.41.138   ip-172-26-12-198   &lt;none&gt;           &lt;none&gt;
pingtest-deployment-6dcb8d6c77-ppt2n   1/1     Running   0          22m   192.168.41.142   ip-172-26-12-198   &lt;none&gt;           &lt;none&gt;
pingtest-deployment-6dcb8d6c77-qw46c   1/1     Running   0          22m   192.168.41.143   ip-172-26-12-198   &lt;none&gt;           &lt;none&gt;
pingtest-deployment-6dcb8d6c77-972zw   1/1     Running   0          22m   192.168.31.7     ip-172-26-5-10     &lt;none&gt;           &lt;none&gt;
root@ip-172-26-12-198:~# kubectl exec -it pingtest-deployment-6dcb8d6c77-972zw -- sh
/ # ping 192.168.41.138
PING 192.168.41.138 (192.168.41.138): 56 data bytes
64 bytes from 192.168.41.138: seq=0 ttl=62 time=0.449 ms
64 bytes from 192.168.41.138: seq=1 ttl=62 time=0.501 ms

</code></pre><h3 id="calico-ç½‘ç»œçš„æ€§èƒ½">Calico ç½‘ç»œçš„æ€§èƒ½</h3>
<pre tabindex="0"><code>sh-4.4# iperf3 -s
-----------------------------------------------------------
Server listening on 5201
-----------------------------------------------------------

Accepted connection from 172.26.5.10, port 53246
[  5] local 192.168.31.68 port 5201 connected to 172.26.5.10 port 53248
[ ID] Interval           Transfer     Bitrate
[  5]   0.00-1.00   sec  2.42 GBytes  20.8 Gbits/sec
[  5]   1.00-2.00   sec  3.07 GBytes  26.4 Gbits/sec
[  5]   2.00-3.00   sec  2.83 GBytes  24.3 Gbits/sec
[  5]   3.00-4.00   sec  3.05 GBytes  26.2 Gbits/sec
[  5]   4.00-5.00   sec  3.12 GBytes  26.8 Gbits/sec
[  5]   5.00-6.00   sec  2.87 GBytes  24.7 Gbits/sec
[  5]   6.00-7.00   sec  3.02 GBytes  26.0 Gbits/sec
[  5]   7.00-8.00   sec  3.04 GBytes  26.1 Gbits/sec
[  5]   8.00-9.00   sec  3.08 GBytes  26.5 Gbits/sec
[  5]   9.00-10.00  sec  2.93 GBytes  25.2 Gbits/sec
[  5]  10.00-10.04  sec   104 MBytes  24.6 Gbits/sec
- - - - - - - - - - - - - - - - - - - - - - - - -
[ ID] Interval           Transfer     Bitrate
[  5]   0.00-10.04  sec  29.5 GBytes  25.3 Gbits/sec                  receiver

</code></pre><p>åœ¨è§„æ¨¡é…ç½®åœ¨ 10 å°ä»¥ä¸‹çš„æƒ…å†µä¸‹ï¼Œå®¹å™¨ä¼ è¾“æ•ˆç‡ä¾èµ–ä¸»æœºç½‘å¡æ€§èƒ½ï¼Œç»“æœè¯´æ˜æ€§èƒ½ä¸å·®ã€‚</p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>Calico ä½œä¸ºä¸šå†…å¸¸ç”¨çš„æ–¹æ¡ˆï¼Œå®ƒçš„å¥½å¤„å°±æ˜¯çµæ´»é…ç½®ã€‚å› ä¸ºå®ƒæœ‰ BGP åè®®æ”¯æŒï¼Œå¯ä»¥è·¨æ•°æ®ä¸­å¿ƒçš„äº’è”äº’é€šã€‚ä»å®è·µè§’åº¦æ¥çœ‹ï¼Œå®ƒå…·å¤‡å¤æ‚åœºæ™¯ä¸‹çµæ´»é…ç½®çš„ç‰¹ç‚¹ï¼Œæ‰€ä»¥ä¹Ÿåœ¨ä¸šç•Œä¸»æµæ¯”è¾ƒæ¨èã€‚å½“ç„¶è¿™é‡Œæˆ‘ä»¬çš„ç›®çš„å¹¶ä¸æ˜¯æ¨è Calicoï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦ä¾æ®ä½ å½“å‰é›†ç¾¤çš„å…·ä½“éœ€è¦æ¥è§„åˆ’ï¼Œè®©å®¹å™¨ç½‘ç»œèƒ½æ›´æ–¹ä¾¿çš„ä½¿ç”¨ã€‚</p>
<p>å‚è€ƒæ–‡ç« ï¼š</p>
<ul>
<li><a href="https://docs.docker.com/network/bridge/">https://docs.docker.com/network/bridge/</a></li>
<li><a href="https://www.tecmint.com/test-network-throughput-in-linux/">https://www.tecmint.com/test-network-throughput-in-linux/</a></li>
</ul>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/09-%E5%8D%97%E5%8C%97%E5%90%91%E6%B5%81%E9%87%8F%E7%BB%84%E4%BB%B6-ipvs-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/"><span>09 å—åŒ—å‘æµé‡ç»„ä»¶ IPVS çš„è½åœ°å®è·µ</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/11-%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0-dns-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/"><span>11 æœåŠ¡å‘ç° DNS çš„è½åœ°å®è·µ</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 27270 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>