<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>13 ç†è§£å¯¹æ–¹æš´éœ²æœåŠ¡çš„å¯¹è±¡ Ingress å’Œ Service | Yipsen Ye</title>
<meta name="description" content="Kubernetes ä¸­çš„æœåŠ¡ï¼ˆServiceï¼‰å¯ä»¥ç†è§£ä¸ºå¯¹å¤–æš´éœ²æœåŠ¡çš„æœ€å°å•å…ƒå¯¹è±¡ï¼Œè¿™ä¸ªå’Œ Pod å¯¹è±¡è¿˜æ˜¯æœ‰ä¸åŒçš„ã€‚ä¾‹å¦‚ç”¨æˆ·é€šè¿‡å‘å¸ƒæœåŠ¡å¯¹è±¡ Deployment å‘å¸ƒåº”ç”¨ï¼Œå½“åœ¨å®¹å™¨é›†ç¾¤ä¸­å¯åŠ¨åï¼ŒReplicaSet å‰¯æœ¬å¯¹è±¡ä¼šå¸®æˆ‘ä»¬ç»´æŒ Pod å®ä¾‹çš„å‰¯æœ¬æ•°ã€‚Pod ä½¿ç”¨çš„å®¹å™¨ç½‘ç»œé»˜è®¤ä¼šé€‰æ‹©æ„å»ºåœ¨ä¸»æœºç½‘ç»œä¸Šçš„è¦†ç›–ç½‘ç»œï¼ˆOverlayï¼‰ï¼Œé»˜è®¤å¤–ç½‘æ˜¯æ— æ³•ç›´æ¥è®¿é—®è¿™äº› Pod å®ä¾‹æœåŠ¡çš„ã€‚ä¸ºäº†èƒ½æœ‰æ•ˆå¯¹æ¥å®¹å™¨ç½‘ç»œï¼ŒKubernetes åˆ›å»ºäº†å¦å¤–ä¸€å±‚è™šæ‹Ÿç½‘ç»œ ClusterIPï¼Œå³ Service å¯¹è±¡ã€‚ä»å®ç°ä¸Šæ¥çœ‹ï¼Œå®ƒå€ŸåŠ© iptables è°ƒç”¨åº•å±‚ netfilter å®ç°äº†è™šæ‹Ÿ IPï¼Œç„¶åé€šè¿‡ç›¸åº”çš„è§„åˆ™é“¾æŠŠå—åŒ—å‘æµé‡å‡†ç¡®æ— è¯¯çš„æ¥å…¥åç«¯ Pod å®ä¾‹ã€‚éšç€éœ€æ±‚çš„è¡ç”Ÿï¼Œåæ¥æ‰©å±•çš„ Ingress å¯¹è±¡åˆ™æ˜¯å€ŸåŠ©ç¬¬ä¸‰æ–¹ä»£ç†æœåŠ¡å¦‚ HAProxyã€Nginx ç­‰ 7 å±‚å¼•æµå·¥å…·æ‰“é€šå¤–éƒ¨æµé‡å’Œå†…éƒ¨ Service å¯¹è±¡çš„é€šè·¯ã€‚Ingress å¯¹è±¡çš„ç›®çš„å°±æ˜¯ä¸ºäº†è§£å†³å®¹å™¨é›†ç¾¤ä¸­éœ€è¦é«˜æ€§èƒ½åº”ç”¨ç½‘å…³æ¥å…¥çš„éœ€æ±‚ã€‚
Service çš„æ€è€ƒ Service å®šä¹‰çš„ç½‘ç»œåŸºäº iptables ç¼–æ’ netfilter è§„åˆ™æ¥æ”¯æŒè™šæ‹Ÿ IPã€‚Service å¯¹è±¡è¢«è®¾è®¡ä¸ºåå‘ä»£ç†æ¨¡å¼ï¼Œæ”¯æŒå—åŒ—å‘æµé‡çš„è´Ÿè½½å‡è¡¡ï¼Œé€šè¿‡ DNAT æŠŠæµé‡è½¬åˆ°åç«¯çš„å…·ä½“ä¸šåŠ¡çš„ Pod ä¸­ã€‚ä¸ºäº†åŠ«æŒæ¥å…¥æµé‡å’Œ NAT è½¬æ¢ï¼ŒKubernetes åˆ›å»ºäº†ä¸¤æ¡è‡ªå®šä¹‰é“¾è§„åˆ™ PREROUTING å’Œ OUTPUTã€‚å¦‚ï¼š
-A PREROUTING -m comment --comment &amp;quot;kubernetes service portals&amp;quot; -j KUBE-SERVICES...-A OUTPUT -m comment --comment &amp;quot;kubernetes service portals&amp;quot; -j KUBE-SERVICES.">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/kubernetes%e5%ae%9e%e8%b7%b5%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97/">Kuberneteså®è·µå…¥é—¨æŒ‡å—</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/00-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E4%BB%AC%E8%A6%81%E5%AD%A6%E4%B9%A0-kubernetes-%E6%8A%80%E6%9C%AF/">00 ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å­¦ä¹  Kubernetes æŠ€æœ¯</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/01-%E9%87%8D%E6%96%B0%E8%AE%A4%E8%AF%86-kubernetes-%E7%9A%84%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6/">01 é‡æ–°è®¤è¯† Kubernetes çš„æ ¸å¿ƒç»„ä»¶</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/02-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-kubernets-%E7%9A%84%E7%BC%96%E6%8E%92%E5%AF%B9%E8%B1%A1/">02 æ·±å…¥ç†è§£ Kubernets çš„ç¼–æ’å¯¹è±¡</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/03-devops-%E5%9C%BA%E6%99%AF%E4%B8%8B%E8%90%BD%E5%9C%B0-k8s-%E7%9A%84%E5%9B%B0%E9%9A%BE%E5%88%86%E6%9E%90/">03 DevOps åœºæ™¯ä¸‹è½åœ° K8s çš„å›°éš¾åˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/04-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E4%B8%8B%E8%90%BD%E5%9C%B0-k8s-%E7%9A%84%E5%9B%B0%E9%9A%BE%E5%88%86%E6%9E%90/">04 å¾®æœåŠ¡åº”ç”¨åœºæ™¯ä¸‹è½åœ° K8s çš„å›°éš¾åˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/05-%E8%A7%A3%E5%86%B3-k8s-%E8%90%BD%E5%9C%B0%E9%9A%BE%E9%A2%98%E7%9A%84%E6%96%B9%E6%B3%95%E8%AE%BA%E6%8F%90%E7%82%BC/">05 è§£å†³ K8s è½åœ°éš¾é¢˜çš„æ–¹æ³•è®ºæç‚¼</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/06-%E7%BB%83%E4%B9%A0%E7%AF%87k8s-%E6%A0%B8%E5%BF%83%E5%AE%9E%E8%B7%B5%E7%9F%A5%E8%AF%86%E6%8E%8C%E6%8F%A1/">06 ç»ƒä¹ ç¯‡ï¼šK8s æ ¸å¿ƒå®è·µçŸ¥è¯†æŒæ¡</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/07-%E5%AE%B9%E5%99%A8%E5%BC%95%E6%93%8E-containerd-%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">07 å®¹å™¨å¼•æ“ containerd è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/08-k8s-%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E5%B7%A5%E5%85%B7-kubeadm-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">08 K8s é›†ç¾¤å®‰è£…å·¥å…· kubeadm çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/09-%E5%8D%97%E5%8C%97%E5%90%91%E6%B5%81%E9%87%8F%E7%BB%84%E4%BB%B6-ipvs-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">09 å—åŒ—å‘æµé‡ç»„ä»¶ IPVS çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/10-%E4%B8%9C%E8%A5%BF%E5%90%91%E6%B5%81%E9%87%8F%E7%BB%84%E4%BB%B6-calico-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">10 ä¸œè¥¿å‘æµé‡ç»„ä»¶ Calico çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/11-%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0-dns-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">11 æœåŠ¡å‘ç° DNS çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/12-%E7%BB%83%E4%B9%A0%E7%AF%87k8s-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E6%B5%8B%E9%AA%8C/">12 ç»ƒä¹ ç¯‡ï¼šK8s é›†ç¾¤é…ç½®æµ‹éªŒ</a></li>
                
                
                
                    <li>13 ç†è§£å¯¹æ–¹æš´éœ²æœåŠ¡çš„å¯¹è±¡ Ingress å’Œ Service</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/14-%E5%BA%94%E7%94%A8%E7%BD%91%E5%85%B3-openresty-%E5%AF%B9%E6%8E%A5-k8s-%E5%AE%9E%E8%B7%B5/">14 åº”ç”¨ç½‘å…³ OpenResty å¯¹æ¥ K8s å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/15-service-%E5%B1%82%E5%BC%95%E6%B5%81%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/">15 Service å±‚å¼•æµæŠ€æœ¯å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/16-cilium-%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">16 Cilium å®¹å™¨ç½‘ç»œçš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/17-%E5%BA%94%E7%94%A8%E6%B5%81%E9%87%8F%E7%9A%84%E4%BC%98%E9%9B%85%E6%97%A0%E6%8D%9F%E5%88%87%E6%8D%A2%E5%AE%9E%E8%B7%B5/">17 åº”ç”¨æµé‡çš„ä¼˜é›…æ— æŸåˆ‡æ¢å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/18-%E7%BB%83%E4%B9%A0%E7%AF%87%E5%BA%94%E7%94%A8%E6%B5%81%E9%87%8F%E6%97%A0%E6%8D%9F%E5%88%87%E6%8D%A2%E6%8A%80%E6%9C%AF%E6%B5%8B%E9%AA%8C/">18 ç»ƒä¹ ç¯‡ï¼šåº”ç”¨æµé‡æ— æŸåˆ‡æ¢æŠ€æœ¯æµ‹éªŒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/19-%E4%BD%BF%E7%94%A8-rook-%E6%9E%84%E5%BB%BA%E7%94%9F%E4%BA%A7%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E7%8E%AF%E5%A2%83%E5%AE%9E%E8%B7%B5/">19 ä½¿ç”¨ Rook æ„å»ºç”Ÿäº§å¯ç”¨å­˜å‚¨ç¯å¢ƒå®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/20-%E6%9C%89%E7%8A%B6%E6%80%81%E5%BA%94%E7%94%A8%E7%9A%84%E9%BB%98%E8%AE%A4%E7%89%B9%E6%80%A7%E8%90%BD%E5%9C%B0%E5%88%86%E6%9E%90/">20 æœ‰çŠ¶æ€åº”ç”¨çš„é»˜è®¤ç‰¹æ€§è½åœ°åˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/21-%E6%A1%88%E4%BE%8B%E5%88%86%E5%B8%83%E5%BC%8F-mysql-%E9%9B%86%E7%BE%A4%E5%B7%A5%E5%85%B7-vitess-%E5%AE%9E%E8%B7%B5%E5%88%86%E6%9E%90/">21 æ¡ˆä¾‹ï¼šåˆ†å¸ƒå¼ MySQL é›†ç¾¤å·¥å…· Vitess å®è·µåˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/22-%E5%AD%98%E5%82%A8%E5%AF%B9%E8%B1%A1-pvpvcstorage-classes-%E7%9A%84%E7%AE%A1%E7%90%86%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">22 å­˜å‚¨å¯¹è±¡ PVã€PVCã€Storage Classes çš„ç®¡ç†è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/23-k8s-%E9%9B%86%E7%BE%A4%E4%B8%AD%E5%AD%98%E5%82%A8%E5%AF%B9%E8%B1%A1%E7%81%BE%E5%A4%87%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">23 K8s é›†ç¾¤ä¸­å­˜å‚¨å¯¹è±¡ç¾å¤‡çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/24-%E7%BB%83%E4%B9%A0%E7%AF%87k8s-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E6%B5%8B%E9%AA%8C/">24 ç»ƒä¹ ç¯‡ï¼šK8s é›†ç¾¤é…ç½®æµ‹éªŒ</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">13 ç†è§£å¯¹æ–¹æš´éœ²æœåŠ¡çš„å¯¹è±¡ Ingress å’Œ Service</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2021-12-22 01:48:19</span>ğŸ·ï¸&nbsp;<a class="post-tag" href="/tags/kubernetes/">kubernetes</a></div><div class="post-category">
                
                ğŸ“š&nbsp;<a href="/categories/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/">Kuberneteså®è·µå…¥é—¨æŒ‡å—</a>
                
            </div></div>
        <div class="post-content">
            <p>Kubernetes ä¸­çš„æœåŠ¡ï¼ˆServiceï¼‰å¯ä»¥ç†è§£ä¸ºå¯¹å¤–æš´éœ²æœåŠ¡çš„æœ€å°å•å…ƒå¯¹è±¡ï¼Œè¿™ä¸ªå’Œ Pod å¯¹è±¡è¿˜æ˜¯æœ‰ä¸åŒçš„ã€‚ä¾‹å¦‚ç”¨æˆ·é€šè¿‡å‘å¸ƒæœåŠ¡å¯¹è±¡ Deployment å‘å¸ƒåº”ç”¨ï¼Œå½“åœ¨å®¹å™¨é›†ç¾¤ä¸­å¯åŠ¨åï¼ŒReplicaSet å‰¯æœ¬å¯¹è±¡ä¼šå¸®æˆ‘ä»¬ç»´æŒ Pod å®ä¾‹çš„å‰¯æœ¬æ•°ã€‚Pod ä½¿ç”¨çš„å®¹å™¨ç½‘ç»œé»˜è®¤ä¼šé€‰æ‹©æ„å»ºåœ¨ä¸»æœºç½‘ç»œä¸Šçš„è¦†ç›–ç½‘ç»œï¼ˆOverlayï¼‰ï¼Œé»˜è®¤å¤–ç½‘æ˜¯æ— æ³•ç›´æ¥è®¿é—®è¿™äº› Pod å®ä¾‹æœåŠ¡çš„ã€‚ä¸ºäº†èƒ½æœ‰æ•ˆå¯¹æ¥å®¹å™¨ç½‘ç»œï¼ŒKubernetes åˆ›å»ºäº†å¦å¤–ä¸€å±‚è™šæ‹Ÿç½‘ç»œ ClusterIPï¼Œå³ Service å¯¹è±¡ã€‚ä»å®ç°ä¸Šæ¥çœ‹ï¼Œå®ƒå€ŸåŠ© iptables è°ƒç”¨åº•å±‚ netfilter å®ç°äº†è™šæ‹Ÿ IPï¼Œç„¶åé€šè¿‡ç›¸åº”çš„è§„åˆ™é“¾æŠŠå—åŒ—å‘æµé‡å‡†ç¡®æ— è¯¯çš„æ¥å…¥åç«¯ Pod å®ä¾‹ã€‚éšç€éœ€æ±‚çš„è¡ç”Ÿï¼Œåæ¥æ‰©å±•çš„ Ingress å¯¹è±¡åˆ™æ˜¯å€ŸåŠ©ç¬¬ä¸‰æ–¹ä»£ç†æœåŠ¡å¦‚ HAProxyã€Nginx ç­‰ 7 å±‚å¼•æµå·¥å…·æ‰“é€šå¤–éƒ¨æµé‡å’Œå†…éƒ¨ Service å¯¹è±¡çš„é€šè·¯ã€‚Ingress å¯¹è±¡çš„ç›®çš„å°±æ˜¯ä¸ºäº†è§£å†³å®¹å™¨é›†ç¾¤ä¸­éœ€è¦é«˜æ€§èƒ½åº”ç”¨ç½‘å…³æ¥å…¥çš„éœ€æ±‚ã€‚</p>
<h3 id="service-çš„æ€è€ƒ">Service çš„æ€è€ƒ</h3>
<p>Service å®šä¹‰çš„ç½‘ç»œåŸºäº iptables ç¼–æ’ netfilter è§„åˆ™æ¥æ”¯æŒè™šæ‹Ÿ IPã€‚Service å¯¹è±¡è¢«è®¾è®¡ä¸ºåå‘ä»£ç†æ¨¡å¼ï¼Œæ”¯æŒå—åŒ—å‘æµé‡çš„è´Ÿè½½å‡è¡¡ï¼Œé€šè¿‡ DNAT æŠŠæµé‡è½¬åˆ°åç«¯çš„å…·ä½“ä¸šåŠ¡çš„ Pod ä¸­ã€‚ä¸ºäº†åŠ«æŒæ¥å…¥æµé‡å’Œ NAT è½¬æ¢ï¼ŒKubernetes åˆ›å»ºäº†ä¸¤æ¡è‡ªå®šä¹‰é“¾è§„åˆ™ PREROUTING å’Œ OUTPUTã€‚å¦‚ï¼š</p>
<pre tabindex="0"><code>-A PREROUTING -m comment --comment &quot;kubernetes service portals&quot; -j KUBE-SERVICES
...
-A OUTPUT -m comment --comment &quot;kubernetes service portals&quot; -j KUBE-SERVICES
...

</code></pre><p>PREROUTING ä¸»è¦å¤„ç†ä»å¤–éƒ¨å¼•å…¥çš„æµé‡å’Œæ¥è‡ª Pod å®¹å™¨ç½‘ç»œçš„å¼•å…¥æµé‡ï¼ŒOUTPUT ä¸»è¦å¤„ç†æµå‡ºåˆ°å¤–éƒ¨ç½‘ç»œçš„æµé‡å’Œæµå‡ºåˆ° Pod å®¹å™¨ç½‘ç»œçš„æµé‡ã€‚</p>
<p>å› ä¸ºå‘å¸ƒçš„æœåŠ¡è‚¯å®šéœ€è¦å¯¹å¤–æš´éœ²æœåŠ¡ï¼Œæ‰€ä»¥ Kubernetes åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰è§„åˆ™é“¾ KUBE-SERVICE æ¥æ”¯æŒé›†ç¾¤çº§åˆ«çš„æœåŠ¡å‘ç°ï¼Œå³ ClusterIP å’Œ LoadBalancer ç±»å‹ï¼Œæœ€åé€šè¿‡å¦å¤–ä¸€æ¡è‡ªå®šä¹‰è§„åˆ™é“¾ KUBE-NODEPORTS æ¥å¯¹å¤–æš´éœ²æœåŠ¡ï¼Œæ¡ˆä¾‹å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>-A KUBE-SERVICES -m comment --comment &quot;kubernetes service nodeports; NOTE: this must be the last rule in this chain&quot; -m addrtype --dst-type LOCAL -j KUBE-NODEPORTS

</code></pre><p>æ¯ä¸€ä¸ª Service éƒ½ä¼šåˆ›å»ºä¸€å¥—è§„åˆ™é“¾ï¼ŒNODEPORTS è§„åˆ™å¿…é¡»åœ¨æœ€åä¸€è¡Œã€‚å› æ­¤ä¸éš¾çŸ¥é“ï¼Œå½“æœåŠ¡æ•°é‡è¾¾åˆ°ä¸Šä¸‡ä¸ªæ—¶å€™ï¼Œiptables æ˜¯æ— æ³•æ‰¿è½½è¿™ç§è§„æ¨¡çš„è§„åˆ™é“¾çš„å¤„ç†çš„ã€‚æ‰€ä»¥ï¼Œåœ¨æœ€æ–°æœåŠ¡æ–¹æ¡ˆä¸­é»˜è®¤å¼•å…¥ ipvs å–ä»£ iptables çš„åŸå› ã€‚</p>
<h4 id="clusterip-ç±»å‹"><strong>ClusterIP ç±»å‹</strong></h4>
<p>Service é»˜è®¤ç±»å‹ï¼Œé…åˆåœºæ™¯å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ 5 ç§åˆ†ç±»ï¼š</p>
<ul>
<li>ClusterIP service</li>
<li>ClusterIP service with session affinity</li>
<li>ClusterIP with external IPs</li>
<li>ClusterIP service without any endpoints</li>
<li>Headless service</li>
</ul>
<p>ä¸ºäº†åŠ æ·±å°è±¡ï¼Œä»¥ä¸‹é€šè¿‡æ¡ˆä¾‹æ¥å­¦ä¹  Service å¯¹è±¡ï¼š</p>
<pre tabindex="0"><code>#redis.yaml
apiVersion: apps/v1beta1
kind: Deployment
metadata:
  name: redis
spec:
  replicas: 2
  template:
    metadata:
      labels:
        app: redis
    spec:
      containers:
      - name: redis
        image: redis
        ports:
        - containerPort: 6379
          name: redis

</code></pre><p>å…ˆåˆ›å»ºæ™®é€šçš„ Serviceï¼š</p>
<pre tabindex="0"><code>#redis-clusterip.yaml
apiVersion: v1
kind: Service
metadata:
  name: redis
spec:
  ports:
  - port: 6379
  selector:
    app: redis

</code></pre><p>æŸ¥çœ‹ Service æƒ…å†µï¼š</p>
<pre tabindex="0"><code>#kubectl get service redis
NAME    TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE
redis   ClusterIP   10.0.19.85   &lt;none&gt;        6379/TCP   3d4h

#kubectl get endpoints redis
NAME    ENDPOINTS                           AGE
redis   10.244.1.69:6379,10.244.1.70:6379   3d4h

</code></pre><p>å¾ˆå¤šç”¨æˆ·åœ¨é‡åˆ°è¿™ä¸ª Cluster ip åï¼Œå°±ä¼šå°è¯• ping å®ƒï¼Œä½†æ˜¯ ping ä¸é€šï¼Œä¹Ÿä¸æ¸…æ¥šä¸ºä»€ä¹ˆã€‚å…¶å®å®ƒæ˜¯ä¸€ä¸ªè™šæ‹Ÿ IPï¼Œå¹¶æ²¡æœ‰ç›¸å…³ç½‘ç»œè¿›ç¨‹å’Œå®ƒå…³è”ï¼Œå½“ç„¶ä¹Ÿå°±æ— æ³•è®¿é—®ã€‚Kubernetes é»˜è®¤ä¼šåœ¨åˆ›å»º Service çš„æ—¶å€™æŠŠæ­¤è™šæ‹Ÿ IP åŠ å…¥åˆ°å†…ç½®çš„ DNS ä¸­ç”¨æ¥æ”¯æŒæœåŠ¡å‘ç°ï¼Œä»…æ­¤è€Œå·²ã€‚å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>#nslookup redis.default.svc.cluster.local 10.0.0.10
Server:        10.0.0.10
Address:    10.0.0.10#53

Name:    redis.default.svc.cluster.local
Address: 10.0.19.85

</code></pre><p>ç°åœ¨æŸ¥çœ‹ kube-proxy é€šè¿‡ iptables å®šä¹‰çš„è§„åˆ™é“¾ï¼Œäº†è§£æµé‡æ¥å…¥çš„å®ç°æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>-A KUBE-SERVICES ! -s 10.244.0.0/16 -d 10.0.19.85/32 -p tcp -m comment --comment &quot;default/redis: cluster IP&quot; -m tcp --dport 6379 -j KUBE-MARK-MASQ
-A KUBE-SERVICES -d 10.0.19.85/32 -p tcp -m comment --comment &quot;default/redis: cluster IP&quot; -m tcp --dport 6379 -j KUBE-SVC-SCFPZ36VFLUNBB47

-A KUBE-SVC-SCFPZ36VFLUNBB47 -m statistic --mode random --probability 0.50000000000 -j KUBE-SEP-UH5EYFQKYB24RWKN
-A KUBE-SVC-SCFPZ36VFLUNBB47 -j KUBE-SEP-5MXPM55VLN7O52FQ

-A KUBE-SEP-UH5EYFQKYB24RWKN -s 10.244.1.69/32 -j KUBE-MARK-MASQ
-A KUBE-SEP-UH5EYFQKYB24RWKN -p tcp -m tcp -j DNAT --to-destination 10.244.1.69:6379

-A KUBE-SEP-5MXPM55VLN7O52FQ -s 10.244.1.70/32 -j KUBE-MARK-MASQ
-A KUBE-SEP-5MXPM55VLN7O52FQ -p tcp -m tcp -j DNAT --to-destination 10.244.1.70:6379

</code></pre><p>æ³¨æ„ï¼ŒService è¿™å±‚çš„è´Ÿè½½å‡è¡¡æ˜¯é€šè¿‡ iptables çš„ statistic æ¨¡å—å®ç°ï¼š</p>
<pre tabindex="0"><code>-A KUBE-SVC-SCFPZ36VFLUNBB47 -m statistic --mode random --probability 0.50000000000 -j KUBE-SEP-UH5EYFQKYB24RWKN
-A KUBE-SVC-SCFPZ36VFLUNBB47 -j KUBE-SEP-5MXPM55VLN7O52FQ

</code></pre><p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ Pod å†…ç½‘ IP è®¿é—® Service IP çš„æ—¶å€™æ˜¯ä¼šå‘ç”Ÿç«¯å£æµé‡å›æµçš„ã€‚å¦‚ä½•è®©ç«¯å£æµé‡ä¸å›æµçš„æŠ€æœ¯ï¼Œä¸“ä¸šæœ¯è¯­å« hairpin NATã€‚é€šè¿‡ kubelet é…ç½®å‚æ•° <code>--hairpin-mode=hairpin-veth</code> å¯ä»¥è®© Pod å†…ç½‘ç½‘å¡è‡ªåŠ¨æ”¯æŒ hairpinï¼Œä»è€Œè§£å†³è™šæ‹Ÿç½‘å¡æµé‡å›æµçš„é—®é¢˜ã€‚</p>
<p>è®© ClusterIP æ”¯æŒæµé‡äº²å’Œæ€§ï¼Œä½ éœ€è¦å¦‚ä¸‹å£°æ˜å¯¹è±¡ï¼š</p>
<pre tabindex="0"><code>#redis-clusterip-sa.yaml
apiVersion: v1
kind: Service
metadata:
  name: redis-sa
spec:
  sessionAffinity: ClientIP
  ports:
  - port: 6379
  selector:
    app: redis

</code></pre><p>æŸ¥çœ‹ iptables ç”Ÿæˆçš„è§„åˆ™å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>-A KUBE-SERVICES ! -s 10.244.0.0/16 -d 10.0.219.234/32 -p tcp -m comment --comment &quot;default/redis-sa: cluster IP&quot; -m tcp --dport 6379 -j KUBE-MARK-MASQ
-A KUBE-SERVICES -d 10.0.219.234/32 -p tcp -m comment --comment &quot;default/redis-sa: cluster IP&quot; -m tcp --dport 6379 -j KUBE-SVC-YUZPDSCUOF7FG5LD

-A KUBE-SVC-YUZPDSCUOF7FG5LD -m recent --rcheck --seconds 10800 --reap --name KUBE-SEP-6MUUJB4K75LGZXHS --mask 255.255.255.255 --rsource -j KUBE-SEP-6MUUJB4K75LGZXHS
-A KUBE-SVC-YUZPDSCUOF7FG5LD -m recent --rcheck --seconds 10800 --reap --name KUBE-SEP-F5DCISRHJOTG66JA --mask 255.255.255.255 --rsource -j KUBE-SEP-F5DCISRHJOTG66JA
-A KUBE-SVC-YUZPDSCUOF7FG5LD -m statistic --mode random --probability 0.50000000000 -j KUBE-SEP-6MUUJB4K75LGZXHS
-A KUBE-SVC-YUZPDSCUOF7FG5LD -j KUBE-SEP-F5DCISRHJOTG66JA

-A KUBE-SEP-6MUUJB4K75LGZXHS -s 10.244.1.69/32 -j KUBE-MARK-MASQ
-A KUBE-SEP-6MUUJB4K75LGZXHS -p tcp -m recent --set --name KUBE-SEP-6MUUJB4K75LGZXHS --mask 255.255.255.255 --rsource -m tcp -j DNAT --to-destination 10.244.1.69:6379

-A KUBE-SEP-F5DCISRHJOTG66JA -s 10.244.1.70/32 -j KUBE-MARK-MASQ
-A KUBE-SEP-F5DCISRHJOTG66JA -p tcp -m recent --set --name KUBE-SEP-F5DCISRHJOTG66JA --mask 255.255.255.255 --rsource -m tcp -j DNAT --to-destination 10.244.1.70:6379

</code></pre><p>é€šè¿‡ä»¥ä¸Šçš„è§„åˆ™é“¾ï¼Œå¯ä»¥çŸ¥é“é“¾è·¯äº²å’Œæ€§ä¸»è¦æ˜¯é€šè¿‡ iptables çš„ recent æ¨¡å—æ¥æ”¯æŒçš„ã€‚</p>
<p>å¦‚æœä¸æƒ³åˆ›å»º ClusterIPï¼Œå¯ä»¥å£°æ˜ None å»æ‰ ClusterIP æ”¯æŒï¼Œå¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>#redis-clusterip-headless.yaml
apiVersion: v1
kind: Service
metadata:
  name: redis-headless
spec:
  clusterIP: None
  ports:
  - port: 6379
  selector:
    app: redis

</code></pre><p>é€šè¿‡å†…ç½‘ DNS å¯ä»¥äº†è§£åˆ°ï¼ŒæŸ¥è¯¢ Service å°†ç›´æ¥åˆ—å‡º Pod çš„ IP äº†ï¼Œå¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>#nslookup redis-headless.default.svc.cluster.local 10.0.0.10
Server:        10.0.0.10
Address:    10.0.0.10#53

Name:    redis-headless.default.svc.cluster.local
Address: 10.244.1.69
Name:    redis-headless.default.svc.cluster.local
Address: 10.244.1.70

</code></pre><h4 id="nodeport-ç±»å‹"><strong>NodePort ç±»å‹</strong></h4>
<p>NodePort ç±»å‹ä¹Ÿæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„ç±»å‹ï¼ŒæŒ‰ç…§åœºæ™¯åˆ†ç±»å¦‚ä¸‹ 5 ç§ï¼š</p>
<ul>
<li>NodePort service</li>
<li>NodePort service with externalTrafficPolicy: Local</li>
<li>NodePort service without any endpoints</li>
<li>NodePort service with session affinity</li>
<li>NodePort service with externalTrafficPolicy: Local and session affinity</li>
</ul>
<p>ä¸€èˆ¬å¸¸è§çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>#redis-nodeport.yaml
apiVersion: v1
kind: Service
metadata:
  name: redis-nodeport
spec:
  type: NodePort
  ports:
  - nodePort: 30001
    port: 6379
    targetPort: 6379    
  selector:
    app: redis

</code></pre><p>æŸ¥çœ‹åˆ›å»ºç»“æœå¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>#kubectl get service redis-nodeport
NAME             TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
redis-nodeport   NodePort   10.0.118.143   &lt;none&gt;        6379:30001/TCP   107s

#kubectl get endpoints redis-nodeport
NAME             ENDPOINTS          AGE
redis-nodeport   10.244.0.4:6379   110s

</code></pre><p>é€šè¿‡æš´éœ²åœ¨ä¸»æœºå±‚é¢çš„ 30001 ç«¯å£ï¼Œå¤–ç½‘å¯ä»¥è½»æ¾è®¿é—®åˆ°å®¹å™¨é›†ç¾¤ä¸­çš„æœåŠ¡ã€‚</p>
<h3 id="ingress-çš„æ€è€ƒ">Ingress çš„æ€è€ƒ</h3>
<p>Ingress æ‰“é€šäº†ä»é›†ç¾¤å¤–éƒ¨åˆ°é›†ç¾¤å†…æœåŠ¡çš„ HTTP å’Œ HTTPS è·¯ç”±ã€‚æµé‡è·¯ç”±ç”± Ingress èµ„æºä¸Šå®šä¹‰çš„è§„åˆ™æ§åˆ¶ã€‚å…¶å®çœŸæ­£çš„æµé‡è´Ÿè½½ç”±ç¬¬ä¸‰æ–¹ä»£ç†æœåŠ¡æ¥æ”¯æ’‘ï¼Œå¦‚ HAProxyã€‚å¤§å®¶å¯ä»¥å›é¡¾ä¸€ä¸‹ï¼Œåœ¨æ²¡æœ‰ Ingress ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šåœ¨é›†ç¾¤å¤–éƒ¨éƒ¨ç½²æ¥å…¥ç½‘å…³ï¼Œç„¶åæŠŠæµé‡å¼•å…¥é›†ç¾¤ã€‚ä½†æ˜¯ Kubernetes é›†ç¾¤ä¸­çš„æœåŠ¡æ˜¯åŠ¨æ€çš„ï¼Œå¦‚ä½•èƒ½é€šè¿‡æŸ¥è¯¢ APIServer åŠ¨æ€è·å¾—æœåŠ¡åˆ—è¡¨å’Œç«¯å£ï¼Œç„¶åå®æ—¶æ›´æ–°åˆ°ç½‘å…³ä¸­ï¼Œè¿™ä¸å°±å®Œç¾å®ç°ä¸šåŠ¡éœ€æ±‚äº†å—ï¼Ÿæ˜¯çš„ï¼ŒIngress å› æ­¤è€Œç”Ÿï¼Œå®ƒçš„ä¸»è¦èƒ½åŠ›å°±æ˜¯ä¸ºæœåŠ¡æä¾›å¤–éƒ¨å¯è®¿é—®çš„ URLã€è´Ÿè½½å‡è¡¡æµé‡ã€ç»ˆæ­¢ SSL/TLSã€‚</p>
<p>é€šè¿‡ä¸€ä¸ªæœ€å°çš„ Ingress èµ„æºç¤ºä¾‹æ¥ç†Ÿæ‚‰ä¸‹ï¼š</p>
<pre tabindex="0"><code>apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: test-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - http:
      paths:
      - path: /testpath
        pathType: Prefix
        backend:
          serviceName: test
          servicePort: 80

</code></pre><p>Nginx çš„è§„åˆ™æ›´æ–°ä¸»è¦æ˜¯é€šè¿‡ nginx-controller å®šæœŸä» APIServer ä¸­æŠ“å–è·å¾—ã€‚</p>
<h4 id="ç‰¹æ€§ä¸€æœåŠ¡åˆ†ç»„"><strong>ç‰¹æ€§ä¸€ï¼šæœåŠ¡åˆ†ç»„</strong></h4>
<p>ä¸€ä¸ªåˆ†ç»„é…ç½®æ ¹æ®è¯·æ±‚çš„ HTTP URI å°†æµé‡ä»å•ä¸ª IP åœ°å€è·¯ç”±åˆ°å¤šä¸ªæœåŠ¡ã€‚Ingress å…è®¸å°†è´Ÿè½½å‡è¡¡å™¨çš„æ•°é‡é™è‡³æœ€ä½ã€‚ä¾‹å¦‚ï¼Œè¿™æ ·çš„è®¾ç½®ï¼š</p>
<pre tabindex="0"><code>foo.bar.com -&gt; 178.91.123.132 -&gt; / foo    service1:4200
                                 / bar    service2:8080

</code></pre><h4 id="ç‰¹æ€§äºŒåŸºäºåç§°çš„è™šæ‹Ÿæ‰˜ç®¡"><strong>ç‰¹æ€§äºŒï¼šåŸºäºåç§°çš„è™šæ‹Ÿæ‰˜ç®¡</strong></h4>
<p>åŸºäºåç§°çš„è™šæ‹ŸåŸŸåæ”¯æŒå°†é’ˆå¯¹å¤šä¸ªä¸»æœºåçš„ HTTP æµé‡è·¯ç”±åˆ°åŒä¸€ IP åœ°å€ä¸Šã€‚</p>
<pre tabindex="0"><code>foo.bar.com --|                 |-&gt; foo.bar.com service1:80
              | 178.91.123.132  |
bar.foo.com --|                 |-&gt; bar.foo.com service2:80

</code></pre><h4 id="ç‰¹æ€§ä¸‰tls-ç»ˆæ­¢"><strong>ç‰¹æ€§ä¸‰ï¼šTLS ç»ˆæ­¢</strong></h4>
<p>é€šè¿‡è®¾å®šåŒ…å« TLS ç§é’¥å’Œè¯ä¹¦çš„ Secret æ¥ä¿æŠ¤ Ingressã€‚ç›®å‰ï¼ŒIngress åªæ”¯æŒå•ä¸ª TLS ç«¯å£ 443ï¼Œå¹¶å‡å®š TLS ç»ˆæ­¢ã€‚</p>
<pre tabindex="0"><code>apiVersion: v1
kind: Secret
metadata:
  name: testsecret-tls
  namespace: default
data:
  tls.crt: base64 encoded cert
  tls.key: base64 encoded key
type: kubernetes.io/tls

</code></pre><p>åœ¨ Ingress ä¸­å¼•ç”¨æ­¤ Secret å°†ä¼šå‘Šè¯‰ Ingress æ§åˆ¶å™¨ä½¿ç”¨ TLS åŠ å¯†ä»å®¢æˆ·ç«¯åˆ°è´Ÿè½½å‡è¡¡å™¨çš„é€šé“ã€‚ä½ éœ€è¦ç¡®ä¿åˆ›å»ºçš„ TLS Secret æ¥è‡ªåŒ…å« sslexample.foo.com çš„å…¬ç”¨åç§°ï¼ˆCNï¼‰çš„è¯ä¹¦ã€‚è¿™é‡Œçš„å…¬å…±åç§°ä¹Ÿè¢«ç§°ä¸ºå…¨é™å®šåŸŸåï¼ˆFQDNï¼‰ã€‚</p>
<pre tabindex="0"><code>apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: tls-example-ingress
spec:
  tls:
  - hosts:
    - sslexample.foo.com
    secretName: testsecret-tls
  rules:
    - host: sslexample.foo.com
      http:
        paths:
        - path: /
          backend:
            serviceName: service1
            servicePort: 80

</code></pre><p>ä»æ¡ˆä¾‹ä¸­æ¥çœ‹ï¼ŒIngress è™½ç„¶æ‰¿æ‹…è¿™åº”ç”¨ç½‘å…³çš„èŒè´£ï¼Œä½†æ˜¯å…¶è®¾è®¡çš„èƒ½åŠ›å—åˆ¶äºç¬¬ä¸‰æ–¹ä»£ç†ç»„ä»¶ï¼Œåè€Œæ²¡æœ‰è‡ªå®šä¹‰åº”ç”¨ç½‘å…³é‚£ä¹ˆçµæ´»ã€‚æ‰€ä»¥åœ¨å…·ä½“ä¸šåŠ¡ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦è€ƒé‡éœ€æ±‚ååœ¨è§‰å¾—æ˜¯å¦éœ€è¦å¼•å…¥ Ingressã€‚</p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>é›†ç¾¤å¯¹å¤–æœåŠ¡å¯¹è±¡ Service å’Œ Ingress å¾€å¾€è¢«äººè¯¯è§£ï¼Œå¹¶å’Œ Pod æœåŠ¡å‘ç°æ··åœ¨ä¸€èµ·ã€‚é€šè¿‡ä»¥ä¸Šçš„æ¡ˆä¾‹åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å……åˆ†ç†è§£ Service çš„å®ç°ã€‚ä»å®è·µä¸­å‘ç°ï¼ŒService è¿™å±‚çš„ä½œç”¨æ˜¯èµ·åˆ°æ‰¿ä¸Šå¯ä¸‹çš„å…¥å£ä½œç”¨ï¼ŒåŠŸèƒ½ä¸Šåªè¦èƒ½æš´éœ²ä¸»æœºç«¯å£ NodePort å³å¯ã€‚é‡‡ç”¨ iptables å®ç°çš„ NAT è½¬æ¢åªæœ‰åœ¨ä¸Šä¸‡è§„æ¨¡æœåŠ¡çš„æ—¶å€™ï¼Œè§„åˆ™é“¾çš„æš´å¢æ‰ä¼šå½±å“æ€§èƒ½ï¼Œé‡‡ç”¨ ipvs åå‘ä»£ç†æ¨¡å—åå¯ä»¥ç¼“è§£ã€‚ä½†æ˜¯ iptables å®šä¹‰çš„è§„åˆ™é“¾è¿˜è¦è§£å†³ Service å’Œ Pod å®¹å™¨ç½‘ç»œçš„ NAT è¿é€šï¼Œç›®å‰è¿˜æ— æ³•å®Œå…¨å»æ‰ iptables æ¨¡å—ã€‚éšç€ eBPF çš„å…´èµ·ï¼Œé¢„è®¡åé¢å» iptables åŒ–æŒ‡æ—¥å¯å¾…ã€‚</p>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/12-%E7%BB%83%E4%B9%A0%E7%AF%87k8s-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E6%B5%8B%E9%AA%8C/"><span>12 ç»ƒä¹ ç¯‡ï¼šK8s é›†ç¾¤é…ç½®æµ‹éªŒ</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/14-%E5%BA%94%E7%94%A8%E7%BD%91%E5%85%B3-openresty-%E5%AF%B9%E6%8E%A5-k8s-%E5%AE%9E%E8%B7%B5/"><span>14 åº”ç”¨ç½‘å…³ OpenResty å¯¹æ¥ K8s å®è·µ</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 27270 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>