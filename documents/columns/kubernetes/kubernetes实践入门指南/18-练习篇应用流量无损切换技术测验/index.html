<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>18 ç»ƒä¹ ç¯‡ï¼šåº”ç”¨æµé‡æ— æŸåˆ‡æ¢æŠ€æœ¯æµ‹éªŒ | Yipsen Ye</title>
<meta name="description" content="ç»è¿‡è¿ç»­ 5 ç¯‡ç›¸å…³åº”ç”¨æµé‡å¼•æµç›¸å…³çš„æŠ€æœ¯æ¢è®¨ï¼Œç›¸ä¿¡å¤§å®¶å·²ç»å¯¹ Kubernetes çš„æœåŠ¡å¼•æµæ¶æ„æœ‰äº†æ›´æ·±å…¥çš„äº†è§£ã€‚å¸¸è¨€é“å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ï¼Œç¬”è€…åœ¨åå¤ç»ƒä¹ è¿™äº›å‚æ•°çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿæ˜¯è´¹åŠ²äº†å¾ˆå¤§çš„ä¸€æ®µæ—¶é—´æ‰å¯¹ Kubernetes çš„é›†ç¾¤å¼•æµæŠ€æœ¯æœ‰äº†ä¸€äº›è¿ç”¨ã€‚ä»¥ä¸‹çš„ç»ƒä¹ æ¡ˆä¾‹éƒ½æ˜¯ç¬”è€…è®¤ä¸ºå¯ä»¥åŠ å›ºè‡ªèº«çŸ¥è¯†ä½“ç³»çš„å¿…è¦ç»ƒä¹ ï¼Œè¿˜è¯·å¤§å®¶è·Ÿéšæˆ‘çš„è®°å½•ä¸€èµ·ç»ƒä¹ å§ã€‚
ç»ƒä¹  1ï¼šDeployment ä¸‹å®ç°æ— æŸæµé‡åº”ç”¨æ›´æ–° æˆ‘ä»¬åœ¨æ›´æ–°åº”ç”¨çš„æ—¶å€™ï¼Œå¾€å¾€ä¼šå‘ç°å³ä½¿å‘å¸ƒåº”ç”¨çš„æ—¶å€™ Kubernetes é‡‡ç”¨äº†æ»šåŠ¨æ›´æ–°çš„ç­–ç•¥ï¼Œåº”ç”¨æµé‡è¿˜æ˜¯ä¼šç§’æ–­ä¸€ä¸‹ã€‚è¿™ä¸ªå›°æƒ‘åœ¨äºå®˜æ–¹æ–‡æ¡£èµ„æ–™çš„ä»‹ç»ä¸­è¿™é‡Œéƒ½æ˜¯é‡ç‚¹è¯´å¯ä»¥å¹³æ»‘æ›´æ–°çš„ã€‚æ³¨æ„è¿™é‡Œï¼Œå®ƒæ˜¯å¹³æ»‘æ›´æ–°ï¼Œå¹¶ä¸æ˜¯æ— æŸæµé‡çš„æ›´æ–°ã€‚æ‰€ä»¥åˆ°åº•é—®é¢˜å‡ºåœ¨å“ªé‡Œå‘¢ã€‚ç¬”è€…æŸ¥é˜…äº†èµ„æ–™ï¼Œå‘ç°æ ¸å¿ƒé—®é¢˜æ˜¯ Pod ç”Ÿå‘½å‘¨æœŸä¸­åº”ç”¨çš„ç‰ˆæœ¬æ›´æ–°å¦‚ä¸‹å›¾ï¼Œå…³è”å¯¹è±¡èµ„æºå¦‚ Podã€Endpointã€IPVSã€Ingress/SLB ç­‰èµ„æºçš„æ›´æ–°æ“ä½œéƒ½æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚å¾€å¾€æµé‡è¿˜åœ¨å¤„ç†ä¸­ï¼ŒPod å®¹å™¨å°±æœ‰å¯èƒ½ç»™å¦‚ä¸‹å›¾ï¼š
ä¾æ® Pod å®¹å™¨è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾ä¸­ï¼Œå®¹å™¨è¿›ç¨‹çš„çŠ¶æ€å˜æ›´éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå¦‚æœåº”ç”¨éƒ¨ç½²å¯¹è±¡ Deployment ä¸å¢åŠ  lifecycle å‚æ•° preStop çš„é…ç½®ï¼Œå³ä½¿å—åŒ—å‘æµé‡å…³é—­äº†ï¼Œè¿›ç¨‹ä»ç„¶è¿˜éœ€è¦å‡ ç§’é’Ÿå¤„ç†æ­£åœ¨æ‰§è¡Œä¸­çš„ä¼šè¯æ•°æ®ï¼Œæ‰å¯ä»¥ä¼˜é›…é€€å‡ºã€‚ä»¥ä¸‹ä¸ºåº”ç”¨éƒ¨ç½² Deployment å¯¹è±¡çš„å£°æ˜å¼é…ç½®ï¼š
apiVersion: apps/v1kind: Deploymentmetadata:name: nginxspec:replicas: 1selector:matchLabels:component: nginxprogressDeadlineSeconds: 120strategy:type: RollingUpdaterollingUpdate:maxUnavailable: 0template:metadata:labels:component: nginxspec:terminationGracePeriodSeconds: 60containers:- name: nginximage: xds2000/nginx-hostnameports:- name: httpcontainerPort: 80protocol: TCPreadinessProbe:httpGet:path: /port: 80httpHeaders:- name: X-Custom-Headervalue: AwesomeinitialDelaySeconds: 15periodSeconds: 3timeoutSeconds: 1lifecycle:preStop:exec:command: [&amp;quot;/bin/bash&amp;quot;, &amp;quot;-c&amp;quot;, &amp;quot;sleep 10&amp;quot;]å°±ç»ªæ¢æµ‹å™¨ï¼ˆreadinessProbeï¼‰å¯ä»¥çŸ¥é“å®¹å™¨ä»€ä¹ˆæ—¶å€™å‡†å¤‡å¥½äº†å¹¶å¯ä»¥å¼€å§‹æ¥å—è¯·æ±‚æµé‡ï¼Œ å½“ä¸€ä¸ª Pod å†…çš„æ‰€æœ‰å®¹å™¨éƒ½å‡†å¤‡å¥½äº†ï¼Œæ‰èƒ½æŠŠè¿™ä¸ª Pod çœ‹ä½œå°±ç»ªã€‚ è¿™ç§ä¿¡å·çš„ä¸€ä¸ªç”¨é€”å°±æ˜¯æ§åˆ¶å“ªä¸ª Pod ä½œä¸º Service çš„åç«¯ã€‚ åœ¨ Pod è¿˜æ²¡æœ‰å‡†å¤‡å¥½çš„æ—¶å€™ï¼Œä¼šä» Service çš„è´Ÿè½½å‡è¡¡å™¨ä¸­å‰”é™¤ Podã€‚periodSeconds å­—æ®µæŒ‡å®šäº† kubelet æ¯éš” 3 ç§’æ‰§è¡Œä¸€æ¬¡å­˜æ´»æ¢æµ‹ã€‚initialDelaySeconds å­—æ®µå‘Šè¯‰ kubelet åœ¨æ‰§è¡Œç¬¬ä¸€æ¬¡æ¢æµ‹å‰åº”è¯¥ç­‰å¾… 15 ç§’ã€‚">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/kubernetes%e5%ae%9e%e8%b7%b5%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97/">Kuberneteså®è·µå…¥é—¨æŒ‡å—</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/00-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E4%BB%AC%E8%A6%81%E5%AD%A6%E4%B9%A0-kubernetes-%E6%8A%80%E6%9C%AF/">00 ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å­¦ä¹  Kubernetes æŠ€æœ¯</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/01-%E9%87%8D%E6%96%B0%E8%AE%A4%E8%AF%86-kubernetes-%E7%9A%84%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6/">01 é‡æ–°è®¤è¯† Kubernetes çš„æ ¸å¿ƒç»„ä»¶</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/02-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-kubernets-%E7%9A%84%E7%BC%96%E6%8E%92%E5%AF%B9%E8%B1%A1/">02 æ·±å…¥ç†è§£ Kubernets çš„ç¼–æ’å¯¹è±¡</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/03-devops-%E5%9C%BA%E6%99%AF%E4%B8%8B%E8%90%BD%E5%9C%B0-k8s-%E7%9A%84%E5%9B%B0%E9%9A%BE%E5%88%86%E6%9E%90/">03 DevOps åœºæ™¯ä¸‹è½åœ° K8s çš„å›°éš¾åˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/04-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E4%B8%8B%E8%90%BD%E5%9C%B0-k8s-%E7%9A%84%E5%9B%B0%E9%9A%BE%E5%88%86%E6%9E%90/">04 å¾®æœåŠ¡åº”ç”¨åœºæ™¯ä¸‹è½åœ° K8s çš„å›°éš¾åˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/05-%E8%A7%A3%E5%86%B3-k8s-%E8%90%BD%E5%9C%B0%E9%9A%BE%E9%A2%98%E7%9A%84%E6%96%B9%E6%B3%95%E8%AE%BA%E6%8F%90%E7%82%BC/">05 è§£å†³ K8s è½åœ°éš¾é¢˜çš„æ–¹æ³•è®ºæç‚¼</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/06-%E7%BB%83%E4%B9%A0%E7%AF%87k8s-%E6%A0%B8%E5%BF%83%E5%AE%9E%E8%B7%B5%E7%9F%A5%E8%AF%86%E6%8E%8C%E6%8F%A1/">06 ç»ƒä¹ ç¯‡ï¼šK8s æ ¸å¿ƒå®è·µçŸ¥è¯†æŒæ¡</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/07-%E5%AE%B9%E5%99%A8%E5%BC%95%E6%93%8E-containerd-%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">07 å®¹å™¨å¼•æ“ containerd è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/08-k8s-%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E5%B7%A5%E5%85%B7-kubeadm-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">08 K8s é›†ç¾¤å®‰è£…å·¥å…· kubeadm çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/09-%E5%8D%97%E5%8C%97%E5%90%91%E6%B5%81%E9%87%8F%E7%BB%84%E4%BB%B6-ipvs-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">09 å—åŒ—å‘æµé‡ç»„ä»¶ IPVS çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/10-%E4%B8%9C%E8%A5%BF%E5%90%91%E6%B5%81%E9%87%8F%E7%BB%84%E4%BB%B6-calico-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">10 ä¸œè¥¿å‘æµé‡ç»„ä»¶ Calico çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/11-%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0-dns-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">11 æœåŠ¡å‘ç° DNS çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/12-%E7%BB%83%E4%B9%A0%E7%AF%87k8s-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E6%B5%8B%E9%AA%8C/">12 ç»ƒä¹ ç¯‡ï¼šK8s é›†ç¾¤é…ç½®æµ‹éªŒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/13-%E7%90%86%E8%A7%A3%E5%AF%B9%E6%96%B9%E6%9A%B4%E9%9C%B2%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%AF%B9%E8%B1%A1-ingress-%E5%92%8C-service/">13 ç†è§£å¯¹æ–¹æš´éœ²æœåŠ¡çš„å¯¹è±¡ Ingress å’Œ Service</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/14-%E5%BA%94%E7%94%A8%E7%BD%91%E5%85%B3-openresty-%E5%AF%B9%E6%8E%A5-k8s-%E5%AE%9E%E8%B7%B5/">14 åº”ç”¨ç½‘å…³ OpenResty å¯¹æ¥ K8s å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/15-service-%E5%B1%82%E5%BC%95%E6%B5%81%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/">15 Service å±‚å¼•æµæŠ€æœ¯å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/16-cilium-%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">16 Cilium å®¹å™¨ç½‘ç»œçš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/17-%E5%BA%94%E7%94%A8%E6%B5%81%E9%87%8F%E7%9A%84%E4%BC%98%E9%9B%85%E6%97%A0%E6%8D%9F%E5%88%87%E6%8D%A2%E5%AE%9E%E8%B7%B5/">17 åº”ç”¨æµé‡çš„ä¼˜é›…æ— æŸåˆ‡æ¢å®è·µ</a></li>
                
                
                
                    <li>18 ç»ƒä¹ ç¯‡ï¼šåº”ç”¨æµé‡æ— æŸåˆ‡æ¢æŠ€æœ¯æµ‹éªŒ</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/19-%E4%BD%BF%E7%94%A8-rook-%E6%9E%84%E5%BB%BA%E7%94%9F%E4%BA%A7%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E7%8E%AF%E5%A2%83%E5%AE%9E%E8%B7%B5/">19 ä½¿ç”¨ Rook æ„å»ºç”Ÿäº§å¯ç”¨å­˜å‚¨ç¯å¢ƒå®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/20-%E6%9C%89%E7%8A%B6%E6%80%81%E5%BA%94%E7%94%A8%E7%9A%84%E9%BB%98%E8%AE%A4%E7%89%B9%E6%80%A7%E8%90%BD%E5%9C%B0%E5%88%86%E6%9E%90/">20 æœ‰çŠ¶æ€åº”ç”¨çš„é»˜è®¤ç‰¹æ€§è½åœ°åˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/21-%E6%A1%88%E4%BE%8B%E5%88%86%E5%B8%83%E5%BC%8F-mysql-%E9%9B%86%E7%BE%A4%E5%B7%A5%E5%85%B7-vitess-%E5%AE%9E%E8%B7%B5%E5%88%86%E6%9E%90/">21 æ¡ˆä¾‹ï¼šåˆ†å¸ƒå¼ MySQL é›†ç¾¤å·¥å…· Vitess å®è·µåˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/22-%E5%AD%98%E5%82%A8%E5%AF%B9%E8%B1%A1-pvpvcstorage-classes-%E7%9A%84%E7%AE%A1%E7%90%86%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">22 å­˜å‚¨å¯¹è±¡ PVã€PVCã€Storage Classes çš„ç®¡ç†è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/23-k8s-%E9%9B%86%E7%BE%A4%E4%B8%AD%E5%AD%98%E5%82%A8%E5%AF%B9%E8%B1%A1%E7%81%BE%E5%A4%87%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">23 K8s é›†ç¾¤ä¸­å­˜å‚¨å¯¹è±¡ç¾å¤‡çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/24-%E7%BB%83%E4%B9%A0%E7%AF%87k8s-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E6%B5%8B%E9%AA%8C/">24 ç»ƒä¹ ç¯‡ï¼šK8s é›†ç¾¤é…ç½®æµ‹éªŒ</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">18 ç»ƒä¹ ç¯‡ï¼šåº”ç”¨æµé‡æ— æŸåˆ‡æ¢æŠ€æœ¯æµ‹éªŒ</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2021-12-22 01:48:24</span>ğŸ·ï¸&nbsp;<a class="post-tag" href="/tags/kubernetes/">kubernetes</a></div><div class="post-category">
                
                ğŸ“š&nbsp;<a href="/categories/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/">Kuberneteså®è·µå…¥é—¨æŒ‡å—</a>
                
            </div></div>
        <div class="post-content">
            <p>ç»è¿‡è¿ç»­ 5 ç¯‡ç›¸å…³åº”ç”¨æµé‡å¼•æµç›¸å…³çš„æŠ€æœ¯æ¢è®¨ï¼Œç›¸ä¿¡å¤§å®¶å·²ç»å¯¹ Kubernetes çš„æœåŠ¡å¼•æµæ¶æ„æœ‰äº†æ›´æ·±å…¥çš„äº†è§£ã€‚å¸¸è¨€é“å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ï¼Œç¬”è€…åœ¨åå¤ç»ƒä¹ è¿™äº›å‚æ•°çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿæ˜¯è´¹åŠ²äº†å¾ˆå¤§çš„ä¸€æ®µæ—¶é—´æ‰å¯¹ Kubernetes çš„é›†ç¾¤å¼•æµæŠ€æœ¯æœ‰äº†ä¸€äº›è¿ç”¨ã€‚ä»¥ä¸‹çš„ç»ƒä¹ æ¡ˆä¾‹éƒ½æ˜¯ç¬”è€…è®¤ä¸ºå¯ä»¥åŠ å›ºè‡ªèº«çŸ¥è¯†ä½“ç³»çš„å¿…è¦ç»ƒä¹ ï¼Œè¿˜è¯·å¤§å®¶è·Ÿéšæˆ‘çš„è®°å½•ä¸€èµ·ç»ƒä¹ å§ã€‚</p>
<h3 id="ç»ƒä¹ -1deployment-ä¸‹å®ç°æ— æŸæµé‡åº”ç”¨æ›´æ–°">ç»ƒä¹  1ï¼šDeployment ä¸‹å®ç°æ— æŸæµé‡åº”ç”¨æ›´æ–°</h3>
<p>æˆ‘ä»¬åœ¨æ›´æ–°åº”ç”¨çš„æ—¶å€™ï¼Œå¾€å¾€ä¼šå‘ç°å³ä½¿å‘å¸ƒåº”ç”¨çš„æ—¶å€™ Kubernetes é‡‡ç”¨äº†æ»šåŠ¨æ›´æ–°çš„ç­–ç•¥ï¼Œåº”ç”¨æµé‡è¿˜æ˜¯ä¼šç§’æ–­ä¸€ä¸‹ã€‚è¿™ä¸ªå›°æƒ‘åœ¨äºå®˜æ–¹æ–‡æ¡£èµ„æ–™çš„ä»‹ç»ä¸­è¿™é‡Œéƒ½æ˜¯é‡ç‚¹è¯´å¯ä»¥å¹³æ»‘æ›´æ–°çš„ã€‚æ³¨æ„è¿™é‡Œï¼Œå®ƒæ˜¯å¹³æ»‘æ›´æ–°ï¼Œå¹¶ä¸æ˜¯æ— æŸæµé‡çš„æ›´æ–°ã€‚æ‰€ä»¥åˆ°åº•é—®é¢˜å‡ºåœ¨å“ªé‡Œå‘¢ã€‚ç¬”è€…æŸ¥é˜…äº†èµ„æ–™ï¼Œå‘ç°æ ¸å¿ƒé—®é¢˜æ˜¯ Pod ç”Ÿå‘½å‘¨æœŸä¸­åº”ç”¨çš„ç‰ˆæœ¬æ›´æ–°å¦‚ä¸‹å›¾ï¼Œå…³è”å¯¹è±¡èµ„æºå¦‚ Podã€Endpointã€IPVSã€Ingress/SLB ç­‰èµ„æºçš„æ›´æ–°æ“ä½œéƒ½æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚å¾€å¾€æµé‡è¿˜åœ¨å¤„ç†ä¸­ï¼ŒPod å®¹å™¨å°±æœ‰å¯èƒ½ç»™å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Kubernetes%20%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/assets/d52cfb90-1146-11eb-a727-b74ce73d9726.jpg" alt="3a-sync-flow"></p>
<p>ä¾æ® Pod å®¹å™¨è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾ä¸­ï¼Œå®¹å™¨è¿›ç¨‹çš„çŠ¶æ€å˜æ›´éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå¦‚æœåº”ç”¨éƒ¨ç½²å¯¹è±¡ Deployment ä¸å¢åŠ  lifecycle å‚æ•° preStop çš„é…ç½®ï¼Œå³ä½¿å—åŒ—å‘æµé‡å…³é—­äº†ï¼Œè¿›ç¨‹ä»ç„¶è¿˜éœ€è¦å‡ ç§’é’Ÿå¤„ç†æ­£åœ¨æ‰§è¡Œä¸­çš„ä¼šè¯æ•°æ®ï¼Œæ‰å¯ä»¥ä¼˜é›…é€€å‡ºã€‚ä»¥ä¸‹ä¸ºåº”ç”¨éƒ¨ç½² Deployment å¯¹è±¡çš„å£°æ˜å¼é…ç½®ï¼š</p>
<pre tabindex="0"><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      component: nginx
  progressDeadlineSeconds: 120
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 0
  template:
    metadata:
      labels:
        component: nginx
    spec:
      terminationGracePeriodSeconds: 60
      containers:
      - name: nginx
        image: xds2000/nginx-hostname
        ports:
        - name: http
          containerPort: 80
          protocol: TCP
        readinessProbe:
          httpGet:
            path: /
            port: 80
            httpHeaders:
            - name: X-Custom-Header
              value: Awesome
          initialDelaySeconds: 15
          periodSeconds: 3
          timeoutSeconds: 1
        lifecycle:
          preStop:
            exec:
              command: [&quot;/bin/bash&quot;, &quot;-c&quot;, &quot;sleep 10&quot;]

</code></pre><p>å°±ç»ªæ¢æµ‹å™¨ï¼ˆreadinessProbeï¼‰å¯ä»¥çŸ¥é“å®¹å™¨ä»€ä¹ˆæ—¶å€™å‡†å¤‡å¥½äº†å¹¶å¯ä»¥å¼€å§‹æ¥å—è¯·æ±‚æµé‡ï¼Œ å½“ä¸€ä¸ª Pod å†…çš„æ‰€æœ‰å®¹å™¨éƒ½å‡†å¤‡å¥½äº†ï¼Œæ‰èƒ½æŠŠè¿™ä¸ª Pod çœ‹ä½œå°±ç»ªã€‚ è¿™ç§ä¿¡å·çš„ä¸€ä¸ªç”¨é€”å°±æ˜¯æ§åˆ¶å“ªä¸ª Pod ä½œä¸º Service çš„åç«¯ã€‚ åœ¨ Pod è¿˜æ²¡æœ‰å‡†å¤‡å¥½çš„æ—¶å€™ï¼Œä¼šä» Service çš„è´Ÿè½½å‡è¡¡å™¨ä¸­å‰”é™¤ Podã€‚periodSeconds å­—æ®µæŒ‡å®šäº† kubelet æ¯éš” 3 ç§’æ‰§è¡Œä¸€æ¬¡å­˜æ´»æ¢æµ‹ã€‚initialDelaySeconds å­—æ®µå‘Šè¯‰ kubelet åœ¨æ‰§è¡Œç¬¬ä¸€æ¬¡æ¢æµ‹å‰åº”è¯¥ç­‰å¾… 15 ç§’ã€‚</p>
<p>kubectl å·¥å…·æ‰‹åŠ¨åˆ é™¤æŸä¸ªç‰¹å®šçš„ Podï¼Œè€Œè¯¥ Pod çš„ä¼˜é›…ç»ˆæ­¢é™æœŸé»˜è®¤å€¼æ˜¯ 30 ç§’ã€‚preStop å›è°ƒæ‰€éœ€è¦çš„æ—¶é—´é•¿äºé»˜è®¤çš„ä¼˜é›…ç»ˆæ­¢é™æœŸï¼Œä½ å¿…é¡»ä¿®æ”¹ terminationGracePeriodSeconds å±æ€§å€¼æ¥ä½¿å…¶æ­£å¸¸å·¥ä½œã€‚</p>
<p>å¦‚æœ Pod ä¸­çš„å®¹å™¨ä¹‹ä¸€å®šä¹‰äº† preStop å›è°ƒï¼Œkubelet å¼€å§‹åœ¨å®¹å™¨å†…è¿è¡Œè¯¥å›è°ƒé€»è¾‘ã€‚å¦‚æœè¶…å‡ºä½“é¢ç»ˆæ­¢é™æœŸæ—¶ï¼ŒpreStop å›è°ƒé€»è¾‘ ä»åœ¨è¿è¡Œï¼Œkubelet ä¼šè¯·æ±‚ç»™äºˆè¯¥ Pod çš„å®½é™æœŸä¸€æ¬¡æ€§å¢åŠ  2 ç§’é’Ÿã€‚</p>
<p>åœ¨ç†Ÿç»ƒæŒæ¡è¿™äº›ç”Ÿå‘½å‘¨æœŸçš„é…ç½®å±æ€§åï¼Œå•ä¸ª Pod çš„æµé‡å°±å¯ä»¥ä¼˜é›…å¤„ç†ï¼Œè¿™ä¸ªåŸå­èƒ½åŠ›çš„å¤„ç†è®©ä¸Šå±‚é«˜çº§å¯¹è±¡çš„å¤„ç†ä¹Ÿå¯ä»¥åŸç”Ÿæ”¯æŒæ— æŸæµé‡çš„åˆ‡æ¢ã€‚</p>
<h3 id="ç»ƒä¹ -2ingress-nginx-æµé‡æ— æŸåˆ‡æ¢æ›´æ–°åº”ç”¨">ç»ƒä¹  2ï¼šIngress-nginx æµé‡æ— æŸåˆ‡æ¢æ›´æ–°åº”ç”¨</h3>
<p>Ingress å¯¹è±¡æ˜¯ Kubernetes è®¾è®¡çš„å¼•æµå¯¹è±¡ï¼Œå®ƒç›´æ¥ç›‘å¬ Service çš„ Endpoints æ¥å£åˆ—è¡¨çš„å˜åŒ–æ¥æ›´æ–°è´Ÿè½½å‡è¡¡çš„æ¥å£åˆ—è¡¨ï¼Œå½“å‰ ingress-nginx çš„è´Ÿè½½å‡è¡¡ç®—æ³•å·²ç»é‡‡ç”¨ Lua ç¼–å†™çš„<strong>æ•°åŠ æƒç§»åŠ¨å¹³å‡ï¼ˆEWMAï¼‰ç®—æ³•</strong>æ¥å®ç°æµé‡çš„å¹³æ»‘å¤„ç†ã€‚ä»¥ä¸‹ä¾‹å­ä»¥ Nginx OSS ç‰ˆæœ¬çš„ Ingress æ¥ä½œä¸ºèŒƒä¾‹å¸®åŠ©å¤§å®¶ç†è§£ã€‚æ¡ˆä¾‹å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code># å®‰è£… Ingress
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-0.32.0/deploy/static/provider/cloud/deploy.yaml
# éªŒè¯
â¯ kubectl get pods --all-namespaces -l app.kubernetes.io/name=ingress-nginx
NAMESPACE       NAME                                        READY   STATUS      RESTARTS   AGE
ingress-nginx   ingress-nginx-admission-create-j5f8z        0/1     Completed   0          11m
ingress-nginx   ingress-nginx-admission-patch-btfd4         0/1     Completed   1          11m
ingress-nginx   ingress-nginx-controller-866488c6d4-snp4s   1/1     Running     0          11m

</code></pre><p>åŠ è½½åº”ç”¨ï¼š</p>
<pre tabindex="0"><code>kubectl create -f sample/apple.yaml

# sample/apple.yaml
kind: Pod
apiVersion: v1
metadata:
  name: apple-app
  labels:
    app: apple
    version: apple-v1
spec:
  containers:
    - name: apple-app
      image: hashicorp/http-echo
      args:
        - &quot;-text=apple&quot;

---

kind: Service
apiVersion: v1
metadata:
  name: apple-service
spec:
  selector:
    version: apple-v1
  ports:
    - port: 5678 # Default port for image

</code></pre><p>åŠ è½½åº”ç”¨ï¼š</p>
<pre tabindex="0"><code>kubectl create -f sample/banana.yaml

# sample/banana.yaml
kind: Pod
apiVersion: v1
metadata:
  name: banana-app
  labels:
    app: banana
    version: banana-v1
spec:
  containers:
    - name: banana-app
      image: hashicorp/http-echo
      args:
        - &quot;-text=banana&quot;

---

kind: Service
apiVersion: v1
metadata:
  name: banana-service
spec:
  selector:
    version: banana-v1
  ports:
    - port: 5678 # Default port for image

</code></pre><p>åŠ è½½ Ingress è§„åˆ™ï¼š</p>
<pre tabindex="0"><code># sample/ingress.yaml
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: example-ingress
  annotations:
    ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - http:
      paths:
        - path: /apple
          backend:
            serviceName: apple-service
            servicePort: 5678
        - path: /banana
          backend:
            serviceName: banana-service
            servicePort: 5678

</code></pre><p>å½“ä½ åˆ‡æ¢ ingress.yaml é‡Œé¢çš„è·¯ç”±è§„åˆ™çš„æ—¶å€™ï¼Œåå‘ä»£ç†å°±ä¼š reload æ›´æ–°ä¸€æ¬¡ï¼Œè¿æ¥å°±ä¼šä¸­æ–­ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»é˜²æ­¢ Ingress å‘ç”Ÿå˜æ›´ï¼Œåªåœ¨ Service å¯¹è±¡é€šè¿‡æ›´æ–° selector çš„æ–¹å¼å˜æ›´ Endpoints å¯¹è±¡é›†åˆï¼Œå› ä¸º Ingress çš„æ›´æ–°æœºåˆ¶å°±æ˜¯ç›‘å¬ Endpointsï¼Œä¼šè‡ªåŠ¨çƒ­åŠ è½½æ›´æ”¹ä»£ç†é…ç½®ï¼Œå®ç°æ— é‡å¯çš„æµé‡åˆ‡æ¢ã€‚æ›´æ–°ä¾‹å­å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code># è¿™é‡Œ Service çš„æ›´æ–°ä¼šè§¦å‘ IPVS æ›´æ–° endpoints çš„ Pod åœ°å€ï¼Œ
export RELEASE_VERSION=banana-v2
kubectl patch svc default-www -p '{&quot;spec&quot;:{&quot;selector&quot;:{&quot;version&quot;:&quot;'${RELEASE_VERSION}'&quot;}}}'

</code></pre><p>Ingress ç›‘å¬ Endpoints çš„ lua å‡½æ•°å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code># https://github.com/kubernetes/ingress-nginx/blob/8f413c4231a727b28c4c137a0fb3f7a790f156c4/rootfs/etc/nginx/lua/util.lua#L100

-- diff_endpoints compares old and new
-- and as a first argument returns what endpoints are in new
-- but are not in old, and as a second argument it returns
-- what endpoints are in old but are in new.
-- Both return values are normalized (ip:port).
function _M.diff_endpoints(old, new)
  local endpoints_added, endpoints_removed = {}, {}
  local normalized_old = normalize_endpoints(old)
  local normalized_new = normalize_endpoints(new)

  for endpoint_string, _ in pairs(normalized_old) do
    if not normalized_new[endpoint_string] then
      table.insert(endpoints_removed, endpoint_string)
    end
  end

  for endpoint_string, _ in pairs(normalized_new) do
    if not normalized_old[endpoint_string] then
      table.insert(endpoints_added, endpoint_string)
    end
  end

  return endpoints_added, endpoints_removed
end

</code></pre><h3 id="ç»ƒä¹ -3é€šè¿‡-traefik-å®ç°é›¶åœæœºæ—¶é—´éƒ¨ç½²">ç»ƒä¹  3ï¼šé€šè¿‡ Traefik å®ç°é›¶åœæœºæ—¶é—´éƒ¨ç½²</h3>
<p>å› ä¸º Traefik å¯ä»¥ç›´æ¥å’Œ Kubernetes Apiserver è¿›è¡Œäº¤äº’ï¼Œæ‰€ä»¥å¯¹äºæµé‡çš„åˆ‡æ¢å’Œéƒ¨ç½²ä¼šæ¯” ingress-nginx æ›´åŠ ä¾¿æ·ã€‚Traefik åœ¨ Kubernetes ä¸­ä¹Ÿæ˜¯ä¸€ä¸ª Ingress å¯¹è±¡ï¼Œåœ¨ç¬¬äºŒä¸ªç»ƒä¹ ä¸­æˆ‘ä»¬å·²ç»ä»‹ç»äº†é€šè¿‡ Service çš„ selector åˆ‡æ¢å®ç°æ— æŸæµé‡çš„éƒ¨ç½²æ–¹æ³•ï¼Œç¬¬ä¸‰ä¸ªä¾‹å­æˆ‘ä»¬ä»‹ç»å¦å¤–ä¸‰ç§æ¯”è¾ƒæµè¡Œçš„æ–¹æ³•ï¼Œè“ç»¿éƒ¨ç½²ã€é‡‘ä¸é›€å‘å¸ƒå’Œ A/B æµ‹è¯•ã€‚è™½ç„¶è¿™ä¸‰ç§æ–¹å¼éƒ½æœ‰å…³è”ï¼Œä½†ä¹Ÿå„æœ‰ä¸åŒã€‚</p>
<p>é€šè¿‡ Kubernetes ä¸å¯å˜åŸºç¡€è®¾æ–½çš„æ”¯æŒï¼Œæˆ‘ä»¬å¯ä»¥è®©åŒä¸€è½¯ä»¶çš„å¤šä¸ªç‰ˆæœ¬å®ä¾‹åœ¨åŒä¸€é›†ç¾¤å†…æœåŠ¡äºè¯·æ±‚ï¼Œè¿™ç§æ¨¡å¼ä¼šè®©è¯•éªŒå˜å¾—éå¸¸æœ‰è¶£ã€‚åƒè¿™æ ·æ··åˆä½¿ç”¨æ–°æ—§ç‰ˆæœ¬ï¼Œå°±å¯ä»¥é…ç½®è·¯ç”±è§„åˆ™æ¥æµ‹è¯•ç”Ÿäº§ç¯å¢ƒçš„æœ€æ–°ç‰ˆæœ¬ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæ–°ç‰ˆæœ¬å¯ä»¥é€æ­¥å‘å¸ƒâ€”â€”å¦‚æœå‡ºç°é—®é¢˜ï¼Œç”šè‡³å¯ä»¥æ’¤å›â€”â€”æ‰€æœ‰è¿™ä¸€åˆ‡å‡ ä¹éƒ½æ²¡æœ‰åœæœºæ—¶é—´ã€‚</p>
<p>è“ç»¿å‘å¸ƒæ¨¡å¼ä¸‹ï¼Œ&ldquo;ç»¿è‰² &ldquo;æŒ‡çš„æ˜¯åº”ç”¨çš„å½“å‰ç¨³å®šç‰ˆæœ¬ï¼Œè€Œâ€œè“è‰²â€æŒ‡çš„æ˜¯å¼•å…¥æ–°åŠŸèƒ½å’Œä¿®å¤çš„å³å°†å‘å¸ƒçš„ç‰ˆæœ¬ã€‚ä¸¤ä¸ªç‰ˆæœ¬çš„å®ä¾‹åŒæ—¶åœ¨åŒä¸€ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œã€‚åŒæ—¶ï¼Œä»£ç†æœåŠ¡ï¼ˆå¦‚ Traefikï¼‰ç¡®ä¿åªæœ‰å‘é€åˆ°ç§æœ‰åœ°å€çš„è¯·æ±‚æ‰èƒ½åˆ°è¾¾è“è‰²å®ä¾‹ã€‚ä¾‹å­å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Kubernetes%20%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/assets/5d56ec60-1147-11eb-b3d0-8f726182606e.jpg" alt="3a-blue-green-deploy"></p>
<p>é‡‘ä¸é›€å‘å¸ƒæ¨¡å¼å°†è“ç»¿æµ‹è¯•åˆå‘å‰æ¨è¿›äº†ä¸€æ­¥ï¼Œç”¨ä¸€ç§è°¨æ…çš„æ–¹å¼å°†æ–°åŠŸèƒ½å’Œè¡¥ä¸éƒ¨ç½²åˆ°æ´»è·ƒçš„ç”Ÿäº§ç¯å¢ƒä¸­ã€‚è·¯ç”±é…ç½®è®©å½“å‰çš„ç¨³å®šç‰ˆæœ¬å¤„ç†å¤§å¤šæ•°è¯·æ±‚ï¼Œä½†æœ‰é™æ¯”ä¾‹çš„è¯·æ±‚ä¼šè¢«è·¯ç”±åˆ°æ–°çš„â€œé‡‘ä¸é›€â€ç‰ˆæœ¬çš„å®ä¾‹ã€‚ä¾‹å­å¦‚ä¸‹ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Kubernetes%20%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/assets/73c3e3e0-1147-11eb-be04-b99e4a609d35.jpg" alt="3a-canary-releases.png"></p>
<p>A/B æµ‹è¯•æŠ€æœ¯æœ‰æ—¶ä¼šä¸å‰ä¸¤ç§æŠ€æœ¯æ··æ·†ï¼Œä½†å®ƒæœ‰è‡ªå·±çš„ç›®çš„ï¼Œå³è¯„ä¼°å³å°†å‘å¸ƒçš„ç‰ˆæœ¬çš„ä¸¤ä¸ªä¸åŒçš„ç‰ˆæœ¬ï¼Œçœ‹çœ‹å“ªä¸ªç‰ˆæœ¬ä¼šæ›´æˆåŠŸã€‚è¿™ç§ç­–ç•¥åœ¨ UI å¼€å‘ä¸­å¾ˆå¸¸è§ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä¸€ä¸ªæ–°åŠŸèƒ½å¾ˆå¿«å°±ä¼šæ¨å‡ºåˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œä½†ä¸æ¸…æ¥šå¦‚ä½•æœ€å¥½åœ°å°†å…¶æš´éœ²ç»™ç”¨æˆ·ã€‚ä¸ºäº†æ‰¾å‡ºç­”æ¡ˆï¼ŒåŒ…æ‹¬è¯¥åŠŸèƒ½åœ¨å†…çš„ä¸¤ä¸ªç‰ˆæœ¬çš„ UIï¼ŒåŒæ—¶è¿è¡Œ A ç‰ˆæœ¬å’Œ B ç‰ˆæœ¬ï¼Œä»£ç†è·¯ç”±å™¨å‘æ¯ä¸ªç‰ˆæœ¬å‘é€æœ‰é™æ•°é‡çš„è¯·æ±‚ã€‚ä¾‹å­å¦‚ä¸‹ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Kubernetes%20%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/assets/6d1b7360-1155-11eb-be04-b99e4a609d35.jpg" alt="A/B æµ‹è¯•"></p>
<p>è¿™äº›æŠ€æœ¯å¯¹äºæµ‹è¯•ç°ä»£çš„äº‘åŸç”Ÿè½¯ä»¶æ¶æ„æ˜¯éå¸¸å®è´µçš„ï¼Œå°¤å…¶æ˜¯ä¸ä¼ ç»Ÿçš„ç€‘å¸ƒå¼éƒ¨ç½²æ¨¡å‹ç›¸æ¯”ã€‚å¦‚æœä½¿ç”¨å¾—å½“ï¼Œå®ƒä»¬å¯ä»¥å¸®åŠ©å‘ç°ç”Ÿäº§ç¯å¢ƒä¸­ä¸å¯é¢„è§çš„å›å½’ã€é›†æˆå¤±è´¥ã€æ€§èƒ½ç“¶é¢ˆå’Œå¯ç”¨æ€§é—®é¢˜ï¼Œä½†è¦åœ¨æ–°ä»£ç è¿›å…¥ç¨³å®šçš„ç”Ÿäº§ç‰ˆæœ¬ä¹‹å‰ã€‚</p>
<p>è¿™ä¸‰ç§æ–¹æ³•çš„å…±åŒç‚¹æ˜¯ï¼Œå®ƒä»¬ä¾é å®¹å™¨å’Œ Kubernetes æä¾›çš„éƒ¨ç½²ä¾¿åˆ©æ€§ï¼ŒåŠ ä¸Šäº‘åŸç”Ÿç½‘ç»œæŠ€æœ¯ï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°å¯æµ‹è¯•çš„éƒ¨ç½²ï¼ŒåŒæ—¶æœ€å¤§é™åº¦åœ°å‡å°‘å¯¹ç”Ÿäº§ä»£ç çš„å¹²æ‰°ã€‚è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç»„åˆâ€”â€”è¿™æ­£æ˜¯ Traefik çš„ä¼˜åŠ¿æ‰€åœ¨â€”â€”å¦‚æœæ˜æ™ºåœ°ä½¿ç”¨ï¼Œå®ƒå¯ä»¥æœ‰æ•ˆåœ°å°†æ•´ä½“åº”ç”¨ç¨‹åºçš„åœæœºæ—¶é—´é™è‡³é›¶ã€‚</p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>åº”ç”¨çš„æµé‡æ›´æ–°å¤æ‚ç¨‹åº¦æ¶‰åŠåˆ°åº”ç”¨çŠ¶æ€çš„å˜æ›´ï¼Œä»¥ä¸Šçš„ä¾‹å­åªæ˜¯åœ¨æœ‰é™çš„ç¯å¢ƒä¸­éªŒè¯æ— æŸæµé‡çš„åˆ‡æ¢æ€è·¯ã€‚åœ¨çœŸå®åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘æ•°æ®åº“ï¼Œä¸šåŠ¡ç³»ç»Ÿç­‰å…³è”åº”ç”¨çš„å½±å“ï¼Œå¾ˆéš¾åƒä¹ é¢˜ä¸­ä¸€æ ·ç›´æ¥ç”¨æ— çŠ¶æ€åº”ç”¨æ¥éšæ„åˆ‡æ¢ã€‚ä½†æ˜¯è¿™äº›å› ç´ éƒ½ä¸å¦¨ç¢æˆ‘ä»¬ç¡®è®¤ä¸€ä¸ªäº‹å®ï¼ŒKubernetes ç¡®å®å¯ä»¥é€šè¿‡å‚æ•°å®ç°æ— æŸæµé‡çš„åˆ‡æ¢ï¼Œå®ƒæ˜¯å¯è¡Œçš„ä¸€å¥—åŸºç¡€è®¾æ–½ï¼Œä½ éœ€è¦æ·±å…¥ç†è§£å¹¶æŒæ¡è¿™äº›åŸºæœ¬å¯¹è±¡çš„å®ç°ç»†èŠ‚ï¼Œé€šè¿‡åˆç†çš„é…ç½®å°±å¯ä»¥å®ç°ä½ éœ€è¦çš„ä¸å¯å˜åŸºç¡€è®¾æ–½ã€‚</p>
<h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3>
<ul>
<li><a href="https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-lifecycle/">https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-lifecycle/</a></li>
<li><a href="https://itnext.io/improving-zero-downtime-on-kubernetes-95e3a2f623ba">https://itnext.io/improving-zero-downtime-on-kubernetes-95e3a2f623ba</a></li>
<li><a href="https://github.com/kubernetes/ingress-nginx/blob/0549d9b132f54d0ac8d956bc78427cd2734ffdcd/rootfs/etc/nginx/lua/balancer/ewma.lua">https://github.com/kubernetes/ingress-nginx/blob/0549d9b132f54d0ac8d956bc78427cd2734ffdcd/rootfs/etc/nginx/lua/balancer/ewma.lua</a></li>
<li><a href="https://traefik.io/blog/achieve-zero-downtime-deployments-with-traefik-and-kubernetes/">https://traefik.io/blog/achieve-zero-downtime-deployments-with-traefik-and-kubernetes/</a></li>
</ul>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/17-%E5%BA%94%E7%94%A8%E6%B5%81%E9%87%8F%E7%9A%84%E4%BC%98%E9%9B%85%E6%97%A0%E6%8D%9F%E5%88%87%E6%8D%A2%E5%AE%9E%E8%B7%B5/"><span>17 åº”ç”¨æµé‡çš„ä¼˜é›…æ— æŸåˆ‡æ¢å®è·µ</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/19-%E4%BD%BF%E7%94%A8-rook-%E6%9E%84%E5%BB%BA%E7%94%9F%E4%BA%A7%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E7%8E%AF%E5%A2%83%E5%AE%9E%E8%B7%B5/"><span>19 ä½¿ç”¨ Rook æ„å»ºç”Ÿäº§å¯ç”¨å­˜å‚¨ç¯å¢ƒå®è·µ</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 28280 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>