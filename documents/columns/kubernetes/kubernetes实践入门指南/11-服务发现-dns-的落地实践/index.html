<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>11 æœåŠ¡å‘ç° DNS çš„è½åœ°å®è·µ | Yipsen Ye</title>
<meta name="description" content="DNS æœåŠ¡æ˜¯ Kubernetes å†…ç½®çš„æœåŠ¡å‘ç°ç»„ä»¶ï¼Œå®ƒæ–¹ä¾¿å®¹å™¨æœåŠ¡å¯ä»¥é€šè¿‡å‘å¸ƒçš„å”¯ä¸€ App åå­—æ‰¾åˆ°å¯¹æ–¹çš„ç«¯å£æœåŠ¡ï¼Œå†ä¹Ÿä¸éœ€è¦ç»´æŠ¤æœåŠ¡å¯¹åº”çš„ IP å…³ç³»ã€‚è¿™ä¸ªå¯¹ä¼ ç»Ÿä¼ä¸šå†…éƒ¨çš„è¿ç»´ä¹ æƒ¯ä¹Ÿæ˜¯æœ‰ä¸€äº›å˜é©çš„ã€‚ä¸€èˆ¬ä¼ ç»Ÿä¼ä¸šå†…éƒ¨éƒ½ä¼šç»´æŠ¤ä¸€å¥— CMDB ç³»ç»Ÿï¼Œä¸“é—¨æ¥ç»´æŠ¤æœåŠ¡å™¨å’Œ IP åœ°å€çš„å¯¹åº”å…³ç³»ï¼Œæ–¹ä¾¿è§„åˆ’ç®¡ç†å¥½åº”ç”¨æœåŠ¡é›†ç¾¤ã€‚å½“è½åœ° K8s é›†ç¾¤ä¹‹åï¼Œå› ä¸ºåº”ç”¨å®¹å™¨çš„ IP ç”Ÿå‘½å‘¨æœŸçŸ­æš‚ï¼Œé€šè¿‡ App åå­—æ¥è¯†åˆ«æœåŠ¡å…¶å®å¯¹è¿ç»´å’Œå¼€å‘éƒ½ä¼šæ›´æ–¹ä¾¿ã€‚æ‰€ä»¥æœ¬ç¯‡å°±æ˜¯ç»“åˆå®é™…çš„éœ€æ±‚åœºæ™¯ç»™å¤§å®¶è¯¦ç»†ä»‹ç» DNS çš„ä½¿ç”¨å®è·µã€‚
CoreDNS ä»‹ç» Kubernetes æ—©æœŸçš„ DNS ç»„ä»¶å« KubeDNSã€‚CNCF ç¤¾åŒºåæ¥å¼•å…¥äº†æ›´åŠ æˆç†Ÿçš„å¼€æºé¡¹ç›® CoreDNS æ›¿æ¢äº† KubeDNSã€‚æ‰€ä»¥æˆ‘ä»¬ç°åœ¨æåˆ° KubeDNSï¼Œå…¶å®é»˜è®¤æŒ‡ä»£çš„æ˜¯ CoreDNS é¡¹ç›®ã€‚åœ¨ Kubernetes ä¸­éƒ¨ç½² CoreDNS ä½œä¸ºé›†ç¾¤å†…çš„ DNS æœåŠ¡æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œä¾‹å¦‚å¯ä»¥ä½¿ç”¨å®˜æ–¹ Helm Chart åº“ä¸­çš„ Helm Chart éƒ¨ç½²ï¼Œå…·ä½“å¯æŸ¥çœ‹ CoreDNS Helm Chartã€‚
$ helm install --name coredns --namespace=kube-system stable/corednsæŸ¥çœ‹ coredns çš„ Podï¼Œç¡®è®¤æ‰€æœ‰ Pod éƒ½å¤„äº Running çŠ¶æ€ï¼š
kubectl get pods -n kube-system -l k8s-app=kube-dnsNAME READY STATUS RESTARTS AGEcoredns-699477c54d-9fsl2 1/1 Running 0 5mcoredns-699477c54d-d6tb2 1/1 Running 0 5mcoredns-699477c54d-qh54v 1/1 Running 0 5mcoredns-699477c54d-vvqj9 1/1 Running 0 5mcoredns-699477c54d-xcv8h 1/1 Running 0 6mæµ‹è¯•ä¸€ä¸‹ DNS åŠŸèƒ½æ˜¯å¦å¥½ç”¨ï¼š">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/kubernetes%e5%ae%9e%e8%b7%b5%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97/">Kuberneteså®è·µå…¥é—¨æŒ‡å—</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/00-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E4%BB%AC%E8%A6%81%E5%AD%A6%E4%B9%A0-kubernetes-%E6%8A%80%E6%9C%AF/">00 ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å­¦ä¹  Kubernetes æŠ€æœ¯</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/01-%E9%87%8D%E6%96%B0%E8%AE%A4%E8%AF%86-kubernetes-%E7%9A%84%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6/">01 é‡æ–°è®¤è¯† Kubernetes çš„æ ¸å¿ƒç»„ä»¶</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/02-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-kubernets-%E7%9A%84%E7%BC%96%E6%8E%92%E5%AF%B9%E8%B1%A1/">02 æ·±å…¥ç†è§£ Kubernets çš„ç¼–æ’å¯¹è±¡</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/03-devops-%E5%9C%BA%E6%99%AF%E4%B8%8B%E8%90%BD%E5%9C%B0-k8s-%E7%9A%84%E5%9B%B0%E9%9A%BE%E5%88%86%E6%9E%90/">03 DevOps åœºæ™¯ä¸‹è½åœ° K8s çš„å›°éš¾åˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/04-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E4%B8%8B%E8%90%BD%E5%9C%B0-k8s-%E7%9A%84%E5%9B%B0%E9%9A%BE%E5%88%86%E6%9E%90/">04 å¾®æœåŠ¡åº”ç”¨åœºæ™¯ä¸‹è½åœ° K8s çš„å›°éš¾åˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/05-%E8%A7%A3%E5%86%B3-k8s-%E8%90%BD%E5%9C%B0%E9%9A%BE%E9%A2%98%E7%9A%84%E6%96%B9%E6%B3%95%E8%AE%BA%E6%8F%90%E7%82%BC/">05 è§£å†³ K8s è½åœ°éš¾é¢˜çš„æ–¹æ³•è®ºæç‚¼</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/06-%E7%BB%83%E4%B9%A0%E7%AF%87k8s-%E6%A0%B8%E5%BF%83%E5%AE%9E%E8%B7%B5%E7%9F%A5%E8%AF%86%E6%8E%8C%E6%8F%A1/">06 ç»ƒä¹ ç¯‡ï¼šK8s æ ¸å¿ƒå®è·µçŸ¥è¯†æŒæ¡</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/07-%E5%AE%B9%E5%99%A8%E5%BC%95%E6%93%8E-containerd-%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">07 å®¹å™¨å¼•æ“ containerd è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/08-k8s-%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E5%B7%A5%E5%85%B7-kubeadm-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">08 K8s é›†ç¾¤å®‰è£…å·¥å…· kubeadm çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/09-%E5%8D%97%E5%8C%97%E5%90%91%E6%B5%81%E9%87%8F%E7%BB%84%E4%BB%B6-ipvs-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">09 å—åŒ—å‘æµé‡ç»„ä»¶ IPVS çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/10-%E4%B8%9C%E8%A5%BF%E5%90%91%E6%B5%81%E9%87%8F%E7%BB%84%E4%BB%B6-calico-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">10 ä¸œè¥¿å‘æµé‡ç»„ä»¶ Calico çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li>11 æœåŠ¡å‘ç° DNS çš„è½åœ°å®è·µ</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/12-%E7%BB%83%E4%B9%A0%E7%AF%87k8s-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E6%B5%8B%E9%AA%8C/">12 ç»ƒä¹ ç¯‡ï¼šK8s é›†ç¾¤é…ç½®æµ‹éªŒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/13-%E7%90%86%E8%A7%A3%E5%AF%B9%E6%96%B9%E6%9A%B4%E9%9C%B2%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%AF%B9%E8%B1%A1-ingress-%E5%92%8C-service/">13 ç†è§£å¯¹æ–¹æš´éœ²æœåŠ¡çš„å¯¹è±¡ Ingress å’Œ Service</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/14-%E5%BA%94%E7%94%A8%E7%BD%91%E5%85%B3-openresty-%E5%AF%B9%E6%8E%A5-k8s-%E5%AE%9E%E8%B7%B5/">14 åº”ç”¨ç½‘å…³ OpenResty å¯¹æ¥ K8s å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/15-service-%E5%B1%82%E5%BC%95%E6%B5%81%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/">15 Service å±‚å¼•æµæŠ€æœ¯å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/16-cilium-%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">16 Cilium å®¹å™¨ç½‘ç»œçš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/17-%E5%BA%94%E7%94%A8%E6%B5%81%E9%87%8F%E7%9A%84%E4%BC%98%E9%9B%85%E6%97%A0%E6%8D%9F%E5%88%87%E6%8D%A2%E5%AE%9E%E8%B7%B5/">17 åº”ç”¨æµé‡çš„ä¼˜é›…æ— æŸåˆ‡æ¢å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/18-%E7%BB%83%E4%B9%A0%E7%AF%87%E5%BA%94%E7%94%A8%E6%B5%81%E9%87%8F%E6%97%A0%E6%8D%9F%E5%88%87%E6%8D%A2%E6%8A%80%E6%9C%AF%E6%B5%8B%E9%AA%8C/">18 ç»ƒä¹ ç¯‡ï¼šåº”ç”¨æµé‡æ— æŸåˆ‡æ¢æŠ€æœ¯æµ‹éªŒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/19-%E4%BD%BF%E7%94%A8-rook-%E6%9E%84%E5%BB%BA%E7%94%9F%E4%BA%A7%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E7%8E%AF%E5%A2%83%E5%AE%9E%E8%B7%B5/">19 ä½¿ç”¨ Rook æ„å»ºç”Ÿäº§å¯ç”¨å­˜å‚¨ç¯å¢ƒå®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/20-%E6%9C%89%E7%8A%B6%E6%80%81%E5%BA%94%E7%94%A8%E7%9A%84%E9%BB%98%E8%AE%A4%E7%89%B9%E6%80%A7%E8%90%BD%E5%9C%B0%E5%88%86%E6%9E%90/">20 æœ‰çŠ¶æ€åº”ç”¨çš„é»˜è®¤ç‰¹æ€§è½åœ°åˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/21-%E6%A1%88%E4%BE%8B%E5%88%86%E5%B8%83%E5%BC%8F-mysql-%E9%9B%86%E7%BE%A4%E5%B7%A5%E5%85%B7-vitess-%E5%AE%9E%E8%B7%B5%E5%88%86%E6%9E%90/">21 æ¡ˆä¾‹ï¼šåˆ†å¸ƒå¼ MySQL é›†ç¾¤å·¥å…· Vitess å®è·µåˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/22-%E5%AD%98%E5%82%A8%E5%AF%B9%E8%B1%A1-pvpvcstorage-classes-%E7%9A%84%E7%AE%A1%E7%90%86%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">22 å­˜å‚¨å¯¹è±¡ PVã€PVCã€Storage Classes çš„ç®¡ç†è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/23-k8s-%E9%9B%86%E7%BE%A4%E4%B8%AD%E5%AD%98%E5%82%A8%E5%AF%B9%E8%B1%A1%E7%81%BE%E5%A4%87%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">23 K8s é›†ç¾¤ä¸­å­˜å‚¨å¯¹è±¡ç¾å¤‡çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/24-%E7%BB%83%E4%B9%A0%E7%AF%87k8s-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E6%B5%8B%E9%AA%8C/">24 ç»ƒä¹ ç¯‡ï¼šK8s é›†ç¾¤é…ç½®æµ‹éªŒ</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">11 æœåŠ¡å‘ç° DNS çš„è½åœ°å®è·µ</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2021-12-22 01:48:17</span>ğŸ·ï¸&nbsp;<a class="post-tag" href="/tags/kubernetes/">kubernetes</a></div><div class="post-category">
                
                ğŸ“š&nbsp;<a href="/categories/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/">Kuberneteså®è·µå…¥é—¨æŒ‡å—</a>
                
            </div></div>
        <div class="post-content">
            <p>DNS æœåŠ¡æ˜¯ Kubernetes å†…ç½®çš„æœåŠ¡å‘ç°ç»„ä»¶ï¼Œå®ƒæ–¹ä¾¿å®¹å™¨æœåŠ¡å¯ä»¥é€šè¿‡å‘å¸ƒçš„å”¯ä¸€ App åå­—æ‰¾åˆ°å¯¹æ–¹çš„ç«¯å£æœåŠ¡ï¼Œå†ä¹Ÿä¸éœ€è¦ç»´æŠ¤æœåŠ¡å¯¹åº”çš„ IP å…³ç³»ã€‚è¿™ä¸ªå¯¹ä¼ ç»Ÿä¼ä¸šå†…éƒ¨çš„è¿ç»´ä¹ æƒ¯ä¹Ÿæ˜¯æœ‰ä¸€äº›å˜é©çš„ã€‚ä¸€èˆ¬ä¼ ç»Ÿä¼ä¸šå†…éƒ¨éƒ½ä¼šç»´æŠ¤ä¸€å¥— CMDB ç³»ç»Ÿï¼Œä¸“é—¨æ¥ç»´æŠ¤æœåŠ¡å™¨å’Œ IP åœ°å€çš„å¯¹åº”å…³ç³»ï¼Œæ–¹ä¾¿è§„åˆ’ç®¡ç†å¥½åº”ç”¨æœåŠ¡é›†ç¾¤ã€‚å½“è½åœ° K8s é›†ç¾¤ä¹‹åï¼Œå› ä¸ºåº”ç”¨å®¹å™¨çš„ IP ç”Ÿå‘½å‘¨æœŸçŸ­æš‚ï¼Œé€šè¿‡ App åå­—æ¥è¯†åˆ«æœåŠ¡å…¶å®å¯¹è¿ç»´å’Œå¼€å‘éƒ½ä¼šæ›´æ–¹ä¾¿ã€‚æ‰€ä»¥æœ¬ç¯‡å°±æ˜¯ç»“åˆå®é™…çš„éœ€æ±‚åœºæ™¯ç»™å¤§å®¶è¯¦ç»†ä»‹ç» DNS çš„ä½¿ç”¨å®è·µã€‚</p>
<h3 id="coredns-ä»‹ç»">CoreDNS ä»‹ç»</h3>
<p>Kubernetes æ—©æœŸçš„ DNS ç»„ä»¶å« KubeDNSã€‚CNCF ç¤¾åŒºåæ¥å¼•å…¥äº†æ›´åŠ æˆç†Ÿçš„å¼€æºé¡¹ç›® CoreDNS æ›¿æ¢äº† KubeDNSã€‚æ‰€ä»¥æˆ‘ä»¬ç°åœ¨æåˆ° KubeDNSï¼Œå…¶å®é»˜è®¤æŒ‡ä»£çš„æ˜¯ CoreDNS é¡¹ç›®ã€‚åœ¨ Kubernetes ä¸­éƒ¨ç½² CoreDNS ä½œä¸ºé›†ç¾¤å†…çš„ DNS æœåŠ¡æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œä¾‹å¦‚å¯ä»¥ä½¿ç”¨å®˜æ–¹ Helm Chart åº“ä¸­çš„ Helm Chart éƒ¨ç½²ï¼Œå…·ä½“å¯æŸ¥çœ‹ <a href="https://github.com/helm/charts/tree/master/stable/coredns">CoreDNS Helm Chart</a>ã€‚</p>
<pre tabindex="0"><code>$ helm install --name coredns --namespace=kube-system stable/coredns

</code></pre><p>æŸ¥çœ‹ coredns çš„ Podï¼Œç¡®è®¤æ‰€æœ‰ Pod éƒ½å¤„äº Running çŠ¶æ€ï¼š</p>
<pre tabindex="0"><code>kubectl get pods -n kube-system -l k8s-app=kube-dns
NAME                       READY     STATUS    RESTARTS   AGE
coredns-699477c54d-9fsl2   1/1       Running   0          5m
coredns-699477c54d-d6tb2   1/1       Running   0          5m
coredns-699477c54d-qh54v   1/1       Running   0          5m
coredns-699477c54d-vvqj9   1/1       Running   0          5m
coredns-699477c54d-xcv8h   1/1       Running   0          6m

</code></pre><p>æµ‹è¯•ä¸€ä¸‹ DNS åŠŸèƒ½æ˜¯å¦å¥½ç”¨ï¼š</p>
<pre tabindex="0"><code>kubectl run curl --image=radial/busyboxplus:curl -i --tty

nslookup kubernetes.default
Server:    10.96.0.10
Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local

Name:      kubernetes
Address 1: 10.96.0.1 kubernetes.default.svc.cluster.local

</code></pre><h3 id="æœåŠ¡å‘ç°è§„åˆ™">æœåŠ¡å‘ç°è§„åˆ™</h3>
<p>DNS æ”¯æŒçš„æœåŠ¡å‘ç°æ˜¯æ”¯æŒ Service å’Œ Pod çš„ã€‚å®ƒçš„è§„åˆ™å¦‚ä¸‹ã€‚</p>
<h4 id="services"><strong>Services</strong></h4>
<p>A è®°å½•ï¼š</p>
<ul>
<li>Serviceï¼ˆheadless Service é™¤å¤–ï¼‰å°†è¢«åˆ†é…ä¸€ä¸ª DNS A è®°å½•ï¼Œæ ¼å¼ä¸º my-svc.my-namespace.svc.cluster.localã€‚è¯¥ DNS è®°å½•è§£æåˆ° Service çš„ ClusterIPã€‚</li>
<li>Headless Serviceï¼ˆæ²¡æœ‰ ClusterIPï¼‰ä¹Ÿå°†è¢«åˆ†é…ä¸€ä¸ª DNS A è®°å½•ï¼Œæ ¼å¼ä¸º my-svc.my-namespace.svc.cluster.localã€‚è¯¥ DNS è®°å½•è§£æåˆ° Service æ‰€é€‰ä¸­çš„ä¸€ç»„ Pod çš„ IP åœ°å€çš„é›†åˆã€‚è°ƒç”¨è€…åº”è¯¥ä½¿ç”¨è¯¥ IP åœ°å€é›†åˆï¼Œæˆ–è€…æŒ‰ç…§è½®è¯¢ï¼ˆround-robinï¼‰çš„æ–¹å¼ä»é›†åˆä¸­é€‰æ‹©ä¸€ä¸ª IP åœ°å€ä½¿ç”¨ã€‚</li>
</ul>
<p>SRV è®°å½•ï¼šServiceï¼ˆå« headless Serviceï¼‰çš„å‘½åç«¯å£ï¼ˆæœ‰ name çš„ç«¯å£ï¼‰å°†è¢«åˆ†é…ä¸€ä¸ª SRV è®°å½•ï¼Œå…¶æ ¼å¼ä¸º _my-port-name._my-port-protocol.my-svc.my-namespace.svc.cluster.localã€‚</p>
<ul>
<li>å¯¹äºä¸€ä¸ªæ™®é€š Serviceï¼ˆé headless Serviceï¼‰ï¼Œè¯¥ SRV è®°å½•è§£æåˆ°å…¶ç«¯å£å·å’ŒåŸŸå my-svc.my-namespace.svc.cluster.localã€‚</li>
<li>å¯¹äºä¸€ä¸ª Headless Serviceï¼Œè¯¥ SRV è®°å½•è§£æåˆ°å¤šä¸ªç»“æœï¼šæ¯ä¸€ä¸ªç»“æœéƒ½å¯¹åº”è¯¥ Service çš„ä¸€ä¸ªåç«¯ Podï¼ŒåŒ…å«å…¶ç«¯å£å·å’Œ Pod çš„åŸŸå auto-generated-pod-name.my-svc.my-namespace.svc.cluster.localã€‚</li>
</ul>
<h4 id="pods"><strong>Pods</strong></h4>
<p>Kubernetes åœ¨åˆ›å»º Pod æ—¶ï¼Œå°† Pod å®šä¹‰ä¸­çš„ metadata.name çš„å€¼ä½œä¸º Pod å®ä¾‹çš„ hostnameã€‚</p>
<ul>
<li>Pod å®šä¹‰ä¸­æœ‰ä¸€ä¸ªå¯é€‰å­—æ®µ spec.hostname å¯ç”¨æ¥ç›´æ¥æŒ‡å®š Pod çš„ hostnameã€‚ä¾‹å¦‚ï¼ŒæŸ Pod çš„ spec.hostname å­—æ®µè¢«è®¾ç½®ä¸º my-hostï¼Œåˆ™è¯¥ Pod åˆ›å»ºå hostname å°†è¢«è®¾ä¸º my-hostã€‚</li>
<li>Pod å®šä¹‰ä¸­è¿˜æœ‰ä¸€ä¸ªå¯é€‰å­—æ®µ spec.subdomain å¯ç”¨æ¥æŒ‡å®š Pod çš„ subdomainã€‚ä¾‹å¦‚ï¼Œåç§°ç©ºé—´ my-namespace ä¸­ï¼ŒæŸ Pod çš„ hostname ä¸º fooï¼Œå¹¶ä¸” subdomain ä¸º barï¼Œåˆ™è¯¥ Pod çš„å®Œæ•´åŸŸåï¼ˆFQDNï¼‰ä¸º foo.bar.my-namespace.svc.cluster.localã€‚</li>
</ul>
<p>å¤‡æ³¨ï¼šA è®°å½•ä¸æ˜¯æ ¹æ® Pod name åˆ›å»ºçš„ï¼Œè€Œæ˜¯æ ¹æ® hostname åˆ›å»ºçš„ã€‚å¦‚æœä¸€ä¸ª Pod æ²¡æœ‰ hostname åªæœ‰ subdomainï¼Œåˆ™ Kubernetes å°†åªä¸ºå…¶ headless Service åˆ›å»ºä¸€ä¸ª A è®°å½• default-subdomain.my-namespace.svc.cluster-domain.exampleï¼Œè¯¥è®°å½•æŒ‡å‘ Pod çš„ IP åœ°å€ã€‚</p>
<h3 id="dns-ä¼˜åŒ–">DNS ä¼˜åŒ–</h3>
<p>ç¤¾åŒºæ ¹æ®å‹æµ‹æ•°æ®ï¼Œå¯¹ CoreDNS éœ€è¦çš„å†…å­˜æä¾›äº†ä¸€ä¸ªè®¡ç®—å…¬å¼ï¼š</p>
<pre tabindex="0"><code>MB required (default settings) = (Pods + Services) / 1000 + 54

</code></pre><p>æ³¨è§£ï¼š</p>
<ul>
<li>30 MB ç•™ç»™ç¼“å­˜ï¼Œé»˜è®¤ç¼“å­˜å¤§å°ä¸º 1 ä¸‡æ¡è®°å½•ã€‚</li>
<li>5 MB ç•™ç»™åº”ç”¨æŸ¥è¯¢æ“ä½œä½¿ç”¨ï¼Œé»˜è®¤å‹æµ‹å•ä¾‹ CoreDNS æ”¯æŒå¤§çº¦ 30K QPSã€‚</li>
</ul>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Kubernetes%20%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/assets/aaddf7c0-e123-11ea-9254-2dbb61d9b3dd.jpg" alt="kubedns-perf"></p>
<h3 id="é›†æˆå¤–éƒ¨-dns-æœåŠ¡">é›†æˆå¤–éƒ¨ DNS æœåŠ¡</h3>
<p>æˆ‘ä»¬åœ¨ä½¿ç”¨ Kubernetes çš„åœºæ™¯ä¸­ï¼Œä¼ä¸šç»å¸¸å·²ç»é»˜è®¤æœ‰äº†è‡ªå·±çš„ DNS æœåŠ¡ï¼Œåœ¨éƒ¨ç½²å®¹å™¨é›†ç¾¤çš„æ—¶å€™ï¼Œè‚¯å®šæœŸæœ›å’Œå¤–ç½®çš„ DNS æœåŠ¡åšä¸€äº›é›†æˆï¼Œæ–¹ä¾¿ä¼ä¸šå†…éƒ¨çš„ä½¿ç”¨ã€‚</p>
<p>é»˜è®¤ DNS æŸ¥è¯¢ç­–ç•¥æ˜¯ ClusterFirstï¼Œä¹Ÿå°±æ˜¯æŸ¥è¯¢åº”ç”¨åå­—é¦–å…ˆæ˜¯è®©é›†ç¾¤å†…éƒ¨çš„ CoreDNS æä¾›åå­—æœåŠ¡ã€‚è€Œæˆ‘ä»¬éœ€è¦è§£å†³çš„æ˜¯è®©æŒ‡å®šçš„åˆ«åè®¿é—®å¤–éƒ¨çš„æœåŠ¡ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åšå¦‚ä¸‹é…ç½®ï¼š</p>
<pre tabindex="0"><code>apiVersion: v1

kind: ConfigMap

metadata:

  name: kube-dns

  namespace: kube-system

data:

  stubDomains: |

    {&quot;consul.local&quot;: [&quot;10.150.0.1&quot;]}

  upstreamNameservers: |

    [&quot;8.8.8.8&quot;, &quot;8.8.4.4&quot;]

</code></pre><p>ä¸Šé¢è¿™ä¸ªä¾‹å­å¾ˆå¥½çš„è§£é‡Šäº†å¤–ç½® Consul æœåŠ¡ï¼Œä¹Ÿå¯ä»¥å¾ˆå¥½åœ°é›†æˆåˆ° Kubernetes æœåŠ¡ä¸­ã€‚å¦‚æœæ˜¯æ­£å¼çš„åŸŸåï¼Œç›´æ¥è½¬å‘æŸ¥è¯¢ 8.8.8.8 ä¸Šæ¸¸ DNS æœåŠ¡å™¨äº†ã€‚</p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>CoreDNS æ˜¯ Kubernetes é›†ç¾¤ä¸­æœ€æ ¸å¿ƒï¼Œä¹Ÿæ˜¯æœ€å®¹æ˜“ç†è§£çš„ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒçš„åŠŸèƒ½å•ä¸€ï¼Œå¾ˆå®¹æ˜“ä¸Šæ‰‹ã€‚ä½†æ˜¯åå­—è§£æçš„è§„åˆ™è¿˜æ˜¯éœ€è¦å¤§å®¶ç†Ÿæ‚‰ï¼Œé¿å…ä¸€äº›ä¸å¿…è¦çš„è®¤çŸ¥é”™è¯¯ã€‚</p>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://github.com/coredns/deployment/blob/master/kubernetes/Scaling_CoreDNS.md">https://github.com/coredns/deployment/blob/master/kubernetes/Scaling_CoreDNS.md</a></li>
<li><a href="https://kuboard.cn/learning/k8s-intermediate/service/dns.html">https://kuboard.cn/learning/k8s-intermediate/service/dns.html</a></li>
</ul>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/10-%E4%B8%9C%E8%A5%BF%E5%90%91%E6%B5%81%E9%87%8F%E7%BB%84%E4%BB%B6-calico-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/"><span>10 ä¸œè¥¿å‘æµé‡ç»„ä»¶ Calico çš„è½åœ°å®è·µ</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/12-%E7%BB%83%E4%B9%A0%E7%AF%87k8s-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E6%B5%8B%E9%AA%8C/"><span>12 ç»ƒä¹ ç¯‡ï¼šK8s é›†ç¾¤é…ç½®æµ‹éªŒ</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 28280 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>