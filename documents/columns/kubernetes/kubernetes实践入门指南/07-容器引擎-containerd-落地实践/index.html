<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>07 å®¹å™¨å¼•æ“ containerd è½åœ°å®è·µ | Yipsen Ye</title>
<meta name="description" content="Docker å…¬å¸ä» 2013 å¹´å‘å¸ƒå®¹å™¨å¼•æ“ Docker åï¼Œå°±è¢«å…¨çƒå¼€å‘è€…ä½¿ç”¨å¹¶ä¸æ–­æ”¹è¿›å®ƒçš„åŠŸèƒ½ã€‚éšç€å®¹å™¨æ ‡å‡†çš„å»ºç«‹ï¼ŒDocker å¼•æ“æ¶æ„ä¹Ÿä»å•ä½“èµ°å‘å¾®æœåŠ¡ç»“æ„ï¼Œå‰¥ç¦»å‡º dontainerd å¼•æ“ã€‚å®ƒåœ¨æ•´ä¸ªå®¹å™¨æŠ€æœ¯æ¶æ„ä¸­çš„ä½ç½®å¦‚ä¸‹ï¼š
å›¾ 6-1 containerd æ¶æ„å›¾ï¼Œç‰ˆæƒæºè‡ª https://containerd.io/
containerd ä½¿ç”¨åˆä½“éªŒ ä»å®˜æ–¹ä»“åº“å¯ä»¥ä¸‹è½½æœ€æ–°çš„ containerd å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå› ä¸ºä¾èµ– runcï¼Œæ‰€ä»¥éœ€è¦ä¸€å¹¶ä¸‹è½½æ‰èƒ½æ­£å¸¸ä½¿ç”¨ï¼š
# ä¸‹è½½ containerd äºŒè¿›åˆ¶æ–‡ä»¶wget -q --show-progress --https-only --timestamping \https://github.com/opencontainers/runc/releases/download/v1.0.0-rc10/runc.amd64 \https://github.com/containerd/containerd/releases/download/v1.3.4/containerd-1.3.4.linux-amd64.tar.gz \https://github.com/kubernetes-sigs/cri-tools/releases/download/v1.18.0/crictl-v1.18.0-linux-amd64.tar.gzsudo mv runc.amd64 runc# å®‰è£…äºŒè¿›åˆ¶æ–‡ä»¶tar -xvf crictl-v1.18.0-linux-amd64.tar.gzchmod &#43;x crictl runcsudo cp crictl runc /usr/local/bin/mkdir containerdtar -xvf containerd-1.3.4.linux-amd64.tar.gz -C containerdsudo cp containerd/bin/* /bin/containerd æä¾›äº†é»˜è®¤çš„é…ç½®æ–‡ä»¶ config.tomlï¼Œé»˜è®¤æ”¾åœ¨ /etc/containerd/config.tomlï¼š
[plugins][plugins.cri.containerd]snapshotter = &amp;quot;overlayfs&amp;quot;[plugins.">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/kubernetes%e5%ae%9e%e8%b7%b5%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97/">Kuberneteså®è·µå…¥é—¨æŒ‡å—</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/00-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E4%BB%AC%E8%A6%81%E5%AD%A6%E4%B9%A0-kubernetes-%E6%8A%80%E6%9C%AF/">00 ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å­¦ä¹  Kubernetes æŠ€æœ¯</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/01-%E9%87%8D%E6%96%B0%E8%AE%A4%E8%AF%86-kubernetes-%E7%9A%84%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6/">01 é‡æ–°è®¤è¯† Kubernetes çš„æ ¸å¿ƒç»„ä»¶</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/02-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-kubernets-%E7%9A%84%E7%BC%96%E6%8E%92%E5%AF%B9%E8%B1%A1/">02 æ·±å…¥ç†è§£ Kubernets çš„ç¼–æ’å¯¹è±¡</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/03-devops-%E5%9C%BA%E6%99%AF%E4%B8%8B%E8%90%BD%E5%9C%B0-k8s-%E7%9A%84%E5%9B%B0%E9%9A%BE%E5%88%86%E6%9E%90/">03 DevOps åœºæ™¯ä¸‹è½åœ° K8s çš„å›°éš¾åˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/04-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E4%B8%8B%E8%90%BD%E5%9C%B0-k8s-%E7%9A%84%E5%9B%B0%E9%9A%BE%E5%88%86%E6%9E%90/">04 å¾®æœåŠ¡åº”ç”¨åœºæ™¯ä¸‹è½åœ° K8s çš„å›°éš¾åˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/05-%E8%A7%A3%E5%86%B3-k8s-%E8%90%BD%E5%9C%B0%E9%9A%BE%E9%A2%98%E7%9A%84%E6%96%B9%E6%B3%95%E8%AE%BA%E6%8F%90%E7%82%BC/">05 è§£å†³ K8s è½åœ°éš¾é¢˜çš„æ–¹æ³•è®ºæç‚¼</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/06-%E7%BB%83%E4%B9%A0%E7%AF%87k8s-%E6%A0%B8%E5%BF%83%E5%AE%9E%E8%B7%B5%E7%9F%A5%E8%AF%86%E6%8E%8C%E6%8F%A1/">06 ç»ƒä¹ ç¯‡ï¼šK8s æ ¸å¿ƒå®è·µçŸ¥è¯†æŒæ¡</a></li>
                
                
                
                    <li>07 å®¹å™¨å¼•æ“ containerd è½åœ°å®è·µ</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/08-k8s-%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E5%B7%A5%E5%85%B7-kubeadm-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">08 K8s é›†ç¾¤å®‰è£…å·¥å…· kubeadm çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/09-%E5%8D%97%E5%8C%97%E5%90%91%E6%B5%81%E9%87%8F%E7%BB%84%E4%BB%B6-ipvs-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">09 å—åŒ—å‘æµé‡ç»„ä»¶ IPVS çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/10-%E4%B8%9C%E8%A5%BF%E5%90%91%E6%B5%81%E9%87%8F%E7%BB%84%E4%BB%B6-calico-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">10 ä¸œè¥¿å‘æµé‡ç»„ä»¶ Calico çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/11-%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0-dns-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">11 æœåŠ¡å‘ç° DNS çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/12-%E7%BB%83%E4%B9%A0%E7%AF%87k8s-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E6%B5%8B%E9%AA%8C/">12 ç»ƒä¹ ç¯‡ï¼šK8s é›†ç¾¤é…ç½®æµ‹éªŒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/13-%E7%90%86%E8%A7%A3%E5%AF%B9%E6%96%B9%E6%9A%B4%E9%9C%B2%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%AF%B9%E8%B1%A1-ingress-%E5%92%8C-service/">13 ç†è§£å¯¹æ–¹æš´éœ²æœåŠ¡çš„å¯¹è±¡ Ingress å’Œ Service</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/14-%E5%BA%94%E7%94%A8%E7%BD%91%E5%85%B3-openresty-%E5%AF%B9%E6%8E%A5-k8s-%E5%AE%9E%E8%B7%B5/">14 åº”ç”¨ç½‘å…³ OpenResty å¯¹æ¥ K8s å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/15-service-%E5%B1%82%E5%BC%95%E6%B5%81%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/">15 Service å±‚å¼•æµæŠ€æœ¯å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/16-cilium-%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">16 Cilium å®¹å™¨ç½‘ç»œçš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/17-%E5%BA%94%E7%94%A8%E6%B5%81%E9%87%8F%E7%9A%84%E4%BC%98%E9%9B%85%E6%97%A0%E6%8D%9F%E5%88%87%E6%8D%A2%E5%AE%9E%E8%B7%B5/">17 åº”ç”¨æµé‡çš„ä¼˜é›…æ— æŸåˆ‡æ¢å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/18-%E7%BB%83%E4%B9%A0%E7%AF%87%E5%BA%94%E7%94%A8%E6%B5%81%E9%87%8F%E6%97%A0%E6%8D%9F%E5%88%87%E6%8D%A2%E6%8A%80%E6%9C%AF%E6%B5%8B%E9%AA%8C/">18 ç»ƒä¹ ç¯‡ï¼šåº”ç”¨æµé‡æ— æŸåˆ‡æ¢æŠ€æœ¯æµ‹éªŒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/19-%E4%BD%BF%E7%94%A8-rook-%E6%9E%84%E5%BB%BA%E7%94%9F%E4%BA%A7%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E7%8E%AF%E5%A2%83%E5%AE%9E%E8%B7%B5/">19 ä½¿ç”¨ Rook æ„å»ºç”Ÿäº§å¯ç”¨å­˜å‚¨ç¯å¢ƒå®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/20-%E6%9C%89%E7%8A%B6%E6%80%81%E5%BA%94%E7%94%A8%E7%9A%84%E9%BB%98%E8%AE%A4%E7%89%B9%E6%80%A7%E8%90%BD%E5%9C%B0%E5%88%86%E6%9E%90/">20 æœ‰çŠ¶æ€åº”ç”¨çš„é»˜è®¤ç‰¹æ€§è½åœ°åˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/21-%E6%A1%88%E4%BE%8B%E5%88%86%E5%B8%83%E5%BC%8F-mysql-%E9%9B%86%E7%BE%A4%E5%B7%A5%E5%85%B7-vitess-%E5%AE%9E%E8%B7%B5%E5%88%86%E6%9E%90/">21 æ¡ˆä¾‹ï¼šåˆ†å¸ƒå¼ MySQL é›†ç¾¤å·¥å…· Vitess å®è·µåˆ†æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/22-%E5%AD%98%E5%82%A8%E5%AF%B9%E8%B1%A1-pvpvcstorage-classes-%E7%9A%84%E7%AE%A1%E7%90%86%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">22 å­˜å‚¨å¯¹è±¡ PVã€PVCã€Storage Classes çš„ç®¡ç†è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/23-k8s-%E9%9B%86%E7%BE%A4%E4%B8%AD%E5%AD%98%E5%82%A8%E5%AF%B9%E8%B1%A1%E7%81%BE%E5%A4%87%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">23 K8s é›†ç¾¤ä¸­å­˜å‚¨å¯¹è±¡ç¾å¤‡çš„è½åœ°å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/24-%E7%BB%83%E4%B9%A0%E7%AF%87k8s-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E6%B5%8B%E9%AA%8C/">24 ç»ƒä¹ ç¯‡ï¼šK8s é›†ç¾¤é…ç½®æµ‹éªŒ</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">07 å®¹å™¨å¼•æ“ containerd è½åœ°å®è·µ</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2021-12-22 01:48:13</span>ğŸ·ï¸&nbsp;<a class="post-tag" href="/tags/kubernetes/">kubernetes</a></div><div class="post-category">
                
                ğŸ“š&nbsp;<a href="/categories/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/">Kuberneteså®è·µå…¥é—¨æŒ‡å—</a>
                
            </div></div>
        <div class="post-content">
            <p>Docker å…¬å¸ä» 2013 å¹´å‘å¸ƒå®¹å™¨å¼•æ“ Docker åï¼Œå°±è¢«å…¨çƒå¼€å‘è€…ä½¿ç”¨å¹¶ä¸æ–­æ”¹è¿›å®ƒçš„åŠŸèƒ½ã€‚éšç€å®¹å™¨æ ‡å‡†çš„å»ºç«‹ï¼ŒDocker å¼•æ“æ¶æ„ä¹Ÿä»å•ä½“èµ°å‘å¾®æœåŠ¡ç»“æ„ï¼Œå‰¥ç¦»å‡º dontainerd å¼•æ“ã€‚å®ƒåœ¨æ•´ä¸ªå®¹å™¨æŠ€æœ¯æ¶æ„ä¸­çš„ä½ç½®å¦‚ä¸‹ï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Kubernetes%20%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/assets/62045630-d65f-11ea-b558-cd3c105f83ae.jpg" alt="containerd-arch"></p>
<p>å›¾ 6-1 containerd æ¶æ„å›¾ï¼Œç‰ˆæƒæºè‡ª <a href="https://containerd.io/">https://containerd.io/</a></p>
<h3 id="containerd-ä½¿ç”¨åˆä½“éªŒ">containerd ä½¿ç”¨åˆä½“éªŒ</h3>
<p>ä»å®˜æ–¹ä»“åº“å¯ä»¥ä¸‹è½½æœ€æ–°çš„ containerd å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå› ä¸ºä¾èµ– runcï¼Œæ‰€ä»¥éœ€è¦ä¸€å¹¶ä¸‹è½½æ‰èƒ½æ­£å¸¸ä½¿ç”¨ï¼š</p>
<pre tabindex="0"><code># ä¸‹è½½ containerd äºŒè¿›åˆ¶æ–‡ä»¶
wget -q --show-progress --https-only --timestamping \
  https://github.com/opencontainers/runc/releases/download/v1.0.0-rc10/runc.amd64 \
  https://github.com/containerd/containerd/releases/download/v1.3.4/containerd-1.3.4.linux-amd64.tar.gz \
  https://github.com/kubernetes-sigs/cri-tools/releases/download/v1.18.0/crictl-v1.18.0-linux-amd64.tar.gz
sudo mv runc.amd64 runc

# å®‰è£…äºŒè¿›åˆ¶æ–‡ä»¶
tar -xvf crictl-v1.18.0-linux-amd64.tar.gz
chmod +x crictl runc
sudo cp crictl runc /usr/local/bin/
mkdir containerd
tar -xvf containerd-1.3.4.linux-amd64.tar.gz -C containerd
sudo cp containerd/bin/* /bin/

</code></pre><p>containerd æä¾›äº†é»˜è®¤çš„é…ç½®æ–‡ä»¶ config.tomlï¼Œé»˜è®¤æ”¾åœ¨ /etc/containerd/config.tomlï¼š</p>
<pre tabindex="0"><code>[plugins]
  [plugins.cri.containerd]
    snapshotter = &quot;overlayfs&quot;
    [plugins.cri.containerd.default_runtime]
      runtime_type = &quot;io.containerd.runtime.v1.linux&quot;
      runtime_engine = &quot;/usr/local/bin/runc&quot;
      runtime_root = &quot;&quot;

</code></pre><p>containerd æœåŠ¡ä¸€èˆ¬é‡‡ç”¨åå°å®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œï¼Œåœ¨ Linux ä¸­ä½¿ç”¨ systemd è¿è¡Œï¼š</p>
<pre tabindex="0"><code># é…ç½® containerd.service
sudo cat &lt;&lt;EOF | sudo tee /etc/systemd/system/containerd.service
[Unit]
Description=containerd container runtime
Documentation=https://containerd.io
After=network.target
[Service]
ExecStartPre=/sbin/modprobe overlay
ExecStart=/bin/containerd
Restart=always
RestartSec=5
Delegate=yes
KillMode=process
OOMScoreAdjust=-999
LimitNOFILE=1048576
LimitNPROC=infinity
LimitCORE=infinity
[Install]
WantedBy=multi-user.target
EOF

#å¯åŠ¨
sudo systemctl daemon-reload
sudo systemctl enable containerd
sudo systemctl start containerd

#é…ç½® crictl å®¢æˆ·ç«¯
sudo crictl config runtime-endpoint unix:///var/run/containerd/containerd.sock

</code></pre><p>è‡³æ­¤ï¼Œcontainerd çš„ä½¿ç”¨æµç¨‹å°±ä½“éªŒå®Œæˆäº†ã€‚</p>
<h3 id="é€šè¿‡å®¢æˆ·ç«¯æ·±å…¥äº†è§£-containerd">é€šè¿‡å®¢æˆ·ç«¯æ·±å…¥äº†è§£ containerd</h3>
<p>containerd å¯åŠ¨åï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å®¢æˆ·ç«¯å‘½ä»¤è¡Œå·¥å…·æ¥äº†è§£ä¸‹å®¹å™¨è¿è¡Œçš„æƒ…å†µã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬æ‰‹ä¸Šæœ‰ 2 ä¸ªå·¥å…·å¯ä»¥ä½¿ç”¨ã€‚ä¸€ä¸ªæ˜¯ crictl è¿™ä¸ªæ˜¯ Kubernetes ç¤¾åŒºæä¾›çš„æ“ä½œå®¹å™¨æ¥å£æ ‡å‡†çš„å®¢æˆ·ç«¯å·¥å…·ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ ctr è¿™æ˜¯ containerd è‡ªå¸¦çš„å®¢æˆ·ç«¯å·¥å…·ï¼Œctr æ˜¯æµ‹è¯•ä½¿ç”¨çš„å·¥å…·ï¼Œåœ¨æ—¥å¸¸å·¥ä½œä¸­æ¨èä½¿ç”¨ crictl å·¥å…·æ¥ç®¡ç†å®¹å™¨ã€‚</p>
<p>ctr å·¥å…·è¿è¡Œå¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>   ctr - 
        __
  _____/ /______
 / ___/ __/ ___/
/ /__/ /_/ /
\___/\__/_/

containerd CLI

USAGE:
   ctr [global options] command [command options] [arguments...]

VERSION:
   v1.3.4

DESCRIPTION:
ctr is an unsupported debug and administrative client for interacting
with the containerd daemon. Because it is unsupported, the commands,
options, and operations are not guaranteed to be backward compatible or
stable from release to release of the containerd project.

COMMANDS:
   plugins, plugin            provides information about containerd plugins
   version                    print the client and server versions
   containers, c, container   manage containers
   content                    manage content
   events, event              display containerd events
   images, image, i           manage images
   leases                     manage leases
   namespaces, namespace, ns  manage namespaces
   pprof                      provide golang pprof outputs for containerd
   run                        run a container
   snapshots, snapshot        manage snapshots
   tasks, t, task             manage tasks
   install                    install a new package
   shim                       interact with a shim directly
   help, h                    Shows a list of commands or help for one command

GLOBAL OPTIONS:
   --debug                      enable debug output in logs
   --address value, -a value    address for containerd's GRPC server (default: &quot;/run/contai
nerd/containerd.sock&quot;)
   --timeout value              total timeout for ctr commands (default: 0s)
   --connect-timeout value      timeout for connecting to containerd (default: 0s)
   --namespace value, -n value  namespace to use with commands (default: &quot;default&quot;) [$CONTA
INERD_NAMESPACE]
   --help, -h                   show help
   --version, -v                print the version

</code></pre><p>crictl è¿è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>NAME:
   crictl - client for CRI

USAGE:
   crictl [global options] command [command options] [arguments...]

VERSION:
   v1.18.0

COMMANDS:
   attach              Attach to a running container
   create              Create a new container
   exec                Run a command in a running container
   version             Display runtime version information
   images, image, img  List images
   inspect             Display the status of one or more containers
   inspecti            Return the status of one or more images
   imagefsinfo         Return image filesystem info
   inspectp            Display the status of one or more pods
   logs                Fetch the logs of a container
   port-forward        Forward local port to a pod
   ps                  List containers
   pull                Pull an image from a registry
   run                 Run a new container inside a sandbox
   runp                Run a new pod
   rm                  Remove one or more containers
   rmi                 Remove one or more images
   rmp                 Remove one or more pods
   pods                List pods
   start               Start one or more created containers
   info                Display information of the container runtime
   stop                Stop one or more running containers
   stopp               Stop one or more running pods
   update              Update one or more running containers
   config              Get and set crictl options
   inspecti            Return the status of one or more images
   imagefsinfo         Return image filesystem info
   inspectp            Display the status of one or more pods
   logs                Fetch the logs of a container
   port-forward        Forward local port to a pod
   ps                  List containers
   pull                Pull an image from a registry
   run                 Run a new container inside a sandbox
   runp                Run a new pod
   rm                  Remove one or more containers
   rmi                 Remove one or more images
   rmp                 Remove one or more pods
   pods                List pods
   start               Start one or more created containers
   info                Display information of the container runtime
   stop                Stop one or more running containers
   stopp               Stop one or more running pods
   update              Update one or more running containers
   config              Get and set crictl options
   stats               List container(s) resource usage statistics
   completion          Output shell completion code
   help, h             Shows a list of commands or help for one command

GLOBAL OPTIONS:
   --config value, -c value            Location of the client config file. If not specified
 and the default does not exist, the program's directory is searched as well (default: &quot;/et
c/crictl.yaml&quot;) [$CRI_CONFIG_FILE]
   --debug, -D                         Enable debug mode (default: false)
   --image-endpoint value, -i value    Endpoint of CRI image manager service [$IMAGE_SERVIC
E_ENDPOINT]
   --runtime-endpoint value, -r value  Endpoint of CRI container runtime service (default: 
&quot;unix:///var/run/dockershim.sock&quot;) [$CONTAINER_RUNTIME_ENDPOINT]
   --timeout value, -t value           Timeout of connecting to the server (default: 2s)
   --help, -h                          show help (default: false)
   --version, -v                       print the version (default: false)

</code></pre><p>ä» 2 ä¸ªå‘½ä»¤å‚æ•°å¯¹æ¯”å‚ç…§å¯ä»¥å¾—çŸ¥ï¼Œcrictl çš„åŠŸèƒ½æ˜¯æ¯” ctr è¦ä¸°å¯Œå¾ˆå¤šçš„ã€‚ä¸ºäº†æ—¥å¸¸ä½¿ç”¨æ–¹ä¾¿ï¼Œè¿™é‡Œæˆ‘æŠŠ crictl å’Œ Docker å‘½ä»¤åšä¸€ä¸ªå¯¹æ¯”ï¼Œæ–¹ä¾¿å¤§å®¶å‚ç…§ä½¿ç”¨ï¼š</p>
<p>é•œåƒç›¸å…³åŠŸèƒ½</p>
<p>Docker</p>
<p>Containerd</p>
<p>æ˜¾ç¤ºæœ¬åœ°é•œåƒåˆ—è¡¨</p>
<p>docker images</p>
<p>crictl images</p>
<p>ä¸‹è½½é•œåƒ</p>
<p>docker pull</p>
<p>crictl pull</p>
<p>ä¸Šä¼ é•œåƒ</p>
<p>docker push</p>
<p>æ— </p>
<p>åˆ é™¤æœ¬åœ°é•œåƒ</p>
<p>docker rmi</p>
<p>crictl rmi</p>
<p>æŸ¥çœ‹é•œåƒè¯¦æƒ…</p>
<p>docker inspect IMAGE-ID</p>
<p>crictl inspecti IMAGE-ID</p>
<blockquote>
<p>æ³¨æ„ï¼šä¸Šä¼ é•œåƒåŠŸèƒ½å±äºå’Œé•œåƒä»“åº“æœåŠ¡çš„äº¤äº’ï¼Œcrictl æ²¡æœ‰æä¾›æ­¤åŠŸèƒ½å¯ä»¥å‡è½»ä¸å°‘ä»£ç é€»è¾‘è´Ÿæ‹…ã€‚</p>
</blockquote>
<p>å®¹å™¨ç›¸å…³åŠŸèƒ½</p>
<p>Docker</p>
<p>Containerd</p>
<p>æ˜¾ç¤ºå®¹å™¨åˆ—è¡¨</p>
<p>docker ps</p>
<p>crictl ps</p>
<p>åˆ›å»ºå®¹å™¨</p>
<p>docker create</p>
<p>crictl create</p>
<p>å¯åŠ¨å®¹å™¨</p>
<p>docker start</p>
<p>crictl start</p>
<p>åœæ­¢å®¹å™¨</p>
<p>docker stop</p>
<p>crictl stop</p>
<p>åˆ é™¤å®¹å™¨</p>
<p>docker rm</p>
<p>crictl rm</p>
<p>æŸ¥çœ‹å®¹å™¨è¯¦æƒ…</p>
<p>docker inspect</p>
<p>crictl inspect</p>
<p>attach</p>
<p>docker attach</p>
<p>crictl attach</p>
<p>exec</p>
<p>docker exec</p>
<p>crictl exec</p>
<p>logs</p>
<p>docker logs</p>
<p>crictl logs</p>
<p>stats</p>
<p>docker stats</p>
<p>crictl stats</p>
<p>çœ‹åˆ°ä»¥ä¸Šæ¸…å•ï¼Œcotnainerd å’Œ Docker çš„åŠŸèƒ½æ˜¯ä¸€è„‰ç›¸æ‰¿ã€‚å› æ­¤åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ containerd å¯ä»¥å‡å°‘å¾ˆå¤šè°ƒç”¨ä¾èµ–ã€‚</p>
<p>Docker ä½œä¸º K8s å®¹å™¨è¿è¡Œæ—¶ï¼Œè°ƒç”¨å…³ç³»å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>kubelet --&gt; docker shim ï¼ˆåœ¨ kubelet è¿›ç¨‹ä¸­ï¼‰ --&gt; dockerd --&gt; containerd

</code></pre><p>Containerd ä½œä¸º K8s å®¹å™¨è¿è¡Œæ—¶ï¼Œè°ƒç”¨å…³ç³»å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>kubelet --&gt; cri pluginï¼ˆåœ¨ containerd è¿›ç¨‹ä¸­ï¼‰ --&gt; containerd

</code></pre><p>dockerd æ˜¯ Docker åŸç”Ÿå®¹å™¨åº”ç”¨å¼•æ“æä¾›çš„ä»£ç†æœåŠ¡ï¼Œå†…ç½®äº† swarm clusterã€docker buildã€docker pushã€docker api ç­‰æ‰©å±•åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒé»˜è®¤éƒ½æ˜¯ Kubernetes é›†ç¾¤ç¯å¢ƒï¼Œæ‰€ä»¥è¿™å—çš„åŠŸèƒ½å¯ä»¥ç›´æ¥å»æ‰ã€‚</p>
<h3 id="å¯¹äº-docker-å®¹å™¨æ—¥å¿—ç½‘ç»œé…ç½®">å¯¹äº Docker å®¹å™¨æ—¥å¿—ã€ç½‘ç»œé…ç½®</h3>
<p>æ—¥å¿—å¯¹æ¯”</p>
<p>å¯¹æ¯”é¡¹</p>
<p>Docker</p>
<p>Containerd</p>
<p>å­˜å‚¨è·¯å¾„</p>
<p>å¦‚æœ Docker ä½œä¸º Kubernetes å®¹å™¨è¿è¡Œæ—¶ï¼Œå®¹å™¨æ—¥å¿—çš„è½ç›˜å°†ç”± docker æ¥å®Œæˆï¼Œä¿å­˜åœ¨ç±»ä¼¼<code>/var/lib/docker/containers/$CONTAINERID</code> ç›®å½•ä¸‹ã€‚Kubelet ä¼šåœ¨ <code>/var/log/pods</code> å’Œ <code>/var/log/containers</code> ä¸‹é¢å»ºç«‹è½¯é“¾æ¥ï¼ŒæŒ‡å‘ <code>/var/lib/docker/containers/$CONTAINERID</code> è¯¥ç›®å½•ä¸‹çš„å®¹å™¨æ—¥å¿—æ–‡ä»¶ã€‚</p>
<p>å¦‚æœ Containerd ä½œä¸º Kubernetes å®¹å™¨è¿è¡Œæ—¶ï¼Œ å®¹å™¨æ—¥å¿—çš„è½ç›˜ç”± Kubelet æ¥å®Œæˆï¼Œä¿å­˜è‡³ <code>/var/log/pods/$CONTAINER_NAME</code> ç›®å½•ä¸‹ï¼ŒåŒæ—¶åœ¨ <code>/var/log/containers</code> ç›®å½•ä¸‹åˆ›å»ºè½¯é“¾æ¥ï¼ŒæŒ‡å‘æ—¥å¿—æ–‡ä»¶ã€‚</p>
<p>CNI ç½‘ç»œå¯¹æ¯”</p>
<p>å¯¹æ¯”é¡¹</p>
<p>Docker</p>
<p>Containerd</p>
<p>è°è´Ÿè´£è°ƒç”¨ CNI</p>
<p>Kubelet å†…éƒ¨çš„ docker-shim</p>
<p>Containerd å†…ç½®çš„ cri-pluginï¼ˆcontainerd 1.1 ä»¥åï¼‰</p>
<p>å¦‚ä½•é…ç½® CNI</p>
<p>Kubelet å‚æ•° <code>--cni-bin-dir</code> å’Œ <code>--cni-conf-dir</code></p>
<p>Containerd é…ç½®æ–‡ä»¶ï¼ˆtomlï¼‰ï¼š <code>[plugins.cri.cni]</code>ã€<code>bin_dir = &quot;/opt/cni/bin&quot;</code>ã€<code>conf_dir = &quot;/etc/cni/net.d&quot;</code></p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>containerd æ˜¯ Docker å®¹å™¨è½åœ°å®è·µè¿‡ç¨‹ä¸­æ ‡å‡†åŒ–çš„äº§ç‰©ï¼Œç»è¿‡äº†å…¨çƒæ— æ•°ä¼ä¸šåº”ç”¨åœºæ™¯çš„é”¤ç‚¼ã€‚æ‰€ä»¥å®ƒçš„ç¨³å®šæ€§æ˜¯å€¼å¾—å¼€å‘è€…ä¿¡èµ–çš„å·¥å…·ã€‚è™½ç„¶å½“å‰ä¸šç•Œå¯¹ Docker å…¬å¸çš„äº§å“é‡‡å–å›é¿ç­–ç•¥ï¼Œä½†æ˜¯ containerd æ˜¯å½“å‰æœ€ä½³çš„ç”Ÿäº§ç¯å¢ƒçš„å®¹å™¨å¼•æ“ï¼Œå€¼å¾—ç»§ç»­å…³æ³¨åœºæ™¯çš„ä½¿ç”¨å’Œæ”¯æŒã€‚</p>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/06-%E7%BB%83%E4%B9%A0%E7%AF%87k8s-%E6%A0%B8%E5%BF%83%E5%AE%9E%E8%B7%B5%E7%9F%A5%E8%AF%86%E6%8E%8C%E6%8F%A1/"><span>06 ç»ƒä¹ ç¯‡ï¼šK8s æ ¸å¿ƒå®è·µçŸ¥è¯†æŒæ¡</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/kubernetes/kubernetes%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/08-k8s-%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E5%B7%A5%E5%85%B7-kubeadm-%E7%9A%84%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/"><span>08 K8s é›†ç¾¤å®‰è£…å·¥å…· kubeadm çš„è½åœ°å®è·µ</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 27270 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>