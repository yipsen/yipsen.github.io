<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>21 æ‰©å±•å¢å¼ºï¼šCoreDNS | Yipsen Ye</title>
<meta name="description" content="æ•´ä½“æ¦‚è§ˆ é€šè¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨ K8S ä¸­æœ‰ä¸€å¥—é»˜è®¤çš„é›†ç¾¤å†… DNS æœåŠ¡ï¼Œæˆ‘ä»¬é€šå¸¸æŠŠå®ƒå«åš kube-dnsï¼Œå®ƒåŸºäº SkyDNSï¼Œä¸ºæˆ‘ä»¬åœ¨æœåŠ¡æ³¨å†Œå‘ç°æ–¹é¢æä¾›äº†å¾ˆå¤§çš„ä¾¿åˆ©ã€‚
æ¯”å¦‚ï¼Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹é¡¹ç›® SayThx ä¸­ï¼Œå„ç»„ä»¶ä¾¿æ˜¯ä¾èµ– DNS è¿›è¡Œå½¼æ­¤é—´çš„è°ƒç”¨ã€‚
æœ¬èŠ‚ï¼Œæˆ‘ä»¬å°†ä»‹ç»çš„ CoreDNS æ˜¯ CNCF æ——ä¸‹åˆä¸€å­µåŒ–é¡¹ç›®ï¼Œåœ¨ K8S 1.9 ç‰ˆæœ¬ä¸­åŠ å…¥å¹¶è¿›å…¥ Alpha é˜¶æ®µã€‚æˆ‘ä»¬å½“å‰æ˜¯ä»¥ K8S 1.11 çš„ç‰ˆæœ¬è¿›è¡Œä»‹ç»ï¼Œå®ƒå¹¶ä¸æ˜¯é»˜è®¤çš„ DNS æœåŠ¡ï¼Œä½†æ˜¯å®ƒä½œä¸º K8S çš„ DNS æ’ä»¶çš„åŠŸèƒ½å·²ç» GA ã€‚
CoreDNS åœ¨ K8S 1.13 ç‰ˆæœ¬ä¸­æ‰æ­£å¼æˆä¸ºé»˜è®¤çš„ DNS æœåŠ¡ã€‚
CoreDNS æ˜¯ä»€ä¹ˆ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡® CoreDNS æ˜¯ä¸€ä¸ªç‹¬ç«‹é¡¹ç›®ï¼Œå®ƒä¸ä»…å¯æ”¯æŒåœ¨ K8S ä¸­ä½¿ç”¨ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ä½ ä»»ä½•éœ€è¦ DNS æœåŠ¡çš„æ—¶å€™ä½¿ç”¨å®ƒã€‚
CoreDNS ä½¿ç”¨ Go è¯­è¨€å®ç°ï¼Œéƒ¨ç½²éå¸¸æ–¹ä¾¿ã€‚
å®ƒçš„æ‰©å±•æ€§å¾ˆå¼ºï¼Œå¾ˆå¤šåŠŸèƒ½ç‰¹æ€§éƒ½æ˜¯é€šè¿‡æ’ä»¶å®Œæˆçš„ï¼Œå®ƒä¸ä»…æœ‰å¤§é‡çš„å†…ç½®æ’ä»¶ï¼ŒåŒæ—¶ä¹Ÿæœ‰å¾ˆä¸°å¯Œçš„ç¬¬ä¸‰æ–¹æ’ä»¶ã€‚ç”šè‡³ä½ è‡ªå·±å†™ä¸€ä¸ªæ’ä»¶ä¹Ÿéå¸¸çš„å®¹æ˜“ã€‚
å¦‚ä½•å®‰è£…ä½¿ç”¨ CoreDNS æˆ‘ä»¬è¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†è¯´æ˜å¦‚ä½•åœ¨ K8S ç¯å¢ƒä¸­ä½¿ç”¨å®ƒï¼Œæ‰€ä»¥å¯¹äºç‹¬ç«‹å®‰è£…éƒ¨ç½²å®ƒä¸åšè¯´æ˜ã€‚
æœ¬å°å†Œä¸­æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ K8S 1.11 ç‰ˆæœ¬ï¼Œåœ¨ç¬¬ 5 å°èŠ‚ ã€Šæ­å»º Kubernetes é›†ç¾¤ã€‹ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†ä½¿ç”¨ kubeadm æ­å»ºé›†ç¾¤ã€‚">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="nav-logo">
    <a href="http://yipsen.github.io/">
        
        <span class="nav-title">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æ–‡ç« </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/kubernetes%e4%bb%8e%e4%b8%8a%e6%89%8b%e5%88%b0%e5%ae%9e%e8%b7%b5/">Kubernetesä»ä¸Šæ‰‹åˆ°å®è·µ</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/01-%E5%BC%80%E7%AF%87-kubernetes-%E6%98%AF%E4%BB%80%E4%B9%88%E4%BB%A5%E5%8F%8A%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AE%83/">01 å¼€ç¯‡ï¼š Kubernetes æ˜¯ä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆéœ€è¦å®ƒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/02-%E5%88%9D%E6%AD%A5%E8%AE%A4%E8%AF%86kubernetes-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/">02 åˆæ­¥è®¤è¯†ï¼šKubernetes åŸºç¡€æ¦‚å¿µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/03-%E5%AE%8F%E8%A7%82%E8%AE%A4%E8%AF%86%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/">03 å®è§‚è®¤è¯†ï¼šæ•´ä½“æ¶æ„</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/04-%E6%90%AD%E5%BB%BA-kubernetes-%E9%9B%86%E7%BE%A4-%E6%9C%AC%E5%9C%B0%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA/">04 æ­å»º Kubernetes é›†ç¾¤ - æœ¬åœ°å¿«é€Ÿæ­å»º</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/05-%E5%8A%A8%E6%89%8B%E5%AE%9E%E8%B7%B5%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA-kubernetes-%E9%9B%86%E7%BE%A4-%E7%94%9F%E4%BA%A7%E5%8F%AF%E7%94%A8/">05 åŠ¨æ‰‹å®è·µï¼šæ­å»ºä¸€ä¸ª Kubernetes é›†ç¾¤ - ç”Ÿäº§å¯ç”¨</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/06-%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%9D%E8%AF%86-kubectl/">06 é›†ç¾¤ç®¡ç†ï¼šåˆè¯† kubectl</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/07-%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E4%BB%A5-redis-%E4%B8%BA%E4%BE%8B-%E9%83%A8%E7%BD%B2%E5%8F%8A%E8%AE%BF%E9%97%AE/">07 é›†ç¾¤ç®¡ç†ï¼šä»¥ Redis ä¸ºä¾‹-éƒ¨ç½²åŠè®¿é—®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/08-%E5%AE%89%E5%85%A8%E9%87%8D%E7%82%B9-%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83/">08 å®‰å…¨é‡ç‚¹ è®¤è¯å’Œæˆæƒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/09-%E5%BA%94%E7%94%A8%E5%8F%91%E5%B8%83%E9%83%A8%E7%BD%B2%E5%AE%9E%E9%99%85%E9%A1%B9%E7%9B%AE/">09 åº”ç”¨å‘å¸ƒï¼šéƒ¨ç½²å®é™…é¡¹ç›®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/10-%E5%BA%94%E7%94%A8%E7%AE%A1%E7%90%86%E5%88%9D%E8%AF%86-helm/">10 åº”ç”¨ç®¡ç†ï¼šåˆè¯† Helm</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/11-%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5%E4%BB%A5-helm-%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/">11 éƒ¨ç½²å®è·µï¼šä»¥ Helm éƒ¨ç½²é¡¹ç›®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/12-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-apiserver/">12 åº–ä¸è§£ç‰›ï¼škube-apiserver</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/13-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Betcd/">13 åº–ä¸è§£ç‰›ï¼šetcd</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/14-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bcontroller-manager/">14 åº–ä¸è§£ç‰›ï¼šcontroller-manager</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/15-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-scheduler/">15 åº–ä¸è§£ç‰›ï¼škube-scheduler</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/16-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkubelet/">16 åº–ä¸è§£ç‰›ï¼škubelet</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/17-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-proxy/">17 åº–ä¸è§£ç‰›ï¼škube-proxy</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/18-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bcontainer-runtime-docker/">18 åº–ä¸è§£ç‰›ï¼šContainer Runtime ï¼ˆDockerï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/19-troubleshoot/">19 Troubleshoot</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/20-%E6%89%A9%E5%B1%95%E5%A2%9E%E5%BC%BAdashboard/">20 æ‰©å±•å¢å¼ºï¼šDashboard</a></li>
                
                
                
                    <li>21 æ‰©å±•å¢å¼ºï¼šCoreDNS</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/22-%E6%9C%8D%E5%8A%A1%E5%A2%9E%E5%BC%BAingress/">22 æœåŠ¡å¢å¼ºï¼šIngress</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/23-%E7%9B%91%E6%8E%A7%E5%AE%9E%E8%B7%B5%E5%AF%B9-k8s-%E9%9B%86%E7%BE%A4%E8%BF%9B%E8%A1%8C%E7%9B%91%E6%8E%A7/">23 ç›‘æ§å®è·µï¼šå¯¹ K8S é›†ç¾¤è¿›è¡Œç›‘æ§</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/24-%E6%80%BB%E7%BB%93/">24 æ€»ç»“</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">21 æ‰©å±•å¢å¼ºï¼šCoreDNS</h1>
        <div class="post-info">
            <div class="post-date"> 
                <span>2021-12-22 01:47:48</span>
            </div>
        </div>
        <div class="post-content">
            <h2 id="æ•´ä½“æ¦‚è§ˆ">æ•´ä½“æ¦‚è§ˆ</h2>
<p>é€šè¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨ K8S ä¸­æœ‰ä¸€å¥—é»˜è®¤çš„<a href="https://github.com/kubernetes/dns">é›†ç¾¤å†… DNS æœåŠ¡</a>ï¼Œæˆ‘ä»¬é€šå¸¸æŠŠå®ƒå«åš <code>kube-dns</code>ï¼Œå®ƒåŸºäº SkyDNSï¼Œä¸ºæˆ‘ä»¬åœ¨æœåŠ¡æ³¨å†Œå‘ç°æ–¹é¢æä¾›äº†å¾ˆå¤§çš„ä¾¿åˆ©ã€‚</p>
<p>æ¯”å¦‚ï¼Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹é¡¹ç›® <a href="https://github.com/tao12345666333/saythx">SayThx</a> ä¸­ï¼Œå„ç»„ä»¶ä¾¿æ˜¯ä¾èµ– DNS è¿›è¡Œå½¼æ­¤é—´çš„è°ƒç”¨ã€‚</p>
<p>æœ¬èŠ‚ï¼Œæˆ‘ä»¬å°†ä»‹ç»çš„ <a href="https://coredns.io/">CoreDNS</a> æ˜¯ CNCF æ——ä¸‹åˆä¸€å­µåŒ–é¡¹ç›®ï¼Œåœ¨ K8S 1.9 ç‰ˆæœ¬ä¸­åŠ å…¥å¹¶è¿›å…¥ Alpha é˜¶æ®µã€‚æˆ‘ä»¬å½“å‰æ˜¯ä»¥ K8S 1.11 çš„ç‰ˆæœ¬è¿›è¡Œä»‹ç»ï¼Œå®ƒå¹¶ä¸æ˜¯é»˜è®¤çš„ DNS æœåŠ¡ï¼Œä½†æ˜¯<a href="https://github.com/kubernetes/enhancements/issues/427">å®ƒä½œä¸º K8S çš„ DNS æ’ä»¶çš„åŠŸèƒ½å·²ç» GA</a> ã€‚</p>
<p>CoreDNS åœ¨ K8S 1.13 ç‰ˆæœ¬ä¸­æ‰æ­£å¼æˆä¸º<a href="https://kubernetes.io/blog/2018/12/03/kubernetes-1-13-release-announcement/">é»˜è®¤çš„ DNS æœåŠ¡</a>ã€‚</p>
<h2 id="coredns-æ˜¯ä»€ä¹ˆ">CoreDNS æ˜¯ä»€ä¹ˆ</h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡® CoreDNS æ˜¯ä¸€ä¸ªç‹¬ç«‹é¡¹ç›®ï¼Œå®ƒä¸ä»…å¯æ”¯æŒåœ¨ K8S ä¸­ä½¿ç”¨ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ä½ ä»»ä½•éœ€è¦ DNS æœåŠ¡çš„æ—¶å€™ä½¿ç”¨å®ƒã€‚</p>
<p>CoreDNS ä½¿ç”¨ Go è¯­è¨€å®ç°ï¼Œéƒ¨ç½²éå¸¸æ–¹ä¾¿ã€‚</p>
<p>å®ƒçš„æ‰©å±•æ€§å¾ˆå¼ºï¼Œå¾ˆå¤šåŠŸèƒ½ç‰¹æ€§éƒ½æ˜¯é€šè¿‡æ’ä»¶å®Œæˆçš„ï¼Œå®ƒä¸ä»…æœ‰å¤§é‡çš„<a href="https://coredns.io/plugins/">å†…ç½®æ’ä»¶</a>ï¼ŒåŒæ—¶ä¹Ÿæœ‰å¾ˆä¸°å¯Œçš„<a href="https://coredns.io/explugins/">ç¬¬ä¸‰æ–¹æ’ä»¶</a>ã€‚ç”šè‡³ä½ è‡ªå·±<a href="https://coredns.io/2016/12/19/writing-plugins-for-coredns/">å†™ä¸€ä¸ªæ’ä»¶</a>ä¹Ÿéå¸¸çš„å®¹æ˜“ã€‚</p>
<h2 id="å¦‚ä½•å®‰è£…ä½¿ç”¨-coredns">å¦‚ä½•å®‰è£…ä½¿ç”¨ CoreDNS</h2>
<p>æˆ‘ä»¬è¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†è¯´æ˜å¦‚ä½•åœ¨ K8S ç¯å¢ƒä¸­ä½¿ç”¨å®ƒï¼Œæ‰€ä»¥å¯¹äºç‹¬ç«‹å®‰è£…éƒ¨ç½²å®ƒä¸åšè¯´æ˜ã€‚</p>
<p>æœ¬å°å†Œä¸­æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ K8S 1.11 ç‰ˆæœ¬ï¼Œåœ¨ç¬¬ 5 å°èŠ‚ ã€Šæ­å»º Kubernetes é›†ç¾¤ã€‹ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†ä½¿ç”¨ <code>kubeadm</code> æ­å»ºé›†ç¾¤ã€‚</p>
<p>ä½¿ç”¨ <code>kubeadm</code> åˆ›å»ºé›†ç¾¤æ—¶å€™ <code>kubeadm init</code> å¯ä»¥ä¼ é€’ <code>--feature-gates</code> å‚æ•°ï¼Œç”¨äºå¯ç”¨ä¸€äº›é¢å¤–çš„ç‰¹æ€§ã€‚</p>
<p>æ¯”å¦‚åœ¨ä¹‹å‰ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>kubeadm init --feature-gates CoreDNS=true</code> åœ¨åˆ›å»ºé›†ç¾¤æ—¶å€™å¯ç”¨ CoreDNSã€‚</p>
<p>è€Œåœ¨ 1.11 ç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨ <code>kubeadm</code> åˆ›å»ºé›†ç¾¤æ—¶ <code>CoreDNS</code> å·²ç»è¢«é»˜è®¤å¯ç”¨ï¼Œè¿™ä¹Ÿä»ä¾§é¢è¯æ˜äº† CoreDNS åœ¨ K8S ä¸­è¾¾åˆ°äº†ç”Ÿäº§å¯ç”¨çš„çŠ¶æ€ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åˆ›å»ºé›†ç¾¤æ—¶çš„æ—¥å¿—è¾“å‡ºï¼š</p>
<pre tabindex="0"><code>[root@master ~]# kubeadm init
[init] using Kubernetes version: v1.11.3               
[preflight] running pre-flight checks
...
[bootstraptoken] creating the &quot;cluster-info&quot; ConfigMap in the &quot;kube-public&quot; namespace
[addons] Applied essential addon: CoreDNS
[addons] Applied essential addon: kube-proxy

Your Kubernetes master has initialized successfully!
</code></pre><p>å¯ä»¥çœ‹åˆ°åˆ›å»ºæ—¶å·²ç»å¯ç”¨äº† CoreDNS çš„æ‰©å±•ï¼Œå¾…é›†ç¾¤åˆ›å»ºå®Œæˆåï¼Œå¯ç”¨è¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡ŒæŸ¥çœ‹ï¼š</p>
<pre tabindex="0"><code>master $ kubectl -n kube-system get all  -l k8s-app=kube-dns -o wide
NAME                           READY     STATUS    RESTARTS   AGE       IP          NODE      NOMINATED NODE
pod/coredns-78fcdf6894-5zbx4   1/1       Running   0          1h        10.32.0.3   node01    &lt;none&gt;
pod/coredns-78fcdf6894-cxdw8   1/1       Running   0          1h        10.32.0.2   node01    &lt;none&gt;

NAME               TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)         AGE       SELECTOR
service/kube-dns   ClusterIP   10.96.0.10   &lt;none&gt;        53/UDP,53/TCP   1h        k8s-app=kube-dns

NAME                      DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE       CONTAINERS   IMAGES                     SELECTOR
deployment.apps/coredns   2         2         2            2           1h        coredns      k8s.gcr.io/coredns:1.1.3   k8s-app=kube-dns

NAME                                 DESIRED   CURRENT   READY     AGE       CONTAINERS   IMAGES                   SELECTOR
replicaset.apps/coredns-78fcdf6894   2         2         2         1h        coredns      k8s.gcr.io/coredns:1.1.3   k8s-app=kube-dns,pod-template-hash=3497892450
</code></pre><p>è¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹ K8S åŸæœ‰çš„ <code>kube-dns</code> æ‰€ä»¥æ ‡ç­¾å’Œ <code>Service</code> çš„åå­—éƒ½è¿˜ä½¿ç”¨äº† <code>kube-dns</code>ï¼Œä½†å®é™…åœ¨è¿è¡Œçš„åˆ™æ˜¯ CoreDNSã€‚</p>
<h2 id="éªŒè¯-coredns-åŠŸèƒ½">éªŒè¯ CoreDNS åŠŸèƒ½</h2>
<p>ä»ä¸Šé¢çš„è¾“å‡ºæˆ‘ä»¬çœ‹åˆ° CoreDNS çš„ <code>Pod</code> è¿è¡Œæ­£å¸¸ï¼Œç°åœ¨æµ‹è¯•ä¸‹å®ƒæ˜¯å¦èƒ½æ­£ç¡®è§£æã€‚ä»ç„¶ä»¥æˆ‘ä»¬çš„ç¤ºä¾‹é¡¹ç›® <a href="https://github.com/tao12345666333/saythx">SayThx</a> ä¸ºä¾‹ï¼Œå…ˆ clone é¡¹ç›®ï¼Œè¿›å…¥åˆ°é¡¹ç›®çš„ deploy ç›®å½•ä¸­ã€‚</p>
<pre tabindex="0"><code>master $ cd saythx/deploy/
master $ ls
backend-deployment.yaml  frontend-deployment.yaml  namespace.yaml         redis-service.yaml
backend-service.yaml     frontend-service.yaml     redis-deployment.yaml  work-deployment.yaml
master $ kubectl apply -f namespace.yaml
namespace/work created
master $ kubectl apply -f redis-deployment.yaml
deployment.apps/saythx-redis created
master $ kubectl apply -f redis-service.yaml
service/saythx-redis created
</code></pre><ul>
<li>æŸ¥çœ‹å…¶éƒ¨ç½²æƒ…å†µï¼š</li>
</ul>
<pre tabindex="0"><code>master $ kubectl -n work get all
NAME                               READY     STATUS    RESTARTS   AGE
pod/saythx-redis-8558c7d7d-8v4lp   1/1       Running   0          2m

NAME                   TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
service/saythx-redis   NodePort   10.109.215.147   &lt;none&gt;        6379:31438/TCP   2m

NAME                           DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/saythx-redis   1         1         1            1           2m

NAME                                     DESIRED   CURRENT   READY     AGE
replicaset.apps/saythx-redis-8558c7d7d   1         1         1         2m
</code></pre><ul>
<li>éªŒè¯ DNS æ˜¯å¦æ­£ç¡®è§£æ:</li>
</ul>
<pre tabindex="0"><code># ä½¿ç”¨ AlpineLinux çš„é•œåƒåˆ›å»ºä¸€ä¸ª Pod å¹¶è¿›å…¥å…¶ä¸­
master $ kubectl run alpine -it --rm --restart='Never' --image='alpine' sh
If you don't see a command prompt, try pressing enter.
/ # apk add --no-cache bind-tools
fetch http://dl-cdn.alpinelinux.org/alpine/v3.8/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.8/community/x86_64/APKINDEX.tar.gz
(1/5) Installing libgcc (6.4.0-r9)
(2/5) Installing json-c (0.13.1-r0)
(3/5) Installing libxml2 (2.9.8-r1)
(4/5) Installing bind-libs (9.12.3-r0)
(5/5) Installing bind-tools (9.12.3-r0)
Executing busybox-1.28.4-r2.trigger
OK: 9 MiB in 18 packages

# å®‰è£…å®Œ dig å‘½ä»¤æ‰€åœ¨åŒ…ä¹‹åï¼Œä½¿ç”¨ dig å‘½ä»¤è¿›è¡ŒéªŒè¯
/ # dig @10.32.0.2 saythx-redis.work.svc.cluster.local +noall +answer

; &lt;&lt;&gt;&gt; DiG 9.12.3 &lt;&lt;&gt;&gt; @10.32.0.2 saythx-redis.work.svc.cluster.local +noall +answer
; (1 server found)
;; global options: +cmd
saythx-redis.work.svc.cluster.local. 5 IN A     10.109.215.147
</code></pre><p>é€šè¿‡ä»¥ä¸Šæ“ä½œï¼Œå¯ä»¥çœ‹åˆ°ç›¸åº”çš„ <code>Service</code> è®°å½•å¯è¢«æ­£ç¡®è§£æã€‚è¿™é‡Œæœ‰å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>
<p>åŸŸåè§£ææ˜¯å¯è·¨ <code>Namespace</code> çš„</p>
<p>åˆšæ‰çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰æŒ‡å®š <code>Namespace</code> æ‰€ä»¥åˆšæ‰æˆ‘ä»¬æ‰€åœ¨çš„ <code>Namespace</code> æ˜¯ <code>default</code>ã€‚è€Œæˆ‘ä»¬çš„è§£æå®éªŒæˆåŠŸäº†ã€‚è¯´æ˜ CoreDNS çš„è§£ææ˜¯å…¨å±€çš„ã€‚<strong>è™½ç„¶è§£ææ˜¯å…¨å±€çš„ï¼Œä½†ä¸ä»£è¡¨ç½‘ç»œäº’é€š</strong></p>
</li>
<li>
<p>åŸŸåæœ‰ç‰¹å®šæ ¼å¼</p>
<p>å¯ä»¥çœ‹åˆ°åˆšæ‰æˆ‘ä»¬ä½¿ç”¨çš„å®Œæ•´åŸŸåæ˜¯ <code>saythx-redis.work.svc.cluster.local</code> , æ³¨æ„å¼€å¤´çš„ä¾¿æ˜¯ <strong>Service å.Namespace å</strong> å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ <code>host</code> å‘½ä»¤æŸ¥è¯¢:</p>
<pre tabindex="0"><code>/ # host -t srv  saythx-redis.work
saythx-redis.work.svc.cluster.local has SRV record 0 100 6379 saythx-redis.work.svc.cluster.local.
</code></pre></li>
</ul>
<h2 id="é…ç½®å’Œç›‘æ§">é…ç½®å’Œç›‘æ§</h2>
<p>CoreDNS ä½¿ç”¨ <code>ConfigMap</code> çš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œä½†æ˜¯å¦‚æœæ›´æ”¹äº†é…ç½®ï¼Œ<code>Pod</code> é‡å¯åæ‰ä¼šç”Ÿæ•ˆã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯æŸ¥çœ‹å…¶é…ç½®ï¼š</p>
<pre tabindex="0"><code>master $ kubectl -n kube-system get configmap coredns -o yaml
apiVersion: v1
data:
  Corefile: |
    .:53 {
        errors
        health
        kubernetes cluster.local in-addr.arpa ip6.arpa {
           pods insecure
           upstream
           fallthrough in-addr.arpa ip6.arpa
        }
        prometheus :9153
        proxy . /etc/resolv.conf
        cache 30
        reload
    }
kind: ConfigMap
metadata:
  creationTimestamp: 2018-12-22T16:45:47Z
  name: coredns
  namespace: kube-system
  resourceVersion: &quot;217&quot;
  selfLink: /api/v1/namespaces/kube-system/configmaps/coredns
  uid: 0882e51b-0609-11e9-b25e-0242ac110057
</code></pre><p><code>Corefile</code> ä¾¿æ˜¯å®ƒçš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°å®ƒå¯åŠ¨äº†ç±»ä¼¼ <code>kubernetes</code>, <code>prometheus</code> ç­‰æ’ä»¶ã€‚</p>
<p>æ³¨æ„ <code>kubernetes</code> æ’ä»¶çš„é…ç½®ï¼Œä½¿ç”¨çš„åŸŸæ˜¯ <code>cluster.local</code> ï¼Œè¿™ä¹Ÿæ˜¯ä¸Šé¢æˆ‘ä»¬æåˆ°åŸŸåæ ¼å¼æ—¶å€™ååŠéƒ¨åˆ†æœªè§£é‡Šçš„éƒ¨åˆ†ã€‚</p>
<p>è‡³äº <code>prometheus</code> æ’ä»¶ï¼Œåˆ™æ˜¯ç›‘å¬åœ¨ 9153 ç«¯å£ä¸Šæä¾›äº†ç¬¦åˆ Prometheus æ ‡å‡†çš„ metrics æ¥å£ï¼Œå¯ç”¨äºç›‘æ§ç­‰ã€‚å…³äºç›‘æ§çš„éƒ¨åˆ†ï¼Œå¯å‚è€ƒç¬¬ 23 èŠ‚ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† CoreDNS çš„åŸºæœ¬æƒ…å†µï¼Œå®ƒæ˜¯ä»¥ Go ç¼–å†™çš„çµæ´»å¯æ‰©å±•çš„ DNS æœåŠ¡å™¨ã€‚</p>
<p>ä½¿ç”¨ CoreDNS ä»£æ›¿ kube-dns ä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä¸€äº› kube-dns æ—¶æœŸçš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´åŸå…ˆ kube-dns çš„æ—¶å€™ï¼Œä¸€ä¸ª Pod ä¸­è¿˜éœ€è¦åŒ…å« <code>kube-dns</code>, <code>sidecar</code> å’Œ <code>dnsmasq</code> çš„å®¹å™¨ï¼Œè€Œæ¯å½“ <code>dnsmasq</code> å‡ºç°æ¼æ´æ—¶ï¼Œå°±ä¸å¾—ä¸è®© K8S å‘ä¸ªå®‰å…¨è¡¥ä¸æ‰èƒ½è¿›è¡Œæ›´æ–°ã€‚</p>
<p>CoreDNS æœ‰ä¸°å¯Œçš„æ’ä»¶ï¼Œå¯ä»¥æ»¡è¶³æ›´å¤šæ ·çš„åº”ç”¨éœ€æ±‚ï¼ŒåŒæ—¶ <code>kubernetes</code> æ’ä»¶è¿˜åŒ…å«äº†ä¸€äº›ç‹¬ç‰¹çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ Pod éªŒè¯ä¹‹ç±»çš„ï¼Œå¯å¢åŠ å®‰å…¨æ€§ã€‚</p>
<p>åŒæ—¶ CoreDNS åœ¨ 1.13 ç‰ˆæœ¬ä¸­ä¼šä½œä¸ºé»˜è®¤çš„ DNS æœåŠ¡å™¨ä½¿ç”¨ï¼Œæ‰€ä»¥åº”è¯¥ç»™å®ƒæ›´å¤šçš„å…³æ³¨ã€‚</p>
<p>åœ¨ä¸‹èŠ‚ï¼Œæˆ‘ä»¬å°†ä»‹ç» <code>Ingress</code>ï¼Œçœ‹çœ‹å¦‚æœä½¿ç”¨ä¸åŒäºä¹‹å‰ä½¿ç”¨çš„ <code>NodePort</code> çš„æ–¹å¼å°†æœåŠ¡æš´éœ²äºå¤–éƒ¨ã€‚</p>

        </div>
    </article>
</div>
<div class="division-line"></div>
<div class="others">
    <div>æ ‡ç­¾ï¼šğŸ·ï¸<a class="post-tag" href="/tags/kubernetes/">kubernetes</a>&nbsp;</div>
    <div>åˆ†ç±»ï¼š ğŸ“’<a class="post-category" href="/categories/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/">Kubernetesä»ä¸Šæ‰‹åˆ°å®è·µ</a>&nbsp; </div>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/20-%E6%89%A9%E5%B1%95%E5%A2%9E%E5%BC%BAdashboard/"><span>20 æ‰©å±•å¢å¼ºï¼šDashboard</span></a>
    </div>
    <div class="next">
        
        <a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/22-%E6%9C%8D%E5%8A%A1%E5%A2%9E%E5%BC%BAingress/"><span>22 æœåŠ¡å¢å¼ºï¼šIngress</span></a>
    </div>
</div>

        </div>
        <div id="float">
            <ul class="float-button-bar">
    <li>
        <button class="float-button top" onclick="scrollToTop(this);">UP</button>
    </li>
    <li>
        <button class="float-button toggler" onclick="changeSkin(this);">DARK</button>
    </li>
</ul>
        </div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 2020 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    const changeSkin = () => {
        document.getElementById('page').classList.toggle('night');
    }
    const scrollToTop = () => {
        window.scrollTo(0, 0);
    }
</script>
</body>

</html>