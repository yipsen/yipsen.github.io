<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>05 åŠ¨æ‰‹å®è·µï¼šæ­å»ºä¸€ä¸ª Kubernetes é›†ç¾¤ - ç”Ÿäº§å¯ç”¨ | Yipsen Ye</title>
<meta name="description" content="é€šè¿‡ä¸Šä¸€èŠ‚çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¿«é€Ÿçš„ä½¿ç”¨ Minikube æ­å»ºäº†ä¸€ä¸ªæœ¬åœ°å¯ç”¨çš„ K8S é›†ç¾¤ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒèŠ‚ç‚¹æ˜¯ä¸€ä¸ªè™šæ‹Ÿæœºå®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸Šé¢ä½“éªŒä¸€äº›åŸºæœ¬çš„åŠŸèƒ½ã€‚
å¤§å¤šæ•°äººçš„éœ€æ±‚å¹¶ä¸åªæ˜¯åŒ…å«ä¸€ä¸ªè™šæ‹ŸæœºèŠ‚ç‚¹çš„æœ¬åœ°æµ‹è¯•é›†ç¾¤ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯åœ¨æœåŠ¡å™¨è¿è¡Œï¼Œå¯è‡ªè¡Œæ‰©/ç¼©å®¹ï¼Œå…·å¤‡å…¨éƒ¨åŠŸèƒ½çš„ï¼Œè¾¾åˆ°ç”Ÿäº§å¯ç”¨çš„é›†ç¾¤ã€‚
K8S é›†ç¾¤çš„æ­å»ºï¼Œä¸€ç›´è®©å¾ˆå¤šäººå¤´ç–¼ï¼Œæœ¬èŠ‚æˆ‘ä»¬æ¥æ­å»ºä¸€ä¸ªç”Ÿäº§å¯ç”¨çš„é›†ç¾¤ï¼Œä¾¿äºåç»­çš„å­¦ä¹ æˆ–ä½¿ç”¨ã€‚
æ–¹æ¡ˆé€‰æ‹© K8S ç”Ÿäº§ç¯å¢ƒå¯ç”¨çš„é›†ç¾¤æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œæœ¬èŠ‚æˆ‘ä»¬é€‰æ‹©ä¸€ä¸ª Kubernetes å®˜æ–¹æ¨èçš„æ–¹æ¡ˆ kubeadm è¿›è¡Œæ­å»ºã€‚
kubeadm æ˜¯ Kubernetes å®˜æ–¹æä¾›çš„ä¸€ä¸ª CLI å·¥å…·ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„æ­å»ºä¸€å¥—ç¬¦åˆå®˜æ–¹æœ€ä½³å®è·µçš„æœ€å°åŒ–å¯ç”¨é›†ç¾¤ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ kubeadm æ­å»ºé›†ç¾¤æ—¶ï¼Œé›†ç¾¤å¯ä»¥é€šè¿‡ K8S çš„ä¸€è‡´æ€§æµ‹è¯•ï¼Œå¹¶ä¸” kubeadm è¿˜æ”¯æŒå…¶ä»–çš„é›†ç¾¤ç”Ÿå‘½å‘¨æœŸåŠŸèƒ½ï¼Œæ¯”å¦‚å‡çº§/é™çº§ç­‰ã€‚
æˆ‘ä»¬åœ¨æ­¤å¤„é€‰æ‹© kubeadm ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ä¸ç”¨è¿‡äºå…³æ³¨é›†ç¾¤çš„å†…éƒ¨ç»†èŠ‚ï¼Œä¾¿å¯ä»¥å¿«é€Ÿçš„æ­å»ºå‡ºç”Ÿäº§å¯ç”¨çš„é›†ç¾¤ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åç»­ç« èŠ‚çš„å­¦ä¹ ï¼Œå¿«é€Ÿä¸Šæ‰‹ K8S ï¼Œå¹¶å­¦ä¹ åˆ° K8S çš„å†…éƒ¨åŸç†ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæƒ³è¦åœ¨ç‰©ç†æœºä¸Šå®Œå…¨ä¸€æ­¥æ­¥æ­å»ºé›†ç¾¤ï¼Œä¾¿è½»è€Œæ˜“ä¸¾ã€‚
å®‰è£…åŸºç¡€ç»„ä»¶ å‰æœŸå‡†å¤‡ ä½¿ç”¨ kubeadm å‰ï¼Œæˆ‘ä»¬éœ€è¦æå‰åšä¸€äº›å‡†å¤‡ã€‚
  æˆ‘ä»¬éœ€è¦ç¦ç”¨ swapã€‚é€šè¿‡ä¹‹å‰çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æœ‰ä¸ªå¿…é¡»çš„ç»„ä»¶ï¼Œåä¸º kubeletï¼Œè‡ª K8S 1.8 å¼€å§‹ï¼Œå¯åŠ¨ kubelet æ—¶ï¼Œéœ€è¦ç¦ç”¨ swap ã€‚æˆ–è€…éœ€è¦æ›´æ”¹ kubelet çš„å¯åŠ¨å‚æ•° --fail-swap-on=falseã€‚
è™½è¯´å¯ä»¥æ›´æ”¹å‚æ•°è®©å…¶å¯ç”¨ï¼Œä½†æ˜¯æˆ‘å»ºè®®è¿˜æ˜¯ç¦ç”¨ swap é™¤éä½ çš„é›†ç¾¤æœ‰ç‰¹æ®Šçš„éœ€æ±‚ï¼Œæ¯”å¦‚ï¼šæœ‰å¤§å†…å­˜ä½¿ç”¨çš„éœ€æ±‚ï¼Œä½†åˆæƒ³èŠ‚çº¦æˆæœ¬ï¼›æˆ–è€…ä½ çŸ¥é“ä½ å°†è¦åšä»€ä¹ˆï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°ä¸€äº›éé¢„æœŸçš„æƒ…å†µï¼Œå°¤å…¶æ˜¯åšäº†å†…å­˜é™åˆ¶çš„æ—¶å€™ï¼Œå½“æŸä¸ª Pod è¾¾åˆ°å†…å­˜é™åˆ¶çš„æ—¶å€™ï¼Œå®ƒå¯èƒ½ä¼šæº¢å‡ºåˆ° swap ä¸­ï¼Œè¿™ä¼šå¯¼è‡´ K8S æ— æ³•æ­£å¸¸è¿›è¡Œè°ƒåº¦ã€‚
å¦‚ä½•ç¦ç”¨ï¼š
 ä½¿ç”¨ sudo cat /proc/swaps éªŒè¯ swap é…ç½®çš„è®¾å¤‡å’Œæ–‡ä»¶ã€‚ é€šè¿‡ swapoff -a å…³é—­ swap ã€‚ ä½¿ç”¨ sudo blkid æˆ–è€… sudo lsblk å¯æŸ¥çœ‹åˆ°æˆ‘ä»¬çš„è®¾å¤‡å±æ€§ï¼Œè¯·æ³¨æ„è¾“å‡ºç»“æœä¸­å¸¦æœ‰ swap å­—æ ·çš„ä¿¡æ¯ã€‚ å°† /etc/fstab ä¸­å’Œä¸Šä¸€æ¡å‘½ä»¤ä¸­è¾“å‡ºçš„ï¼Œå’Œ swap ç›¸å…³çš„æŒ‚è½½ç‚¹éƒ½åˆ æ‰ï¼Œä»¥å…åœ¨æœºå™¨é‡å¯æˆ–é‡æŒ‚è½½æ—¶ï¼Œå†æŒ‚è½½ swap åˆ†åŒºã€‚  æ‰§è¡Œå®Œä¸Šè¿°æ“ä½œï¼Œswap ä¾¿ä¼šè¢«ç¦ç”¨ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å†æ¬¡é€šè¿‡ä¸Šè¿°å‘½ä»¤ï¼Œæˆ–è€… free å‘½ä»¤æ¥ç¡®è®¤æ˜¯å¦è¿˜æœ‰ swap å­˜åœ¨ã€‚">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/kubernetes%e4%bb%8e%e4%b8%8a%e6%89%8b%e5%88%b0%e5%ae%9e%e8%b7%b5/">Kubernetesä»ä¸Šæ‰‹åˆ°å®è·µ</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/01-%E5%BC%80%E7%AF%87-kubernetes-%E6%98%AF%E4%BB%80%E4%B9%88%E4%BB%A5%E5%8F%8A%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AE%83/">01 å¼€ç¯‡ï¼š Kubernetes æ˜¯ä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆéœ€è¦å®ƒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/02-%E5%88%9D%E6%AD%A5%E8%AE%A4%E8%AF%86kubernetes-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/">02 åˆæ­¥è®¤è¯†ï¼šKubernetes åŸºç¡€æ¦‚å¿µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/03-%E5%AE%8F%E8%A7%82%E8%AE%A4%E8%AF%86%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/">03 å®è§‚è®¤è¯†ï¼šæ•´ä½“æ¶æ„</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/04-%E6%90%AD%E5%BB%BA-kubernetes-%E9%9B%86%E7%BE%A4-%E6%9C%AC%E5%9C%B0%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA/">04 æ­å»º Kubernetes é›†ç¾¤ - æœ¬åœ°å¿«é€Ÿæ­å»º</a></li>
                
                
                
                    <li>05 åŠ¨æ‰‹å®è·µï¼šæ­å»ºä¸€ä¸ª Kubernetes é›†ç¾¤ - ç”Ÿäº§å¯ç”¨</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/06-%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%9D%E8%AF%86-kubectl/">06 é›†ç¾¤ç®¡ç†ï¼šåˆè¯† kubectl</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/07-%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E4%BB%A5-redis-%E4%B8%BA%E4%BE%8B-%E9%83%A8%E7%BD%B2%E5%8F%8A%E8%AE%BF%E9%97%AE/">07 é›†ç¾¤ç®¡ç†ï¼šä»¥ Redis ä¸ºä¾‹-éƒ¨ç½²åŠè®¿é—®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/08-%E5%AE%89%E5%85%A8%E9%87%8D%E7%82%B9-%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83/">08 å®‰å…¨é‡ç‚¹ è®¤è¯å’Œæˆæƒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/09-%E5%BA%94%E7%94%A8%E5%8F%91%E5%B8%83%E9%83%A8%E7%BD%B2%E5%AE%9E%E9%99%85%E9%A1%B9%E7%9B%AE/">09 åº”ç”¨å‘å¸ƒï¼šéƒ¨ç½²å®é™…é¡¹ç›®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/10-%E5%BA%94%E7%94%A8%E7%AE%A1%E7%90%86%E5%88%9D%E8%AF%86-helm/">10 åº”ç”¨ç®¡ç†ï¼šåˆè¯† Helm</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/11-%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5%E4%BB%A5-helm-%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/">11 éƒ¨ç½²å®è·µï¼šä»¥ Helm éƒ¨ç½²é¡¹ç›®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/12-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-apiserver/">12 åº–ä¸è§£ç‰›ï¼škube-apiserver</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/13-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Betcd/">13 åº–ä¸è§£ç‰›ï¼šetcd</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/14-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bcontroller-manager/">14 åº–ä¸è§£ç‰›ï¼šcontroller-manager</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/15-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-scheduler/">15 åº–ä¸è§£ç‰›ï¼škube-scheduler</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/16-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkubelet/">16 åº–ä¸è§£ç‰›ï¼škubelet</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/17-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-proxy/">17 åº–ä¸è§£ç‰›ï¼škube-proxy</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/18-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bcontainer-runtime-docker/">18 åº–ä¸è§£ç‰›ï¼šContainer Runtime ï¼ˆDockerï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/19-troubleshoot/">19 Troubleshoot</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/20-%E6%89%A9%E5%B1%95%E5%A2%9E%E5%BC%BAdashboard/">20 æ‰©å±•å¢å¼ºï¼šDashboard</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/21-%E6%89%A9%E5%B1%95%E5%A2%9E%E5%BC%BAcoredns/">21 æ‰©å±•å¢å¼ºï¼šCoreDNS</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/22-%E6%9C%8D%E5%8A%A1%E5%A2%9E%E5%BC%BAingress/">22 æœåŠ¡å¢å¼ºï¼šIngress</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/23-%E7%9B%91%E6%8E%A7%E5%AE%9E%E8%B7%B5%E5%AF%B9-k8s-%E9%9B%86%E7%BE%A4%E8%BF%9B%E8%A1%8C%E7%9B%91%E6%8E%A7/">23 ç›‘æ§å®è·µï¼šå¯¹ K8S é›†ç¾¤è¿›è¡Œç›‘æ§</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/24-%E6%80%BB%E7%BB%93/">24 æ€»ç»“</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">05 åŠ¨æ‰‹å®è·µï¼šæ­å»ºä¸€ä¸ª Kubernetes é›†ç¾¤ - ç”Ÿäº§å¯ç”¨</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2021-12-22 01:47:31</span>ğŸ·ï¸&nbsp;<a class="post-tag" href="/tags/kubernetes/">kubernetes</a></div><div class="post-category">
                
                ğŸ“š&nbsp;<a href="/categories/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/">Kubernetesä»ä¸Šæ‰‹åˆ°å®è·µ</a>
                
            </div></div>
        <div class="post-content">
            <p>é€šè¿‡ä¸Šä¸€èŠ‚çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¿«é€Ÿçš„ä½¿ç”¨ <code>Minikube</code> æ­å»ºäº†ä¸€ä¸ªæœ¬åœ°å¯ç”¨çš„ K8S é›†ç¾¤ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒèŠ‚ç‚¹æ˜¯ä¸€ä¸ªè™šæ‹Ÿæœºå®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸Šé¢ä½“éªŒä¸€äº›åŸºæœ¬çš„åŠŸèƒ½ã€‚</p>
<p>å¤§å¤šæ•°äººçš„éœ€æ±‚å¹¶ä¸åªæ˜¯åŒ…å«ä¸€ä¸ªè™šæ‹ŸæœºèŠ‚ç‚¹çš„æœ¬åœ°æµ‹è¯•é›†ç¾¤ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯åœ¨æœåŠ¡å™¨è¿è¡Œï¼Œå¯è‡ªè¡Œæ‰©/ç¼©å®¹ï¼Œå…·å¤‡å…¨éƒ¨åŠŸèƒ½çš„ï¼Œè¾¾åˆ°ç”Ÿäº§å¯ç”¨çš„é›†ç¾¤ã€‚</p>
<p>K8S é›†ç¾¤çš„æ­å»ºï¼Œä¸€ç›´è®©å¾ˆå¤šäººå¤´ç–¼ï¼Œæœ¬èŠ‚æˆ‘ä»¬æ¥æ­å»ºä¸€ä¸ªç”Ÿäº§å¯ç”¨çš„é›†ç¾¤ï¼Œä¾¿äºåç»­çš„å­¦ä¹ æˆ–ä½¿ç”¨ã€‚</p>
<h2 id="æ–¹æ¡ˆé€‰æ‹©">æ–¹æ¡ˆé€‰æ‹©</h2>
<p>K8S ç”Ÿäº§ç¯å¢ƒå¯ç”¨çš„é›†ç¾¤æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œæœ¬èŠ‚æˆ‘ä»¬é€‰æ‹©ä¸€ä¸ª Kubernetes å®˜æ–¹æ¨èçš„æ–¹æ¡ˆ <code>kubeadm</code> è¿›è¡Œæ­å»ºã€‚</p>
<p><code>kubeadm</code> æ˜¯ Kubernetes å®˜æ–¹æä¾›çš„ä¸€ä¸ª CLI å·¥å…·ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„æ­å»ºä¸€å¥—ç¬¦åˆå®˜æ–¹æœ€ä½³å®è·µçš„æœ€å°åŒ–å¯ç”¨é›†ç¾¤ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ <code>kubeadm</code> æ­å»ºé›†ç¾¤æ—¶ï¼Œé›†ç¾¤å¯ä»¥é€šè¿‡ K8S çš„ä¸€è‡´æ€§æµ‹è¯•ï¼Œå¹¶ä¸” <code>kubeadm</code> è¿˜æ”¯æŒå…¶ä»–çš„é›†ç¾¤ç”Ÿå‘½å‘¨æœŸåŠŸèƒ½ï¼Œæ¯”å¦‚å‡çº§/é™çº§ç­‰ã€‚</p>
<p>æˆ‘ä»¬åœ¨æ­¤å¤„é€‰æ‹© <code>kubeadm</code> ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ä¸ç”¨è¿‡äºå…³æ³¨é›†ç¾¤çš„å†…éƒ¨ç»†èŠ‚ï¼Œä¾¿å¯ä»¥å¿«é€Ÿçš„æ­å»ºå‡ºç”Ÿäº§å¯ç”¨çš„é›†ç¾¤ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åç»­ç« èŠ‚çš„å­¦ä¹ ï¼Œå¿«é€Ÿä¸Šæ‰‹ K8S ï¼Œå¹¶å­¦ä¹ åˆ° K8S çš„å†…éƒ¨åŸç†ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæƒ³è¦åœ¨ç‰©ç†æœºä¸Šå®Œå…¨ä¸€æ­¥æ­¥æ­å»ºé›†ç¾¤ï¼Œä¾¿è½»è€Œæ˜“ä¸¾ã€‚</p>
<h2 id="å®‰è£…åŸºç¡€ç»„ä»¶">å®‰è£…åŸºç¡€ç»„ä»¶</h2>
<h3 id="å‰æœŸå‡†å¤‡">å‰æœŸå‡†å¤‡</h3>
<p>ä½¿ç”¨ <code>kubeadm</code> å‰ï¼Œæˆ‘ä»¬éœ€è¦æå‰åšä¸€äº›å‡†å¤‡ã€‚</p>
<ul>
<li>
<p><strong>æˆ‘ä»¬éœ€è¦ç¦ç”¨ swap</strong>ã€‚é€šè¿‡ä¹‹å‰çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æœ‰ä¸ªå¿…é¡»çš„ç»„ä»¶ï¼Œåä¸º <code>kubelet</code>ï¼Œè‡ª K8S 1.8 å¼€å§‹ï¼Œå¯åŠ¨ <code>kubelet</code> æ—¶ï¼Œéœ€è¦ç¦ç”¨ <code>swap</code> ã€‚æˆ–è€…éœ€è¦æ›´æ”¹ <code>kubelet</code> çš„å¯åŠ¨å‚æ•° <code>--fail-swap-on=false</code>ã€‚</p>
<p>è™½è¯´å¯ä»¥æ›´æ”¹å‚æ•°è®©å…¶å¯ç”¨ï¼Œä½†æ˜¯æˆ‘å»ºè®®è¿˜æ˜¯ç¦ç”¨ <code>swap</code> é™¤éä½ çš„é›†ç¾¤æœ‰ç‰¹æ®Šçš„éœ€æ±‚ï¼Œæ¯”å¦‚ï¼šæœ‰å¤§å†…å­˜ä½¿ç”¨çš„éœ€æ±‚ï¼Œä½†åˆæƒ³èŠ‚çº¦æˆæœ¬ï¼›æˆ–è€…ä½ çŸ¥é“ä½ å°†è¦åšä»€ä¹ˆï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°ä¸€äº›éé¢„æœŸçš„æƒ…å†µï¼Œå°¤å…¶æ˜¯åšäº†å†…å­˜é™åˆ¶çš„æ—¶å€™ï¼Œå½“æŸä¸ª Pod è¾¾åˆ°å†…å­˜é™åˆ¶çš„æ—¶å€™ï¼Œå®ƒå¯èƒ½ä¼šæº¢å‡ºåˆ° swap ä¸­ï¼Œè¿™ä¼šå¯¼è‡´ K8S æ— æ³•æ­£å¸¸è¿›è¡Œè°ƒåº¦ã€‚</p>
<p>å¦‚ä½•ç¦ç”¨ï¼š</p>
<ol>
<li>ä½¿ç”¨ <code>sudo cat /proc/swaps</code> éªŒè¯ swap é…ç½®çš„è®¾å¤‡å’Œæ–‡ä»¶ã€‚</li>
<li>é€šè¿‡ <code>swapoff -a</code> å…³é—­ swap ã€‚</li>
<li>ä½¿ç”¨ <code>sudo blkid</code> æˆ–è€… <code>sudo lsblk</code> å¯æŸ¥çœ‹åˆ°æˆ‘ä»¬çš„è®¾å¤‡å±æ€§ï¼Œè¯·æ³¨æ„è¾“å‡ºç»“æœä¸­å¸¦æœ‰ <code>swap</code> å­—æ ·çš„ä¿¡æ¯ã€‚</li>
<li>å°† <code>/etc/fstab</code> ä¸­å’Œä¸Šä¸€æ¡å‘½ä»¤ä¸­è¾“å‡ºçš„ï¼Œå’Œ swap ç›¸å…³çš„æŒ‚è½½ç‚¹éƒ½åˆ æ‰ï¼Œä»¥å…åœ¨æœºå™¨é‡å¯æˆ–é‡æŒ‚è½½æ—¶ï¼Œå†æŒ‚è½½ <code>swap</code> åˆ†åŒºã€‚</li>
</ol>
<p>æ‰§è¡Œå®Œä¸Šè¿°æ“ä½œï¼Œ<code>swap</code> ä¾¿ä¼šè¢«ç¦ç”¨ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å†æ¬¡é€šè¿‡ä¸Šè¿°å‘½ä»¤ï¼Œæˆ–è€… <code>free</code> å‘½ä»¤æ¥ç¡®è®¤æ˜¯å¦è¿˜æœ‰ <code>swap</code> å­˜åœ¨ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># free </span>
              total        used        free      shared  buff/cache   available
Mem:        <span style="color:#ae81ff">1882748</span>       <span style="color:#ae81ff">85608</span>     <span style="color:#ae81ff">1614836</span>       <span style="color:#ae81ff">16808</span>      <span style="color:#ae81ff">182304</span>     <span style="color:#ae81ff">1630476</span>
Swap:             <span style="color:#ae81ff">0</span>           <span style="color:#ae81ff">0</span>           <span style="color:#ae81ff">0</span>
</code></pre></div></li>
<li>
<p>é€šè¿‡ <code>sudo cat /sys/class/dmi/id/product_uuid</code> å¯æŸ¥çœ‹æœºå™¨çš„ <code>product_uuid</code> è¯·ç¡®ä¿è¦æ­å»ºé›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹çš„ <code>product_uuid</code> å‡ä¸ç›¸åŒã€‚åŒæ—¶æ‰€æœ‰èŠ‚ç‚¹çš„ Mac åœ°å€ä¹Ÿä¸èƒ½ç›¸åŒï¼Œé€šè¿‡ <code>ip a</code> æˆ–è€… <code>ifconfig -a</code> å¯è¿›è¡ŒæŸ¥çœ‹ã€‚</p>
<p>æˆ‘ä»¬åœ¨ç¬¬äºŒç« æåˆ°è¿‡ï¼Œæ¯ä¸ª Node éƒ½æœ‰ä¸€äº›ä¿¡æ¯ä¼šè¢«è®°å½•è¿›é›†ç¾¤å†…ï¼Œè€Œæ­¤å¤„æˆ‘ä»¬éœ€è¦ä¿è¯çš„è¿™äº›å”¯ä¸€çš„ä¿¡æ¯ï¼Œä¾¿ä¼šè®°å½•åœ¨é›†ç¾¤çš„ <code>nodeInfo</code> ä¸­ï¼Œæ¯”å¦‚ <code>product_uuid</code> åœ¨é›†ç¾¤å†…ä»¥ <code>systemUUID</code> æ¥è¡¨ç¤ºã€‚å…·ä½“ä¿¡æ¯æˆ‘ä»¬å¯ä»¥é€šè¿‡é›†ç¾¤çš„ <code>API Server</code> è·å–åˆ°ï¼Œåœ¨åé¢çš„ç« èŠ‚ä¼šè¯¦ç»†è®²è¿°ã€‚</p>
</li>
<li>
<p>ç¬¬ä¸‰ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»è°ˆè¿‡ K8S æ˜¯ C/S æ¶æ„ï¼Œåœ¨å¯åŠ¨åï¼Œä¼šå›ºå®šç›‘å¬ä¸€äº›ç«¯å£ç”¨äºæä¾›æœåŠ¡ã€‚å¯ä»¥é€šè¿‡ <code>sudo netstat -ntlp |grep -E '6443|23[79,80]|1025[0,1,2]'</code> æŸ¥çœ‹è¿™äº›ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼Œå¦‚æœè¢«å ç”¨ï¼Œè¯·æ‰‹åŠ¨é‡Šæ”¾ã€‚</p>
<p>å¦‚æœä½ æ‰§è¡Œä¸Šè¿°å‘½ä»¤æ—¶ï¼Œæç¤º <code>command not found</code>ï¼Œåˆ™è¡¨æ˜ä½ éœ€è¦å…ˆå®‰è£… <code>netstat</code>ï¼Œåœ¨ CentOS ç³»ç»Ÿä¸­éœ€è¦é€šè¿‡ <code>sudo yum install net-tools</code> å®‰è£…ï¼Œè€Œåœ¨ Debian/Ubuntu ç³»ç»Ÿä¸­ï¼Œåˆ™éœ€è¦é€šè¿‡ <code>sudo apt install net-tools</code> è¿›è¡Œå®‰è£…ã€‚</p>
</li>
<li>
<p>å‰é¢æˆ‘ä»¬ä¹Ÿæåˆ°äº†ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®¹å™¨è¿è¡Œæ—¶ï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯ <code>Docker</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<a href="https://docs.docker.com/install/overview/">å®˜æ–¹çš„ Docker æ–‡æ¡£</a> è¿›è¡Œå®‰è£…ï¼Œå®‰è£…å®Œæˆåè®°å¾—å¯åŠ¨æœåŠ¡ã€‚</p>
<p>å®˜æ–¹æ¨èä½¿ç”¨ <code>17.03</code> ï¼Œä½†æˆ‘å»ºè®®ä½ å¯ä»¥ç›´æ¥å®‰è£… <code>18.03</code> æˆ–è€…æ›´æ–°çš„ç‰ˆæœ¬ï¼Œå› ä¸º <code>17.03</code> ç‰ˆæœ¬çš„ Docker å·²ç»åœ¨ 2018 å¹´ 3 æœˆ <code>EOL</code>ï¼ˆEnd Of Lifeï¼‰äº†ã€‚å¯¹äºæ›´æ–°ç‰ˆæœ¬çš„ Dockerï¼Œè™½ç„¶ K8S å°šæœªåœ¨æ–°ç‰ˆæœ¬ä¸­ç»è¿‡å¤§é‡æµ‹è¯•ï¼Œä½†æ¯•ç«Ÿæ–°ç‰ˆæœ¬æœ‰å¾ˆå¤š Bugfix å’Œæ–°ç‰¹æ€§çš„å¢åŠ ï¼Œä¹Ÿèƒ½è§„é¿ä¸€äº›å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼ˆæ¯”å¦‚ä¸ªåˆ«æƒ…å†µä¸‹ container ä¸ä¼šè‡ªåŠ¨åˆ é™¤çš„æƒ…å†µ (17.09) ï¼‰ã€‚</p>
<p>å¦å¤–ï¼Œç”±äº Docker çš„ API éƒ½æ˜¯å¸¦æœ‰ç‰ˆæœ¬çš„ï¼Œä¸”æœ‰è‰¯å¥½çš„å…¼å®¹æ€§ï¼Œå½“ä½¿ç”¨ä½ç‰ˆæœ¬ API è¯·æ±‚æ—¶ä¼šè‡ªåŠ¨é™çº§ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ã€‚</p>
</li>
</ul>
<h3 id="å®‰è£…-kubectl">å®‰è£… kubectl</h3>
<p>ç¬¬ä¸‰ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»è¯´è¿‡ <code>kubectl</code> æ˜¯é›†ç¾¤çš„å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬ç°åœ¨æ­å»ºé›†ç¾¤æ—¶ï¼Œä¹Ÿå¿…é¡»è¦å®‰è£…å®ƒï¼Œç”¨äºéªŒè¯é›†ç¾¤åŠŸèƒ½ã€‚</p>
<p>å®‰è£…æ­¥éª¤åœ¨ç¬¬ 4 ç« å·²ç»è¯¦ç»†è¯´æ˜äº†ï¼Œæ­¤å¤„ä¸åšèµ˜è¿°ï¼Œå¯æŸ¥é˜…ç¬¬ 4 ç« æˆ–å‚è€ƒä¸‹é¢çš„å†…å®¹ã€‚</p>
<h3 id="å®‰è£…-kubeadm-å’Œ-kubelet">å®‰è£… kubeadm å’Œ kubelet</h3>
<p>é¦–å…ˆæ˜¯ç‰ˆæœ¬çš„é€‰æ‹©ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è·å–åˆ°å½“å‰çš„ stable ç‰ˆæœ¬å·ã€‚è¦è®¿é—®è¿™ä¸ªåœ°å€ï¼Œéœ€è¦è‡ªè¡Œå¤„ç†ç½‘ç»œé—®é¢˜æˆ–ä½¿ç”¨æˆ‘åé¢æä¾›çš„è§£å†³åŠæ³•ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># curl -sSL https://dl.k8s.io/release/stable.txt</span>
v1.11.3
</code></pre></div><p>ä¸‹è½½äºŒè¿›åˆ¶åŒ…ï¼Œå¹¶é€šè¿‡ <code>kubeadm version</code> éªŒè¯ç‰ˆæœ¬æ˜¯å¦æ­£ç¡®ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># curl -sSL https://dl.k8s.io/release/v1.11.3/bin/linux/amd64/kubeadm &gt; /usr/bin/kubeadm</span>
<span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># chmod a+rx /usr/bin/kubeadm</span>
<span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubeadm version</span>
kubeadm version: &amp;version.Info<span style="color:#f92672">{</span>Major:<span style="color:#e6db74">&#34;1&#34;</span>, Minor:<span style="color:#e6db74">&#34;11&#34;</span>, GitVersion:<span style="color:#e6db74">&#34;v1.11.3&#34;</span>, GitCommit:<span style="color:#e6db74">&#34;a4529464e4629c21224b3d52edfe0ea91b072862&#34;</span>, GitTreeState:<span style="color:#e6db74">&#34;clean&#34;</span>, BuildDate:<span style="color:#e6db74">&#34;2018-09-09T17:59:42Z&#34;</span>, GoVersion:<span style="color:#e6db74">&#34;go1.10.3&#34;</span>, Compiler:<span style="color:#e6db74">&#34;gc&#34;</span>, Platform:<span style="color:#e6db74">&#34;linux/amd64&#34;</span><span style="color:#f92672">}</span>
</code></pre></div><p>å½“ç„¶ï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥ä½¿ç”¨å¦‚åŒä¸Šä¸€ç« çš„æ–¹å¼ï¼Œç›´æ¥è¿›å…¥åˆ° <code>kubernetes</code> çš„<a href="https://github.com/kubernetes/kubernetes">å®˜æ–¹ä»“åº“</a>ï¼Œæ‰¾åˆ°æˆ‘ä»¬æ‰€éœ€ç‰ˆæœ¬ <a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.11.md#v1113">v1.11.3</a> ä¸‹è½½ <code>Server Binaries</code>ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/images/f8114776ca20ed8e5ea31dd0dc11a5ca6fb036b7334a2b3bb76d90d29fe6039b.png" alt="picture 5"></p>
<p>ç»ˆç«¯ä¸‹å¯ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ä¸‹è½½ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@master tmp<span style="color:#f92672">]</span><span style="color:#75715e"># wget -q https://dl.k8s.io/v1.11.3/kubernetes-server-linux-amd64.tar.gz</span>
</code></pre></div><p><strong>å¯¹äºå›½å†…ç”¨æˆ·ï¼Œæˆ‘å·²ç»å‡†å¤‡äº†ä¸‹é¢çš„æ–¹å¼ï¼Œæ–¹ä¾¿ä½¿ç”¨ã€‚</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">é“¾æ¥: https://pan.baidu.com/s/1FSEcEUplQQGsjyBIZ6j2fA æå–ç : cu4s
</code></pre></div><p>ä¸‹è½½å®Œæˆåï¼ŒéªŒè¯æ–‡ä»¶æ˜¯å¦æ­£ç¡®æ— è¯¯ï¼ŒéªŒè¯é€šè¿‡åè¿›è¡Œè§£å‹ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@master tmp<span style="color:#f92672">]</span><span style="color:#75715e"># echo &#39;e49d0db1791555d73add107d2110d54487df538b35b9dde0c5590ac4c5e9e039 kubernetes-server-linux-amd64.tar.gz&#39; | sha256sum -c -</span>
kubernetes-server-linux-amd64.tar.gz: ç¡®å®š
<span style="color:#f92672">[</span>root@master tmp<span style="color:#f92672">]</span><span style="color:#75715e"># tar -zxf kubernetes-server-linux-amd64.tar.gz</span>
<span style="color:#f92672">[</span>root@master tmp<span style="color:#f92672">]</span><span style="color:#75715e"># ls kubernetes</span>
addons  kubernetes-src.tar.gz  LICENSES  server
<span style="color:#f92672">[</span>root@master tmp<span style="color:#f92672">]</span><span style="color:#75715e"># ls kubernetes/server/bin/ | grep -E &#39;kubeadm|kubelet|kubectl&#39;</span>
kubeadm
kubectl
kubelet
</code></pre></div><p>å¯ä»¥çœ‹åˆ°åœ¨ <code>server/bin/</code> ç›®å½•ä¸‹æœ‰æˆ‘ä»¬æ‰€éœ€è¦çš„å…¨éƒ¨å†…å®¹ï¼Œå°†æˆ‘ä»¬æ‰€éœ€è¦çš„ <code>kubeadm</code> <code>kubectl</code> <code>kubelet</code> ç­‰éƒ½ç§»åŠ¨è‡³ <code>/usr/bin</code> ç›®å½•ä¸‹ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@master tmp<span style="color:#f92672">]</span><span style="color:#75715e"># mv kubernetes/server/bin/kube{adm,ctl,let} /usr/bin/</span>
<span style="color:#f92672">[</span>root@master tmp<span style="color:#f92672">]</span><span style="color:#75715e"># ls /usr/bin/kube*</span>
/usr/bin/kubeadm  /usr/bin/kubectl  /usr/bin/kubelet
<span style="color:#f92672">[</span>root@master tmp<span style="color:#f92672">]</span><span style="color:#75715e"># kubeadm version</span>
kubeadm version: &amp;version.Info<span style="color:#f92672">{</span>Major:<span style="color:#e6db74">&#34;1&#34;</span>, Minor:<span style="color:#e6db74">&#34;11&#34;</span>, GitVersion:<span style="color:#e6db74">&#34;v1.11.3&#34;</span>, GitCommit:<span style="color:#e6db74">&#34;a4529464e4629c21224b3d52edfe0ea91b072862&#34;</span>, GitTreeState:<span style="color:#e6db74">&#34;clean&#34;</span>, BuildDate:<span style="color:#e6db74">&#34;2018-09-09T17:59:42Z&#34;</span>, GoVersion:<span style="color:#e6db74">&#34;go1.10.3&#34;</span>, Compiler:<span style="color:#e6db74">&#34;gc&#34;</span>, Platform:<span style="color:#e6db74">&#34;linux/amd64&#34;</span><span style="color:#f92672">}</span>
<span style="color:#f92672">[</span>root@master tmp<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl version --client</span>
Client Version: version.Info<span style="color:#f92672">{</span>Major:<span style="color:#e6db74">&#34;1&#34;</span>, Minor:<span style="color:#e6db74">&#34;11&#34;</span>, GitVersion:<span style="color:#e6db74">&#34;v1.11.3&#34;</span>, GitCommit:<span style="color:#e6db74">&#34;a4529464e4629c21224b3d52edfe0ea91b072862&#34;</span>, GitTreeState:<span style="color:#e6db74">&#34;clean&#34;</span>, BuildDate:<span style="color:#e6db74">&#34;2018-09-09T18:02:47Z&#34;</span>, GoVersion:<span style="color:#e6db74">&#34;go1.10.3&#34;</span>, Compiler:<span style="color:#e6db74">&#34;gc&#34;</span>, Platform:<span style="color:#e6db74">&#34;linux/amd64&#34;</span><span style="color:#f92672">}</span>
<span style="color:#f92672">[</span>root@master tmp<span style="color:#f92672">]</span><span style="color:#75715e"># kubelet --version</span>
Kubernetes v1.11.3
</code></pre></div><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ‰€éœ€çš„ç»„ä»¶ï¼Œç‰ˆæœ¬å‡ä¸º <code>v1.11.3</code> ã€‚</p>
<h2 id="é…ç½®">é…ç½®</h2>
<p>ä¸ºäº†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¿éšœå„ç»„ä»¶çš„ç¨³å®šè¿è¡Œï¼ŒåŒæ—¶ä¹Ÿä¸ºäº†ä¾¿äºç®¡ç†ï¼Œæˆ‘ä»¬å¢åŠ å¯¹ <code>kubelet</code> çš„ <code>systemd</code> çš„é…ç½®ï¼Œç”± <code>systemd</code> å¯¹æœåŠ¡è¿›è¡Œç®¡ç†ã€‚</p>
<h3 id="é…ç½®-kubelet">é…ç½® kubelet</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@master tmp<span style="color:#f92672">]</span><span style="color:#75715e"># cat &lt;&lt;&#39;EOF&#39; &gt; /etc/systemd/system/kubelet.service</span>
<span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
Description<span style="color:#f92672">=</span>kubelet: The Kubernetes Agent
Documentation<span style="color:#f92672">=</span>http://kubernetes.io/docs/

<span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
ExecStart<span style="color:#f92672">=</span>/usr/bin/kubelet
Restart<span style="color:#f92672">=</span>always
StartLimitInterval<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
RestartSec<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>

<span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
WantedBy<span style="color:#f92672">=</span>multi-user.target
EOF
<span style="color:#f92672">[</span>root@master tmp<span style="color:#f92672">]</span><span style="color:#75715e"># mkdir -p /etc/systemd/system/kubelet.service.d</span>
<span style="color:#f92672">[</span>root@master tmp<span style="color:#f92672">]</span><span style="color:#75715e"># cat &lt;&lt;&#39;EOF&#39; &gt; /etc/systemd/system/kubelet.service.d/kubeadm.conf</span>
<span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
Environment<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf&#34;</span>
Environment<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml&#34;</span>
EnvironmentFile<span style="color:#f92672">=</span>-/var/lib/kubelet/kubeadm-flags.env
EnvironmentFile<span style="color:#f92672">=</span>-/etc/default/kubelet
ExecStart<span style="color:#f92672">=</span>
ExecStart<span style="color:#f92672">=</span>/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_KUBEADM_ARGS $KUBELET_EXTRA_ARGS
EOF
<span style="color:#f92672">[</span>root@master tmp<span style="color:#f92672">]</span><span style="color:#75715e"># systemctl enable kubelet</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/kubelet.service to /etc/systemd/system/kubelet.service.
</code></pre></div><p>åœ¨è¿™é‡Œæˆ‘ä»¬æ·»åŠ äº† <code>kubelet</code> çš„ systemd é…ç½®ï¼Œç„¶åæ·»åŠ äº†å®ƒçš„ <code>Drop-in</code> æ–‡ä»¶ï¼Œæˆ‘ä»¬å¢åŠ çš„è¿™ä¸ª <code>kubeadm.conf</code> æ–‡ä»¶ï¼Œä¼šè¢« systemd è‡ªåŠ¨è§£æï¼Œç”¨äºå¤å†™ <code>kubelet</code> çš„åŸºç¡€ systemd é…ç½®ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¢åŠ äº†ä¸€ç³»åˆ—çš„é…ç½®å‚æ•°ã€‚åœ¨ç¬¬ 17 ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šå¯¹ <code>kubelet</code> åšè¯¦ç»†å‰–æï¼Œåˆ°æ—¶å†è¿›è¡Œè§£é‡Šã€‚</p>
<h2 id="å¯åŠ¨">å¯åŠ¨</h2>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬çš„å‰æœŸå‡†å¤‡å·²ç»åŸºæœ¬å®Œæˆï¼Œå¯ä»¥ä½¿ç”¨ <code>kubeadm</code> æ¥åˆ›å»ºé›†ç¾¤äº†ã€‚åˆ«ç€æ€¥ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®‰è£…ä¸¤ä¸ªå·¥å…·ï¼Œåä¸º<code>crictl</code> å’Œ <code>socat</code>ã€‚</p>
<h3 id="å®‰è£…å‰ç½®ä¾èµ–-crictl">å®‰è£…å‰ç½®ä¾èµ– crictl</h3>
<p><code>crictl</code> åŒ…å«åœ¨ <a href="https://github.com/kubernetes-sigs/cri-tools.git"><code>cri-tools</code></a> é¡¹ç›®ä¸­ï¼Œè¿™ä¸ªé¡¹ç›®ä¸­åŒ…å«ä¸¤ä¸ªå·¥å…·ï¼š</p>
<ul>
<li><code>crictl</code> æ˜¯ <code>kubelet</code> CRI (Container Runtime Interface) çš„ CLI ã€‚</li>
<li><code>critest</code> æ˜¯ <code>kubelet</code> CRI çš„æµ‹è¯•å·¥å…·é›†ã€‚</li>
</ul>
<p>å®‰è£…å¯ä»¥é€šè¿‡è¿›å…¥ <code>cri-tools</code> é¡¹ç›®çš„ <a href="https://github.com/kubernetes-sigs/cri-tools/releases">Release é¡µé¢</a> ï¼Œæ ¹æ®é¡¹ç›® <a href="https://github.com/kubernetes-sigs/cri-tools#current-status">README</a> æ–‡ä»¶ä¸­çš„ç‰ˆæœ¬å…¼å®¹å…³ç³»ï¼Œé€‰æ‹©è‡ªå·±æ‰€éœ€çš„å®‰è£…åŒ…ï¼Œä¸‹è½½å³å¯ï¼Œç”±äºæˆ‘ä»¬å®‰è£… K8S 1.11.3 æ‰€ä»¥é€‰æ‹©æœ€æ–°çš„ v1.11.x çš„å®‰è£…åŒ…ã€‚</p>
<p><img src="/images/8dc3cc47fd2e7568491ad3fd4cf8407186bd77df5f07184a54b3e1ddf8c2d609.png" alt="picture 6"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># wget https://github.com/kubernetes-sigs/cri-tools/releases/download/v1.11.1/crictl-v1.11.1-linux-amd64.tar.gz</span>
<span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># echo &#39;ccf83574556793ceb01717dc91c66b70f183c60c2bbec70283939aae8fdef768 crictl-v1.11.1-linux-amd64.tar.gz&#39; | sha256sum -c -</span>
crictl-v1.11.1-linux-amd64.tar.gz: ç¡®å®š
<span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># tar zxvf crictl-v1.11.1-linux-amd64.tar.gz</span>
<span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># mv crictl /usr/bin/</span>
</code></pre></div><h3 id="å®‰è£…å‰ç½®ä¾èµ–-socat">å®‰è£…å‰ç½®ä¾èµ– socat</h3>
<p><code>socat</code> æ˜¯ä¸€æ¬¾å¾ˆå¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥å»ºç«‹ä¸¤ä¸ªåŒå‘å­—èŠ‚æµå¹¶åœ¨å…¶ä¸­ä¼ è¾“æ•°æ®ã€‚è¿™ä¹ˆè¯´ä½ ä¹Ÿè®¸ä¸å¤ªç†è§£ï¼Œç®€å•ç‚¹è¯´ï¼Œå®ƒå…¶ä¸­çš„ä¸€ä¸ªåŠŸèƒ½æ˜¯å¯ä»¥å®ç°ç«¯å£è½¬å‘ã€‚</p>
<p>æ— è®ºåœ¨ K8S ä¸­ï¼Œè¿˜æ˜¯åœ¨ Docker ä¸­ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨å¤–éƒ¨è®¿é—®æœåŠ¡ï¼Œç«¯å£è½¬å‘æ˜¯ä¸ªå¿…ä¸å¯å°‘çš„éƒ¨åˆ†ã€‚å½“ç„¶ï¼Œä½ å¯èƒ½ä¼šé—®åŸºæœ¬ä¸Šæ²¡æœ‰ä»»ä½•åœ°æ–¹æåˆ°è¯´ <code>socat</code> æ˜¯ä¸€ä¸ªä¾èµ–é¡¹å•Šï¼Œåˆ«æ€¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ <a href="https://github.com/kubernetes/kubernetes/blob/master/pkg/kubelet/dockershim/docker_streaming.go#L189-L192">K8S çš„æºç </a>ä¾¿çŸ¥é“äº†ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">func portForward<span style="color:#f92672">(</span>client libdocker.Interface, podSandboxID string, port int32, stream io.ReadWriteCloser<span style="color:#f92672">)</span> error <span style="color:#f92672">{</span>
    // çœç•¥äº†å’Œ socat æ— å…³çš„ä»£ç 

socatPath, lookupErr :<span style="color:#f92672">=</span> exec.LookPath<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;socat&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">if</span> lookupErr !<span style="color:#f92672">=</span> nil <span style="color:#f92672">{</span>
<span style="color:#66d9ef">return</span> fmt.Errorf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;unable to do port forwarding: socat not found.&#34;</span><span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>

args :<span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>string<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;-t&#34;</span>, fmt.Sprintf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%d&#34;</span>, containerPid<span style="color:#f92672">)</span>, <span style="color:#e6db74">&#34;-n&#34;</span>, socatPath, <span style="color:#e6db74">&#34;-&#34;</span>, fmt.Sprintf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TCP4:localhost:%d&#34;</span>, port<span style="color:#f92672">)}</span>

    // ...
<span style="color:#f92672">}</span>
</code></pre></div><p><code>socat</code> çš„å®‰è£…å¾ˆç®€å• CentOS ä¸‹æ‰§è¡Œ <code>sudo yum install -y socat</code> ï¼ŒDebian/Ubuntu ä¸‹æ‰§è¡Œ <code>sudo apt-get install -y socat</code> å³å¯å®Œæˆå®‰è£…ã€‚</p>
<h3 id="åˆå§‹åŒ–é›†ç¾¤">åˆå§‹åŒ–é›†ç¾¤</h3>
<p>æ‰€æœ‰çš„å‡†å¤‡å·¥ä½œå·²ç»å®Œæˆï¼Œæˆ‘ä»¬å¼€å§‹çœŸæ­£åˆ›å»ºä¸€ä¸ª K8S é›†ç¾¤ã€‚ <strong>æ³¨æ„ï¼šå¦‚æœéœ€è¦é…ç½® Pod ç½‘ç»œæ–¹æ¡ˆï¼Œè¯·å…ˆé˜…è¯»æœ¬ç« æœ€åçš„éƒ¨åˆ† é…ç½®é›†ç¾¤ç½‘ç»œ</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubeadm init                                                                                             </span>
<span style="color:#f92672">[</span>init<span style="color:#f92672">]</span> using Kubernetes version: v1.11.3               
<span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> running pre-flight checks
...
I0920 01:09:09.602908   <span style="color:#ae81ff">17966</span> kernel_validator.go:81<span style="color:#f92672">]</span> Validating kernel version
I0920 01:09:09.603001   <span style="color:#ae81ff">17966</span> kernel_validator.go:96<span style="color:#f92672">]</span> Validating kernel config
        <span style="color:#f92672">[</span>WARNING SystemVerification<span style="color:#f92672">]</span>: docker version is greater than the most recently validated version. Docker version: 18.03.1-ce. Max validated version: 17.03
<span style="color:#f92672">[</span>preflight/images<span style="color:#f92672">]</span> Pulling images required <span style="color:#66d9ef">for</span> setting up a Kubernetes cluster
<span style="color:#f92672">[</span>preflight/images<span style="color:#f92672">]</span> This might take a minute or two, depending on the speed of your internet connection
<span style="color:#f92672">[</span>preflight/images<span style="color:#f92672">]</span> You can also perform this action in beforehand using <span style="color:#e6db74">&#39;kubeadm config images pull&#39;</span>
<span style="color:#f92672">[</span>kubelet<span style="color:#f92672">]</span> Writing kubelet environment file with flags to file <span style="color:#e6db74">&#34;/var/lib/kubelet/kubeadm-flags.env&#34;</span>
<span style="color:#f92672">[</span>kubelet<span style="color:#f92672">]</span> Writing kubelet configuration to file <span style="color:#e6db74">&#34;/var/lib/kubelet/config.yaml&#34;</span>
<span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> Activating the kubelet service
<span style="color:#f92672">[</span>certificates<span style="color:#f92672">]</span> Generated ca certificate and key.
<span style="color:#f92672">[</span>certificates<span style="color:#f92672">]</span> Generated apiserver certificate and key.
...
<span style="color:#f92672">[</span>markmaster<span style="color:#f92672">]</span> Marking the node master as master by adding the label <span style="color:#e6db74">&#34;node-role.kubernetes.io/master=&#39;&#39;&#34;</span>
<span style="color:#f92672">[</span>markmaster<span style="color:#f92672">]</span> Marking the node master as master by adding the taints <span style="color:#f92672">[</span>node-role.kubernetes.io/master:NoSchedule<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>bootstraptoken<span style="color:#f92672">]</span> creating the <span style="color:#e6db74">&#34;cluster-info&#34;</span> ConfigMap in the <span style="color:#e6db74">&#34;kube-public&#34;</span> namespace
<span style="color:#f92672">[</span>addons<span style="color:#f92672">]</span> Applied essential addon: CoreDNS
<span style="color:#f92672">[</span>addons<span style="color:#f92672">]</span> Applied essential addon: kube-proxy

Your Kubernetes master has initialized successfully!

...

You can now join any number of machines by running the following on each node
as root:

  kubeadm join 202.182.112.120:6443 --token t14kzc.vjurhx5k98dpzqdc --discovery-token-ca-cert-hash sha256:d64f7ce1af9f9c0c73d2d737fd0095456ad98a2816cb5527d55f984c8aa8a762
</code></pre></div><p>ä»¥ä¸Šçœç•¥äº†éƒ¨åˆ†è¾“å‡ºã€‚</p>
<p>æˆ‘ä»¬ä»ä»¥ä¸Šæ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»ºé›†ç¾¤æ—¶ä¼šæ£€æŸ¥å†…æ ¸ç‰ˆæœ¬ï¼ŒDocker ç‰ˆæœ¬ç­‰ä¿¡æ¯ï¼Œè¿™é‡Œæç¤º Docker ç‰ˆæœ¬è¾ƒé«˜ï¼Œæˆ‘ä»¬å¿½ç•¥è¿™ä¸ªæç¤ºã€‚</p>
<p>ç„¶åä¼šä¸‹è½½ä¸€äº›é•œåƒï¼Œå½“ç„¶è¿™é‡Œæç¤ºæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œ <code>kubeadm config images pull</code> æå‰å»ä¸‹è½½é•œåƒã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubeadm config images pull</span>
<span style="color:#f92672">[</span>config/images<span style="color:#f92672">]</span> Pulled k8s.gcr.io/kube-apiserver-amd64:v1.11.3
<span style="color:#f92672">[</span>config/images<span style="color:#f92672">]</span> Pulled k8s.gcr.io/kube-controller-manager-amd64:v1.11.3
<span style="color:#f92672">[</span>config/images<span style="color:#f92672">]</span> Pulled k8s.gcr.io/kube-scheduler-amd64:v1.11.3
<span style="color:#f92672">[</span>config/images<span style="color:#f92672">]</span> Pulled k8s.gcr.io/kube-proxy-amd64:v1.11.3
<span style="color:#f92672">[</span>config/images<span style="color:#f92672">]</span> Pulled k8s.gcr.io/pause:3.1
<span style="color:#f92672">[</span>config/images<span style="color:#f92672">]</span> Pulled k8s.gcr.io/etcd-amd64:3.2.18
<span style="color:#f92672">[</span>config/images<span style="color:#f92672">]</span> Pulled k8s.gcr.io/coredns:1.1.3
</code></pre></div><p>å¯¹äºå›½å†…ç”¨æˆ·ä½¿ç”¨ <code>kubeadm</code> åˆ›å»ºé›†ç¾¤æ—¶ï¼Œå¯èƒ½é‡åˆ°çš„é—®é¢˜ä¾¿æ˜¯è¿™äº›é•œåƒä¸‹è½½ä¸ä¸‹æ¥ï¼Œæœ€ç»ˆå¯¼è‡´åˆ›å»ºå¤±è´¥ã€‚æ‰€ä»¥æˆ‘åœ¨å›½å†…çš„ä»£ç æ‰˜ç®¡å¹³å°æä¾›äº†ä¸€ä¸ª<a href="https://gitee.com/K8S-release/kubeadm">ä»“åº“</a> å¯ä»¥ clone è¯¥é¡¹ç›®ï¼Œè¿›å…¥ <code>v1.11.3</code> ç›®å½•ï¼Œå¯¹æ¯ä¸ª <code>tar</code> æ–‡ä»¶æ‰§è¡Œ <code>sudo docker load -i xx.tar</code> å³å¯å°†é•œåƒå¯¼å…¥ã€‚</p>
<p>æˆ–è€…å¯ä½¿ç”¨<a href="https://dev.aliyun.com/list.html?namePrefix=google-containers">é˜¿é‡Œäº‘æä¾›çš„é•œåƒ</a>ï¼Œåªéœ€è¦å°† <code>k8s.gcr.io</code> æ›¿æ¢ä¸º <code>registry.aliyuncs.com/google_containers</code> ï¼Œæ‰§è¡Œ <code>docker pull</code> åå† <code>docker tag</code> é‡ tag å³å¯ã€‚</p>
<p>ç»§ç»­çœ‹ä¸Šé¢çš„æ—¥å¿—ï¼Œ<code>kubeadm init</code> æ‰§è¡Œèµ·è§ç”Ÿæˆäº†ä¸€äº›æ–‡ä»¶ï¼Œè€Œè¿™äº›æ–‡ä»¶æˆ‘ä»¬å…ˆå‰åœ¨ kubelet server çš„ <code>Drop-in</code> çš„é…ç½®ä¸­é…ç½®è¿‡ã€‚</p>
<p>ç”Ÿæˆè¿™äº›é…ç½®æ–‡ä»¶åï¼Œå°†å¯åŠ¨ <code>kubelet</code> æœåŠ¡ï¼Œç”Ÿæˆä¸€ç³»åˆ—çš„è¯ä¹¦å’Œç›¸å…³çš„é…ç½®ä¹‹ç±»çš„ï¼Œå¹¶å¢åŠ ä¸€äº›æ‰©å±•ã€‚</p>
<p>æœ€ç»ˆé›†ç¾¤åˆ›å»ºæˆåŠŸï¼Œå¹¶æç¤ºå¯åœ¨ä»»æ„æœºå™¨ä¸Šä½¿ç”¨æŒ‡å®šå‘½ä»¤åŠ å…¥é›†ç¾¤ã€‚</p>
<h2 id="éªŒè¯">éªŒè¯</h2>
<p>åœ¨ä¸Šé¢çš„æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å·²ç»å®‰è£…äº† K8S çš„ CLI å·¥å…· <code>kubectl</code>ï¼Œæˆ‘ä»¬ä½¿ç”¨æ­¤å·¥å…·æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl cluster-info</span>
Kubernetes master is running at http://localhost:8080

To further debug and diagnose cluster problems, use <span style="color:#e6db74">&#39;kubectl cluster-info dump&#39;</span>.
The connection to the server localhost:8080 was refused - did you specify the right host or port?
<span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get nodes</span>
The connection to the server localhost:8080 was refused - did you specify the right host or port?
</code></pre></div><p>ä½¿ç”¨ <code>kubectl cluster-info</code> å¯æŸ¥çœ‹é›†ç¾¤ master å’Œé›†ç¾¤æœåŠ¡çš„åœ°å€ï¼Œä½†æˆ‘ä»¬ä¹Ÿæ³¨æ„åˆ°æœ€åæœ‰ä¸€å¥æŠ¥é”™ <code>connection ... refused</code> å¾ˆæ˜¾ç„¶è¿™é‡Œå­˜åœ¨é”™è¯¯ã€‚</p>
<p><code>kubectl get nodes</code> å¯æŸ¥çœ‹é›†ç¾¤ä¸­ <code>Node</code> ä¿¡æ¯ï¼ŒåŒæ ·æŠ¥é”™ã€‚</p>
<p>åœ¨ä¸Šé¢æˆ‘ä»¬æåˆ°è¿‡ï¼ŒK8S é»˜è®¤ä¼šç›‘å¬ä¸€äº›ç«¯å£ï¼Œä½†å¹¶ä¸æ˜¯ <code>8080</code> ç«¯å£ï¼Œç”±æ­¤å¯çŸ¥ï¼Œæˆ‘ä»¬çš„ <code>kubectl</code> é…ç½®æœ‰è¯¯ã€‚</p>
<h3 id="é…ç½®-kubectl">é…ç½® kubectl</h3>
<ul>
<li>
<p>ä½¿ç”¨ <code>kubectl</code> çš„å‚æ•° <code>--kubeconfig</code> æˆ–è€…ç¯å¢ƒå˜é‡ <code>KUBECONFIG</code> ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl --kubeconfig /etc/kubernetes/admin.conf get nodes                                                </span>
NAME      STATUS     ROLES     AGE       VERSION
master    NotReady   master    13h       v1.11.3
<span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
<span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># KUBECONFIG=/etc/kubernetes/admin.conf kubectl get nodes                                                  </span>
NAME      STATUS     ROLES     AGE       VERSION
master    NotReady   master    13h       v1.11.3
</code></pre></div></li>
<li>
<p>ä½¿ç”¨ä¼ å‚çš„æ–¹å¼æœªå…å¤ªç¹çï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ›´æ”¹é»˜è®¤é…ç½®æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># mkdir -p $HOME/.kube</span>
<span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span>
<span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># sudo chown $(id -u):$(id -g) $HOME/.kube/config</span>
<span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get nodes                                                  </span>
NAME      STATUS     ROLES     AGE       VERSION
master    NotReady   master    13h       v1.11.3
</code></pre></div></li>
</ul>
<h3 id="é…ç½®é›†ç¾¤ç½‘ç»œ">é…ç½®é›†ç¾¤ç½‘ç»œ</h3>
<p>é€šè¿‡ä¸Šé¢çš„é…ç½®ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥æ­£å¸¸è·å– <code>Node</code> ä¿¡æ¯ã€‚ä½†é€šè¿‡ç¬¬ 2 ç« ï¼Œæˆ‘ä»¬äº†è§£åˆ° <code>Node</code> éƒ½æœ‰ <code>status</code>ï¼Œè€Œæ­¤æ—¶æˆ‘ä»¬å”¯ä¸€çš„ <code>Node</code> æ˜¯ <code>NotReady</code>ã€‚æˆ‘ä»¬é€šè¿‡ç»™ <code>kubectl</code> ä¼ é€’ <code>-o</code> å‚æ•°æ›´æ”¹è¾“å‡ºæ ¼å¼ï¼ŒæŸ¥çœ‹æ›´è¯¦ç»†çš„æƒ…å†µã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get nodes -o yaml</span>
apiVersion: v1       
items:                                       
- apiVersion: v1                              
  kind: Node
  ...
  status:
    addresses:
    - address: master
      type: Hostname
    ...
    - lastHeartbeatTime: 2018-09-20T14:45:45Z
      lastTransitionTime: 2018-09-20T01:09:48Z
      message: <span style="color:#e6db74">&#39;runtime network not ready: NetworkReady=false reason:NetworkPluginNotReady
</span><span style="color:#e6db74">        message:docker: network plugin is not ready: cni config uninitialized&#39;</span>
      reason: KubeletNotReady
      status: <span style="color:#e6db74">&#34;False&#34;</span>
      type: Ready
    ...
</code></pre></div><p>ä»ä»¥ä¸Šè¾“å‡ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° master å¤„äº <code>NotReady</code> çš„åŸå› æ˜¯ <code>network plugin is not ready: cni config uninitialized</code> é‚£ä¹ˆ <code>CNI</code> æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<code>CNI</code> æ˜¯ Container Network Interface çš„ç¼©å†™ï¼Œæ˜¯ K8S ç”¨äºé…ç½® Linux å®¹å™¨ç½‘ç»œçš„æ¥å£è§„èŒƒã€‚</p>
<p>å…³äºç½‘ç»œçš„é€‰æ‹©ï¼Œæˆ‘ä»¬æ­¤å¤„ä¸åšè¿‡å¤šä»‹ç»ï¼Œæˆ‘ä»¬æš‚æ—¶é€‰æ‹©ä¸€ä¸ªè¢«å¹¿æ³›ä½¿ç”¨çš„æ–¹æ¡ˆ <code>flannel</code>ã€‚ ä½†æ³¨æ„ï¼Œå¦‚æœè¦ä½¿ç”¨ <code>flannel</code> éœ€è¦åœ¨ <code>kubeadm init</code> çš„æ—¶å€™ï¼Œä¼ é€’ <code>--pod-network-cidr=10.244.0.0/16</code> å‚æ•°ã€‚å¦å¤–éœ€è¦æŸ¥çœ‹ <code>/proc/sys/net/bridge/bridge-nf-call-iptables</code> æ˜¯å¦å·²è®¾ç½®ä¸º <code>1</code>ã€‚ å¯ä»¥é€šè¿‡ <code>sysctl net.bridge.bridge-nf-call-iptables=1</code> æ›´æ”¹é…ç½®ã€‚</p>
<p>æˆ‘ä»¬åœ¨å‰é¢åˆ›å»ºé›†ç¾¤æ—¶ï¼Œå¹¶æ²¡æœ‰ä¼ é€’ä»»ä½•å‚æ•°ã€‚ä¸ºäº†èƒ½ä½¿ç”¨ <code>flannel</code> , æ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆå°†é›†ç¾¤é‡ç½®ã€‚ä½¿ç”¨ <code>kubeadm reset</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubeadm reset </span>
<span style="color:#f92672">[</span>reset<span style="color:#f92672">]</span> WARNING: changes made to this host by <span style="color:#e6db74">&#39;kubeadm init&#39;</span> or <span style="color:#e6db74">&#39;kubeadm join&#39;</span> will be reverted.
<span style="color:#f92672">[</span>reset<span style="color:#f92672">]</span> are you sure you want to proceed? <span style="color:#f92672">[</span>y/N<span style="color:#f92672">]</span>: y
<span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> running pre-flight checks
<span style="color:#f92672">[</span>reset<span style="color:#f92672">]</span> stopping the kubelet service
<span style="color:#f92672">[</span>reset<span style="color:#f92672">]</span> unmounting mounted directories in <span style="color:#e6db74">&#34;/var/lib/kubelet&#34;</span>
<span style="color:#f92672">[</span>reset<span style="color:#f92672">]</span> removing kubernetes-managed containers
<span style="color:#f92672">[</span>reset<span style="color:#f92672">]</span> cleaning up running containers using crictl with socket /var/run/dockershim.sock
<span style="color:#f92672">[</span>reset<span style="color:#f92672">]</span> failed to list running pods using crictl: exit status 1. Trying to use docker instead<span style="color:#f92672">[</span>reset<span style="color:#f92672">]</span> deleting contents of stateful directories: <span style="color:#f92672">[</span>/var/lib/kubelet /etc/cni/net.d /var/lib/dockershim /var/run/kubernetes /var/lib/etcd<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>reset<span style="color:#f92672">]</span> deleting contents of config directories: <span style="color:#f92672">[</span>/etc/kubernetes/manifests /etc/kubernetes/pki<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>reset<span style="color:#f92672">]</span> deleting files: <span style="color:#f92672">[</span>/etc/kubernetes/admin.conf /etc/kubernetes/kubelet.conf /etc/kubernetes/bootstrap-kubelet.conf /etc/kubernetes/controller-manager.conf /etc/kubernetes/scheduler.conf<span style="color:#f92672">]</span>
</code></pre></div><p>é‡æ–°åˆå§‹åŒ–é›†ç¾¤ï¼Œå¹¶ä¼ é€’å‚æ•°ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubeadm init --pod-network-cidr=10.244.0.0/16</span>
<span style="color:#f92672">[</span>init<span style="color:#f92672">]</span> using Kubernetes version: v1.11.3
...
Your Kubernetes master has initialized successfully!
</code></pre></div><p><strong>æ³¨æ„ï¼šè¿™é‡Œä¼šé‡æ–°ç”Ÿæˆç›¸åº”è¯ä¹¦ç­‰é…ç½®ï¼Œéœ€è¦æŒ‰ä¸Šé¢çš„å†…å®¹é‡æ–°é…ç½® kubectlã€‚</strong></p>
<p>æ­¤æ—¶ï¼Œ<code>CNI</code> ä¹Ÿå°šæœªåˆå§‹åŒ–å®Œæˆï¼Œæˆ‘ä»¬è¿˜éœ€å®Œæˆä»¥ä¸‹çš„æ­¥éª¤ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># æ³¨æ„ï¼Œè¿™é‡Œçš„ flannel é…ç½®ä»…é€‚ç”¨äº 1.11 ç‰ˆæœ¬çš„ K8Sï¼Œè‹¥å®‰è£…å…¶ä»–ç‰ˆæœ¬çš„ K8S éœ€è¦æ›¿æ¢æ‰æ­¤é“¾æ¥</span>
<span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/v0.10.0/Documentation/kube-flannel.yml</span>
clusterrole.rbac.authorization.k8s.io/flannel created
clusterrolebinding.rbac.authorization.k8s.io/flannel created
serviceaccount/flannel created
configmap/kube-flannel-cfg created
daemonset.extensions/kube-flannel-ds created
</code></pre></div><p>ç¨ç­‰ç‰‡åˆ»ï¼Œå†æ¬¡æŸ¥çœ‹ Node çŠ¶æ€ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get nodes</span>
NAME      STATUS    ROLES     AGE       VERSION
master    Ready     master    12m       v1.11.3
</code></pre></div><p>å¯ä»¥çœ‹åˆ° status å·²ç»æ˜¯ <code>Ready</code> çŠ¶æ€ã€‚æ ¹æ®ç¬¬ 3 ç« çš„å†…å®¹ï¼Œæˆ‘ä»¬çŸ¥é“ K8S ä¸­æœ€å°çš„è°ƒåº¦å•å…ƒæ˜¯ <code>Pod</code> æˆ‘ä»¬æ¥çœ‹ä¸‹é›†ç¾¤ä¸­ç°æœ‰ <code>Pod</code> çš„çŠ¶æ€ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods --all-namespaces</span>
NAMESPACE     NAME                             READY     STATUS              RESTARTS   AGE 
kube-system   coredns-78fcdf6894-h7pkc         0/1       ContainerCreating   <span style="color:#ae81ff">0</span>          12m
kube-system   coredns-78fcdf6894-lhlks         0/1       ContainerCreating   <span style="color:#ae81ff">0</span>          12m
kube-system   etcd-master                      1/1       Running             <span style="color:#ae81ff">0</span>          5m
kube-system   kube-apiserver-master            1/1       Running             <span style="color:#ae81ff">0</span>          5m
kube-system   kube-controller-manager-master   1/1       Running             <span style="color:#ae81ff">0</span>          5m
kube-system   kube-flannel-ds-tqvck            1/1       Running             <span style="color:#ae81ff">0</span>          6m
kube-system   kube-proxy-25tk2                 1/1       Running             <span style="color:#ae81ff">0</span>          12m
kube-system   kube-scheduler-master            1/1       Running             <span style="color:#ae81ff">0</span>          5m
</code></pre></div><p>æˆ‘ä»¬å‘ç°æœ‰ä¸¤ä¸ª <code>coredns</code> çš„ <code>Pod</code> æ˜¯ <code>ContainerCreating</code> çš„çŠ¶æ€ï¼Œä½†å¹¶æœªå°±ç»ªã€‚æ ¹æ®ç¬¬ 3 ç« çš„å†…å®¹ï¼Œæˆ‘ä»¬çŸ¥é“ <code>Pod</code> å®é™…ä¼šæœ‰ä¸€ä¸ªè°ƒåº¦è¿‡ç¨‹ï¼Œæ­¤å¤„æˆ‘ä»¬æš‚ä¸”ä¸è®ºï¼Œåç»­ç« èŠ‚å†å¯¹æ­¤è¿›è¡Œè§£é‡Šã€‚</p>
<h3 id="æ–°å¢-node">æ–°å¢ Node</h3>
<p>æˆ‘ä»¬æŒ‰ç…§åˆšæ‰æ‰§è¡Œå®Œ <code>kubeadm init</code> åï¼Œç»™å‡ºçš„ä¿¡æ¯ï¼Œåœ¨æ–°çš„æœºå™¨ä¸Šæ‰§è¡Œ <code>kubeadm join</code> å‘½ä»¤ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@node1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubeadm join 202.182.112.120:6443 --token t14kzc.vjurhx5k98dpzqdc --discovery-token-ca-cert-hash sha256:d64f7ce1af9f9c0c73d2d737fd0095456ad98a2816cb5527d55f984c8aa8a762</span>
<span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> running pre-flight checks
        <span style="color:#f92672">[</span>WARNING RequiredIPVSKernelModulesAvailable<span style="color:#f92672">]</span>: the IPVS proxier will not be used, because the following required kernel modules are not loaded: <span style="color:#f92672">[</span>ip_vs ip_vs_rr ip_vs_wrr ip_vs_sh<span style="color:#f92672">]</span> or no builtin kernel ipvs support: map<span style="color:#f92672">[</span>ip_vs:<span style="color:#f92672">{}</span> ip_vs_rr:<span style="color:#f92672">{}</span> ip_vs_wrr:<span style="color:#f92672">{}</span> ip_vs_sh:<span style="color:#f92672">{}</span> nf_conntrack_ipv4:<span style="color:#f92672">{}]</span>
you can solve this problem with following methods:
 1. Run <span style="color:#e6db74">&#39;modprobe -- &#39;</span> to load missing kernel modules;
2. Provide the missing builtin kernel ipvs support

I0921 04:00:54.805439   <span style="color:#ae81ff">10677</span> kernel_validator.go:81<span style="color:#f92672">]</span> Validating kernel version                                                  
I0921 04:00:54.805604   <span style="color:#ae81ff">10677</span> kernel_validator.go:96<span style="color:#f92672">]</span> Validating kernel config                                                   
        <span style="color:#f92672">[</span>WARNING SystemVerification<span style="color:#f92672">]</span>: docker version is greater than the most recently validated version. Docker version: 18.03.1-ce. Max validated version: 17.03
<span style="color:#f92672">[</span>discovery<span style="color:#f92672">]</span> Trying to connect to API Server <span style="color:#e6db74">&#34;202.182.112.120:6443&#34;</span>
<span style="color:#f92672">[</span>discovery<span style="color:#f92672">]</span> Created cluster-info discovery client, requesting info from <span style="color:#e6db74">&#34;https://202.182.112.120:6443&#34;</span>
<span style="color:#f92672">[</span>discovery<span style="color:#f92672">]</span> Requesting info from <span style="color:#e6db74">&#34;https://202.182.112.120:6443&#34;</span> again to validate TLS against the pinned public key
<span style="color:#f92672">[</span>discovery<span style="color:#f92672">]</span> Cluster info signature and contents are valid and TLS certificate validates against pinned roots, will use API Server <span style="color:#e6db74">&#34;202.182.112.120:6443&#34;</span>
<span style="color:#f92672">[</span>discovery<span style="color:#f92672">]</span> Successfully established connection with API Server <span style="color:#e6db74">&#34;202.182.112.120:6443&#34;</span>
<span style="color:#f92672">[</span>kubelet<span style="color:#f92672">]</span> Downloading configuration <span style="color:#66d9ef">for</span> the kubelet from the <span style="color:#e6db74">&#34;kubelet-config-1.11&#34;</span> ConfigMap in the kube-system namespace
<span style="color:#f92672">[</span>kubelet<span style="color:#f92672">]</span> Writing kubelet configuration to file <span style="color:#e6db74">&#34;/var/lib/kubelet/config.yaml&#34;</span>
<span style="color:#f92672">[</span>kubelet<span style="color:#f92672">]</span> Writing kubelet environment file with flags to file <span style="color:#e6db74">&#34;/var/lib/kubelet/kubeadm-flags.env&#34;</span>
<span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> Activating the kubelet service
<span style="color:#f92672">[</span>tlsbootstrap<span style="color:#f92672">]</span> Waiting <span style="color:#66d9ef">for</span> the kubelet to perform the TLS Bootstrap...
<span style="color:#f92672">[</span>patchnode<span style="color:#f92672">]</span> Uploading the CRI Socket information <span style="color:#e6db74">&#34;/var/run/dockershim.sock&#34;</span> to the Node API object <span style="color:#e6db74">&#34;node1&#34;</span> as an annotation

This node has joined the cluster:
* Certificate signing request was sent to master and a response
  was received.
* The Kubelet was informed of the new secure connection details.

Run <span style="color:#e6db74">&#39;kubectl get nodes&#39;</span> on the master to see this node join the cluster.
</code></pre></div><p>ä¸Šé¢çš„å‘½ä»¤æ‰§è¡Œå®Œæˆï¼Œæç¤ºå·²ç»æˆåŠŸåŠ å…¥é›†ç¾¤ã€‚ æ­¤æ—¶ï¼Œæˆ‘ä»¬åœ¨ master ä¸ŠæŸ¥çœ‹ä¸‹å½“å‰é›†ç¾¤çŠ¶æ€ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get nodes</span>
NAME      STATUS    ROLES     AGE       VERSION
master    Ready     master    12m       v1.11.3
node1     Ready     &lt;none&gt;    7m        v1.11.3
</code></pre></div><p>å¯ä»¥çœ‹åˆ° node1 å·²ç»åŠ å…¥äº†é›†ç¾¤ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©å®˜æ–¹æ¨èçš„ <code>kubeadm</code> å·¥å…·åœ¨æœåŠ¡å™¨ä¸Šæ­å»ºäº†ä¸€å¥—æœ‰ä¸¤ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ã€‚</p>
<p><code>kubeadm</code> å¯ä»¥è‡ªåŠ¨çš„æ‹‰å–ç›¸å…³ç»„ä»¶çš„ Docker é•œåƒï¼Œå¹¶å°†å…¶â€œç»„ç»‡â€èµ·æ¥ï¼Œå…å»äº†æˆ‘ä»¬é€ä¸ªéƒ¨ç½²ç›¸å…³ç»„ä»¶çš„éº»çƒ¦ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆå­¦ä¹ åˆ°äº†éƒ¨ç½² K8S æ—¶éœ€è¦å¯¹ç³»ç»Ÿåšçš„åŸºç¡€é…ç½®ï¼Œå…¶æ¬¡å®‰è£…äº†ä¸€äº›å¿…è¦çš„å·¥å…·ï¼Œä»¥ä¾¿ K8S çš„åŠŸèƒ½å¯æ­£å¸¸è¿è¡Œã€‚</p>
<p>å…¶æ¬¡ï¼Œæˆ‘ä»¬å­¦ä¹ åˆ°äº† CNI ç›¸å…³çš„çŸ¥è¯†ï¼Œå¹¶åœ¨é›†ç¾¤ä¸­éƒ¨ç½²äº† <code>flannel</code> ç½‘ç»œæ–¹æ¡ˆã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¢åŠ  Node çš„æ–¹æ³•ï¼Œä»¥ä¾¿åç»­æ‰©å±•é›†ç¾¤ã€‚</p>
<p>é›†ç¾¤æ­å»ºæ–¹é¢çš„å­¦ä¹ æš‚æ—¶å‘Šä¸€æ®µè½ï¼Œä½†è¿™å¹¶ä¸æ˜¯ç»“æŸï¼Œè¿™æ‰æ˜¯çœŸæ­£çš„å¼€å§‹ï¼Œä»ä¸‹ä¸€ç« å¼€å§‹ï¼Œæˆ‘ä»¬è¦å­¦ä¹ é›†ç¾¤ç®¡ç†ç›¸å…³çš„å†…å®¹ï¼Œå­¦ä¹ å¦‚ä½•çœŸæ­£ä½¿ç”¨ K8S ã€‚</p>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/04-%E6%90%AD%E5%BB%BA-kubernetes-%E9%9B%86%E7%BE%A4-%E6%9C%AC%E5%9C%B0%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA/"><span>04 æ­å»º Kubernetes é›†ç¾¤ - æœ¬åœ°å¿«é€Ÿæ­å»º</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/06-%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%9D%E8%AF%86-kubectl/"><span>06 é›†ç¾¤ç®¡ç†ï¼šåˆè¯† kubectl</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 27270 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>