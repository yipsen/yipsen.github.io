<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>09 åº”ç”¨å‘å¸ƒï¼šéƒ¨ç½²å®é™…é¡¹ç›® | Yipsen Ye</title>
<meta name="description" content="æœ¬èŠ‚æˆ‘ä»¬å¼€å§‹å­¦ä¹ å¦‚ä½•å°†å®é™…é¡¹ç›®éƒ¨ç½²è‡³ K8S ä¸­ï¼Œå¼€å¯ç”Ÿäº§å®è·µä¹‹è·¯ã€‚
æ•´ä½“æ¦‚è§ˆ æœ¬èŠ‚æ‰€ç”¨ç¤ºä¾‹é¡¹ç›®æ˜¯ä¸€ä¸ªæ··åˆäº† Goï¼ŒNodeJSï¼ŒPython ç­‰è¯­è¨€çš„é¡¹ç›®ï¼Œçµæ„Ÿæ¥è‡ªäºçŸ¥åç¨‹åºå‘˜ Kenneth Reitz çš„ Say Thanks é¡¹ç›®ã€‚æœ¬é¡¹ç›®å®ç°çš„åŠŸèƒ½ä¸»è¦æœ‰ä¸¤ä¸ªï¼š1. ç”¨æˆ·é€šè¿‡å‰ç«¯å‘é€æ„Ÿè°¢æ¶ˆæ¯ 2. æœ‰ä¸ªå·¥ä½œè¿›ç¨‹ä¼šæŒç»­çš„è®¡ç®—æ”¶åˆ°æ„Ÿè°¢æ¶ˆæ¯çš„æ’è¡Œæ¦œã€‚é¡¹ç›®ä»£ç å¯åœ¨ GitHub ä¸Šè·å¾—ã€‚æ¥ä¸‹æ¥å‡ èŠ‚ä¸­å¦‚æœéœ€è¦ç”¨åˆ°æ­¤é¡¹ç›®æˆ‘ä¼šç»Ÿä¸€ç§°ä¹‹ä¸º saythx é¡¹ç›®ã€‚
saythx é¡¹ç›®çš„åŸºç¡€ç»“æ„å¦‚ä¸‹å›¾ï¼š
æ„å»ºé•œåƒ å‰ç«¯ æˆ‘ä»¬ä½¿ç”¨äº†å‰ç«¯æ¡†æ¶ Vueï¼Œæ‰€ä»¥åœ¨åšç”Ÿäº§éƒ¨ç½²æ—¶ï¼Œéœ€è¦å…ˆåœ¨ Node JS çš„ç¯å¢ƒä¸‹è¿›è¡Œæ‰“åŒ…æ„å»ºã€‚åŒ…ç®¡ç†å™¨ä½¿ç”¨çš„æ˜¯ Yarnã€‚ç„¶åä½¿ç”¨ Nginx æä¾›æœåŠ¡ï¼Œå¹¶è¿›è¡Œåå‘ä»£ç†ï¼Œå°†è¯·æ±‚æ­£ç¡®çš„ä»£ç†è‡³åç«¯ã€‚
FROMnode:10.13 as builderWORKDIR/appCOPY . /appRUN yarn install \  &amp;amp;&amp;amp; yarn buildFROMnginx:1.15COPY nginx.conf /etc/nginx/conf.d/default.confCOPY --from=builder /app/dist /usr/share/nginx/html/EXPOSE80Nginx çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š
upstream backend-up { server saythx-backend:8080; } server { listen 80; server_name localhost; charset utf-8; location / { root /usr/share/nginx/html; try_files $uri $uri/ /index.">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/kubernetes%e4%bb%8e%e4%b8%8a%e6%89%8b%e5%88%b0%e5%ae%9e%e8%b7%b5/">Kubernetesä»ä¸Šæ‰‹åˆ°å®è·µ</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/01-%E5%BC%80%E7%AF%87-kubernetes-%E6%98%AF%E4%BB%80%E4%B9%88%E4%BB%A5%E5%8F%8A%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AE%83/">01 å¼€ç¯‡ï¼š Kubernetes æ˜¯ä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆéœ€è¦å®ƒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/02-%E5%88%9D%E6%AD%A5%E8%AE%A4%E8%AF%86kubernetes-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/">02 åˆæ­¥è®¤è¯†ï¼šKubernetes åŸºç¡€æ¦‚å¿µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/03-%E5%AE%8F%E8%A7%82%E8%AE%A4%E8%AF%86%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/">03 å®è§‚è®¤è¯†ï¼šæ•´ä½“æ¶æ„</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/04-%E6%90%AD%E5%BB%BA-kubernetes-%E9%9B%86%E7%BE%A4-%E6%9C%AC%E5%9C%B0%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA/">04 æ­å»º Kubernetes é›†ç¾¤ - æœ¬åœ°å¿«é€Ÿæ­å»º</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/05-%E5%8A%A8%E6%89%8B%E5%AE%9E%E8%B7%B5%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA-kubernetes-%E9%9B%86%E7%BE%A4-%E7%94%9F%E4%BA%A7%E5%8F%AF%E7%94%A8/">05 åŠ¨æ‰‹å®è·µï¼šæ­å»ºä¸€ä¸ª Kubernetes é›†ç¾¤ - ç”Ÿäº§å¯ç”¨</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/06-%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%9D%E8%AF%86-kubectl/">06 é›†ç¾¤ç®¡ç†ï¼šåˆè¯† kubectl</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/07-%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E4%BB%A5-redis-%E4%B8%BA%E4%BE%8B-%E9%83%A8%E7%BD%B2%E5%8F%8A%E8%AE%BF%E9%97%AE/">07 é›†ç¾¤ç®¡ç†ï¼šä»¥ Redis ä¸ºä¾‹-éƒ¨ç½²åŠè®¿é—®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/08-%E5%AE%89%E5%85%A8%E9%87%8D%E7%82%B9-%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83/">08 å®‰å…¨é‡ç‚¹ è®¤è¯å’Œæˆæƒ</a></li>
                
                
                
                    <li>09 åº”ç”¨å‘å¸ƒï¼šéƒ¨ç½²å®é™…é¡¹ç›®</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/10-%E5%BA%94%E7%94%A8%E7%AE%A1%E7%90%86%E5%88%9D%E8%AF%86-helm/">10 åº”ç”¨ç®¡ç†ï¼šåˆè¯† Helm</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/11-%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5%E4%BB%A5-helm-%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/">11 éƒ¨ç½²å®è·µï¼šä»¥ Helm éƒ¨ç½²é¡¹ç›®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/12-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-apiserver/">12 åº–ä¸è§£ç‰›ï¼škube-apiserver</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/13-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Betcd/">13 åº–ä¸è§£ç‰›ï¼šetcd</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/14-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bcontroller-manager/">14 åº–ä¸è§£ç‰›ï¼šcontroller-manager</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/15-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-scheduler/">15 åº–ä¸è§£ç‰›ï¼škube-scheduler</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/16-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkubelet/">16 åº–ä¸è§£ç‰›ï¼škubelet</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/17-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-proxy/">17 åº–ä¸è§£ç‰›ï¼škube-proxy</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/18-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bcontainer-runtime-docker/">18 åº–ä¸è§£ç‰›ï¼šContainer Runtime ï¼ˆDockerï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/19-troubleshoot/">19 Troubleshoot</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/20-%E6%89%A9%E5%B1%95%E5%A2%9E%E5%BC%BAdashboard/">20 æ‰©å±•å¢å¼ºï¼šDashboard</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/21-%E6%89%A9%E5%B1%95%E5%A2%9E%E5%BC%BAcoredns/">21 æ‰©å±•å¢å¼ºï¼šCoreDNS</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/22-%E6%9C%8D%E5%8A%A1%E5%A2%9E%E5%BC%BAingress/">22 æœåŠ¡å¢å¼ºï¼šIngress</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/23-%E7%9B%91%E6%8E%A7%E5%AE%9E%E8%B7%B5%E5%AF%B9-k8s-%E9%9B%86%E7%BE%A4%E8%BF%9B%E8%A1%8C%E7%9B%91%E6%8E%A7/">23 ç›‘æ§å®è·µï¼šå¯¹ K8S é›†ç¾¤è¿›è¡Œç›‘æ§</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/24-%E6%80%BB%E7%BB%93/">24 æ€»ç»“</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">09 åº”ç”¨å‘å¸ƒï¼šéƒ¨ç½²å®é™…é¡¹ç›®</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2021-12-22 01:47:35</span>ğŸ·ï¸&nbsp;<a class="post-tag" href="/tags/kubernetes/">kubernetes</a></div><div class="post-category">
                
                ğŸ“š&nbsp;<a href="/categories/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/">Kubernetesä»ä¸Šæ‰‹åˆ°å®è·µ</a>
                
            </div></div>
        <div class="post-content">
            <p>æœ¬èŠ‚æˆ‘ä»¬å¼€å§‹å­¦ä¹ å¦‚ä½•å°†å®é™…é¡¹ç›®éƒ¨ç½²è‡³ K8S ä¸­ï¼Œå¼€å¯ç”Ÿäº§å®è·µä¹‹è·¯ã€‚</p>
<h2 id="æ•´ä½“æ¦‚è§ˆ">æ•´ä½“æ¦‚è§ˆ</h2>
<p>æœ¬èŠ‚æ‰€ç”¨ç¤ºä¾‹é¡¹ç›®æ˜¯ä¸€ä¸ªæ··åˆäº† Goï¼ŒNodeJSï¼ŒPython ç­‰è¯­è¨€çš„é¡¹ç›®ï¼Œçµæ„Ÿæ¥è‡ªäºçŸ¥åç¨‹åºå‘˜ <a href="https://github.com/kennethreitz">Kenneth Reitz</a> çš„ <a href="https://saythanks.io/">Say Thanks</a> é¡¹ç›®ã€‚æœ¬é¡¹ç›®å®ç°çš„åŠŸèƒ½ä¸»è¦æœ‰ä¸¤ä¸ªï¼š1. ç”¨æˆ·é€šè¿‡å‰ç«¯å‘é€æ„Ÿè°¢æ¶ˆæ¯ 2. æœ‰ä¸ªå·¥ä½œè¿›ç¨‹ä¼šæŒç»­çš„è®¡ç®—æ”¶åˆ°æ„Ÿè°¢æ¶ˆæ¯çš„æ’è¡Œæ¦œã€‚é¡¹ç›®ä»£ç å¯åœ¨ <a href="https://github.com/tao12345666333/saythx">GitHub ä¸Šè·å¾—</a>ã€‚æ¥ä¸‹æ¥å‡ èŠ‚ä¸­å¦‚æœéœ€è¦ç”¨åˆ°æ­¤é¡¹ç›®æˆ‘ä¼šç»Ÿä¸€ç§°ä¹‹ä¸º saythx é¡¹ç›®ã€‚</p>
<p>saythx é¡¹ç›®çš„åŸºç¡€ç»“æ„å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/images/329e053e2055fded086788903a1caaf1a94f42108c100c3106251338c095b63f.png" alt="picture 7"></p>
<h2 id="æ„å»ºé•œåƒ">æ„å»ºé•œåƒ</h2>
<h3 id="å‰ç«¯">å‰ç«¯</h3>
<p>æˆ‘ä»¬ä½¿ç”¨äº†å‰ç«¯æ¡†æ¶ <a href="https://vuejs.org/">Vue</a>ï¼Œæ‰€ä»¥åœ¨åšç”Ÿäº§éƒ¨ç½²æ—¶ï¼Œéœ€è¦å…ˆåœ¨ <a href="https://nodejs.org/">Node JS</a> çš„ç¯å¢ƒä¸‹è¿›è¡Œæ‰“åŒ…æ„å»ºã€‚åŒ…ç®¡ç†å™¨ä½¿ç”¨çš„æ˜¯ <a href="https://yarnpkg.com/">Yarn</a>ã€‚ç„¶åä½¿ç”¨ <a href="https://nginx.com/">Nginx</a> æä¾›æœåŠ¡ï¼Œå¹¶è¿›è¡Œåå‘ä»£ç†ï¼Œå°†è¯·æ±‚æ­£ç¡®çš„ä»£ç†è‡³åç«¯ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> node:10.13 as builder</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /app</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> . /app<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> yarn install <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        <span style="color:#f92672">&amp;&amp;</span> yarn build<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> nginx:1.15</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> nginx.conf /etc/nginx/conf.d/default.conf<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> --from<span style="color:#f92672">=</span>builder /app/dist /usr/share/nginx/html/<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 80</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Nginx çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nginx" data-lang="nginx"><span style="color:#66d9ef">upstream</span> <span style="color:#e6db74">backend-up</span> {
    <span style="color:#f92672">server</span> saythx-backend:<span style="color:#ae81ff">8080</span>;
}
<span style="color:#66d9ef">server</span> {
    <span style="color:#f92672">listen</span>       <span style="color:#ae81ff">80</span>;
    <span style="color:#f92672">server_name</span>  <span style="color:#e6db74">localhost</span>;

    <span style="color:#f92672">charset</span>     <span style="color:#e6db74">utf-8</span>;

    <span style="color:#f92672">location</span> <span style="color:#e6db74">/</span> {
        <span style="color:#f92672">root</span> <span style="color:#e6db74">/usr/share/nginx/html</span>;
        <span style="color:#f92672">try_files</span> $uri $uri/ <span style="color:#e6db74">/index.html</span>;
    }

    <span style="color:#f92672">location</span> ~ <span style="color:#e6db74">^/(api)</span> {
        <span style="color:#f92672">proxy_pass</span>   <span style="color:#e6db74">http://backend-up</span>;
    }
}
</code></pre></div><p>å°† API çš„è¯·æ±‚åå‘ä»£ç†åˆ°åç«¯æœåŠ¡ä¸Šã€‚å…¶ä½™è¯·æ±‚å…¨éƒ¨ç•™ç»™å‰ç«¯è¿›è¡Œå¤„ç†ã€‚</p>
<h3 id="åç«¯">åç«¯</h3>
<p>åç«¯æ˜¯ä½¿ç”¨ <a href="https://golang.org/">Golang</a> ç¼–å†™çš„ API æœåŠ¡ï¼Œå¯¹è¯·æ±‚è¿›è¡Œç›¸åº”å¤„ç†ï¼Œå¹¶å°†æ•°æ®å­˜å‚¨è‡³ <a href="http://redis.io/">Redis</a> å½“ä¸­ã€‚ä¾èµ–ç®¡ç†ä½¿ç”¨çš„æ˜¯ <a href="https://github.com/golang/dep">dep</a>ã€‚ç”±äº Golang æ˜¯ç¼–è¯‘å‹è¯­è¨€ï¼Œç¼–è¯‘å®Œæˆåä¼šç”Ÿæˆä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸ºäº†è®©é•œåƒå°½å¯èƒ½å°ï¼Œæ‰€ä»¥ Dockerfile å’Œå‰ç«¯çš„å·®ä¸å¤šï¼Œéƒ½ä½¿ç”¨äº†<a href="https://docs.docker.com/develop/develop-images/multistage-build/">å¤šé˜¶æ®µæ„å»º</a>çš„ç‰¹æ€§ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> golang:1.11.1 as builder</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /go/src/be</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> . /go/src/be<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> go get -u github.com/golang/dep/cmd/dep <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        <span style="color:#f92672">&amp;&amp;</span> dep ensure <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        <span style="color:#f92672">&amp;&amp;</span> go build<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> debian:stretch-slim</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> --from<span style="color:#f92672">=</span>builder /go/src/be/be /usr/bin/be<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENTRYPOINT</span> [<span style="color:#e6db74">&#34;/usr/bin/be&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 8080</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>æ³¨æ„è¿™é‡Œä¼šæš´éœ²å‡ºæ¥åç«¯æœåŠ¡æ‰€ç›‘å¬çš„ç«¯å£ã€‚</p>
<h3 id="work">Work</h3>
<p>Work ç«¯ä½¿ç”¨çš„æ˜¯ <a href="https://python.org/">Python</a>ï¼Œç”¨äºè®¡ç®—å·²ç»å­˜å‚¨è‡³ Redis å½“ä¸­çš„æ•°æ®ï¼Œå¹¶ç”Ÿæˆæ’è¡Œæ¦œã€‚ä¾èµ–ä½¿ç”¨ <a href="https://github.com/pypa/pip">pip</a> è¿›è¡Œå®‰è£…ã€‚å¯¹äº Python çš„é•œåƒé€‰æ‹©ï¼Œæˆ‘åšäº†ä¸€ç»„<a href="http://moelove.info/docker-python-perf/">æ€§èƒ½å¯¹æ¯”çš„æµ‹è¯•</a> æœ‰å…´è¶£å¯ä»¥äº†è§£ä¸‹ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> python:3.7-slim</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /app</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> . /app<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> pip install -r requirements.txt<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENTRYPOINT</span> [<span style="color:#e6db74">&#34;python&#34;</span>, <span style="color:#e6db74">&#34;work.py&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><h3 id="æ„å»ºå‘å¸ƒ">æ„å»ºå‘å¸ƒ</h3>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åªè¦åœ¨å¯¹åº”é¡¹ç›®ç›®å½•ä¸­ï¼Œæ‰§è¡Œ <code>docker build [OPTIONS] PATH</code> å³å¯ã€‚ä¸€èˆ¬æˆ‘ä»¬ä¼šä½¿ç”¨ <code>-t name:tag</code> çš„æ–¹å¼æ‰“ tagã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># ä»¥ä¸‹åˆ†åˆ«æ˜¯åœ¨å„æ¨¡å—è‡ªå·±çš„ç›®å½•å†…</span>
âœ  be docker build -t  taobeier/saythx-be .
âœ  fe docker build -t  taobeier/saythx-fe .
âœ  work docker build -t  taobeier/saythx-work .
</code></pre></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‰ç«¯é¡¹ç›®ç”±äºç›®å½•å†…åŒ…å«å¼€å‘æ—¶çš„ <code>node_modules</code> ç­‰æ–‡ä»¶ï¼Œéœ€è¦æ³¨æ„æ·»åŠ  <code>.dockerignore</code> æ–‡ä»¶ï¼Œå¿½ç•¥ä¸€äº›éé¢„æœŸçš„æ–‡ä»¶ã€‚å…³äº Docker çš„ build åŸç†ï¼Œæœ‰æƒ³æ·±å…¥ç†è§£çš„ï¼Œå¯å‚è€ƒæˆ‘ä¹‹å‰å†™çš„ <a href="http://moelove.info/2018/09/04/Docker-%E6%B7%B1%E5%85%A5%E7%AF%87%E4%B9%8B-Build-%E5%8E%9F%E7%90%86/">Docker æ·±å…¥ç¯‡ä¹‹ Build åŸç†</a> ã€‚ å½“é•œåƒæ„å»ºå®Œæˆåï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒä»¬å‘å¸ƒè‡³é•œåƒä»“åº“ã€‚è¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨å®˜æ–¹çš„ <a href="https://hub.docker.com/">Docker Hub</a>ï¼Œæ‰§è¡Œ <code>docker login</code> è¾“å…¥ç”¨æˆ·åå¯†ç éªŒè¯æˆåŠŸåä¾¿å¯è¿›è¡Œå‘å¸ƒï¼ˆéœ€è¦å…ˆå» Docker Hub æ³¨å†Œå¸å·ï¼‰ã€‚</p>
<p>ç™»å½•æˆåŠŸåï¼Œé»˜è®¤æƒ…å†µä¸‹åœ¨ <code>$HOME/.docker/config.json</code> ä¸­ä¼šå­˜å‚¨ç”¨æˆ·ç›¸å…³å‡­è¯ã€‚</p>
<p>æ¥ä¸‹æ¥è¿›è¡Œå‘å¸ƒåªéœ€è¦æ‰§è¡Œ <code>docker push</code> å³å¯ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">âœ  ~ docker push taobeier/saythx-be
âœ  ~ docker push taobeier/saythx-fe
âœ  ~ docker push taobeier/saythx-work
</code></pre></div><h2 id="å®¹å™¨ç¼–æ’-docker-compose">å®¹å™¨ç¼–æ’ Docker Compose</h2>
<p><a href="https://docs.docker.com/compose/overview/">Docker Compose</a> æ˜¯ä¸€ç§è¾ƒä¸ºç®€å•çš„å¯è¿›è¡Œå®¹å™¨ç¼–æ’çš„æŠ€æœ¯ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œé€šå¸¸æƒ…å†µä¸‹ä¸º <code>docker-compose.yml</code> ã€‚åœ¨ saythx é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æˆ‘å·²ç»åˆ›å»ºå¥½äº† <code>docker-compose.yml</code> çš„é…ç½®æ–‡ä»¶ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;3&#39;</span>

<span style="color:#f92672">services</span>:
  <span style="color:#f92672">saythx-frontend</span>:
    <span style="color:#f92672">build</span>:
      <span style="color:#f92672">context</span>: <span style="color:#ae81ff">fe/.</span>
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">taobeier/saythx-fe</span>
    <span style="color:#f92672">ports</span>:
      - <span style="color:#e6db74">&#34;8088:80&#34;</span>
    <span style="color:#f92672">depends_on</span>:
      - <span style="color:#ae81ff">saythx-backend</span>
    <span style="color:#f92672">networks</span>:
      - <span style="color:#ae81ff">saythx</span>

  <span style="color:#f92672">saythx-backend</span>:
    <span style="color:#f92672">build</span>:
      <span style="color:#f92672">context</span>: <span style="color:#ae81ff">be/.</span>
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">taobeier/saythx-be</span>
    <span style="color:#f92672">depends_on</span>:
      - <span style="color:#ae81ff">saythx-redis</span>
    <span style="color:#f92672">networks</span>:
      - <span style="color:#ae81ff">saythx</span>
    <span style="color:#f92672">environment</span>:
      - <span style="color:#ae81ff">REDIS_HOST=saythx-redis</span>
    
  <span style="color:#f92672">saythx-work</span>:
    <span style="color:#f92672">build</span>:
      <span style="color:#f92672">context</span>: <span style="color:#ae81ff">work/.</span>
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">taobeier/saythx-work</span>
    <span style="color:#f92672">depends_on</span>:
      - <span style="color:#ae81ff">saythx-redis</span>
    <span style="color:#f92672">networks</span>:
      - <span style="color:#ae81ff">saythx</span>
    <span style="color:#f92672">environment</span>:
      - <span style="color:#ae81ff">REDIS_HOST=saythx-redis</span>
      - <span style="color:#ae81ff">REDIS_PORT=6379</span>

  <span style="color:#f92672">saythx-redis</span>:
    <span style="color:#f92672">image</span>: <span style="color:#e6db74">&#34;redis:5&#34;</span>
    <span style="color:#f92672">networks</span>:
      - <span style="color:#ae81ff">saythx</span>

<span style="color:#f92672">networks</span>:
  <span style="color:#f92672">saythx</span>:
</code></pre></div><p>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œ <code>docker-compose up</code> å³å¯å¯åŠ¨è¯¥é¡¹ç›®ã€‚åœ¨æµè§ˆå™¨ä¸­è®¿é—® <a href="http://127.0.0.1:8088/">http://127.0.0.1:8088/</a> å³å¯çœ‹åˆ°é¡¹ç›®çš„å‰ç«¯ç•Œé¢ã€‚å¦‚ä¸‹å›¾ï¼š</p>
<p>æ‰“å¼€å¦å¤–çš„ç»ˆç«¯ï¼Œè¿›å…¥é¡¹ç›®æ ¹ç›®å½•å†…ï¼Œæ‰§è¡Œ <code>docker-compose ps</code> å‘½ä»¤å³å¯çœ‹åˆ°å½“å‰çš„æœåŠ¡æƒ…å†µã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">âœ  saythx git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— docker-compose ps

          Name                        Command               State          Ports
----------------------------------------------------------------------------------------
saythx_saythx-backend_1    /usr/bin/be                      Up      8080/tcp
saythx_saythx-frontend_1   nginx -g daemon off;             Up      0.0.0.0:8088-&gt;80/tcp
saythx_saythx-redis_1      docker-entrypoint.sh redis ...   Up      6379/tcp
saythx_saythx-work_1       python work.py                   Up
</code></pre></div><p>å¯ä»¥çœ‹åˆ°å„ç»„ä»¶å‡æ˜¯ <code>Up</code> çš„çŠ¶æ€ï¼Œç›¸å…³ç«¯å£ä¹Ÿå·²ç»æš´éœ²å‡ºæ¥ã€‚</p>
<p>å¯åœ¨æµè§ˆå™¨ç›´æ¥è®¿é—®ä½“éªŒã€‚ç”±äº <code>Docker Compose</code> å¹¶éæœ¬å†Œçš„é‡ç‚¹ï¼Œæ•…ä¸åšå¤ªå¤šä»‹ç»ï¼Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£è¿›è¡Œå­¦ä¹ ã€‚æ¥ä¸‹æ¥è¿›å…¥æœ¬èŠ‚çš„é‡ç‚¹å†…å®¹ï¼Œå°†é¡¹ç›®éƒ¨ç½²è‡³ K8S ä¸­ã€‚</p>
<h2 id="ç¼–å†™é…ç½®æ–‡ä»¶å¹¶éƒ¨ç½²">ç¼–å†™é…ç½®æ–‡ä»¶å¹¶éƒ¨ç½²</h2>
<p>åœ¨ K8S ä¸­è¿›è¡Œéƒ¨ç½²æˆ–è€…è¯´ä¸ K8S äº¤äº’çš„æ–¹å¼ä¸»è¦æœ‰ä¸‰ç§ï¼š</p>
<ul>
<li>å‘½ä»¤å¼</li>
<li>å‘½ä»¤å¼å¯¹è±¡é…ç½®</li>
<li>å£°æ˜å¼å¯¹è±¡é…ç½®</li>
</ul>
<p>ç¬¬ 7 èŠ‚ä»‹ç»è¿‡çš„ <code>kubectl run redis --image='redis:alpine'</code> è¿™ç§æ–¹å¼ä¾¿æ˜¯å‘½ä»¤å¼ï¼Œè¿™ç§æ–¹å¼å¾ˆç®€å•ï¼Œä½†æ˜¯å¯é‡ç”¨æ€§ä½ã€‚æ¯•ç«Ÿä½ çš„å‘½ä»¤æ‰§è¡Œå®Œåï¼Œå…¶ä»–äººä¹Ÿå¹¶ä¸æ¸…æ¥šåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p>
<p>å‘½ä»¤å¼å¯¹è±¡é…ç½®ï¼Œä¸»è¦æ˜¯ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯é€šè¿‡ç±»ä¼¼ <code>kubectl create</code> ä¹‹ç±»å‘½ä»¤å¼çš„æ–¹å¼è¿›è¡Œæ“ä½œã€‚</p>
<p>å†æœ‰ä¸€ç§ä¾¿æ˜¯å£°æ˜å¼å¯¹è±¡é…ç½®ï¼Œä¸»è¦ä¹Ÿæ˜¯é€šè¿‡ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯ä½¿ç”¨ <code>kubectl apply</code> ä¹‹ç±»çš„æ”¾å¥½ä¼¼è¿›è¡Œæ“ä½œã€‚ä¸ç¬¬äºŒç§å‘½ä»¤å¼å¯¹è±¡é…ç½®çš„åŒºåˆ«ä¸»è¦åœ¨äºå¯¹å¯¹è±¡çš„æ“ä½œå°†ä¼šå¾—åˆ°ä¿ç•™ã€‚ä½†åŒæ—¶è¿™ç§æ–¹å¼æœ‰æ—¶å€™ä¹Ÿå¹¶ä¸å¥½è¿›è¡Œè°ƒè¯•ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œä¸º saythx é¡¹ç›®ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œè®©å®ƒå¯ä»¥éƒ¨ç½²è‡³ K8S ä¸­ã€‚å½“ç„¶ï¼Œè¿™é‡Œæˆ‘ä»¬å·²ç»åˆ›å»ºè¿‡äº† <code>docker-compose.yml</code> çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶ä¸”ä¹ŸéªŒè¯äº†å…¶å¯ç”¨æ€§ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ <a href="https://github.com/kubernetes/kompose">Kompose</a> å·¥å…·å°† <code>docker-compose.yml</code> çš„é…ç½®æ–‡ä»¶è¿›è¡Œè½¬æ¢ã€‚</p>
<p>ä½†è¿™é‡Œé‡‡ç”¨ç›´æ¥ç¼–å†™çš„æ–¹å¼ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬éƒ¨ç½²è‡³ä¸€ä¸ªæ–°çš„åä¸º <code>work</code> çš„ <code>Namespace</code> ä¸­ã€‚</p>
<h3 id="namespace">Namespace</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Namespace</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">work</span>
</code></pre></div><p>æŒ‡å®šäº† <code>Namespace</code> name ä¸º <code>work</code>ã€‚ç„¶åè¿›è¡Œéƒ¨ç½²</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">âœ  conf git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— kubectl apply -f namespace.yaml 
namespace/work created
</code></pre></div><h3 id="redis-èµ„æº">Redis èµ„æº</h3>
<p>ä»å‰é¢çš„ <code>docker-compose.yml</code> ä¸­ä¹Ÿèƒ½å‘ç°ï¼Œsaythx ä¸­å„ä¸ªç»„ä»¶ï¼Œåªæœ‰ Redis æ˜¯æ— ä»»ä½•ä¾èµ–çš„ã€‚æˆ‘ä»¬å…ˆå¯¹å®ƒè¿›è¡Œéƒ¨ç½²ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">labels</span>:
    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">redis</span>
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">saythx-redis</span>
  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">work</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">selector</span>:
    <span style="color:#f92672">matchLabels</span>:
      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">redis</span>
  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">1</span>
  <span style="color:#f92672">template</span>:
    <span style="color:#f92672">metadata</span>:
      <span style="color:#f92672">labels</span>:
        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">redis</span>
    <span style="color:#f92672">spec</span>:
      <span style="color:#f92672">containers</span>:
      - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">redis:5</span>
        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis</span>
        <span style="color:#f92672">ports</span>:
        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">6379</span>
</code></pre></div><p>ç”±äºè¿™æ˜¯æœ¬å†Œå†…ç¬¬ä¸€æ¬¡å‡ºç°å®Œæ•´çš„ <code>Deployment</code> é…ç½®æ–‡ä»¶ï¼Œæ•…è€Œè¿›è¡Œé‡ç‚¹ä»‹ç»ã€‚</p>
<ul>
<li><code>apiVersion</code> ï¼šæŒ‡å®šäº† API çš„ç‰ˆæœ¬å·ï¼Œå½“å‰æˆ‘ä»¬ä½¿ç”¨çš„ K8S ä¸­ï¼Œ <code>Deployment</code> çš„ç‰ˆæœ¬å·ä¸º <code>apps/v1</code>ï¼Œè€Œåœ¨ 1.9 ä¹‹å‰ä½¿ç”¨çš„ç‰ˆæœ¬åˆ™ä¸º <code>apps/v1beta2</code>ï¼Œåœ¨ 1.8 ä¹‹å‰çš„ç‰ˆæœ¬ä½¿ç”¨çš„ç‰ˆæœ¬ä¸º <code>extensions/v1beta1</code>ã€‚åœ¨ç¼–å†™é…ç½®æ–‡ä»¶æ—¶éœ€è¦æ ¼å¤–æ³¨æ„ã€‚</li>
<li><code>kind</code> ï¼šæŒ‡å®šäº†èµ„æºçš„ç±»å‹ã€‚è¿™é‡ŒæŒ‡å®šä¸º <code>Deployment</code> è¯´æ˜æ˜¯ä¸€æ¬¡éƒ¨ç½²ã€‚</li>
<li><code>metadata</code> ï¼šæŒ‡å®šäº†èµ„æºçš„å…ƒä¿¡æ¯ã€‚ä¾‹å¦‚å…¶ä¸­çš„ <code>name</code> å’Œ <code>namespace</code> åˆ†åˆ«è¡¨ç¤ºèµ„æºåç§°å’Œæ‰€å½’å±çš„ <code>Namespace</code>ã€‚</li>
<li><code>spec</code> ï¼šæŒ‡å®šäº†å¯¹èµ„æºçš„é…ç½®ä¿¡æ¯ã€‚ä¾‹å¦‚å…¶ä¸­çš„ <code>replicas</code> æŒ‡å®šäº†å‰¯æœ¬æ•°å½“å‰æŒ‡å®šä¸º 1 ã€‚<code>template.spec</code> åˆ™æŒ‡å®šäº† <code>Pod</code> ä¸­å®¹å™¨çš„é…ç½®ä¿¡æ¯ï¼Œè¿™é‡Œçš„ <code>Pod</code> ä¸­åªéƒ¨ç½²äº†ä¸€ä¸ªå®¹å™¨ã€‚</li>
</ul>
<p>é…ç½®æ–‡ä»¶å·²ç»ç”Ÿäº§ï¼Œç°åœ¨å¯¹å®ƒè¿›è¡Œéƒ¨ç½²ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">âœ  conf git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— kubectl -n work get all
No resources found.
âœ  conf git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— kubectl apply -f redis-deployment.yaml
deployment.apps/saythx-redis created
âœ  conf git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— kubectl -n work get all
NAME                                READY     STATUS    RESTARTS   AGE
pod/saythx-redis-79d8f9864d-x8fp9   1/1       Running   <span style="color:#ae81ff">0</span>          4s

NAME                           DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/saythx-redis   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           4s

NAME                                      DESIRED   CURRENT   READY     AGE
replicaset.apps/saythx-redis-79d8f9864d   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         4s
</code></pre></div><p>å¯ä»¥çœ‹åˆ° <code>Pod</code> å·²ç»åœ¨æ­£å¸¸è¿è¡Œäº†ã€‚æˆ‘ä»¬è¿›å…¥ <code>Pod</code> å†…è¿›è¡Œæµ‹è¯•ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">âœ  conf git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— kubectl -n work exec -it saythx-redis-79d8f9864d-x8fp9 bash
root@saythx-redis-79d8f9864d-x8fp9:/data# redis-cli
127.0.0.1:6379&gt; ping
PONG
</code></pre></div><p>å“åº”æ­£å¸¸ã€‚</p>
<h3 id="redis-service">Redis service</h3>
<p>ç”±äº <code>Redis</code> æ˜¯åç«¯æœåŠ¡çš„ä¾èµ–ï¼Œæˆ‘ä»¬å°†å®ƒä½œä¸º <code>Service</code> æš´éœ²å‡ºæ¥ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">labels</span>:
    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">redis</span>
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">saythx-redis</span>
  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">work</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">ports</span>:
  - <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
    <span style="color:#f92672">port</span>: <span style="color:#ae81ff">6379</span>
    <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">6379</span>
  <span style="color:#f92672">selector</span>:
    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">redis</span>
  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">NodePort</span>
</code></pre></div><p>å…³äº <code>Service</code> çš„å†…å®¹ï¼Œå¯å‚è€ƒç¬¬ 7 èŠ‚ï¼Œæˆ‘ä»¬è¯¦ç»†åšè¿‡è§£é‡Šã€‚è¿™é‡Œç›´æ¥ä½¿ç”¨é…ç½®æ–‡ä»¶è¿›è¡Œéƒ¨ç½²ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">âœ  conf git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— kubectl apply -f redis-service.yaml
service/saythx-redis created
âœ  conf git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— kubectl get svc -n work
NAME           TYPE       CLUSTER-IP      EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>          AGE
saythx-redis   NodePort   10.107.31.242   &lt;none&gt;        6379:31467/TCP   1m
</code></pre></div><h3 id="åç«¯æœåŠ¡">åç«¯æœåŠ¡</h3>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯¹åç«¯æœåŠ¡è¿›è¡Œéƒ¨ç½²ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">labels</span>:
    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">backend</span>
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">saythx-backend</span>
  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">work</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">selector</span>:
    <span style="color:#f92672">matchLabels</span>:
      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">backend</span>
  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">1</span>
  <span style="color:#f92672">template</span>:
    <span style="color:#f92672">metadata</span>:
      <span style="color:#f92672">labels</span>:
        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">backend</span>
    <span style="color:#f92672">spec</span>:
      <span style="color:#f92672">containers</span>:
      - <span style="color:#f92672">env</span>:
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">REDIS_HOST</span>
          <span style="color:#f92672">value</span>: <span style="color:#ae81ff">saythx-redis</span>
        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">taobeier/saythx-be</span>
        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">backend</span>
        <span style="color:#f92672">ports</span>:
        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">8080</span>
</code></pre></div><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œé€šè¿‡ç¯å¢ƒå˜é‡çš„æ–¹å¼ï¼Œå°† <code>REDIS_HOST</code> ä¼ é€’ç»™äº†åç«¯æœåŠ¡ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">âœ  conf git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— kubectl apply -f backend-deployment.yaml
deployment.apps/saythx-backend created
âœ  conf git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— kubectl -n work get all
NAME                                 READY     STATUS              RESTARTS   AGE
pod/saythx-backend-c5f9f6d95-lmtxn   0/1       ContainerCreating   <span style="color:#ae81ff">0</span>          5s
pod/saythx-redis-8558c7d7d-kcmzk     1/1       Running             <span style="color:#ae81ff">0</span>          17m

NAME                   TYPE       CLUSTER-IP      EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>          AGE
service/saythx-redis   NodePort   10.107.31.242   &lt;none&gt;        6379:31467/TCP   1m

NAME                             DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/saythx-backend   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">0</span>           5s
deployment.apps/saythx-redis     <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           17m

NAME                                       DESIRED   CURRENT   READY     AGE
replicaset.apps/saythx-backend-c5f9f6d95   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">0</span>         5s
replicaset.apps/saythx-redis-8558c7d7d     <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         17m
</code></pre></div><h3 id="åç«¯-service">åç«¯ Service</h3>
<p>åç«¯æœåŠ¡æ˜¯å‰ç«¯é¡¹ç›®çš„ä¾èµ–ï¼Œæ•…è€Œæˆ‘ä»¬ä¹Ÿå°†å…¶ä½œä¸º <code>Service</code> æš´éœ²å‡ºæ¥ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">labels</span>:
    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">backend</span>
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">saythx-backend</span>
  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">work</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">ports</span>:
  - <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
    <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8080</span>
    <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">8080</span>
  <span style="color:#f92672">selector</span>:
    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">backend</span>
  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">NodePort</span>
</code></pre></div><p>é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œéƒ¨ç½²ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">âœ  conf git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— kubectl apply -f backend-service.yaml
service/saythx-backend created
âœ  conf git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— kubectl get svc -n work
NAME                     TYPE       CLUSTER-IP      EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>          AGE
service/saythx-backend   NodePort   10.104.0.47     &lt;none&gt;        8080:32051/TCP   8s
service/saythx-redis     NodePort   10.107.31.242   &lt;none&gt;        6379:31467/TCP   3m
</code></pre></div><p>æˆ‘ä»¬åŒæ ·ä½¿ç”¨ <code>NodePort</code> å°†å…¶æš´éœ²å‡ºæ¥ï¼Œå¹¶åœ¨æœ¬åœ°è¿›è¡Œæµ‹è¯•ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">âœ  conf git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— curl http://127.0.0.1:32051/api/v1/list
<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;HonorDatas&#34;</span>:null<span style="color:#f92672">}</span>
</code></pre></div><p>æœåŠ¡å¯æ­£å¸¸å“åº”ã€‚</p>
<h3 id="å‰ç«¯-1">å‰ç«¯</h3>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ç¼–å†™å‰ç«¯çš„é…ç½®æ–‡ä»¶ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">labels</span>:
    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">frontend</span>
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">saythx-frontend</span>
  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">work</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">selector</span>:
    <span style="color:#f92672">matchLabels</span>:
      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">frontend</span>
  <span style="color:#f92672">template</span>:
    <span style="color:#f92672">metadata</span>:
      <span style="color:#f92672">labels</span>:
        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">frontend</span>
    <span style="color:#f92672">spec</span>:
      <span style="color:#f92672">containers</span>:
      - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">taobeier/saythx-fe</span>
        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">frontend</span>
        <span style="color:#f92672">ports</span>:
        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</code></pre></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨åç«¯ <code>Service</code> æš´éœ²å‡ºæ¥åæ‰èƒ½è¿›è¡Œå‰ç«¯çš„éƒ¨ç½²ï¼Œå› ä¸ºå‰ç«¯é•œåƒä¸­ Nginx çš„åå‘ä»£ç†é…ç½®ä¸­ä¼šå»æ£€æŸ¥åç«¯æ˜¯å¦å¯è¾¾ã€‚ä½¿ç”¨é…ç½®æ–‡ä»¶è¿›è¡Œéƒ¨ç½²ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">âœ  conf git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— kubectl apply -f frontend-deployment.yaml
deployment.apps/saythx-frontend created
âœ  conf git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— kubectl -n work get all
NAME                                   READY     STATUS    RESTARTS   AGE
pod/saythx-backend-c5f9f6d95-lmtxn     1/1       Running   <span style="color:#ae81ff">0</span>          16m
pod/saythx-frontend-678d544b86-wp9gr   1/1       Running   <span style="color:#ae81ff">0</span>          30s
pod/saythx-redis-8558c7d7d-kcmzk       1/1       Running   <span style="color:#ae81ff">0</span>          34m

NAME                     TYPE       CLUSTER-IP      EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>          AGE
service/saythx-backend   NodePort   10.104.0.47     &lt;none&gt;        8080:32051/TCP   15m
service/saythx-redis     NodePort   10.107.31.242   &lt;none&gt;        6379:31467/TCP   18m

NAME                              DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/saythx-backend    <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           16m
deployment.apps/saythx-frontend   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           30s
deployment.apps/saythx-redis      <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           34m

NAME                                         DESIRED   CURRENT   READY     AGE
replicaset.apps/saythx-backend-c5f9f6d95     <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         16m
replicaset.apps/saythx-frontend-678d544b86   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         30s
replicaset.apps/saythx-redis-8558c7d7d       <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         34m
</code></pre></div><h3 id="å‰ç«¯-service">å‰ç«¯ Service</h3>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦è®©å‰ç«¯å¯ä»¥è¢«ç›´æ¥è®¿é—®åˆ°ï¼ŒåŒæ ·çš„éœ€è¦å°†å®ƒä»¥ <code>Service</code> çš„å½¢å¼æš´éœ²å‡ºæ¥ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">labels</span>:
    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">frontend</span>
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">saythx-frontend</span>
  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">work</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">ports</span>:
  - <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;80&#34;</span>
    <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>
    <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">80</span>
  <span style="color:#f92672">selector</span>:
    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">frontend</span>
  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">NodePort</span>
</code></pre></div><p>åˆ›å»º <code>Service</code> ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">âœ  conf git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— kubectl apply -f frontend-service.yaml
service/saythx-frontend created
âœ  conf git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— kubectl -n work get svc
NAME              TYPE       CLUSTER-IP      EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>          AGE
saythx-backend    NodePort   10.104.0.47     &lt;none&gt;        8080:32051/TCP   17m
saythx-frontend   NodePort   10.96.221.71    &lt;none&gt;        80:32682/TCP     11s
saythx-redis      NodePort   10.107.31.242   &lt;none&gt;        6379:31467/TCP   20m
</code></pre></div><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ Node çš„ 32682 ç«¯å£è¿›è¡Œè®¿é—®ã€‚</p>
<h3 id="work-1">Work</h3>
<p>æœ€åï¼Œæ˜¯æˆ‘ä»¬çš„ Work ç»„ä»¶ï¼Œä¸ºå®ƒç¼–å†™é…ç½®æ–‡ä»¶ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">labels</span>:
    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">work</span>
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">saythx-work</span>
  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">work</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">selector</span>:
    <span style="color:#f92672">matchLabels</span>:
      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">work</span>
  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">1</span>
  <span style="color:#f92672">template</span>:
    <span style="color:#f92672">metadata</span>:
      <span style="color:#f92672">labels</span>:
        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">work</span>
    <span style="color:#f92672">spec</span>:
      <span style="color:#f92672">containers</span>:
      - <span style="color:#f92672">env</span>:
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">REDIS_HOST</span>
          <span style="color:#f92672">value</span>: <span style="color:#ae81ff">saythx-redis</span>
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">REDIS_PORT</span>
          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;6379&#34;</span>
        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">taobeier/saythx-work</span>
        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">work</span>
</code></pre></div><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬é€šè¿‡ç¯å¢ƒå˜é‡çš„æ–¹å¼ä¼ é€’äº† Redis ç›¸å…³çš„é…ç½®è¿›å»ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">âœ  conf git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— kubectl apply -f work-deployment.yaml
deployment.apps/saythx-work created
âœ  conf git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— kubectl -n work get all
NAME                                   READY     STATUS              RESTARTS   AGE
pod/saythx-backend-c5f9f6d95-lmtxn     1/1       Running             <span style="color:#ae81ff">0</span>          22m
pod/saythx-frontend-678d544b86-wp9gr   1/1       Running             <span style="color:#ae81ff">0</span>          5m
pod/saythx-redis-8558c7d7d-kcmzk       1/1       Running             <span style="color:#ae81ff">0</span>          39m
pod/saythx-work-6b9958dc47-hh9td       0/1       ContainerCreating   <span style="color:#ae81ff">0</span>          7s

NAME                      TYPE       CLUSTER-IP      EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>          AGE
service/saythx-backend    NodePort   10.104.0.47     &lt;none&gt;        8080:32051/TCP   20m
service/saythx-frontend   NodePort   10.96.221.71    &lt;none&gt;        80:32682/TCP     3m
service/saythx-redis      NodePort   10.107.31.242   &lt;none&gt;        6379:31467/TCP   23m

NAME                              DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/saythx-backend    <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           22m
deployment.apps/saythx-frontend   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           5m
deployment.apps/saythx-redis      <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           39m
deployment.apps/saythx-work       <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">0</span>           7s

NAME                                         DESIRED   CURRENT   READY     AGE
replicaset.apps/saythx-backend-c5f9f6d95     <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         22m
replicaset.apps/saythx-frontend-678d544b86   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         5m
replicaset.apps/saythx-redis-8558c7d7d       <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         39m
replicaset.apps/saythx-work-6b9958dc47       <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">0</span>         7s
</code></pre></div><p>ç°åœ¨å‡å·²ç»éƒ¨ç½²å®Œæˆã€‚å¹¶ä¸”å¯ç›´æ¥é€šè¿‡ Node ç«¯å£è¿›è¡Œè®¿é—®ã€‚</p>
<h2 id="æ‰©ç¼©å®¹">æ‰©ç¼©å®¹</h2>
<p>å¦‚æœæˆ‘ä»¬è§‰å¾—æ’è¡Œæ¦œç”Ÿæˆæ•ˆç‡è¾ƒä½ï¼Œåˆ™å¯é€šè¿‡æ‰©å®¹ Work æ¥å¾—åˆ°è§£å†³ã€‚å…·ä½“åšæ³•æ˜¯å¯ä¿®æ”¹ work çš„ <code>Deployment</code> é…ç½®æ–‡ä»¶ï¼Œå°† <code>spec.replicas</code> è®¾ç½®ä¸ºé¢„æœŸçš„æ•°å€¼ï¼Œä¹‹åæ‰§è¡Œ <code>kubectl -f work-deployment.yaml</code> å³å¯ã€‚</p>
<p>æˆ–è€…å¯ç›´æ¥é€šè¿‡å‘½ä»¤è¡Œè¿›è¡Œæ“ä½œ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">âœ  conf git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> âœ— kubectl -n work scale --replicas<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>  deployment/saythx-work
</code></pre></div><p>ä¸Šé¢çš„å‘½ä»¤æ˜¯å°† <code>saythx-work</code> çš„éƒ¨ç½²å‰¯æœ¬æ•°è®¾ç½®ä¸º 2 ã€‚ç¼©å®¹ä¹Ÿå·®ä¸å¤šæ˜¯ç±»ä¼¼çš„æ“ä½œã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>é€šè¿‡æœ¬èŠ‚çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ åˆ°äº†å¦‚ä½•å°†é¡¹ç›®å®é™…éƒ¨ç½²è‡³ K8S ä¸­ï¼Œå¯ä»¥æ‰‹åŠ¨ç¼–å†™é…ç½®ä¹Ÿå¯ä»¥åˆ©ç”¨ä¸€äº›å·¥å…·è¿›è¡Œè¾…åŠ©ã€‚åŒæ—¶ä¹Ÿäº†è§£åˆ°äº†å¦‚ä½•åº”å¯¹åº”ç”¨çš„æ‰©ç¼©å®¹ã€‚</p>
<p>ä½†å¦‚æœåº”ç”¨éœ€è¦è¿›è¡Œå‡çº§çš„è¯ï¼Œåˆ™éœ€è¦å»æ›´æ”¹é…ç½®æ–‡ä»¶ä¸­ç›¸å…³çš„é…ç½®ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šè¾ƒä¸ºç¹çï¼Œå¹¶ä¸”æ•´ä½“é¡¹ç›®çº¿ä¸Šçš„ç‰ˆæœ¬ç®¡ç†ä¹Ÿæ˜¯ä¸ªé—®é¢˜ï¼šæ¯”å¦‚ç»„ä»¶çš„ä¸ªäººå‡çº§ï¼Œå›æ»šä¹‹é—´å¦‚æœæœ‰ä¾èµ–çš„è¯ï¼Œä¼šæ¯”è¾ƒéº»çƒ¦ã€‚æˆ‘ä»¬åœ¨æ¥ä¸‹æ¥çš„ä¸¤èŠ‚æ¥å­¦ä¹ å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/08-%E5%AE%89%E5%85%A8%E9%87%8D%E7%82%B9-%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83/"><span>08 å®‰å…¨é‡ç‚¹ è®¤è¯å’Œæˆæƒ</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/10-%E5%BA%94%E7%94%A8%E7%AE%A1%E7%90%86%E5%88%9D%E8%AF%86-helm/"><span>10 åº”ç”¨ç®¡ç†ï¼šåˆè¯† Helm</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 27270 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>