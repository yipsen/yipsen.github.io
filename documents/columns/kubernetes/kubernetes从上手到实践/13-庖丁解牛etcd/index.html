<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>13 åº–ä¸è§£ç‰›ï¼šetcd | Yipsen Ye</title>
<meta name="description" content="æ•´ä½“æ¦‚è§ˆ &#43;----------------------------------------------------------&#43; | Master | | &#43;-------------------------&#43; | | &#43;-------&amp;gt;| API Server |&amp;lt;--------&#43; | | | | | | | | v &#43;-------------------------&#43; v | | &#43;----------------&#43; ^ &#43;--------------------&#43; | | | | | | | | | | Scheduler | | | Controller Manager | | | | | | | | | | &#43;----------------&#43; v &#43;--------------------&#43; | | &#43;------------------------------------------------------&#43; | | | | | | | Cluster state store | | | | | | | &#43;------------------------------------------------------&#43; | &#43;----------------------------------------------------------&#43; åœ¨ç¬¬ 3 èŠ‚ã€Šå®è§‚è®¤è¯†ï¼šæ•´ä½“æ¶æ„ã€‹ ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿè®¤è¯†åˆ°äº† etcd çš„å­˜åœ¨ï¼ŒçŸ¥é“äº† Master æ˜¯ K8S æ˜¯é›†ç¾¤çš„å¤§è„‘ï¼Œè€Œ etcd åˆ™æ˜¯å¤§è„‘çš„æ ¸å¿ƒã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿæœ¬èŠ‚æˆ‘ä»¬ä¸€åŒæ¥çœ‹çœ‹ etcd ä¸ºä½•å¦‚æ­¤é‡è¦ã€‚">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="nav-logo">
    <a href="http://yipsen.github.io/">
        
        <span class="nav-title">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æ–‡ç« </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/kubernetes%e4%bb%8e%e4%b8%8a%e6%89%8b%e5%88%b0%e5%ae%9e%e8%b7%b5/">Kubernetesä»ä¸Šæ‰‹åˆ°å®è·µ</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/01-%E5%BC%80%E7%AF%87-kubernetes-%E6%98%AF%E4%BB%80%E4%B9%88%E4%BB%A5%E5%8F%8A%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AE%83/">01 å¼€ç¯‡ï¼š Kubernetes æ˜¯ä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆéœ€è¦å®ƒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/02-%E5%88%9D%E6%AD%A5%E8%AE%A4%E8%AF%86kubernetes-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/">02 åˆæ­¥è®¤è¯†ï¼šKubernetes åŸºç¡€æ¦‚å¿µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/03-%E5%AE%8F%E8%A7%82%E8%AE%A4%E8%AF%86%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/">03 å®è§‚è®¤è¯†ï¼šæ•´ä½“æ¶æ„</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/04-%E6%90%AD%E5%BB%BA-kubernetes-%E9%9B%86%E7%BE%A4-%E6%9C%AC%E5%9C%B0%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA/">04 æ­å»º Kubernetes é›†ç¾¤ - æœ¬åœ°å¿«é€Ÿæ­å»º</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/05-%E5%8A%A8%E6%89%8B%E5%AE%9E%E8%B7%B5%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA-kubernetes-%E9%9B%86%E7%BE%A4-%E7%94%9F%E4%BA%A7%E5%8F%AF%E7%94%A8/">05 åŠ¨æ‰‹å®è·µï¼šæ­å»ºä¸€ä¸ª Kubernetes é›†ç¾¤ - ç”Ÿäº§å¯ç”¨</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/06-%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%9D%E8%AF%86-kubectl/">06 é›†ç¾¤ç®¡ç†ï¼šåˆè¯† kubectl</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/07-%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E4%BB%A5-redis-%E4%B8%BA%E4%BE%8B-%E9%83%A8%E7%BD%B2%E5%8F%8A%E8%AE%BF%E9%97%AE/">07 é›†ç¾¤ç®¡ç†ï¼šä»¥ Redis ä¸ºä¾‹-éƒ¨ç½²åŠè®¿é—®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/08-%E5%AE%89%E5%85%A8%E9%87%8D%E7%82%B9-%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83/">08 å®‰å…¨é‡ç‚¹ è®¤è¯å’Œæˆæƒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/09-%E5%BA%94%E7%94%A8%E5%8F%91%E5%B8%83%E9%83%A8%E7%BD%B2%E5%AE%9E%E9%99%85%E9%A1%B9%E7%9B%AE/">09 åº”ç”¨å‘å¸ƒï¼šéƒ¨ç½²å®é™…é¡¹ç›®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/10-%E5%BA%94%E7%94%A8%E7%AE%A1%E7%90%86%E5%88%9D%E8%AF%86-helm/">10 åº”ç”¨ç®¡ç†ï¼šåˆè¯† Helm</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/11-%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5%E4%BB%A5-helm-%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/">11 éƒ¨ç½²å®è·µï¼šä»¥ Helm éƒ¨ç½²é¡¹ç›®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/12-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-apiserver/">12 åº–ä¸è§£ç‰›ï¼škube-apiserver</a></li>
                
                
                
                    <li>13 åº–ä¸è§£ç‰›ï¼šetcd</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/14-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bcontroller-manager/">14 åº–ä¸è§£ç‰›ï¼šcontroller-manager</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/15-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-scheduler/">15 åº–ä¸è§£ç‰›ï¼škube-scheduler</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/16-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkubelet/">16 åº–ä¸è§£ç‰›ï¼škubelet</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/17-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-proxy/">17 åº–ä¸è§£ç‰›ï¼škube-proxy</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/18-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bcontainer-runtime-docker/">18 åº–ä¸è§£ç‰›ï¼šContainer Runtime ï¼ˆDockerï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/19-troubleshoot/">19 Troubleshoot</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/20-%E6%89%A9%E5%B1%95%E5%A2%9E%E5%BC%BAdashboard/">20 æ‰©å±•å¢å¼ºï¼šDashboard</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/21-%E6%89%A9%E5%B1%95%E5%A2%9E%E5%BC%BAcoredns/">21 æ‰©å±•å¢å¼ºï¼šCoreDNS</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/22-%E6%9C%8D%E5%8A%A1%E5%A2%9E%E5%BC%BAingress/">22 æœåŠ¡å¢å¼ºï¼šIngress</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/23-%E7%9B%91%E6%8E%A7%E5%AE%9E%E8%B7%B5%E5%AF%B9-k8s-%E9%9B%86%E7%BE%A4%E8%BF%9B%E8%A1%8C%E7%9B%91%E6%8E%A7/">23 ç›‘æ§å®è·µï¼šå¯¹ K8S é›†ç¾¤è¿›è¡Œç›‘æ§</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/24-%E6%80%BB%E7%BB%93/">24 æ€»ç»“</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">13 åº–ä¸è§£ç‰›ï¼šetcd</h1>
        <div class="post-info">
            <div class="post-date"> 
                <span>2021-12-22 01:47:39</span>
            </div>
        </div>
        <div class="post-content">
            <h2 id="æ•´ä½“æ¦‚è§ˆ">æ•´ä½“æ¦‚è§ˆ</h2>
<pre tabindex="0"><code>+----------------------------------------------------------+          
| Master                                                   |          
|              +-------------------------+                 |          
|     +-------&gt;|        API Server       |&lt;--------+       |          
|     |        |                         |         |       |          
|     v        +-------------------------+         v       |          
|   +----------------+     ^      +--------------------+   |          
|   |                |     |      |                    |   |          
|   |   Scheduler    |     |      | Controller Manager |   |          
|   |                |     |      |                    |   |          
|   +----------------+     v      +--------------------+   |          
| +------------------------------------------------------+ |          
| |                                                      | |          
| |                Cluster state store                   | |          
| |                                                      | |          
| +------------------------------------------------------+ |          
+----------------------------------------------------------+          
</code></pre><p>åœ¨ç¬¬ 3 èŠ‚ã€Šå®è§‚è®¤è¯†ï¼šæ•´ä½“æ¶æ„ã€‹ ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿè®¤è¯†åˆ°äº† <code>etcd</code> çš„å­˜åœ¨ï¼ŒçŸ¥é“äº† Master æ˜¯ K8S æ˜¯é›†ç¾¤çš„å¤§è„‘ï¼Œè€Œ <code>etcd</code> åˆ™æ˜¯å¤§è„‘çš„æ ¸å¿ƒã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿæœ¬èŠ‚æˆ‘ä»¬ä¸€åŒæ¥çœ‹çœ‹ <code>etcd</code> ä¸ºä½•å¦‚æ­¤é‡è¦ã€‚</p>
<h2 id="etcd-æ˜¯ä»€ä¹ˆ"><code>etcd</code> æ˜¯ä»€ä¹ˆ</h2>
<p>å…ˆæ‘˜å½•<a href="https://etcd.readthedocs.io/en/latest/faq.html#what-is-etcd">å®˜æ–¹æ–‡æ¡£</a>çš„ä¸€å¥è¯´æ˜:</p>
<blockquote>
<p>etcd is a consistent distributed key-value store. Mainly used as a separate coordination service, in distributed systems. And designed to hold small amounts of data that can fit entirely in memory.</p>
</blockquote>
<p><code>etcd</code> æ˜¯ç”± CoreOS å›¢é˜Ÿå‘èµ·çš„ä¸€ä¸ªåˆ†å¸ƒå¼ï¼Œå¼ºä¸€è‡´çš„é”®å€¼å­˜å‚¨ã€‚å®ƒç”¨ Go è¯­è¨€ç¼–å†™ï¼Œä½¿ç”¨ <code>Raft</code> åè®®ä½œä¸ºä¸€è‡´æ€§ç®—æ³•ã€‚å¤šæ•°æƒ…å†µä¸‹ä¼šç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æœåŠ¡æ³¨å†Œå‘ç°ï¼Œæˆ–æ˜¯ç”¨äºå­˜å‚¨ç³»ç»Ÿçš„å…³é”®æ•°æ®ã€‚</p>
<h2 id="etcd-æœ‰ä»€ä¹ˆä½œç”¨"><code>etcd</code> æœ‰ä»€ä¹ˆä½œç”¨</h2>
<p><code>etcd</code> åœ¨ K8S ä¸­ï¼Œæœ€ä¸»è¦çš„ä½œç”¨ä¾¿æ˜¯å…¶é«˜å¯ç”¨ï¼Œå¼ºä¸€è‡´çš„é”®å€¼å­˜å‚¨ä»¥åŠç›‘å¬æœºåˆ¶ã€‚</p>
<p>åœ¨ <code>kube-apiserver</code> æ”¶åˆ°å¯¹åº”è¯·æ±‚ç»è¿‡ä¸€ç³»åˆ—çš„å¤„ç†åï¼Œæœ€ç»ˆå¦‚æœæ˜¯é›†ç¾¤æ‰€éœ€è¦å­˜å‚¨çš„æ•°æ®ï¼Œä¾¿ä¼šå­˜å‚¨è‡³ <code>etcd</code> ä¸­ã€‚ä¸»éƒ¨åˆ†ä¸»è¦æ˜¯é›†ç¾¤çŠ¶æ€ä¿¡æ¯å’Œå…ƒä¿¡æ¯ã€‚</p>
<p>æˆ‘ä»¬æ¥å®é™…æ“ä½œ K8S é›†ç¾¤ä¸­çš„ <code>etcd</code> çœ‹ä¸‹çœŸå®æƒ…å†µã€‚</p>
<ul>
<li>æŸ¥æ‰¾é›†ç¾¤ä¸­çš„ <code>etcd</code> Pod</li>
</ul>
<pre tabindex="0"><code># é»˜è®¤é›†ç¾¤ä¸­çš„ etcd ä¼šæ”¾åˆ° kube-system Namespace ä¸­
master $ kubectl -n kube-system get pods | grep etcd
etcd-master                      1/1       Running   0          1h
</code></pre><ul>
<li>è¿›å…¥è¯¥ Pod å¹¶æŸ¥çœ‹ <code>etcd</code> é›†ç¾¤çš„ <code>member</code></li>
</ul>
<pre tabindex="0"><code>master $ kubectl -n kube-system exec -it etcd-master sh
/ # ETCDCTL_API=3 etcdctl --key=/etc/kubernetes/pki/etcd/server.key  --cert=/etc/kubernetes/pki/etcd/server.crt  --cacert=/etc/kubernetes/pki/etcd/ca.crt member list
a874c87fd42044f, started, master, https://127.0.0.1:2380, https://127.0.0.1:2379
</code></pre><p>è¿™é‡Œç”±äºåœ¨ K8S 1.11.3 ä¸­é»˜è®¤ä½¿ç”¨çš„æ˜¯ <code>etcd</code> 3.2 ç‰ˆæœ¬ï¼Œæ‰€ä»¥éœ€è¦åŠ å…¥ <code>ETCDCTL_API=3</code> çš„ç¯å¢ƒå˜é‡ï¼Œä¸” <code>etcd</code> ä» 2 åˆ° 3 å¾ˆæ˜æ˜¾çš„ä¸€ä¸ªå˜åŒ–ä¹Ÿæ˜¯ä½¿ç”¨ä¸Šçš„å˜åŒ–ï¼Œåœ¨ 2 ä¸­æ˜¯ HTTP æ¥å£çš„ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡ä¼ é€’è¯ä¹¦ç­‰ç›¸å…³å‚æ•°è¿›å»ï¼Œå®Œæˆæ ¡éªŒï¼ŒæŸ¥çœ‹ <code>member</code> ã€‚</p>
<ul>
<li>æŸ¥çœ‹å­˜å‚¨çš„å…ƒä¿¡æ¯</li>
</ul>
<p><code>etcd</code> ä¸­å­˜å‚¨çš„ K8S é›†ç¾¤å…ƒä¿¡æ¯åŸºæœ¬éƒ½æ˜¯ <code>/registry</code> ä¸‹ï¼Œæˆ‘ä»¬å¯é€šè¿‡ä¸‹é¢çš„æ–¹å¼è¿›è¡ŒæŸ¥çœ‹</p>
<pre tabindex="0"><code>/ # ETCDCTL_API=3 etcdctl --key=/etc/kubernetes/pki/etcd/server.key  --cert=/etc/kubernetes/pki/etcd/server.crt  --cacert=/etc/kubernetes/pki/etcd/ca.crt get /registry --prefix --keys-only
/registry/apiregistration.k8s.io/apiservices/v1.
/registry/clusterroles/system:aggregate-to-admin
/registry/configmaps/kube-public/cluster-info
/registry/masterleases/172.17.0.53
/registry/namespaces/default
/registry/namespaces/kube-public
/registry/namespaces/kube-system
/registry/pods/kube-system/etcd-master
/registry/pods/kube-system/kube-apiserver-master
/registry/ranges/serviceips
/registry/ranges/servicenodeports
...
# ç¯‡å¹…åŸå› ï¼Œåˆ æ‰äº†å¾ˆå¤šè¾“å‡º
</code></pre><p>å¯ä»¥çœ‹åˆ°æœ‰å„ç§ç±»å‹çš„èµ„æºã€‚æˆ‘ä»¬ç›´æ¥ä»¥ Namespaces ä¸ºä¾‹ã€‚</p>
<ul>
<li>æŸ¥çœ‹ Namespaces ä¿¡æ¯</li>
</ul>
<pre tabindex="0"><code>/ # ETCDCTL_API=3 etcdctl --key=/etc/kubernetes/pki/etcd/server.key  --cert=/etc/kubernetes/pki/etcd/server.crt  --cacert=/etc/kubernetes/pki/etcd/ca.crt get /registry/namespaces --prefix --keys-only
/registry/namespaces/default

/registry/namespaces/kube-public

/registry/namespaces/kube-system
</code></pre><ul>
<li>ä½¿ç”¨ <code>kubectl</code> åˆ›å»ºåä¸º <code>moelove</code> çš„ Namespaces</li>
</ul>
<pre tabindex="0"><code>master $ kubectl create  ns moelove
namespace/moelove created
</code></pre><ul>
<li>æŸ¥çœ‹ Namespaces ä¿¡æ¯</li>
</ul>
<pre tabindex="0"><code>/ # ETCDCTL_API=3 etcdctl --key=/etc/kubernetes/pki/etcd/server.key  --cert=/etc/kubernetes/pki/etcd/server.crt  --cacert=/etc/kubernetes/pki/etcd/ca.crt get /registry/namespaces --prefix --keys-only
/registry/namespaces/default

/registry/namespaces/kube-public

/registry/namespaces/kube-system

/registry/namespaces/moelove
</code></pre><p>å‘ç°åˆšåˆ›å»ºçš„ <code>moelove</code> çš„ Namespaces å·²ç»åœ¨ <code>etcd</code> ä¸­äº†ã€‚</p>
<h2 id="etcd-æ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„"><code>etcd</code> æ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„</h2>
<p>é¦–å…ˆï¼Œåœ¨ <code>staging/src/k8s.io/apiserver/pkg/server/options/etcd.go</code> ä¸­ï¼Œå­˜åœ¨ä¸€å¤„å£°æ˜ï¼š</p>
<pre tabindex="0"><code>var storageTypes = sets.NewString(
storagebackend.StorageTypeUnset,
storagebackend.StorageTypeETCD2,
storagebackend.StorageTypeETCD3,
)
</code></pre><p><strong>åœ¨ 1.13 å‘å¸ƒæ—¶ï¼Œetcd 2 çš„ç›¸å…³ä»£ç å·²ç»ç§»é™¤ï¼Œå…¶ä¸­å°±åŒ…å«ä¸Šé¢å£°æ˜ä¸­çš„ storagebackend.StorageTypeETCD2</strong></p>
<p>è¿™é‡Œæ˜¯åœ¨è¿‡æ¸¡æœŸé—´ä¸ºäº†åŒæ—¶å…¼å®¹ <code>etcd</code> 2 å’Œ 3 è€Œå¢åŠ çš„ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸‹å®é™…å¯¹å„ç±»èµ„æºçš„æ“ä½œï¼Œè¿˜æ˜¯ä»¥å¯¹ <code>Namespace</code> çš„æ“ä½œä¸ºä¾‹ï¼šä»£ç åœ¨ <code>pkg/registry/core/namespace/storage/storage.go</code> ä¸­ï¼Œ</p>
<p>æ¯”å¦‚ï¼Œ<code>Get</code>ï¼š</p>
<pre tabindex="0"><code>func (r *REST) Get(ctx context.Context, name string, options *metav1.GetOptions) (runtime.Object, error) {
return r.store.Get(ctx, name, options)
}
</code></pre><p>è€Œ <code>REST</code> åˆ™æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š</p>
<pre tabindex="0"><code>type REST struct {
store  *genericregistry.Store
status *genericregistry.Store
}
</code></pre><p>é€šè¿‡ <code>REST</code> å®ç°äº†ä¸€ä¸ª <code>RESTStorage</code>ï¼Œå®é™…ä½¿ç”¨æ—¶ï¼Œä¹Ÿæ˜¯è°ƒç”¨äº† <code>staging/src/k8s.io/apiserver/pkg/registry/generic/registry/store.go</code> å¯¹æ¥å£çš„å°è£…ã€‚</p>
<pre tabindex="0"><code>func (e *Store) Get(ctx context.Context, name string, options *metav1.GetOptions) (runtime.Object, error) {
obj := e.NewFunc()
key, err := e.KeyFunc(ctx, name)
if err != nil {
return nil, err
}
if err := e.Storage.Get(ctx, key, options.ResourceVersion, obj, false); err != nil {
return nil, storeerr.InterpretGetError(err, e.qualifiedResourceFromContext(ctx), name)
}
if e.Decorator != nil {
if err := e.Decorator(obj); err != nil {
return nil, err
}
}
return obj, nil
}
</code></pre><p>åœ¨è¯¥å¤„å®ç°äº†å¯¹å„ç±»åŸºæœ¬æ–¹æ³•çš„å°è£…ï¼Œå„ç§èµ„æºç±»å‹éƒ½ä¼šç»Ÿä¸€å»è°ƒç”¨ã€‚è€Œæ›´ä¸Šå±‚åˆ™æ˜¯å¯¹ <code>storagebackend</code> çš„ç»Ÿä¸€å°è£…ï¼Œæœ€ç»ˆä¼šè°ƒç”¨ <code>etcd</code> å®¢æˆ·ç«¯çš„å®ç°å®Œæˆæƒ³å¯¹åº”çš„æ“ä½œï¼Œè¿™é‡Œå°±ä¸å†å¤šå±•å¼€äº†ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† <code>etcd</code> ä»¥åŠå®ƒåœ¨ K8S ä¸­çš„ä½œç”¨ä»¥åŠå¦‚ä½•ä½¿ç”¨ã€‚æˆ‘ä»¬è¿˜ä»‹ç»äº†å¦‚ä½•é€šè¿‡ <code>etcdctl</code> å·¥å…·å»æ“ä½œ <code>etcd</code>ã€‚</p>
<p>åœ¨æŸäº›æç«¯æƒ…å†µä¸‹ï¼Œä¹Ÿè®¸ä½ éœ€è¦é€šè¿‡ç›´æ¥æ“ä½œ <code>etcd</code> é›†ç¾¤å»å˜æ›´æ•°æ®ï¼Œè¿™é‡Œæ²¡æœ‰ä»‹ç»æ‰€æœ‰çš„æ“ä½œå‘½ä»¤ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡Œé€šè¿‡ä¸‹æ–¹çš„é“¾æ¥çœ‹å®˜æ–¹æ–‡æ¡£è¿›è¡Œå­¦ä¹ ã€‚</p>
<p>ä½†é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸å»ºè®®ç›´æ¥æ“ä½œ <code>etcd</code> ï¼Œé™¤éä½ å·²ç»æ˜ç¡®è‡ªå·±åœ¨åšä»€ä¹ˆã€‚</p>
<p>å¦å¤–ï¼Œç”±äº <code>etcd</code> é›†ç¾¤ä½¿ç”¨ <code>Raft</code> ä¸€è‡´æ€§ç®—æ³•ï¼Œé€šå¸¸æƒ…å†µä¸‹ <code>etcd</code> é›†ç¾¤éœ€è¦éƒ¨ç½²å¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼Œå¦‚ 3ï¼Œ5ï¼Œ7 ç­‰ã€‚<code>etcd</code> é›†ç¾¤ç»´æŠ¤ä¹Ÿç›¸å¯¹å®¹æ˜“ï¼Œå¾ˆå®¹æ˜“å¯ä»¥åšæˆé«˜å¯ç”¨é›†ç¾¤ã€‚ï¼ˆè¿™ä¹Ÿæ˜¯ä¿éšœ K8S é›†ç¾¤é«˜å¯ç”¨çš„é‡è¦ä¸€ç¯ï¼‰</p>
<p>å­¦ä¹ äº† <code>etcd</code> ä¹‹åï¼Œä¸‹èŠ‚æˆ‘ä»¬æ¥å­¦ä¹ åŒæ ·å¾ˆé‡è¦çš„ä¸€ä¸ªç»„ä»¶ <code>Controller Manager</code>ï¼Œå­¦ä¹ å®ƒæ˜¯å¦‚ä½•ä¿éšœé›†ç¾¤ç¬¦åˆé¢„æœŸçŠ¶æ€çš„ã€‚</p>
<h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h2>
<ul>
<li><a href="https://etcd.readthedocs.io/en/latest/faq.html#what-is-etcd">What is etcd</a></li>
</ul>

        </div>
    </article>
</div>
<div class="division-line"></div>
<div class="others">
    <div>æ ‡ç­¾ï¼šğŸ·ï¸<a class="post-tag" href="/tags/kubernetes/">kubernetes</a>&nbsp;</div>
    <div>åˆ†ç±»ï¼š ğŸ“’<a class="post-category" href="/categories/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/">Kubernetesä»ä¸Šæ‰‹åˆ°å®è·µ</a>&nbsp; </div>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/12-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-apiserver/"><span>12 åº–ä¸è§£ç‰›ï¼škube-apiserver</span></a>
    </div>
    <div class="next">
        
        <a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/14-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bcontroller-manager/"><span>14 åº–ä¸è§£ç‰›ï¼šcontroller-manager</span></a>
    </div>
</div>

        </div>
        <div id="float">
            <ul class="float-button-bar">
    <li>
        <button class="float-button top" onclick="scrollToTop(this);">UP</button>
    </li>
    <li>
        <button class="float-button toggler" onclick="changeSkin(this);">DARK</button>
    </li>
</ul>
        </div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 2020 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    const changeSkin = () => {
        document.getElementById('page').classList.toggle('night');
    }
    const scrollToTop = () => {
        window.scrollTo(0, 0);
    }
</script>
</body>

</html>