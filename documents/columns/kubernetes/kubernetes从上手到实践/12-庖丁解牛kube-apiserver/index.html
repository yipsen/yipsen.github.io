<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>12 åº–ä¸è§£ç‰›ï¼škube-apiserver | Yipsen Ye</title>
<meta name="description" content="æ•´ä½“æ¦‚è§ˆ &#43;----------------------------------------------------------&#43; | Master | | &#43;-------------------------&#43; | | &#43;-------&amp;gt;| API Server |&amp;lt;--------&#43; | | | | | | | | v &#43;-------------------------&#43; v | | &#43;----------------&#43; ^ &#43;--------------------&#43; | | | | | | | | | | Scheduler | | | Controller Manager | | | | | | | | | | &#43;----------------&#43; v &#43;--------------------&#43; | | &#43;------------------------------------------------------&#43; | | | | | | | Cluster state store | | | | | | | &#43;------------------------------------------------------&#43; | &#43;----------------------------------------------------------&#43; åœ¨ç¬¬ 3 èŠ‚ã€Šå®è§‚è®¤è¯†ï¼šæ•´ä½“æ¶æ„ã€‹ ä¸­ï¼Œæˆ‘ä»¬åˆæ¬¡è®¤è¯†åˆ°äº† kube-apiserver çš„å­˜åœ¨ï¼ˆä»¥ä¸‹å†…å®¹ä¸­å°†ç»Ÿä¸€ç§°ä¹‹ä¸º kube-apiserverï¼‰ï¼ŒçŸ¥é“äº†å®ƒä½œä¸ºé›†ç¾¤çš„ç»Ÿä¸€å…¥å£ï¼Œæ¥æ”¶æ¥è‡ªå¤–éƒ¨çš„ä¿¡å·å’Œè¯·æ±‚ï¼Œå¹¶å°†ä¸€äº›ä¿¡æ¯å­˜å‚¨è‡³ etcd ä¸­ã€‚">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="nav-logo">
    <a href="http://yipsen.github.io/">
        
        <span class="nav-title">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æ–‡ç« </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/kubernetes%e4%bb%8e%e4%b8%8a%e6%89%8b%e5%88%b0%e5%ae%9e%e8%b7%b5/">Kubernetesä»ä¸Šæ‰‹åˆ°å®è·µ</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/01-%E5%BC%80%E7%AF%87-kubernetes-%E6%98%AF%E4%BB%80%E4%B9%88%E4%BB%A5%E5%8F%8A%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AE%83/">01 å¼€ç¯‡ï¼š Kubernetes æ˜¯ä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆéœ€è¦å®ƒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/02-%E5%88%9D%E6%AD%A5%E8%AE%A4%E8%AF%86kubernetes-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/">02 åˆæ­¥è®¤è¯†ï¼šKubernetes åŸºç¡€æ¦‚å¿µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/03-%E5%AE%8F%E8%A7%82%E8%AE%A4%E8%AF%86%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/">03 å®è§‚è®¤è¯†ï¼šæ•´ä½“æ¶æ„</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/04-%E6%90%AD%E5%BB%BA-kubernetes-%E9%9B%86%E7%BE%A4-%E6%9C%AC%E5%9C%B0%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA/">04 æ­å»º Kubernetes é›†ç¾¤ - æœ¬åœ°å¿«é€Ÿæ­å»º</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/05-%E5%8A%A8%E6%89%8B%E5%AE%9E%E8%B7%B5%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA-kubernetes-%E9%9B%86%E7%BE%A4-%E7%94%9F%E4%BA%A7%E5%8F%AF%E7%94%A8/">05 åŠ¨æ‰‹å®è·µï¼šæ­å»ºä¸€ä¸ª Kubernetes é›†ç¾¤ - ç”Ÿäº§å¯ç”¨</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/06-%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%9D%E8%AF%86-kubectl/">06 é›†ç¾¤ç®¡ç†ï¼šåˆè¯† kubectl</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/07-%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E4%BB%A5-redis-%E4%B8%BA%E4%BE%8B-%E9%83%A8%E7%BD%B2%E5%8F%8A%E8%AE%BF%E9%97%AE/">07 é›†ç¾¤ç®¡ç†ï¼šä»¥ Redis ä¸ºä¾‹-éƒ¨ç½²åŠè®¿é—®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/08-%E5%AE%89%E5%85%A8%E9%87%8D%E7%82%B9-%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83/">08 å®‰å…¨é‡ç‚¹ è®¤è¯å’Œæˆæƒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/09-%E5%BA%94%E7%94%A8%E5%8F%91%E5%B8%83%E9%83%A8%E7%BD%B2%E5%AE%9E%E9%99%85%E9%A1%B9%E7%9B%AE/">09 åº”ç”¨å‘å¸ƒï¼šéƒ¨ç½²å®é™…é¡¹ç›®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/10-%E5%BA%94%E7%94%A8%E7%AE%A1%E7%90%86%E5%88%9D%E8%AF%86-helm/">10 åº”ç”¨ç®¡ç†ï¼šåˆè¯† Helm</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/11-%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5%E4%BB%A5-helm-%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/">11 éƒ¨ç½²å®è·µï¼šä»¥ Helm éƒ¨ç½²é¡¹ç›®</a></li>
                
                
                
                    <li>12 åº–ä¸è§£ç‰›ï¼škube-apiserver</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/13-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Betcd/">13 åº–ä¸è§£ç‰›ï¼šetcd</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/14-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bcontroller-manager/">14 åº–ä¸è§£ç‰›ï¼šcontroller-manager</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/15-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-scheduler/">15 åº–ä¸è§£ç‰›ï¼škube-scheduler</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/16-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkubelet/">16 åº–ä¸è§£ç‰›ï¼škubelet</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/17-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-proxy/">17 åº–ä¸è§£ç‰›ï¼škube-proxy</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/18-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bcontainer-runtime-docker/">18 åº–ä¸è§£ç‰›ï¼šContainer Runtime ï¼ˆDockerï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/19-troubleshoot/">19 Troubleshoot</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/20-%E6%89%A9%E5%B1%95%E5%A2%9E%E5%BC%BAdashboard/">20 æ‰©å±•å¢å¼ºï¼šDashboard</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/21-%E6%89%A9%E5%B1%95%E5%A2%9E%E5%BC%BAcoredns/">21 æ‰©å±•å¢å¼ºï¼šCoreDNS</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/22-%E6%9C%8D%E5%8A%A1%E5%A2%9E%E5%BC%BAingress/">22 æœåŠ¡å¢å¼ºï¼šIngress</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/23-%E7%9B%91%E6%8E%A7%E5%AE%9E%E8%B7%B5%E5%AF%B9-k8s-%E9%9B%86%E7%BE%A4%E8%BF%9B%E8%A1%8C%E7%9B%91%E6%8E%A7/">23 ç›‘æ§å®è·µï¼šå¯¹ K8S é›†ç¾¤è¿›è¡Œç›‘æ§</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/24-%E6%80%BB%E7%BB%93/">24 æ€»ç»“</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">12 åº–ä¸è§£ç‰›ï¼škube-apiserver</h1>
        <div class="post-info">
            <div class="post-date"> 
                <span>2021-12-22 01:47:38</span>
            </div>
        </div>
        <div class="post-content">
            <h2 id="æ•´ä½“æ¦‚è§ˆ">æ•´ä½“æ¦‚è§ˆ</h2>
<pre tabindex="0"><code>+----------------------------------------------------------+          
| Master                                                   |          
|              +-------------------------+                 |          
|     +-------&gt;|        API Server       |&lt;--------+       |          
|     |        |                         |         |       |          
|     v        +-------------------------+         v       |          
|   +----------------+     ^      +--------------------+   |          
|   |                |     |      |                    |   |          
|   |   Scheduler    |     |      | Controller Manager |   |          
|   |                |     |      |                    |   |          
|   +----------------+     v      +--------------------+   |          
| +------------------------------------------------------+ |          
| |                                                      | |          
| |                Cluster state store                   | |          
| |                                                      | |          
| +------------------------------------------------------+ |          
+----------------------------------------------------------+          
</code></pre><p>åœ¨ç¬¬ 3 èŠ‚ã€Šå®è§‚è®¤è¯†ï¼šæ•´ä½“æ¶æ„ã€‹ ä¸­ï¼Œæˆ‘ä»¬åˆæ¬¡è®¤è¯†åˆ°äº† <code>kube-apiserver</code> çš„å­˜åœ¨ï¼ˆä»¥ä¸‹å†…å®¹ä¸­å°†ç»Ÿä¸€ç§°ä¹‹ä¸º <code>kube-apiserver</code>ï¼‰ï¼ŒçŸ¥é“äº†å®ƒä½œä¸ºé›†ç¾¤çš„ç»Ÿä¸€å…¥å£ï¼Œæ¥æ”¶æ¥è‡ªå¤–éƒ¨çš„ä¿¡å·å’Œè¯·æ±‚ï¼Œå¹¶å°†ä¸€äº›ä¿¡æ¯å­˜å‚¨è‡³ <code>etcd</code> ä¸­ã€‚</p>
<p>ä½†è¿™åªæ˜¯ä¸€ç§å¾ˆæ¨¡ç³Šçš„è¯´æ³•ï¼Œæœ¬èŠ‚æˆ‘ä»¬æ¥å…·ä½“çœ‹çœ‹ <code>kube-apiserver</code> çš„å…³é”®åŠŸèƒ½ä»¥åŠå®ƒçš„å·¥ä½œåŸç†ã€‚</p>
<p>æ³¨æ„ï¼šæœ¬èŠ‚æ‰€æœ‰çš„æºç å‡ä»¥ <code>v1.11.3</code> ä¸ºå‡† commit id <code>a4529464e4629c21224b3d52edfe0ea91b072862</code>ã€‚</p>
<h2 id="rest-api-server">REST API Server</h2>
<p>å…ˆæ¥è¯´ä¸‹ <code>kube-apiserver</code> ä½œä¸ºæ•´ä¸ªé›†ç¾¤çš„å…¥å£ï¼Œæ¥å—å¤–éƒ¨çš„ä¿¡å·å’Œè¯·æ±‚æ‰€åº”è¯¥å…·å¤‡çš„åŸºæœ¬åŠŸèƒ½ã€‚</p>
<p>é¦–å…ˆï¼Œå®ƒå¯¹å¤–æä¾›æ¥å£ï¼Œå¯å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯ï¼ˆæ— è®ºæˆ‘ä»¬åœ¨ç”¨çš„ <code>kubeclt</code> æˆ–è€… <code>curl</code> æˆ–è€…å…¶ä»–è¯­è¨€å®ç°çš„å®¢æˆ·ç«¯ï¼‰çš„è¯·æ±‚ï¼Œå¹¶ä½œå‡ºå“åº”ã€‚</p>
<p>åœ¨ç¬¬ 5 èŠ‚æ­å»ºé›†ç¾¤æ—¶ï¼Œæˆ‘ä»¬æåˆ°è¦å…ˆå»æ£€æŸ¥ <code>6443</code> ç«¯å£æ˜¯å¦è¢«å ç”¨ã€‚è¿™æ ·æ£€æŸ¥çš„åŸå› åœ¨äº <code>kube-apiserver</code> æœ‰ä¸ª <code>--secure-port</code> çš„å‚æ•°ï¼Œé€šè¿‡è¿™ä¸ªå‚æ•°æ¥é…ç½®å®ƒå°†è¦ç›‘å¬åœ¨å“ªä¸ªç«¯å£ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ <code>6443</code>ã€‚</p>
<p>å½“ç„¶ï¼Œå®ƒè¿˜æœ‰å¦ä¸€ä¸ªå‚æ•° <code>--insecure-port</code> ï¼Œè¿™ä¸ªå‚æ•°å¯å°† <code>kube-apiserver</code> ç»‘å®šåˆ°å…¶æŒ‡å®šçš„ç«¯å£ä¸Šï¼Œä¸”é€šè¿‡è¯¥ç«¯å£è®¿é—®æ—¶æ— éœ€è®¤è¯ã€‚</p>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®å°†å…¶è®¾ç½®ä¸º <code>0</code> ä»¥ç¦ç”¨è¯¥åŠŸèƒ½ã€‚å¦å¤–ï¼Œè¿™ä¸ªå‚æ•°ä¹Ÿå·²ç»è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œå°†åœ¨ä¹‹åç‰ˆæœ¬ä¸­ç§»é™¤ã€‚å¦‚æœæœªç¦ç”¨è¯¥åŠŸèƒ½ï¼Œå»ºè®®é€šè¿‡é˜²ç«å¢™ç­–ç•¥ç¦æ­¢ä»å¤–éƒ¨è®¿é—®è¯¥ç«¯å£ã€‚è¯¥ç«¯å£ä¼šç»‘å®šåœ¨ <code>--insecure-bind-address</code> å‚æ•°æ‰€è®¾ç½®çš„åœ°å€ä¸Šï¼Œé»˜è®¤ä¸º <code>127.0.0.1</code>ã€‚</p>
<p>é‚£ä¹ˆ <code>secure</code> å’Œ <code>insecure</code> æœ€ä¸»è¦çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ è¿™å°±å¼•å‡ºæ¥äº† <code>kube-apiserver</code> ä½œä¸º API Server çš„ä¸€ä¸ªæœ€ä¸»è¦åŠŸèƒ½ï¼šè®¤è¯ã€‚</p>
<h3 id="è®¤è¯authentication">è®¤è¯ï¼ˆAuthenticationï¼‰</h3>
<p>åœ¨ç¬¬ 8 èŠ‚ã€Šè®¤è¯å’Œæˆæƒã€‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»è®²è¿‡è®¤è¯ç›¸å…³çš„æœºåˆ¶ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä»¥æœ€ç®€å•çš„è·å–é›†ç¾¤ç‰ˆæœ¬å·ä¸ºä¾‹ã€‚</p>
<p>é€šå¸¸ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>kubeclt version</code> æ¥è·å–é›†ç¾¤å’Œå½“å‰å®¢æˆ·ç«¯çš„ç‰ˆæœ¬å·ã€‚</p>
<pre tabindex="0"><code>master $ kubectl version
Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;11&quot;, GitVersion:&quot;v1.11.3&quot;, GitCommit:&quot;a4529464e4629c21224b3d52edfe0ea91b072862&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-09-09T18:02:47Z&quot;, GoVersion:&quot;go1.10.3&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;}
Server Version: version.Info{Major:&quot;1&quot;, Minor:&quot;11&quot;, GitVersion:&quot;v1.11.3&quot;, GitCommit:&quot;a4529464e4629c21224b3d52edfe0ea91b072862&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-09-09T17:53:03Z&quot;, GoVersion:&quot;go1.10.3&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;}
</code></pre><p>è·å–é›†ç¾¤ç‰ˆæœ¬å·çš„æ—¶å€™ï¼Œå…¶å®ä¹Ÿæ˜¯å‘ <code>kube-apiserver</code> å‘é€äº†ä¸€ä¸ªè¯·æ±‚è¿›è¡ŒæŸ¥è¯¢çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ é€’ <code>-v</code> å‚æ•°æ¥æ”¹å˜ log level ã€‚</p>
<pre tabindex="0"><code>master $ kubectl version -v 8
I1202 03:15:06.360838   13581 loader.go:359] Config loaded from file /root/.kube/config
I1202 03:15:06.362106   13581 round_trippers.go:383] GET https://172.17.0.99:6443/version?timeout=32s
I1202 03:15:06.362130   13581 round_trippers.go:390] Request Headers:
I1202 03:15:06.362139   13581 round_trippers.go:393]     Accept: application/json, */*
I1202 03:15:06.362146   13581 round_trippers.go:393]     User-Agent: kubectl/v1.11.3 (linux/amd64) kubernetes/a452946
I1202 03:15:06.377653   13581 round_trippers.go:408] Response Status: 200 OK in 15 milliseconds
I1202 03:15:06.377678   13581 round_trippers.go:411] Response Headers:
I1202 03:15:06.377686   13581 round_trippers.go:414]     Content-Type: application/json
I1202 03:15:06.377693   13581 round_trippers.go:414]     Content-Length: 263
I1202 03:15:06.377699   13581 round_trippers.go:414]     Date: Sun, 02 Dec 2018 03:15:06 GMT
I1202 03:15:06.379314   13581 request.go:897] Response Body: {
  &quot;major&quot;: &quot;1&quot;,
  &quot;minor&quot;: &quot;11&quot;,
  &quot;gitVersion&quot;: &quot;v1.11.3&quot;,
  &quot;gitCommit&quot;: &quot;a4529464e4629c21224b3d52edfe0ea91b072862&quot;,
  &quot;gitTreeState&quot;: &quot;clean&quot;,
  &quot;buildDate&quot;: &quot;2018-09-09T17:53:03Z&quot;,
  &quot;goVersion&quot;: &quot;go1.10.3&quot;,
  &quot;compiler&quot;: &quot;gc&quot;,
  &quot;platform&quot;: &quot;linux/amd64&quot;
}
Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;11&quot;, GitVersion:&quot;v1.11.3&quot;, GitCommit:&quot;a4529464e4629c21224b3d52edfe0ea91b072862&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-09-09T18:02:47Z&quot;, GoVersion:&quot;go1.10.3&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;}
Server Version: version.Info{Major:&quot;1&quot;, Minor:&quot;11&quot;, GitVersion:&quot;v1.11.3&quot;, GitCommit:&quot;a4529464e4629c21224b3d52edfe0ea91b072862&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-09-09T17:53:03Z&quot;, GoVersion:&quot;go1.10.3&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;}
</code></pre><p>é€šè¿‡æ—¥å¿—å°±å¯ä»¥å¾ˆæ˜æ˜¾çœ‹åˆ°ï¼Œé¦–å…ˆä¼šåŠ è½½ <code>$HOME/.kube/config</code> ä¸‹çš„é…ç½®ï¼Œè·çš„é›†ç¾¤åœ°å€ï¼Œè¿›è€Œè¯·æ±‚ <code>/version</code> æ¥å£ï¼Œæœ€åæ ¼å¼åŒ–è¾“å‡ºã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨ <code>curl</code> å»è¯·æ±‚åŒæ ·çš„æ¥å£ï¼š</p>
<pre tabindex="0"><code>master $ curl -k https://172.17.0.99:6443/version
{
  &quot;major&quot;: &quot;1&quot;,
  &quot;minor&quot;: &quot;11&quot;,
  &quot;gitVersion&quot;: &quot;v1.11.3&quot;,
  &quot;gitCommit&quot;: &quot;a4529464e4629c21224b3d52edfe0ea91b072862&quot;,
  &quot;gitTreeState&quot;: &quot;clean&quot;,
  &quot;buildDate&quot;: &quot;2018-09-09T17:53:03Z&quot;,
  &quot;goVersion&quot;: &quot;go1.10.3&quot;,
  &quot;compiler&quot;: &quot;gc&quot;,
  &quot;platform&quot;: &quot;linux/amd64&quot;
}
</code></pre><p>å¾—åˆ°äº†ç›¸åŒçš„ç»“æœã€‚ä½ å¯èƒ½ä¼šæœ‰äº›å¥‡æ€ªï¼Œä½¿ç”¨ <code>curl -k</code> ç›¸å½“äºå¿½ç•¥äº†è®¤è¯çš„è¿‡ç¨‹ï¼Œä¸ºä½•è¿˜èƒ½æ‹¿åˆ°æ­£ç¡®çš„ä¿¡æ¯ã€‚åˆ«æ€¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<pre tabindex="0"><code>master $ kubectl get ns  -v 8
I1202 03:25:40.607886   16620 loader.go:359] Config loaded from file /root/.kube/config
I1202 03:25:40.608862   16620 loader.go:359] Config loaded from file /root/.kube/config
I1202 03:25:40.611187   16620 loader.go:359] Config loaded from file /root/.kube/config
I1202 03:25:40.622737   16620 loader.go:359] Config loaded from file /root/.kube/config
I1202 03:25:40.623495   16620 round_trippers.go:383] GET https://172.17.0.99:6443/api/v1/namespaces?limit=500
I1202 03:25:40.623650   16620 round_trippers.go:390] Request Headers:
I1202 03:25:40.623730   16620 round_trippers.go:393]     Accept: application/json;as=Table;v=v1beta1;g=meta.k8s.io, application/json
I1202 03:25:40.623820   16620 round_trippers.go:393]     User-Agent: kubectl/v1.11.3 (linux/amd64) kubernetes/a452946
I1202 03:25:40.644280   16620 round_trippers.go:408] Response Status: 200 OK in 20 milliseconds
I1202 03:25:40.644308   16620 round_trippers.go:411] Response Headers:
I1202 03:25:40.644327   16620 round_trippers.go:414]     Content-Type: application/json
I1202 03:25:40.644334   16620 round_trippers.go:414]     Content-Length: 2061
I1202 03:25:40.644338   16620 round_trippers.go:414]     Date: Sun, 02 Dec 2018 03:25:40 GMT
I1202 03:25:40.644398   16620 request.go:897] Response Body: {&quot;kind&quot;:&quot;Table&quot;,&quot;apiVersion&quot;:&quot;meta.k8s.io/v1beta1&quot;,&quot;metadata&quot;:{&quot;selfLink&quot;:&quot;/api/v1/namespaces&quot;,&quot;resourceVersion&quot;:&quot;3970&quot;},&quot;columnDefinitions&quot;:[{&quot;name&quot;:&quot;Name&quot;,&quot;type&quot;:&quot;string&quot;,&quot;format&quot;:&quot;name&quot;,&quot;description&quot;:&quot;Name must be unique within anamespace. Is required when creating resources, although some resources may allow a client to request the generation of an appropriate name automatically. Name is primarily intended for creation idempotence and configuration definition. Cannot be updated. More info: http://kubernetes.io/docs/user-guide/identifiers#names&quot;,&quot;priority&quot;:0},{&quot;name&quot;:&quot;Status&quot;,&quot;type&quot;:&quot;string&quot;,&quot;format&quot;:&quot;&quot;,&quot;description&quot;:&quot;The status of the namespace&quot;,&quot;priority&quot;:0},{&quot;name&quot;:&quot;Age&quot;,&quot;type&quot;:&quot;string&quot;,&quot;format&quot;:&quot;&quot;,&quot;description&quot;:&quot;CreationTimestamp is a timestamp representing the server time when this object was created. It is not guaranteed to be set in happens-before order across separate operations. Clients may not set this value. It is represented in RFC3339 form and is in UTC.\n\nPopulated by the system. Read-only. [truncated 1037 chars]
I1202 03:25:40.645111   16620 get.go:443] no kind is registered for the type v1beta1.Table
NAME          STATUS    AGE
default       Active    45m
kube-public   Active    45m
kube-system   Active    45m
</code></pre><p>ä½¿ç”¨ <code>curl</code> å»è¯·æ±‚ï¼š</p>
<pre tabindex="0"><code>master $ curl -k  https://172.17.0.99:6443/api/v1/namespaces
{
  &quot;kind&quot;: &quot;Status&quot;,
  &quot;apiVersion&quot;: &quot;v1&quot;,
  &quot;metadata&quot;: {

  },
  &quot;status&quot;: &quot;Failure&quot;,
  &quot;message&quot;: &quot;namespaces is forbidden: User \&quot;system:anonymous\&quot; cannot list namespaces at the cluster scope&quot;,
  &quot;reason&quot;: &quot;Forbidden&quot;,
  &quot;details&quot;: {
    &quot;kind&quot;: &quot;namespaces&quot;
  },
  &quot;code&quot;: 403
}
</code></pre><p>çœ‹åˆ°è¿™é‡Œï¼Œåº”è¯¥å°±å¾ˆæ˜æ˜¾äº†ï¼Œå½“å‰å¿½ç•¥æ‰è®¤è¯è¿‡ç¨‹çš„ <code>curl</code> è¢«åˆ¤å®šä¸º <code>system:anonymous</code> ç”¨æˆ·ï¼Œè€Œæ­¤ç”¨æˆ·ä¸å…·å¤‡åˆ—å‡º <code>namespace</code> çš„æƒé™ã€‚</p>
<p>é‚£æˆ‘ä»¬æ˜¯å¦æœ‰å…¶ä»–åŠæ³•ä½¿ç”¨ <code>curl</code> è·å–èµ„æºå‘¢ï¼Ÿ å½“ç„¶æœ‰ï¼Œä½¿ç”¨ <code>kubectl proxy</code> å¯ä»¥åœ¨æœ¬åœ°å’Œé›†ç¾¤ä¹‹é—´åˆ›å»ºä¸€ä¸ªä»£ç†ï¼Œå°±åƒè¿™æ ·ï¼š</p>
<pre tabindex="0"><code>master $ kubectl proxy &amp;
[1] 22205
master $ Starting to serve on 127.0.0.1:8001

master $ curl http://127.0.0.1:8001/api/v1/namespaces
{
  &quot;kind&quot;: &quot;NamespaceList&quot;,
  &quot;apiVersion&quot;: &quot;v1&quot;,
  &quot;metadata&quot;: {
    &quot;selfLink&quot;: &quot;/api/v1/namespaces&quot;,
    &quot;resourceVersion&quot;: &quot;5363&quot;
  },
  &quot;items&quot;: [
    {
      &quot;metadata&quot;: {
        &quot;name&quot;: &quot;default&quot;,
        &quot;selfLink&quot;: &quot;/api/v1/namespaces/default&quot;,
        &quot;uid&quot;: &quot;a5124131-f5db-11e8-9237-0242ac110063&quot;,
        &quot;resourceVersion&quot;: &quot;4&quot;,
        &quot;creationTimestamp&quot;: &quot;2018-12-02T02:40:35Z&quot;
      },
      &quot;spec&quot;: {
        &quot;finalizers&quot;: [
          &quot;kubernetes&quot;
        ]
      },
      &quot;status&quot;: {
        &quot;phase&quot;: &quot;Active&quot;
      }
    },
    {
      &quot;metadata&quot;: {
        &quot;name&quot;: &quot;kube-public&quot;,
        &quot;selfLink&quot;: &quot;/api/v1/namespaces/kube-public&quot;,
        &quot;uid&quot;: &quot;a5153f73-f5db-11e8-9237-0242ac110063&quot;,
        &quot;resourceVersion&quot;: &quot;10&quot;,
        &quot;creationTimestamp&quot;: &quot;2018-12-02T02:40:35Z&quot;
      },
      &quot;spec&quot;: {
        &quot;finalizers&quot;: [
          &quot;kubernetes&quot;
        ]
      },
      &quot;status&quot;: {
        &quot;phase&quot;: &quot;Active&quot;
      }
    },
    {
      &quot;metadata&quot;: {
        &quot;name&quot;: &quot;kube-system&quot;,
        &quot;selfLink&quot;: &quot;/api/v1/namespaces/kube-system&quot;,
        &quot;uid&quot;: &quot;a514ad25-f5db-11e8-9237-0242ac110063&quot;,
        &quot;resourceVersion&quot;: &quot;9&quot;,
        &quot;creationTimestamp&quot;: &quot;2018-12-02T02:40:35Z&quot;
      },
      &quot;spec&quot;: {
        &quot;finalizers&quot;: [
          &quot;kubernetes&quot;
        ]
      },
      &quot;status&quot;: {
        &quot;phase&quot;: &quot;Active&quot;
      }
    }
  ]
}
</code></pre><p>å¯ä»¥çœ‹åˆ°å·²ç»èƒ½æ­£ç¡®çš„è·å–èµ„æºäº†ï¼Œè¿™æ˜¯å› ä¸º <code>kubectl proxy</code> ä½¿ç”¨äº† <code>$HOME/.kube/config</code> ä¸­çš„é…ç½®ã€‚</p>
<p>åœ¨ <code>staging/src/k8s.io/client-go/tools/clientcmd/loader.go</code> ä¸­ï¼Œæœ‰ä¸€ä¸ªåä¸º <code>LoadFromFile</code> çš„å‡½æ•°ç”¨æ¥æä¾›åŠ è½½é…ç½®æ–‡ä»¶çš„åŠŸèƒ½ã€‚</p>
<pre tabindex="0"><code>func LoadFromFile(filename string) (*clientcmdapi.Config, error) {
kubeconfigBytes, err := ioutil.ReadFile(filename)
if err != nil {
return nil, err
}
config, err := Load(kubeconfigBytes)
if err != nil {
return nil, err
}
glog.V(6).Infoln(&quot;Config loaded from file&quot;, filename)

// set LocationOfOrigin on every Cluster, User, and Context
for key, obj := range config.AuthInfos {
obj.LocationOfOrigin = filename
config.AuthInfos[key] = obj
}
for key, obj := range config.Clusters {
obj.LocationOfOrigin = filename
config.Clusters[key] = obj
}
for key, obj := range config.Contexts {
obj.LocationOfOrigin = filename
config.Contexts[key] = obj
}

if config.AuthInfos == nil {
config.AuthInfos = map[string]*clientcmdapi.AuthInfo{}
}
if config.Clusters == nil {
config.Clusters = map[string]*clientcmdapi.Cluster{}
}
if config.Contexts == nil {
config.Contexts = map[string]*clientcmdapi.Context{}
}

return config, nil
}
</code></pre><p>é€»è¾‘å…¶å®å¾ˆç®€å•ï¼Œè¯»å–æŒ‡å®šçš„æ–‡ä»¶ï¼ˆä¸€èˆ¬åœ¨è°ƒç”¨æ­¤å‡½æ•°å‰ï¼Œéƒ½ä¼šå…ˆå»æ£€æŸ¥æ˜¯å¦æœ‰ <code>KUBECONFIG</code> çš„ç¯å¢ƒå˜é‡æˆ– <code>--kubeconfig</code>ï¼Œå¦‚æœæ²¡æœ‰æ‰ä¼šä½¿ç”¨é»˜è®¤çš„ <code>$HOME/.kube/config</code> ä½œä¸ºæ–‡ä»¶åï¼‰ã€‚</p>
<p>ä»ä»¥ä¸Šçš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨å½“å‰é…ç½®çš„ç”¨æˆ·å¯ä»¥è·å–èµ„æºï¼Œè€Œ <code>system:anonymous</code> ä¸å¯ä»¥ã€‚å¯ä»¥å¾—å‡º <code>kube-apiserver</code> åˆä¸€ä¸ªé‡è¦çš„åŠŸèƒ½ï¼šæˆæƒã€‚</p>
<h3 id="æˆæƒauthorization">æˆæƒï¼ˆAuthorizationï¼‰</h3>
<p>åœ¨ç¬¬ 8 èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå·²ç»è®²è¿‡ï¼ŒK8S æ”¯æŒå¤šç§æˆæƒæœºåˆ¶ï¼Œç°åœ¨å¤šæ•°éƒ½åœ¨ä½¿ç”¨ <code>RBAC</code> ï¼Œæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨ <code>kubeadm</code> åˆ›å»ºé›†ç¾¤æ—¶ï¼Œé»˜è®¤ä¼šå¼€å¯ <code>RBAC</code>ã€‚å¦‚ä½•åˆ›å»ºæƒé™å¯æ§çš„ç”¨æˆ·åœ¨ç¬¬ 8 èŠ‚ä¹Ÿå·²ç»è¯´è¿‡ã€‚æ‰€ä»¥æœ¬èŠ‚ä¸­ä¸è¿‡å¤šèµ˜è¿°äº†ï¼Œç›´æ¥çœ‹æˆæƒåçš„å¤„ç†é€»è¾‘ã€‚</p>
<h3 id="å‡†å…¥æ§åˆ¶admission-control">å‡†å…¥æ§åˆ¶ï¼ˆAdmission Controlï¼‰</h3>
<p>åœ¨è¯·æ±‚è¿›æ¥æ—¶ï¼Œä¼šå…ˆç»è¿‡è®¤è¯ã€æˆæƒæ¥ä¸‹æ¥ä¼šè¿›å…¥å‡†å…¥æ§åˆ¶ç¯èŠ‚ã€‚å‡†å…¥æ§åˆ¶å’Œå‰ä¸¤é¡¹å†…å®¹ä¸åŒï¼Œå®ƒä¸åªæ˜¯å…³æ³¨ç”¨æˆ·å’Œè¡Œä¸ºï¼Œå®ƒè¿˜ä¼šå¤„ç†è¯·æ±‚çš„å†…å®¹ã€‚ä¸è¿‡å®ƒå¯¹è¯»æ“ä½œæ— æ•ˆã€‚</p>
<p>å‡†å…¥æ§åˆ¶ä¸æˆ‘ä»¬å‰é¢è¯´æåˆ°çš„è®¤è¯ã€æˆæƒæ’ä»¶ç±»ä¼¼ï¼Œæ”¯æŒåŒæ—¶å¼€å¯å¤šä¸ªã€‚åœ¨ <code>v1.11.3</code> ä¸­ï¼Œé»˜è®¤å¼€å¯çš„å‡†å…¥æ§åˆ¶æ’ä»¶æœ‰ï¼š</p>
<pre tabindex="0"><code>NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeClaimResize,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,Priority
</code></pre><p>ç›¸å…³çš„ä»£ç å¯æŸ¥çœ‹ <code>pkg/kubeapiserver/options/plugins.go</code></p>
<pre tabindex="0"><code>func DefaultOffAdmissionPlugins() sets.String {
defaultOnPlugins := sets.NewString(
lifecycle.PluginName,                //NamespaceLifecycle
limitranger.PluginName,              //LimitRanger
serviceaccount.PluginName,           //ServiceAccount
setdefault.PluginName,               //DefaultStorageClass
resize.PluginName,                   //PersistentVolumeClaimResize
defaulttolerationseconds.PluginName, //DefaultTolerationSeconds
mutatingwebhook.PluginName,          //MutatingAdmissionWebhook
validatingwebhook.PluginName,        //ValidatingAdmissionWebhook
resourcequota.PluginName,            //ResourceQuota
)

if utilfeature.DefaultFeatureGate.Enabled(features.PodPriority) {
defaultOnPlugins.Insert(podpriority.PluginName) //PodPriority
}

return sets.NewString(AllOrderedPlugins...).Difference(defaultOnPlugins)
}
</code></pre><p>åœ¨è¿™é‡Œå†™äº†ä¸€äº›é»˜è®¤å¼€å¯çš„é…ç½®ã€‚äº‹å®ä¸Šï¼Œåœ¨æ—©ä¹‹å‰ï¼Œ<code>PersistentVolumeClaimResize</code> é»˜è®¤æ˜¯ä¸å¼€å¯çš„ï¼Œå¹¶ä¸”å¼€å¯äº† <code>PersistentVolumeLabel</code>ï¼Œå¯¹äºç§»é™¤ <code>Persistentvolumelabel</code> æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒä¸‹ <a href="https://github.com/kubernetes/kubernetes/issues/52617">Remove the PersistentVolumeLabel Admission Controller</a> ã€‚</p>
<p>è¿™é‡Œå¯¹å‡ ä¸ªæ¯”è¾ƒå¸¸è§çš„æ’ä»¶åšä¸‹è¯´æ˜ï¼š</p>
<ul>
<li>
<p>NamespaceLifecycleï¼šå®ƒå¯ä»¥ä¿è¯æ­£åœ¨ç»ˆæ­¢çš„ <code>Namespace</code> ä¸å…è®¸åˆ›å»ºå¯¹è±¡ï¼Œä¸å…è®¸è¯·æ±‚ä¸å­˜åœ¨çš„ <code>Namespace</code> ä»¥åŠä¿è¯é»˜è®¤çš„ <code>default</code>, <code>kube-system</code> ä¹‹ç±»çš„å‘½åç©ºé—´ä¸è¢«åˆ é™¤ã€‚æ ¸å¿ƒçš„ä»£ç æ˜¯ï¼š</p>
<pre tabindex="0"><code>if a.GetOperation() == admission.Delete &amp;&amp; a.GetKind().GroupKind() == v1.SchemeGroupVersion.WithKind(&quot;Namespace&quot;).GroupKind() &amp;&amp; l.immortalNamespaces.Has(a.GetName()) {
return errors.NewForbidden(a.GetResource().GroupResource(), a.GetName(), fmt.Errorf(&quot;this namespace may not be deleted&quot;))
}
</code></pre><p>å¦‚æœåˆ é™¤é»˜è®¤çš„ <code>Namespace</code> åˆ™ä¼šå¾—åˆ°ä¸‹é¢çš„å¼‚å¸¸ï¼š</p>
<pre tabindex="0"><code>master $ kubectl delete ns kube-system
Error from server (Forbidden): namespaces &quot;kube-system&quot; is forbidden: this namespace may not be deleted
master $ kubectl delete ns kube-public
Error from server (Forbidden): namespaces &quot;kube-public&quot; is forbidden: this namespace may not be deleted
master $ kubectl delete ns default
Error from server (Forbidden): namespaces &quot;default&quot; is forbidden: this namespace may not be deleted
</code></pre></li>
<li>
<p>LimitRangerï¼šä¸º <code>Pod</code> è®¾ç½®é»˜è®¤è¯·æ±‚èµ„æºçš„é™åˆ¶ã€‚</p>
</li>
<li>
<p>ServiceAccountï¼šå¯æŒ‰ç…§é¢„è®¾è§„åˆ™åˆ›å»º <code>Serviceaccount</code> ã€‚æ¯”å¦‚éƒ½æœ‰ç»Ÿä¸€çš„å‰ç¼€ï¼š<code>system:serviceaccount:</code>ã€‚</p>
</li>
<li>
<p>DefaultStorageClassï¼šä¸º <code>PVC</code> è®¾ç½®é»˜è®¤ <code>StorageClass</code>ã€‚</p>
</li>
<li>
<p>DefaultTolerationSecondsï¼šè®¾ç½® <code>Pod</code> çš„é»˜è®¤ forgiveness toleration ä¸º 5 åˆ†é’Ÿã€‚è¿™ä¸ªå¯èƒ½å¸¸ä¼šçœ‹åˆ°ã€‚</p>
</li>
<li>
<p>MutatingAdmissionWebhook å’Œ ValidatingAdmissionWebhookï¼šè¿™ä¸¤ä¸ªéƒ½æ˜¯é€šè¿‡ Webhook éªŒè¯æˆ–è€…ä¿®æ”¹è¯·æ±‚ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ä¸€ä¸ªæ˜¯é¡ºåºè¿›è¡Œï¼Œä¸€ä¸ªæ˜¯å¹¶è¡Œè¿›è¡Œçš„ã€‚</p>
</li>
<li>
<p>ResourceQuotaï¼šé™åˆ¶ <code>Pod</code> è¯·æ±‚é…é¢ã€‚</p>
</li>
<li>
<p>AlwaysPullImagesï¼šæ€»æ˜¯æ‹‰å–é•œåƒã€‚</p>
</li>
<li>
<p>AlwaysAdmitï¼šæ€»æ˜¯æ¥å—æ‰€æœ‰è¯·æ±‚ã€‚</p>
</li>
</ul>
<h3 id="å¤„ç†è¯·æ±‚">å¤„ç†è¯·æ±‚</h3>
<p>å‰é¢å·²ç»è¯´åˆ°ï¼Œä¸€ä¸ªè¯·æ±‚ä¾æ¬¡ä¼šç»è¿‡è®¤è¯ï¼Œæˆæƒï¼Œå‡†å…¥æ§åˆ¶ç­‰ç¯èŠ‚ï¼Œå½“è¿™äº›ç¯èŠ‚éƒ½å·²ç»é€šè¿‡åï¼Œè¯¥è¯·æ±‚ä¾¿åˆ°äº† <code>kube-apiserver</code> çš„å®é™…å¤„ç†é€»è¾‘ä¸­äº†ã€‚</p>
<p>å…¶å®å’Œæ™®é€šçš„ Web server ç±»ä¼¼ï¼Œ<code>kube-apiserver</code> æä¾›äº† <code>restful</code> çš„æ¥å£ï¼Œå¢åˆ æ”¹æŸ¥ç­‰åŸºæœ¬åŠŸèƒ½éƒ½åŸºæœ¬ç±»ä¼¼ã€‚è¿™é‡Œå…ˆæš‚æ—¶ä¸å†æ·±å…¥ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>é€šè¿‡æœ¬èŠ‚ï¼Œæˆ‘ä»¬å­¦ä¹ åˆ°äº† <code>kube-apiserver</code> çš„åŸºæœ¬å·¥ä½œé€»è¾‘ï¼Œå„ç±» API è¯·æ±‚å…ˆåé€šè¿‡è®¤è¯ï¼Œæˆæƒï¼Œå‡†å…¥æ§åˆ¶ç­‰ä¸€ç³»åˆ—ç¯èŠ‚åï¼Œè¿›å…¥åˆ° <code>kube-apiserver</code> çš„ <code>Registry</code> è¿›è¡Œç›¸å…³é€»è¾‘å¤„ç†ã€‚</p>
<p>è‡³äºéœ€è¦è¿›è¡ŒæŒä¹…åŒ–æˆ–è€…éœ€è¦ä¸åç«¯å­˜å‚¨äº¤äº’çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬åœ¨ä¸‹èŠ‚ä¼šä»‹ç» <code>etcd</code> åˆ°æ—¶å†çœ‹ K8S æ˜¯å¦‚ä½•å°†åç«¯å­˜å‚¨æŠ½è±¡åŒ–ï¼Œä» <code>etcd</code> v2 å‡çº§è‡³ v3 çš„ã€‚</p>
<p><code>kube-apiserver</code> åŒ…å«çš„ä¸œè¥¿æœ‰å¾ˆå¤šï¼Œå½“ä½ åœ¨ç»ˆç«¯ä¸‹æ‰§è¡Œ <code>./kube-apiserver -h</code> æ—¶ï¼Œä¼šå‘ç°æœ‰å¤§é‡çš„å‚æ•°ã€‚</p>
<p>è¿™äº›å‚æ•°é™¤äº†è®¤è¯ï¼Œæˆæƒï¼Œå‡†å…¥æ§åˆ¶ç›¸å…³åŠŸèƒ½å¤–ï¼Œè¿˜æœ‰å®¡è®¡ï¼Œè¯ä¹¦ï¼Œå­˜å‚¨ç­‰é…ç½®ã€‚ä¸»ä½“åŠŸèƒ½ã€åŸç†äº†è§£åï¼Œè¿™äº›å‚æ•°ä¹Ÿå°±ä¼šæ¯”è¾ƒå®¹æ˜“é…ç½®äº†ã€‚</p>

        </div>
    </article>
</div>
<div class="division-line"></div>
<div class="others">
    <div>æ ‡ç­¾ï¼šğŸ·ï¸<a class="post-tag" href="/tags/kubernetes/">kubernetes</a>&nbsp;</div>
    <div>åˆ†ç±»ï¼š ğŸ“’<a class="post-category" href="/categories/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/">Kubernetesä»ä¸Šæ‰‹åˆ°å®è·µ</a>&nbsp; </div>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/11-%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5%E4%BB%A5-helm-%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/"><span>11 éƒ¨ç½²å®è·µï¼šä»¥ Helm éƒ¨ç½²é¡¹ç›®</span></a>
    </div>
    <div class="next">
        
        <a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/13-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Betcd/"><span>13 åº–ä¸è§£ç‰›ï¼šetcd</span></a>
    </div>
</div>

        </div>
        <div id="float">
            <ul class="float-button-bar">
    <li>
        <button class="float-button top" onclick="scrollToTop(this);">UP</button>
    </li>
    <li>
        <button class="float-button toggler" onclick="changeSkin(this);">DARK</button>
    </li>
</ul>
        </div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 2020 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    const changeSkin = () => {
        document.getElementById('page').classList.toggle('night');
    }
    const scrollToTop = () => {
        window.scrollTo(0, 0);
    }
</script>
</body>

</html>