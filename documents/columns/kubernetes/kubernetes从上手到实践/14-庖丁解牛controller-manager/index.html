<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>14 åº–ä¸è§£ç‰›ï¼šcontroller-manager | Yipsen Ye</title>
<meta name="description" content="æ•´ä½“æ¦‚è§ˆ &#43;----------------------------------------------------------&#43; | Master | | &#43;-------------------------&#43; | | &#43;-------&amp;gt;| API Server |&amp;lt;--------&#43; | | | | | | | | v &#43;-------------------------&#43; v | | &#43;----------------&#43; ^ &#43;--------------------&#43; | | | | | | | | | | Scheduler | | | Controller Manager | | | | | | | | | | &#43;----------------&#43; v &#43;--------------------&#43; | | &#43;------------------------------------------------------&#43; | | | | | | | Cluster state store | | | | | | | &#43;------------------------------------------------------&#43; | &#43;----------------------------------------------------------&#43; åœ¨ç¬¬ 3 èŠ‚ã€Šå®è§‚è®¤è¯†ï¼šæ•´ä½“æ¶æ„ã€‹ ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿè®¤è¯†åˆ°äº† Controller Manager çš„å­˜åœ¨ï¼ŒçŸ¥é“äº† Master æ˜¯ K8S æ˜¯é›†ç¾¤çš„å¤§è„‘ï¼Œè€Œå®ƒåˆ™æ˜¯ Master ä¸­æœ€ç¹å¿™çš„éƒ¨åˆ†ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿæœ¬èŠ‚æˆ‘ä»¬ä¸€åŒæ¥çœ‹çœ‹å®ƒä¸ºä½•å¦‚æ­¤ç¹å¿™ã€‚">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/kubernetes%e4%bb%8e%e4%b8%8a%e6%89%8b%e5%88%b0%e5%ae%9e%e8%b7%b5/">Kubernetesä»ä¸Šæ‰‹åˆ°å®è·µ</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/01-%E5%BC%80%E7%AF%87-kubernetes-%E6%98%AF%E4%BB%80%E4%B9%88%E4%BB%A5%E5%8F%8A%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AE%83/">01 å¼€ç¯‡ï¼š Kubernetes æ˜¯ä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆéœ€è¦å®ƒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/02-%E5%88%9D%E6%AD%A5%E8%AE%A4%E8%AF%86kubernetes-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/">02 åˆæ­¥è®¤è¯†ï¼šKubernetes åŸºç¡€æ¦‚å¿µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/03-%E5%AE%8F%E8%A7%82%E8%AE%A4%E8%AF%86%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/">03 å®è§‚è®¤è¯†ï¼šæ•´ä½“æ¶æ„</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/04-%E6%90%AD%E5%BB%BA-kubernetes-%E9%9B%86%E7%BE%A4-%E6%9C%AC%E5%9C%B0%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA/">04 æ­å»º Kubernetes é›†ç¾¤ - æœ¬åœ°å¿«é€Ÿæ­å»º</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/05-%E5%8A%A8%E6%89%8B%E5%AE%9E%E8%B7%B5%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA-kubernetes-%E9%9B%86%E7%BE%A4-%E7%94%9F%E4%BA%A7%E5%8F%AF%E7%94%A8/">05 åŠ¨æ‰‹å®è·µï¼šæ­å»ºä¸€ä¸ª Kubernetes é›†ç¾¤ - ç”Ÿäº§å¯ç”¨</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/06-%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%9D%E8%AF%86-kubectl/">06 é›†ç¾¤ç®¡ç†ï¼šåˆè¯† kubectl</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/07-%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E4%BB%A5-redis-%E4%B8%BA%E4%BE%8B-%E9%83%A8%E7%BD%B2%E5%8F%8A%E8%AE%BF%E9%97%AE/">07 é›†ç¾¤ç®¡ç†ï¼šä»¥ Redis ä¸ºä¾‹-éƒ¨ç½²åŠè®¿é—®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/08-%E5%AE%89%E5%85%A8%E9%87%8D%E7%82%B9-%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83/">08 å®‰å…¨é‡ç‚¹ è®¤è¯å’Œæˆæƒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/09-%E5%BA%94%E7%94%A8%E5%8F%91%E5%B8%83%E9%83%A8%E7%BD%B2%E5%AE%9E%E9%99%85%E9%A1%B9%E7%9B%AE/">09 åº”ç”¨å‘å¸ƒï¼šéƒ¨ç½²å®é™…é¡¹ç›®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/10-%E5%BA%94%E7%94%A8%E7%AE%A1%E7%90%86%E5%88%9D%E8%AF%86-helm/">10 åº”ç”¨ç®¡ç†ï¼šåˆè¯† Helm</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/11-%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5%E4%BB%A5-helm-%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/">11 éƒ¨ç½²å®è·µï¼šä»¥ Helm éƒ¨ç½²é¡¹ç›®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/12-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-apiserver/">12 åº–ä¸è§£ç‰›ï¼škube-apiserver</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/13-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Betcd/">13 åº–ä¸è§£ç‰›ï¼šetcd</a></li>
                
                
                
                    <li>14 åº–ä¸è§£ç‰›ï¼šcontroller-manager</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/15-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-scheduler/">15 åº–ä¸è§£ç‰›ï¼škube-scheduler</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/16-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkubelet/">16 åº–ä¸è§£ç‰›ï¼škubelet</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/17-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-proxy/">17 åº–ä¸è§£ç‰›ï¼škube-proxy</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/18-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bcontainer-runtime-docker/">18 åº–ä¸è§£ç‰›ï¼šContainer Runtime ï¼ˆDockerï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/19-troubleshoot/">19 Troubleshoot</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/20-%E6%89%A9%E5%B1%95%E5%A2%9E%E5%BC%BAdashboard/">20 æ‰©å±•å¢å¼ºï¼šDashboard</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/21-%E6%89%A9%E5%B1%95%E5%A2%9E%E5%BC%BAcoredns/">21 æ‰©å±•å¢å¼ºï¼šCoreDNS</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/22-%E6%9C%8D%E5%8A%A1%E5%A2%9E%E5%BC%BAingress/">22 æœåŠ¡å¢å¼ºï¼šIngress</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/23-%E7%9B%91%E6%8E%A7%E5%AE%9E%E8%B7%B5%E5%AF%B9-k8s-%E9%9B%86%E7%BE%A4%E8%BF%9B%E8%A1%8C%E7%9B%91%E6%8E%A7/">23 ç›‘æ§å®è·µï¼šå¯¹ K8S é›†ç¾¤è¿›è¡Œç›‘æ§</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/24-%E6%80%BB%E7%BB%93/">24 æ€»ç»“</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">14 åº–ä¸è§£ç‰›ï¼šcontroller-manager</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2021-12-22 01:47:40</span>ğŸ·ï¸&nbsp;<a class="post-tag" href="/tags/kubernetes/">kubernetes</a></div><div class="post-category">
                
                ğŸ“š&nbsp;<a href="/categories/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/">Kubernetesä»ä¸Šæ‰‹åˆ°å®è·µ</a>
                
            </div></div>
        <div class="post-content">
            <h2 id="æ•´ä½“æ¦‚è§ˆ">æ•´ä½“æ¦‚è§ˆ</h2>
<pre tabindex="0"><code>+----------------------------------------------------------+          
| Master                                                   |          
|              +-------------------------+                 |          
|     +-------&gt;|        API Server       |&lt;--------+       |          
|     |        |                         |         |       |          
|     v        +-------------------------+         v       |          
|   +----------------+     ^      +--------------------+   |          
|   |                |     |      |                    |   |          
|   |   Scheduler    |     |      | Controller Manager |   |          
|   |                |     |      |                    |   |          
|   +----------------+     v      +--------------------+   |          
| +------------------------------------------------------+ |          
| |                                                      | |          
| |                Cluster state store                   | |          
| |                                                      | |          
| +------------------------------------------------------+ |          
+----------------------------------------------------------+          
</code></pre><p>åœ¨ç¬¬ 3 èŠ‚ã€Šå®è§‚è®¤è¯†ï¼šæ•´ä½“æ¶æ„ã€‹ ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿè®¤è¯†åˆ°äº† <code>Controller Manager</code> çš„å­˜åœ¨ï¼ŒçŸ¥é“äº† Master æ˜¯ K8S æ˜¯é›†ç¾¤çš„å¤§è„‘ï¼Œè€Œå®ƒåˆ™æ˜¯ Master ä¸­æœ€ç¹å¿™çš„éƒ¨åˆ†ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿæœ¬èŠ‚æˆ‘ä»¬ä¸€åŒæ¥çœ‹çœ‹å®ƒä¸ºä½•å¦‚æ­¤ç¹å¿™ã€‚</p>
<p><strong>æ³¨æ„ï¼šController Manager å®é™…ç”± kube-controller-manager å’Œ cloud-controller-manager ä¸¤éƒ¨åˆ†ç»„æˆï¼Œcloud-controller-manager åˆ™æ˜¯ä¸ºå„å®¶äº‘å‚å•†æä¾›äº†ä¸€ä¸ªæŠ½è±¡çš„å°è£…ï¼Œä¾¿äºè®©å„å‚å•†ä½¿ç”¨å„è‡ªçš„ provideã€‚æœ¬æ–‡åªè®¨è®º kube-controller-managerï¼Œä¸ºäº†é¿å…æ··æ·†ï¼Œä¸‹æ–‡ç»Ÿä¸€ä½¿ç”¨ kube-controller-managerã€‚</strong></p>
<h2 id="kube-controller-manager-æ˜¯ä»€ä¹ˆ"><code>kube-controller-manager</code> æ˜¯ä»€ä¹ˆ</h2>
<p>ä¸€å¥è¯æ¥è®² <code>kube-controller-manager</code> æ˜¯ä¸€ä¸ªåµŒå…¥äº† K8S æ ¸å¿ƒæ§åˆ¶å¾ªç¯çš„å®ˆæŠ¤è¿›ç¨‹ã€‚</p>
<p>è¿™é‡Œçš„é‡ç‚¹æ˜¯</p>
<ul>
<li>åµŒå…¥ï¼šå®ƒå·²ç»å†…ç½®äº†ç›¸å…³é€»è¾‘ï¼Œå¯ç‹¬ç«‹è¿›è¡Œéƒ¨ç½²ã€‚æˆ‘ä»¬åœ¨ç¬¬ 5 èŠ‚ä¸‹è½½ K8S æœåŠ¡ç«¯äºŒè¿›åˆ¶æ–‡ä»¶è§£å‹åï¼Œä¾¿å¯ä»¥çœ‹åˆ° <code>kube-controller-manager</code> çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸è¿‡æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ <code>kubeadm</code> è¿›è¡Œçš„éƒ¨ç½²ï¼Œå®ƒä¼šé»˜è®¤ä½¿ç”¨ <code>k8s.gcr.io/kube-controller-manager</code> çš„é•œåƒã€‚æˆ‘ä»¬ç›´æ¥æ¥çœ‹ä¸‹å®é™…æƒ…å†µï¼š</li>
</ul>
<pre tabindex="0"><code>master $ kubectl -n kube-system describe pods -l component=kube-controller-manager
Name:               kube-controller-manager-master
Namespace:          kube-system
Priority:           2000000000
PriorityClassName:  system-cluster-critical
Node:               master/172.17.0.35
Start Time:         Mon, 10 Dec 2018 07:14:21 +0000
Labels:             component=kube-controller-manager
                    tier=control-plane
Annotations:        kubernetes.io/config.hash=c7ed7a8fa5c430410e84970f8ee7e067
                    kubernetes.io/config.mirror=c7ed7a8fa5c430410e84970f8ee7e067
                    kubernetes.io/config.seen=2018-12-10T07:14:21.685626322Z
                    kubernetes.io/config.source=file
                    scheduler.alpha.kubernetes.io/critical-pod=
Status:             Running
IP:                 172.17.0.35
Containers:
  kube-controller-manager:
    Container ID:  docker://0653e71ae4287608726490b724c3d064d5f1556dd89b7d3c618e97f0e7f2a533
    Image:         k8s.gcr.io/kube-controller-manager-amd64:v1.11.3
    Image ID:      docker-pullable://k8s.gcr.io/kube-controller-manager-amd64@sha256:a6d115bb1c0116036ac6e6e4d504665bc48879c421a450566c38b3b726f0a123
    Port:          &lt;none&gt;
    Host Port:     &lt;none&gt;
    Command:
      kube-controller-manager
      --address=127.0.0.1
      --cluster-signing-cert-file=/etc/kubernetes/pki/ca.crt
      --cluster-signing-key-file=/etc/kubernetes/pki/ca.key
      --controllers=*,bootstrapsigner,tokencleaner
      --kubeconfig=/etc/kubernetes/controller-manager.conf
      --leader-elect=true
      --root-ca-file=/etc/kubernetes/pki/ca.crt
      --service-account-private-key-file=/etc/kubernetes/pki/sa.key
      --use-service-account-credentials=true
    State:          Running
      Started:      Mon, 10 Dec 2018 07:14:24 +0000
    Ready:          True
    Restart Count:  0
    Requests:
      cpu:        200m
    Liveness:     http-get http://127.0.0.1:10252/healthz delay=15s timeout=15s period=10s #success=1 #failure=8
    Environment:  &lt;none&gt;
    Mounts:
      /etc/ca-certificates from etc-ca-certificates (ro)
      /etc/kubernetes/controller-manager.conf from kubeconfig (ro)
      /etc/kubernetes/pki from k8s-certs (ro)
      /etc/ssl/certs from ca-certs (ro)
      /usr/libexec/kubernetes/kubelet-plugins/volume/exec from flexvolume-dir (rw)
      /usr/local/share/ca-certificates from usr-local-share-ca-certificates (ro)
      /usr/share/ca-certificates from usr-share-ca-certificates (ro)
Conditions:
  Type              Status
  Initialized       True
  Ready             True
  ContainersReady   True
  PodScheduled      True
Volumes:
  usr-share-ca-certificates:
    Type:          HostPath (bare host directory volume)
    Path:          /usr/share/ca-certificates
    HostPathType:  DirectoryOrCreate
  usr-local-share-ca-certificates:
    Type:          HostPath (bare host directory volume)
    Path:          /usr/local/share/ca-certificates
    HostPathType:  DirectoryOrCreate
  etc-ca-certificates:
    Type:          HostPath (bare host directory volume)
    Path:          /etc/ca-certificates
    HostPathType:  DirectoryOrCreate
  k8s-certs:
    Type:          HostPath (bare host directory volume)
    Path:          /etc/kubernetes/pki
    HostPathType:  DirectoryOrCreate
  ca-certs:
    Type:          HostPath (bare host directory volume)
    Path:          /etc/ssl/certs
    HostPathType:  DirectoryOrCreate
  kubeconfig:
    Type:          HostPath (bare host directory volume)
    Path:          /etc/kubernetes/controller-manager.conf
    HostPathType:  FileOrCreate
  flexvolume-dir:
    Type:          HostPath (bare host directory volume)
    Path:          /usr/libexec/kubernetes/kubelet-plugins/volume/exec
    HostPathType:  DirectoryOrCreate
QoS Class:         Burstable
Node-Selectors:    &lt;none&gt;
Tolerations:       :NoExecute
Events:            &lt;none&gt;
master
</code></pre><p>è¿™æ˜¯ä½¿ç”¨ <code>kubeadm</code> æ­å»ºçš„é›†ç¾¤ä¸­çš„ <code>kube-controller-manager</code> çš„ <code>Pod</code>ï¼Œé¦–å…ˆå¯ä»¥çœ‹åˆ°å®ƒæ‰€ä½¿ç”¨çš„é•œåƒï¼Œå…¶æ¬¡å¯ä»¥çœ‹åˆ°å®ƒä½¿ç”¨çš„ä¸€ç³»åˆ—å‚æ•°ï¼Œæœ€åå®ƒåœ¨ <code>10252</code> ç«¯å£æä¾›äº†å¥åº·æ£€æŸ¥çš„æ¥å£ã€‚ç¨åæˆ‘ä»¬å†å±•å¼€ã€‚</p>
<ul>
<li>æ§åˆ¶å¾ªç¯ï¼šè¿™é‡Œæ‹†è§£ä¸ºä¸¤éƒ¨åˆ†ï¼š <strong>æ§åˆ¶</strong> å’Œ <strong>å¾ªç¯</strong> ï¼Œå®ƒæ‰€æ§åˆ¶çš„æ˜¯é›†ç¾¤çš„çŠ¶æ€ï¼›è‡³äºå¾ªç¯å®ƒå½“ç„¶æ˜¯ä¼šæœ‰ä¸ªå¾ªç¯é—´éš”çš„ï¼Œè¿™é‡Œæœ‰ä¸ªå‚æ•°å¯ä»¥è¿›è¡Œæ§åˆ¶ã€‚</li>
<li>å®ˆæŠ¤è¿›ç¨‹ï¼šè¿™ä¸ªå°±ä¸å•ç‹¬å±•å¼€äº†ã€‚</li>
</ul>
<h2 id="kube-controller-manager-æœ‰ä»€ä¹ˆä½œç”¨"><code>kube-controller-manager</code> æœ‰ä»€ä¹ˆä½œç”¨</h2>
<p>å‰é¢å·²ç»è¯´äº†å®ƒä¸€ä¸ªå¾ˆå…³é”®çš„ç‚¹ â€œæ§åˆ¶â€ï¼šå®ƒé€šè¿‡ <code>kube-apiserver</code> æä¾›çš„ä¿¡æ¯æŒç»­çš„ç›‘æ§é›†ç¾¤çŠ¶æ€ï¼Œå¹¶å°è¯•å°†é›†ç¾¤è°ƒæ•´è‡³é¢„æœŸçš„çŠ¶æ€ã€‚ç”±äºè®¿é—® <code>kube-apiserver</code> ä¹Ÿéœ€è¦é€šè¿‡è®¤è¯ï¼Œæˆæƒç­‰è¿‡ç¨‹ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°ä¸Šé¢å¯åŠ¨ <code>kube-controller-manager</code> æ—¶æä¾›äº†ä¸€ç³»åˆ—çš„å‚æ•°ã€‚</p>
<p>æ¯”å¦‚ï¼Œå½“æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª <code>Deployment</code>ï¼Œé»˜è®¤å‰¯æœ¬æ•°ä¸º 1 ï¼Œå½“æˆ‘ä»¬æŠŠ <code>Pod</code> åˆ é™¤åï¼Œ<code>kube-controller-manager</code> ä¼šæŒ‰ç…§åŸå…ˆçš„é¢„æœŸï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ª <code>Pod</code> ã€‚ä¸‹é¢ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre tabindex="0"><code>master $ kubectl run redis --image='redis'
deployment.apps/redis created
master $ kubectl get all
NAME                        READY     STATUS    RESTARTS   AGE
pod/redis-bb7894d65-w2rsp   1/1       Running   0          3m

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   18m

NAME                    DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/redis   1         1         1            1           3m

NAME                              DESIRED   CURRENT   READY     AGE
replicaset.apps/redis-bb7894d65   1         1         1         3m
master $ kubectl delete pod/redis-bb7894d65-w2rsp
pod &quot;redis-bb7894d65-w2rsp&quot; deleted
master $ kubectl get all  # å¯ä»¥çœ‹åˆ°å·²ç»é‡æ–°è¿è¡Œäº†ä¸€ä¸ª Pod
NAME                        READY     STATUS    RESTARTS   AGE
pod/redis-bb7894d65-62ftk   1/1       Running   0          16s

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   19m

NAME                    DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/redis   1         1         1            1           4m

NAME                              DESIRED   CURRENT   READY     AGE
replicaset.apps/redis-bb7894d65   1         1         1         4m
</code></pre><p>æˆ‘ä»¬æ¥çœ‹ä¸‹ <code>kube-controller-manager</code> çš„æ—¥å¿—ï¼š</p>
<pre tabindex="0"><code>master $ kubectl -n kube-system logs -l component=kube-controller-manager --tail=5
I1210 09:30:17.125377       1 node_lifecycle_controller.go:945] Controller detected that all Nodes are not-Ready. Entering master disruption mode.
I1210 09:31:07.140539       1 node_lifecycle_controller.go:972] Controller detected that some Nodes are Ready. Exiting master disruption mode.
I1210 09:43:30.377649       1 event.go:221] Event(v1.ObjectReference{Kind:&quot;Deployment&quot;, Namespace:&quot;default&quot;, Name:&quot;redis&quot;, UID:&quot;0d1cb2d7-fc60-11e8-a361-0242ac110074&quot;, APIVersion:&quot;apps/v1&quot;, ResourceVersion:&quot;1494&quot;, FieldPath:&quot;&quot;}): type: 'Normal' reason: 'ScalingReplicaSet' Scaled up replica setredis-bb7894d65 to 1
I1210 09:43:30.835149       1 event.go:221] Event(v1.ObjectReference{Kind:&quot;ReplicaSet&quot;, Namespace:&quot;default&quot;, Name:&quot;redis-bb7894d65&quot;, UID:&quot;0d344d15-fc60-11e8-a361-0242ac110074&quot;, APIVersion:&quot;apps/v1&quot;, ResourceVersion:&quot;1495&quot;, FieldPath:&quot;&quot;}): type: 'Normal' reason: 'SuccessfulCreate' Created pod:redis-bb7894d65-w2rsp
I1210 09:47:41.658781       1 event.go:221] Event(v1.ObjectReference{Kind:&quot;ReplicaSet&quot;, Namespace:&quot;default&quot;, Name:&quot;redis-bb7894d65&quot;, UID:&quot;0d344d15-fc60-11e8-a361-0242ac110074&quot;, APIVersion:&quot;apps/v1&quot;, ResourceVersion:&quot;1558&quot;, FieldPath:&quot;&quot;}): type: 'Normal' reason: 'SuccessfulCreate' Created pod:redis-bb7894d65-62ftk
</code></pre><p>å¯ä»¥çœ‹åˆ°å®ƒå…ˆè§‚å¯Ÿåˆ°æœ‰ <code>Deployment</code> çš„äº‹ä»¶ï¼Œç„¶å <code>ScalingReplicaSet</code> è¿›è€Œåˆ›å»ºäº†å¯¹åº”çš„ <code>Pod</code>ã€‚ è€Œå½“æˆ‘ä»¬åˆ æ‰æ­£åœ¨è¿è¡Œçš„ <code>Pod</code> åï¼Œå®ƒä¾¿ä¼šé‡æ–°åˆ›å»º <code>Pod</code> ä½¿é›†ç¾¤çŠ¶æ€ç¬¦åˆåŸå…ˆçš„é¢„æœŸçŠ¶æ€ã€‚</p>
<p>åŒæ—¶ï¼Œæ³¨æ„ <code>Pod</code> çš„åå­—å·²ç»å‘ç”Ÿäº†å˜åŒ–ã€‚</p>
<h2 id="kube-controller-manager-æ˜¯å¦‚ä½•å·¥ä½œçš„"><code>kube-controller-manager</code> æ˜¯å¦‚ä½•å·¥ä½œçš„</h2>
<p>åœ¨ <code>cmd/kube-controller-manager/app/controllermanager.go</code> ä¸­åˆ—å‡ºäº†å¤§å¤šæ•°çš„ <code>controllermanager</code>ï¼Œä»–ä»¬å¯¹ <code>controllermanager</code> å‡½æ•°çš„å®é™…è°ƒç”¨éƒ½åœ¨ <code>cmd/kube-controller-manager/app/core.go</code> ä¸­ï¼Œæˆ‘ä»¬ä»¥ <code>PodGC</code> ä¸ºä¾‹ï¼š</p>
<pre tabindex="0"><code>func startPodGCController(ctx ControllerContext) (bool, error) {
go podgc.NewPodGC(
ctx.ClientBuilder.ClientOrDie(&quot;pod-garbage-collector&quot;),
ctx.InformerFactory.Core().V1().Pods(),
int(ctx.ComponentConfig.PodGCController.TerminatedPodGCThreshold),
).Run(ctx.Stop)
return true, nil
}
</code></pre><p>åœ¨å‰ä¸¤èŠ‚ä¸­æˆ‘ä»¬å·²ç»å¯¹ <code>kube-apiserver</code> å’Œ <code>etcd</code> æœ‰äº†ä¸€äº›åŸºæœ¬çš„è®¤è¯†ï¼Œè¿™é‡Œå®ƒä¸»è¦ä¼šå» watch ç›¸å…³çš„èµ„æºï¼Œä½†æ˜¯å‡ºäºæ€§èƒ½ä¸Šçš„è€ƒè™‘ï¼Œä¹Ÿä¸èƒ½è¿‡äºé¢‘ç¹çš„å»è¯·æ±‚ <code>kube-apiserver</code> æˆ–è€…æ°¸ä¹… watch ï¼Œæ‰€ä»¥åœ¨å®ç°ä¸Šå€ŸåŠ©äº† <a href="https://github.com/kubernetes/client-go">client-go</a> çš„ <code>informer</code> åŒ…ï¼Œç›¸å½“äºæ˜¯å®ç°äº†ä¸€ä¸ªæœ¬åœ°çš„äºŒçº§ç¼“å­˜ã€‚è¿™é‡Œä¸åšè¿‡å¤šå±•å¼€ã€‚</p>
<p>å®ƒæœ€ç»ˆä¼šè°ƒç”¨ <code>PodGC</code> çš„å…·ä½“å®ç°ï¼Œä½ç½®åœ¨ <code>pkg/controller/podgc/gc_controller.go</code> ä¸­ï¼š</p>
<pre tabindex="0"><code>func NewPodGC(kubeClient clientset.Interface, podInformer coreinformers.PodInformer, terminatedPodThreshold int) *PodGCController {
if kubeClient != nil &amp;&amp; kubeClient.CoreV1().RESTClient().GetRateLimiter() != nil {
metrics.RegisterMetricAndTrackRateLimiterUsage(&quot;gc_controller&quot;, kubeClient.CoreV1().RESTClient().GetRateLimiter())
}
gcc := &amp;PodGCController{
kubeClient:             kubeClient,
terminatedPodThreshold: terminatedPodThreshold,
deletePod: func(namespace, name string) error {
glog.Infof(&quot;PodGC is force deleting Pod: %v:%v&quot;, namespace, name)
return kubeClient.CoreV1().Pods(namespace).Delete(name, metav1.NewDeleteOptions(0))
},
}

gcc.podLister = podInformer.Lister()
gcc.podListerSynced = podInformer.Informer().HasSynced

return gcc
}
</code></pre><p>ä»£ç ä¹Ÿæ¯”è¾ƒç›´è§‚ï¼Œä¸è¿‡è¿™é‡Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªæ³¨å†Œ <code>metrics</code> çš„è¿‡ç¨‹ï¼Œå®é™…ä¸Š <code>kube-controller-manager</code> åœ¨å‰é¢çš„ <code>10252</code> ç«¯å£ä¸Šä¸ä»…æš´éœ²å‡ºæ¥äº†ä¸€ä¸ª <code>/healthz</code> æ¥å£ï¼Œè¿˜æš´éœ²å‡ºäº†ä¸€ä¸ª <code>/metrics</code> çš„æ¥å£ï¼Œå¯ç”¨äºè¿›è¡Œç›‘æ§ä¹‹ç±»çš„ã€‚</p>
<pre tabindex="0"><code>master $ kubectl -n kube-system get pod -l component=kube-controller-manager
NAME                             READY     STATUS    RESTARTS   AGE
kube-controller-manager-master   1/1       Running   1          2m
master $ kubectl -n kube-system exec -it kube-controller-manager-master sh
/ # wget -qO- http://127.0.0.1:10252/metrics|grep gc_controller
# HELP gc_controller_rate_limiter_use A metric measuring the saturation of the rate limiter for gc_controller
# TYPE gc_controller_rate_limiter_use gauge
gc_controller_rate_limiter_use 0
</code></pre><h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† <code>kube-controller-manager</code> ä»¥åŠå®ƒåœ¨ K8S ä¸­ä¸»è¦æ˜¯å°†é›†ç¾¤è°ƒèŠ‚è‡³é¢„æœŸçš„çŠ¶æ€ï¼Œå¹¶æä¾›å‡ºäº† <code>/metrics</code> çš„æ¥å£å¯ä¾›ç›‘æ§ã€‚</p>
<p><code>kube-controller-manager</code> ä¸­æœ‰å¾ˆå¤šçš„ controller å¤§å¤šæ•°æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå½“ç„¶ä¹Ÿæœ‰é»˜è®¤å…³é—­çš„ï¼Œæ¯”å¦‚ <code>bootstrapsigner</code> å’Œ <code>tokencleaner</code>ï¼Œåœ¨æˆ‘ä»¬å¯åŠ¨ <code>kube-controller-manager</code> çš„æ—¶å€™ï¼Œå¯é€šè¿‡ <code>--controllers</code> çš„å‚æ•°è¿›è¡Œæ§åˆ¶ï¼Œå°±æ¯”å¦‚ä¸Šé¢ä¾‹å­ä¸­ <code>--controllers=*,bootstrapsigner,tokencleaner</code> è¡¨ç¤ºå¼€å¯æ‰€æœ‰é»˜è®¤å¼€å¯çš„ä»¥åŠ <code>bootstrapsigner</code> å’Œ <code>tokencleaner</code> ã€‚</p>
<p>ä¸‹èŠ‚ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦ä¸€ä¸ªä¸èµ„æºè°ƒåº¦æœ‰å…³çš„ç»„ä»¶ <code>kube-scheduler</code>ï¼Œäº†è§£ä¸‹å®ƒå¯¹æˆ‘ä»¬ä½¿ç”¨é›†ç¾¤æ‰€å¸¦æ¥çš„æ„ä¹‰ã€‚</p>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/13-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Betcd/"><span>13 åº–ä¸è§£ç‰›ï¼šetcd</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/15-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-scheduler/"><span>15 åº–ä¸è§£ç‰›ï¼škube-scheduler</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 28280 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>