<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>16 åº–ä¸è§£ç‰›ï¼škubelet | Yipsen Ye</title>
<meta name="description" content="æ•´ä½“æ¦‚è§ˆ &#43;--------------------------------------------------------&#43; | &#43;---------------------&#43; &#43;---------------------&#43; | | | kubelet | | kube-proxy | | | | | | | | | &#43;---------------------&#43; &#43;---------------------&#43; | | &#43;----------------------------------------------------&#43; | | | Container Runtime (Docker) | | | | &#43;---------------------&#43; &#43;---------------------&#43; | | | | |Pod | |Pod | | | | | | &#43;-----&#43; &#43;-----&#43; | |&#43;-----&#43;&#43;-----&#43;&#43;-----&#43;| | | | | | |C1 | |C2 | | ||C1 ||C2 ||C3 || | | | | | | | | | | || || || || | | | | | &#43;-----&#43; &#43;-----&#43; | |&#43;-----&#43;&#43;-----&#43;&#43;-----&#43;| | | | | &#43;---------------------&#43; &#43;---------------------&#43; | | | &#43;----------------------------------------------------&#43; | &#43;--------------------------------------------------------&#43; åœ¨ç¬¬ 3 èŠ‚ã€Šå®è§‚è®¤è¯†ï¼šæ•´ä½“æ¶æ„ã€‹ ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“äº† K8S ä¸­ Node ç”±ä¸€äº›å¿…è¦çš„ç»„ä»¶æ„æˆï¼Œè€Œå…¶ä¸­æœ€ä¸ºæ ¸å¿ƒçš„å½“å± kubelet äº†ï¼Œå¦‚æœæ²¡æœ‰ kubelet çš„å­˜åœ¨ï¼Œé‚£æˆ‘ä»¬é¢„æœŸçš„å„ç±»èµ„æºå°±åªèƒ½å­˜åœ¨äº Master çš„ç›¸å…³ç»„ä»¶ä¸­äº†ï¼Œè€Œ K8S ä¹Ÿå¾ˆèƒ½åªæ˜¯ä¸€ä¸ª CRUD çš„æ™®é€šç¨‹åºäº†ã€‚æœ¬èŠ‚ï¼Œæˆ‘ä»¬æ¥ä»‹ç»ä¸‹ kubelet åŠå®ƒæ˜¯å¦‚ä½•å®Œæˆè¿™ä¸€ç³»åˆ—ä»»åŠ¡çš„ã€‚">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="nav-logo">
    <a href="http://yipsen.github.io/">
        
        <span class="nav-title">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æ–‡ç« </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/kubernetes%e4%bb%8e%e4%b8%8a%e6%89%8b%e5%88%b0%e5%ae%9e%e8%b7%b5/">Kubernetesä»ä¸Šæ‰‹åˆ°å®è·µ</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/01-%E5%BC%80%E7%AF%87-kubernetes-%E6%98%AF%E4%BB%80%E4%B9%88%E4%BB%A5%E5%8F%8A%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AE%83/">01 å¼€ç¯‡ï¼š Kubernetes æ˜¯ä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆéœ€è¦å®ƒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/02-%E5%88%9D%E6%AD%A5%E8%AE%A4%E8%AF%86kubernetes-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/">02 åˆæ­¥è®¤è¯†ï¼šKubernetes åŸºç¡€æ¦‚å¿µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/03-%E5%AE%8F%E8%A7%82%E8%AE%A4%E8%AF%86%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/">03 å®è§‚è®¤è¯†ï¼šæ•´ä½“æ¶æ„</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/04-%E6%90%AD%E5%BB%BA-kubernetes-%E9%9B%86%E7%BE%A4-%E6%9C%AC%E5%9C%B0%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA/">04 æ­å»º Kubernetes é›†ç¾¤ - æœ¬åœ°å¿«é€Ÿæ­å»º</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/05-%E5%8A%A8%E6%89%8B%E5%AE%9E%E8%B7%B5%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA-kubernetes-%E9%9B%86%E7%BE%A4-%E7%94%9F%E4%BA%A7%E5%8F%AF%E7%94%A8/">05 åŠ¨æ‰‹å®è·µï¼šæ­å»ºä¸€ä¸ª Kubernetes é›†ç¾¤ - ç”Ÿäº§å¯ç”¨</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/06-%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%9D%E8%AF%86-kubectl/">06 é›†ç¾¤ç®¡ç†ï¼šåˆè¯† kubectl</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/07-%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E4%BB%A5-redis-%E4%B8%BA%E4%BE%8B-%E9%83%A8%E7%BD%B2%E5%8F%8A%E8%AE%BF%E9%97%AE/">07 é›†ç¾¤ç®¡ç†ï¼šä»¥ Redis ä¸ºä¾‹-éƒ¨ç½²åŠè®¿é—®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/08-%E5%AE%89%E5%85%A8%E9%87%8D%E7%82%B9-%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83/">08 å®‰å…¨é‡ç‚¹ è®¤è¯å’Œæˆæƒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/09-%E5%BA%94%E7%94%A8%E5%8F%91%E5%B8%83%E9%83%A8%E7%BD%B2%E5%AE%9E%E9%99%85%E9%A1%B9%E7%9B%AE/">09 åº”ç”¨å‘å¸ƒï¼šéƒ¨ç½²å®é™…é¡¹ç›®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/10-%E5%BA%94%E7%94%A8%E7%AE%A1%E7%90%86%E5%88%9D%E8%AF%86-helm/">10 åº”ç”¨ç®¡ç†ï¼šåˆè¯† Helm</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/11-%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5%E4%BB%A5-helm-%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/">11 éƒ¨ç½²å®è·µï¼šä»¥ Helm éƒ¨ç½²é¡¹ç›®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/12-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-apiserver/">12 åº–ä¸è§£ç‰›ï¼škube-apiserver</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/13-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Betcd/">13 åº–ä¸è§£ç‰›ï¼šetcd</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/14-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bcontroller-manager/">14 åº–ä¸è§£ç‰›ï¼šcontroller-manager</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/15-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-scheduler/">15 åº–ä¸è§£ç‰›ï¼škube-scheduler</a></li>
                
                
                
                    <li>16 åº–ä¸è§£ç‰›ï¼škubelet</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/17-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-proxy/">17 åº–ä¸è§£ç‰›ï¼škube-proxy</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/18-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bcontainer-runtime-docker/">18 åº–ä¸è§£ç‰›ï¼šContainer Runtime ï¼ˆDockerï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/19-troubleshoot/">19 Troubleshoot</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/20-%E6%89%A9%E5%B1%95%E5%A2%9E%E5%BC%BAdashboard/">20 æ‰©å±•å¢å¼ºï¼šDashboard</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/21-%E6%89%A9%E5%B1%95%E5%A2%9E%E5%BC%BAcoredns/">21 æ‰©å±•å¢å¼ºï¼šCoreDNS</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/22-%E6%9C%8D%E5%8A%A1%E5%A2%9E%E5%BC%BAingress/">22 æœåŠ¡å¢å¼ºï¼šIngress</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/23-%E7%9B%91%E6%8E%A7%E5%AE%9E%E8%B7%B5%E5%AF%B9-k8s-%E9%9B%86%E7%BE%A4%E8%BF%9B%E8%A1%8C%E7%9B%91%E6%8E%A7/">23 ç›‘æ§å®è·µï¼šå¯¹ K8S é›†ç¾¤è¿›è¡Œç›‘æ§</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/24-%E6%80%BB%E7%BB%93/">24 æ€»ç»“</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">16 åº–ä¸è§£ç‰›ï¼škubelet</h1>
        <div class="post-info">
            <div class="post-date"> 
                <span>2021-12-22 01:47:42</span>
            </div>
        </div>
        <div class="post-content">
            <h2 id="æ•´ä½“æ¦‚è§ˆ">æ•´ä½“æ¦‚è§ˆ</h2>
<pre tabindex="0"><code>+--------------------------------------------------------+       
| +---------------------+        +---------------------+ |       
| |      kubelet        |        |     kube-proxy      | |       
| |                     |        |                     | |       
| +---------------------+        +---------------------+ |       
| +----------------------------------------------------+ |       
| | Container Runtime (Docker)                         | |       
| | +---------------------+    +---------------------+ | |       
| | |Pod                  |    |Pod                  | | |       
| | | +-----+ +-----+     |    |+-----++-----++-----+| | |       
| | | |C1   | |C2   |     |    ||C1   ||C2   ||C3   || | |       
| | | |     | |     |     |    ||     ||     ||     || | |       
| | | +-----+ +-----+     |    |+-----++-----++-----+| | |       
| | +---------------------+    +---------------------+ | |       
| +----------------------------------------------------+ |       
+--------------------------------------------------------+  
</code></pre><p>åœ¨ç¬¬ 3 èŠ‚ã€Šå®è§‚è®¤è¯†ï¼šæ•´ä½“æ¶æ„ã€‹ ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“äº† K8S ä¸­ Node ç”±ä¸€äº›å¿…è¦çš„ç»„ä»¶æ„æˆï¼Œè€Œå…¶ä¸­æœ€ä¸ºæ ¸å¿ƒçš„å½“å± <code>kubelet</code> äº†ï¼Œå¦‚æœæ²¡æœ‰ <code>kubelet</code> çš„å­˜åœ¨ï¼Œé‚£æˆ‘ä»¬é¢„æœŸçš„å„ç±»èµ„æºå°±åªèƒ½å­˜åœ¨äº <code>Master</code> çš„ç›¸å…³ç»„ä»¶ä¸­äº†ï¼Œè€Œ K8S ä¹Ÿå¾ˆèƒ½åªæ˜¯ä¸€ä¸ª CRUD çš„æ™®é€šç¨‹åºäº†ã€‚æœ¬èŠ‚ï¼Œæˆ‘ä»¬æ¥ä»‹ç»ä¸‹ <code>kubelet</code> åŠå®ƒæ˜¯å¦‚ä½•å®Œæˆè¿™ä¸€ç³»åˆ—ä»»åŠ¡çš„ã€‚</p>
<h2 id="kubelet-æ˜¯ä»€ä¹ˆ"><code>kubelet</code> æ˜¯ä»€ä¹ˆ</h2>
<p>æŒ‰ç…§ä¸€èˆ¬æ¶æ„è®¾è®¡ä¸Šçš„ä¹ æƒ¯ï¼Œ<code>kubelet</code> æ‰€æ‰¿æ‹…çš„è§’è‰²ä¸€èˆ¬ä¼šè¢«å«åš <code>agent</code>ï¼Œè¿™é‡Œå«åš <code>kubelet</code> å¾ˆå¤§ç¨‹åº¦ä¸Šå— <code>Borg</code> çš„å‘½åå½±å“ï¼Œ<code>Borg</code> é‡Œé¢ä¹Ÿæœ‰ä¸€ä¸ª <code>Borglet</code> çš„ç»„ä»¶å­˜åœ¨ã€‚<code>kubelet</code> ä¾¿æ˜¯ K8S ä¸­çš„ <code>agent</code>ï¼Œè´Ÿè´£ <code>Node</code> å’Œ <code>Pod</code> ç›¸å…³çš„ç®¡ç†ä»»åŠ¡ã€‚</p>
<p>åŒæ ·çš„ï¼Œåœ¨æˆ‘ä»¬ä¸‹è½½ K8S äºŒè¿›åˆ¶æ–‡ä»¶è§£å‹åï¼Œä¾¿å¯ä»¥å¾—åˆ° <code>kubelet</code> çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚åœ¨ç¬¬ 5 èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå®Œæˆäº† <code>kubelet</code> ä»¥ <code>systemd</code> è¿›è¡Œå¯åŠ¨å’Œç®¡ç†çš„ç›¸å…³é…ç½®ã€‚</p>
<h2 id="kubelet-æœ‰ä»€ä¹ˆä½œç”¨"><code>kubelet</code> æœ‰ä»€ä¹ˆä½œç”¨</h2>
<p>é€šå¸¸æ¥è®² <code>agent</code> è¿™æ ·çš„è§’è‰²èµ·åˆ°çš„ä½œç”¨é¦–å…ˆä¾¿æ˜¯è¦èƒ½å¤Ÿæ³¨å†Œï¼Œè®© <code>server</code> ç«¯çŸ¥é“å®ƒçš„å­˜åœ¨ï¼Œæ‰€ä»¥è¿™ä¾¿æ˜¯å®ƒçš„ç¬¬ä¸€ä¸ªä½œç”¨ï¼šèŠ‚ç‚¹ç®¡ç†ã€‚</p>
<h3 id="èŠ‚ç‚¹ç®¡ç†">èŠ‚ç‚¹ç®¡ç†</h3>
<p>å½“æˆ‘ä»¬æ‰§è¡Œ <code>kubelet --help</code> çš„æ—¶å€™ï¼Œä¼šçœ‹åˆ°å®ƒæ‰€æ”¯æŒçš„å¯é…ç½®å‚æ•°ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª <code>--register-node</code> å‚æ•°ä¾¿æ˜¯ç”¨äºæ§åˆ¶æ˜¯å¦å‘ <code>kube-apiserver</code> æ³¨å†ŒèŠ‚ç‚¹çš„ï¼Œé»˜è®¤æ˜¯å¼€å¯çš„ã€‚</p>
<p>æˆ‘ä»¬åœ¨ç¬¬ 5 èŠ‚ä¸­è¿˜ä»‹ç»äº†å¦‚ä½•æ–°å¢ä¸€ä¸ª <code>Node</code>ï¼Œå½“ <code>kubeadm join</code> æ‰§è¡ŒæˆåŠŸåï¼Œä½ ä¾¿å¯ä»¥é€šè¿‡ <code>kubectl get node</code> æŸ¥çœ‹åˆ°æ–°åŠ å…¥é›†ç¾¤ä¸­çš„ <code>Node</code>ï¼Œä¸æ­¤åŒæ—¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨è¯¥èŠ‚ç‚¹ä¸Šé€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ <code>kubelet</code> çš„çŠ¶æ€ã€‚</p>
<pre tabindex="0"><code>master $ systemctl status kubelet
â— kubelet.service - kubelet: The Kubernetes Agent
   Loaded: loaded (/etc/systemd/system/kubelet.service; enabled; vendor preset: disabled)
  Drop-In: /etc/systemd/system/kubelet.service.d
           â””â”€kubeadm.conf
   Active: active (running) since Thu 2018-12-13 07:49:51 UTC; 32min ago
     Docs: http://kubernetes.io/docs/
 Main PID: 3876259 (kubelet)
   Memory: 66.3M
   CGroup: /system.slice/kubelet.service
           â””â”€3876259 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernete...
</code></pre><p>å½“æˆ‘ä»¬æŸ¥çœ‹ <code>Node</code> ä¿¡æ¯æ—¶ï¼Œä¹Ÿèƒ½å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p>
<pre tabindex="0"><code>master $ kubectl get nodes node01 -o yaml
apiVersion: v1
kind: Node
metadata:
  annotations:
    kubeadm.alpha.kubernetes.io/cri-socket: /var/run/dockershim.sock
    node.alpha.kubernetes.io/ttl: &quot;0&quot;
    volumes.kubernetes.io/controller-managed-attach-detach: &quot;true&quot;
  creationTimestamp: 2018-12-13T07:50:47Z
  labels:
    beta.kubernetes.io/arch: amd64
    beta.kubernetes.io/os: linux
    kubernetes.io/hostname: node01
  name: node01
  resourceVersion: &quot;4242&quot;
  selfLink: /api/v1/nodes/node01
  uid: cd612df6-feab-11e8-9a0b-0242ac110096
spec: {}
status:
  addresses:
  - address: 172.17.0.152
    type: InternalIP
  - address: node01
    type: Hostname
  allocatable:
    cpu: &quot;4&quot;
    ephemeral-storage: &quot;89032026784&quot;
    hugepages-1Gi: &quot;0&quot;
    hugepages-2Mi: &quot;0&quot;
    memory: 3894788Ki
    pods: &quot;110&quot;
  capacity:
    cpu: &quot;4&quot;
    ephemeral-storage: 96605932Ki
    hugepages-1Gi: &quot;0&quot;
    hugepages-2Mi: &quot;0&quot;
    memory: 3997188Ki
    pods: &quot;110&quot;
  conditions:
  - lastHeartbeatTime: 2018-12-13T08:39:41Z
    lastTransitionTime: 2018-12-13T07:50:47Z
    message: kubelet has sufficient disk space available
    reason: KubeletHasSufficientDisk
    status: &quot;False&quot;
    type: OutOfDisk
  - lastHeartbeatTime: 2018-12-13T08:39:41Z
    lastTransitionTime: 2018-12-13T07:50:47Z
    message: kubelet has sufficient memory available
    reason: KubeletHasSufficientMemory
    status: &quot;False&quot;
    type: MemoryPressure
  - lastHeartbeatTime: 2018-12-13T08:39:41Z
    lastTransitionTime: 2018-12-13T07:50:47Z
    message: kubelet has no disk pressure
    reason: KubeletHasNoDiskPressure
    status: &quot;False&quot;
    type: DiskPressure
  - lastHeartbeatTime: 2018-12-13T08:39:41Z
    lastTransitionTime: 2018-12-13T07:50:47Z
    message: kubelet has sufficient PID available
    reason: KubeletHasSufficientPID
    status: &quot;False&quot;
    type: PIDPressure
  - lastHeartbeatTime: 2018-12-13T08:39:41Z
    lastTransitionTime: 2018-12-13T07:51:37Z
    message: kubelet is posting ready status. AppArmor enabled
    reason: KubeletReady
    status: &quot;True&quot;
    type: Ready
  daemonEndpoints:
    kubeletEndpoint:
      Port: 10250
  images:
  - names:
    - k8s.gcr.io/kube-apiserver-amd64@sha256:956bea8c139620c9fc823fb81ff9b5647582b53bd33904302987d56ab24fc187
    - k8s.gcr.io/kube-apiserver-amd64:v1.11.3
    sizeBytes: 186676561
  nodeInfo:
    architecture: amd64
    bootID: 89ced22c-f7f8-4c4d-ad0d-d10887ab900e
    containerRuntimeVersion: docker://18.6.0
    kernelVersion: 4.4.0-62-generic
    kubeProxyVersion: v1.11.3
    kubeletVersion: v1.11.3
    machineID: 26ba042302eea8095d6576975c120eeb
    operatingSystem: linux
    osImage: Ubuntu 16.04.2 LTS
    systemUUID: 26ba042302eea8095d6576975c120eeb
</code></pre><p>å¯ä»¥çœ‹åˆ° <code>kubelet</code> ä¸ä»…å°†è‡ªå·±æ³¨å†Œç»™äº† <code>kube-apiserver</code>ï¼ŒåŒæ—¶å®ƒæ‰€åœ¨æœºå™¨çš„ä¿¡æ¯ä¹Ÿéƒ½è¿›è¡Œäº†ä¸ŠæŠ¥ï¼ŒåŒ…æ‹¬ CPUï¼Œå†…å­˜ï¼ŒIP ä¿¡æ¯ç­‰ã€‚</p>
<p>è¿™å…¶ä¸­æœ‰æˆ‘ä»¬åœ¨ç¬¬ 2 èŠ‚ä¸­æåˆ°çš„å…³äº <code>Node</code> çŠ¶æ€ç›¸å…³çš„ä¸€äº›ä¿¡æ¯ï¼Œå¯ä»¥å¯¹ç…§ç€çœ‹çœ‹ã€‚</p>
<p>å½“ç„¶è¿™é‡Œé™¤äº†è¿™äº›ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰äº›å€¼å¾—æ³¨æ„çš„ï¼Œæ¯”å¦‚ <code>daemonEndpoints</code> ä¹‹ç±»çš„ï¼Œå¯ä»¥çœ‹åˆ°ç›®å‰ <code>kubelet</code> ç›‘å¬åœ¨äº† <code>10250</code> ç«¯å£ï¼Œè¿™ä¸ªç«¯å£å¯é€šè¿‡ <code>--port</code> é…ç½®ï¼Œä½†æ˜¯ä¹‹åä¼šè¢«åºŸå¼ƒæ‰ï¼Œæˆ‘ä»¬æ˜¯å†™å…¥äº† <code>/var/lib/kubelet/config.yaml</code> çš„é…ç½®æ–‡ä»¶ä¸­ã€‚</p>
<pre tabindex="0"><code>master $ cat /var/lib/kubelet/config.yaml
address: 0.0.0.0
apiVersion: kubelet.config.k8s.io/v1beta1
authentication:
  anonymous:
    enabled: false
  webhook:
    cacheTTL: 2m0s
    enabled: true
  x509:
    clientCAFile: /etc/kubernetes/pki/ca.crt
authorization:
  mode: Webhook
  webhook:
    cacheAuthorizedTTL: 5m0s
    cacheUnauthorizedTTL: 30s
cgroupDriver: cgroupfs
cgroupsPerQOS: true
clusterDNS:
- 10.96.0.10
clusterDomain: cluster.local
containerLogMaxFiles: 5
containerLogMaxSize: 10Mi
contentType: application/vnd.kubernetes.protobuf
cpuCFSQuota: true
cpuManagerPolicy: none
cpuManagerReconcilePeriod: 10s
enableControllerAttachDetach: true
enableDebuggingHandlers: true
enforceNodeAllocatable:
- pods
eventBurst: 10
eventRecordQPS: 5
evictionHard:
  imagefs.available: 15%
  memory.available: 100Mi
  nodefs.available: 10%
  nodefs.inodesFree: 5%
evictionPressureTransitionPeriod: 5m0s
failSwapOn: true
fileCheckFrequency: 20s
hairpinMode: promiscuous-bridge
healthzBindAddress: 127.0.0.1
healthzPort: 10248
httpCheckFrequency: 20s
imageGCHighThresholdPercent: 85
imageGCLowThresholdPercent: 80
imageMinimumGCAge: 2m0s
iptablesDropBit: 15
iptablesMasqueradeBit: 14
kind: KubeletConfiguration
kubeAPIBurst: 10
kubeAPIQPS: 5
makeIPTablesUtilChains: true
maxOpenFiles: 1000000
maxPods: 110
nodeStatusUpdateFrequency: 10s
oomScoreAdj: -999
podPidsLimit: -1
port: 10250
registryBurst: 10
registryPullQPS: 5
resolvConf: /etc/resolv.conf
rotateCertificates: true
runtimeRequestTimeout: 2m0s
serializeImagePulls: true
staticPodPath: /etc/kubernetes/manifests
streamingConnectionIdleTimeout: 4h0m0s
syncFrequency: 1m0s
volumeStatsAggPeriod: 1m0s
master $
</code></pre><p>è¿™å…¶ä¸­æœ‰ä¸€äº›éœ€è¦å…³æ³¨çš„é…ç½®ï¼š</p>
<ul>
<li>
<p><code>maxPods</code>ï¼šæœ€å¤§çš„ <code>Pod</code> æ•°</p>
</li>
<li>
<p><code>healthzBindAddress</code> å’Œ <code>healthzPort</code>ï¼šé…ç½®äº†å¥åº·æ£€æŸ¥æ‰€ç›‘å¬çš„åœ°å€å’Œç«¯å£</p>
<p>æˆ‘ä»¬å¯ç”¨ä»¥ä¸‹æ–¹å¼è¿›è¡ŒéªŒè¯ï¼š</p>
<pre tabindex="0"><code>master $ curl 127.0.0.1:10248/healthz
ok 
</code></pre></li>
<li>
<p><code>authentication</code> å’Œ <code>authorization</code> ï¼šè®¤è¯æˆæƒç›¸å…³</p>
</li>
<li>
<p><code>evictionHard</code>ï¼šæ¶‰åŠåˆ° <code>kubelet</code> çš„é©±é€ç­–ç•¥ï¼Œå¯¹ <code>Pod</code> è°ƒåº¦åˆ†é…ä¹‹ç±»çš„å½±å“å¾ˆå¤§</p>
</li>
</ul>
<p>å…¶ä½™éƒ¨åˆ†ï¼Œå¯å‚è€ƒ<a href="https://kubernetes.io/docs/tasks/administer-cluster/out-of-resource/">æ‰‹å†Œå†…å®¹</a></p>
<h3 id="pod-ç®¡ç†">Pod ç®¡ç†</h3>
<p>ä»ä¸Šé¢çš„é…ç½®ä»¥åŠæˆ‘ä»¬ä¹‹å‰çš„ä»‹ç»ä¸­ï¼Œ<code>kube-scheduler</code> å¤„ç†äº† <code>Pod</code> åº”è¯¥è°ƒåº¦è‡³å“ªä¸ª <code>Node</code>ï¼Œè€Œ <code>kubelet</code> åˆ™æ˜¯ä¿éšœè¯¥ <code>Pod</code> èƒ½æŒ‰ç…§é¢„æœŸï¼Œåœ¨å¯¹åº” <code>Node</code> ä¸Šå¯åŠ¨å¹¶ä¿æŒå·¥ä½œã€‚</p>
<p>åŒæ—¶ï¼Œ<code>kubelet</code> åœ¨ä¿éšœ <code>Pod</code> èƒ½æŒ‰é¢„æœŸå·¥ä½œï¼Œä¸»è¦æ˜¯åšäº†ä¸¤æ–¹é¢çš„äº‹æƒ…ï¼š</p>
<ul>
<li>å¥åº·æ£€æŸ¥ï¼šé€šè¿‡ <code>LivenessProbe</code> å’Œ <code>ReadinessProbe</code> æ¢é’ˆè¿›è¡Œæ£€æŸ¥ï¼Œåˆ¤æ–­æ˜¯å¦å¥åº·åŠæ˜¯å¦å·²ç»å‡†å¤‡å¥½æ¥å—è¯·æ±‚ã€‚</li>
<li>èµ„æºç›‘æ§ï¼šé€šè¿‡ <code>cAdvisor</code> è¿›è¡Œèµ„æºç›‘ã€‚</li>
</ul>
<h2 id="kubelet-æ˜¯å¦‚ä½•å·¥ä½œçš„"><code>kubelet</code> æ˜¯å¦‚ä½•å·¥ä½œçš„</h2>
<p>å¤§è‡´çš„åŠŸèƒ½å·²ç»ä»‹ç»äº†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒå¤§ä½“çš„å®ç°ã€‚</p>
<p>é¦–å…ˆæ˜¯åœ¨ <code>cmd/kubelet/app/server.go</code> æ–‡ä»¶ä¸­çš„ <code>Run</code> æ–¹æ³•ï¼š</p>
<pre tabindex="0"><code>func Run(s *options.KubeletServer, kubeDeps *kubelet.Dependencies, stopCh &lt;-chan struct{}) error {
glog.Infof(&quot;Version: %+v&quot;, version.Get())
if err := initForOS(s.KubeletFlags.WindowsService); err != nil {
return fmt.Errorf(&quot;failed OS init: %v&quot;, err)
}
if err := run(s, kubeDeps, stopCh); err != nil {
return fmt.Errorf(&quot;failed to run Kubelet: %v&quot;, err)
}
return nil
}
</code></pre><p>è¿™ä¸ªæ–¹æ³•çœ‹èµ·æ¥å¾ˆç®€å•é‚£ï¼Œå®ƒæ˜¯åœ¨è¯»å–å®Œä¸€ç³»åˆ—çš„é…ç½®å’Œæ ¡éªŒä¹‹åå¼€å§‹è¢«è°ƒç”¨çš„ï¼Œåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œä¼šåœ¨æ—¥å¿—ä¸­è¾“å‡ºå½“å‰çš„ç‰ˆæœ¬å·ï¼Œå¦‚æœä½ çš„ <code>kubelet</code> å·²ç»æ­£å¸¸è¿è¡Œï¼Œå½“ä½ æ‰§è¡Œ <code>journalctl -u kubelet</code> çš„æ—¶å€™ï¼Œä¾¿ä¼šçœ‹åˆ°ä¸€æ¡ç›¸å…³çš„æ—¥å¿—è¾“å‡ºã€‚</p>
<p>ä¹‹åï¼Œä¾¿æ˜¯ä¸€ä¸ª <code>run</code> æ–¹æ³•ï¼Œå…¶ä¸­åŒ…å«ç€å„ç§ç¯å¢ƒæ£€æŸ¥ï¼Œå®¹å™¨ç®¡ç†ï¼Œ<code>cAdvisor</code> åˆå§‹åŒ–ä¹‹ç±»çš„æ“ä½œï¼Œç›´åˆ° <code>kubelet</code> åŸºæœ¬æ­£ç¡®è¿è¡Œåï¼Œåˆ™ä¼šè°ƒç”¨ <code>pkg/kubelet/kubelet.go</code> ä¸­çš„ä¸€ä¸ª <code>BirthCry</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä»å‘½åå°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œå®ƒå…¶å®å°±æ˜¯å®£å‘Š <code>kubelet</code> å·²ç»å¯åŠ¨ï¼š</p>
<pre tabindex="0"><code>func (kl *Kubelet) BirthCry() {
kl.recorder.Eventf(kl.nodeRef, v1.EventTypeNormal, events.StartingKubelet, &quot;Starting kubelet.&quot;)
}
</code></pre><p>åç»­åˆ™æ˜¯å…³äºæ³¨å†Œï¼Œ<code>Pod</code> ç®¡ç†ä»¥åŠèµ„æºç›¸å…³çš„å¤„ç†é€»è¾‘ï¼Œå†…å®¹è¾ƒå¤šï¼Œè¿™é‡Œå°±ä¸å†å±•å¼€äº†ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æœ¬èŠ‚ä¸­æˆ‘ä»¬ä»‹ç»äº† <code>kubelet</code> çš„ä¸»è¦åŠŸèƒ½å’ŒåŸºæœ¬å®ç°ï¼Œäº†è§£åˆ°äº†å®ƒä¸ä»…å¯å°†è‡ªèº«æ³¨å†Œåˆ°é›†ç¾¤ï¼ŒåŒæ—¶è¿˜æ‰¿æ‹…ç€ä¿éšœ <code>Pod</code> å¯åœ¨è¯¥ <code>Node</code> ä¸ŠæŒ‰é¢„æœŸå·¥ä½œã€‚å¦å¤– <code>kubelet</code> å…¶å®è¿˜æ‰¿æ‹…ç€æ¸…ç† <code>Node</code> ä¸Šä¸€äº›ç”± K8S è°ƒåº¦ <code>Pod</code> æ‰€é€ æˆçš„ç£ç›˜å ç”¨ä¹‹ç±»çš„å·¥ä½œã€‚</p>
<p>ä»ä¸Šé¢çš„é…ç½®ä¸­åŸºæœ¬èƒ½çœ‹å‡ºæ¥ä¸€äº›ï¼Œè¿™éƒ¨åˆ†çš„åŠŸèƒ½å¤§å¤šæ•°æƒ…å†µä¸‹ä¸éœ€è¦å¤§å®¶äººä¸ºå¹²é¢„ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸å†å±•å¼€äº†ã€‚</p>
<p>å½“ <code>Pod</code> åœ¨ <code>Node</code> ä¸Šæ­£å¸¸è¿è¡Œä¹‹åï¼Œè‹¥æ˜¯éœ€è¦å¯¹å¤–æä¾›æœåŠ¡ï¼Œåˆ™éœ€è¦å°†å…¶æš´éœ²å‡ºæ¥ã€‚ä¸‹èŠ‚ï¼Œæˆ‘ä»¬æ¥ä»‹ç»ä¸‹ <code>kube-proxy</code> æ˜¯å¦‚ä½•æ¥å¤„ç†è¿™äº›å·¥ä½œçš„ã€‚</p>

        </div>
    </article>
</div>
<div class="division-line"></div>
<div class="others">
    <div>æ ‡ç­¾ï¼šğŸ·ï¸<a class="post-tag" href="/tags/kubernetes/">kubernetes</a>&nbsp;</div>
    <div>åˆ†ç±»ï¼š ğŸ“’<a class="post-category" href="/categories/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/">Kubernetesä»ä¸Šæ‰‹åˆ°å®è·µ</a>&nbsp; </div>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/15-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-scheduler/"><span>15 åº–ä¸è§£ç‰›ï¼škube-scheduler</span></a>
    </div>
    <div class="next">
        
        <a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/17-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-proxy/"><span>17 åº–ä¸è§£ç‰›ï¼škube-proxy</span></a>
    </div>
</div>

        </div>
        <div id="float">
            <ul class="float-button-bar">
    <li>
        <button class="float-button top" onclick="scrollToTop(this);">UP</button>
    </li>
    <li>
        <button class="float-button toggler" onclick="changeSkin(this);">DARK</button>
    </li>
</ul>
        </div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 2020 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    const changeSkin = () => {
        document.getElementById('page').classList.toggle('night');
    }
    const scrollToTop = () => {
        window.scrollTo(0, 0);
    }
</script>
</body>

</html>