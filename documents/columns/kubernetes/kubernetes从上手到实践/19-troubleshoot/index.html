<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>19 Troubleshoot | Yipsen Ye</title>
<meta name="description" content="æ•´ä½“æ¦‚è§ˆ é€šè¿‡å‰é¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬å·²ç»äº†è§£åˆ°äº† K8S çš„åŸºç¡€çŸ¥è¯†ï¼Œæ ¸å¿ƒç»„ä»¶åŸç†ä»¥åŠå¦‚ä½•åœ¨ K8S ä¸­éƒ¨ç½²æœåŠ¡åŠç®¡ç†æœåŠ¡ç­‰ã€‚
ä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬æ‰€é¢ä¸´çš„ç¯å¢ƒå¤šç§å¤šæ ·ï¼Œå¯èƒ½ä¼šé‡åˆ°å„ç§é—®é¢˜ã€‚æœ¬èŠ‚å°†ç»“åˆæˆ‘ä»¬å·²ç»äº†è§£åˆ°çš„çŸ¥è¯†ï¼Œä»‹ç»ä¸€äº›å¸¸è§é—®é¢˜å®šä½å’Œè§£å†³çš„æ€è·¯æˆ–æ–¹æ³•ï¼Œä»¥ä¾¿å¤§å®¶åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨ K8S èƒ½å¦‚é±¼å¾—æ°´ã€‚
åº”ç”¨éƒ¨ç½²é—®é¢˜ é¦–å…ˆæˆ‘ä»¬ä»åº”ç”¨éƒ¨ç½²ç›¸å…³çš„é—®é¢˜æ¥å…¥æ‰‹ã€‚è¿™é‡Œä»ç„¶ä½¿ç”¨æˆ‘ä»¬çš„ç¤ºä¾‹é¡¹ç›® SayThxã€‚
clone è¯¥é¡¹ç›®ï¼Œè¿›å…¥åˆ° deploy ç›®å½•ä¸­ï¼Œå…ˆ kubectl apply -f namespace.yaml æˆ–è€… kubectl create ns work æ¥åˆ›å»ºä¸€ä¸ªç”¨äºå®éªŒçš„ Namespace ã€‚
ä½¿ç”¨ describe æ’æŸ¥é—®é¢˜ å¯¹ redis-deployment.yaml ç¨ä½œä¿®æ”¹ï¼ŒæŒ‰ä»¥ä¸‹æ–¹å¼æ“ä½œï¼š
master $ kubectl apply -f redis-deployment.yamldeployment.apps/saythx-redis createdmaster $ kubectl -n work get allNAME READY STATUS RESTARTS AGEpod/saythx-redis-7574c98f5d-v66fx 0/1 ImagePullBackOff 0 9sNAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGEdeployment.apps/saythx-redis 1 1 1 0 9sNAME DESIRED CURRENT READY AGEreplicaset.">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/kubernetes%e4%bb%8e%e4%b8%8a%e6%89%8b%e5%88%b0%e5%ae%9e%e8%b7%b5/">Kubernetesä»ä¸Šæ‰‹åˆ°å®è·µ</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/01-%E5%BC%80%E7%AF%87-kubernetes-%E6%98%AF%E4%BB%80%E4%B9%88%E4%BB%A5%E5%8F%8A%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AE%83/">01 å¼€ç¯‡ï¼š Kubernetes æ˜¯ä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆéœ€è¦å®ƒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/02-%E5%88%9D%E6%AD%A5%E8%AE%A4%E8%AF%86kubernetes-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/">02 åˆæ­¥è®¤è¯†ï¼šKubernetes åŸºç¡€æ¦‚å¿µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/03-%E5%AE%8F%E8%A7%82%E8%AE%A4%E8%AF%86%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/">03 å®è§‚è®¤è¯†ï¼šæ•´ä½“æ¶æ„</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/04-%E6%90%AD%E5%BB%BA-kubernetes-%E9%9B%86%E7%BE%A4-%E6%9C%AC%E5%9C%B0%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA/">04 æ­å»º Kubernetes é›†ç¾¤ - æœ¬åœ°å¿«é€Ÿæ­å»º</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/05-%E5%8A%A8%E6%89%8B%E5%AE%9E%E8%B7%B5%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA-kubernetes-%E9%9B%86%E7%BE%A4-%E7%94%9F%E4%BA%A7%E5%8F%AF%E7%94%A8/">05 åŠ¨æ‰‹å®è·µï¼šæ­å»ºä¸€ä¸ª Kubernetes é›†ç¾¤ - ç”Ÿäº§å¯ç”¨</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/06-%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%9D%E8%AF%86-kubectl/">06 é›†ç¾¤ç®¡ç†ï¼šåˆè¯† kubectl</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/07-%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E4%BB%A5-redis-%E4%B8%BA%E4%BE%8B-%E9%83%A8%E7%BD%B2%E5%8F%8A%E8%AE%BF%E9%97%AE/">07 é›†ç¾¤ç®¡ç†ï¼šä»¥ Redis ä¸ºä¾‹-éƒ¨ç½²åŠè®¿é—®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/08-%E5%AE%89%E5%85%A8%E9%87%8D%E7%82%B9-%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83/">08 å®‰å…¨é‡ç‚¹ è®¤è¯å’Œæˆæƒ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/09-%E5%BA%94%E7%94%A8%E5%8F%91%E5%B8%83%E9%83%A8%E7%BD%B2%E5%AE%9E%E9%99%85%E9%A1%B9%E7%9B%AE/">09 åº”ç”¨å‘å¸ƒï¼šéƒ¨ç½²å®é™…é¡¹ç›®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/10-%E5%BA%94%E7%94%A8%E7%AE%A1%E7%90%86%E5%88%9D%E8%AF%86-helm/">10 åº”ç”¨ç®¡ç†ï¼šåˆè¯† Helm</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/11-%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5%E4%BB%A5-helm-%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/">11 éƒ¨ç½²å®è·µï¼šä»¥ Helm éƒ¨ç½²é¡¹ç›®</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/12-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-apiserver/">12 åº–ä¸è§£ç‰›ï¼škube-apiserver</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/13-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Betcd/">13 åº–ä¸è§£ç‰›ï¼šetcd</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/14-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bcontroller-manager/">14 åº–ä¸è§£ç‰›ï¼šcontroller-manager</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/15-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-scheduler/">15 åº–ä¸è§£ç‰›ï¼škube-scheduler</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/16-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkubelet/">16 åº–ä¸è§£ç‰›ï¼škubelet</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/17-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bkube-proxy/">17 åº–ä¸è§£ç‰›ï¼škube-proxy</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/18-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bcontainer-runtime-docker/">18 åº–ä¸è§£ç‰›ï¼šContainer Runtime ï¼ˆDockerï¼‰</a></li>
                
                
                
                    <li>19 Troubleshoot</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/20-%E6%89%A9%E5%B1%95%E5%A2%9E%E5%BC%BAdashboard/">20 æ‰©å±•å¢å¼ºï¼šDashboard</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/21-%E6%89%A9%E5%B1%95%E5%A2%9E%E5%BC%BAcoredns/">21 æ‰©å±•å¢å¼ºï¼šCoreDNS</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/22-%E6%9C%8D%E5%8A%A1%E5%A2%9E%E5%BC%BAingress/">22 æœåŠ¡å¢å¼ºï¼šIngress</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/23-%E7%9B%91%E6%8E%A7%E5%AE%9E%E8%B7%B5%E5%AF%B9-k8s-%E9%9B%86%E7%BE%A4%E8%BF%9B%E8%A1%8C%E7%9B%91%E6%8E%A7/">23 ç›‘æ§å®è·µï¼šå¯¹ K8S é›†ç¾¤è¿›è¡Œç›‘æ§</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/24-%E6%80%BB%E7%BB%93/">24 æ€»ç»“</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">19 Troubleshoot</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2021-12-22 01:47:45</span>ğŸ·ï¸&nbsp;<a class="post-tag" href="/tags/kubernetes/">kubernetes</a></div><div class="post-category">
                
                ğŸ“š&nbsp;<a href="/categories/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/">Kubernetesä»ä¸Šæ‰‹åˆ°å®è·µ</a>
                
            </div></div>
        <div class="post-content">
            <h2 id="æ•´ä½“æ¦‚è§ˆ">æ•´ä½“æ¦‚è§ˆ</h2>
<p>é€šè¿‡å‰é¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬å·²ç»äº†è§£åˆ°äº† K8S çš„åŸºç¡€çŸ¥è¯†ï¼Œæ ¸å¿ƒç»„ä»¶åŸç†ä»¥åŠå¦‚ä½•åœ¨ K8S ä¸­éƒ¨ç½²æœåŠ¡åŠç®¡ç†æœåŠ¡ç­‰ã€‚</p>
<p>ä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬æ‰€é¢ä¸´çš„ç¯å¢ƒå¤šç§å¤šæ ·ï¼Œå¯èƒ½ä¼šé‡åˆ°å„ç§é—®é¢˜ã€‚æœ¬èŠ‚å°†ç»“åˆæˆ‘ä»¬å·²ç»äº†è§£åˆ°çš„çŸ¥è¯†ï¼Œä»‹ç»ä¸€äº›å¸¸è§é—®é¢˜å®šä½å’Œè§£å†³çš„æ€è·¯æˆ–æ–¹æ³•ï¼Œä»¥ä¾¿å¤§å®¶åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨ K8S èƒ½å¦‚é±¼å¾—æ°´ã€‚</p>
<h2 id="åº”ç”¨éƒ¨ç½²é—®é¢˜">åº”ç”¨éƒ¨ç½²é—®é¢˜</h2>
<p>é¦–å…ˆæˆ‘ä»¬ä»åº”ç”¨éƒ¨ç½²ç›¸å…³çš„é—®é¢˜æ¥å…¥æ‰‹ã€‚è¿™é‡Œä»ç„¶ä½¿ç”¨æˆ‘ä»¬çš„<a href="https://github.com/tao12345666333/saythx">ç¤ºä¾‹é¡¹ç›® SayThx</a>ã€‚</p>
<p>clone è¯¥é¡¹ç›®ï¼Œè¿›å…¥åˆ° deploy ç›®å½•ä¸­ï¼Œå…ˆ <code>kubectl apply -f namespace.yaml</code> æˆ–è€… <code>kubectl create ns work</code> æ¥åˆ›å»ºä¸€ä¸ªç”¨äºå®éªŒçš„ <code>Namespace</code> ã€‚</p>
<h3 id="ä½¿ç”¨-describe-æ’æŸ¥é—®é¢˜">ä½¿ç”¨ <code>describe</code> æ’æŸ¥é—®é¢˜</h3>
<p>å¯¹ <code>redis-deployment.yaml</code> ç¨ä½œä¿®æ”¹ï¼ŒæŒ‰ä»¥ä¸‹æ–¹å¼æ“ä½œï¼š</p>
<pre tabindex="0"><code>master $ kubectl apply -f redis-deployment.yaml
deployment.apps/saythx-redis created
master $ kubectl -n work get all
NAME                                READY     STATUS             RESTARTS   AGE
pod/saythx-redis-7574c98f5d-v66fx   0/1       ImagePullBackOff   0          9s

NAME                           DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/saythx-redis   1         1         1            0           9s

NAME                                      DESIRED   CURRENT   READY     AGE
replicaset.apps/saythx-redis-7574c98f5d   1         1         0         9s
</code></pre><p>å¯ä»¥çœ‹åˆ° <code>Pod</code> æ­¤åˆ»çš„çŠ¶æ€æ˜¯ <code>ImagePullBackOff</code>ï¼Œè¿™ä¸ªçŠ¶æ€è¡¨ç¤ºé•œåƒæ‹‰å–å¤±è´¥ï¼Œ<code>kubelet</code> é€€å‡ºé•œåƒæ‹‰å–ã€‚</p>
<p>æˆ‘ä»¬åœ¨å‰é¢çš„å†…å®¹ä¸­ä»‹ç»è¿‡ <code>kubelet</code> çš„ä½œç”¨ä¹‹ä¸€å°±æ˜¯è´Ÿè´£é•œåƒæ‹‰å–ï¼Œè€Œå®é™…ä¸Šï¼Œåœ¨é•œåƒæ–¹é¢çš„é”™è¯¯ä¸»è¦é¢„è®¾äº† 6 ç§ï¼Œåˆ†åˆ«æ˜¯ <code>ImagePullBackOff</code>ï¼Œ<code>ImageInspectError</code>ï¼Œ<code>ErrImagePull</code>ï¼Œ<code>ErrImageNeverPull</code>ï¼Œ<code>RegistryUnavailable</code>ï¼Œ<code>InvalidImageName</code>ã€‚</p>
<p>å½“é‡åˆ°ä»¥ä¸Šæ‰€è¿°æƒ…å†µæ—¶ï¼Œä¾¿å¯å®šä½ä¸ºé•œåƒç›¸å…³å¼‚å¸¸ã€‚</p>
<p>æˆ‘ä»¬å›åˆ°ä¸Šé¢çš„é—®é¢˜å½“ä¸­ï¼Œå®šä½é—®é¢˜æ‰€åœ¨ã€‚</p>
<pre tabindex="0"><code>master $ kubectl -n work describe pod/saythx-redis-7574c98f5d-v66fx
Name:               saythx-redis-7574c98f5d-v66fx
Namespace:          work
Priority:           0
PriorityClassName:  &lt;none&gt;
Node:               node01/172.17.0.132
Start Time:         Tue, 18 Dec 2018 17:27:56 +0000
Labels:             app=redis
                    pod-template-hash=3130754918
Annotations:        &lt;none&gt;
Status:             Pending
IP:                 10.40.0.1
Controlled By:      ReplicaSet/saythx-redis-7574c98f5d
Containers:
  redis:
    Container ID:
    Image:          redis:5xx
    Image ID:
    Port:           6379/TCP
    Host Port:      0/TCP
    State:          Waiting
      Reason:       ImagePullBackOff
    Ready:          False
    Restart Count:  0
    Environment:    &lt;none&gt;
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-787w5 (ro)
Conditions:
  Type              Status
  Initialized       True
  Ready             False
  ContainersReady   False
  PodScheduled      True
Volumes:
  default-token-787w5:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  default-token-787w5
    Optional:    false
QoS Class:       BestEffort
Node-Selectors:  &lt;none&gt;
Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s
                 node.kubernetes.io/unreachable:NoExecute for 300s
Events:
  Type     Reason          Age                 From               Message
  ----     ------          ----                ----               -------
  Normal   Scheduled       11m                 default-scheduler  Successfully assigned work/saythx-redis-7574c98f5d-v66fx to node01
  Normal   SandboxChanged  10m                 kubelet, node01    Pod sandbox changed, it will bekilled and re-created.
  Normal   BackOff         9m (x6 over 10m)    kubelet, node01    Back-off pulling image &quot;redis:5xx&quot;
  Normal   Pulling         9m (x4 over 10m)    kubelet, node01    pulling image &quot;redis:5xx&quot;
  Warning  Failed          9m (x4 over 10m)    kubelet, node01    Failed to pull image &quot;redis:5xx&quot;: rpc error: code = Unknown desc = Error response from daemon: manifest for redis:5xx not found
  Warning  Failed          9m (x4 over 10m)    kubelet, node01    Error: ErrImagePull
  Warning  Failed          49s (x44 over 10m)  kubelet, node01    Error: ImagePullBackOff
</code></pre><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç°åœ¨ pull çš„é•œåƒæ˜¯ <code>redis:5xx</code> è€Œå®é™…ä¸Šå¹¶ä¸å­˜åœ¨æ­¤ tag çš„é•œåƒï¼Œæ‰€ä»¥å¯¼è‡´æ‹‰å–å¤±è´¥ã€‚</p>
<h3 id="ä½¿ç”¨-events-æ’æŸ¥é—®é¢˜">ä½¿ç”¨ <code>events</code> æ’æŸ¥é—®é¢˜</h3>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜æœ‰å¦ä¸€ç§æ–¹å¼åŒæ ·å¯è¿›è¡Œé—®é¢˜æ’æŸ¥ï¼š</p>
<pre tabindex="0"><code>master $ kubectl -n work get events
LAST SEEN   FIRST SEEN   COUNT     NAME                                             KIND         SUBOBJECT                TYPE      REASON              SOURCE                  MESSAGE
21m         21m          1         saythx-redis.15717d6361a741a8                    Deployment                        Normal    ScalingReplicaSet   deployment-controller   Scaled up replica set saythx-redis-7574c98f5d to 1
21m         21m          1         saythx-redis-7574c98f5d-qwxgm.15717d6363eb60ff   Pod                        Normal    Scheduled           default-scheduler       Successfully assigned work/saythx-redis-7574c98f5d-qwxgm to node01
21m         21m          1         saythx-redis-7574c98f5d.15717d636309afa8         ReplicaSet                        Normal    SuccessfulCreate    replicaset-controller   Created pod: saythx-redis-7574c98f5d-qwxgm
20m         21m          2         saythx-redis-7574c98f5d-qwxgm.15717d63fa501b3f   Pod          spec.containers{redis}   Normal    BackOff             kubelet, node01         Back-off pulling image &quot;redis:5xx&quot;
20m         21m          2         saythx-redis-7574c98f5d-qwxgm.15717d63fa5049a9   Pod          spec.containers{redis}   Warning   Failed              kubelet, node01         Error: ImagePullBackOff
20m         21m          3         saythx-redis-7574c98f5d-qwxgm.15717d6393a1993c   Pod          spec.containers{redis}   Normal    Pulling             kubelet, node01         pulling image &quot;redis:5xx&quot;
20m         21m          3         saythx-redis-7574c98f5d-qwxgm.15717d63e11efc7a   Pod          spec.containers{redis}   Warning   Failed              kubelet, node01         Error: ErrImagePull
20m         21m          3         saythx-redis-7574c98f5d-qwxgm.15717d63e11e9c25   Pod          spec.containers{redis}   Warning   Failed              kubelet, node01         Failed to pull image &quot;redis:5xx&quot;: rpc error: code = Unknown desc = Error response from daemon: manifest for redis:5xxnot found
20m         20m          1         saythx-redis-54984ff94-2bb6g.15717d6dc03799cd    Pod          spec.containers{redis}   Normal    Killing             kubelet, node01         Killing container with id docker://redis:Need to kill Pod
19m         19m          1         saythx-redis-7574c98f5d-v66fx.15717d72356528ec   Pod                        Normal    Scheduled           default-scheduler       Successfully assigned work/saythx-redis-7574c98f5d-v66fx to node01
19m         19m          1         saythx-redis-7574c98f5d.15717d722f7f1732         ReplicaSet                        Normal    SuccessfulCreate    replicaset-controller   Created pod: saythx-redis-7574c98f5d-v66fx
19m         19m          1         saythx-redis.15717d722b49e758                    Deployment                        Normal    ScalingReplicaSet   deployment-controller   Scaled up replica set saythx-redis-7574c98f5d to 1
19m         19m          1         saythx-redis-7574c98f5d-v66fx.15717d731a09b0ad   Pod                        Normal    SandboxChanged      kubelet, node01         Pod sandbox changed, it will be killed and re-created.
18m         19m          6         saythx-redis-7574c98f5d-v66fx.15717d733ab20b3d   Pod          spec.containers{redis}   Normal    BackOff             kubelet, node01         Back-off pulling image &quot;redis:5xx&quot;
18m         19m          4         saythx-redis-7574c98f5d-v66fx.15717d729de13541   Pod          spec.containers{redis}   Normal    Pulling             kubelet, node01         pulling image &quot;redis:5xx&quot;
18m         19m          4         saythx-redis-7574c98f5d-v66fx.15717d72e6ded95d   Pod          spec.containers{redis}   Warning   Failed              kubelet, node01         Error: ErrImagePull
18m         19m          4         saythx-redis-7574c98f5d-v66fx.15717d72e6de7b1c   Pod          spec.containers{redis}   Warning   Failed              kubelet, node01         Failed to pull image &quot;redis:5xx&quot;: rpc error: code = Unknown desc = Error response from daemon: manifest for redis:5xxnot found
4m          19m          66        saythx-redis-7574c98f5d-v66fx.15717d733ab23f2c   Pod          spec.containers{redis}   Warning   Failed              kubelet, node01         Error: ImagePullBackOff
master
</code></pre><p>æˆ‘ä»¬åœ¨ä¹‹å‰ä»‹ç»æ—¶ï¼Œä¹Ÿæåˆ°è¿‡ <code>kubelet</code> æˆ–è€… <code>kube-scheduler</code> ç­‰ç»„ä»¶ä¼šæ¥å—æŸäº›äº‹ä»¶ç­‰ï¼Œ<code>event</code> ä¾¿æ˜¯ç”¨äºè®°å½•é›†ç¾¤å†…å„å¤„å‘ç”Ÿçš„äº‹ä»¶ä¹‹ç±»çš„ã€‚</p>
<h3 id="ä¿®æ­£é”™è¯¯">ä¿®æ­£é”™è¯¯</h3>
<ul>
<li>
<p>ä¿®æ­£é…ç½®æ–‡ä»¶</p>
<p>ä¿®æ­£é…ç½®æ–‡ä»¶ï¼Œç„¶å <code>kubectl apply -f redis-deployment.yaml</code> ä¾¿å¯åº”ç”¨ä¿®æ­£åçš„é…ç½®æ–‡ä»¶ã€‚è¿™ç§æ–¹æ³•æ¯”è¾ƒæ¨èï¼Œå¹¶ä¸”å¯ä»¥å°†ä¿®æ”¹è¿‡çš„ä½ç½®çº³å…¥åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ï¼Œæœ‰åˆ©äºåç»­ç»´æŠ¤ã€‚</p>
</li>
<li>
<p>åœ¨çº¿ä¿®æ”¹é…ç½®</p>
<p>ä½¿ç”¨ <code>kubectl -n work edit deploy/saythx-redis</code>ï¼Œä¼šæ‰“å¼€é»˜è®¤çš„ç¼–è¾‘å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä½¿ç”¨çš„é•œåƒåŠ tag ä¿®æ­£ä¸º <code>redis:5</code> ä¿å­˜é€€å‡ºï¼Œä¾¿ä¼šè‡ªåŠ¨åº”ç”¨æ–°çš„é…ç½®ã€‚è¿™ç§åšæ³•æ¯”è¾ƒé€‚åˆæ¯”è¾ƒç´§æ€¥æˆ–è€…èµ„æºæ˜¯ç›´æ¥é€šè¿‡å‘½ä»¤è¡Œåˆ›å»ºç­‰æƒ…å†µã€‚ <strong>éç‰¹æ®Šæƒ…å†µå°½é‡ä¸è¦åœ¨çº¿ä¿®æ”¹ã€‚</strong> ä¸”è¿™æ ·ä¿®æ”¹å¹¶ä¸åˆ©äºåæœŸç»´æŠ¤ã€‚</p>
</li>
</ul>
<h3 id="é€šè¿‡è¯¦ç»†å†…å®¹æ’æŸ¥é”™è¯¯">é€šè¿‡è¯¦ç»†å†…å®¹æ’æŸ¥é”™è¯¯</h3>
<pre tabindex="0"><code>master $ kubectl apply -f namespace.yaml
namespace/work created
master $ kubectl apply -f redis-deployment.yaml
deployment.apps/saythx-redis created
master $ vi redis-service.yaml # ç¨å¾®åšäº†ç‚¹ä¿®æ”¹
master $ kubectl apply -f redis-service.yaml
service/saythx-redis created
master $ kubectl -n work get pods,svc
NAME                               READY     STATUS    RESTARTS   AGE
pod/saythx-redis-8558c7d7d-z8prg   1/1       Running   0          47s

NAME                   TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
service/saythx-redis   NodePort   10.108.202.170   &lt;none&gt;        6379:32355/TCP   16s
</code></pre><p>é€šè¿‡ä»¥ä¸Šçš„è¾“å‡ºï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬çš„ <code>Service</code> åº”è¯¥æ˜¯å¯ä»¥å¯ä»¥æ­£å¸¸è®¿é—®äº†ï¼Œç°åœ¨æˆ‘ä»¬è¿›è¡Œä¸‹æµ‹è¯•ï¼š</p>
<pre tabindex="0"><code>master $ docker run --rm -it --net host redis redis-cli -p 32355
Unable to find image 'redis:latest' locally
latest: Pulling from library/redis
a5a6f2f73cd8: Pull complete
a6d0f7688756: Pull complete
53e16f6135a5: Pull complete
f52b0cc4e76a: Pull complete
e841feee049e: Pull complete
ccf45e5191d0: Pull complete
Digest: sha256:bf65ecee69c43e52d0e065d094fbdfe4df6e408d47a96e56c7a29caaf31d3c35
Status: Downloaded newer image for redis:latest
Could not connect to Redis at 127.0.0.1:32355: Connection refused
not connected&gt;
</code></pre><p>æˆ‘ä»¬å…ˆæ¥ä»‹ç»è¿™é‡Œçš„æµ‹è¯•æ–¹æ³•ã€‚ ä½¿ç”¨ Docker çš„ Redis å®˜æ–¹é•œåƒï¼Œ <code>--net host</code> æ˜¯ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œï¼› <code>--rm</code> è¡¨ç¤ºåœæ­¢å®Œåå³æ¸…é™¤ï¼› <code>-it</code> åˆ†åˆ«è¡¨ç¤ºè·å–è¾“å…¥åŠè·å– TTYã€‚</p>
<p>é€šè¿‡ä»¥ä¸Šæµ‹è¯•å‘ç°ä¸èƒ½æ­£å¸¸è¿æ¥ï¼Œæ•…è€Œè¯´æ˜ <code>Service</code> è¿˜æ˜¯æœªé…ç½®å¥½ã€‚ä½¿ç”¨å‰é¢æåˆ°çš„æ–¹æ³•ä¹Ÿå¯ä»¥è¿›è¡Œæ’æŸ¥ï¼Œä¸è¿‡è¿™é‡Œæä¾›å¦ä¸€ç§æ’æŸ¥è¿™ç±»é—®é¢˜çš„æ€è·¯ã€‚</p>
<pre tabindex="0"><code>master $ kubectl -n work get endpoints
NAME           ENDPOINTS        AGE
saythx-redis   10.32.0.4:6380   9m
</code></pre><p>é€šè¿‡ä¹‹å‰çš„ç« èŠ‚ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ <code>Service</code> å·¥ä½œçš„æ—¶å€™æ˜¯æŒ‰ <code>Endpoints</code> æ¥çš„ï¼Œè¿™é‡Œæˆ‘ä»¬å‘ç°æ­¤å¤„çš„ <code>Endpoints</code> æ˜¯ <code>6380</code> ä¸æˆ‘ä»¬é¢„æœŸçš„ <code>6379</code> å¹¶ä¸ç›¸åŒã€‚æ‰€ä»¥é—®é¢˜å®šä½äºç«¯å£é…ç½®æœ‰è¯¯ã€‚</p>
<p>å‰é¢å·²ç»è¯´è¿‡ä¿®æ­£æ–¹æ³•äº†ï¼Œä¸å†èµ˜è¿°ã€‚å½“ä¿®æ­£å®Œæˆåï¼Œå†æ¬¡éªŒè¯ï¼š</p>
<pre tabindex="0"><code>master $ kubectl -n work get endpoints
NAME           ENDPOINTS        AGE
saythx-redis   10.32.0.4:6379   15m
</code></pre><p><code>Endpoints</code> å·²ç»æ­£å¸¸ï¼ŒéªŒè¯ä¸‹æœåŠ¡æ˜¯å¦å¯ç”¨ï¼š</p>
<pre tabindex="0"><code>master $ docker run --rm -it --net host redis redis-cli -p 32355
127.0.0.1:32355&gt; ping
PONG
</code></pre><p>éªŒè¯æ— è¯¯ã€‚</p>
<h2 id="é›†ç¾¤é—®é¢˜">é›†ç¾¤é—®é¢˜</h2>
<p>ç”±äºæˆ‘ä»¬æœ‰å¤šä¸ªèŠ‚ç‚¹ï¼Œå†µä¸”åœ¨é›†ç¾¤æ­å»ºå’Œç»´æŠ¤è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šæ¯”è¾ƒå¸¸è§åˆ°é›†ç¾¤ç›¸å…³çš„é—®é¢˜ã€‚è¿™é‡Œæˆ‘ä»¬å…ˆä¸¾ä¸ªå®é™…ä¾‹å­è¿›è¡Œåˆ†æï¼š</p>
<pre tabindex="0"><code>master $ kubectl get nodes
NAME      STATUS     ROLES     AGE       VERSION
master    Ready      master    58m       v1.11.3
node01    NotReady   &lt;none&gt;    58m       v1.11.3
</code></pre><p>é€šè¿‡ kubectl æŸ¥çœ‹ï¼Œå‘ç°æœ‰ä¸€ä¸ªèŠ‚ç‚¹ NotReady ï¼Œè¿™åœ¨æ­å»ºé›†ç¾¤çš„è¿‡ç¨‹ä¸­ä¹Ÿæœ‰å¯èƒ½é‡åˆ°ã€‚</p>
<pre tabindex="0"><code>master $ kubectl get  node/node01 -o yaml
apiVersion: v1
kind: Node
metadata:
  annotations:
    kubeadm.alpha.kubernetes.io/cri-socket: /var/run/dockershim.sock
    node.alpha.kubernetes.io/ttl: &quot;0&quot;
    volumes.kubernetes.io/controller-managed-attach-detach: &quot;true&quot;
  creationTimestamp: 2018-12-19T16:46:59Z
  labels:
    beta.kubernetes.io/arch: amd64
    beta.kubernetes.io/os: linux
    kubernetes.io/hostname: node01
  name: node01
  resourceVersion: &quot;4850&quot;
  selfLink: /api/v1/nodes/node01
  uid: b440d3d5-03ad-11e9-917e-0242ac110035
spec: {}
status:
  addresses:
  - address: 172.17.0.66
    type: InternalIP
  - address: node01
    type: Hostname
  allocatable:
    cpu: &quot;4&quot;
    ephemeral-storage: &quot;89032026784&quot;
    hugepages-1Gi: &quot;0&quot;
    hugepages-2Mi: &quot;0&quot;
    memory: 3894652Ki
    pods: &quot;110&quot;
  capacity:
    cpu: &quot;4&quot;
    ephemeral-storage: 96605932Ki
    hugepages-1Gi: &quot;0&quot;
    hugepages-2Mi: &quot;0&quot;
    memory: 3997052Ki
    pods: &quot;110&quot;
  conditions:
  - lastHeartbeatTime: 2018-12-19T17:42:16Z
    lastTransitionTime: 2018-12-19T17:43:00Z
    message: Kubelet stopped posting node status.
    reason: NodeStatusUnknown
    status: Unknown
    type: OutOfDisk
  - lastHeartbeatTime: 2018-12-19T17:42:16Z
    lastTransitionTime: 2018-12-19T17:43:00Z
    message: Kubelet stopped posting node status.
    reason: NodeStatusUnknown
    status: Unknown
    type: MemoryPressure
  - lastHeartbeatTime: 2018-12-19T17:42:16Z
    lastTransitionTime: 2018-12-19T17:43:00Z
    message: Kubelet stopped posting node status.
    reason: NodeStatusUnknown
    status: Unknown
    type: DiskPressure
  - lastHeartbeatTime: 2018-12-19T17:42:16Z
    lastTransitionTime: 2018-12-19T16:46:59Z
    message: kubelet has sufficient PID available
    reason: KubeletHasSufficientPID
    status: &quot;False&quot;
    type: PIDPressure
  - lastHeartbeatTime: 2018-12-19T17:42:16Z
    lastTransitionTime: 2018-12-19T17:43:00Z
    message: Kubelet stopped posting node status.
    reason: NodeStatusUnknown
    status: Unknown
    type: Ready
  daemonEndpoints:
    kubeletEndpoint:
      Port: 10250
  ...
</code></pre><p>æˆ‘ä»¬ä¹‹å‰ä»‹ç» <code>kubelet</code> æ—¶è¯´è¿‡ï¼Œ <code>kubelet</code> çš„ä½œç”¨ä¹‹ä¸€ä¾¿æ˜¯å°†è‡ªèº«æ³¨å†Œè‡³ <code>kube-apiserver</code>ã€‚</p>
<p>è¿™é‡Œçš„ message ä¿¡æ¯è¯´æ˜ <code>kubelet</code> ä¸å†å‘ <code>kube-apiserver</code> å‘é€å¿ƒè·³åŒ…ä¹‹ç±»çš„äº†ï¼Œæ‰€ä»¥è¢«åˆ¤å®šä¸º NotReady çš„çŠ¶æ€ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç™»å½• node01 æœºå™¨æŸ¥çœ‹ <code>kubelet</code> çš„çŠ¶æ€ã€‚</p>
<pre tabindex="0"><code>node01 $ systemctl status kubelet
â— kubelet.service - kubelet: The Kubernetes Node Agent
   Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)
  Drop-In: /etc/systemd/system/kubelet.service.d
           â””â”€kubeadm.conf
   Active: inactive (dead) since Wed 2018-12-19 17:42:17 UTC; 18min ago
     Docs: https://kubernetes.io/docs/home/
  Process: 1693 ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_
 Main PID: 1693 (code=exited, status=0/SUCCESS)
</code></pre><p>å¯ä»¥çœ‹åˆ°è¯¥æœºå™¨ä¸Š <code>kubelet</code> æ²¡æœ‰å¯åŠ¨ã€‚ç°åœ¨å°†å…¶å¯åŠ¨ï¼Œç¨ç­‰ç‰‡åˆ»çœ‹çœ‹èŠ‚ç¾¤ä¸­ <code>Node</code> çš„çŠ¶æ€ã€‚</p>
<pre tabindex="0"><code>master $ kubectl get nodes
NAME      STATUS    ROLES     AGE       VERSION
master    Ready     master    1h        v1.11.3
node01    Ready     &lt;none&gt;    1h        v1.11.3
</code></pre><h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æœ¬èŠ‚æˆ‘ä»¬ä»‹ç»äº† K8S ä¸­å¸¸ç”¨çš„é—®é¢˜æ’æŸ¥å’Œè§£å†³æ€è·¯ï¼Œä½†å®é™…ç”Ÿäº§ç¯å¢ƒä¸­æƒ…å†µä¼šæœ‰å’Œæ›´å¤šä¸ç¡®å®šå› ç´ ï¼ŒæŒæ¡æœ¬èŠ‚ä¸­ä»‹ç»çš„åŸºç¡€ï¼Œæœ‰åˆ©äºä¹‹åç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡Œå¸¸è§„é—®é¢˜çš„æ’æŸ¥ã€‚</p>
<p>å½“ç„¶ï¼Œæœ¬èŠ‚åªæ˜¯ä»‹ç»é€šè¿‡ kubectl æ¥å®šä½å’Œè§£å†³é—®é¢˜ï¼Œä¸ªåˆ«æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦ç™»å½•ç›¸å…³çš„èŠ‚ç‚¹ï¼Œå®é™…å»ä½¿ç”¨ <code>Docker</code> å·¥å…·ç­‰è¿›è¡Œé—®é¢˜çš„è¯¦ç»†æ’æŸ¥ã€‚</p>
<p>è‡³æ­¤ï¼ŒK8S çš„åŸºç¡€åŸç†å’Œå¸¸è§„é—®é¢˜æ’æŸ¥æ€è·¯ç­‰éƒ½å·²ç»é€šè¿‡åŒ…æ‹¬æœ¬èŠ‚åœ¨å†…çš„ 19 å°èŠ‚ä»‹ç»å®Œæ¯•ï¼Œç›¸ä¿¡ä½ ç°åœ¨å·²ç»è¿«ä¸åŠå¾…çš„æƒ³è¦ä½¿ç”¨ K8S äº†ã€‚</p>
<p>ä¸è¿‡ kubectl ä½œä¸ºå‘½ä»¤è¡Œå·¥å…·ä¹Ÿè®¸æœ‰äº›äººä¼šä¸ä¹ æƒ¯ä½¿ç”¨ï¼Œä¸‹èŠ‚ï¼Œæˆ‘ä»¬å°†ä»‹ç» K8S çš„æ‰©å±•ç»„ä»¶ <code>kube-dashboard</code> äº†è§£å®ƒçš„ä¸»è¦åŠŸèƒ½åŠå¸¦ç»™æˆ‘ä»¬çš„ä¾¿åˆ©ã€‚</p>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/18-%E5%BA%96%E4%B8%81%E8%A7%A3%E7%89%9Bcontainer-runtime-docker/"><span>18 åº–ä¸è§£ç‰›ï¼šContainer Runtime ï¼ˆDockerï¼‰</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/kubernetes/kubernetes%E4%BB%8E%E4%B8%8A%E6%89%8B%E5%88%B0%E5%AE%9E%E8%B7%B5/20-%E6%89%A9%E5%B1%95%E5%A2%9E%E5%BC%BAdashboard/"><span>20 æ‰©å±•å¢å¼ºï¼šDashboard</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 28280 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>