<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title> | Yipsen Ye</title>
<meta name="description" content="åœ¨ Redis 5.0 Stream æ²¡å‡ºæ¥ä¹‹å‰ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„å®ç°æ–¹å¼éƒ½æœ‰ç€å„è‡ªçš„ç¼ºé™·ï¼Œä¾‹å¦‚ï¼š
 å‘å¸ƒè®¢é˜…æ¨¡å¼ PubSubï¼Œä¸èƒ½æŒä¹…åŒ–ä¹Ÿå°±æ— æ³•å¯é çš„ä¿å­˜æ¶ˆæ¯ï¼Œå¹¶ä¸”å¯¹äºç¦»çº¿é‡è¿çš„å®¢æˆ·ç«¯ä¸èƒ½è¯»å–å†å²æ¶ˆæ¯çš„ç¼ºé™·ï¼› åˆ—è¡¨å®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼ä¸èƒ½é‡å¤æ¶ˆè´¹ï¼Œä¸€ä¸ªæ¶ˆæ¯æ¶ˆè´¹å®Œå°±ä¼šè¢«åˆ é™¤ï¼› æœ‰åºé›†åˆæ¶ˆæ¯é˜Ÿåˆ—çš„å®ç°æ–¹å¼ä¸èƒ½å­˜å‚¨ç›¸åŒ value çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”ä¸èƒ½é˜»å¡è¯»å–æ¶ˆæ¯ã€‚  å¹¶ä¸”ä»¥ä¸Šä¸‰ç§æ–¹å¼åœ¨å®ç°æ¶ˆæ¯é˜Ÿåˆ—æ—¶ï¼Œåªèƒ½å­˜å‚¨å• value å€¼ï¼Œä¹Ÿå°±æ˜¯å¦‚æœä½ è¦å­˜å‚¨ä¸€ä¸ªå¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œå¿…é¡»å…ˆåºåˆ—åŒ–æˆ JSON å­—ç¬¦ä¸²ï¼Œåœ¨è¯»å–ä¹‹åè¿˜è¦ååºåˆ—åŒ–æˆå¯¹è±¡æ‰è¡Œï¼Œè¿™ä¹Ÿç»™ç”¨æˆ·çš„ä½¿ç”¨å¸¦æ¥çš„ä¸ä¾¿ï¼ŒåŸºäºä»¥ä¸Šé—®é¢˜ï¼ŒRedis 5.0 ä¾¿æ¨å‡ºäº† Stream ç±»å‹ä¹Ÿæ˜¯æ­¤ç‰ˆæœ¬æœ€é‡è¦çš„åŠŸèƒ½ï¼Œç”¨äºå®Œç¾åœ°å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒå€Ÿé‰´äº† Kafka çš„è®¾è®¡æ€è·¯ï¼Œå®ƒæ”¯æŒæ¶ˆæ¯çš„æŒä¹…åŒ–å’Œæ¶ˆæ¯è½¨è¿¹çš„æ¶ˆè´¹ï¼Œæ”¯æŒ ack ç¡®è®¤æ¶ˆæ¯çš„æ¨¡å¼ï¼Œè®©æ¶ˆæ¯é˜Ÿåˆ—æ›´åŠ çš„ç¨³å®šå’Œå¯é ã€‚
æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆæ¥äº†è§£ Stream è‡ªèº«çš„ä¸€äº›ç‰¹æ€§ï¼Œç„¶ååœ¨ç»¼åˆ Stream çš„ç‰¹æ€§ï¼Œç»“åˆ Java ä»£ç å®Œæ•´çš„å®ç°ä¸€ä¸ªå®Œç¾çš„æ¶ˆæ¯é˜Ÿåˆ—ç¤ºä¾‹ã€‚
åŸºç¡€ä½¿ç”¨ Stream æ—¢ç„¶æ˜¯ä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆå’Œå…¶ä»–æ•°æ®ç±»å‹ç›¸ä¼¼ï¼Œå®ƒä¹Ÿæœ‰ä¸€äº›è‡ªå·±çš„æ“ä½œæ–¹æ³•ï¼Œä¾‹å¦‚ï¼š
 xadd æ·»åŠ æ¶ˆæ¯ï¼› xlen æŸ¥è¯¢æ¶ˆæ¯é•¿åº¦ï¼› xdel æ ¹æ®æ¶ˆæ¯ ID åˆ é™¤æ¶ˆæ¯ï¼› del åˆ é™¤æ•´ä¸ª Streamï¼› xrange è¯»å–åŒºé—´æ¶ˆæ¯ xread è¯»å–æŸä¸ªæ¶ˆæ¯ä¹‹åçš„æ¶ˆæ¯ã€‚  å…·ä½“ä½¿ç”¨å¦‚ä¸‹æ‰€è¿°ã€‚
æ·»åŠ æ¶ˆæ¯ 127.0.0.1:6379&amp;gt; xadd key * name redis age 10 &amp;quot;1580880750844-0&amp;quot; #ç»“æœè¿”å›çš„æ˜¯æ¶ˆæ¯ id å…¶ä¸­ * è¡¨ç¤ºä½¿ç”¨ Redis çš„è§„åˆ™ï¼šæ—¶é—´æˆ³ &#43; åºå·çš„æ–¹å¼è‡ªåŠ¨ç”Ÿæˆ IDï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®š IDã€‚">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><article class="post-block">
        <h1 class="post-title"></h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;0001-01-01 00:00:00</span></div></div>
        <div class="post-content">
            <p>åœ¨ Redis 5.0 Stream æ²¡å‡ºæ¥ä¹‹å‰ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„å®ç°æ–¹å¼éƒ½æœ‰ç€å„è‡ªçš„ç¼ºé™·ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>å‘å¸ƒè®¢é˜…æ¨¡å¼ PubSubï¼Œä¸èƒ½æŒä¹…åŒ–ä¹Ÿå°±æ— æ³•å¯é çš„ä¿å­˜æ¶ˆæ¯ï¼Œå¹¶ä¸”å¯¹äºç¦»çº¿é‡è¿çš„å®¢æˆ·ç«¯ä¸èƒ½è¯»å–å†å²æ¶ˆæ¯çš„ç¼ºé™·ï¼›</li>
<li>åˆ—è¡¨å®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼ä¸èƒ½é‡å¤æ¶ˆè´¹ï¼Œä¸€ä¸ªæ¶ˆæ¯æ¶ˆè´¹å®Œå°±ä¼šè¢«åˆ é™¤ï¼›</li>
<li>æœ‰åºé›†åˆæ¶ˆæ¯é˜Ÿåˆ—çš„å®ç°æ–¹å¼ä¸èƒ½å­˜å‚¨ç›¸åŒ value çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”ä¸èƒ½é˜»å¡è¯»å–æ¶ˆæ¯ã€‚</li>
</ul>
<p>å¹¶ä¸”ä»¥ä¸Šä¸‰ç§æ–¹å¼åœ¨å®ç°æ¶ˆæ¯é˜Ÿåˆ—æ—¶ï¼Œåªèƒ½å­˜å‚¨å• value å€¼ï¼Œä¹Ÿå°±æ˜¯å¦‚æœä½ è¦å­˜å‚¨ä¸€ä¸ªå¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œå¿…é¡»å…ˆåºåˆ—åŒ–æˆ JSON å­—ç¬¦ä¸²ï¼Œåœ¨è¯»å–ä¹‹åè¿˜è¦ååºåˆ—åŒ–æˆå¯¹è±¡æ‰è¡Œï¼Œè¿™ä¹Ÿç»™ç”¨æˆ·çš„ä½¿ç”¨å¸¦æ¥çš„ä¸ä¾¿ï¼ŒåŸºäºä»¥ä¸Šé—®é¢˜ï¼ŒRedis 5.0 ä¾¿æ¨å‡ºäº† Stream ç±»å‹ä¹Ÿæ˜¯æ­¤ç‰ˆæœ¬æœ€é‡è¦çš„åŠŸèƒ½ï¼Œç”¨äºå®Œç¾åœ°å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒå€Ÿé‰´äº† Kafka çš„è®¾è®¡æ€è·¯ï¼Œå®ƒæ”¯æŒæ¶ˆæ¯çš„æŒä¹…åŒ–å’Œæ¶ˆæ¯è½¨è¿¹çš„æ¶ˆè´¹ï¼Œæ”¯æŒ ack ç¡®è®¤æ¶ˆæ¯çš„æ¨¡å¼ï¼Œè®©æ¶ˆæ¯é˜Ÿåˆ—æ›´åŠ çš„ç¨³å®šå’Œå¯é ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆæ¥äº†è§£ Stream è‡ªèº«çš„ä¸€äº›ç‰¹æ€§ï¼Œç„¶ååœ¨ç»¼åˆ Stream çš„ç‰¹æ€§ï¼Œç»“åˆ Java ä»£ç å®Œæ•´çš„å®ç°ä¸€ä¸ªå®Œç¾çš„æ¶ˆæ¯é˜Ÿåˆ—ç¤ºä¾‹ã€‚</p>
<h3 id="åŸºç¡€ä½¿ç”¨">åŸºç¡€ä½¿ç”¨</h3>
<p>Stream æ—¢ç„¶æ˜¯ä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆå’Œå…¶ä»–æ•°æ®ç±»å‹ç›¸ä¼¼ï¼Œå®ƒä¹Ÿæœ‰ä¸€äº›è‡ªå·±çš„æ“ä½œæ–¹æ³•ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>xadd æ·»åŠ æ¶ˆæ¯ï¼›</li>
<li>xlen æŸ¥è¯¢æ¶ˆæ¯é•¿åº¦ï¼›</li>
<li>xdel æ ¹æ®æ¶ˆæ¯ ID åˆ é™¤æ¶ˆæ¯ï¼›</li>
<li>del åˆ é™¤æ•´ä¸ª Streamï¼›</li>
<li>xrange è¯»å–åŒºé—´æ¶ˆæ¯</li>
<li>xread è¯»å–æŸä¸ªæ¶ˆæ¯ä¹‹åçš„æ¶ˆæ¯ã€‚</li>
</ul>
<p>å…·ä½“ä½¿ç”¨å¦‚ä¸‹æ‰€è¿°ã€‚</p>
<h4 id="æ·»åŠ æ¶ˆæ¯"><strong>æ·»åŠ æ¶ˆæ¯</strong></h4>
<pre tabindex="0"><code>127.0.0.1:6379&gt; xadd key * name redis age 10
&quot;1580880750844-0&quot; #ç»“æœè¿”å›çš„æ˜¯æ¶ˆæ¯ id

</code></pre><p>å…¶ä¸­ <code>*</code> è¡¨ç¤ºä½¿ç”¨ Redis çš„è§„åˆ™ï¼šæ—¶é—´æˆ³ + åºå·çš„æ–¹å¼è‡ªåŠ¨ç”Ÿæˆ IDï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®š IDã€‚</p>
<p>ç›¸å…³è¯­æ³•ï¼š</p>
<pre tabindex="0"><code>xadd key ID field string [field string ...]

</code></pre><h4 id="æŸ¥è¯¢æ¶ˆæ¯çš„é•¿åº¦"><strong>æŸ¥è¯¢æ¶ˆæ¯çš„é•¿åº¦</strong></h4>
<pre tabindex="0"><code>127.0.0.1:6379&gt; xlen key
(integer) 1

</code></pre><p>ç›¸å…³è¯­æ³•ï¼š</p>
<pre tabindex="0"><code>xlen key

</code></pre><h4 id="åˆ é™¤æ¶ˆæ¯"><strong>åˆ é™¤æ¶ˆæ¯</strong></h4>
<pre tabindex="0"><code>127.0.0.1:6379&gt; xadd key * name redis
&quot;1580881585129-0&quot; #æ¶ˆæ¯ ID
127.0.0.1:6379&gt; xlen key
(integer) 1
127.0.0.1:6379&gt; xdel key 1580881585129-0 #åˆ é™¤æ¶ˆæ¯ï¼Œæ ¹æ® ID
(integer) 1
127.0.0.1:6379&gt; xlen key
(integer) 0

</code></pre><p>ç›¸å…³è¯­æ³•ï¼š</p>
<pre tabindex="0"><code>xdel key ID [ID ...]

</code></pre><p>æ­¤å‘½ä»¤æ”¯æŒåˆ é™¤ä¸€æ¡æˆ–å¤šæ¡æ¶ˆæ¯ï¼Œæ ¹æ®æ¶ˆæ¯ IDã€‚</p>
<h4 id="åˆ é™¤æ•´ä¸ª-stream"><strong>åˆ é™¤æ•´ä¸ª Stream</strong></h4>
<pre tabindex="0"><code>127.0.0.1:6379&gt; del key #åˆ é™¤æ•´ä¸ª Stream
(integer) 1
127.0.0.1:6379&gt; xlen key
(integer) 0

</code></pre><p>ç›¸å…³è¯­æ³•ï¼š</p>
<pre tabindex="0"><code>del key [key ...]

</code></pre><p>æ­¤å‘½ä»¤æ”¯æŒåˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ª Streamã€‚</p>
<h4 id="æŸ¥è¯¢åŒºé—´æ¶ˆæ¯"><strong>æŸ¥è¯¢åŒºé—´æ¶ˆæ¯</strong></h4>
<pre tabindex="0"><code>127.0.0.1:6379&gt; xrange mq - +
1) 1) &quot;1580882060464-0&quot;
   2) 1) &quot;name&quot;
      2) &quot;redis&quot;
      3) &quot;age&quot;
      4) &quot;10&quot;
2) 1) &quot;1580882071524-0&quot;
   2) 1) &quot;name&quot;
      2) &quot;java&quot;
      3) &quot;age&quot;
      4) &quot;20&quot;

</code></pre><p>å…¶ä¸­ï¼š<code>-</code> è¡¨ç¤ºç¬¬ä¸€æ¡æ¶ˆæ¯ï¼Œ<code>+</code> è¡¨ç¤ºæœ€åä¸€æ¡æ¶ˆæ¯ã€‚</p>
<p>ç›¸å…³è¯­æ³•ï¼š</p>
<pre tabindex="0"><code>xrange key start end [COUNT count]

</code></pre><h4 id="æŸ¥è¯¢æŸä¸ªæ¶ˆæ¯ä¹‹åçš„æ¶ˆæ¯"><strong>æŸ¥è¯¢æŸä¸ªæ¶ˆæ¯ä¹‹åçš„æ¶ˆæ¯</strong></h4>
<pre tabindex="0"><code>127.0.0.1:6379&gt; xread count 1 streams mq 1580882060464-0
1) 1) &quot;mq&quot;
   2) 1) 1) &quot;1580882071524-0&quot;
         2) 1) &quot;name&quot;
            2) &quot;java&quot;
            3) &quot;age&quot;
            4) &quot;20&quot;

</code></pre><p>åœ¨åç§°ä¸º mq çš„ Stream ä¸­ï¼Œä»æ¶ˆæ¯ ID ä¸º 1580882060464-0 çš„ï¼Œå¾€åæŸ¥è¯¢ä¸€æ¡æ¶ˆæ¯ã€‚</p>
<p>ç›¸å…³è¯­æ³•ï¼š</p>
<pre tabindex="0"><code>xread [COUNT count] [BLOCK milliseconds] STREAMS key [key ...] ID [ID ...]

</code></pre><p>æ­¤å‘½ä»¤æä¾›äº†é˜»å¡è¯»çš„å‚æ•° blockï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒè¯»å–ä»å½“å‰æ•°æ®ä»¥åæ–°å¢æ•°æ®ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>127.0.0.1:6379&gt; xread count 1 block 0 streams mq $

</code></pre><p>å…¶ä¸­ <code>block 0</code> è¡¨ç¤ºä¸€ç›´é˜»å¡ï¼Œ<code>$</code> è¡¨ç¤ºä»æœ€åå¼€å§‹è¯»å–ï¼Œè¿™ä¸ªæ—¶å€™æ–°å¼€ä¸€ä¸ªå‘½ä»¤è¡Œæ’å…¥ä¸€æ¡æ•°æ®ï¼Œæ­¤å‘½ä»¤å±•ç¤ºçš„ç»“æœå¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>127.0.0.1:6379&gt; xadd mq * name sql age 20 #æ–°çª—å£æ·»åŠ æ•°æ®
&quot;1580890737890-0&quot;
#é˜»å¡è¯»å–åˆ°çš„æ–°æ•°æ®
127.0.0.1:6379&gt; xread count 1 block 0 streams mq $
1) 1) &quot;mq&quot;
   2) 1) 1) &quot;1580890737890-0&quot;
         2) 1) &quot;name&quot;
            2) &quot;sql&quot;
            3) &quot;age&quot;
            4) &quot;20&quot;
(36.37s)

</code></pre><h3 id="åŸºç¡€ç‰ˆæ¶ˆæ¯é˜Ÿåˆ—">åŸºç¡€ç‰ˆæ¶ˆæ¯é˜Ÿåˆ—</h3>
<p>ä½¿ç”¨ Stream æ¶ˆè´¹åˆ†ç»„å®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„åŠŸèƒ½å’Œåˆ—è¡¨æ–¹å¼çš„æ¶ˆæ¯é˜Ÿåˆ—æ¯”è¾ƒç›¸ä¼¼ï¼Œä½¿ç”¨ xadd å‘½ä»¤å’Œ xread å¾ªç¯è¯»å–å°±å¯ä»¥å®ç°åŸºç¡€ç‰ˆçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>import com.google.gson.Gson;
import redis.clients.jedis.Jedis;
import redis.clients.jedis.StreamEntry;
import redis.clients.jedis.StreamEntryID;
import java.util.AbstractMap;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class StreamExample {
    public static void main(String[] args) throws InterruptedException {
        // æ¶ˆè´¹è€…
        new Thread(() -&gt; consumer()).start();
        Thread.sleep(1000);
        // ç”Ÿäº§è€…
        producer();
    }
    /**
     * ç”Ÿäº§è€…
     */
    public static void producer() throws InterruptedException {
        Jedis jedis = new Jedis(&quot;127.0.0.1&quot;, 6379);
        // æ¨é€æ¶ˆæ¯
        Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
        map.put(&quot;name&quot;, &quot;redis&quot;);
        map.put(&quot;age&quot;, &quot;10&quot;);
        // æ·»åŠ æ¶ˆæ¯
        StreamEntryID id = jedis.xadd(&quot;mq&quot;, null, map);
        System.out.println(&quot;æ¶ˆæ¯æ·»åŠ æˆåŠŸ IDï¼š&quot; + id);
    }
    /**
     * æ¶ˆè´¹è€…
     */
    public static void consumer() {
        Jedis jedis = new Jedis(&quot;127.0.0.1&quot;, 6379);
        // æ¶ˆè´¹æ¶ˆæ¯
        while (true) {
            // è·å–æ¶ˆæ¯ï¼Œnew StreamEntryID().LAST_ENTRY æ ‡è¯†è·å–å½“å‰æ—¶é—´ä»¥åçš„æ–°å¢æ¶ˆæ¯
            Map.Entry&lt;String, StreamEntryID&gt; entry = new AbstractMap.SimpleImmutableEntry&lt;&gt;(&quot;mq&quot;,
                    new StreamEntryID().LAST_ENTRY);
            // é˜»å¡è¯»å–ä¸€æ¡æ¶ˆæ¯ï¼ˆæœ€å¤§é˜»å¡æ—¶é—´120sï¼‰
            List&lt;Map.Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; list = jedis.xread(1, 120 * 1000, entry);
            if (list.size() == 1) {
                // è¯»å–åˆ°æ¶ˆæ¯
                System.out.println(&quot;è¯»å–åˆ°æ¶ˆæ¯ IDï¼š&quot; + list.get(0).getValue().get(0).getID());
                // ä½¿ç”¨ Gson æ¥æ‰“å° JSON æ ¼å¼çš„æ¶ˆæ¯å†…å®¹
                System.out.println(&quot;å†…å®¹ï¼š&quot; + new Gson().toJson(list.get(0).getValue().get(0).getFields()));
            }
        }
    }
}

</code></pre><p>ä»¥ä¸Šä»£ç è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>æ¶ˆæ¯æ·»åŠ æˆåŠŸ IDï¼š1580895735148-0
è¯»å–åˆ°æ¶ˆæ¯ IDï¼š1580895735148-0
å†…å®¹ï¼š{&quot;name&quot;:&quot;redis&quot;,&quot;age&quot;:&quot;10&quot;}

</code></pre><p>ä»¥ä¸Šä»£ç éœ€è¦ç‰¹æ®Šè¯´æ˜çš„æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>new StreamEntryID().LAST_ENTRY</code> æ¥å®ç°è¯»å–å½“å‰æ—¶é—´ä»¥åæ–°å¢çš„æ¶ˆæ¯ï¼Œå¦‚æœè¦ä»å¤´è¯»å–å†å²æ¶ˆæ¯æŠŠè¿™è¡Œä»£ç ä¸­çš„ <code>.LAST_ENTRY</code> å»æ‰å³å¯ã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œåœ¨ Jedis æ¡†æ¶ä¸­å¦‚æœä½¿ç”¨ jedis.xread() æ–¹æ³•æ¥é˜»å¡è¯»å–æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç¬¬äºŒä¸ªå‚æ•° long block å¿…é¡»è®¾ç½®å¤§äº 0ï¼Œå¦‚æœè®¾ç½®å°äº 0ï¼Œæ­¤é˜»å¡æ¡ä»¶å°±æ— æ•ˆäº†ï¼Œæˆ‘æŸ¥çœ‹äº† jedis çš„æºç å‘ç°ï¼Œå®ƒåªæœ‰åˆ¤æ–­åœ¨å¤§äº 0 çš„æ—¶å€™æ‰ä¼šè®¾ç½®é˜»å¡å±æ€§ï¼Œæºç å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>if (block &gt; 0L) {
    params[streamsIndex++] = Keyword.BLOCK.raw;
    params[streamsIndex++] = Protocol.toByteArray(block);
}

</code></pre><p>æ‰€ä»¥ block å±æ€§æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼æ¥é˜»å¡è¯»å–æ¶ˆæ¯ã€‚</p>
<blockquote>
<p>æ‰€è°“çš„é˜»å¡è¯»å–æ¶ˆæ¯æŒ‡çš„æ˜¯å½“é˜Ÿåˆ—ä¸­æ²¡æœ‰æ•°æ®æ—¶ä¼šè¿›å…¥ä¼‘çœ æ¨¡å¼ï¼Œç­‰æœ‰æ•°æ®ä¹‹åæ‰ä¼šå”¤é†’ç»§ç»­æ‰§è¡Œã€‚</p>
</blockquote>
<h3 id="å°ç»“">å°ç»“</h3>
<p>æœ¬æ–‡ä»‹ç»äº† Stream çš„åŸºç¡€æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨ xadd å­˜å…¥æ¶ˆæ¯å’Œ xread å¾ªç¯é˜»å¡è¯»å–æ¶ˆæ¯çš„æ–¹å¼å®ç°äº†ç®€æ˜“ç‰ˆçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œäº¤äº’æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Redis%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98/assets/3e54f6b0-6f6f-11ea-832c-2703165cf4af" alt="Streamç®€æ˜“ç‰ˆäº¤äº’å›¾.png"></p>
<p>ç„¶åè¿™äº›å¹¶ä¸æ˜¯ Stream æœ€æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œä¸‹æ–‡æˆ‘ä»¬å°†å¸¦é¢†è¯»è€…æœ‹å‹ä»¬ï¼Œä½¿ç”¨æ¶ˆè´¹åˆ†ç»„æ¥å®ç°ä¸€ä¸ªå®Œç¾çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/redis/redis-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98/27-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%BB%88%E6%9E%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88stream%E4%B8%8B.md/"><span></span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/redis/redis-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98/25-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%9A%84%E5%85%B6%E4%BB%96%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F.md/"><span></span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 28280 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>