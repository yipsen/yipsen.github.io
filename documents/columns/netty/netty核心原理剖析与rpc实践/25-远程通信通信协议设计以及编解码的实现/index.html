<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>25 è¿œç¨‹é€šä¿¡ï¼šé€šä¿¡åè®®è®¾è®¡ä»¥åŠç¼–è§£ç çš„å®ç° | Yipsen Ye</title>
<meta name="description" content="ä¸ŠèŠ‚è¯¾æˆ‘ä»¬æ­å»ºäº†æœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…çš„åŸºæœ¬æ¡†æ¶ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸¤ä¸ªæ¨¡å—ä¹‹é—´çš„é€šä¿¡æœºåˆ¶äº†ã€‚æœ¬èŠ‚è¯¾æˆ‘ä»¬é€šè¿‡å‘ ChannelPipeline æ·»åŠ è‡ªå®šä¹‰çš„ä¸šåŠ¡å¤„ç†å™¨ï¼Œæ¥å®Œæˆ RPC æ¡†æ¶çš„è¿œç¨‹é€šä¿¡æœºåˆ¶ã€‚éœ€è¦å®ç°çš„ä¸»è¦åŠŸèƒ½å¦‚ä¸‹ï¼š
 æœåŠ¡æ¶ˆè´¹è€…å®ç°åè®®ç¼–ç ï¼Œå‘æœåŠ¡æä¾›è€…å‘é€è°ƒç”¨æ•°æ®ã€‚ æœåŠ¡æä¾›è€…æ”¶åˆ°æ•°æ®åè§£ç ï¼Œç„¶åå‘æœåŠ¡æ¶ˆè´¹è€…å‘é€å“åº”æ•°æ®ï¼Œæš‚æ—¶å¿½ç•¥ RPC è¯·æ±‚æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„ã€‚ æœåŠ¡æ¶ˆè´¹è€…æ”¶åˆ°å“åº”æ•°æ®åæˆåŠŸè¿”å›ã€‚   æºç å‚è€ƒåœ°å€ï¼šmini-rpc
 RPC é€šä¿¡æ–¹æ¡ˆè®¾è®¡ ç»“åˆæœ¬èŠ‚è¯¾çš„ç›®æ ‡ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯¹ RPC è¯·æ±‚è°ƒç”¨å’Œç»“æœå“åº”ä¸¤ä¸ªè¿‡ç¨‹åˆ†åˆ«è¿›è¡Œè¯¦ç»†æ‹†è§£åˆ†æã€‚é¦–å…ˆçœ‹ä¸‹ RPC è¯·æ±‚è°ƒç”¨çš„è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚
RPC è¯·æ±‚çš„è¿‡ç¨‹å¯¹äºæœåŠ¡æ¶ˆè´¹è€…æ¥è¯´æ˜¯å‡ºç«™æ“ä½œï¼Œå¯¹äºæœåŠ¡æä¾›è€…æ¥è¯´æ˜¯å…¥ç«™æ“ä½œã€‚æ•°æ®å‘é€å‰ï¼ŒæœåŠ¡æ¶ˆè´¹è€…å°† RPC è¯·æ±‚ä¿¡æ¯å°è£…æˆ MiniRpcProtocol å¯¹è±¡ï¼Œç„¶åé€šè¿‡ç¼–ç å™¨ MiniRpcEncoder è¿›è¡ŒäºŒè¿›åˆ¶ç¼–ç ï¼Œæœ€åç›´æ¥å‘å‘é€è‡³è¿œç«¯å³å¯ã€‚æœåŠ¡æä¾›è€…æ”¶åˆ°è¯·æ±‚æ•°æ®åï¼Œå°†äºŒè¿›åˆ¶æ•°æ®äº¤ç»™è§£ç å™¨ MiniRpcDecoderï¼Œè§£ç åå†æ¬¡ç”Ÿæˆ MiniRpcProtocol å¯¹è±¡ï¼Œç„¶åä¼ é€’ç»™ RpcRequestHandler æ‰§è¡ŒçœŸæ­£çš„ RPC è¯·æ±‚è°ƒç”¨ã€‚
æˆ‘ä»¬æš‚æ—¶å¿½ç•¥ RpcRequestHandler æ˜¯å¦‚ä½•æ‰§è¡Œ RPC è¯·æ±‚è°ƒç”¨çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­åˆ†æ RpcRequestHandler å¤„ç†æˆåŠŸåæ˜¯å¦‚ä½•å‘æœåŠ¡æ¶ˆè´¹è€…è¿”å›å“åº”ç»“æœçš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
ä¸ RPC è¯·æ±‚è¿‡ç¨‹ç›¸åï¼Œæ˜¯ç”±æœåŠ¡æä¾›è€…å°†å“åº”ç»“æœå°è£…æˆ MiniRpcProtocol å¯¹è±¡ï¼Œç„¶åé€šè¿‡ MiniRpcEncoder ç¼–ç å‘é€ç»™æœåŠ¡æ¶ˆè´¹è€…ã€‚æœåŠ¡æ¶ˆè´¹è€…å¯¹å“åº”ç»“æœè¿›è¡Œè§£ç ï¼Œå› ä¸º RPC è¯·æ±‚æ˜¯é«˜å¹¶å‘çš„ï¼Œæ‰€ä»¥éœ€è¦ RpcRequestHandler æ ¹æ®å“åº”ç»“æœæ‰¾åˆ°å¯¹åº”çš„è¯·æ±‚ï¼Œæœ€åå°†å“åº”ç»“æœè¿”å›ã€‚
ç»¼åˆ RPC è¯·æ±‚è°ƒç”¨å’Œç»“æœå“åº”çš„å¤„ç†è¿‡ç¨‹æ¥çœ‹ï¼Œç¼–ç å™¨ MiniRpcEncoderã€è§£ç å™¨ MiniRpcDecoder ä»¥åŠé€šä¿¡åè®®å¯¹è±¡ MiniRpcProtocol éƒ½å¯ä»¥è®¾è®¡æˆå¤ç”¨çš„ï¼Œæœ€ç»ˆæœåŠ¡æ¶ˆè´¹è€…å’ŒæœåŠ¡æä¾›è€…çš„ ChannelPipeline ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚
ç”±æ­¤å¯è§ï¼Œåœ¨å®ç° Netty ç½‘ç»œé€šä¿¡æ¨¡å—æ—¶ï¼Œå…ˆç”»å›¾åˆ†æ ChannelHandler çš„å¤„ç†æµç¨‹æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="nav-logo">
    <a href="http://yipsen.github.io/">
        
        <span class="nav-title">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æ–‡ç« </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/netty%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86%e5%89%96%e6%9e%90%e4%b8%8erpc%e5%ae%9e%e8%b7%b5/">Nettyæ ¸å¿ƒåŸç†å‰–æä¸RPCå®è·µ</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/00-%E5%AD%A6%E5%A5%BD-netty%E6%98%AF%E4%BD%A0%E4%BF%AE%E7%82%BC-java-%E5%86%85%E5%8A%9F%E7%9A%84%E5%BF%85%E7%BB%8F%E4%B9%8B%E8%B7%AF/">00 å­¦å¥½ Nettyï¼Œæ˜¯ä½ ä¿®ç‚¼ Java å†…åŠŸçš„å¿…ç»ä¹‹è·¯</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/01-%E5%88%9D%E8%AF%86-netty%E4%B8%BA%E4%BB%80%E4%B9%88-netty-%E8%BF%99%E4%B9%88%E6%B5%81%E8%A1%8C/">01 åˆè¯† Nettyï¼šä¸ºä»€ä¹ˆ Netty è¿™ä¹ˆæµè¡Œï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/02-%E7%BA%B5%E8%A7%88%E5%85%A8%E5%B1%80%E6%8A%8A%E6%8F%A1-netty-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E8%84%89%E7%BB%9C/">02 çºµè§ˆå…¨å±€ï¼šæŠŠæ¡ Netty æ•´ä½“æ¶æ„è„‰ç»œ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/03-%E5%BC%95%E5%AF%BC%E5%99%A8%E4%BD%9C%E7%94%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%90%AF%E5%8A%A8%E9%83%BD%E8%A6%81%E5%81%9A%E4%BA%9B%E4%BB%80%E4%B9%88/">03 å¼•å¯¼å™¨ä½œç”¨ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯åŠ¨éƒ½è¦åšäº›ä»€ä¹ˆï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/04-%E4%BA%8B%E4%BB%B6%E8%B0%83%E5%BA%A6%E5%B1%82%E4%B8%BA%E4%BB%80%E4%B9%88-eventloop-%E6%98%AF-netty-%E7%9A%84%E7%B2%BE%E9%AB%93/">04 äº‹ä»¶è°ƒåº¦å±‚ï¼šä¸ºä»€ä¹ˆ EventLoop æ˜¯ Netty çš„ç²¾é«“ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/05-%E6%9C%8D%E5%8A%A1%E7%BC%96%E6%8E%92%E5%B1%82pipeline-%E5%A6%82%E4%BD%95%E5%8D%8F%E8%B0%83%E5%90%84%E7%B1%BB-handler-/">05 æœåŠ¡ç¼–æ’å±‚ï¼šPipeline å¦‚ä½•åè°ƒå„ç±» Handler ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/06-%E7%B2%98%E5%8C%85%E6%8B%86%E5%8C%85%E9%97%AE%E9%A2%98%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E7%9A%84%E7%BD%91%E7%BB%9C%E5%8C%85/">06 ç²˜åŒ…æ‹†åŒ…é—®é¢˜ï¼šå¦‚ä½•è·å–ä¸€ä¸ªå®Œæ•´çš„ç½‘ç»œåŒ…ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/07-%E6%8E%A5%E5%A4%B4%E6%9A%97%E8%AF%AD%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8-netty-%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%8F%E8%AE%AE%E9%80%9A%E4%BF%A1/">07 æ¥å¤´æš—è¯­ï¼šå¦‚ä½•åˆ©ç”¨ Netty å®ç°è‡ªå®šä¹‰åè®®é€šä¿¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/08-%E5%BC%80%E7%AE%B1%E5%8D%B3%E7%94%A8netty-%E6%94%AF%E6%8C%81%E5%93%AA%E4%BA%9B%E5%B8%B8%E7%94%A8%E7%9A%84%E8%A7%A3%E7%A0%81%E5%99%A8/">08 å¼€ç®±å³ç”¨ï¼šNetty æ”¯æŒå“ªäº›å¸¸ç”¨çš„è§£ç å™¨ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/09-%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93writeandflush-%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%E5%89%96%E6%9E%90/">09 æ•°æ®ä¼ è¾“ï¼šwriteAndFlush å¤„ç†æµç¨‹å‰–æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/10-%E5%8F%8C%E5%88%83%E5%89%91%E5%90%88%E7%90%86%E7%AE%A1%E7%90%86-netty-%E5%A0%86%E5%A4%96%E5%86%85%E5%AD%98/">10 åŒåˆƒå‰‘ï¼šåˆç†ç®¡ç† Netty å †å¤–å†…å­˜</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/11-%E5%8F%A6%E8%B5%B7%E7%82%89%E7%81%B6netty-%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E8%BD%BD%E4%BD%93-bytebuf-%E8%AF%A6%E8%A7%A3/">11 å¦èµ·ç‚‰ç¶ï¼šNetty æ•°æ®ä¼ è¾“è½½ä½“ ByteBuf è¯¦è§£</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/12-%E4%BB%96%E5%B1%B1%E4%B9%8B%E7%9F%B3%E9%AB%98%E6%80%A7%E8%83%BD%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E5%99%A8-jemalloc-%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/">12 ä»–å±±ä¹‹çŸ³ï¼šé«˜æ€§èƒ½å†…å­˜åˆ†é…å™¨ jemalloc åŸºæœ¬åŸç†</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/13-%E4%B8%BE%E4%B8%80%E5%8F%8D%E4%B8%89netty-%E9%AB%98%E6%80%A7%E8%83%BD%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E8%AE%BE%E8%AE%A1%E4%B8%8A/">13 ä¸¾ä¸€åä¸‰ï¼šNetty é«˜æ€§èƒ½å†…å­˜ç®¡ç†è®¾è®¡ï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/14-%E4%B8%BE%E4%B8%80%E5%8F%8D%E4%B8%89netty-%E9%AB%98%E6%80%A7%E8%83%BD%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E8%AE%BE%E8%AE%A1%E4%B8%8B/">14 ä¸¾ä¸€åä¸‰ï¼šNetty é«˜æ€§èƒ½å†…å­˜ç®¡ç†è®¾è®¡ï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/15-%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%AF%B9%E8%B1%A1%E5%9B%9E%E6%94%B6%E7%AB%99recycler-%E5%AF%B9%E8%B1%A1%E6%B1%A0%E6%8A%80%E6%9C%AF%E8%A7%A3%E6%9E%90/">15 è½»é‡çº§å¯¹è±¡å›æ”¶ç«™ï¼šRecycler å¯¹è±¡æ± æŠ€æœ¯è§£æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/16-io-%E5%8A%A0%E9%80%9F%E4%B8%8E%E4%BC%97%E4%B8%8D%E5%90%8C%E7%9A%84-netty-%E9%9B%B6%E6%8B%B7%E8%B4%9D%E6%8A%80%E6%9C%AF/">16 IO åŠ é€Ÿï¼šä¸ä¼—ä¸åŒçš„ Netty é›¶æ‹·è´æŠ€æœ¯</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/17-%E6%BA%90%E7%A0%81%E7%AF%87%E4%BB%8E-linux-%E5%87%BA%E5%8F%91%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/">17 æºç ç¯‡ï¼šä» Linux å‡ºå‘æ·±å…¥å‰–ææœåŠ¡ç«¯å¯åŠ¨æµç¨‹</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/18-%E6%BA%90%E7%A0%81%E7%AF%87%E8%A7%A3%E5%AF%86-netty-reactor-%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/">18 æºç ç¯‡ï¼šè§£å¯† Netty Reactor çº¿ç¨‹æ¨¡å‹</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/19-%E6%BA%90%E7%A0%81%E7%AF%87%E4%B8%80%E4%B8%AA%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%9C%A8-netty-%E4%B8%AD%E7%9A%84%E6%97%85%E7%A8%8B/">19 æºç ç¯‡ï¼šä¸€ä¸ªç½‘ç»œè¯·æ±‚åœ¨ Netty ä¸­çš„æ—…ç¨‹</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/20-%E6%8A%80%E5%B7%A7%E7%AF%87netty-%E7%9A%84-fastthreadlocal-%E7%A9%B6%E7%AB%9F%E6%AF%94-threadlocal-%E5%BF%AB%E5%9C%A8%E5%93%AA%E5%84%BF/">20 æŠ€å·§ç¯‡ï¼šNetty çš„ FastThreadLocal ç©¶ç«Ÿæ¯” ThreadLocal å¿«åœ¨å“ªå„¿ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/21-%E6%8A%80%E5%B7%A7%E7%AF%87%E5%BB%B6%E8%BF%9F%E4%BB%BB%E5%8A%A1%E5%A4%84%E7%90%86%E7%A5%9E%E5%99%A8%E4%B9%8B%E6%97%B6%E9%97%B4%E8%BD%AE-hashedwheeltimer/">21 æŠ€å·§ç¯‡ï¼šå»¶è¿Ÿä»»åŠ¡å¤„ç†ç¥å™¨ä¹‹æ—¶é—´è½® HashedWheelTimer</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/22-%E6%8A%80%E5%B7%A7%E7%AF%87%E9%AB%98%E6%80%A7%E8%83%BD%E6%97%A0%E9%94%81%E9%98%9F%E5%88%97-mpsc-queue/">22 æŠ€å·§ç¯‡ï¼šé«˜æ€§èƒ½æ— é”é˜Ÿåˆ— Mpsc Queue</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/23-%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%AB%98%E6%80%A7%E8%83%BD%E5%88%86%E5%B8%83%E5%BC%8F-rpc-%E6%A1%86%E6%9E%B6/">23 æ¶æ„è®¾è®¡ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªé«˜æ€§èƒ½åˆ†å¸ƒå¼ RPC æ¡†æ¶</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/24-%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E4%B8%8E%E8%AE%A2%E9%98%85%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E8%80%85%E5%92%8C%E6%B6%88%E8%B4%B9%E8%80%85%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A1%86%E6%9E%B6/">24 æœåŠ¡å‘å¸ƒä¸è®¢é˜…ï¼šæ­å»ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åŸºç¡€æ¡†æ¶</a></li>
                
                
                
                    <li>25 è¿œç¨‹é€šä¿¡ï¼šé€šä¿¡åè®®è®¾è®¡ä»¥åŠç¼–è§£ç çš„å®ç°</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/26-%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E4%B8%8E%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%BA%E5%88%B6%E7%9A%84%E5%AE%9E%E7%8E%B0/">26 æœåŠ¡æ²»ç†ï¼šæœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡æœºåˆ¶çš„å®ç°</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/27-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E4%B8%BA%E7%94%A8%E6%88%B7%E5%B1%8F%E8%94%BD-rpc-%E8%B0%83%E7%94%A8%E7%9A%84%E5%BA%95%E5%B1%82%E7%BB%86%E8%8A%82/">27 åŠ¨æ€ä»£ç†ï¼šä¸ºç”¨æˆ·å±è”½ RPC è°ƒç”¨çš„åº•å±‚ç»†èŠ‚</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/28-%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%93rpc-%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%93%E4%B8%8E%E8%BF%9B%E9%98%B6%E5%BB%B6%E4%BC%B8/">28 å®æˆ˜æ€»ç»“ï¼šRPC å®æˆ˜æ€»ç»“ä¸è¿›é˜¶å»¶ä¼¸</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/29-%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3netty-%E4%B8%AD%E5%BA%94%E7%94%A8%E4%BA%86%E5%93%AA%E4%BA%9B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">29 ç¼–ç¨‹æ€æƒ³ï¼šNetty ä¸­åº”ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/30-%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93netty-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">30 å®è·µæ€»ç»“ï¼šNetty åœ¨é¡¹ç›®å¼€å‘ä¸­çš„ä¸€äº›æœ€ä½³å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/31-%E7%BB%93%E6%9D%9F%E8%AF%AD-%E6%8A%80%E6%9C%AF%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%E5%A6%82%E4%BD%95%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E6%8A%80%E6%9C%AF%E4%BD%93%E7%B3%BB/">31 ç»“æŸè¯­ æŠ€æœ¯æˆé•¿ä¹‹è·¯ï¼šå¦‚ä½•æ‰“é€ è‡ªå·±çš„æŠ€æœ¯ä½“ç³»</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">25 è¿œç¨‹é€šä¿¡ï¼šé€šä¿¡åè®®è®¾è®¡ä»¥åŠç¼–è§£ç çš„å®ç°</h1>
        <div class="post-info">
            <div class="post-date"> 
                <span>2021-12-22 01:54:47</span>
            </div>
        </div>
        <div class="post-content">
            <p>ä¸ŠèŠ‚è¯¾æˆ‘ä»¬æ­å»ºäº†æœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…çš„åŸºæœ¬æ¡†æ¶ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸¤ä¸ªæ¨¡å—ä¹‹é—´çš„é€šä¿¡æœºåˆ¶äº†ã€‚æœ¬èŠ‚è¯¾æˆ‘ä»¬é€šè¿‡å‘ ChannelPipeline æ·»åŠ è‡ªå®šä¹‰çš„ä¸šåŠ¡å¤„ç†å™¨ï¼Œæ¥å®Œæˆ RPC æ¡†æ¶çš„è¿œç¨‹é€šä¿¡æœºåˆ¶ã€‚éœ€è¦å®ç°çš„ä¸»è¦åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<ul>
<li>æœåŠ¡æ¶ˆè´¹è€…å®ç°åè®®ç¼–ç ï¼Œå‘æœåŠ¡æä¾›è€…å‘é€è°ƒç”¨æ•°æ®ã€‚</li>
<li>æœåŠ¡æä¾›è€…æ”¶åˆ°æ•°æ®åè§£ç ï¼Œç„¶åå‘æœåŠ¡æ¶ˆè´¹è€…å‘é€å“åº”æ•°æ®ï¼Œæš‚æ—¶å¿½ç•¥ RPC è¯·æ±‚æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„ã€‚</li>
<li>æœåŠ¡æ¶ˆè´¹è€…æ”¶åˆ°å“åº”æ•°æ®åæˆåŠŸè¿”å›ã€‚</li>
</ul>
<blockquote>
<p>æºç å‚è€ƒåœ°å€ï¼š<a href="https://github.com/wangyapu/mini-rpc">mini-rpc</a></p>
</blockquote>
<h3 id="rpc-é€šä¿¡æ–¹æ¡ˆè®¾è®¡">RPC é€šä¿¡æ–¹æ¡ˆè®¾è®¡</h3>
<p>ç»“åˆæœ¬èŠ‚è¯¾çš„ç›®æ ‡ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯¹ RPC è¯·æ±‚è°ƒç”¨å’Œç»“æœå“åº”ä¸¤ä¸ªè¿‡ç¨‹åˆ†åˆ«è¿›è¡Œè¯¦ç»†æ‹†è§£åˆ†æã€‚é¦–å…ˆçœ‹ä¸‹ RPC è¯·æ±‚è°ƒç”¨çš„è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Netty%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8E%20RPC%20%E5%AE%9E%E8%B7%B5-%E5%AE%8C/assets/Cip5yF_1MaqAfz8pAAYSNNmMolY852.png" alt="Drawing 0.png"></p>
<p>RPC è¯·æ±‚çš„è¿‡ç¨‹å¯¹äºæœåŠ¡æ¶ˆè´¹è€…æ¥è¯´æ˜¯å‡ºç«™æ“ä½œï¼Œå¯¹äºæœåŠ¡æä¾›è€…æ¥è¯´æ˜¯å…¥ç«™æ“ä½œã€‚æ•°æ®å‘é€å‰ï¼ŒæœåŠ¡æ¶ˆè´¹è€…å°† RPC è¯·æ±‚ä¿¡æ¯å°è£…æˆ MiniRpcProtocol å¯¹è±¡ï¼Œç„¶åé€šè¿‡ç¼–ç å™¨ MiniRpcEncoder è¿›è¡ŒäºŒè¿›åˆ¶ç¼–ç ï¼Œæœ€åç›´æ¥å‘å‘é€è‡³è¿œç«¯å³å¯ã€‚æœåŠ¡æä¾›è€…æ”¶åˆ°è¯·æ±‚æ•°æ®åï¼Œå°†äºŒè¿›åˆ¶æ•°æ®äº¤ç»™è§£ç å™¨ MiniRpcDecoderï¼Œè§£ç åå†æ¬¡ç”Ÿæˆ MiniRpcProtocol å¯¹è±¡ï¼Œç„¶åä¼ é€’ç»™ RpcRequestHandler æ‰§è¡ŒçœŸæ­£çš„ RPC è¯·æ±‚è°ƒç”¨ã€‚</p>
<p>æˆ‘ä»¬æš‚æ—¶å¿½ç•¥ RpcRequestHandler æ˜¯å¦‚ä½•æ‰§è¡Œ RPC è¯·æ±‚è°ƒç”¨çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­åˆ†æ RpcRequestHandler å¤„ç†æˆåŠŸåæ˜¯å¦‚ä½•å‘æœåŠ¡æ¶ˆè´¹è€…è¿”å›å“åº”ç»“æœçš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Netty%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8E%20RPC%20%E5%AE%9E%E8%B7%B5-%E5%AE%8C/assets/CgqCHl_1MbKAZCUWAAX6xAhFw5k042.png" alt="Drawing 1.png"></p>
<p>ä¸ RPC è¯·æ±‚è¿‡ç¨‹ç›¸åï¼Œæ˜¯ç”±æœåŠ¡æä¾›è€…å°†å“åº”ç»“æœå°è£…æˆ MiniRpcProtocol å¯¹è±¡ï¼Œç„¶åé€šè¿‡ MiniRpcEncoder ç¼–ç å‘é€ç»™æœåŠ¡æ¶ˆè´¹è€…ã€‚æœåŠ¡æ¶ˆè´¹è€…å¯¹å“åº”ç»“æœè¿›è¡Œè§£ç ï¼Œå› ä¸º RPC è¯·æ±‚æ˜¯é«˜å¹¶å‘çš„ï¼Œæ‰€ä»¥éœ€è¦ RpcRequestHandler æ ¹æ®å“åº”ç»“æœæ‰¾åˆ°å¯¹åº”çš„è¯·æ±‚ï¼Œæœ€åå°†å“åº”ç»“æœè¿”å›ã€‚</p>
<p>ç»¼åˆ RPC è¯·æ±‚è°ƒç”¨å’Œç»“æœå“åº”çš„å¤„ç†è¿‡ç¨‹æ¥çœ‹ï¼Œç¼–ç å™¨ MiniRpcEncoderã€è§£ç å™¨ MiniRpcDecoder ä»¥åŠé€šä¿¡åè®®å¯¹è±¡ MiniRpcProtocol éƒ½å¯ä»¥è®¾è®¡æˆå¤ç”¨çš„ï¼Œæœ€ç»ˆæœåŠ¡æ¶ˆè´¹è€…å’ŒæœåŠ¡æä¾›è€…çš„ ChannelPipeline ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Netty%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8E%20RPC%20%E5%AE%9E%E8%B7%B5-%E5%AE%8C/assets/CgqCHl_1MbmAeZgjAAd9EAWpmuE609.png" alt="Drawing 2.png"></p>
<p>ç”±æ­¤å¯è§ï¼Œåœ¨å®ç° Netty ç½‘ç»œé€šä¿¡æ¨¡å—æ—¶ï¼Œå…ˆç”»å›¾åˆ†æ ChannelHandler çš„å¤„ç†æµç¨‹æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚</p>
<h3 id="è‡ªå®šä¹‰-rpc-é€šä¿¡åè®®">è‡ªå®šä¹‰ RPC é€šä¿¡åè®®</h3>
<p>åè®®æ˜¯æœåŠ¡æ¶ˆè´¹è€…å’ŒæœåŠ¡æä¾›è€…ä¹‹é—´é€šä¿¡çš„åŸºç¡€ï¼Œä¸»æµçš„ RPC æ¡†æ¶éƒ½ä¼šè‡ªå®šä¹‰é€šä¿¡åè®®ï¼Œç›¸æ¯”äº HTTPã€HTTPSã€JSON ç­‰é€šç”¨çš„åè®®ï¼Œè‡ªå®šä¹‰åè®®å¯ä»¥å®ç°æ›´å¥½çš„æ€§èƒ½ã€æ‰©å±•æ€§ä»¥åŠå®‰å…¨æ€§ã€‚åœ¨ã€Šæ¥å¤´æš—è¯­ï¼šåˆ©ç”¨ Netty å¦‚ä½•å®ç°è‡ªå®šä¹‰åè®®é€šä¿¡ã€‹è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†è®¾è®¡ä¸€ä¸ªå®Œå¤‡çš„é€šä¿¡åè®®éœ€è¦è€ƒè™‘å“ªäº›å› ç´ ï¼ŒåŒæ—¶ç»“åˆ RPC è¯·æ±‚è°ƒç”¨ä¸ç»“æœå“åº”çš„åœºæ™¯ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ RPC è‡ªå®šä¹‰åè®®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>+---------------------------------------------------------------+

| é­”æ•° 2byte | åè®®ç‰ˆæœ¬å· 1byte | åºåˆ—åŒ–ç®—æ³• 1byte | æŠ¥æ–‡ç±»å‹ 1byte  |

+---------------------------------------------------------------+

| çŠ¶æ€ 1byte |        æ¶ˆæ¯ ID 8byte     |      æ•°æ®é•¿åº¦ 4byte     |

+---------------------------------------------------------------+

|                   æ•°æ®å†…å®¹ ï¼ˆé•¿åº¦ä¸å®šï¼‰                          |

+---------------------------------------------------------------+
</code></pre><p>æˆ‘ä»¬æŠŠåè®®åˆ†ä¸ºåè®®å¤´ Header å’Œåè®®ä½“ Body ä¸¤ä¸ªéƒ¨åˆ†ã€‚åè®®å¤´ Header åŒ…å«é­”æ•°ã€åè®®ç‰ˆæœ¬å·ã€åºåˆ—åŒ–ç®—æ³•ã€æŠ¥æ–‡ç±»å‹ã€çŠ¶æ€ã€æ¶ˆæ¯ IDã€æ•°æ®é•¿åº¦ï¼Œåè®®ä½“ Body åªåŒ…å«æ•°æ®å†…å®¹éƒ¨åˆ†ï¼Œæ•°æ®å†…å®¹çš„é•¿åº¦æ˜¯ä¸å›ºå®šçš„ã€‚RPC è¯·æ±‚å’Œå“åº”éƒ½å¯ä»¥ä½¿ç”¨è¯¥åè®®è¿›è¡Œé€šä¿¡ï¼Œå¯¹åº”åè®®å®ä½“ç±»çš„å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>@Data

public class MiniRpcProtocol&lt;T&gt; implements Serializable {

    private MsgHeader header; // åè®®å¤´

    private T body; // åè®®ä½“

}

@Data

public class MsgHeader implements Serializable {

    private short magic; // é­”æ•°

    private byte version; // åè®®ç‰ˆæœ¬å·

    private byte serialization; // åºåˆ—åŒ–ç®—æ³•

    private byte msgType; // æŠ¥æ–‡ç±»å‹

    private byte status; // çŠ¶æ€

    private long requestId; // æ¶ˆæ¯ ID

    private int msgLen; // æ•°æ®é•¿åº¦

}
</code></pre><p>åœ¨ RPC è¯·æ±‚è°ƒç”¨çš„åœºæ™¯ä¸‹ï¼ŒMiniRpcProtocol ä¸­æ³›å‹ T å¯¹åº”çš„ MiniRpcRequest ç±»å‹ï¼ŒMiniRpcRequest ä¸»è¦åŒ…å« RPC è¿œç¨‹è°ƒç”¨éœ€è¦çš„å¿…è¦å‚æ•°ï¼Œå®šä¹‰å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<pre tabindex="0"><code>@Data

public class MiniRpcRequest implements Serializable {

    private String serviceVersion; // æœåŠ¡ç‰ˆæœ¬

    private String className; // æœåŠ¡æ¥å£å

    private String methodName; // æœåŠ¡æ–¹æ³•å

    private Object[] params; // æ–¹æ³•å‚æ•°åˆ—è¡¨

    private Class&lt;?&gt;[] parameterTypes; // æ–¹æ³•å‚æ•°ç±»å‹åˆ—è¡¨

}
</code></pre><p>åœ¨ RPC ç»“æœå“åº”çš„åœºæ™¯ä¸‹ï¼ŒMiniRpcProtocol ä¸­æ³›å‹ T å¯¹åº”çš„ MiniRpcResponse ç±»å‹ï¼ŒMiniRpcResponse å®ä½“ç±»çš„å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºã€‚æ­¤å¤–ï¼Œå“åº”ç»“æœæ˜¯å¦æˆåŠŸå¯ä»¥ä½¿ç”¨ MsgHeader ä¸­çš„ status å­—æ®µè¡¨ç¤ºï¼Œ0 è¡¨ç¤ºæˆåŠŸï¼Œé 0 è¡¨ç¤ºå¤±è´¥ã€‚MiniRpcResponse ä¸­ data è¡¨ç¤ºæˆåŠŸçŠ¶æ€ä¸‹è¿”å›çš„ RPC è¯·æ±‚ç»“æœï¼Œmessage è¡¨ç¤º RPC è¯·æ±‚è°ƒç”¨å¤±è´¥çš„é”™è¯¯ä¿¡æ¯ã€‚</p>
<pre tabindex="0"><code>@Data

public class MiniRpcResponse implements Serializable {

    private Object data; // è¯·æ±‚ç»“æœ

    private String message; // é”™è¯¯ä¿¡æ¯

}
</code></pre><p>è®¾è®¡å®Œ RPC è‡ªå®šä¹‰åè®®ä¹‹åï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å†æ¥è§£å†³ MiniRpcRequest å’Œ MiniRpcResponse å¦‚ä½•è¿›è¡Œç¼–ç çš„é—®é¢˜ã€‚</p>
<h3 id="åºåˆ—åŒ–é€‰å‹">åºåˆ—åŒ–é€‰å‹</h3>
<p>MiniRpcRequest å’Œ MiniRpcResponse å®ä½“ç±»è¡¨ç¤ºçš„åè®®ä½“å†…å®¹éƒ½æ˜¯ä¸ç¡®å®šå…·ä½“é•¿åº¦çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬ä¼šé€‰ç”¨é€šç”¨ä¸”é«˜æ•ˆçš„åºåˆ—åŒ–ç®—æ³•å°†å…¶è½¬æ¢æˆäºŒè¿›åˆ¶æ•°æ®ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆå‡å°‘ç½‘ç»œä¼ è¾“çš„å¸¦å®½ï¼Œæå‡ RPC æ¡†æ¶çš„æ•´ä½“æ€§èƒ½ã€‚ç›®å‰æ¯”è¾ƒå¸¸ç”¨çš„åºåˆ—åŒ–ç®—æ³•åŒ…æ‹¬ Jsonã€Kryoã€Hessianã€Protobuf ç­‰ï¼Œè¿™äº›ç¬¬ä¸‰æ–¹åºåˆ—åŒ–ç®—æ³•éƒ½æ¯” Java åŸç”Ÿçš„åºåˆ—åŒ–æ“ä½œéƒ½æ›´åŠ é«˜æ•ˆã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªé€šç”¨çš„åºåˆ—åŒ–æ¥å£ RpcSerializationï¼Œæ‰€æœ‰åºåˆ—åŒ–ç®—æ³•æ‰©å±•éƒ½å¿…é¡»å®ç°è¯¥æ¥å£ï¼ŒRpcSerialization æ¥å£åˆ†åˆ«æä¾›äº†åºåˆ—åŒ– serialize() å’Œååºåˆ—åŒ– deserialize() æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public interface RpcSerialization {

    &lt;T&gt; byte[] serialize(T obj) throws IOException;

    &lt;T&gt; T deserialize(byte[] data, Class&lt;T&gt; clz) throws IOException;

}
</code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸º RpcSerialization æä¾›äº† HessianSerialization å’Œ JsonSerialization ä¸¤ç§ç±»å‹çš„å®ç°ç±»ã€‚ä»¥ HessianSerialization ä¸ºä¾‹ï¼Œå®ç°é€»è¾‘å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>@Component

@Slf4j

public class HessianSerialization implements RpcSerialization {

    @Override

    public &lt;T&gt; byte[] serialize(T object) {

        if (object == null) {

            throw new NullPointerException();

        }

        byte[] results;

        HessianSerializerOutput hessianOutput;

        try (ByteArrayOutputStream os = new ByteArrayOutputStream()) {

            hessianOutput = new HessianSerializerOutput(os);

            hessianOutput.writeObject(object);

            hessianOutput.flush();

            results = os.toByteArray();

        } catch (Exception e) {

            throw new SerializationException(e);

        }

        return results;

    }

    @SuppressWarnings(&quot;unchecked&quot;)

    @Override

    public &lt;T&gt; T deserialize(byte[] bytes, Class&lt;T&gt; clz) {

        if (bytes == null) {

            throw new NullPointerException();

        }

        T result;

        try (ByteArrayInputStream is = new ByteArrayInputStream(bytes)) {

            HessianSerializerInput hessianInput = new HessianSerializerInput(is);

            result = (T) hessianInput.readObject(clz);

        } catch (Exception e) {

            throw new SerializationException(e);

        }

        return result;

    }

}
</code></pre><p>ä¸ºäº†èƒ½å¤Ÿæ”¯æŒä¸åŒåºåˆ—åŒ–ç®—æ³•ï¼Œæˆ‘ä»¬é‡‡ç”¨å·¥å‚æ¨¡å¼æ¥å®ç°ä¸åŒåºåˆ—åŒ–ç®—æ³•ä¹‹é—´çš„åˆ‡æ¢ï¼Œä½¿ç”¨ç›¸åŒçš„åºåˆ—åŒ–æ¥å£æŒ‡å‘ä¸åŒçš„åºåˆ—åŒ–ç®—æ³•ã€‚å¯¹äºä½¿ç”¨è€…æ¥è¯´åªéœ€è¦çŸ¥é“åºåˆ—åŒ–ç®—æ³•çš„ç±»å‹å³å¯ï¼Œä¸ç”¨å…³å¿ƒåº•å±‚åºåˆ—åŒ–æ˜¯å¦‚ä½•å®ç°çš„ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>public class SerializationFactory {

    public static RpcSerialization getRpcSerialization(byte serializationType) {

        SerializationTypeEnum typeEnum = SerializationTypeEnum.findByType(serializationType);

        switch (typeEnum) {

            case HESSIAN:

                return new HessianSerialization();

            case JSON:

                return new JsonSerialization();

            default:

                throw new IllegalArgumentException(&quot;serialization type is illegal, &quot; + serializationType);

        }

    }

}
</code></pre><p>æœ‰äº†ä»¥ä¸ŠåŸºç¡€çŸ¥è¯†çš„å‚¨å¤‡ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å®ç°è‡ªå®šä¹‰çš„å¤„ç†å™¨äº†ã€‚</p>
<h3 id="åè®®ç¼–ç å®ç°">åè®®ç¼–ç å®ç°</h3>
<p>åœ¨ã€Šæ¥å¤´æš—è¯­ï¼šåˆ©ç”¨ Netty å¦‚ä½•å®ç°è‡ªå®šä¹‰åè®®é€šä¿¡ã€‹è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬åŒæ ·ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Netty å®ç°è‡ªå®šä¹‰çš„é€šä¿¡åè®®ã€‚Netty æä¾›äº†ä¸¤ä¸ªæœ€ä¸ºå¸¸ç”¨çš„ç¼–è§£ç æŠ½è±¡åŸºç±» MessageToByteEncoder å’Œ ByteToMessageDecoderï¼Œå¸®åŠ©æˆ‘ä»¬å¾ˆæ–¹ä¾¿åœ°æ‰©å±•å®ç°è‡ªå®šä¹‰åè®®ã€‚</p>
<p>æˆ‘ä»¬æ¥ä¸‹æ¥è¦å®Œæˆçš„ç¼–ç å™¨ MiniRpcEncoder éœ€è¦ç»§æ‰¿ MessageToByteEncoderï¼Œå¹¶é‡å†™ encode() æ–¹æ³•ï¼Œå…·ä½“å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public class MiniRpcEncoder extends MessageToByteEncoder&lt;MiniRpcProtocol&lt;Object&gt;&gt; {

    @Override

    protected void encode(ChannelHandlerContext ctx, MiniRpcProtocol&lt;Object&gt; msg, ByteBuf byteBuf) throws Exception {

        MsgHeader header = msg.getHeader();

        byteBuf.writeShort(header.getMagic());

        byteBuf.writeByte(header.getVersion());

        byteBuf.writeByte(header.getSerialization());

        byteBuf.writeByte(header.getMsgType());

        byteBuf.writeByte(header.getStatus());

        byteBuf.writeLong(header.getRequestId());

        RpcSerialization rpcSerialization = SerializationFactory.getRpcSerialization(header.getSerialization());

        byte[] data = rpcSerialization.serialize(msg.getBody());

        byteBuf.writeInt(data.length);

        byteBuf.writeBytes(data);

    }

}
</code></pre><p>ç¼–ç é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œåœ¨æœåŠ¡æ¶ˆè´¹è€…æˆ–è€…æœåŠ¡æä¾›è€…è°ƒç”¨ writeAndFlush() å°†æ•°æ®å†™ç»™å¯¹æ–¹å‰ï¼Œéƒ½å·²ç»å°è£…æˆ MiniRpcRequest æˆ–è€… MiniRpcResponseï¼Œæ‰€ä»¥å¯ä»¥é‡‡ç”¨ MiniRpcProtocol<code>&lt;Object&gt;</code> ä½œä¸º MiniRpcEncoder ç¼–ç å™¨èƒ½å¤Ÿæ”¯æŒçš„ç¼–ç ç±»å‹ã€‚</p>
<h3 id="åè®®è§£ç å®ç°">åè®®è§£ç å®ç°</h3>
<p>è§£ç å™¨ MiniRpcDecoder éœ€è¦ç»§æ‰¿ ByteToMessageDecoderï¼Œå¹¶é‡å†™ decode() æ–¹æ³•ï¼Œå…·ä½“å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public class MiniRpcDecoder extends ByteToMessageDecoder {

    @Override

    public final void decode(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out) throws Exception {

        if (in.readableBytes() &lt; ProtocolConstants.HEADER_TOTAL_LEN) {

            return;

        }

        in.markReaderIndex();

        short magic = in.readShort();

        if (magic != ProtocolConstants.MAGIC) {

            throw new IllegalArgumentException(&quot;magic number is illegal, &quot; + magic);

        }

        byte version = in.readByte();

        byte serializeType = in.readByte();

        byte msgType = in.readByte();

        byte status = in.readByte();

        long requestId = in.readLong();

        int dataLength = in.readInt();

        if (in.readableBytes() &lt; dataLength) {

            in.resetReaderIndex();

            return;

        }

        byte[] data = new byte[dataLength];

        in.readBytes(data);

        MsgType msgTypeEnum = MsgType.findByType(msgType);

        if (msgTypeEnum == null) {

            return;

        }

        MsgHeader header = new MsgHeader();

        header.setMagic(magic);

        header.setVersion(version);

        header.setSerialization(serializeType);

        header.setStatus(status);

        header.setRequestId(requestId);

        header.setMsgType(msgType);

        header.setMsgLen(dataLength);

        RpcSerialization rpcSerialization = SerializationFactory.getRpcSerialization(serializeType);

        switch (msgTypeEnum) {

            case REQUEST:

                MiniRpcRequest request = rpcSerialization.deserialize(data, MiniRpcRequest.class);

                if (request != null) {

                    MiniRpcProtocol&lt;MiniRpcRequest&gt; protocol = new MiniRpcProtocol&lt;&gt;();

                    protocol.setHeader(header);

                    protocol.setBody(request);

                    out.add(protocol);

                }

            case RESPONSE:

                MiniRpcResponse response = rpcSerialization.deserialize(data, MiniRpcResponse.class);

                if (response != null) {

                    MiniRpcProtocol&lt;MiniRpcResponse&gt; protocol = new MiniRpcProtocol&lt;&gt;();

                    protocol.setHeader(header);

                    protocol.setBody(response);

                    out.add(protocol);

                }

            case HEARTBEAT:

                // TODO

                break;

        }

    }

}
</code></pre><p>è§£ç å™¨ MiniRpcDecoder ç›¸æ¯”äºç¼–ç å™¨ MiniRpcEncoder è¦å¤æ‚å¾ˆå¤šï¼ŒMiniRpcDecoder çš„ç›®æ ‡æ˜¯å°†å­—èŠ‚æµæ•°æ®è§£ç ä¸ºæ¶ˆæ¯å¯¹è±¡ï¼Œå¹¶ä¼ é€’ç»™ä¸‹ä¸€ä¸ª Inbound å¤„ç†å™¨ã€‚æ•´ä¸ª MiniRpcDecoder è§£ç è¿‡ç¨‹æœ‰å‡ ä¸ªè¦ç‚¹è¦ç‰¹åˆ«æ³¨æ„ï¼š</p>
<ul>
<li>åªæœ‰å½“ ByteBuf ä¸­å†…å®¹å¤§äºåè®®å¤´ Header çš„å›ºå®šçš„ 18 å­—èŠ‚æ—¶ï¼Œæ‰å¼€å§‹è¯»å–æ•°æ®ã€‚</li>
<li>å³ä½¿å·²ç»å¯ä»¥å®Œæ•´è¯»å–å‡ºåè®®å¤´ Headerï¼Œä½†æ˜¯åè®®ä½“ Body æœ‰å¯èƒ½è¿˜æœªå°±ç»ªã€‚æ‰€ä»¥åœ¨åˆšå¼€å§‹è¯»å–æ•°æ®æ—¶ï¼Œéœ€è¦ä½¿ç”¨ markReaderIndex() æ–¹æ³•æ ‡è®°è¯»æŒ‡é’ˆä½ç½®ï¼Œå½“ ByteBuf ä¸­å¯è¯»å­—èŠ‚é•¿åº¦å°äºåè®®ä½“ Body çš„é•¿åº¦æ—¶ï¼Œå†ä½¿ç”¨ resetReaderIndex() è¿˜åŸè¯»æŒ‡é’ˆä½ç½®ï¼Œè¯´æ˜ç°åœ¨ ByteBuf ä¸­å¯è¯»å­—èŠ‚è¿˜ä¸å¤Ÿä¸€ä¸ªå®Œæ•´çš„æ•°æ®åŒ…ã€‚</li>
<li>æ ¹æ®ä¸åŒçš„æŠ¥æ–‡ç±»å‹ MsgTypeï¼Œéœ€è¦ååºåˆ—åŒ–å‡ºä¸åŒçš„åè®®ä½“å¯¹è±¡ã€‚åœ¨ RPC è¯·æ±‚è°ƒç”¨çš„åœºæ™¯ä¸‹ï¼ŒæœåŠ¡æä¾›è€…éœ€è¦å°†åè®®ä½“å†…å®¹ååºåˆ—åŒ–æˆ MiniRpcRequest å¯¹è±¡ï¼›åœ¨ RPC ç»“æœå“åº”çš„åœºæ™¯ä¸‹ï¼ŒæœåŠ¡æ¶ˆè´¹è€…éœ€è¦å°†åè®®ä½“å†…å®¹ååºåˆ—åŒ–æˆ MiniRpcResponse å¯¹è±¡ã€‚</li>
</ul>
<h3 id="è¯·æ±‚å¤„ç†ä¸å“åº”">è¯·æ±‚å¤„ç†ä¸å“åº”</h3>
<p>åœ¨ RPC è¯·æ±‚è°ƒç”¨çš„åœºæ™¯ä¸‹ï¼ŒæœåŠ¡æä¾›è€…çš„ MiniRpcDecoder ç¼–ç å™¨å°†äºŒè¿›åˆ¶æ•°æ®è§£ç æˆ MiniRpcProtocol<code>&lt;MiniRpcRequest&gt;</code> å¯¹è±¡åï¼Œå†ä¼ é€’ç»™ RpcRequestHandler æ‰§è¡Œ RPC è¯·æ±‚è°ƒç”¨ã€‚RpcRequestHandler ä¹Ÿæ˜¯ä¸€ä¸ª Inbound å¤„ç†å™¨ï¼Œå®ƒå¹¶ä¸éœ€è¦æ‰¿æ‹…è§£ç å·¥ä½œï¼Œæ‰€ä»¥ RpcRequestHandler ç›´æ¥ç»§æ‰¿ SimpleChannelInboundHandler å³å¯ï¼Œç„¶åé‡å†™ channelRead0() æ–¹æ³•ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>@Slf4j

public class RpcRequestHandler extends SimpleChannelInboundHandler&lt;MiniRpcProtocol&lt;MiniRpcRequest&gt;&gt; {

    private final Map&lt;String, Object&gt; rpcServiceMap;

    public RpcRequestHandler(Map&lt;String, Object&gt; rpcServiceMap) {

        this.rpcServiceMap = rpcServiceMap;

    }

    @Override

    protected void channelRead0(ChannelHandlerContext ctx, MiniRpcProtocol&lt;MiniRpcRequest&gt; protocol) {

        RpcRequestProcessor.submitRequest(() -&gt; {

            MiniRpcProtocol&lt;MiniRpcResponse&gt; resProtocol = new MiniRpcProtocol&lt;&gt;();

            MiniRpcResponse response = new MiniRpcResponse();

            MsgHeader header = protocol.getHeader();

            header.setMsgType((byte) MsgType.RESPONSE.getType());

            try {

                Object result = handle(protocol.getBody()); // TODO è°ƒç”¨ RPC æœåŠ¡

                response.setData(result);

                header.setStatus((byte) MsgStatus.SUCCESS.getCode());

                resProtocol.setHeader(header);

                resProtocol.setBody(response);

            } catch (Throwable throwable) {

                header.setStatus((byte) MsgStatus.FAIL.getCode());

                response.setMessage(throwable.toString());

                log.error(&quot;process request {} error&quot;, header.getRequestId(), throwable);

            }

            ctx.writeAndFlush(resProtocol);

        });

    }

}
</code></pre><p>å› ä¸º RPC è¯·æ±‚è°ƒç”¨æ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œæ‰€ä»¥æ¯”è¾ƒæ¨èçš„åšæ³•æ˜¯å°† RPC è¯·æ±‚æäº¤åˆ°è‡ªå®šä¹‰çš„ä¸šåŠ¡çº¿ç¨‹æ± ä¸­æ‰§è¡Œã€‚å…¶ä¸­ handle() æ–¹æ³•æ˜¯çœŸæ­£æ‰§è¡Œ RPC è°ƒç”¨çš„åœ°æ–¹ï¼Œä½ å¯ä»¥å…ˆç•™ä¸€ä¸ªç©ºçš„å®ç°ï¼Œåœ¨ä¹‹ååŠ¨æ€ä»£ç†çš„è¯¾ç¨‹ä¸­æˆ‘ä»¬å†å®Œæˆå®ƒã€‚æ ¹æ® handle() çš„æ‰§è¡Œæƒ…å†µï¼ŒMiniRpcProtocol<code>&lt;MiniRpcResponse&gt;</code> æœ€ç»ˆä¼šè¢«è®¾ç½®æˆåŠŸæˆ–è€…å¤±è´¥çš„çŠ¶æ€ï¼Œä»¥åŠç›¸åº”çš„è¯·æ±‚ç»“æœæˆ–è€…é”™è¯¯ä¿¡æ¯ï¼Œæœ€ç»ˆé€šè¿‡ writeAndFlush() æ–¹æ³•å°†æ•°æ®å†™å›æœåŠ¡æ¶ˆè´¹è€…ã€‚</p>
<p>ä¸Šæ–‡ä¸­æˆ‘ä»¬å·²ç»åˆ†æäº†æœåŠ¡æ¶ˆè´¹è€…å…¥ç«™æ“ä½œï¼Œé¦–å…ˆè¦ç»è¿‡ MiniRpcDecoder è§£ç å™¨ï¼Œæ ¹æ®æŠ¥æ–‡ç±»å‹ msgType è§£ç å‡º MiniRpcProtocol<code>&lt;MiniRpcResponse&gt;</code> å“åº”ç»“æœï¼Œç„¶åä¼ é€’ç»™ RpcResponseHandler å¤„ç†å™¨ï¼ŒRpcResponseHandler è´Ÿè´£å“åº”ä¸åŒçº¿ç¨‹çš„è¯·æ±‚ç»“æœï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>public class RpcResponseHandler extends SimpleChannelInboundHandler&lt;MiniRpcProtocol&lt;MiniRpcResponse&gt;&gt; {

    @Override

    protected void channelRead0(ChannelHandlerContext ctx, MiniRpcProtocol&lt;MiniRpcResponse&gt; msg) {

        long requestId = msg.getHeader().getRequestId();

        MiniRpcFuture&lt;MiniRpcResponse&gt; future = MiniRpcRequestHolder.REQUEST_MAP.remove(requestId);

        future.getPromise().setSuccess(msg.getBody());

    }

}

public class MiniRpcRequestHolder {

    public final static AtomicLong REQUEST_ID_GEN = new AtomicLong(0);

    public static final Map&lt;Long, MiniRpcFuture&lt;MiniRpcResponse&gt;&gt; REQUEST_MAP = new ConcurrentHashMap&lt;&gt;();

}

@Data

public class MiniRpcFuture&lt;T&gt; {

    private Promise&lt;T&gt; promise;

    private long timeout;

    public MiniRpcFuture(Promise&lt;T&gt; promise, long timeout) {

        this.promise = promise;

        this.timeout = timeout;

    }

}
</code></pre><p>æœåŠ¡æ¶ˆè´¹è€…åœ¨å‘èµ·è°ƒç”¨æ—¶ï¼Œç»´æŠ¤äº†è¯·æ±‚ requestId å’Œ MiniRpcFuture<code>&lt;MiniRpcResponse&gt;</code> çš„æ˜ å°„å…³ç³»ï¼ŒRpcResponseHandler ä¼šæ ¹æ®è¯·æ±‚çš„ requestId æ‰¾åˆ°å¯¹åº”å‘èµ·è°ƒç”¨çš„ MiniRpcFutureï¼Œç„¶åä¸º MiniRpcFuture è®¾ç½®å“åº”ç»“æœã€‚</p>
<p>æˆ‘ä»¬é‡‡ç”¨ Netty æä¾›çš„ Promise å·¥å…·æ¥å®ç° RPC è¯·æ±‚çš„åŒæ­¥ç­‰å¾…ï¼ŒPromise åŸºäº JDK çš„ Future æ‰©å±•äº†æ›´å¤šæ–°çš„ç‰¹æ€§ï¼Œå¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ä»¥åŒæ­¥çš„æ–¹å¼è¿›è¡Œå¼‚æ­¥ç¼–ç¨‹ã€‚Promise æ¨¡å¼æœ¬è´¨æ˜¯ä¸€ç§å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ‹¿åˆ°ä¸€ä¸ªæŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œç»“æœçš„å‡­è¯ï¼Œä¸å¿…ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå½“æˆ‘ä»¬éœ€è¦è·å–ä»»åŠ¡æ‰§è¡Œç»“æœæ—¶ï¼Œå†ä½¿ç”¨å‡­è¯æä¾›çš„ç›¸å…³æ¥å£è¿›è¡Œè·å–ã€‚</p>
<p>è‡³æ­¤ï¼ŒRPC æ¡†æ¶çš„é€šä¿¡æ¨¡å—æˆ‘ä»¬å·²ç»å®ç°å®Œäº†ã€‚è‡ªå®šä¹‰åè®®ã€ç¼–è§£ç ã€åºåˆ—åŒ–/ååºåˆ—åŒ–éƒ½æ˜¯å®ç°è¿œç¨‹é€šä¿¡çš„å¿…å¤‡åŸºç¡€çŸ¥è¯†ï¼Œæˆ‘ä»¬åŠ¡å¿…è¦ç†Ÿç»ƒæŒæ¡ã€‚æ­¤å¤–åœ¨ã€Šæ¶æ„è®¾è®¡ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªé«˜æ€§èƒ½åˆ†å¸ƒå¼ RPC æ¡†æ¶ã€‹è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† RPC è°ƒç”¨çš„å¤šç§æ–¹å¼ï¼Œå¿«å¼€åŠ¨ä½ çš„å¤§è„‘ï¼Œæƒ³æƒ³å…¶ä»–æ–¹å¼åº”å½“å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>æœ¬èŠ‚è¯¾æˆ‘ä»¬é€šè¿‡ RPC è‡ªå®šä¹‰åè®®çš„è®¾è®¡ä¸å®ç°ï¼ŒåŠ æ·±äº†å¯¹ Netty è‡ªå®šä¹‰å¤„ç†å™¨ ChannelHandler çš„ç†è§£ã€‚ChannelPipeline å’Œ ChannelHandler æ˜¯æˆ‘ä»¬åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­æ‰“äº¤é“æœ€å¤šçš„ç»„ä»¶ï¼Œåœ¨è®¾è®¡ä¹‹åˆä¸€å®šè¦æ¢³ç†æ¸…æ¥š Inbound å’Œ Outbound å¤„ç†çš„ä¼ é€’é¡ºåºï¼Œä»¥åŠæ•°æ®æ¨¡å‹ä¹‹é—´æ˜¯å¦‚ä½•è½¬æ¢çš„ã€‚</p>
<p>ç•™ä¸¤ä¸ªè¯¾åä»»åŠ¡ï¼š</p>
<ol>
<li>Protobuf åºåˆ—åŒ–ç®—æ³•ä¹Ÿæ˜¯æˆ‘ä»¬å¿…å¤‡çš„æŠ€èƒ½ï¼Œåœ¨æœ¬è¯¾ç¨‹ä¸­å¹¶æœªå®ç°ï¼Œéœ€è¦ä½ æŒ‰ç…§æ¥å£è§„èŒƒè¿›è¡Œæ‰©å±•ã€‚</li>
<li>å¦‚æœå¸Œæœ›å¯¹åè®®ä½“çš„å†…å®¹è¿›è¡Œå‹ç¼©ï¼Œé‚£ä¹ˆ RPC è‡ªå®šä¹‰åè®®åº”è¯¥å¦‚ä½•æ”¹è¿›å‘¢ï¼Ÿç¼–è§£ç å™¨åˆè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ</li>
</ol>

        </div>
    </article>
</div>
<div class="division-line"></div>
<div class="others">
    <div>æ ‡ç­¾ï¼šğŸ·ï¸<a class="post-tag" href="/tags/netty/">netty</a>&nbsp;</div>
    <div>åˆ†ç±»ï¼š ğŸ“’<a class="post-category" href="/categories/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/">Nettyæ ¸å¿ƒåŸç†å‰–æä¸RPCå®è·µ</a>&nbsp; </div>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/24-%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E4%B8%8E%E8%AE%A2%E9%98%85%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E8%80%85%E5%92%8C%E6%B6%88%E8%B4%B9%E8%80%85%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A1%86%E6%9E%B6/"><span>24 æœåŠ¡å‘å¸ƒä¸è®¢é˜…ï¼šæ­å»ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åŸºç¡€æ¡†æ¶</span></a>
    </div>
    <div class="next">
        
        <a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/26-%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E4%B8%8E%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%BA%E5%88%B6%E7%9A%84%E5%AE%9E%E7%8E%B0/"><span>26 æœåŠ¡æ²»ç†ï¼šæœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡æœºåˆ¶çš„å®ç°</span></a>
    </div>
</div>

        </div>
        <div id="float">
            <ul class="float-button-bar">
    <li>
        <button class="float-button top" onclick="scrollToTop(this);">UP</button>
    </li>
    <li>
        <button class="float-button toggler" onclick="changeSkin(this);">DARK</button>
    </li>
</ul>
        </div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 2020 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    const changeSkin = () => {
        document.getElementById('page').classList.toggle('night');
    }
    const scrollToTop = () => {
        window.scrollTo(0, 0);
    }
</script>
</body>

</html>