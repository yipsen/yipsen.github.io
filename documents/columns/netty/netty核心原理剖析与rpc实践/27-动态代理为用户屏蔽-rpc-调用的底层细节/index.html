<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>27 åŠ¨æ€ä»£ç†ï¼šä¸ºç”¨æˆ·å±è”½ RPC è°ƒç”¨çš„åº•å±‚ç»†èŠ‚ | Yipsen Ye</title>
<meta name="description" content="åŠ¨æ€ä»£ç†åœ¨ RPC æ¡†æ¶çš„å®ç°ä¸­èµ·åˆ°äº†è‡³å…³é‡è¦çš„ä½œç”¨ï¼Œå®ƒå¯ä»¥å¸®åŠ©ç”¨æˆ·å±è”½ RPC è°ƒç”¨æ—¶åº•å±‚ç½‘ç»œé€šä¿¡ã€æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ç­‰å…·ä½“ç»†èŠ‚ï¼Œè¿™äº›å¯¹ç”¨æˆ·æ¥è¯´å¹¶æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚ä½ åœ¨å¹³æ—¶é¡¹ç›®å¼€å‘ä¸­ä½¿ç”¨ RPC æ¡†æ¶çš„æ—¶å€™ï¼Œåªéœ€è¦è°ƒç”¨æ¥å£æ–¹æ³•ï¼Œç„¶åå°±æ‹¿åˆ°äº†è¿”å›ç»“æœï¼Œä½ æ˜¯å¦å¥½å¥‡ RPC æ¡†æ¶æ˜¯å¦‚ä½•å®Œæˆæ•´ä¸ªè°ƒç”¨æµç¨‹çš„å‘¢ï¼Ÿä»Šå¤©è¿™èŠ‚è¯¾æˆ‘ä»¬å°±ä¸€èµ·æ¥å®Œæˆ RPC æ¡†æ¶çš„æœ€åä¸€éƒ¨åˆ†å†…å®¹ï¼šRPC è¯·æ±‚è°ƒç”¨å’Œå¤„ç†ï¼Œçœ‹çœ‹å¦‚ä½•ä½¿ç”¨åŠ¨æ€ä»£ç†æœºåˆ¶å®Œæˆè¿™ä¸ªç¥å¥‡çš„æ“ä½œã€‚
 æºç å‚è€ƒåœ°å€ï¼šmini-rpc
 åŠ¨æ€ä»£ç†åŸºç¡€ ä¸ºä»€ä¹ˆéœ€è¦ä»£ç†æ¨¡å¼å‘¢ï¼Ÿä»£ç†æ¨¡å¼çš„ä¼˜åŠ¿æ˜¯å¯ä»¥å¾ˆå¥½åœ°éµå¾ªè®¾è®¡æ¨¡å¼ä¸­çš„å¼€æ”¾å°é—­åŸåˆ™ï¼Œå¯¹æ‰©å±•å¼€å‘ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚ä½ ä¸éœ€è¦å…³æ³¨ç›®æ ‡ç±»çš„å®ç°ç»†èŠ‚ï¼Œé€šè¿‡ä»£ç†æ¨¡å¼å¯ä»¥åœ¨ä¸ä¿®æ”¹ç›®æ ‡ç±»çš„æƒ…å†µä¸‹ï¼Œå¢å¼ºç›®æ ‡ç±»åŠŸèƒ½çš„è¡Œä¸ºã€‚Spring AOP æ˜¯ Java åŠ¨æ€ä»£ç†æœºåˆ¶çš„ç»å…¸è¿ç”¨ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®å¼€å‘ä¸­ç»å¸¸ä½¿ç”¨ AOP æŠ€æœ¯å®Œæˆä¸€äº›åˆ‡é¢æœåŠ¡ï¼Œå¦‚è€—æ—¶ç›‘æ§ã€äº‹åŠ¡ç®¡ç†ã€æƒé™æ ¡éªŒç­‰ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯é€šè¿‡åˆ‡é¢æ‰©å±•å®ç°çš„ï¼Œä¸éœ€è¦å¯¹æºä»£ç æœ‰æ‰€ä¾µå…¥ã€‚
åŠ¨æ€ä»£ç†æ˜¯ä¸€ç§ä»£ç†æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶åŠ¨æ€æ„å»ºä»£ç†ç±»ä»¥åŠåŠ¨æ€è°ƒç”¨ç›®æ ‡æ–¹æ³•çš„æœºåˆ¶ã€‚ä¸ºä»€ä¹ˆç§°ä¸ºåŠ¨æ€æ˜¯å› ä¸ºä»£ç†ç±»å’Œè¢«ä»£ç†å¯¹è±¡çš„å…³ç³»æ˜¯åœ¨è¿è¡Œæ—¶å†³å®šçš„ï¼Œä»£ç†ç±»å¯ä»¥çœ‹ä½œæ˜¯å¯¹è¢«ä»£ç†å¯¹è±¡çš„åŒ…è£…ï¼Œå¯¹ç›®æ ‡æ–¹æ³•çš„è°ƒç”¨æ˜¯é€šè¿‡ä»£ç†ç±»æ¥å®Œæˆçš„ã€‚æ‰€ä»¥é€šè¿‡ä»£ç†æ¨¡å¼å¯ä»¥æœ‰æ•ˆåœ°å°†æœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…è¿›è¡Œè§£è€¦ï¼Œéšè—äº† RPC è°ƒç”¨çš„å…·ä½“ç»†èŠ‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚
æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·æ¢è®¨ä¸‹åŠ¨æ€ä»£ç†çš„å®ç°åŸç†ï¼Œä»¥åŠå¸¸ç”¨çš„ JDK åŠ¨æ€ä»£ç†ã€Cglib åŠ¨æ€ä»£ç†æ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚
JDK åŠ¨æ€ä»£ç† JDK åŠ¨æ€ä»£ç†å®ç°ä¾èµ– java.lang.reflect åŒ…ä¸­çš„ä¸¤ä¸ªæ ¸å¿ƒç±»ï¼šInvocationHandler æ¥å£å’ŒProxy ç±»ã€‚
 InvocationHandler æ¥å£  JDK åŠ¨æ€ä»£ç†æ‰€ä»£ç†çš„å¯¹è±¡å¿…é¡»å®ç°ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ¥å£ï¼Œç”Ÿæˆçš„ä»£ç†ç±»ä¹Ÿæ˜¯æ¥å£çš„å®ç°ç±»ï¼Œç„¶åé€šè¿‡ JDK åŠ¨æ€ä»£ç†æ˜¯é€šè¿‡åå°„è°ƒç”¨çš„æ–¹å¼ä»£ç†ç±»ä¸­çš„æ–¹æ³•ï¼Œä¸èƒ½ä»£ç†æ¥å£ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•ã€‚æ¯ä¸€ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡å¿…é¡»æä¾› InvocationHandler æ¥å£çš„å®ç°ç±»ï¼ŒInvocationHandler æ¥å£ä¸­åªæœ‰ä¸€ä¸ª invoke() æ–¹æ³•ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ä»£ç†å¯¹è±¡è°ƒç”¨æŸä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«è½¬å‘åˆ° invoke() æ–¹æ³•æ‰§è¡Œå…·ä½“çš„é€»è¾‘ã€‚invoke() æ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ï¼š
public interface InvocationHandler {public Object invoke(Object proxy, Method method, Object[] args) throws Throwable;}å…¶ä¸­ proxy å‚æ•°è¡¨ç¤ºéœ€è¦ä»£ç†çš„å¯¹è±¡ï¼Œmethod å‚æ•°è¡¨ç¤ºä»£ç†å¯¹è±¡è¢«è°ƒç”¨çš„æ–¹æ³•ï¼Œargs å‚æ•°ä¸ºè¢«è°ƒç”¨æ–¹æ³•æ‰€éœ€çš„å‚æ•°ã€‚">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/netty%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86%e5%89%96%e6%9e%90%e4%b8%8erpc%e5%ae%9e%e8%b7%b5/">Nettyæ ¸å¿ƒåŸç†å‰–æä¸RPCå®è·µ</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/00-%E5%AD%A6%E5%A5%BD-netty%E6%98%AF%E4%BD%A0%E4%BF%AE%E7%82%BC-java-%E5%86%85%E5%8A%9F%E7%9A%84%E5%BF%85%E7%BB%8F%E4%B9%8B%E8%B7%AF/">00 å­¦å¥½ Nettyï¼Œæ˜¯ä½ ä¿®ç‚¼ Java å†…åŠŸçš„å¿…ç»ä¹‹è·¯</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/01-%E5%88%9D%E8%AF%86-netty%E4%B8%BA%E4%BB%80%E4%B9%88-netty-%E8%BF%99%E4%B9%88%E6%B5%81%E8%A1%8C/">01 åˆè¯† Nettyï¼šä¸ºä»€ä¹ˆ Netty è¿™ä¹ˆæµè¡Œï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/02-%E7%BA%B5%E8%A7%88%E5%85%A8%E5%B1%80%E6%8A%8A%E6%8F%A1-netty-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E8%84%89%E7%BB%9C/">02 çºµè§ˆå…¨å±€ï¼šæŠŠæ¡ Netty æ•´ä½“æ¶æ„è„‰ç»œ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/03-%E5%BC%95%E5%AF%BC%E5%99%A8%E4%BD%9C%E7%94%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%90%AF%E5%8A%A8%E9%83%BD%E8%A6%81%E5%81%9A%E4%BA%9B%E4%BB%80%E4%B9%88/">03 å¼•å¯¼å™¨ä½œç”¨ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯åŠ¨éƒ½è¦åšäº›ä»€ä¹ˆï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/04-%E4%BA%8B%E4%BB%B6%E8%B0%83%E5%BA%A6%E5%B1%82%E4%B8%BA%E4%BB%80%E4%B9%88-eventloop-%E6%98%AF-netty-%E7%9A%84%E7%B2%BE%E9%AB%93/">04 äº‹ä»¶è°ƒåº¦å±‚ï¼šä¸ºä»€ä¹ˆ EventLoop æ˜¯ Netty çš„ç²¾é«“ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/05-%E6%9C%8D%E5%8A%A1%E7%BC%96%E6%8E%92%E5%B1%82pipeline-%E5%A6%82%E4%BD%95%E5%8D%8F%E8%B0%83%E5%90%84%E7%B1%BB-handler-/">05 æœåŠ¡ç¼–æ’å±‚ï¼šPipeline å¦‚ä½•åè°ƒå„ç±» Handler ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/06-%E7%B2%98%E5%8C%85%E6%8B%86%E5%8C%85%E9%97%AE%E9%A2%98%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E7%9A%84%E7%BD%91%E7%BB%9C%E5%8C%85/">06 ç²˜åŒ…æ‹†åŒ…é—®é¢˜ï¼šå¦‚ä½•è·å–ä¸€ä¸ªå®Œæ•´çš„ç½‘ç»œåŒ…ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/07-%E6%8E%A5%E5%A4%B4%E6%9A%97%E8%AF%AD%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8-netty-%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%8F%E8%AE%AE%E9%80%9A%E4%BF%A1/">07 æ¥å¤´æš—è¯­ï¼šå¦‚ä½•åˆ©ç”¨ Netty å®ç°è‡ªå®šä¹‰åè®®é€šä¿¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/08-%E5%BC%80%E7%AE%B1%E5%8D%B3%E7%94%A8netty-%E6%94%AF%E6%8C%81%E5%93%AA%E4%BA%9B%E5%B8%B8%E7%94%A8%E7%9A%84%E8%A7%A3%E7%A0%81%E5%99%A8/">08 å¼€ç®±å³ç”¨ï¼šNetty æ”¯æŒå“ªäº›å¸¸ç”¨çš„è§£ç å™¨ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/09-%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93writeandflush-%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%E5%89%96%E6%9E%90/">09 æ•°æ®ä¼ è¾“ï¼šwriteAndFlush å¤„ç†æµç¨‹å‰–æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/10-%E5%8F%8C%E5%88%83%E5%89%91%E5%90%88%E7%90%86%E7%AE%A1%E7%90%86-netty-%E5%A0%86%E5%A4%96%E5%86%85%E5%AD%98/">10 åŒåˆƒå‰‘ï¼šåˆç†ç®¡ç† Netty å †å¤–å†…å­˜</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/11-%E5%8F%A6%E8%B5%B7%E7%82%89%E7%81%B6netty-%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E8%BD%BD%E4%BD%93-bytebuf-%E8%AF%A6%E8%A7%A3/">11 å¦èµ·ç‚‰ç¶ï¼šNetty æ•°æ®ä¼ è¾“è½½ä½“ ByteBuf è¯¦è§£</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/12-%E4%BB%96%E5%B1%B1%E4%B9%8B%E7%9F%B3%E9%AB%98%E6%80%A7%E8%83%BD%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E5%99%A8-jemalloc-%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/">12 ä»–å±±ä¹‹çŸ³ï¼šé«˜æ€§èƒ½å†…å­˜åˆ†é…å™¨ jemalloc åŸºæœ¬åŸç†</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/13-%E4%B8%BE%E4%B8%80%E5%8F%8D%E4%B8%89netty-%E9%AB%98%E6%80%A7%E8%83%BD%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E8%AE%BE%E8%AE%A1%E4%B8%8A/">13 ä¸¾ä¸€åä¸‰ï¼šNetty é«˜æ€§èƒ½å†…å­˜ç®¡ç†è®¾è®¡ï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/14-%E4%B8%BE%E4%B8%80%E5%8F%8D%E4%B8%89netty-%E9%AB%98%E6%80%A7%E8%83%BD%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E8%AE%BE%E8%AE%A1%E4%B8%8B/">14 ä¸¾ä¸€åä¸‰ï¼šNetty é«˜æ€§èƒ½å†…å­˜ç®¡ç†è®¾è®¡ï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/15-%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%AF%B9%E8%B1%A1%E5%9B%9E%E6%94%B6%E7%AB%99recycler-%E5%AF%B9%E8%B1%A1%E6%B1%A0%E6%8A%80%E6%9C%AF%E8%A7%A3%E6%9E%90/">15 è½»é‡çº§å¯¹è±¡å›æ”¶ç«™ï¼šRecycler å¯¹è±¡æ± æŠ€æœ¯è§£æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/16-io-%E5%8A%A0%E9%80%9F%E4%B8%8E%E4%BC%97%E4%B8%8D%E5%90%8C%E7%9A%84-netty-%E9%9B%B6%E6%8B%B7%E8%B4%9D%E6%8A%80%E6%9C%AF/">16 IO åŠ é€Ÿï¼šä¸ä¼—ä¸åŒçš„ Netty é›¶æ‹·è´æŠ€æœ¯</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/17-%E6%BA%90%E7%A0%81%E7%AF%87%E4%BB%8E-linux-%E5%87%BA%E5%8F%91%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/">17 æºç ç¯‡ï¼šä» Linux å‡ºå‘æ·±å…¥å‰–ææœåŠ¡ç«¯å¯åŠ¨æµç¨‹</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/18-%E6%BA%90%E7%A0%81%E7%AF%87%E8%A7%A3%E5%AF%86-netty-reactor-%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/">18 æºç ç¯‡ï¼šè§£å¯† Netty Reactor çº¿ç¨‹æ¨¡å‹</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/19-%E6%BA%90%E7%A0%81%E7%AF%87%E4%B8%80%E4%B8%AA%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%9C%A8-netty-%E4%B8%AD%E7%9A%84%E6%97%85%E7%A8%8B/">19 æºç ç¯‡ï¼šä¸€ä¸ªç½‘ç»œè¯·æ±‚åœ¨ Netty ä¸­çš„æ—…ç¨‹</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/20-%E6%8A%80%E5%B7%A7%E7%AF%87netty-%E7%9A%84-fastthreadlocal-%E7%A9%B6%E7%AB%9F%E6%AF%94-threadlocal-%E5%BF%AB%E5%9C%A8%E5%93%AA%E5%84%BF/">20 æŠ€å·§ç¯‡ï¼šNetty çš„ FastThreadLocal ç©¶ç«Ÿæ¯” ThreadLocal å¿«åœ¨å“ªå„¿ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/21-%E6%8A%80%E5%B7%A7%E7%AF%87%E5%BB%B6%E8%BF%9F%E4%BB%BB%E5%8A%A1%E5%A4%84%E7%90%86%E7%A5%9E%E5%99%A8%E4%B9%8B%E6%97%B6%E9%97%B4%E8%BD%AE-hashedwheeltimer/">21 æŠ€å·§ç¯‡ï¼šå»¶è¿Ÿä»»åŠ¡å¤„ç†ç¥å™¨ä¹‹æ—¶é—´è½® HashedWheelTimer</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/22-%E6%8A%80%E5%B7%A7%E7%AF%87%E9%AB%98%E6%80%A7%E8%83%BD%E6%97%A0%E9%94%81%E9%98%9F%E5%88%97-mpsc-queue/">22 æŠ€å·§ç¯‡ï¼šé«˜æ€§èƒ½æ— é”é˜Ÿåˆ— Mpsc Queue</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/23-%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%AB%98%E6%80%A7%E8%83%BD%E5%88%86%E5%B8%83%E5%BC%8F-rpc-%E6%A1%86%E6%9E%B6/">23 æ¶æ„è®¾è®¡ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªé«˜æ€§èƒ½åˆ†å¸ƒå¼ RPC æ¡†æ¶</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/24-%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E4%B8%8E%E8%AE%A2%E9%98%85%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E8%80%85%E5%92%8C%E6%B6%88%E8%B4%B9%E8%80%85%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A1%86%E6%9E%B6/">24 æœåŠ¡å‘å¸ƒä¸è®¢é˜…ï¼šæ­å»ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åŸºç¡€æ¡†æ¶</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/25-%E8%BF%9C%E7%A8%8B%E9%80%9A%E4%BF%A1%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE%E8%AE%BE%E8%AE%A1%E4%BB%A5%E5%8F%8A%E7%BC%96%E8%A7%A3%E7%A0%81%E7%9A%84%E5%AE%9E%E7%8E%B0/">25 è¿œç¨‹é€šä¿¡ï¼šé€šä¿¡åè®®è®¾è®¡ä»¥åŠç¼–è§£ç çš„å®ç°</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/26-%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E4%B8%8E%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%BA%E5%88%B6%E7%9A%84%E5%AE%9E%E7%8E%B0/">26 æœåŠ¡æ²»ç†ï¼šæœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡æœºåˆ¶çš„å®ç°</a></li>
                
                
                
                    <li>27 åŠ¨æ€ä»£ç†ï¼šä¸ºç”¨æˆ·å±è”½ RPC è°ƒç”¨çš„åº•å±‚ç»†èŠ‚</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/28-%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%93rpc-%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%93%E4%B8%8E%E8%BF%9B%E9%98%B6%E5%BB%B6%E4%BC%B8/">28 å®æˆ˜æ€»ç»“ï¼šRPC å®æˆ˜æ€»ç»“ä¸è¿›é˜¶å»¶ä¼¸</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/29-%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3netty-%E4%B8%AD%E5%BA%94%E7%94%A8%E4%BA%86%E5%93%AA%E4%BA%9B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">29 ç¼–ç¨‹æ€æƒ³ï¼šNetty ä¸­åº”ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/30-%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93netty-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">30 å®è·µæ€»ç»“ï¼šNetty åœ¨é¡¹ç›®å¼€å‘ä¸­çš„ä¸€äº›æœ€ä½³å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/31-%E7%BB%93%E6%9D%9F%E8%AF%AD-%E6%8A%80%E6%9C%AF%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%E5%A6%82%E4%BD%95%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E6%8A%80%E6%9C%AF%E4%BD%93%E7%B3%BB/">31 ç»“æŸè¯­ æŠ€æœ¯æˆé•¿ä¹‹è·¯ï¼šå¦‚ä½•æ‰“é€ è‡ªå·±çš„æŠ€æœ¯ä½“ç³»</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">27 åŠ¨æ€ä»£ç†ï¼šä¸ºç”¨æˆ·å±è”½ RPC è°ƒç”¨çš„åº•å±‚ç»†èŠ‚</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2021-12-22 01:54:49</span>ğŸ·ï¸&nbsp;<a class="post-tag" href="/tags/netty/">netty</a></div><div class="post-category">
                
                ğŸ“š&nbsp;<a href="/categories/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/">Nettyæ ¸å¿ƒåŸç†å‰–æä¸RPCå®è·µ</a>
                
            </div></div>
        <div class="post-content">
            <p>åŠ¨æ€ä»£ç†åœ¨ RPC æ¡†æ¶çš„å®ç°ä¸­èµ·åˆ°äº†è‡³å…³é‡è¦çš„ä½œç”¨ï¼Œå®ƒå¯ä»¥å¸®åŠ©ç”¨æˆ·å±è”½ RPC è°ƒç”¨æ—¶åº•å±‚ç½‘ç»œé€šä¿¡ã€æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ç­‰å…·ä½“ç»†èŠ‚ï¼Œè¿™äº›å¯¹ç”¨æˆ·æ¥è¯´å¹¶æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚ä½ åœ¨å¹³æ—¶é¡¹ç›®å¼€å‘ä¸­ä½¿ç”¨ RPC æ¡†æ¶çš„æ—¶å€™ï¼Œåªéœ€è¦è°ƒç”¨æ¥å£æ–¹æ³•ï¼Œç„¶åå°±æ‹¿åˆ°äº†è¿”å›ç»“æœï¼Œä½ æ˜¯å¦å¥½å¥‡ RPC æ¡†æ¶æ˜¯å¦‚ä½•å®Œæˆæ•´ä¸ªè°ƒç”¨æµç¨‹çš„å‘¢ï¼Ÿä»Šå¤©è¿™èŠ‚è¯¾æˆ‘ä»¬å°±ä¸€èµ·æ¥å®Œæˆ RPC æ¡†æ¶çš„æœ€åä¸€éƒ¨åˆ†å†…å®¹ï¼šRPC è¯·æ±‚è°ƒç”¨å’Œå¤„ç†ï¼Œçœ‹çœ‹å¦‚ä½•ä½¿ç”¨åŠ¨æ€ä»£ç†æœºåˆ¶å®Œæˆè¿™ä¸ªç¥å¥‡çš„æ“ä½œã€‚</p>
<blockquote>
<p>æºç å‚è€ƒåœ°å€ï¼š<a href="https://github.com/wangyapu/mini-rpc">mini-rpc</a></p>
</blockquote>
<h3 id="åŠ¨æ€ä»£ç†åŸºç¡€">åŠ¨æ€ä»£ç†åŸºç¡€</h3>
<p>ä¸ºä»€ä¹ˆéœ€è¦ä»£ç†æ¨¡å¼å‘¢ï¼Ÿä»£ç†æ¨¡å¼çš„ä¼˜åŠ¿æ˜¯å¯ä»¥å¾ˆå¥½åœ°éµå¾ªè®¾è®¡æ¨¡å¼ä¸­çš„å¼€æ”¾å°é—­åŸåˆ™ï¼Œå¯¹æ‰©å±•å¼€å‘ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚ä½ ä¸éœ€è¦å…³æ³¨ç›®æ ‡ç±»çš„å®ç°ç»†èŠ‚ï¼Œé€šè¿‡ä»£ç†æ¨¡å¼å¯ä»¥åœ¨ä¸ä¿®æ”¹ç›®æ ‡ç±»çš„æƒ…å†µä¸‹ï¼Œå¢å¼ºç›®æ ‡ç±»åŠŸèƒ½çš„è¡Œä¸ºã€‚Spring AOP æ˜¯ Java åŠ¨æ€ä»£ç†æœºåˆ¶çš„ç»å…¸è¿ç”¨ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®å¼€å‘ä¸­ç»å¸¸ä½¿ç”¨ AOP æŠ€æœ¯å®Œæˆä¸€äº›åˆ‡é¢æœåŠ¡ï¼Œå¦‚è€—æ—¶ç›‘æ§ã€äº‹åŠ¡ç®¡ç†ã€æƒé™æ ¡éªŒç­‰ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯é€šè¿‡åˆ‡é¢æ‰©å±•å®ç°çš„ï¼Œä¸éœ€è¦å¯¹æºä»£ç æœ‰æ‰€ä¾µå…¥ã€‚</p>
<p>åŠ¨æ€ä»£ç†æ˜¯ä¸€ç§ä»£ç†æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶åŠ¨æ€æ„å»ºä»£ç†ç±»ä»¥åŠåŠ¨æ€è°ƒç”¨ç›®æ ‡æ–¹æ³•çš„æœºåˆ¶ã€‚ä¸ºä»€ä¹ˆç§°ä¸ºåŠ¨æ€æ˜¯å› ä¸ºä»£ç†ç±»å’Œè¢«ä»£ç†å¯¹è±¡çš„å…³ç³»æ˜¯åœ¨è¿è¡Œæ—¶å†³å®šçš„ï¼Œä»£ç†ç±»å¯ä»¥çœ‹ä½œæ˜¯å¯¹è¢«ä»£ç†å¯¹è±¡çš„åŒ…è£…ï¼Œå¯¹ç›®æ ‡æ–¹æ³•çš„è°ƒç”¨æ˜¯é€šè¿‡ä»£ç†ç±»æ¥å®Œæˆçš„ã€‚æ‰€ä»¥é€šè¿‡ä»£ç†æ¨¡å¼å¯ä»¥æœ‰æ•ˆåœ°å°†æœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…è¿›è¡Œè§£è€¦ï¼Œéšè—äº† RPC è°ƒç”¨çš„å…·ä½“ç»†èŠ‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Netty%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8E%20RPC%20%E5%AE%9E%E8%B7%B5-%E5%AE%8C/assets/Ciqc1GABMWuAQoyjAAG3EtPY5lU539.png" alt="å›¾ç‰‡1.png"></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·æ¢è®¨ä¸‹åŠ¨æ€ä»£ç†çš„å®ç°åŸç†ï¼Œä»¥åŠå¸¸ç”¨çš„ JDK åŠ¨æ€ä»£ç†ã€Cglib åŠ¨æ€ä»£ç†æ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚</p>
<h4 id="jdk-åŠ¨æ€ä»£ç†">JDK åŠ¨æ€ä»£ç†</h4>
<p>JDK åŠ¨æ€ä»£ç†å®ç°ä¾èµ– java.lang.reflect åŒ…ä¸­çš„ä¸¤ä¸ªæ ¸å¿ƒç±»ï¼š<strong>InvocationHandler æ¥å£</strong>å’Œ<strong>Proxy ç±»</strong>ã€‚</p>
<ul>
<li><strong>InvocationHandler æ¥å£</strong></li>
</ul>
<p>JDK åŠ¨æ€ä»£ç†æ‰€ä»£ç†çš„å¯¹è±¡å¿…é¡»å®ç°ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ¥å£ï¼Œç”Ÿæˆçš„ä»£ç†ç±»ä¹Ÿæ˜¯æ¥å£çš„å®ç°ç±»ï¼Œç„¶åé€šè¿‡ JDK åŠ¨æ€ä»£ç†æ˜¯é€šè¿‡åå°„è°ƒç”¨çš„æ–¹å¼ä»£ç†ç±»ä¸­çš„æ–¹æ³•ï¼Œä¸èƒ½ä»£ç†æ¥å£ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•ã€‚æ¯ä¸€ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡å¿…é¡»æä¾› InvocationHandler æ¥å£çš„å®ç°ç±»ï¼ŒInvocationHandler æ¥å£ä¸­åªæœ‰ä¸€ä¸ª invoke() æ–¹æ³•ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ä»£ç†å¯¹è±¡è°ƒç”¨æŸä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«è½¬å‘åˆ° invoke() æ–¹æ³•æ‰§è¡Œå…·ä½“çš„é€»è¾‘ã€‚invoke() æ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>public interface InvocationHandler {

    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable;

}
</code></pre><p>å…¶ä¸­ proxy å‚æ•°è¡¨ç¤ºéœ€è¦ä»£ç†çš„å¯¹è±¡ï¼Œmethod å‚æ•°è¡¨ç¤ºä»£ç†å¯¹è±¡è¢«è°ƒç”¨çš„æ–¹æ³•ï¼Œargs å‚æ•°ä¸ºè¢«è°ƒç”¨æ–¹æ³•æ‰€éœ€çš„å‚æ•°ã€‚</p>
<ul>
<li><strong>Proxy ç±»</strong></li>
</ul>
<p>Proxy ç±»å¯ä»¥ç†è§£ä¸ºåŠ¨æ€åˆ›å»ºä»£ç†ç±»çš„å·¥å‚ç±»ï¼Œå®ƒæä¾›äº†ä¸€ç»„é™æ€æ–¹æ³•å’Œæ¥å£ç”¨äºåŠ¨æ€ç”Ÿæˆå¯¹è±¡å’Œä»£ç†ç±»ã€‚é€šå¸¸æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ newProxyInstance() æ–¹æ³•ï¼Œæ–¹æ³•å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<pre tabindex="0"><code>public static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) {

    Objects.requireNonNull(h);

    Class&lt;?&gt; caller = System.getSecurityManager() == null ? null : Reflection.getCallerClass();

    Constructor&lt;?&gt; cons = getProxyConstructor(caller, loader, interfaces);

    return newProxyInstance(caller, cons, h);

}
</code></pre><p>å…¶ä¸­ loader å‚æ•°è¡¨ç¤ºéœ€è¦è£…è½½çš„ç±»åŠ è½½å™¨ ClassLoaderï¼Œinterfaces å‚æ•°è¡¨ç¤ºä»£ç†ç±»å®ç°çš„æ¥å£åˆ—è¡¨ï¼Œç„¶åä½ è¿˜éœ€è¦æä¾›ä¸€ä¸ª InvocationHandler æ¥å£ç±»å‹çš„å¤„ç†å™¨ï¼Œæ‰€æœ‰åŠ¨æ€ä»£ç†ç±»çš„æ–¹æ³•è°ƒç”¨éƒ½ä¼šäº¤ç”±è¯¥å¤„ç†å™¨è¿›è¡Œå¤„ç†ï¼Œè¿™æ˜¯åŠ¨æ€ä»£ç†çš„æ ¸å¿ƒæ‰€åœ¨ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¨¡æ‹Ÿæ•°æ®åº“æ“ä½œçš„äº‹åŠ¡ç®¡ç†ï¼Œä»è€Œå­¦ä¹  JDK åŠ¨æ€ä»£ç†çš„å…·ä½“ä½¿ç”¨æ–¹å¼ã€‚é¦–å…ˆæˆ‘ä»¬å®šä¹‰æ•°æ®åº“è¡¨ User çš„æ¥å£ä»¥åŠå®ç°ç±»ï¼š</p>
<pre tabindex="0"><code>public interface UserDao {

    void insert();

}

public class UserDaoImpl implements UserDao {

    @Override

    public void insert() {

        System.out.println(&quot;insert user success.&quot;);

    }

}
</code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬å®ç°ä¸€ä¸ªäº‹åŠ¡ç®¡ç†çš„å·¥å…·ç±»ï¼Œåœ¨æ•°æ®åº“æ“ä½œæ‰§è¡Œå‰åæ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public class TransactionProxy {

    private Object target;

    public TransactionProxy(Object target) {

        this.target = target;

    }

    public Object genProxyInstance() {

        return Proxy.newProxyInstance(target.getClass().getClassLoader(),

                target.getClass().getInterfaces(),

                (proxy, method, args) -&gt; {

                    System.out.println(&quot;start transaction&quot;);

                    Object result = method.invoke(target, args);

                    System.out.println(&quot;submit transaction&quot;);

                    return result;

                });

    }

}
</code></pre><p>åœ¨ genProxyInstance() æ–¹æ³•ä¸­æˆ‘ä»¬æœ€ä¸»è¦çš„æ˜¯å®ç° InvocationHandler æ¥å£ï¼Œåœ¨çœŸå®å¯¹è±¡æ–¹æ³•æ‰§è¡Œæ–¹æ³•è°ƒç”¨çš„å‰åå¯ä»¥æ‰©å±•è‡ªå®šä¹‰è¡Œä¸ºï¼Œä»¥æ­¤æ¥å¢å¼ºç›®æ ‡ç±»çš„åŠŸèƒ½ã€‚ä¸ºäº†ä¾¿äºç†è§£ï¼Œä¸Šè¿°ä¾‹å­ä¸­æˆ‘ä»¬åªç®€å•æ‰“å°äº†æ§åˆ¶å°æ—¥å¿—ï¼Œå¯ä»¥é€šè¿‡æµ‹è¯•ç±»çœ‹çœ‹ JDK åŠ¨æ€ä»£ç†çš„å®é™…æ•ˆæœï¼š</p>
<pre tabindex="0"><code>public class TransactionProxyTest {

    @Test

    public void testProxy() {

        UserDao userDao = new UserDaoImpl();

        UserDao proxyInstance = (UserDao) new TransactionProxy(userDao).genProxyInstance();

        proxyInstance.insert();

    }

}
</code></pre><p>ç¨‹åºè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>start transaction

insert user success.

submit transaction
</code></pre><h4 id="cglib-åŠ¨æ€ä»£ç†">Cglib åŠ¨æ€ä»£ç†</h4>
<p>Cglib åŠ¨æ€ä»£ç†æ˜¯åŸºäº ASM å­—èŠ‚ç ç”Ÿæˆæ¡†æ¶å®ç°çš„ç¬¬ä¸‰æ–¹å·¥å…·ç±»åº“ï¼Œç›¸æ¯”äº JDK åŠ¨æ€ä»£ç†ï¼ŒCglib åŠ¨æ€ä»£ç†æ›´åŠ çµæ´»ï¼Œå®ƒæ˜¯é€šè¿‡å­—èŠ‚ç æŠ€æœ¯ç”Ÿæˆçš„ä»£ç†ç±»ï¼Œæ‰€ä»¥ä»£ç†ç±»çš„ç±»å‹æ˜¯ä¸å—é™åˆ¶çš„ã€‚ä½¿ç”¨ Cglib ä»£ç†çš„ç›®æ ‡ç±»æ— é¡»å®ç°ä»»ä½•æ¥å£ï¼Œå¯ä»¥åšåˆ°å¯¹ç›®æ ‡ç±»é›¶ä¾µå…¥ã€‚</p>
<p>Cglib åŠ¨æ€ä»£ç†æ˜¯å¯¹æŒ‡å®šç±»ä»¥å­—èŠ‚ç çš„æ–¹å¼ç”Ÿæˆä¸€ä¸ªå­ç±»ï¼Œå¹¶é‡å†™å…¶ä¸­çš„æ–¹æ³•ï¼Œä»¥æ­¤æ¥å®ç°åŠ¨æ€ä»£ç†ã€‚å› ä¸º Cglib åŠ¨æ€ä»£ç†åˆ›å»ºçš„æ˜¯ç›®æ ‡ç±»çš„å­ç±»ï¼Œæ‰€ä»¥ç›®æ ‡ç±»å¿…é¡»è¦æœ‰æ— å‚æ„é€ å‡½æ•°ï¼Œè€Œä¸”ç›®æ ‡ç±»ä¸è¦ç”¨ final è¿›è¡Œä¿®é¥°ã€‚</p>
<p>åœ¨æˆ‘ä»¬ä½¿ç”¨ Cglib åŠ¨æ€ä»£ç†ä¹‹å‰ï¼Œéœ€è¦å¼•å…¥ç›¸å…³çš„ Maven ä¾èµ–ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚å¦‚æœä½ çš„é¡¹ç›®ä¸­å·²ç»å¼•å…¥äº† spring-core çš„ä¾èµ–ï¼Œåˆ™å·²ç»åŒ…å«äº† Cglib çš„ç›¸å…³ä¾èµ–ï¼Œæ— é¡»å†æ¬¡å¼•å…¥ã€‚</p>
<pre tabindex="0"><code>&lt;dependency&gt;

    &lt;groupId&gt;cglib&lt;/groupId&gt;

    &lt;artifactId&gt;cglib&lt;/artifactId&gt;

    &lt;version&gt;3.3.0&lt;/version&gt;

&lt;/dependency&gt;
</code></pre><p>ä¸‹é¢æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ä¸Šè¿°æ•°æ®åº“äº‹åŠ¡ç®¡ç†çš„ä¾‹å­ï¼Œä»è€Œå­¦ä¹  JDK åŠ¨æ€ä»£ç†çš„å…·ä½“ä½¿ç”¨æ–¹å¼ã€‚UserDao æ¥å£å’Œå®ç°ç±»ä¿æŒä¸å˜ï¼ŒTransactionProxy éœ€è¦é‡æ–°å®ç°ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public class CglibTransactionProxy implements MethodInterceptor {

    private Object target;

    public CglibTransactionProxy(Object target) {

        this.target = target;

    }

    public Object genProxyInstance() {

        Enhancer enhancer = new Enhancer();

        enhancer.setSuperclass(target.getClass());

        enhancer.setCallback(this);

        return enhancer.create();

    }

    @Override

    public Object intercept(Object object, Method method, Object[] args, MethodProxy methodProxy) throws Throwable {

        System.out.println(&quot;start transaction&quot;);

        Object result = methodProxy.invokeSuper(object, args);

        System.out.println(&quot;submit transaction&quot;);

        return result;

    }

}
</code></pre><p>Cglib åŠ¨æ€ä»£ç†çš„å®ç°éœ€è¦ä¾èµ–ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶ï¼šMethodInterceptor æ¥å£å’Œ Enhancer ç±»ï¼Œç±»ä¼¼äº JDK åŠ¨æ€ä»£ç†ä¸­çš„<strong>InvocationHandler æ¥å£</strong>å’Œ<strong>Proxy ç±»</strong>ã€‚</p>
<ul>
<li><strong>MethodInterceptor æ¥å£</strong></li>
</ul>
<p>MethodInterceptor æ¥å£åªæœ‰ intercept() ä¸€ä¸ªæ–¹æ³•ï¼Œæ‰€æœ‰è¢«ä»£ç†ç±»çš„æ–¹æ³•æ‰§è¡Œæœ€ç»ˆéƒ½ä¼šè½¬ç§»åˆ° intercept() æ–¹æ³•ä¸­è¿›è¡Œè¡Œä¸ºå¢å¼ºï¼ŒçœŸå®æ–¹æ³•çš„æ‰§è¡Œé€»è¾‘åˆ™é€šè¿‡ Method æˆ–è€… MethodProxy å¯¹è±¡è¿›è¡Œè°ƒç”¨ã€‚</p>
<ul>
<li><strong>Enhancer ç±»</strong></li>
</ul>
<p>Enhancer ç±»æ˜¯ Cglib ä¸­çš„ä¸€ä¸ªå­—èŠ‚ç å¢å¼ºå™¨ï¼Œå®ƒä¸ºæˆ‘ä»¬å¯¹ä»£ç†ç±»è¿›è¡Œæ‰©å±•æ—¶æä¾›äº†æå¤§çš„ä¾¿åˆ©ã€‚Enhancer ç±»çš„æœ¬è´¨æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ä¸ºä»£ç†ç±»ç”Ÿæˆä¸€ä¸ªå­ç±»ï¼Œå¹¶ä¸”æ‹¦æˆªä»£ç†ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ Enhancer è®¾ç½® Callback æ¥å£å¯¹ä»£ç†ç±»æ–¹æ³•æ‰§è¡Œçš„å‰åæ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è¡Œä¸ºï¼Œå…¶ä¸­ MethodInterceptor æ¥å£æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„ Callback æ“ä½œã€‚</p>
<p>Cglib åŠ¨æ€ä»£ç†çš„æµ‹è¯•ç±»ä¸ JDK åŠ¨æ€ä»£ç†æµ‹è¯•ç±»å¤§åŒå°å¼‚ï¼Œç¨‹åºè¾“å‡ºç»“æœä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚æµ‹è¯•ç±»ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public class CglibTransactionProxyTest {

    public static void main(String[] args) {

        UserDao userDao = new UserDaoImpl();

        UserDao proxyInstance = (UserDao) new CglibTransactionProxy(userDao).genProxyInstance();

        proxyInstance.insert();

    }

}
</code></pre><p>å­¦ä¹ å®ŒåŠ¨æ€ä»£ç†çš„åŸºç¡€åï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å®ç° RPC æ¡†æ¶ä¸­çš„è¯·æ±‚è°ƒç”¨å’Œå¤„ç†å°±æ˜“å¦‚åæŒå•¦ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆä»æœåŠ¡æ¶ˆè´¹è€…å¦‚ä½•é€šè¿‡åŠ¨æ€ä»£ç†å‘èµ· RPC è¯·æ±‚å…¥æ‰‹ã€‚</p>
<h3 id="æœåŠ¡æ¶ˆè´¹è€…åŠ¨æ€ä»£ç†å®ç°">æœåŠ¡æ¶ˆè´¹è€…åŠ¨æ€ä»£ç†å®ç°</h3>
<p>åœ¨ã€ŠæœåŠ¡å‘å¸ƒä¸è®¢é˜…ï¼šæ­å»ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åŸºç¡€æ¡†æ¶ã€‹è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬è®²è§£äº† @RpcReference æ³¨è§£çš„å®ç°è¿‡ç¨‹ã€‚é€šè¿‡ä¸€ä¸ªè‡ªå®šä¹‰çš„ RpcReferenceBean å®Œæˆäº†æ‰€æœ‰æ‰§è¡Œæ–¹æ³•çš„æ‹¦æˆªï¼ŒRpcReferenceBean ä¸­ init() æ–¹æ³•æ˜¯å½“æ—¶ç•™ä¸‹çš„ TODO å†…å®¹ï¼Œè¿™é‡Œå°±æ˜¯ä»£ç†å¯¹è±¡çš„åˆ›å»ºå…¥å£ï¼Œä»£ç†å¯¹è±¡åˆ›å»ºå¦‚ä¸‹æ‰€ç¤º.</p>
<pre tabindex="0"><code>public class RpcReferenceBean implements FactoryBean&lt;Object&gt; {

    // çœç•¥å…¶ä»–ä»£ç 
    public void init() throws Exception {

        RegistryService registryService = RegistryFactory.getInstance(this.registryAddr, RegistryType.valueOf(this.registryType));

        this.object = Proxy.newProxyInstance(

                interfaceClass.getClassLoader(),

                new Class&lt;?&gt;[]{interfaceClass},

                new RpcInvokerProxy(serviceVersion, timeout, registryService));

    }
    // çœç•¥å…¶ä»–ä»£ç 

}
</code></pre><p>RpcInvokerProxy å¤„ç†å™¨æ˜¯å®ç°åŠ¨æ€ä»£ç†é€»è¾‘çš„æ ¸å¿ƒæ‰€åœ¨ï¼Œå…¶ä¸­åŒ…å« RPC è°ƒç”¨æ—¶åº•å±‚ç½‘ç»œé€šä¿¡ã€æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ç­‰å…·ä½“ç»†èŠ‚ï¼Œæˆ‘ä»¬è¯¦ç»†çœ‹ä¸‹å¦‚ä½•å®ç° RpcInvokerProxy å¤„ç†å™¨ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>public class RpcInvokerProxy implements InvocationHandler {

    private final String serviceVersion;

    private final long timeout;

    private final RegistryService registryService;

    public RpcInvokerProxy(String serviceVersion, long timeout, RegistryService registryService) {

        this.serviceVersion = serviceVersion;

        this.timeout = timeout;

        this.registryService = registryService;

    }

    @Override

    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {

        // æ„é€  RPC åè®®å¯¹è±¡

        MiniRpcProtocol&lt;MiniRpcRequest&gt; protocol = new MiniRpcProtocol&lt;&gt;();

        MsgHeader header = new MsgHeader();

        long requestId = MiniRpcRequestHolder.REQUEST_ID_GEN.incrementAndGet();

        header.setMagic(ProtocolConstants.MAGIC);

        header.setVersion(ProtocolConstants.VERSION);

        header.setRequestId(requestId);

        header.setSerialization((byte) SerializationTypeEnum.HESSIAN.getType());

        header.setMsgType((byte) MsgType.REQUEST.getType());

        header.setStatus((byte) 0x1);

        protocol.setHeader(header);

        MiniRpcRequest request = new MiniRpcRequest();

        request.setServiceVersion(this.serviceVersion);

        request.setClassName(method.getDeclaringClass().getName());

        request.setMethodName(method.getName());

        request.setParameterTypes(method.getParameterTypes());

        request.setParams(args);

        protocol.setBody(request);

        RpcConsumer rpcConsumer = new RpcConsumer();

        MiniRpcFuture&lt;MiniRpcResponse&gt; future = new MiniRpcFuture&lt;&gt;(new DefaultPromise&lt;&gt;(new DefaultEventLoop()), timeout);

        MiniRpcRequestHolder.REQUEST_MAP.put(requestId, future);

        // å‘èµ· RPC è¿œç¨‹è°ƒç”¨

        rpcConsumer.sendRequest(protocol, this.registryService);

        // ç­‰å¾… RPC è°ƒç”¨æ‰§è¡Œç»“æœ

        return future.getPromise().get(future.getTimeout(), TimeUnit.MILLISECONDS).getData();

    }

}
</code></pre><p>RpcInvokerProxy å¤„ç†å™¨å¿…é¡»è¦å®ç° InvocationHandler æ¥å£çš„ invoke() æ–¹æ³•ï¼Œè¢«ä»£ç†çš„ RPC æ¥å£åœ¨æ‰§è¡Œæ–¹æ³•è°ƒç”¨æ—¶ï¼Œéƒ½ä¼šè½¬å‘åˆ° invoke() æ–¹æ³•ä¸Šã€‚invoke() æ–¹æ³•çš„æ ¸å¿ƒæµç¨‹ä¸»è¦åˆ†ä¸ºä¸‰æ­¥ï¼šæ„é€  RPC åè®®å¯¹è±¡ã€å‘èµ· RPC è¿œç¨‹è°ƒç”¨ã€ç­‰å¾… RPC è°ƒç”¨æ‰§è¡Œç»“æœã€‚</p>
<p>RPC åè®®å¯¹è±¡çš„æ„å»ºï¼Œåªè¦æ ¹æ®ç”¨æˆ·é…ç½®çš„æ¥å£å‚æ•°å¯¹ MiniRpcProtocol ç±»çš„å±æ€§ä¾æ¬¡èµ‹å€¼å³å¯ã€‚æ„å»ºå®ŒMiniRpcProtocol åè®®å¯¹è±¡åï¼Œå°±å¯ä»¥å¯¹è¿œç«¯æœåŠ¡èŠ‚ç‚¹å‘èµ· RPC è°ƒç”¨äº†ï¼Œæ‰€ä»¥ sendRequest() æ–¹æ³•æ˜¯æˆ‘ä»¬éœ€è¦é‡ç‚¹å®ç°çš„å†…å®¹ã€‚</p>
<pre tabindex="0"><code>public void sendRequest(MiniRpcProtocol&lt;MiniRpcRequest&gt; protocol, RegistryService registryService) throws Exception {

    MiniRpcRequest request = protocol.getBody();

    Object[] params = request.getParams();

    String serviceKey = RpcServiceHelper.buildServiceKey(request.getClassName(), request.getServiceVersion());

    int invokerHashCode = params.length &gt; 0 ? params[0].hashCode() : serviceKey.hashCode();

    ServiceMeta serviceMetadata = registryService.discovery(serviceKey, invokerHashCode);

    if (serviceMetadata != null) {

        ChannelFuture future = bootstrap.connect(serviceMetadata.getServiceAddr(), serviceMetadata.getServicePort()).sync();

        future.addListener((ChannelFutureListener) arg0 -&gt; {

            if (future.isSuccess()) {

                log.info(&quot;connect rpc server {} on port {} success.&quot;, serviceMetadata.getServiceAddr(), serviceMetadata.getServicePort());

            } else {

                log.error(&quot;connect rpc server {} on port {} failed.&quot;, serviceMetadata.getServiceAddr(), serviceMetadata.getServicePort());

                future.cause().printStackTrace();

                eventLoopGroup.shutdownGracefully();

            }

        });

        future.channel().writeAndFlush(protocol);

    }

}
</code></pre><p>å‘èµ· RPC è°ƒç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°æœ€åˆé€‚çš„æœåŠ¡èŠ‚ç‚¹ï¼Œç›´æ¥è°ƒç”¨æ³¨å†Œä¸­å¿ƒæœåŠ¡ RegistryService çš„ discovery() æ–¹æ³•å³å¯ï¼Œé»˜è®¤æ˜¯é‡‡ç”¨ä¸€è‡´æ€§ Hash ç®—æ³•å®ç°çš„æœåŠ¡å‘ç°ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå°æŠ€å·§ï¼Œä¸ºäº†å°½å¯èƒ½ä½¿æ‰€æœ‰æœåŠ¡èŠ‚ç‚¹æ”¶åˆ°çš„è¯·æ±‚æµé‡æ›´åŠ å‡åŒ€ï¼Œéœ€è¦ä¸º discovery() æä¾›ä¸€ä¸ª invokerHashCodeï¼Œä¸€èˆ¬å¯ä»¥é‡‡ç”¨ RPC æœåŠ¡æ¥å£å‚æ•°åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå‚æ•°çš„ hashCode ä½œä¸ºå‚è€ƒä¾æ®ã€‚æ‰¾åˆ°æœåŠ¡èŠ‚ç‚¹åœ°å€åï¼Œæ¥ä¸‹æ¥é€šè¿‡ Netty å»ºç«‹ TCP è¿æ¥ï¼Œç„¶åè°ƒç”¨ writeAndFlush() æ–¹æ³•å°†æ•°æ®å‘é€åˆ°è¿œç«¯æœåŠ¡èŠ‚ç‚¹ã€‚</p>
<p>å†æ¬¡å›åˆ° invoke() æ–¹æ³•çš„ä¸»æµç¨‹ï¼Œå‘é€ RPC è¿œç¨‹è°ƒç”¨åå¦‚ä½•ç­‰å¾…è°ƒç”¨ç»“æœè¿”å›å‘¢ï¼Ÿåœ¨ã€Šè¿œç¨‹é€šä¿¡ï¼šé€šä¿¡åè®®è®¾è®¡ä»¥åŠç¼–è§£ç çš„å®ç°ã€‹è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Netty æä¾›çš„ Promise å·¥å…·æ¥å®ç° RPC è¯·æ±‚çš„åŒæ­¥ç­‰å¾…ï¼ŒPromise æ¨¡å¼æœ¬è´¨æ˜¯ä¸€ç§å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ‹¿åˆ°ä¸€ä¸ªæŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œç»“æœçš„å‡­è¯ï¼Œä¸å¿…ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå½“æˆ‘ä»¬éœ€è¦è·å–ä»»åŠ¡æ‰§è¡Œç»“æœæ—¶ï¼Œå†ä½¿ç”¨å‡­è¯æä¾›çš„ç›¸å…³æ¥å£è¿›è¡Œè·å–ã€‚</p>
<p>å½“æœåŠ¡æä¾›è€…æ”¶åˆ° RPC è¯·æ±‚åï¼Œåˆåº”è¯¥å¦‚ä½•æ‰§è¡ŒçœŸå®çš„æ–¹æ³•è°ƒç”¨å‘¢ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­çœ‹ä¸‹æœåŠ¡æä¾›è€…å¦‚ä½•å¤„ç† RPC è¯·æ±‚ã€‚</p>
<h3 id="æœåŠ¡æä¾›è€…åå°„è°ƒç”¨å®ç°">æœåŠ¡æä¾›è€…åå°„è°ƒç”¨å®ç°</h3>
<p>åœ¨ã€Šè¿œç¨‹é€šä¿¡ï¼šé€šä¿¡åè®®è®¾è®¡ä»¥åŠç¼–è§£ç çš„å®ç°ã€‹è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä»‹ç»äº†æœåŠ¡æä¾›è€…çš„ Handler å¤„ç†å™¨ï¼ŒRPC è¯·æ±‚æ•°æ®ç»è¿‡ MiniRpcDecoder è§£ç æˆ MiniRpcProtocol å¯¹è±¡åï¼Œå†äº¤ç”± RpcRequestHandler æ‰§è¡Œ RPC è¯·æ±‚è°ƒç”¨ã€‚ä¸€èµ·å…ˆæ¥å›é¡¾ä¸‹ RpcRequestHandler ä¸­ channelRead0() æ–¹æ³•çš„å¤„ç†é€»è¾‘ï¼š</p>
<pre tabindex="0"><code>@Slf4j

public class RpcRequestHandler extends SimpleChannelInboundHandler&lt;MiniRpcProtocol&lt;MiniRpcRequest&gt;&gt; {

    private final Map&lt;String, Object&gt; rpcServiceMap;

    public RpcRequestHandler(Map&lt;String, Object&gt; rpcServiceMap) {

        this.rpcServiceMap = rpcServiceMap;

    }

    @Override

    protected void channelRead0(ChannelHandlerContext ctx, MiniRpcProtocol&lt;MiniRpcRequest&gt; protocol) {

        RpcRequestProcessor.submitRequest(() -&gt; {

            MiniRpcProtocol&lt;MiniRpcResponse&gt; resProtocol = new MiniRpcProtocol&lt;&gt;();

            MiniRpcResponse response = new MiniRpcResponse();

            MsgHeader header = protocol.getHeader();

            header.setMsgType((byte) MsgType.RESPONSE.getType());

            try {

                Object result = handle(protocol.getBody());

                response.setData(result);

                header.setStatus((byte) MsgStatus.SUCCESS.getCode());

                resProtocol.setHeader(header);

                resProtocol.setBody(response);

            } catch (Throwable throwable) {

                header.setStatus((byte) MsgStatus.FAIL.getCode());

                response.setMessage(throwable.toString());

                log.error(&quot;process request {} error&quot;, header.getRequestId(), throwable);

            }

            ctx.writeAndFlush(resProtocol);

        });

    }

}
</code></pre><p>å› ä¸º RPC è¯·æ±‚è°ƒç”¨æ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œæ¨èçš„åšæ³•æ˜¯å°† RPC è¯·æ±‚æäº¤åˆ°è‡ªå®šä¹‰çš„ä¸šåŠ¡çº¿ç¨‹æ± ä¸­æ‰§è¡Œã€‚å…¶ä¸­ handle() æ–¹æ³•æ˜¯çœŸæ­£æ‰§è¡Œ RPC è°ƒç”¨çš„åœ°æ–¹ï¼Œæ˜¯æˆ‘ä»¬è¿™èŠ‚è¯¾éœ€è¦å®ç°çš„å†…å®¹ï¼Œhandle() æ–¹æ³•çš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>private Object handle(MiniRpcRequest request) throws Throwable {

    String serviceKey = RpcServiceHelper.buildServiceKey(request.getClassName(), request.getServiceVersion());

    Object serviceBean = rpcServiceMap.get(serviceKey);

    if (serviceBean == null) {

        throw new RuntimeException(String.format(&quot;service not exist: %s:%s&quot;, request.getClassName(), request.getMethodName()));

    }

    Class&lt;?&gt; serviceClass = serviceBean.getClass();

    String methodName = request.getMethodName();

    Class&lt;?&gt;[] parameterTypes = request.getParameterTypes();

    Object[] parameters = request.getParams();

    FastClass fastClass = FastClass.create(serviceClass);

    int methodIndex = fastClass.getIndex(methodName, parameterTypes);

    return fastClass.invoke(methodIndex, serviceBean, parameters);

}
</code></pre><p>rpcServiceMap ä¸­å­˜æ”¾ç€æœåŠ¡æä¾›è€…æ‰€æœ‰å¯¹å¤–å‘å¸ƒçš„æœåŠ¡æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æœåŠ¡åå’ŒæœåŠ¡ç‰ˆæœ¬æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡æ¥å£ã€‚é€šè¿‡æœåŠ¡æ¥å£ã€æ–¹æ³•åã€æ–¹æ³•å‚æ•°åˆ—è¡¨ã€å‚æ•°ç±»å‹åˆ—è¡¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬å¯ä»¥ä½¿ç”¨åå°„çš„æ–¹å¼æ‰§è¡Œæ–¹æ³•è°ƒç”¨ã€‚ä¸ºäº†åŠ é€ŸæœåŠ¡æ¥å£è°ƒç”¨çš„æ€§èƒ½ï¼Œæˆ‘ä»¬é‡‡ç”¨ Cglib æä¾›çš„ FastClass æœºåˆ¶ç›´æ¥è°ƒç”¨æ–¹æ³•ï¼ŒCglib ä¸­ MethodProxy å¯¹è±¡å°±æ˜¯é‡‡ç”¨äº† FastClass æœºåˆ¶ï¼Œå®ƒå¯ä»¥å’Œ Method å¯¹è±¡å®ŒæˆåŒæ ·çš„äº‹æƒ…ï¼Œä½†æ˜¯ç›¸æ¯”äºåå°„æ€§èƒ½æ›´é«˜ã€‚</p>
<p>FastClass æœºåˆ¶å¹¶æ²¡æœ‰é‡‡ç”¨åå°„çš„æ–¹å¼è°ƒç”¨è¢«ä»£ç†çš„æ–¹æ³•ï¼Œè€Œæ˜¯è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä¸€ä¸ªæ–°çš„ FastClass å­ç±»ï¼Œå‘å­ç±»ä¸­å†™å…¥ç›´æ¥è°ƒç”¨ç›®æ ‡æ–¹æ³•çš„é€»è¾‘ã€‚åŒæ—¶è¯¥å­ç±»ä¼šä¸ºä»£ç†ç±»åˆ†é…ä¸€ä¸ª int ç±»å‹çš„ index ç´¢å¼•ï¼ŒFastClass å³å¯é€šè¿‡ index ç´¢å¼•å®šä½åˆ°éœ€è¦è°ƒç”¨çš„æ–¹æ³•ã€‚</p>
<p>è‡³æ­¤ï¼Œæ•´ä¸ª RPC æ¡†æ¶çš„åŸå‹æˆ‘ä»¬å·²ç»å®ç°å®Œæ¯•ã€‚ä½ å¯ä»¥åœ¨æœ¬åœ°å…ˆå¯åŠ¨ Zookeeper æœåŠ¡å™¨ï¼Œç„¶åå¯åŠ¨ rpc-providerã€rpc-consumer ä¸¤ä¸ªæ¨¡å—ï¼Œé€šè¿‡ HTTP è¯·æ±‚å‘èµ·æµ‹è¯•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>$ curl http://localhost:8080/hello

hellomini rpc
</code></pre><h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>æœ¬èŠ‚è¯¾æˆ‘ä»¬ä»‹ç»äº†åŠ¨æ€ä»£ç†çš„åŸºæœ¬åŸç†ï¼Œå¹¶ä½¿ç”¨åŠ¨æ€ä»£ç†æŠ€æœ¯å®Œæˆäº† RPC è¯·æ±‚çš„è°ƒç”¨å’Œå¤„ç†ã€‚åŠ¨æ€ä»£ç†æŠ€æœ¯æ˜¯ RPC æ¡†æ¶çš„æ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯å¾ˆé‡è¦çš„ä¸€ä¸ªæ€§èƒ½ä¼˜åŒ–ç‚¹ã€‚é€‰æ‹©å“ªç§åŠ¨æ€ä»£ç†æŠ€æœ¯éœ€è¦æ ¹æ®åœºæ™¯æœ‰çš„æ”¾çŸ¢ï¼Œå®è·µå‡ºçœŸçŸ¥ï¼Œåœ¨æŠ€æœ¯é€‰å‹æ—¶è¿˜æ˜¯è¦åšå¥½æ€§èƒ½æµ‹è¯•ã€‚ä¾‹å¦‚ï¼Œåœ¨ JDK 1.8 ç‰ˆæœ¬ä¹‹å JDK åŠ¨æ€ä»£ç†åœ¨è¿è¡Œå¤šæ¬¡ä¹‹åæ¯” Cglib çš„é€Ÿåº¦æ›´å¿«äº†ï¼Œä½†æ˜¯å®ƒè¿˜æ˜¯æœ‰ä½¿ç”¨çš„å±€é™æ€§ï¼›è™½ç„¶ Javassist å­—èŠ‚ç ç”Ÿæˆçš„æ€§èƒ½ç›¸æ¯” JDK åŠ¨æ€ä»£ç†å’Œ Cglib åŠ¨æ€ä»£ç†æ›´å¥½ï¼Œä½†æ˜¯ Javassist åœ¨ç”ŸæˆåŠ¨æ€ä»£ç†ç±»ä¸Šæ€§èƒ½è¾ƒæ…¢çš„ã€‚</p>
<p>ç•™ä¸¤ä¸ªè¯¾åä»»åŠ¡ï¼š</p>
<ul>
<li>Dubbo æ¡†æ¶é»˜è®¤ä½¿ç”¨ Javassist å®ç°åŠ¨æ€ä»£ç†åŠŸèƒ½ï¼Œä½ å¯ä»¥å°† JDK åŠ¨æ€ä»£ç†çš„æ–¹å¼æ›¿æ¢ä¸º Javassist çš„å®ç°æ–¹å¼ã€‚</li>
<li>æœåŠ¡æ¶ˆè´¹è€…æ¯æ¬¡å‘èµ· RPC è°ƒç”¨æ—¶éƒ½å»ºç«‹äº†ä¸€æ¬¡ TCP è¿æ¥ï¼Œä½ çŸ¥é“æ€ä¹ˆä¼˜åŒ–å—ï¼Ÿ</li>
</ul>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/26-%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E4%B8%8E%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%BA%E5%88%B6%E7%9A%84%E5%AE%9E%E7%8E%B0/"><span>26 æœåŠ¡æ²»ç†ï¼šæœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡æœºåˆ¶çš„å®ç°</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/28-%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%93rpc-%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%93%E4%B8%8E%E8%BF%9B%E9%98%B6%E5%BB%B6%E4%BC%B8/"><span>28 å®æˆ˜æ€»ç»“ï¼šRPC å®æˆ˜æ€»ç»“ä¸è¿›é˜¶å»¶ä¼¸</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 27270 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>