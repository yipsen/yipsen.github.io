<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>03 å¼•å¯¼å™¨ä½œç”¨ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯åŠ¨éƒ½è¦åšäº›ä»€ä¹ˆï¼Ÿ | Yipsen Ye</title>
<meta name="description" content="ä½ å¥½ï¼Œæˆ‘æ˜¯è‹¥åœ°ã€‚ä¸ŠèŠ‚è¯¾æˆ‘ä»¬ä»‹ç»äº† Netty ä¸­æ ¸å¿ƒç»„ä»¶çš„ä½œç”¨ä»¥åŠç»„ä»¶åä½œçš„æ–¹å¼æ–¹æ³•ã€‚ä»è¿™èŠ‚è¯¾å¼€å§‹ï¼Œæˆ‘ä»¬å°†å¯¹ Netty çš„æ¯ä¸ªæ ¸å¿ƒç»„ä»¶ä¾æ¬¡è¿›è¡Œæ·±å…¥å‰–æè§£è¯»ã€‚æˆ‘ä¼šç»“åˆç›¸åº”çš„ä»£ç ç¤ºä¾‹è®²è§£ï¼Œå¸®åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹ Nettyã€‚
æˆ‘ä»¬åœ¨ä½¿ç”¨ Netty ç¼–å†™ç½‘ç»œåº”ç”¨ç¨‹åºçš„æ—¶å€™ï¼Œä¸€å®šä¼šä»å¼•å¯¼å™¨ Bootstrapå¼€å§‹å…¥æ‰‹ã€‚Bootstrap ä½œä¸ºæ•´ä¸ª Netty å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ç¨‹åºå…¥å£ï¼Œå¯ä»¥æŠŠ Netty çš„æ ¸å¿ƒç»„ä»¶åƒæ­ç§¯æœ¨ä¸€æ ·ç»„è£…åœ¨ä¸€èµ·ã€‚æœ¬èŠ‚è¯¾æˆ‘ä¼šä» Netty çš„å¼•å¯¼å™¨Bootstrapå‡ºå‘ï¼Œå¸¦ä½ å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Netty è¿›è¡Œæœ€åŸºæœ¬çš„ç¨‹åºå¼€å‘ã€‚
ä»ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨å¼€å§‹ HTTP æœåŠ¡å™¨æ˜¯æˆ‘ä»¬å¹³æ—¶æœ€å¸¸ç”¨çš„å·¥å…·ä¹‹ä¸€ã€‚åŒä¼ ç»Ÿ Web å®¹å™¨ Tomcatã€Jetty ä¸€æ ·ï¼ŒNetty ä¹Ÿå¯ä»¥æ–¹ä¾¿åœ°å¼€å‘ä¸€ä¸ª HTTP æœåŠ¡å™¨ã€‚æˆ‘ä»ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨å¼€å§‹ï¼Œé€šè¿‡ç¨‹åºç¤ºä¾‹ä¸ºä½ å±•ç° Netty ç¨‹åºå¦‚ä½•é…ç½®å¯åŠ¨ï¼Œä»¥åŠå¼•å¯¼å™¨å¦‚ä½•ä¸æ ¸å¿ƒç»„ä»¶äº§ç”Ÿè”ç³»ã€‚
å®Œæ•´åœ°å®ç°ä¸€ä¸ªé«˜æ€§èƒ½ã€åŠŸèƒ½å®Œå¤‡ã€å¥å£®æ€§å¼ºçš„ HTTP æœåŠ¡å™¨éå¸¸å¤æ‚ï¼Œæœ¬æ–‡ä»…ä¸ºäº†æ–¹ä¾¿ç†è§£ Netty ç½‘ç»œåº”ç”¨å¼€å‘çš„åŸºæœ¬è¿‡ç¨‹ï¼Œæ‰€ä»¥åªå®ç°æœ€åŸºæœ¬çš„è¯·æ±‚-å“åº”çš„æµç¨‹ï¼š
 æ­å»º HTTP æœåŠ¡å™¨ï¼Œé…ç½®ç›¸å…³å‚æ•°å¹¶å¯åŠ¨ã€‚ ä»æµè§ˆå™¨æˆ–è€…ç»ˆç«¯å‘èµ· HTTP è¯·æ±‚ã€‚ æˆåŠŸå¾—åˆ°æœåŠ¡ç«¯çš„å“åº”ç»“æœã€‚  Netty çš„æ¨¡å—åŒ–è®¾è®¡éå¸¸ä¼˜é›…ï¼Œå®¢æˆ·ç«¯æˆ–è€…æœåŠ¡ç«¯çš„å¯åŠ¨æ–¹å¼åŸºæœ¬æ˜¯å›ºå®šçš„ã€‚ä½œä¸ºå¼€å‘è€…æ¥è¯´ï¼Œåªè¦ç…§è‘«èŠ¦ç”»ç“¢å³å¯è½»æ¾ä¸Šæ‰‹ã€‚å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œä½ åªéœ€è¦å®ç°ä¸ä¸šåŠ¡é€»è¾‘ç›¸å…³çš„ä¸€ç³»åˆ— ChannelHandlerï¼Œå†åŠ ä¸Š Netty å·²ç»é¢„ç½®äº† HTTP ç›¸å…³çš„ç¼–è§£ç å™¨å°±å¯ä»¥å¿«é€Ÿå®ŒæˆæœåŠ¡ç«¯æ¡†æ¶çš„æ­å»ºã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸¤ä¸ªç±»å°±å¯ä»¥å®Œæˆä¸€ä¸ªæœ€ç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒä»¬åˆ†åˆ«ä¸ºæœåŠ¡å™¨å¯åŠ¨ç±»å’Œä¸šåŠ¡é€»è¾‘å¤„ç†ç±»ï¼Œç»“åˆå®Œæ•´çš„ä»£ç å®ç°æˆ‘å°†å¯¹å®ƒä»¬åˆ†åˆ«è¿›è¡Œè®²è§£ã€‚
æœåŠ¡ç«¯å¯åŠ¨ç±» æ‰€æœ‰ Netty æœåŠ¡ç«¯çš„å¯åŠ¨ç±»éƒ½å¯ä»¥é‡‡ç”¨å¦‚ä¸‹ä»£ç ç»“æ„è¿›è¡Œå¼€å‘ã€‚ç®€å•æ¢³ç†ä¸€ä¸‹æµç¨‹ï¼šé¦–å…ˆåˆ›å»ºå¼•å¯¼å™¨ï¼›ç„¶åé…ç½®çº¿ç¨‹æ¨¡å‹ï¼Œé€šè¿‡å¼•å¯¼å™¨ç»‘å®šä¸šåŠ¡é€»è¾‘å¤„ç†å™¨ï¼Œå¹¶é…ç½®ä¸€äº›ç½‘ç»œå‚æ•°ï¼›æœ€åç»‘å®šç«¯å£ï¼Œå°±å¯ä»¥å®ŒæˆæœåŠ¡å™¨çš„å¯åŠ¨äº†ã€‚
public class HttpServer {public void start(int port) throws Exception {EventLoopGroup bossGroup = new NioEventLoopGroup();EventLoopGroup workerGroup = new NioEventLoopGroup();try {ServerBootstrap b = new ServerBootstrap();b.">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/netty%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86%e5%89%96%e6%9e%90%e4%b8%8erpc%e5%ae%9e%e8%b7%b5/">Nettyæ ¸å¿ƒåŸç†å‰–æä¸RPCå®è·µ</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/00-%E5%AD%A6%E5%A5%BD-netty%E6%98%AF%E4%BD%A0%E4%BF%AE%E7%82%BC-java-%E5%86%85%E5%8A%9F%E7%9A%84%E5%BF%85%E7%BB%8F%E4%B9%8B%E8%B7%AF/">00 å­¦å¥½ Nettyï¼Œæ˜¯ä½ ä¿®ç‚¼ Java å†…åŠŸçš„å¿…ç»ä¹‹è·¯</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/01-%E5%88%9D%E8%AF%86-netty%E4%B8%BA%E4%BB%80%E4%B9%88-netty-%E8%BF%99%E4%B9%88%E6%B5%81%E8%A1%8C/">01 åˆè¯† Nettyï¼šä¸ºä»€ä¹ˆ Netty è¿™ä¹ˆæµè¡Œï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/02-%E7%BA%B5%E8%A7%88%E5%85%A8%E5%B1%80%E6%8A%8A%E6%8F%A1-netty-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E8%84%89%E7%BB%9C/">02 çºµè§ˆå…¨å±€ï¼šæŠŠæ¡ Netty æ•´ä½“æ¶æ„è„‰ç»œ</a></li>
                
                
                
                    <li>03 å¼•å¯¼å™¨ä½œç”¨ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯åŠ¨éƒ½è¦åšäº›ä»€ä¹ˆï¼Ÿ</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/04-%E4%BA%8B%E4%BB%B6%E8%B0%83%E5%BA%A6%E5%B1%82%E4%B8%BA%E4%BB%80%E4%B9%88-eventloop-%E6%98%AF-netty-%E7%9A%84%E7%B2%BE%E9%AB%93/">04 äº‹ä»¶è°ƒåº¦å±‚ï¼šä¸ºä»€ä¹ˆ EventLoop æ˜¯ Netty çš„ç²¾é«“ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/05-%E6%9C%8D%E5%8A%A1%E7%BC%96%E6%8E%92%E5%B1%82pipeline-%E5%A6%82%E4%BD%95%E5%8D%8F%E8%B0%83%E5%90%84%E7%B1%BB-handler-/">05 æœåŠ¡ç¼–æ’å±‚ï¼šPipeline å¦‚ä½•åè°ƒå„ç±» Handler ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/06-%E7%B2%98%E5%8C%85%E6%8B%86%E5%8C%85%E9%97%AE%E9%A2%98%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E7%9A%84%E7%BD%91%E7%BB%9C%E5%8C%85/">06 ç²˜åŒ…æ‹†åŒ…é—®é¢˜ï¼šå¦‚ä½•è·å–ä¸€ä¸ªå®Œæ•´çš„ç½‘ç»œåŒ…ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/07-%E6%8E%A5%E5%A4%B4%E6%9A%97%E8%AF%AD%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8-netty-%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%8F%E8%AE%AE%E9%80%9A%E4%BF%A1/">07 æ¥å¤´æš—è¯­ï¼šå¦‚ä½•åˆ©ç”¨ Netty å®ç°è‡ªå®šä¹‰åè®®é€šä¿¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/08-%E5%BC%80%E7%AE%B1%E5%8D%B3%E7%94%A8netty-%E6%94%AF%E6%8C%81%E5%93%AA%E4%BA%9B%E5%B8%B8%E7%94%A8%E7%9A%84%E8%A7%A3%E7%A0%81%E5%99%A8/">08 å¼€ç®±å³ç”¨ï¼šNetty æ”¯æŒå“ªäº›å¸¸ç”¨çš„è§£ç å™¨ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/09-%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93writeandflush-%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%E5%89%96%E6%9E%90/">09 æ•°æ®ä¼ è¾“ï¼šwriteAndFlush å¤„ç†æµç¨‹å‰–æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/10-%E5%8F%8C%E5%88%83%E5%89%91%E5%90%88%E7%90%86%E7%AE%A1%E7%90%86-netty-%E5%A0%86%E5%A4%96%E5%86%85%E5%AD%98/">10 åŒåˆƒå‰‘ï¼šåˆç†ç®¡ç† Netty å †å¤–å†…å­˜</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/11-%E5%8F%A6%E8%B5%B7%E7%82%89%E7%81%B6netty-%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E8%BD%BD%E4%BD%93-bytebuf-%E8%AF%A6%E8%A7%A3/">11 å¦èµ·ç‚‰ç¶ï¼šNetty æ•°æ®ä¼ è¾“è½½ä½“ ByteBuf è¯¦è§£</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/12-%E4%BB%96%E5%B1%B1%E4%B9%8B%E7%9F%B3%E9%AB%98%E6%80%A7%E8%83%BD%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E5%99%A8-jemalloc-%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/">12 ä»–å±±ä¹‹çŸ³ï¼šé«˜æ€§èƒ½å†…å­˜åˆ†é…å™¨ jemalloc åŸºæœ¬åŸç†</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/13-%E4%B8%BE%E4%B8%80%E5%8F%8D%E4%B8%89netty-%E9%AB%98%E6%80%A7%E8%83%BD%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E8%AE%BE%E8%AE%A1%E4%B8%8A/">13 ä¸¾ä¸€åä¸‰ï¼šNetty é«˜æ€§èƒ½å†…å­˜ç®¡ç†è®¾è®¡ï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/14-%E4%B8%BE%E4%B8%80%E5%8F%8D%E4%B8%89netty-%E9%AB%98%E6%80%A7%E8%83%BD%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E8%AE%BE%E8%AE%A1%E4%B8%8B/">14 ä¸¾ä¸€åä¸‰ï¼šNetty é«˜æ€§èƒ½å†…å­˜ç®¡ç†è®¾è®¡ï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/15-%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%AF%B9%E8%B1%A1%E5%9B%9E%E6%94%B6%E7%AB%99recycler-%E5%AF%B9%E8%B1%A1%E6%B1%A0%E6%8A%80%E6%9C%AF%E8%A7%A3%E6%9E%90/">15 è½»é‡çº§å¯¹è±¡å›æ”¶ç«™ï¼šRecycler å¯¹è±¡æ± æŠ€æœ¯è§£æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/16-io-%E5%8A%A0%E9%80%9F%E4%B8%8E%E4%BC%97%E4%B8%8D%E5%90%8C%E7%9A%84-netty-%E9%9B%B6%E6%8B%B7%E8%B4%9D%E6%8A%80%E6%9C%AF/">16 IO åŠ é€Ÿï¼šä¸ä¼—ä¸åŒçš„ Netty é›¶æ‹·è´æŠ€æœ¯</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/17-%E6%BA%90%E7%A0%81%E7%AF%87%E4%BB%8E-linux-%E5%87%BA%E5%8F%91%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/">17 æºç ç¯‡ï¼šä» Linux å‡ºå‘æ·±å…¥å‰–ææœåŠ¡ç«¯å¯åŠ¨æµç¨‹</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/18-%E6%BA%90%E7%A0%81%E7%AF%87%E8%A7%A3%E5%AF%86-netty-reactor-%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/">18 æºç ç¯‡ï¼šè§£å¯† Netty Reactor çº¿ç¨‹æ¨¡å‹</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/19-%E6%BA%90%E7%A0%81%E7%AF%87%E4%B8%80%E4%B8%AA%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%9C%A8-netty-%E4%B8%AD%E7%9A%84%E6%97%85%E7%A8%8B/">19 æºç ç¯‡ï¼šä¸€ä¸ªç½‘ç»œè¯·æ±‚åœ¨ Netty ä¸­çš„æ—…ç¨‹</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/20-%E6%8A%80%E5%B7%A7%E7%AF%87netty-%E7%9A%84-fastthreadlocal-%E7%A9%B6%E7%AB%9F%E6%AF%94-threadlocal-%E5%BF%AB%E5%9C%A8%E5%93%AA%E5%84%BF/">20 æŠ€å·§ç¯‡ï¼šNetty çš„ FastThreadLocal ç©¶ç«Ÿæ¯” ThreadLocal å¿«åœ¨å“ªå„¿ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/21-%E6%8A%80%E5%B7%A7%E7%AF%87%E5%BB%B6%E8%BF%9F%E4%BB%BB%E5%8A%A1%E5%A4%84%E7%90%86%E7%A5%9E%E5%99%A8%E4%B9%8B%E6%97%B6%E9%97%B4%E8%BD%AE-hashedwheeltimer/">21 æŠ€å·§ç¯‡ï¼šå»¶è¿Ÿä»»åŠ¡å¤„ç†ç¥å™¨ä¹‹æ—¶é—´è½® HashedWheelTimer</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/22-%E6%8A%80%E5%B7%A7%E7%AF%87%E9%AB%98%E6%80%A7%E8%83%BD%E6%97%A0%E9%94%81%E9%98%9F%E5%88%97-mpsc-queue/">22 æŠ€å·§ç¯‡ï¼šé«˜æ€§èƒ½æ— é”é˜Ÿåˆ— Mpsc Queue</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/23-%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%AB%98%E6%80%A7%E8%83%BD%E5%88%86%E5%B8%83%E5%BC%8F-rpc-%E6%A1%86%E6%9E%B6/">23 æ¶æ„è®¾è®¡ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªé«˜æ€§èƒ½åˆ†å¸ƒå¼ RPC æ¡†æ¶</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/24-%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E4%B8%8E%E8%AE%A2%E9%98%85%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E8%80%85%E5%92%8C%E6%B6%88%E8%B4%B9%E8%80%85%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A1%86%E6%9E%B6/">24 æœåŠ¡å‘å¸ƒä¸è®¢é˜…ï¼šæ­å»ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åŸºç¡€æ¡†æ¶</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/25-%E8%BF%9C%E7%A8%8B%E9%80%9A%E4%BF%A1%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE%E8%AE%BE%E8%AE%A1%E4%BB%A5%E5%8F%8A%E7%BC%96%E8%A7%A3%E7%A0%81%E7%9A%84%E5%AE%9E%E7%8E%B0/">25 è¿œç¨‹é€šä¿¡ï¼šé€šä¿¡åè®®è®¾è®¡ä»¥åŠç¼–è§£ç çš„å®ç°</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/26-%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E4%B8%8E%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%BA%E5%88%B6%E7%9A%84%E5%AE%9E%E7%8E%B0/">26 æœåŠ¡æ²»ç†ï¼šæœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡æœºåˆ¶çš„å®ç°</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/27-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E4%B8%BA%E7%94%A8%E6%88%B7%E5%B1%8F%E8%94%BD-rpc-%E8%B0%83%E7%94%A8%E7%9A%84%E5%BA%95%E5%B1%82%E7%BB%86%E8%8A%82/">27 åŠ¨æ€ä»£ç†ï¼šä¸ºç”¨æˆ·å±è”½ RPC è°ƒç”¨çš„åº•å±‚ç»†èŠ‚</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/28-%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%93rpc-%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%93%E4%B8%8E%E8%BF%9B%E9%98%B6%E5%BB%B6%E4%BC%B8/">28 å®æˆ˜æ€»ç»“ï¼šRPC å®æˆ˜æ€»ç»“ä¸è¿›é˜¶å»¶ä¼¸</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/29-%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3netty-%E4%B8%AD%E5%BA%94%E7%94%A8%E4%BA%86%E5%93%AA%E4%BA%9B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">29 ç¼–ç¨‹æ€æƒ³ï¼šNetty ä¸­åº”ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/30-%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93netty-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">30 å®è·µæ€»ç»“ï¼šNetty åœ¨é¡¹ç›®å¼€å‘ä¸­çš„ä¸€äº›æœ€ä½³å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/31-%E7%BB%93%E6%9D%9F%E8%AF%AD-%E6%8A%80%E6%9C%AF%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%E5%A6%82%E4%BD%95%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E6%8A%80%E6%9C%AF%E4%BD%93%E7%B3%BB/">31 ç»“æŸè¯­ æŠ€æœ¯æˆé•¿ä¹‹è·¯ï¼šå¦‚ä½•æ‰“é€ è‡ªå·±çš„æŠ€æœ¯ä½“ç³»</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">03 å¼•å¯¼å™¨ä½œç”¨ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯åŠ¨éƒ½è¦åšäº›ä»€ä¹ˆï¼Ÿ</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2021-12-22 01:54:24</span>ğŸ·ï¸&nbsp;<a class="post-tag" href="/tags/netty/">netty</a></div><div class="post-category">
                
                ğŸ“š&nbsp;<a href="/categories/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/">Nettyæ ¸å¿ƒåŸç†å‰–æä¸RPCå®è·µ</a>
                
            </div></div>
        <div class="post-content">
            <p>ä½ å¥½ï¼Œæˆ‘æ˜¯è‹¥åœ°ã€‚ä¸ŠèŠ‚è¯¾æˆ‘ä»¬ä»‹ç»äº† Netty ä¸­æ ¸å¿ƒç»„ä»¶çš„ä½œç”¨ä»¥åŠç»„ä»¶åä½œçš„æ–¹å¼æ–¹æ³•ã€‚ä»è¿™èŠ‚è¯¾å¼€å§‹ï¼Œæˆ‘ä»¬å°†å¯¹ Netty çš„æ¯ä¸ªæ ¸å¿ƒç»„ä»¶ä¾æ¬¡è¿›è¡Œæ·±å…¥å‰–æè§£è¯»ã€‚æˆ‘ä¼šç»“åˆç›¸åº”çš„ä»£ç ç¤ºä¾‹è®²è§£ï¼Œå¸®åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹ Nettyã€‚</p>
<p>æˆ‘ä»¬åœ¨ä½¿ç”¨ Netty ç¼–å†™ç½‘ç»œåº”ç”¨ç¨‹åºçš„æ—¶å€™ï¼Œä¸€å®šä¼šä»<strong>å¼•å¯¼å™¨ Bootstrap</strong>å¼€å§‹å…¥æ‰‹ã€‚Bootstrap ä½œä¸ºæ•´ä¸ª Netty å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„<strong>ç¨‹åºå…¥å£</strong>ï¼Œå¯ä»¥æŠŠ Netty çš„æ ¸å¿ƒç»„ä»¶åƒæ­ç§¯æœ¨ä¸€æ ·ç»„è£…åœ¨ä¸€èµ·ã€‚æœ¬èŠ‚è¯¾æˆ‘ä¼šä» Netty çš„å¼•å¯¼å™¨<strong>Bootstrap</strong>å‡ºå‘ï¼Œå¸¦ä½ å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Netty è¿›è¡Œæœ€åŸºæœ¬çš„ç¨‹åºå¼€å‘ã€‚</p>
<h3 id="ä»ä¸€ä¸ªç®€å•çš„-http-æœåŠ¡å™¨å¼€å§‹">ä»ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨å¼€å§‹</h3>
<p>HTTP æœåŠ¡å™¨æ˜¯æˆ‘ä»¬å¹³æ—¶æœ€å¸¸ç”¨çš„å·¥å…·ä¹‹ä¸€ã€‚åŒä¼ ç»Ÿ Web å®¹å™¨ Tomcatã€Jetty ä¸€æ ·ï¼ŒNetty ä¹Ÿå¯ä»¥æ–¹ä¾¿åœ°å¼€å‘ä¸€ä¸ª HTTP æœåŠ¡å™¨ã€‚æˆ‘ä»ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨å¼€å§‹ï¼Œé€šè¿‡ç¨‹åºç¤ºä¾‹ä¸ºä½ å±•ç° Netty ç¨‹åºå¦‚ä½•é…ç½®å¯åŠ¨ï¼Œä»¥åŠå¼•å¯¼å™¨å¦‚ä½•ä¸æ ¸å¿ƒç»„ä»¶äº§ç”Ÿè”ç³»ã€‚</p>
<p>å®Œæ•´åœ°å®ç°ä¸€ä¸ªé«˜æ€§èƒ½ã€åŠŸèƒ½å®Œå¤‡ã€å¥å£®æ€§å¼ºçš„ HTTP æœåŠ¡å™¨éå¸¸å¤æ‚ï¼Œæœ¬æ–‡ä»…ä¸ºäº†æ–¹ä¾¿ç†è§£ Netty ç½‘ç»œåº”ç”¨å¼€å‘çš„åŸºæœ¬è¿‡ç¨‹ï¼Œæ‰€ä»¥åªå®ç°æœ€åŸºæœ¬çš„<strong>è¯·æ±‚-å“åº”</strong>çš„æµç¨‹ï¼š</p>
<ol>
<li>æ­å»º HTTP æœåŠ¡å™¨ï¼Œé…ç½®ç›¸å…³å‚æ•°å¹¶å¯åŠ¨ã€‚</li>
<li>ä»æµè§ˆå™¨æˆ–è€…ç»ˆç«¯å‘èµ· HTTP è¯·æ±‚ã€‚</li>
<li>æˆåŠŸå¾—åˆ°æœåŠ¡ç«¯çš„å“åº”ç»“æœã€‚</li>
</ol>
<p>Netty çš„æ¨¡å—åŒ–è®¾è®¡éå¸¸ä¼˜é›…ï¼Œå®¢æˆ·ç«¯æˆ–è€…æœåŠ¡ç«¯çš„å¯åŠ¨æ–¹å¼åŸºæœ¬æ˜¯å›ºå®šçš„ã€‚ä½œä¸ºå¼€å‘è€…æ¥è¯´ï¼Œåªè¦ç…§è‘«èŠ¦ç”»ç“¢å³å¯è½»æ¾ä¸Šæ‰‹ã€‚å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œä½ åªéœ€è¦å®ç°ä¸ä¸šåŠ¡é€»è¾‘ç›¸å…³çš„ä¸€ç³»åˆ— ChannelHandlerï¼Œå†åŠ ä¸Š Netty å·²ç»é¢„ç½®äº† HTTP ç›¸å…³çš„ç¼–è§£ç å™¨å°±å¯ä»¥å¿«é€Ÿå®ŒæˆæœåŠ¡ç«¯æ¡†æ¶çš„æ­å»ºã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸¤ä¸ªç±»å°±å¯ä»¥å®Œæˆä¸€ä¸ªæœ€ç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒä»¬åˆ†åˆ«ä¸º<strong>æœåŠ¡å™¨å¯åŠ¨ç±»</strong>å’Œ<strong>ä¸šåŠ¡é€»è¾‘å¤„ç†ç±»</strong>ï¼Œç»“åˆå®Œæ•´çš„ä»£ç å®ç°æˆ‘å°†å¯¹å®ƒä»¬åˆ†åˆ«è¿›è¡Œè®²è§£ã€‚</p>
<h4 id="æœåŠ¡ç«¯å¯åŠ¨ç±»">æœåŠ¡ç«¯å¯åŠ¨ç±»</h4>
<p>æ‰€æœ‰ Netty æœåŠ¡ç«¯çš„å¯åŠ¨ç±»éƒ½å¯ä»¥é‡‡ç”¨å¦‚ä¸‹ä»£ç ç»“æ„è¿›è¡Œå¼€å‘ã€‚ç®€å•æ¢³ç†ä¸€ä¸‹æµç¨‹ï¼šé¦–å…ˆåˆ›å»ºå¼•å¯¼å™¨ï¼›ç„¶åé…ç½®çº¿ç¨‹æ¨¡å‹ï¼Œé€šè¿‡å¼•å¯¼å™¨ç»‘å®šä¸šåŠ¡é€»è¾‘å¤„ç†å™¨ï¼Œå¹¶é…ç½®ä¸€äº›ç½‘ç»œå‚æ•°ï¼›æœ€åç»‘å®šç«¯å£ï¼Œå°±å¯ä»¥å®ŒæˆæœåŠ¡å™¨çš„å¯åŠ¨äº†ã€‚</p>
<pre tabindex="0"><code>public class HttpServer {

    public void start(int port) throws Exception {

        EventLoopGroup bossGroup = new NioEventLoopGroup();

        EventLoopGroup workerGroup = new NioEventLoopGroup();

        try {

            ServerBootstrap b = new ServerBootstrap();

            b.group(bossGroup, workerGroup)

                    .channel(NioServerSocketChannel.class)

                    .localAddress(new InetSocketAddress(port))

                    .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() {

                        @Override

                        public void initChannel(SocketChannel ch) {

                            ch.pipeline()

                                    .addLast(&quot;codec&quot;, new HttpServerCodec())                  // HTTP ç¼–è§£ç 

                                    .addLast(&quot;compressor&quot;, new HttpContentCompressor())       // HttpContent å‹ç¼©

                                    .addLast(&quot;aggregator&quot;, new HttpObjectAggregator(65536))   // HTTP æ¶ˆæ¯èšåˆ

                                    .addLast(&quot;handler&quot;, new HttpServerHandler());             // è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘å¤„ç†å™¨

                        }

                    })

                    .childOption(ChannelOption.SO_KEEPALIVE, true);

            ChannelFuture f = b.bind().sync();

            System.out.println(&quot;Http Server startedï¼Œ Listening on &quot; + port);

            f.channel().closeFuture().sync();

        } finally {

            workerGroup.shutdownGracefully();

            bossGroup.shutdownGracefully();

        }

    }

    public static void main(String[] args) throws Exception {

        new HttpServer().start(8088);

    }

}
</code></pre><h4 id="æœåŠ¡ç«¯ä¸šåŠ¡é€»è¾‘å¤„ç†ç±»">æœåŠ¡ç«¯ä¸šåŠ¡é€»è¾‘å¤„ç†ç±»</h4>
<p>å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼ŒHttpServerHandler æ˜¯ä¸šåŠ¡è‡ªå®šä¹‰çš„é€»è¾‘å¤„ç†ç±»ã€‚å®ƒæ˜¯å…¥ç«™ ChannelInboundHandler ç±»å‹çš„å¤„ç†å™¨ï¼Œè´Ÿè´£æ¥æ”¶è§£ç åçš„ HTTP è¯·æ±‚æ•°æ®ï¼Œå¹¶å°†è¯·æ±‚å¤„ç†ç»“æœå†™å›å®¢æˆ·ç«¯ã€‚</p>
<pre tabindex="0"><code>public class HttpServerHandler extends SimpleChannelInboundHandler&lt;FullHttpRequest&gt; {

    @Override

    protected void channelRead0(ChannelHandlerContext ctx, FullHttpRequest msg) {

        String content = String.format(&quot;Receive http request, uri: %s, method: %s, content: %s%n&quot;, msg.uri(), msg.method(), msg.content().toString(CharsetUtil.UTF_8));

        FullHttpResponse response = new DefaultFullHttpResponse(

                HttpVersion.HTTP_1_1,

                HttpResponseStatus.OK,

                Unpooled.wrappedBuffer(content.getBytes()));

        ctx.writeAndFlush(response).addListener(ChannelFutureListener.CLOSE);

    }

}
</code></pre><p>é€šè¿‡ä¸Šé¢ä¸¤ä¸ªç±»ï¼Œæˆ‘ä»¬å¯ä»¥å®Œæˆ HTTP æœåŠ¡å™¨æœ€åŸºæœ¬çš„è¯·æ±‚-å“åº”æµç¨‹ï¼Œæµ‹è¯•æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¯åŠ¨ HttpServer çš„ main å‡½æ•°ã€‚</li>
<li>ç»ˆç«¯æˆ–æµè§ˆå™¨å‘èµ· HTTP è¯·æ±‚ã€‚</li>
</ol>
<p>æµ‹è¯•ç»“æœè¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>$ curl http://localhost:8088/abc

$ Receive http request, uri: /abc, method: GET, content:
</code></pre><p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Netty è‡ªè¡Œå®ç° HTTP Clientï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„å¯åŠ¨ç±»ä»£ç ååˆ†ç›¸ä¼¼ï¼Œæˆ‘åœ¨é™„å½•éƒ¨åˆ†æä¾›äº†ä¸€ä»½ HTTPClient çš„å®ç°ä»£ç ä»…ä¾›å¤§å®¶å‚è€ƒã€‚</p>
<p>é€šè¿‡ä¸Šè¿°ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡ç¤ºä¾‹ï¼Œæˆ‘ä»¬åŸºæœ¬ç†Ÿæ‚‰äº† Netty çš„ç¼–ç¨‹æ¨¡å¼ã€‚ä¸‹é¢æˆ‘å°†ç»“åˆè¿™ä¸ªä¾‹å­å¯¹ Netty çš„å¼•å¯¼å™¨å±•å¼€è¯¦ç»†çš„ä»‹ç»ã€‚</p>
<h3 id="å¼•å¯¼å™¨å®è·µæŒ‡å—">å¼•å¯¼å™¨å®è·µæŒ‡å—</h3>
<p>Netty æœåŠ¡ç«¯çš„å¯åŠ¨è¿‡ç¨‹å¤§è‡´åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><strong>é…ç½®çº¿ç¨‹æ± ï¼›</strong></li>
<li><strong>Channel åˆå§‹åŒ–ï¼›</strong></li>
<li><strong>ç«¯å£ç»‘å®šã€‚</strong></li>
</ol>
<p>ä¸‹é¢ï¼Œæˆ‘å°†é€ä¸€ä¸ºå¤§å®¶ä»‹ç»æ¯ä¸€æ­¥å…·ä½“éœ€è¦åšå“ªäº›å·¥ä½œã€‚</p>
<h4 id="é…ç½®çº¿ç¨‹æ± ">é…ç½®çº¿ç¨‹æ± </h4>
<p>Netty æ˜¯é‡‡ç”¨ Reactor æ¨¡å‹è¿›è¡Œå¼€å‘çš„ï¼Œå¯ä»¥éå¸¸å®¹æ˜“åˆ‡æ¢ä¸‰ç§ Reactor æ¨¡å¼ï¼š<strong>å•çº¿ç¨‹æ¨¡å¼</strong>ã€<strong>å¤šçº¿ç¨‹æ¨¡å¼</strong>ã€<strong>ä¸»ä»å¤šçº¿ç¨‹æ¨¡å¼</strong>ã€‚</p>
<h4 id="å•çº¿ç¨‹æ¨¡å¼"><strong>å•çº¿ç¨‹æ¨¡å¼</strong></h4>
<p>Reactor å•çº¿ç¨‹æ¨¡å‹æ‰€æœ‰ I/O æ“ä½œéƒ½ç”±ä¸€ä¸ªçº¿ç¨‹å®Œæˆï¼Œæ‰€ä»¥åªéœ€è¦å¯åŠ¨ä¸€ä¸ª EventLoopGroup å³å¯ã€‚</p>
<pre tabindex="0"><code>EventLoopGroup group = new NioEventLoopGroup(1);

ServerBootstrap b = new ServerBootstrap();

b.group(group)
</code></pre><h4 id="å¤šçº¿ç¨‹æ¨¡å¼"><strong>å¤šçº¿ç¨‹æ¨¡å¼</strong></h4>
<p>Reactor å•çº¿ç¨‹æ¨¡å‹æœ‰éå¸¸ä¸¥é‡çš„æ€§èƒ½ç“¶é¢ˆï¼Œå› æ­¤ Reactor å¤šçº¿ç¨‹æ¨¡å‹å‡ºç°äº†ã€‚åœ¨ Netty ä¸­ä½¿ç”¨ Reactor å¤šçº¿ç¨‹æ¨¡å‹ä¸å•çº¿ç¨‹æ¨¡å‹éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«æ˜¯ NioEventLoopGroup å¯ä»¥ä¸éœ€è¦ä»»ä½•å‚æ•°ï¼Œå®ƒé»˜è®¤ä¼šå¯åŠ¨ 2 å€ CPU æ ¸æ•°çš„çº¿ç¨‹ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±æ‰‹åŠ¨è®¾ç½®å›ºå®šçš„çº¿ç¨‹æ•°ã€‚</p>
<pre tabindex="0"><code>EventLoopGroup group = new NioEventLoopGroup();

ServerBootstrap b = new ServerBootstrap();

b.group(group)
</code></pre><h4 id="ä¸»ä»å¤šçº¿ç¨‹æ¨¡å¼"><strong>ä¸»ä»å¤šçº¿ç¨‹æ¨¡å¼</strong></h4>
<p>åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„éƒ½æ˜¯<strong>ä¸»ä»å¤šçº¿ç¨‹ Reactor æ¨¡å‹</strong>ã€‚Boss æ˜¯ä¸» Reactorï¼ŒWorker æ˜¯ä» Reactorã€‚å®ƒä»¬åˆ†åˆ«ä½¿ç”¨ä¸åŒçš„ NioEventLoopGroupï¼Œä¸» Reactor è´Ÿè´£å¤„ç† Acceptï¼Œç„¶åæŠŠ Channel æ³¨å†Œåˆ°ä» Reactor ä¸Šï¼Œä» Reactor ä¸»è¦è´Ÿè´£ Channel ç”Ÿå‘½å‘¨æœŸå†…çš„æ‰€æœ‰ I/O äº‹ä»¶ã€‚</p>
<pre tabindex="0"><code>EventLoopGroup bossGroup = new NioEventLoopGroup();

EventLoopGroup workerGroup = new NioEventLoopGroup();

ServerBootstrap b = new ServerBootstrap();

b.group(bossGroup, workerGroup)
</code></pre><p>ä»ä¸Šè¿°ä¸‰ç§ Reactor çº¿ç¨‹æ¨¡å‹çš„é…ç½®æ–¹æ³•å¯ä»¥çœ‹å‡ºï¼šNetty çº¿ç¨‹æ¨¡å‹çš„å¯å®šåˆ¶åŒ–ç¨‹åº¦å¾ˆé«˜ã€‚å®ƒåªéœ€è¦ç®€å•é…ç½®ä¸åŒçš„å‚æ•°ï¼Œä¾¿å¯å¯ç”¨ä¸åŒçš„ Reactor çº¿ç¨‹æ¨¡å‹ï¼Œè€Œä¸”æ— éœ€å˜æ›´å…¶ä»–çš„ä»£ç ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šé™ä½äº†ç”¨æˆ·å¼€å‘å’Œè°ƒè¯•çš„æˆæœ¬ã€‚</p>
<h3 id="channel-åˆå§‹åŒ–">Channel åˆå§‹åŒ–</h3>
<h4 id="è®¾ç½®-channel-ç±»å‹">è®¾ç½® Channel ç±»å‹</h4>
<p>NIO æ¨¡å‹æ˜¯ Netty ä¸­æœ€æˆç†Ÿä¸”è¢«å¹¿æ³›ä½¿ç”¨çš„æ¨¡å‹ã€‚å› æ­¤ï¼Œæ¨è Netty æœåŠ¡ç«¯é‡‡ç”¨ NioServerSocketChannel ä½œä¸º Channel çš„ç±»å‹ï¼Œå®¢æˆ·ç«¯é‡‡ç”¨ NioSocketChannelã€‚è®¾ç½®æ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code> b.channel(NioServerSocketChannel.class);
</code></pre><p>å½“ç„¶ï¼ŒNetty æä¾›äº†å¤šç§ç±»å‹çš„ Channel å®ç°ç±»ï¼Œä½ å¯ä»¥æŒ‰éœ€åˆ‡æ¢ï¼Œä¾‹å¦‚ OioServerSocketChannelã€EpollServerSocketChannel ç­‰ã€‚</p>
<h4 id="æ³¨å†Œ-channelhandler">æ³¨å†Œ ChannelHandler</h4>
<p>åœ¨ Netty ä¸­å¯ä»¥é€šè¿‡ ChannelPipeline å»æ³¨å†Œå¤šä¸ª ChannelHandlerï¼Œæ¯ä¸ª ChannelHandler å„å¸å…¶èŒï¼Œè¿™æ ·å°±å¯ä»¥å®ç°æœ€å¤§åŒ–çš„ä»£ç å¤ç”¨ï¼Œå……åˆ†ä½“ç°äº† Netty è®¾è®¡çš„ä¼˜é›…ä¹‹å¤„ã€‚é‚£ä¹ˆå¦‚ä½•é€šè¿‡å¼•å¯¼å™¨æ·»åŠ å¤šä¸ª ChannelHandler å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬çœ‹ä¸‹ HTTP æœåŠ¡å™¨ä»£ç ç¤ºä¾‹ï¼š</p>
<pre tabindex="0"><code>b.childHandler(new ChannelInitializer&lt;SocketChannel&gt;() {

    @Override

    public void initChannel(SocketChannel ch) {

        ch.pipeline()

                .addLast(&quot;codec&quot;, new HttpServerCodec())

                .addLast(&quot;compressor&quot;, new HttpContentCompressor())

                .addLast(&quot;aggregator&quot;, new HttpObjectAggregator(65536)) 

                .addLast(&quot;handler&quot;, new HttpServerHandler());

    }

})
</code></pre><p>ServerBootstrap çš„ childHandler() æ–¹æ³•éœ€è¦æ³¨å†Œä¸€ä¸ª ChannelHandlerã€‚<strong>ChannelInitializer</strong>æ˜¯å®ç°äº† ChannelHandler<strong>æ¥å£çš„åŒ¿åç±»</strong>ï¼Œé€šè¿‡å®ä¾‹åŒ– ChannelInitializer ä½œä¸º ServerBootstrap çš„å‚æ•°ã€‚</p>
<p>Channel åˆå§‹åŒ–æ—¶éƒ½ä¼šç»‘å®šä¸€ä¸ª Pipelineï¼Œå®ƒä¸»è¦ç”¨äºæœåŠ¡ç¼–æ’ã€‚Pipeline ç®¡ç†äº†å¤šä¸ª ChannelHandlerã€‚I/O äº‹ä»¶ä¾æ¬¡åœ¨ ChannelHandler ä¸­ä¼ æ’­ï¼ŒChannelHandler è´Ÿè´£ä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚ä¸Šè¿° HTTP æœåŠ¡å™¨ç¤ºä¾‹ä¸­ä½¿ç”¨é“¾å¼çš„æ–¹å¼åŠ è½½äº†å¤šä¸ª ChannelHandlerï¼ŒåŒ…å«<strong>HTTP ç¼–è§£ç å¤„ç†å™¨ã€HTTPContent å‹ç¼©å¤„ç†å™¨ã€HTTP æ¶ˆæ¯èšåˆå¤„ç†å™¨ã€è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘å¤„ç†å™¨</strong>ã€‚</p>
<p>åœ¨ä»¥å‰çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† ChannelPipeline ä¸­<strong>å…¥ç«™ ChannelInboundHandler</strong>å’Œ<strong>å‡ºç«™ ChannelOutboundHandler</strong>çš„æ¦‚å¿µï¼Œåœ¨è¿™é‡Œç»“åˆ HTTP è¯·æ±‚-å“åº”çš„åœºæ™¯ï¼Œåˆ†æä¸‹æ•°æ®åœ¨ ChannelPipeline ä¸­çš„æµå‘ã€‚å½“æœåŠ¡ç«¯æ”¶åˆ° HTTP è¯·æ±‚åï¼Œä¼šä¾æ¬¡ç»è¿‡ HTTP ç¼–è§£ç å¤„ç†å™¨ã€HTTPContent å‹ç¼©å¤„ç†å™¨ã€HTTP æ¶ˆæ¯èšåˆå¤„ç†å™¨ã€è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘å¤„ç†å™¨åˆ†åˆ«å¤„ç†åï¼Œå†å°†æœ€ç»ˆç»“æœé€šè¿‡ HTTPContent å‹ç¼©å¤„ç†å™¨ã€HTTP ç¼–è§£ç å¤„ç†å™¨å†™å›å®¢æˆ·ç«¯ã€‚</p>
<h4 id="è®¾ç½®-channel-å‚æ•°">è®¾ç½® Channel å‚æ•°</h4>
<p>Netty æä¾›äº†ååˆ†ä¾¿æ·çš„æ–¹æ³•ï¼Œç”¨äºè®¾ç½® Channel å‚æ•°ã€‚å…³äº Channel çš„å‚æ•°æ•°é‡éå¸¸å¤šï¼Œå¦‚æœæ¯ä¸ªå‚æ•°éƒ½éœ€è¦è‡ªå·±è®¾ç½®ï¼Œé‚£ä¼šéå¸¸ç¹çã€‚å¹¸è¿çš„æ˜¯ Netty æä¾›äº†é»˜è®¤å‚æ•°è®¾ç½®ï¼Œå®é™…åœºæ™¯ä¸‹é»˜è®¤å‚æ•°å·²ç»æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæˆ‘ä»¬ä»…éœ€è¦ä¿®æ”¹è‡ªå·±å…³ç³»çš„å‚æ•°å³å¯ã€‚</p>
<pre tabindex="0"><code>b.option(ChannelOption.SO_KEEPALIVE, true);
</code></pre><p>ServerBootstrap è®¾ç½® Channel å±æ€§æœ‰<strong>option</strong>å’Œ<strong>childOption</strong>ä¸¤ä¸ªæ–¹æ³•ï¼Œoption ä¸»è¦è´Ÿè´£è®¾ç½® Boss çº¿ç¨‹ç»„ï¼Œè€Œ childOption å¯¹åº”çš„æ˜¯ Worker çº¿ç¨‹ç»„ã€‚</p>
<p>è¿™é‡Œæˆ‘åˆ—ä¸¾äº†ç»å¸¸ä½¿ç”¨çš„å‚æ•°å«ä¹‰ï¼Œä½ å¯ä»¥ç»“åˆä¸šåŠ¡åœºæ™¯ï¼ŒæŒ‰éœ€è®¾ç½®ã€‚</p>
<p>å‚æ•°</p>
<p>å«ä¹‰</p>
<p>SO_KEEPALIVE</p>
<p>è®¾ç½®ä¸º true ä»£è¡¨å¯ç”¨äº† TCP SO_KEEPALIVE å±æ€§ï¼ŒTCP ä¼šä¸»åŠ¨æ¢æµ‹è¿æ¥çŠ¶æ€ï¼Œå³è¿æ¥ä¿æ´»</p>
<p>SO_BACKLOG</p>
<p>å·²å®Œæˆä¸‰æ¬¡æ¡æ‰‹çš„è¯·æ±‚é˜Ÿåˆ—æœ€å¤§é•¿åº¦ï¼ŒåŒä¸€æ—¶åˆ»æœåŠ¡ç«¯å¯èƒ½ä¼šå¤„ç†å¤šä¸ªè¿æ¥ï¼Œåœ¨é«˜å¹¶å‘æµ·é‡è¿æ¥çš„åœºæ™¯ä¸‹ï¼Œè¯¥å‚æ•°åº”é€‚å½“è°ƒå¤§</p>
<p>TCP_NODELAY</p>
<p>Netty é»˜è®¤æ˜¯ trueï¼Œè¡¨ç¤ºç«‹å³å‘é€æ•°æ®ã€‚å¦‚æœè®¾ç½®ä¸º false è¡¨ç¤ºå¯ç”¨ Nagle ç®—æ³•ï¼Œè¯¥ç®—æ³•ä¼šå°† TCP ç½‘ç»œæ•°æ®åŒ…ç´¯ç§¯åˆ°ä¸€å®šé‡æ‰ä¼šå‘é€ï¼Œè™½ç„¶å¯ä»¥å‡å°‘æŠ¥æ–‡å‘é€çš„æ•°é‡ï¼Œä½†æ˜¯ä¼šé€ æˆä¸€å®šçš„æ•°æ®å»¶è¿Ÿã€‚Netty ä¸ºäº†æœ€å°åŒ–æ•°æ®ä¼ è¾“çš„å»¶è¿Ÿï¼Œé»˜è®¤ç¦ç”¨äº† Nagle ç®—æ³•</p>
<p>SO_SNDBUF</p>
<p>TCP æ•°æ®å‘é€ç¼“å†²åŒºå¤§å°</p>
<p>SO_RCVBUF</p>
<p>TCPæ•°æ®æ¥æ”¶ç¼“å†²åŒºå¤§å°ï¼ŒTCPæ•°æ®æ¥æ”¶ç¼“å†²åŒºå¤§å°</p>
<p>SO_LINGER</p>
<p>è®¾ç½®å»¶è¿Ÿå…³é—­çš„æ—¶é—´ï¼Œç­‰å¾…ç¼“å†²åŒºä¸­çš„æ•°æ®å‘é€å®Œæˆ</p>
<p>CONNECT_TIMEOUT_MILLIS</p>
<p>å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´</p>
<h4 id="ç«¯å£ç»‘å®š">ç«¯å£ç»‘å®š</h4>
<p>åœ¨å®Œæˆä¸Šè¿° Netty çš„é…ç½®ä¹‹åï¼Œbind() æ–¹æ³•ä¼šçœŸæ­£è§¦å‘å¯åŠ¨ï¼Œsync() æ–¹æ³•åˆ™ä¼šé˜»å¡ï¼Œç›´è‡³æ•´ä¸ªå¯åŠ¨è¿‡ç¨‹å®Œæˆï¼Œå…·ä½“ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>ChannelFuture f = b.bind().sync();
</code></pre><p>bind() æ–¹æ³•æ¶‰åŠçš„ç»†èŠ‚æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬å°†åœ¨ã€Šæºç ç¯‡ï¼šä» Linux å‡ºå‘æ·±å…¥å‰–ææœåŠ¡ç«¯å¯åŠ¨æµç¨‹ã€‹è¯¾ç¨‹ä¸­åšè¯¦ç»†åœ°è§£æï¼Œåœ¨è¿™é‡Œå°±å…ˆä¸åšå±•å¼€äº†ã€‚</p>
<p>å…³äºå¦‚ä½•ä½¿ç”¨å¼•å¯¼å™¨å¼€å‘ä¸€ä¸ª Netty ç½‘ç»œåº”ç”¨æˆ‘ä»¬å°±ä»‹ç»å®Œäº†ï¼ŒæœåŠ¡ç«¯çš„å¯åŠ¨è¿‡ç¨‹ä¸€å®šç¦»ä¸å¼€é…ç½®çº¿ç¨‹æ± ã€Channel åˆå§‹åŒ–ã€ç«¯å£ç»‘å®šä¸‰ä¸ªæ­¥éª¤ï¼Œåœ¨ Channel åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­æœ€é‡è¦çš„å°±æ˜¯ç»‘å®šç”¨æˆ·å®ç°çš„è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘ã€‚æ˜¯ä¸æ˜¯ç‰¹åˆ«ç®€å•ï¼Ÿä½ å¯ä»¥å‚è€ƒæœ¬èŠ‚è¯¾çš„ç¤ºä¾‹ï¼Œè‡ªå·±å°è¯•å¼€å‘ä¸€ä¸ªç®€å•çš„ç¨‹åºç»ƒç»ƒæ‰‹ã€‚</p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>æœ¬èŠ‚è¯¾æˆ‘ä»¬å›´ç»• Netty çš„å¼•å¯¼å™¨ï¼Œå­¦ä¹ äº†å¦‚ä½•å¼€å‘æœ€åŸºæœ¬çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚å¼•å¯¼å™¨ä¸²æ¥äº† Netty çš„æ‰€æœ‰æ ¸å¿ƒç»„ä»¶ï¼Œé€šè¿‡å¼•å¯¼å™¨ä½œä¸ºå­¦ä¹  Netty çš„åˆ‡å…¥ç‚¹æœ‰åŠ©äºæˆ‘ä»¬å¿«é€Ÿä¸Šæ‰‹ã€‚Netty çš„å¼•å¯¼å™¨ä½œä¸ºä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„å·¥å…·ï¼Œé¿å…æˆ‘ä»¬å†å»æ‰‹åŠ¨å®Œæˆç¹ççš„ Channel çš„åˆ›å»ºå’Œé…ç½®ç­‰è¿‡ç¨‹ï¼Œå…¶ä¸­æœ‰å¾ˆå¤šçŸ¥è¯†ç‚¹å¯ä»¥æ·±æŒ–ï¼Œåœ¨åç»­æºç ç« èŠ‚ä¸­æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢å®ƒçš„å®ç°åŸç†ã€‚</p>
<h3 id="é™„å½•">é™„å½•</h3>
<h4 id="http-å®¢æˆ·ç«¯ç±»">HTTP å®¢æˆ·ç«¯ç±»</h4>
<pre tabindex="0"><code>public class HttpClient {

    public void connect(String host, int port) throws Exception {

        EventLoopGroup group = new NioEventLoopGroup();

        try {

            Bootstrap b = new Bootstrap();

            b.group(group);

            b.channel(NioSocketChannel.class);

            b.option(ChannelOption.SO_KEEPALIVE, true);

            b.handler(new ChannelInitializer&lt;SocketChannel&gt;() {

                @Override

                public void initChannel(SocketChannel ch) {

                    ch.pipeline().addLast(new HttpResponseDecoder());

                    ch.pipeline().addLast(new HttpRequestEncoder());

                    ch.pipeline().addLast(new HttpClientHandler());

                }

            });

            ChannelFuture f = b.connect(host, port).sync();

            URI uri = new URI(&quot;http://127.0.0.1:8088&quot;);

            String content = &quot;hello world&quot;;

            DefaultFullHttpRequest request = new DefaultFullHttpRequest(HttpVersion.HTTP_1_1, HttpMethod.GET,

                    uri.toASCIIString(), Unpooled.wrappedBuffer(content.getBytes(StandardCharsets.UTF_8)));

            request.headers().set(HttpHeaderNames.HOST, host);

            request.headers().set(HttpHeaderNames.CONNECTION, HttpHeaderValues.KEEP_ALIVE);

            request.headers().set(HttpHeaderNames.CONTENT_LENGTH, request.content().readableBytes());

            f.channel().write(request);

            f.channel().flush();

            f.channel().closeFuture().sync();

        } finally {

            group.shutdownGracefully();

        }

    }

    public static void main(String[] args) throws Exception {

        HttpClient client = new HttpClient();

        client.connect(&quot;127.0.0.1&quot;, 8088);

    }

}
</code></pre><h4 id="å®¢æˆ·ç«¯ä¸šåŠ¡å¤„ç†ç±»">å®¢æˆ·ç«¯ä¸šåŠ¡å¤„ç†ç±»</h4>
<pre tabindex="0"><code>public class HttpClientHandler extends ChannelInboundHandlerAdapter {

    @Override

    public void channelRead(ChannelHandlerContext ctx, Object msg) {

        if (msg instanceof HttpContent) {

            HttpContent content = (HttpContent) msg;

            ByteBuf buf = content.content();

            System.out.println(buf.toString(io.netty.util.CharsetUtil.UTF_8));

            buf.release();

        }

    }

}
</code></pre>
        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/02-%E7%BA%B5%E8%A7%88%E5%85%A8%E5%B1%80%E6%8A%8A%E6%8F%A1-netty-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E8%84%89%E7%BB%9C/"><span>02 çºµè§ˆå…¨å±€ï¼šæŠŠæ¡ Netty æ•´ä½“æ¶æ„è„‰ç»œ</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/04-%E4%BA%8B%E4%BB%B6%E8%B0%83%E5%BA%A6%E5%B1%82%E4%B8%BA%E4%BB%80%E4%B9%88-eventloop-%E6%98%AF-netty-%E7%9A%84%E7%B2%BE%E9%AB%93/"><span>04 äº‹ä»¶è°ƒåº¦å±‚ï¼šä¸ºä»€ä¹ˆ EventLoop æ˜¯ Netty çš„ç²¾é«“ï¼Ÿ</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 28280 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>