<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<link rel="icon" type="image/png" href="/%20/favicon.png">

<title>24 æœåŠ¡å‘å¸ƒä¸è®¢é˜…ï¼šæ­å»ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åŸºç¡€æ¡†æ¶ | Yipsen Ye</title>
<meta name="description" content="ä»æœ¬èŠ‚è¯¾å¼€å§‹ï¼Œæˆ‘ä»¬å¼€å§‹åŠ¨æ‰‹å¼€å‘ä¸€ä¸ªå®Œæ•´çš„ RPC æ¡†æ¶åŸå‹ï¼Œé€šè¿‡æ•´ä¸ªå®è·µè¯¾ç¨‹çš„å­¦ä¹ ï¼Œä½ ä¸ä»…å¯ä»¥ç†Ÿæ‚‰ RPC çš„å®ç°åŸç†ï¼Œè€Œä¸”å¯ä»¥å¯¹ä¹‹å‰ Netty åŸºç¡€çŸ¥è¯†åŠ æ·±ç†è§£ï¼ŒåŒæ ·åœ¨å·¥ä½œä¸­ä¹Ÿå¯ä»¥å­¦ä»¥è‡´ç”¨ã€‚
æˆ‘ä¼šä»æœåŠ¡å‘å¸ƒä¸è®¢é˜…ã€è¿œç¨‹é€šä¿¡ã€æœåŠ¡æ²»ç†ã€åŠ¨æ€ä»£ç†å››ä¸ªæ–¹é¢è¯¦ç»†åœ°ä»‹ç»ä¸€ä¸ªé€šç”¨ RPC æ¡†æ¶çš„å®ç°è¿‡ç¨‹ï¼Œç›¸ä¿¡ä½ åªè¦åšæŒå®Œæˆæœ¬æ¬¡å®è·µè¯¾ï¼Œä¹‹åä½ å†ç‹¬ç«‹å®Œæˆå·¥ä½œä¸­é¡¹ç›®ç ”å‘ä¼šå˜å¾—æ›´åŠ å®¹æ˜“ã€‚ä½ æ˜¯ä¸æ˜¯å·²ç»è¿«ä¸åŠå¾…åœ°æƒ³åŠ¨æ‰‹äº†å‘¢ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·å¼€å§‹å§ï¼
 æºç å‚è€ƒåœ°å€ï¼šmini-rpc
 ç¯å¢ƒæ­å»º å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ­å»ºæˆ‘ä»¬çš„å¼€å‘ç¯å¢ƒï¼Œè¿™æ˜¯æ¯ä¸ªç¨‹åºå‘˜çš„å¿…å¤‡æŠ€èƒ½ã€‚ä»¥ä¸‹æ˜¯æˆ‘çš„æœ¬æœºç¯å¢ƒæ¸…å•ï¼Œä»…ä¾›å‚è€ƒã€‚
 æ“ä½œç³»ç»Ÿï¼šMacOS Big Surï¼Œ11.0.1ã€‚ é›†æˆå¼€å‘å·¥å…·ï¼šIntelliJ IDEA 2020.3ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹© eclipseã€‚ é¡¹ç›®æŠ€æœ¯æ ˆï¼šSpringBoot 2.1.12.RELEASE &#43; JDK 1.8.0_221 &#43; Netty 4.1.42.Finalã€‚ é¡¹ç›®ä¾èµ–ç®¡ç†å·¥å…·ï¼šMaven 3.5.4ï¼Œä½ å¯ä»¥ç‹¬ç«‹å®‰è£… Maven æˆ–è€…ä½¿ç”¨ IDEA çš„é›†æˆç‰ˆï¼Œç‹¬ç«‹å®‰è£…çš„ Maven éœ€è¦é…ç½® MAVEN_HOME å’Œ PATH ç¯å¢ƒå˜é‡ã€‚ æ³¨å†Œä¸­å¿ƒï¼šZookeeeper 3.4.14ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ Zookeeeper å’Œ Apache Curator ä¸€å®šè¦æ­é…ä½¿ç”¨ï¼ŒZookeeper 3.4.x ç‰ˆæœ¬ï¼ŒApache Curator åªæœ‰ 2.x.x æ‰èƒ½æ”¯æŒã€‚  é¡¹ç›®ç»“æ„ åœ¨åŠ¨æ‰‹å¼€å‘é¡¹ç›®ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹é¡¹ç›®ç»“æ„æœ‰æ¸…æ™°çš„æ„æ€ã€‚æ ¹æ®ä¸ŠèŠ‚è¯¾ä»‹ç»çš„ RPC æ¡†æ¶è®¾è®¡æ¶æ„ï¼Œæˆ‘ä»¬å¯ä»¥å°†é¡¹ç›®ç»“æ„åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ¨¡å—ã€‚
å…¶ä¸­æ¯ä¸ªæ¨¡å—éƒ½æ˜¯ä»€ä¹ˆè§’è‰²å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬ä¸€ä¸€è¿›è¡Œä»‹ç»ã€‚
 rpc-providerï¼ŒæœåŠ¡æä¾›è€…ã€‚è´Ÿè´£å‘å¸ƒ RPC æœåŠ¡ï¼Œæ¥æ”¶å’Œå¤„ç† RPC è¯·æ±‚ã€‚ rpc-consumerï¼ŒæœåŠ¡æ¶ˆè´¹è€…ã€‚ä½¿ç”¨åŠ¨æ€ä»£ç†å‘èµ· RPC è¿œç¨‹è°ƒç”¨ï¼Œå¸®åŠ©ä½¿ç”¨è€…æ¥å±è”½åº•å±‚ç½‘ç»œé€šä¿¡çš„ç»†èŠ‚ã€‚ rpc-registryï¼Œæ³¨å†Œä¸­å¿ƒæ¨¡å—ã€‚æä¾›æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡çš„åŸºæœ¬åŠŸèƒ½ã€‚ rpc-protocolï¼Œç½‘ç»œé€šä¿¡æ¨¡å—ã€‚åŒ…å« RPC åè®®çš„ç¼–è§£ç å™¨ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–å·¥å…·ç­‰ã€‚ rpc-coreï¼ŒåŸºç¡€ç±»åº“ã€‚æä¾›é€šç”¨çš„å·¥å…·ç±»ä»¥åŠæ¨¡å‹å®šä¹‰ï¼Œä¾‹å¦‚ RPC è¯·æ±‚å’Œå“åº”ç±»ã€RPC æœåŠ¡å…ƒæ•°æ®ç±»ç­‰ã€‚ rpc-facadeï¼ŒRPC æœåŠ¡æ¥å£ã€‚åŒ…å«æœåŠ¡æä¾›è€…éœ€è¦å¯¹å¤–æš´éœ²çš„æ¥å£ï¼Œæœ¬æ¨¡å—ä¸»è¦ç”¨äºæ¨¡æ‹ŸçœŸå® RPC è°ƒç”¨çš„æµ‹è¯•ã€‚  å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ¸…æ¥šå„ä¸ªæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ‰èƒ½å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°æ¢³ç† Maven çš„ pom å®šä¹‰ã€‚rpc-core æ˜¯æœ€åŸºç¡€çš„ç±»åº“ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ¨¡å—éƒ½ä¾èµ–å®ƒã€‚rpc-consumer ç”¨äºå‘èµ· RPC è°ƒç”¨ã€‚rpc-provider è´Ÿè´£å¤„ç† RPC è¯·æ±‚ï¼Œå¦‚æœä¸çŸ¥é“è¿œç¨‹æœåŠ¡çš„åœ°å€ï¼Œé‚£ä¹ˆä¸€åˆ‡éƒ½æ˜¯ç©ºè°ˆäº†ï¼Œæ‰€ä»¥ä¸¤è€…éƒ½éœ€è¦ä¾èµ– rpc-registry æä¾›çš„æœåŠ¡å‘ç°å’ŒæœåŠ¡æ³¨å†Œçš„èƒ½åŠ›ã€‚">
<meta name="author" content="">

<link rel="stylesheet" type="text/css" href="/styles/main.css">

</head>

<body id="page">
    <header>
        <div class="logo-link" style="width: 60px; color: #CA6924;">
    <a href="http://yipsen.github.io/">
        <img style="margin-bottom: -1rem;" src="/images/deer.svg" alt="logo">
        <span style="font-size: 0.5rem; color: #CA6924;">Yipsen Ye</span>
    </a>
</div>
<nav class="navbar justify-content-end">
    <ul class="nav-list">
        
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/posts/">æœ­è®°</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/collections/">é™„è¡¨</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link"
                href="http://yipsen.github.io/about/">å…³äº</a>
        </li>
        
    </ul>
</nav>
    </header>
    <main id="content">
        
<div class="container"><aside>
    <div>
        
        
            
            
            <div class="post-category-icon"></div>
            <a href="/categories/netty%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86%e5%89%96%e6%9e%90%e4%b8%8erpc%e5%ae%9e%e8%b7%b5/">Nettyæ ¸å¿ƒåŸç†å‰–æä¸RPCå®è·µ</a>
            <ul>
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/00-%E5%AD%A6%E5%A5%BD-netty%E6%98%AF%E4%BD%A0%E4%BF%AE%E7%82%BC-java-%E5%86%85%E5%8A%9F%E7%9A%84%E5%BF%85%E7%BB%8F%E4%B9%8B%E8%B7%AF/">00 å­¦å¥½ Nettyï¼Œæ˜¯ä½ ä¿®ç‚¼ Java å†…åŠŸçš„å¿…ç»ä¹‹è·¯</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/01-%E5%88%9D%E8%AF%86-netty%E4%B8%BA%E4%BB%80%E4%B9%88-netty-%E8%BF%99%E4%B9%88%E6%B5%81%E8%A1%8C/">01 åˆè¯† Nettyï¼šä¸ºä»€ä¹ˆ Netty è¿™ä¹ˆæµè¡Œï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/02-%E7%BA%B5%E8%A7%88%E5%85%A8%E5%B1%80%E6%8A%8A%E6%8F%A1-netty-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E8%84%89%E7%BB%9C/">02 çºµè§ˆå…¨å±€ï¼šæŠŠæ¡ Netty æ•´ä½“æ¶æ„è„‰ç»œ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/03-%E5%BC%95%E5%AF%BC%E5%99%A8%E4%BD%9C%E7%94%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%90%AF%E5%8A%A8%E9%83%BD%E8%A6%81%E5%81%9A%E4%BA%9B%E4%BB%80%E4%B9%88/">03 å¼•å¯¼å™¨ä½œç”¨ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯åŠ¨éƒ½è¦åšäº›ä»€ä¹ˆï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/04-%E4%BA%8B%E4%BB%B6%E8%B0%83%E5%BA%A6%E5%B1%82%E4%B8%BA%E4%BB%80%E4%B9%88-eventloop-%E6%98%AF-netty-%E7%9A%84%E7%B2%BE%E9%AB%93/">04 äº‹ä»¶è°ƒåº¦å±‚ï¼šä¸ºä»€ä¹ˆ EventLoop æ˜¯ Netty çš„ç²¾é«“ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/05-%E6%9C%8D%E5%8A%A1%E7%BC%96%E6%8E%92%E5%B1%82pipeline-%E5%A6%82%E4%BD%95%E5%8D%8F%E8%B0%83%E5%90%84%E7%B1%BB-handler-/">05 æœåŠ¡ç¼–æ’å±‚ï¼šPipeline å¦‚ä½•åè°ƒå„ç±» Handler ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/06-%E7%B2%98%E5%8C%85%E6%8B%86%E5%8C%85%E9%97%AE%E9%A2%98%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E7%9A%84%E7%BD%91%E7%BB%9C%E5%8C%85/">06 ç²˜åŒ…æ‹†åŒ…é—®é¢˜ï¼šå¦‚ä½•è·å–ä¸€ä¸ªå®Œæ•´çš„ç½‘ç»œåŒ…ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/07-%E6%8E%A5%E5%A4%B4%E6%9A%97%E8%AF%AD%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8-netty-%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%8F%E8%AE%AE%E9%80%9A%E4%BF%A1/">07 æ¥å¤´æš—è¯­ï¼šå¦‚ä½•åˆ©ç”¨ Netty å®ç°è‡ªå®šä¹‰åè®®é€šä¿¡ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/08-%E5%BC%80%E7%AE%B1%E5%8D%B3%E7%94%A8netty-%E6%94%AF%E6%8C%81%E5%93%AA%E4%BA%9B%E5%B8%B8%E7%94%A8%E7%9A%84%E8%A7%A3%E7%A0%81%E5%99%A8/">08 å¼€ç®±å³ç”¨ï¼šNetty æ”¯æŒå“ªäº›å¸¸ç”¨çš„è§£ç å™¨ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/09-%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93writeandflush-%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%E5%89%96%E6%9E%90/">09 æ•°æ®ä¼ è¾“ï¼šwriteAndFlush å¤„ç†æµç¨‹å‰–æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/10-%E5%8F%8C%E5%88%83%E5%89%91%E5%90%88%E7%90%86%E7%AE%A1%E7%90%86-netty-%E5%A0%86%E5%A4%96%E5%86%85%E5%AD%98/">10 åŒåˆƒå‰‘ï¼šåˆç†ç®¡ç† Netty å †å¤–å†…å­˜</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/11-%E5%8F%A6%E8%B5%B7%E7%82%89%E7%81%B6netty-%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E8%BD%BD%E4%BD%93-bytebuf-%E8%AF%A6%E8%A7%A3/">11 å¦èµ·ç‚‰ç¶ï¼šNetty æ•°æ®ä¼ è¾“è½½ä½“ ByteBuf è¯¦è§£</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/12-%E4%BB%96%E5%B1%B1%E4%B9%8B%E7%9F%B3%E9%AB%98%E6%80%A7%E8%83%BD%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E5%99%A8-jemalloc-%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/">12 ä»–å±±ä¹‹çŸ³ï¼šé«˜æ€§èƒ½å†…å­˜åˆ†é…å™¨ jemalloc åŸºæœ¬åŸç†</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/13-%E4%B8%BE%E4%B8%80%E5%8F%8D%E4%B8%89netty-%E9%AB%98%E6%80%A7%E8%83%BD%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E8%AE%BE%E8%AE%A1%E4%B8%8A/">13 ä¸¾ä¸€åä¸‰ï¼šNetty é«˜æ€§èƒ½å†…å­˜ç®¡ç†è®¾è®¡ï¼ˆä¸Šï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/14-%E4%B8%BE%E4%B8%80%E5%8F%8D%E4%B8%89netty-%E9%AB%98%E6%80%A7%E8%83%BD%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E8%AE%BE%E8%AE%A1%E4%B8%8B/">14 ä¸¾ä¸€åä¸‰ï¼šNetty é«˜æ€§èƒ½å†…å­˜ç®¡ç†è®¾è®¡ï¼ˆä¸‹ï¼‰</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/15-%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%AF%B9%E8%B1%A1%E5%9B%9E%E6%94%B6%E7%AB%99recycler-%E5%AF%B9%E8%B1%A1%E6%B1%A0%E6%8A%80%E6%9C%AF%E8%A7%A3%E6%9E%90/">15 è½»é‡çº§å¯¹è±¡å›æ”¶ç«™ï¼šRecycler å¯¹è±¡æ± æŠ€æœ¯è§£æ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/16-io-%E5%8A%A0%E9%80%9F%E4%B8%8E%E4%BC%97%E4%B8%8D%E5%90%8C%E7%9A%84-netty-%E9%9B%B6%E6%8B%B7%E8%B4%9D%E6%8A%80%E6%9C%AF/">16 IO åŠ é€Ÿï¼šä¸ä¼—ä¸åŒçš„ Netty é›¶æ‹·è´æŠ€æœ¯</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/17-%E6%BA%90%E7%A0%81%E7%AF%87%E4%BB%8E-linux-%E5%87%BA%E5%8F%91%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/">17 æºç ç¯‡ï¼šä» Linux å‡ºå‘æ·±å…¥å‰–ææœåŠ¡ç«¯å¯åŠ¨æµç¨‹</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/18-%E6%BA%90%E7%A0%81%E7%AF%87%E8%A7%A3%E5%AF%86-netty-reactor-%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/">18 æºç ç¯‡ï¼šè§£å¯† Netty Reactor çº¿ç¨‹æ¨¡å‹</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/19-%E6%BA%90%E7%A0%81%E7%AF%87%E4%B8%80%E4%B8%AA%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%9C%A8-netty-%E4%B8%AD%E7%9A%84%E6%97%85%E7%A8%8B/">19 æºç ç¯‡ï¼šä¸€ä¸ªç½‘ç»œè¯·æ±‚åœ¨ Netty ä¸­çš„æ—…ç¨‹</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/20-%E6%8A%80%E5%B7%A7%E7%AF%87netty-%E7%9A%84-fastthreadlocal-%E7%A9%B6%E7%AB%9F%E6%AF%94-threadlocal-%E5%BF%AB%E5%9C%A8%E5%93%AA%E5%84%BF/">20 æŠ€å·§ç¯‡ï¼šNetty çš„ FastThreadLocal ç©¶ç«Ÿæ¯” ThreadLocal å¿«åœ¨å“ªå„¿ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/21-%E6%8A%80%E5%B7%A7%E7%AF%87%E5%BB%B6%E8%BF%9F%E4%BB%BB%E5%8A%A1%E5%A4%84%E7%90%86%E7%A5%9E%E5%99%A8%E4%B9%8B%E6%97%B6%E9%97%B4%E8%BD%AE-hashedwheeltimer/">21 æŠ€å·§ç¯‡ï¼šå»¶è¿Ÿä»»åŠ¡å¤„ç†ç¥å™¨ä¹‹æ—¶é—´è½® HashedWheelTimer</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/22-%E6%8A%80%E5%B7%A7%E7%AF%87%E9%AB%98%E6%80%A7%E8%83%BD%E6%97%A0%E9%94%81%E9%98%9F%E5%88%97-mpsc-queue/">22 æŠ€å·§ç¯‡ï¼šé«˜æ€§èƒ½æ— é”é˜Ÿåˆ— Mpsc Queue</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/23-%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%AB%98%E6%80%A7%E8%83%BD%E5%88%86%E5%B8%83%E5%BC%8F-rpc-%E6%A1%86%E6%9E%B6/">23 æ¶æ„è®¾è®¡ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªé«˜æ€§èƒ½åˆ†å¸ƒå¼ RPC æ¡†æ¶</a></li>
                
                
                
                    <li>24 æœåŠ¡å‘å¸ƒä¸è®¢é˜…ï¼šæ­å»ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åŸºç¡€æ¡†æ¶</li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/25-%E8%BF%9C%E7%A8%8B%E9%80%9A%E4%BF%A1%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE%E8%AE%BE%E8%AE%A1%E4%BB%A5%E5%8F%8A%E7%BC%96%E8%A7%A3%E7%A0%81%E7%9A%84%E5%AE%9E%E7%8E%B0/">25 è¿œç¨‹é€šä¿¡ï¼šé€šä¿¡åè®®è®¾è®¡ä»¥åŠç¼–è§£ç çš„å®ç°</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/26-%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E4%B8%8E%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%BA%E5%88%B6%E7%9A%84%E5%AE%9E%E7%8E%B0/">26 æœåŠ¡æ²»ç†ï¼šæœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡æœºåˆ¶çš„å®ç°</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/27-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E4%B8%BA%E7%94%A8%E6%88%B7%E5%B1%8F%E8%94%BD-rpc-%E8%B0%83%E7%94%A8%E7%9A%84%E5%BA%95%E5%B1%82%E7%BB%86%E8%8A%82/">27 åŠ¨æ€ä»£ç†ï¼šä¸ºç”¨æˆ·å±è”½ RPC è°ƒç”¨çš„åº•å±‚ç»†èŠ‚</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/28-%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%93rpc-%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%93%E4%B8%8E%E8%BF%9B%E9%98%B6%E5%BB%B6%E4%BC%B8/">28 å®æˆ˜æ€»ç»“ï¼šRPC å®æˆ˜æ€»ç»“ä¸è¿›é˜¶å»¶ä¼¸</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/29-%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3netty-%E4%B8%AD%E5%BA%94%E7%94%A8%E4%BA%86%E5%93%AA%E4%BA%9B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">29 ç¼–ç¨‹æ€æƒ³ï¼šNetty ä¸­åº”ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/30-%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93netty-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">30 å®è·µæ€»ç»“ï¼šNetty åœ¨é¡¹ç›®å¼€å‘ä¸­çš„ä¸€äº›æœ€ä½³å®è·µ</a></li>
                
                
                
                    <li><a href="http://yipsen.github.io/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/31-%E7%BB%93%E6%9D%9F%E8%AF%AD-%E6%8A%80%E6%9C%AF%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF%E5%A6%82%E4%BD%95%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E6%8A%80%E6%9C%AF%E4%BD%93%E7%B3%BB/">31 ç»“æŸè¯­ æŠ€æœ¯æˆé•¿ä¹‹è·¯ï¼šå¦‚ä½•æ‰“é€ è‡ªå·±çš„æŠ€æœ¯ä½“ç³»</a></li>
                
                
            </ul>
        
    </div>
</aside>

<style>
    aside {
        position: fixed;
        left: 20px;
        background: #ffdee3;
        border-radius: 6px;
        padding: 20px;
        padding-top: 60px;
        box-shadow: 5px 10px #888;
        list-style-type: none;
        display: none;
    }

    .post-category-icon {
        position: absolute;
        width: 80px;
        height: 80px;
        top: -40px;
        left: 50%;
        margin-left: -40px;
        text-align: center;
        font-size: 36px;
        content: 'J';
        background: #ffdee3;
        border-radius: 100%;
        border: 10px solid #fff;
        box-shadow: 5px 10px #888;
    }
</style><article class="post-block">
        <h1 class="post-title">24 æœåŠ¡å‘å¸ƒä¸è®¢é˜…ï¼šæ­å»ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åŸºç¡€æ¡†æ¶</h1>
        <div class="post-info">
            <div> 
                <span class="post-date">ğŸ“…&nbsp;2021-12-22 01:54:46</span>ğŸ·ï¸&nbsp;<a class="post-tag" href="/tags/netty/">netty</a></div><div class="post-category">
                
                ğŸ“š&nbsp;<a href="/categories/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/">Nettyæ ¸å¿ƒåŸç†å‰–æä¸RPCå®è·µ</a>
                
            </div></div>
        <div class="post-content">
            <p>ä»æœ¬èŠ‚è¯¾å¼€å§‹ï¼Œæˆ‘ä»¬å¼€å§‹åŠ¨æ‰‹å¼€å‘ä¸€ä¸ªå®Œæ•´çš„ RPC æ¡†æ¶åŸå‹ï¼Œé€šè¿‡æ•´ä¸ªå®è·µè¯¾ç¨‹çš„å­¦ä¹ ï¼Œä½ ä¸ä»…å¯ä»¥ç†Ÿæ‚‰ RPC çš„å®ç°åŸç†ï¼Œè€Œä¸”å¯ä»¥å¯¹ä¹‹å‰ Netty åŸºç¡€çŸ¥è¯†åŠ æ·±ç†è§£ï¼ŒåŒæ ·åœ¨å·¥ä½œä¸­ä¹Ÿå¯ä»¥å­¦ä»¥è‡´ç”¨ã€‚</p>
<p>æˆ‘ä¼šä»æœåŠ¡å‘å¸ƒä¸è®¢é˜…ã€è¿œç¨‹é€šä¿¡ã€æœåŠ¡æ²»ç†ã€åŠ¨æ€ä»£ç†å››ä¸ªæ–¹é¢è¯¦ç»†åœ°ä»‹ç»ä¸€ä¸ªé€šç”¨ RPC æ¡†æ¶çš„å®ç°è¿‡ç¨‹ï¼Œç›¸ä¿¡ä½ åªè¦åšæŒå®Œæˆæœ¬æ¬¡å®è·µè¯¾ï¼Œä¹‹åä½ å†ç‹¬ç«‹å®Œæˆå·¥ä½œä¸­é¡¹ç›®ç ”å‘ä¼šå˜å¾—æ›´åŠ å®¹æ˜“ã€‚ä½ æ˜¯ä¸æ˜¯å·²ç»è¿«ä¸åŠå¾…åœ°æƒ³åŠ¨æ‰‹äº†å‘¢ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·å¼€å§‹å§ï¼</p>
<blockquote>
<p>æºç å‚è€ƒåœ°å€ï¼š<a href="https://github.com/wangyapu/mini-rpc">mini-rpc</a></p>
</blockquote>
<h3 id="ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º</h3>
<p>å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ­å»ºæˆ‘ä»¬çš„å¼€å‘ç¯å¢ƒï¼Œè¿™æ˜¯æ¯ä¸ªç¨‹åºå‘˜çš„å¿…å¤‡æŠ€èƒ½ã€‚ä»¥ä¸‹æ˜¯æˆ‘çš„æœ¬æœºç¯å¢ƒæ¸…å•ï¼Œä»…ä¾›å‚è€ƒã€‚</p>
<ul>
<li>æ“ä½œç³»ç»Ÿï¼šMacOS Big Surï¼Œ11.0.1ã€‚</li>
<li>é›†æˆå¼€å‘å·¥å…·ï¼šIntelliJ IDEA 2020.3ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹© eclipseã€‚</li>
<li>é¡¹ç›®æŠ€æœ¯æ ˆï¼šSpringBoot 2.1.12.RELEASE + JDK 1.8.0_221 + Netty 4.1.42.Finalã€‚</li>
<li>é¡¹ç›®ä¾èµ–ç®¡ç†å·¥å…·ï¼šMaven 3.5.4ï¼Œä½ å¯ä»¥ç‹¬ç«‹å®‰è£… Maven æˆ–è€…ä½¿ç”¨ IDEA çš„é›†æˆç‰ˆï¼Œç‹¬ç«‹å®‰è£…çš„ Maven éœ€è¦é…ç½® MAVEN_HOME å’Œ PATH ç¯å¢ƒå˜é‡ã€‚</li>
<li>æ³¨å†Œä¸­å¿ƒï¼šZookeeeper 3.4.14ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ Zookeeeper å’Œ Apache Curator ä¸€å®šè¦æ­é…ä½¿ç”¨ï¼ŒZookeeper 3.4.x ç‰ˆæœ¬ï¼ŒApache Curator åªæœ‰ 2.x.x æ‰èƒ½æ”¯æŒã€‚</li>
</ul>
<h3 id="é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</h3>
<p>åœ¨åŠ¨æ‰‹å¼€å‘é¡¹ç›®ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹é¡¹ç›®ç»“æ„æœ‰æ¸…æ™°çš„æ„æ€ã€‚æ ¹æ®ä¸ŠèŠ‚è¯¾ä»‹ç»çš„ RPC æ¡†æ¶è®¾è®¡æ¶æ„ï¼Œæˆ‘ä»¬å¯ä»¥å°†é¡¹ç›®ç»“æ„åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ¨¡å—ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Netty%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8E%20RPC%20%E5%AE%9E%E8%B7%B5-%E5%AE%8C/assets/Ciqc1F_1MRqAbEzjAAYR0w8pkqw383.png" alt="Lark20210106-113815.png"></p>
<p>å…¶ä¸­æ¯ä¸ªæ¨¡å—éƒ½æ˜¯ä»€ä¹ˆè§’è‰²å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬ä¸€ä¸€è¿›è¡Œä»‹ç»ã€‚</p>
<ul>
<li>rpc-providerï¼ŒæœåŠ¡æä¾›è€…ã€‚è´Ÿè´£å‘å¸ƒ RPC æœåŠ¡ï¼Œæ¥æ”¶å’Œå¤„ç† RPC è¯·æ±‚ã€‚</li>
<li>rpc-consumerï¼ŒæœåŠ¡æ¶ˆè´¹è€…ã€‚ä½¿ç”¨åŠ¨æ€ä»£ç†å‘èµ· RPC è¿œç¨‹è°ƒç”¨ï¼Œå¸®åŠ©ä½¿ç”¨è€…æ¥å±è”½åº•å±‚ç½‘ç»œé€šä¿¡çš„ç»†èŠ‚ã€‚</li>
<li>rpc-registryï¼Œæ³¨å†Œä¸­å¿ƒæ¨¡å—ã€‚æä¾›æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡çš„åŸºæœ¬åŠŸèƒ½ã€‚</li>
<li>rpc-protocolï¼Œç½‘ç»œé€šä¿¡æ¨¡å—ã€‚åŒ…å« RPC åè®®çš„ç¼–è§£ç å™¨ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–å·¥å…·ç­‰ã€‚</li>
<li>rpc-coreï¼ŒåŸºç¡€ç±»åº“ã€‚æä¾›é€šç”¨çš„å·¥å…·ç±»ä»¥åŠæ¨¡å‹å®šä¹‰ï¼Œä¾‹å¦‚ RPC è¯·æ±‚å’Œå“åº”ç±»ã€RPC æœåŠ¡å…ƒæ•°æ®ç±»ç­‰ã€‚</li>
<li>rpc-facadeï¼ŒRPC æœåŠ¡æ¥å£ã€‚åŒ…å«æœåŠ¡æä¾›è€…éœ€è¦å¯¹å¤–æš´éœ²çš„æ¥å£ï¼Œæœ¬æ¨¡å—ä¸»è¦ç”¨äºæ¨¡æ‹ŸçœŸå® RPC è°ƒç”¨çš„æµ‹è¯•ã€‚</li>
</ul>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ¸…æ¥šå„ä¸ªæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ‰èƒ½å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°æ¢³ç† Maven çš„ pom å®šä¹‰ã€‚rpc-core æ˜¯æœ€åŸºç¡€çš„ç±»åº“ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ¨¡å—éƒ½ä¾èµ–å®ƒã€‚rpc-consumer ç”¨äºå‘èµ· RPC è°ƒç”¨ã€‚rpc-provider è´Ÿè´£å¤„ç† RPC è¯·æ±‚ï¼Œå¦‚æœä¸çŸ¥é“è¿œç¨‹æœåŠ¡çš„åœ°å€ï¼Œé‚£ä¹ˆä¸€åˆ‡éƒ½æ˜¯ç©ºè°ˆäº†ï¼Œæ‰€ä»¥ä¸¤è€…éƒ½éœ€è¦ä¾èµ– rpc-registry æä¾›çš„æœåŠ¡å‘ç°å’ŒæœåŠ¡æ³¨å†Œçš„èƒ½åŠ›ã€‚</p>
<p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Netty%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8E%20RPC%20%E5%AE%9E%E8%B7%B5-%E5%AE%8C/assets/CgpVE1_1MSWAQTIAAARy1QowhGA148.png" alt="Lark20210106-113819.png"></p>
<h3 id="å¦‚ä½•ä½¿ç”¨">å¦‚ä½•ä½¿ç”¨</h3>
<p>æˆ‘ä»¬ä¸ç€æ€¥å¼€å§‹åŠ¨æ‰‹å®ç°ä»£ç ç»†èŠ‚ï¼Œè€Œæ˜¯è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œæœ€ç»ˆå®ç°çš„ RPC æ¡†æ¶åº”è¯¥è®©ç”¨æˆ·å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿè¿™å°±è·Ÿæˆ‘ä»¬å­¦ä¹ ä¸€é—¨æŠ€æœ¯ä¸€æ ·ï¼Œä½ ä¸å¯èƒ½åˆšå¼€å§‹å°±ç›´æ¥é™·å…¥æºç çš„ç»†èŠ‚ï¼Œè€Œæ˜¯å…ˆç†Ÿæ‚‰å®ƒçš„åŸºæœ¬ä½¿ç”¨æ–¹å¼ï¼Œç„¶åæ‰¾åˆ°å…³é”®çš„åˆ‡å…¥ç‚¹å†æ·±å…¥ç ”ç©¶å®ç°åŸç†ï¼Œä¼šèµ·åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹ RPC æ¡†æ¶æƒ³è¦å®ç°çš„æ•ˆæœï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>// rpc-facade # HelloFacade

public interface HelloFacade {

    String hello(String name);

}

// rpc-provider # HelloFacadeImpl

@RpcService(serviceInterface = HelloFacade.class, serviceVersion = &quot;1.0.0&quot;)

public class HelloFacadeImpl implements HelloFacade {

    @Override

    public String hello(String name) {

        return &quot;hello&quot; + name;

    }

}

// rpc-consumer # HelloController

@RestController

public class HelloController {

    @RpcReference(serviceVersion = &quot;1.0.0&quot;, timeout = 3000)

    private HelloFacade helloFacade;

    @RequestMapping(value = &quot;/hello&quot;, method = RequestMethod.GET)

    public String sayHello() {

        return helloFacade.hello(&quot;mini rpc&quot;);

    }

}
</code></pre><p>ä¸ºäº†æ–¹ä¾¿åœ¨æœ¬åœ°æ¨¡æ‹Ÿå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œæˆ‘ä¼šæŠŠ rpc-provider å’Œ rpc-consumer ä¸¤ä¸ªæ¨¡å—èƒ½å¤Ÿåšåˆ°ç‹¬ç«‹å¯åŠ¨ã€‚rpc-provider é€šè¿‡ @RpcService æ³¨è§£æš´éœ² RPC æœåŠ¡ HelloFacadeï¼Œrpc-consumer é€šè¿‡ @RpcReference æ³¨è§£å¼•ç”¨ HelloFacade æœåŠ¡å¹¶å‘èµ·è°ƒç”¨ï¼ŒåŸºæœ¬ä¸æˆ‘ä»¬å¸¸ç”¨çš„ RPC æ¡†æ¶ä½¿ç”¨æ–¹å¼ä¿æŒä¸€è‡´ã€‚</p>
<p>æ¢³ç†æ¸…æ¥šé¡¹ç›®ç»“æ„å’Œæ•´ä½“å®ç°æ€è·¯ä¹‹åï¼Œä¸‹é¢æˆ‘ä»¬ä»æœåŠ¡æä¾›è€…å¼€å§‹å…¥æ‰‹å¼€å‘ã€‚</p>
<h3 id="æœåŠ¡æä¾›è€…å‘å¸ƒæœåŠ¡">æœåŠ¡æä¾›è€…å‘å¸ƒæœåŠ¡</h3>
<p>æœåŠ¡æä¾›è€… rpc-provider éœ€è¦å®Œæˆå“ªäº›äº‹æƒ…å‘¢ï¼Ÿä¸»è¦åˆ†ä¸ºå››ä¸ªæ ¸å¿ƒæµç¨‹ï¼š</p>
<ul>
<li>æœåŠ¡æä¾›è€…å¯åŠ¨æœåŠ¡ï¼Œå¹¶æš´éœ²æœåŠ¡ç«¯å£ï¼›</li>
<li>å¯åŠ¨æ—¶æ‰«æéœ€è¦å¯¹å¤–å‘å¸ƒçš„æœåŠ¡ï¼Œå¹¶å°†æœåŠ¡å…ƒæ•°æ®ä¿¡æ¯å‘å¸ƒåˆ°æ³¨å†Œä¸­å¿ƒï¼›</li>
<li>æ¥æ”¶ RPC è¯·æ±‚ï¼Œè§£ç åå¾—åˆ°è¯·æ±‚æ¶ˆæ¯ï¼›</li>
<li>æäº¤è¯·æ±‚è‡³è‡ªå®šä¹‰çº¿ç¨‹æ± è¿›è¡Œå¤„ç†ï¼Œå¹¶å°†å¤„ç†ç»“æœå†™å›å®¢æˆ·ç«¯ã€‚</li>
</ul>
<p>æœ¬èŠ‚è¯¾æˆ‘ä»¬å…ˆå®ç° rpc-provider æ¨¡å—å‰é¢ä¸¤ä¸ªæµç¨‹ã€‚</p>
<h4 id="æœåŠ¡æä¾›è€…å¯åŠ¨">æœåŠ¡æä¾›è€…å¯åŠ¨</h4>
<p>æœåŠ¡æä¾›è€…å¯åŠ¨çš„é…ç½®æ–¹å¼åŸºæœ¬æ˜¯å›ºå®šæ¨¡å¼ï¼Œä¹Ÿæ˜¯ä»å¼•å¯¼å™¨ Bootstrap å¼€å§‹å…¥æ‰‹ï¼Œä½ å¯ä»¥å¤ä¹ ä¸‹åŸºç¡€è¯¾ç¨‹ã€Š03 å¼•å¯¼å™¨ä½œç”¨ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯åŠ¨éƒ½è¦åšäº›ä»€ä¹ˆï¼Ÿã€‹ã€‚æˆ‘ä»¬é¦–å…ˆçœ‹ä¸‹æœåŠ¡æä¾›è€…çš„å¯åŠ¨å®ç°ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>private void startRpcServer() throws Exception {

    this.serverAddress = InetAddress.getLocalHost().getHostAddress();

    EventLoopGroup boss = new NioEventLoopGroup();

    EventLoopGroup worker = new NioEventLoopGroup();

    try {

        ServerBootstrap bootstrap = new ServerBootstrap();

        bootstrap.group(boss, worker)

                .channel(NioServerSocketChannel.class)

                .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() {

                    @Override

                    protected void initChannel(SocketChannel socketChannel) throws Exception {

                    }

                })

                .childOption(ChannelOption.SO_KEEPALIVE, true);

        ChannelFuture channelFuture = bootstrap.bind(this.serverAddress, this.serverPort).sync();

        log.info(&quot;server addr {} started on port {}&quot;, this.serverAddress, this.serverPort);

        channelFuture.channel().closeFuture().sync();

    } finally {

        boss.shutdownGracefully();

        worker.shutdownGracefully();

    }

}
</code></pre><p>æœåŠ¡æä¾›è€…é‡‡ç”¨çš„æ˜¯ä¸»ä» Reactor çº¿ç¨‹æ¨¡å‹ï¼Œå¯åŠ¨è¿‡ç¨‹åŒ…æ‹¬é…ç½®çº¿ç¨‹æ± ã€Channel åˆå§‹åŒ–ã€ç«¯å£ç»‘å®šä¸‰ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬æš‚æ—¶å…ˆä¸å…³æ³¨ Channel åˆå§‹åŒ–ä¸­è‡ªå®šä¹‰çš„ä¸šåŠ¡å¤„ç†å™¨ Handler æ˜¯å¦‚ä½•è®¾è®¡å’Œå®ç°çš„ã€‚</p>
<p>å¯¹äº RPC æ¡†æ¶è€Œè¨€ï¼Œå¯æ‰©å±•æ€§æ˜¯æ¯”è¾ƒé‡è¦çš„ä¸€æ–¹é¢ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹å¦‚ä½•å€ŸåŠ© Spring Boot çš„èƒ½åŠ›å°†æœåŠ¡æä¾›è€…å¯åŠ¨æ‰€ä¾èµ–çš„å‚æ•°åšæˆå¯é…ç½®åŒ–ã€‚</p>
<h4 id="å‚æ•°é…ç½®">å‚æ•°é…ç½®</h4>
<p>æœåŠ¡æä¾›è€…å¯åŠ¨éœ€è¦é…ç½®ä¸€äº›å‚æ•°ï¼Œæˆ‘ä»¬ä¸åº”è¯¥æŠŠè¿™äº›å‚æ•°å›ºå®šåœ¨ä»£ç é‡Œï¼Œè€Œæ˜¯ä»¥å‘½ä»¤è¡Œå‚æ•°æˆ–è€…é…ç½®æ–‡ä»¶çš„æ–¹å¼è¿›è¡Œè¾“å…¥ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Spring Boot çš„ @ConfigurationProperties æ³¨è§£å¾ˆè½»æ¾åœ°å®ç°é…ç½®é¡¹çš„åŠ è½½ï¼Œå¹¶ä¸”å¯ä»¥æŠŠç›¸åŒå‰ç¼€ç±»å‹çš„é…ç½®é¡¹è‡ªåŠ¨å°è£…æˆå®ä½“ç±»ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¸ºæœåŠ¡æä¾›è€…æä¾›å‚æ•°æ˜ å°„çš„å¯¹è±¡ï¼š</p>
<pre tabindex="0"><code>@Data

@ConfigurationProperties(prefix = &quot;rpc&quot;)

public class RpcProperties {

    private int servicePort;

    private String registryAddr;

    private String registryType;

}
</code></pre><p>æˆ‘ä»¬ä¸€å…±æå–äº†ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸ºæœåŠ¡æš´éœ²çš„ç«¯å£ servicePortã€æ³¨å†Œä¸­å¿ƒçš„åœ°å€ registryAddr å’Œæ³¨å†Œä¸­å¿ƒçš„ç±»å‹ registryTypeã€‚@ConfigurationProperties æ³¨è§£æœ€ç»å…¸çš„ä½¿ç”¨æ–¹å¼å°±æ˜¯é€šè¿‡ prefix å±æ€§æŒ‡å®šé…ç½®å‚æ•°çš„å‰ç¼€ï¼Œé»˜è®¤ä¼šä¸å…¨å±€é…ç½®æ–‡ä»¶ application.properties æˆ–è€… application.yml ä¸­çš„å‚æ•°è¿›è¡Œä¸€ä¸€ç»‘å®šã€‚å¦‚æœä½ æƒ³è‡ªå®šä¹‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ @PropertySource æ³¨è§£æŒ‡å®šé…ç½®æ–‡ä»¶çš„ä½ç½®ã€‚ä¸‹é¢æˆ‘ä»¬åœ¨ rpc-provider æ¨¡å—çš„ resources ç›®å½•ä¸‹åˆ›å»ºå…¨å±€é…ç½®æ–‡ä»¶ application.propertiesï¼Œå¹¶é…ç½®ä»¥ä¸Šä¸‰ä¸ªå‚æ•°ï¼š</p>
<pre tabindex="0"><code>rpc.servicePort=2781

rpc.registryType=ZOOKEEPER

rpc.registryAddr=127.0.0.1:2181
</code></pre><p>application.properties é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§å¿…é¡»å’Œå®ä½“ç±»çš„æˆå‘˜å˜é‡æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹å¸¸ç”¨çš„å‘½åè§„åˆ™ï¼Œä¾‹å¦‚é©¼å³°å‘½å rpc.servicePort=2781ï¼›æˆ–è€…è™šçº¿ - åˆ†å‰²çš„æ–¹å¼ rpc.service-port=2781ï¼›ä»¥åŠå¤§å†™åŠ ä¸‹åˆ’çº¿çš„å½¢å¼ RPC_Service_Portï¼Œå»ºè®®åœ¨ç¯å¢ƒå˜é‡ä¸­ä½¿ç”¨ã€‚@ConfigurationProperties æ³¨è§£è¿˜å¯ä»¥æ”¯æŒæ›´å¤šå¤æ‚ç»“æ„çš„é…ç½®ï¼Œå¹¶ä¸”å¯ä»¥ Validation åŠŸèƒ½è¿›è¡Œå‚æ•°æ ¡éªŒï¼Œå¦‚æœä½ æœ‰å…´è¶£å¯ä»¥è¯¾åå†è¿›è¡Œæ·±å…¥ç ”ç©¶ã€‚</p>
<p>æœ‰äº† RpcProperties å®ä½“ç±»ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥åº”è¯¥å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿå¦‚æœåªé…ç½® @ConfigurationProperties æ³¨è§£ï¼ŒSpring å®¹å™¨å¹¶ä¸èƒ½è·å–é…ç½®æ–‡ä»¶çš„å†…å®¹å¹¶æ˜ å°„ä¸ºå¯¹è±¡ï¼Œè¿™æ—¶ @EnableConfigurationProperties æ³¨è§£å°±ç™»åœºäº†ã€‚@EnableConfigurationProperties æ³¨è§£çš„ä½œç”¨å°±æ˜¯å°†å£°æ˜ @ConfigurationProperties æ³¨è§£çš„ç±»æ³¨å…¥ä¸º Spring å®¹å™¨ä¸­çš„ Beanã€‚å…·ä½“ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>@Configuration

@EnableConfigurationProperties(RpcProperties.class)

public class RpcProviderAutoConfiguration {

    @Resource

    private RpcProperties rpcProperties;

    @Bean

    public RpcProvider init() throws Exception {

        RegistryType type = RegistryType.valueOf(rpcProperties.getRegistryType());

        RegistryService serviceRegistry = RegistryFactory.getInstance(rpcProperties.getRegistryAddr(), type);

        return new RpcProvider(rpcProperties.getServicePort(), serviceRegistry);

    }

}
</code></pre><p>æˆ‘ä»¬é€šè¿‡ @EnableConfigurationProperties æ³¨è§£ä½¿å¾— RpcProperties ç”Ÿæ•ˆï¼Œå¹¶é€šè¿‡ @Configuration å’Œ @Bean æ³¨è§£è‡ªå®šä¹‰äº† RpcProvider çš„ç”Ÿæˆæ–¹å¼ã€‚@Configuration ä¸»è¦ç”¨äºå®šä¹‰é…ç½®ç±»ï¼Œé…ç½®ç±»å†…éƒ¨å¯ä»¥åŒ…å«å¤šä¸ª @Bean æ³¨è§£çš„æ–¹æ³•ï¼Œå¯ä»¥æ›¿æ¢ä¼ ç»Ÿ XML çš„å®šä¹‰æ–¹å¼ã€‚è¢« @Bean æ³¨è§£çš„æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªè‡ªå®šä¹‰çš„å¯¹è±¡ï¼Œ@Bean æ³¨è§£ä¼šå°†è¿™ä¸ªå¯¹è±¡æ³¨å†Œä¸º Bean å¹¶è£…é…åˆ° Spring å®¹å™¨ä¸­ï¼Œ@Bean æ¯” @Component æ³¨è§£çš„è‡ªå®šä¹‰åŠŸèƒ½æ›´å¼ºã€‚</p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬æœåŠ¡æä¾›è€…å¯åŠ¨çš„å‡†å¤‡å·¥ä½œå°±å®Œæˆäº†ï¼Œä¸‹é¢ä½ éœ€è¦æ·»åŠ  Spring Boot çš„ main æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œç„¶åå°è¯•å¯åŠ¨ä¸‹ rpc-provider æ¨¡å—å§ã€‚</p>
<pre tabindex="0"><code>@EnableConfigurationProperties

@SpringBootApplication

public class RpcProviderApplication {

    public static void main(String[] args) {

        SpringApplication.run(RpcProviderApplication.class, args);

    }

}
</code></pre><h4 id="å‘å¸ƒæœåŠ¡">å‘å¸ƒæœåŠ¡</h4>
<p>åœ¨æœåŠ¡æä¾›è€…å¯åŠ¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ€è€ƒä¸€ä¸ªæ ¸å¿ƒé—®é¢˜ï¼ŒæœåŠ¡æä¾›è€…éœ€è¦å°†æœåŠ¡å‘å¸ƒåˆ°æ³¨å†Œä¸­å¿ƒï¼Œæ€ä¹ˆçŸ¥é“å“ªäº›æœåŠ¡éœ€è¦å‘å¸ƒå‘¢ï¼ŸæœåŠ¡æä¾›è€…éœ€è¦å®šä¹‰éœ€è¦å‘å¸ƒæœåŠ¡ç±»å‹ã€æœåŠ¡ç‰ˆæœ¬ç­‰å±æ€§ï¼Œä¸»æµçš„ RPC æ¡†æ¶éƒ½é‡‡ç”¨ XML æ–‡ä»¶æˆ–è€…æ³¨è§£çš„æ–¹å¼è¿›è¡Œå®šä¹‰ã€‚ä»¥æ³¨è§£çš„æ–¹å¼æš´éœ²æœåŠ¡ç°åœ¨æœ€ä¸ºå¸¸ç”¨ï¼Œçœå»äº†å¾ˆå¤šçƒ¦ççš„ XML é…ç½®è¿‡ç¨‹ã€‚ä¾‹å¦‚ Dubbo æ¡†æ¶ä¸­ä½¿ç”¨ @Service æ³¨è§£æ›¿ä»£ <a href="dubbo:service">dubbo:service</a> çš„å®šä¹‰æ–¹å¼ï¼ŒæœåŠ¡æ¶ˆè´¹è€…åˆ™ä½¿ç”¨ @Reference æ³¨è§£æ›¿ä»£ <a href="dubbo:reference">dubbo:reference</a>ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ä½œä¸ºæœåŠ¡æä¾›è€…ï¼Œå¦‚ä½•é€šè¿‡æ³¨è§£æš´éœ²æœåŠ¡ï¼Œé¦–å…ˆç»™å‡ºæˆ‘ä»¬è‡ªå®šä¹‰çš„ @RpcService æ³¨è§£å®šä¹‰ï¼š</p>
<pre tabindex="0"><code>@Retention(RetentionPolicy.RUNTIME)

@Target(ElementType.TYPE)

@Component

public @interface RpcService {

    Class&lt;?&gt; serviceInterface() default Object.class;

    String serviceVersion() default &quot;1.0&quot;;

}
</code></pre><p>@RpcService æä¾›äº†ä¸¤ä¸ªå¿…ä¸å¯å°‘çš„å±æ€§ï¼šæœåŠ¡ç±»å‹ serviceInterface å’ŒæœåŠ¡ç‰ˆæœ¬ serviceVersionï¼ŒæœåŠ¡æ¶ˆè´¹è€…å¿…é¡»æŒ‡å®šå®Œå…¨ä¸€æ ·çš„å±æ€§æ‰èƒ½æ­£ç¡®è°ƒç”¨ã€‚æœ‰äº† @RpcService æ³¨è§£ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æœåŠ¡å®ç°ç±»ä¸Šä½¿ç”¨å®ƒï¼Œ@RpcService æ³¨è§£æœ¬è´¨ä¸Šå°±æ˜¯ @Componentï¼Œå¯ä»¥å°†æœåŠ¡å®ç°ç±»æ³¨å†Œæˆ Spring å®¹å™¨æ‰€ç®¡ç†çš„ Beanï¼Œé‚£ä¹ˆ serviceInterfaceã€serviceVersion çš„å±æ€§å€¼æ€ä¹ˆæ‰èƒ½å’Œ Bean å…³è”èµ·æ¥å‘¢ï¼Ÿè¿™å°±éœ€è¦æˆ‘ä»¬å°± Bean çš„ç”Ÿå‘½å‘¨æœŸä»¥åŠ Bean çš„å¯æ‰©å±•ç‚¹æœ‰æ‰€äº†è§£ã€‚</p>
<p>Spring çš„ BeanPostProcessor æ¥å£ç»™æä¾›äº†å¯¹ Bean è¿›è¡Œå†åŠ å·¥çš„æ‰©å±•ç‚¹ï¼ŒBeanPostProcessor å¸¸ç”¨äºå¤„ç†è‡ªå®šä¹‰æ³¨è§£ã€‚è‡ªå®šä¹‰çš„ Bean å¯ä»¥é€šè¿‡å®ç° BeanPostProcessor æ¥å£ï¼Œåœ¨ Bean å®ä¾‹åŒ–çš„å‰ååŠ å…¥è‡ªå®šä¹‰çš„é€»è¾‘å¤„ç†ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬é€šè¿‡ RpcProvider å®ç° BeanPostProcessor æ¥å£ï¼Œæ¥å®ç°å¯¹ å£°æ˜ @RpcService æ³¨è§£æœåŠ¡çš„è‡ªå®šä¹‰å¤„ç†ã€‚</p>
<pre tabindex="0"><code>public class RpcProvider implements InitializingBean, BeanPostProcessor {

    // çœç•¥å…¶ä»–ä»£ç 

    

    private final Map&lt;String, Object&gt; rpcServiceMap = new HashMap&lt;&gt;();

    @Override

    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {

        RpcService rpcService = bean.getClass().getAnnotation(RpcService.class);

        if (rpcService != null) {

            String serviceName = rpcService.serviceInterface().getName();

            String serviceVersion = rpcService.serviceVersion();

            try {

                ServiceMeta serviceMeta = new ServiceMeta();

                serviceMeta.setServiceAddr(serverAddress);

                serviceMeta.setServicePort(serverPort);

                serviceMeta.setServiceName(serviceName);

                serviceMeta.setServiceVersion(serviceVersion);

                // TODO å‘å¸ƒæœåŠ¡å…ƒæ•°æ®è‡³æ³¨å†Œä¸­å¿ƒ

                rpcServiceMap.put(RpcServiceHelper.buildServiceKey(serviceMeta.getServiceName(), serviceMeta.getServiceVersion()), bean);

            } catch (Exception e) {

                log.error(&quot;failed to register service {}#{}&quot;, serviceName, serviceVersion, e);

            }

        }

        return bean;

    }

}
</code></pre><p>RpcProvider é‡å†™äº† BeanPostProcessor æ¥å£çš„ postProcessAfterInitialization æ–¹æ³•ï¼Œå¯¹æ‰€æœ‰åˆå§‹åŒ–å®Œæˆåçš„ Bean è¿›è¡Œæ‰«æã€‚å¦‚æœ Bean åŒ…å« @RpcService æ³¨è§£ï¼Œé‚£ä¹ˆé€šè¿‡æ³¨è§£è¯»å–æœåŠ¡çš„å…ƒæ•°æ®ä¿¡æ¯å¹¶æ„é€ å‡º ServiceMeta å¯¹è±¡ï¼Œæ¥ä¸‹æ¥å‡†å¤‡å°†æœåŠ¡çš„å…ƒæ•°æ®ä¿¡æ¯å‘å¸ƒè‡³æ³¨å†Œä¸­å¿ƒï¼Œæ³¨å†Œä¸­å¿ƒçš„å®ç°æˆ‘ä»¬å…ˆæš‚ä¸”è·³è¿‡ï¼Œåé¢ä¼šæœ‰å•ç‹¬ä¸€èŠ‚è¯¾è¿›è¡Œè®²è§£æ³¨å†Œä¸­å¿ƒçš„å®ç°ã€‚æ­¤å¤–ï¼ŒRpcProvider è¿˜ç»´æŠ¤äº†ä¸€ä¸ª rpcServiceMapï¼Œå­˜æ”¾æœåŠ¡åˆå§‹åŒ–åæ‰€å¯¹åº”çš„ Beanï¼ŒrpcServiceMap èµ·åˆ°äº†ç¼“å­˜çš„è§’è‰²ï¼Œåœ¨å¤„ç† RPC è¯·æ±‚æ—¶å¯ä»¥ç›´æ¥é€šè¿‡ rpcServiceMap æ‹¿åˆ°å¯¹åº”çš„æœåŠ¡è¿›è¡Œè°ƒç”¨ã€‚</p>
<p>æ˜ç™½æœåŠ¡æä¾›è€…å¦‚ä½•å¤„ç† @RpcService æ³¨è§£çš„åŸç†ä¹‹åï¼Œæ¥ä¸‹æ¥å†å®ç°æœåŠ¡æ¶ˆè´¹è€…å°±å®¹æ˜“å¾ˆå¤šäº†ã€‚</p>
<h3 id="æœåŠ¡æ¶ˆè´¹è€…è®¢é˜…æœåŠ¡">æœåŠ¡æ¶ˆè´¹è€…è®¢é˜…æœåŠ¡</h3>
<p>ä¸æœåŠ¡æä¾›è€…ä¸åŒçš„æ˜¯ï¼ŒæœåŠ¡æ¶ˆè´¹è€…å¹¶ä¸æ˜¯ä¸€ä¸ªå¸¸é©»çš„æœåŠ¡ï¼Œæ¯æ¬¡å‘èµ· RPC è°ƒç”¨æ—¶å®ƒæ‰ä¼šå»é€‰æ‹©å‘å“ªä¸ªè¿œç«¯æœåŠ¡å‘é€æ•°æ®ã€‚æ‰€ä»¥æœåŠ¡æ¶ˆè´¹è€…çš„å®ç°è¦å¤æ‚ä¸€äº›ï¼Œå¯¹äºå£°æ˜ @RpcReference æ³¨è§£çš„æˆå‘˜å˜é‡ï¼Œæˆ‘ä»¬éœ€è¦æ„é€ å‡ºä¸€ä¸ªå¯ä»¥çœŸæ­£è¿›è¡Œ RPC è°ƒç”¨çš„ Beanï¼Œç„¶åå°†å®ƒæ³¨å†Œåˆ° Spring çš„å®¹å™¨ä¸­ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹ @RpcReference æ³¨è§£çš„å®šä¹‰ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>@Retention(RetentionPolicy.RUNTIME)

@Target(ElementType.FIELD)

@Autowired

public @interface RpcReference {

    String serviceVersion() default &quot;1.0&quot;;

    String registryType() default &quot;ZOOKEEPER&quot;;

    String registryAddress() default &quot;127.0.0.1:2181&quot;;

    long timeout() default 5000;

}
</code></pre><p>@RpcReference æ³¨è§£æä¾›äº†æœåŠ¡ç‰ˆæœ¬ serviceVersionã€æ³¨å†Œä¸­å¿ƒç±»å‹ registryTypeã€æ³¨å†Œä¸­å¿ƒåœ°å€ registryAddress å’Œè¶…æ—¶æ—¶é—´ timeout å››ä¸ªå±æ€§ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨è¿™äº›å±æ€§æ„é€ å‡ºä¸€ä¸ªè‡ªå®šä¹‰çš„ Beanï¼Œå¹¶å¯¹è¯¥ Bean æ‰§è¡Œçš„æ‰€æœ‰æ–¹æ³•è¿›è¡Œæ‹¦æˆªã€‚</p>
<p>Spring çš„ FactoryBean æ¥å£å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°è‡ªå®šä¹‰çš„ Beanï¼ŒFactoryBean æ˜¯ä¸€ç§ç‰¹ç§çš„å·¥å‚ Beanï¼Œé€šè¿‡ getObject() æ–¹æ³•è¿”å›å¯¹è±¡ï¼Œè€Œå¹¶ä¸æ˜¯ FactoryBean æœ¬èº«ã€‚</p>
<pre tabindex="0"><code>public class RpcReferenceBean implements FactoryBean&lt;Object&gt; {

    private Class&lt;?&gt; interfaceClass;

    private String serviceVersion;

    private String registryType;

    private String registryAddr;

    private long timeout;

    private Object object;

    @Override

    public Object getObject() throws Exception {

        return object;

    }

    @Override

    public Class&lt;?&gt; getObjectType() {

        return interfaceClass;

    }

    public void init() throws Exception {

        // TODO ç”ŸæˆåŠ¨æ€ä»£ç†å¯¹è±¡å¹¶èµ‹å€¼ç»™ object

    }

    public void setInterfaceClass(Class&lt;?&gt; interfaceClass) {

        this.interfaceClass = interfaceClass;

    }

    public void setServiceVersion(String serviceVersion) {

        this.serviceVersion = serviceVersion;

    }

    public void setRegistryType(String registryType) {

        this.registryType = registryType;

    }

    public void setRegistryAddr(String registryAddr) {

        this.registryAddr = registryAddr;

    }

    public void setTimeout(long timeout) {

        this.timeout = timeout;

    }

}
</code></pre><p>åœ¨ RpcReferenceBean ä¸­ init() æ–¹æ³•è¢«æˆ‘æ ‡æ³¨äº† TODOï¼Œæ­¤å¤„éœ€è¦å®ç°åŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œå¹¶é€šè¿‡ä»£ç†å¯¹è±¡å®Œæˆ RPC è°ƒç”¨ã€‚å¯¹äºä½¿ç”¨è€…æ¥è¯´åªæ˜¯é€šè¿‡ @RpcReference è®¢é˜…äº†æœåŠ¡ï¼Œå¹¶ä¸æ„ŸçŸ¥åº•å±‚è°ƒç”¨çš„ç»†èŠ‚ã€‚å¯¹äºå¦‚ä½•å®ç° RPC é€šä¿¡ã€æœåŠ¡å¯»å€ç­‰ï¼Œéƒ½æ˜¯åœ¨åŠ¨æ€ä»£ç†ç±»ä¸­å®Œæˆçš„ï¼Œåœ¨åé¢æˆ‘ä»¬ä¼šæœ‰ä¸“é—¨çš„ä¸€èŠ‚è¯¾è¯¦ç»†è®²è§£åŠ¨æ€ä»£ç†çš„å®ç°ã€‚</p>
<p>æœ‰äº† @RpcReference æ³¨è§£å’Œ RpcReferenceBean ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Spring çš„æ‰©å±•ç‚¹ BeanFactoryPostProcessor å¯¹ Bean çš„å®šä¹‰è¿›è¡Œä¿®æ”¹ã€‚ä¸Šæ–‡ä¸­æœåŠ¡æä¾›è€…ä½¿ç”¨çš„æ˜¯ BeanPostProcessorï¼ŒBeanFactoryPostProcessor å’Œ BeanPostProcessor éƒ½æ˜¯ Spring çš„æ ¸å¿ƒæ‰©å±•ç‚¹ï¼Œå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼ŸBeanFactoryPostProcessor æ˜¯ Spring å®¹å™¨åŠ è½½ Bean çš„å®šä¹‰ä¹‹åä»¥åŠ Bean å®ä¾‹åŒ–ä¹‹å‰æ‰§è¡Œï¼Œæ‰€ä»¥ BeanFactoryPostProcessor å¯ä»¥åœ¨ Bean å®ä¾‹åŒ–ä¹‹å‰è·å– Bean çš„é…ç½®å…ƒæ•°æ®ï¼Œå¹¶å…è®¸ç”¨æˆ·å¯¹å…¶ä¿®æ”¹ã€‚è€Œ BeanPostProcessor æ˜¯åœ¨ Bean åˆå§‹åŒ–å‰åæ‰§è¡Œï¼Œå®ƒå¹¶ä¸èƒ½ä¿®æ”¹ Bean çš„é…ç½®ä¿¡æ¯ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬éœ€è¦å¯¹å£°æ˜ @RpcReference æ³¨è§£çš„æˆå‘˜å˜é‡æ„é€ å‡º RpcReferenceBeanï¼Œæ‰€ä»¥éœ€è¦å®ç° BeanFactoryPostProcessor ä¿®æ”¹ Bean çš„å®šä¹‰ï¼Œå…·ä½“å®ç°å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<pre tabindex="0"><code>@Component

@Slf4j

public class RpcConsumerPostProcessor implements ApplicationContextAware, BeanClassLoaderAware, BeanFactoryPostProcessor {

    private ApplicationContext context;

    private ClassLoader classLoader;

    private final Map&lt;String, BeanDefinition&gt; rpcRefBeanDefinitions = new LinkedHashMap&lt;&gt;();

    @Override

    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {

        this.context = applicationContext;

    }

    @Override

    public void setBeanClassLoader(ClassLoader classLoader) {

        this.classLoader = classLoader;

    }

    @Override

    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException {

        for (String beanDefinitionName : beanFactory.getBeanDefinitionNames()) {

            BeanDefinition beanDefinition = beanFactory.getBeanDefinition(beanDefinitionName);

            String beanClassName = beanDefinition.getBeanClassName();

            if (beanClassName != null) {

                Class&lt;?&gt; clazz = ClassUtils.resolveClassName(beanClassName, this.classLoader);

                ReflectionUtils.doWithFields(clazz, this::parseRpcReference);

            }

        }

        BeanDefinitionRegistry registry = (BeanDefinitionRegistry) beanFactory;

        this.rpcRefBeanDefinitions.forEach((beanName, beanDefinition) -&gt; {

            if (context.containsBean(beanName)) {

                throw new IllegalArgumentException(&quot;spring context already has a bean named &quot; + beanName);

            }

            registry.registerBeanDefinition(beanName, rpcRefBeanDefinitions.get(beanName));

            log.info(&quot;registered RpcReferenceBean {} success.&quot;, beanName);

        });

    }

    private void parseRpcReference(Field field) {

        RpcReference annotation = AnnotationUtils.getAnnotation(field, RpcReference.class);

        if (annotation != null) {

            BeanDefinitionBuilder builder = BeanDefinitionBuilder.genericBeanDefinition(RpcReferenceBean.class);

            builder.setInitMethodName(RpcConstants.INIT_METHOD_NAME);

            builder.addPropertyValue(&quot;interfaceClass&quot;, field.getType());

            builder.addPropertyValue(&quot;serviceVersion&quot;, annotation.serviceVersion());

            builder.addPropertyValue(&quot;registryType&quot;, annotation.registryType());

            builder.addPropertyValue(&quot;registryAddr&quot;, annotation.registryAddress());

            builder.addPropertyValue(&quot;timeout&quot;, annotation.timeout());

            BeanDefinition beanDefinition = builder.getBeanDefinition();

            rpcRefBeanDefinitions.put(field.getName(), beanDefinition);

        }

    }

}
</code></pre><p>RpcConsumerPostProcessor ç±»ä¸­é‡å†™äº† BeanFactoryPostProcessor çš„ postProcessBeanFactory æ–¹æ³•ï¼Œä» beanFactory ä¸­è·å–æ‰€æœ‰ Bean çš„å®šä¹‰ä¿¡æ¯ï¼Œç„¶ååˆ†åˆ«å¯¹æ¯ä¸ª Bean çš„æ‰€æœ‰ field è¿›è¡Œæ£€æµ‹ã€‚å¦‚æœ field è¢«å£°æ˜äº† @RpcReference æ³¨è§£ï¼Œé€šè¿‡ BeanDefinitionBuilder æ„é€  RpcReferenceBean çš„å®šä¹‰ï¼Œå¹¶ä¸º RpcReferenceBean çš„æˆå‘˜å˜é‡èµ‹å€¼ï¼ŒåŒ…æ‹¬æœåŠ¡ç±»å‹ interfaceClassã€æœåŠ¡ç‰ˆæœ¬ serviceVersionã€æ³¨å†Œä¸­å¿ƒç±»å‹ registryTypeã€æ³¨å†Œä¸­å¿ƒåœ°å€ registryAddr ä»¥åŠè¶…æ—¶æ—¶é—´ timeoutã€‚æ„é€ å®Œ RpcReferenceBean çš„å®šä¹‰ä¹‹åï¼Œä¼šå°†RpcReferenceBean çš„ BeanDefinition é‡æ–°æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ã€‚</p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å°†æœåŠ¡æä¾›è€…æœåŠ¡æ¶ˆè´¹è€…çš„åŸºæœ¬æ¡†æ¶æ­å»ºå‡ºæ¥äº†ï¼Œå¹¶ä¸”ç€é‡ä»‹ç»äº†æœåŠ¡æä¾›è€…ä½¿ç”¨ @RpcService æ³¨è§£æ˜¯å¦‚ä½•å‘å¸ƒæœåŠ¡çš„ï¼ŒæœåŠ¡æ¶ˆè´¹è€…ç›¸åº”éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿæ³¨å…¥æœåŠ¡æ¥å£çš„æ³¨è§£ @RpcReferenceï¼Œè¢« @RpcReference ä¿®é¥°çš„æˆå‘˜å˜é‡éƒ½ä¼šè¢«æ„é€ æˆ RpcReferenceBeanï¼Œå¹¶ä¸ºå®ƒç”ŸæˆåŠ¨æ€ä»£ç†ç±»ï¼Œåé¢æˆ‘ä»¬å†ç»§ç»­æ·±å…¥ä»‹ç»ã€‚</p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>æœ¬èŠ‚è¯¾æˆ‘ä»¬ä»‹ç»äº†æœåŠ¡å‘å¸ƒä¸è®¢é˜…çš„å®ç°åŸç†ï¼Œæ­å»ºå‡ºäº†æœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…çš„åŸºæœ¬æ¡†æ¶ã€‚å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœé‡‡ç”¨ Java è¯­è¨€å®ç° RPC æ¡†æ¶æ ¸å¿ƒçš„æœåŠ¡å‘å¸ƒä¸è®¢é˜…çš„æ ¸å¿ƒé€»è¾‘ï¼Œéœ€è¦ä½ å…·å¤‡è¾ƒä¸ºæ‰å®çš„ Spring æ¡†æ¶åŸºç¡€ã€‚äº†è§£ Spring é‡è¦çš„æ‰©å±•æ¥å£ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¼€å‘å‡ºæ›´ä¼˜é›…çš„ä»£ç ã€‚</p>
<p>ç•™ä¸¤ä¸ªè¯¾åä½œä¸šï¼š</p>
<ol>
<li>æœ¬èŠ‚è¯¾æˆ‘ç•™ä¸‹äº†å‡ å¤„å¾…å®Œæˆçš„ TODOï¼Œä½ å¯ä»¥ç‹¬ç«‹æ€è€ƒä¸‹ï¼Œä»è¿™äº› TODO å…¥æ‰‹ï¼Œæ˜¯å¦å¯ä»¥æ„æ€å‡ºæ•´ä¸ª RPC æ¡†æ¶çš„è„‰ç»œå‘¢ï¼Ÿ</li>
<li>å¤ä¹  Netty è‡ªå®šä¹‰å¤„ç†å™¨ ChannelHandler å’Œç¼–è§£ç çš„åŸºç¡€çŸ¥è¯†ï¼Œä¸‹èŠ‚è¯¾æˆ‘ä»¬å°†å®Œæˆ RPC æ¡†æ¶çš„ç½‘ç»œé€šä¿¡éƒ¨åˆ†ã€‚</li>
</ol>

        </div>
    </article>
</div>

    </main>
    <footer>
        <div id="pagination">
            
<div class="paginator">
    <div class="prev">
        
        <a href="/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/23-%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%AB%98%E6%80%A7%E8%83%BD%E5%88%86%E5%B8%83%E5%BC%8F-rpc-%E6%A1%86%E6%9E%B6/"><span>23 æ¶æ„è®¾è®¡ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªé«˜æ€§èƒ½åˆ†å¸ƒå¼ RPC æ¡†æ¶</span></a>
    </div>
    <div class="next">
        
        <a href="/documents/columns/netty/netty%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8Erpc%E5%AE%9E%E8%B7%B5/25-%E8%BF%9C%E7%A8%8B%E9%80%9A%E4%BF%A1%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE%E8%AE%BE%E8%AE%A1%E4%BB%A5%E5%8F%8A%E7%BC%96%E8%A7%A3%E7%A0%81%E7%9A%84%E5%AE%9E%E7%8E%B0/"><span>25 è¿œç¨‹é€šä¿¡ï¼šé€šä¿¡åè®®è®¾è®¡ä»¥åŠç¼–è§£ç çš„å®ç°</span></a>
    </div>
</div>

        </div>
        <div class="toggler" onclick="toggleLight(this);">ğŸ’¡</div>
        <div id="copyright" style="display: none;">
    
    
    <p>&copy; 28280 <a href="/"></a>, powered by Hugo and Qiao</p>
</div>
    </footer>
    
<script>
    function toggleLight() {
        document.getElementById('page').classList.toggle('night');
    }
</script>
</body>

</html>